<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/11/google77c1f4cd74efb3a8/"/>
    <url>/2024/01/11/google77c1f4cd74efb3a8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script>google-site-verification: google77c1f4cd74efb3a8.html]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>FastAPIå…¥é—¨æ•™ç¨‹</title>
    <link href="/2024/01/10/FastAPI%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    <url>/2024/01/10/FastAPI%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>æœ¬æ–‡å°†ä¼šé€šè¿‡ä¸Flaskçš„å¯¹æ¯”ï¼Œæ¥ä»‹ç»FastAPIçš„åŸºç¡€ä½¿ç”¨ã€‚ç†Ÿæ‚‰Flaskçš„è¯»è€…ï¼Œé˜…è¯»æœ¬æ–‡ååº”å½“ä¸éš¾æŒæ¡FastAPIã€‚</p></blockquote><p><img src="https://amitness.com/images/flask-to-fastapi.png" /></p><p><code>Flask</code>ä½œä¸ºPythonè¯­è¨€ä¸­çš„è€ç‰ŒWebæ¡†æ¶ï¼Œå·²ç»è¢«åº”ç”¨äºå¤§é‡çš„PythonWebå¼€å‘é¡¹ç›®ï¼Œå…¶ä½¿ç”¨ç®€æ´ï¼Œæ”¯æŒå·¥å…·ä¼—å¤šï¼Œå·¥å…·ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒï¼Œæ˜¯PythonWebæ¡†æ¶ä¸­çš„ä½¼ä½¼è€…ä¹‹ä¸€ã€‚</p><p>è€Œè¿‘æ¥ï¼Œ<code>FastAPI</code>çš„å‡ºä¼—è¡¨ç°ï¼Œå·²ä½¿å¾—å…¶è¶Šæ¥è¶Šå—åˆ°ä¼—å¤šå¼€å‘è€…çš„å…³æ³¨ï¼Œæˆä¸ºWebå¼€å‘ä¸»æµæ¡†æ¶ä¹‹ä¸€ã€‚<ahref="https://fastapi.tiangolo.com/">FastAPIä¼˜åŠ¿</a>å¦‚ä¸‹ï¼š</p><ul><li><p><strong>å¿«é€Ÿ</strong>ï¼šå¯ä¸ NodeJS å’Œ Go å¹¶è‚©çš„æé«˜æ€§èƒ½ï¼ˆå½’åŠŸäºStarlette å’Œ Pydanticï¼‰ã€‚æœ€å¿«çš„ Python web æ¡†æ¶ä¹‹ä¸€ã€‚</p></li><li><p><strong>é«˜æ•ˆç¼–ç </strong>ï¼šæé«˜åŠŸèƒ½å¼€å‘é€Ÿåº¦çº¦ 200ï¼… è‡³300ï¼…ã€‚</p></li><li><p><strong>æ›´å°‘ bug</strong>ï¼šå‡å°‘çº¦ 40ï¼…çš„äººä¸ºï¼ˆå¼€å‘è€…ï¼‰å¯¼è‡´é”™è¯¯ã€‚</p></li><li><p><strong>æ™ºèƒ½</strong>ï¼šæä½³çš„ç¼–è¾‘å™¨æ”¯æŒã€‚å¤„å¤„çš†å¯è‡ªåŠ¨è¡¥å…¨ï¼Œå‡å°‘è°ƒè¯•æ—¶é—´ã€‚</p></li><li><p><strong>ç®€å•</strong>ï¼šè®¾è®¡çš„æ˜“äºä½¿ç”¨å’Œå­¦ä¹ ï¼Œé˜…è¯»æ–‡æ¡£çš„æ—¶é—´æ›´çŸ­ã€‚</p></li><li><p><strong>ç®€çŸ­</strong>ï¼šä½¿ä»£ç é‡å¤æœ€å°åŒ–ã€‚é€šè¿‡ä¸åŒçš„å‚æ•°å£°æ˜å®ç°ä¸°å¯ŒåŠŸèƒ½ã€‚bugæ›´å°‘ã€‚</p></li><li><p><strong>å¥å£®</strong>ï¼šç”Ÿäº§å¯ç”¨çº§åˆ«çš„ä»£ç ã€‚è¿˜æœ‰è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£ã€‚</p></li><li><p><strong>æ ‡å‡†åŒ–</strong>ï¼šåŸºäºï¼ˆå¹¶å®Œå…¨å…¼å®¹ï¼‰APIçš„ç›¸å…³å¼€æ”¾æ ‡å‡†ï¼šOpenAPI (ä»¥å‰è¢«ç§°ä¸º Swagger) å’Œ JSON Schemaã€‚</p></li></ul><p>ä¸‹é¢å°†ä¼šç»“åˆ<code>Flask</code>çš„ä½¿ç”¨ä½œä¸ºå¯¹æ¯”ï¼Œæ¥ä»‹ç»<code>FastAPI</code>ï¼Œä½œä¸º<code>FastAPI</code>çš„å…¥é—¨æ•™ç¨‹ã€‚</p><p>æœ¬æ–‡ä½¿ç”¨çš„ä¸¤ä¸ªWebæ¡†æ¶ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">fastapi==0.101.1<br>Flask==2.3.3<br></code></pre></td></tr></table></figure><h2 id="hello-world">Hello World</h2><p>Flaskçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hello world&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p>FastAPIçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">import</span> uvicorn<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hello world&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    uvicorn.run(app)<br></code></pre></td></tr></table></figure><p>ä¸¤è€…çš„ä»£ç å·®åˆ«ä¸å¤šï¼Œè¿è¡Œæ—¶Flaskçš„é»˜è®¤ç«¯å£ä¸º5000ï¼ŒFastAPIçš„ç«¯å£ä¸º8000ï¼Œä½¿ç”¨curlå‘½ä»¤è¯·æ±‚ï¼ˆFastAPIï¼‰ï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl localhost:8000/<br><span class="hljs-string">&quot;hello world&quot;</span><br></code></pre></td></tr></table></figure><p>åœ¨éƒ¨ç½²ç”Ÿäº§ä»£ç æ—¶ï¼ŒFlaskä½¿ç”¨<code>gunicorn</code>ï¼Œç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gunicorn app:app<br></code></pre></td></tr></table></figure><p>è€ŒFastAPIä½¿ç”¨<code>uvicorn</code>ï¼Œç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">uvicorn app:app<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œåœ¨å®é™…éƒ¨ç½²æ—¶è¿˜å¯æŒ‡å®šç«¯å£ï¼ˆportï¼‰ã€workeræ•°é‡ã€æœ€å¤§è¿æ¥æ•°ç­‰ï¼Œæœ¬æ–‡ä¸å†è¯¦è¿°ã€‚</p><h2 id="httpæ–¹æ³•">HTTPæ–¹æ³•</h2><p>å¸¸è§çš„HTTPè¯·æ±‚æ–¹æ³•æœ‰GET, POST, PUT, PATCH, DELETEç­‰ã€‚</p><p>ä»¥POSTæ–¹æ³•ä¸ºä¾‹ï¼ŒFlaskçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">example</span>():<br>    ...<br></code></pre></td></tr></table></figure><p>FastAPIçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">example</span>():<br>    ...<br></code></pre></td></tr></table></figure><p>å…¶å®ƒHTTPè¯·æ±‚æ–¹æ³•çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-meta">@app.patch(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-meta">@app.delete(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br></code></pre></td></tr></table></figure><h2 id="url-å˜é‡">URL å˜é‡</h2><p>æˆ‘ä»¬æƒ³ä»URLä¸­è·å–user idï¼Œæ¯”å¦‚<code>/users/1</code>ï¼Œç„¶åå°†useridè¿”å›ç»™ç”¨æˆ·ã€‚</p><p>Flaskçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/users/&lt;int:user_id&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_details</span>(<span class="hljs-params">user_id</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;user_id&#x27;</span>: user_id&#125;<br></code></pre></td></tr></table></figure><p>FastAPIçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&#x27;/users/&#123;user_id&#125;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_details</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;user_id&#x27;</span>: user_id&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨curlå‘½ä»¤æ¨¡æ‹Ÿè¯·æ±‚å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl localhost:8000/users/2<br>&#123;<span class="hljs-string">&quot;user_id&quot;</span>:2&#125;<br></code></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢å­—ç¬¦ä¸²">æŸ¥è¯¢å­—ç¬¦ä¸²</h2><p>æˆ‘ä»¬å¸Œæœ›å…è®¸ç”¨æˆ·åœ¨URLä¸­ä½¿ç”¨æŸ¥è¯¢å­—ç¬¦ä¸² <code>?q=abc</code>æ¥æŒ‡å®šæœç´¢è¯ã€‚</p><p>Flaskçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/search&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>():<br>    query = request.args.get(<span class="hljs-string">&#x27;q&#x27;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;query&#x27;</span>: query&#125;<br></code></pre></td></tr></table></figure><p>FastAPIçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&#x27;/search&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;query&#x27;</span>: q&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨curlå‘½ä»¤æ¨¡æ‹Ÿè¯·æ±‚å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl <span class="hljs-string">&#x27;localhost:8000/search?q=abcde&#x27;</span><br>&#123;<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;abcde&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¦æŒ‡å®šå¤šä¸ªæœç´¢è¯ï¼Œå¯ä»¥&amp;ç¬¦å·éš”å¼€ï¼Œæ¯”å¦‚ï¼š</p><blockquote><p>?name=Jack&amp;id=1</p></blockquote><h2 id="json-post-è¯·æ±‚">JSON Post è¯·æ±‚</h2><p>æˆ‘ä»¬å¸Œæœ›å‘é€ä¸€ä¸ªå¸¦æœ‰textå‚æ•°JSON POSTè¯·æ±‚ï¼Œè¿”å›å…¶å°å†™å½¢å¼ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text"># Request<br>&#123;&quot;text&quot;: &quot;HELLO&quot;&#125;<br><br># Response<br>&#123;&quot;text&quot;: &quot;hello&quot;&#125;<br></code></pre></td></tr></table></figure><p>Flaskä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/lowercase&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lower_case</span>():<br>    text = request.json.get(<span class="hljs-string">&#x27;text&#x27;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;text&#x27;</span>: text.lower()&#125;<br></code></pre></td></tr></table></figure><p>FastAPIä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&#x27;/lowercase&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lower_case</span>(<span class="hljs-params">json_data: <span class="hljs-type">Dict</span></span>):<br>    text = json_data.get(<span class="hljs-string">&#x27;text&#x27;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;text&#x27;</span>: text.lower()&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šFastAPIè¿˜æœ‰æ›´ä¼˜é›…çš„å¤„ç†æ–¹å¼ï¼Œé‚£å°±æ˜¯å¼•å…¥<code>Pydantic schema</code>ï¼Œå®ƒå¯ä»¥å°†JSONæ ¼å¼æ•°æ®æ˜ å°„ä¸ºschemaå¯¹è±¡ï¼ŒåŒæ—¶å¯¹è¯¥å¯¹è±¡ä¸­çš„æ•°æ®ç±»å‹è¿›è¡Œæ ¡éªŒï¼Œå¦‚æ ¡éªŒä¸é€šè¿‡ï¼Œåˆ™ä¼šè¿”å›è‡ªåŠ¨ç”Ÿæˆçš„æ ¡éªŒé”™è¯¯ã€‚</p><p>FastAPIæ›´ä¼˜é›…çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Sentence</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    text: <span class="hljs-built_in">str</span><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&#x27;/lowercase&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lower_case</span>(<span class="hljs-params">sentence: Sentence</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;text&#x27;</span>: sentence.text.lower()&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨curlå‘½ä»¤æ¨¡æ‹Ÿè¯·æ±‚å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl --location <span class="hljs-string">&#x27;localhost:8000/lowercase&#x27;</span> \<br>--header <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> \<br>--data <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    &quot;text&quot;: &quot;HELLO&quot;</span><br><span class="hljs-string">&#125;&#x27;</span><br>&#123;<span class="hljs-string">&quot;text&quot;</span>:<span class="hljs-string">&quot;hello&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¯·æ±‚æ—¶ï¼Œå¦‚æœtextå¯¹åº”çš„valueä¸ºæ•°å­—æ—¶ï¼ŒFastAPIä¼šè‡ªåŠ¨å°†æ•°å­—è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œä¸ä¼šæŠ¥é”™ï¼›å¦‚æœtextå¯¹åº”çš„valueä¸ºnullæ—¶ï¼ŒFastAPIå°†ä¼šæŠ¥é”™ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;detail&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;loc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;body&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;text&quot;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;none is not an allowed value&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;type_error.none.not_allowed&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ ">æ–‡ä»¶ä¸Šä¼ </h2><p>æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„APIï¼Œè¿”å›ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶åã€‚</p><p>Flaskä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>():<br>    file = request.files.get(<span class="hljs-string">&#x27;file&#x27;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;name&#x27;</span>: file.filename&#125;<br></code></pre></td></tr></table></figure><p>FastAPIçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, UploadFile, File<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>(<span class="hljs-params">file: UploadFile = File(<span class="hljs-params">...</span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;name&#x27;</span>: file.filename&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Postmanæ¨¡æ‹Ÿè¯·æ±‚å¦‚ä¸‹ï¼š</p><pre><code class="hljs">$ curl --location &#39;localhost:8000/upload&#39; \--header &#39;Content-Type: multipart/form-data&#39; \--form &#39;file=@&quot;/Users/admin/Documents/test.pdf&quot;&#39;&#123;&quot;name&quot;: &quot;test.pdf&quot;&#125;</code></pre><h2 id="è¡¨å•æäº¤">è¡¨å•æäº¤</h2><p>æˆ‘ä»¬å¸Œæœ›ä»è¡¨å•ä¸­è·å–textç±»å‹çš„å˜é‡ï¼Œå¹¶è¿”å›å®ƒçš„å€¼ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;city&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Flaskä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/submit&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">echo</span>():<br>    city = request.form.get(<span class="hljs-string">&#x27;city&#x27;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;city&#x27;</span>: city&#125;<br></code></pre></td></tr></table></figure><p>FastAPIä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Form<br>app = FastAPI()<br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&#x27;/submit&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">echo</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params">...</span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;city&#x27;</span>: city&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨curlå‘½ä»¤æ¨¡æ‹Ÿè¯·æ±‚å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl --location <span class="hljs-string">&#x27;localhost:8000/submit&#x27;</span> \<br>--form <span class="hljs-string">&#x27;city=&quot;shanghai&quot;&#x27;</span><br>&#123;<span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;shanghai&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="cookies">Cookies</h2><p>æˆ‘ä»¬å¸Œæœ›ä»è¯·æ±‚çš„cookieä¸­è·å–nameå­—æ®µçš„å€¼ã€‚</p><p>Flaskä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/profile&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">profile</span>():<br>    name = request.cookies.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;name&#x27;</span>: name&#125;<br></code></pre></td></tr></table></figure><p>FastAPIä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Cookie<br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&#x27;/profile&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">profile</span>(<span class="hljs-params">name=Cookie(<span class="hljs-params"><span class="hljs-literal">None</span></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;name&#x27;</span>: name&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¨¡å—åŒ–è§†å›¾">æ¨¡å—åŒ–è§†å›¾</h2><p>æˆ‘ä»¬å¸Œæœ›å°†å•ä¸ªçš„app.pyæ–‡ä»¶åˆ†è§£æˆè§†å›¾ï¼ˆå¤šä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼‰ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">- app.py<br>- views<br>  - user.py<br></code></pre></td></tr></table></figure><p>åœ¨Flaskä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>è“å›¾</strong>ï¼ˆBlueprintï¼‰æ¥ç®¡ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p>user.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># views/user.py</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Blueprint<br>user_blueprint = Blueprint(<span class="hljs-string">&#x27;user&#x27;</span>, __name__)<br><br><span class="hljs-meta">@user_blueprint.route(<span class="hljs-params"><span class="hljs-string">&#x27;/users&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_users</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;users&#x27;</span>: [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>]&#125;<br></code></pre></td></tr></table></figure><p>app.py</p><pre><code class="hljs"># app.pyfrom flask import Flaskfrom views.user import user_blueprintapp = Flask(__name__)app.register_blueprint(user_blueprint)</code></pre><p>åœ¨FastAPIä¸­ï¼Œä¸è“å›¾ç­‰ä»·çš„å®ç°å½¢å¼ä¸º<strong>router</strong>ï¼Œé¦–å…ˆéœ€åˆ›å»ºä¸€ä¸ªuserrouterå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># routers/user.py</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> APIRouter<br>router = APIRouter()<br><br><span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">&#x27;/users&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_users</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;users&#x27;</span>: [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>]&#125;<br></code></pre></td></tr></table></figure><p>å°†å…¶åŠ å…¥app.pyä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> routers <span class="hljs-keyword">import</span> user<br><br>app = FastAPI()<br>app.include_router(user.router)<br></code></pre></td></tr></table></figure><h2 id="æ•°æ®æ ¡éªŒ">æ•°æ®æ ¡éªŒ</h2><p>Flaskæœ¬èº«å¹¶æ²¡æœ‰æä¾›æ•°æ®æ ¡éªŒåŠŸèƒ½ï¼Œå¯ä½¿ç”¨<code>marshmalllow</code>æˆ–<code>pydantic</code>æ¨¡å—æ¥è¾…åŠ©å®ç°ã€‚</p><p>è€ŒFastAPIåœ¨å…¶æ¡†æ¶ä¸­å·²åŒ…è£…<code>pydantic</code>æ¨¡å—ï¼Œå¯è½»æ¾å®ç°æ•°æ®æ ¡éªŒã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> uvicorn<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    age: <span class="hljs-built_in">int</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&#x27;/users&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_user</span>(<span class="hljs-params">user: User</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;name&#x27;</span>: user.name,<br>            <span class="hljs-string">&#x27;age&#x27;</span>: user.age&#125;<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    uvicorn.run(app)<br></code></pre></td></tr></table></figure><p>å…³äº<code>pydantic</code>çš„schemaä¸JSONæ ¼å¼å¯¹åº”å…³ç³»ï¼Œåœ¨æ­¤ç»™å‡ºä¸‰ä¸ªä¾‹å­ï¼š</p><p><code>ä¾‹å­1</code> é”®å€¼å¯¹ï¼ˆkey-value pairsï¼‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Isaac&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">60</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    age: <span class="hljs-built_in">int</span><br></code></pre></td></tr></table></figure><p><code>ä¾‹å­2</code> åˆ—è¡¨</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;series&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;GOT&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;Dark&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;Mr. Robot&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Metadata</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    series: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]<br></code></pre></td></tr></table></figure><p><code>ä¾‹å­3</code> åµŒå¥—å¯¹è±¡</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xyz&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">25</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;abc&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Group A&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    age: <span class="hljs-built_in">int</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserGroup</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    users: <span class="hljs-type">List</span>[User]<br>    group: <span class="hljs-built_in">str</span><br></code></pre></td></tr></table></figure><h2 id="è‡ªåŠ¨åŒ–æ–‡æ¡£">è‡ªåŠ¨åŒ–æ–‡æ¡£</h2><p>Flaskå¹¶æ²¡æœ‰æä¾›å†…ç½®çš„è‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆï¼Œå¯ä½¿ç”¨<code>flask-swagger</code>æˆ–<code>flask-restful</code>æ¨¡å—æ¥è¾…åŠ©å®ç°ã€‚</p><p>FastAPIå¯ç”Ÿæˆè‡ªåŠ¨åŒ–æ–‡æ¡£ï¼Œæ–‡æ¡£é£æ ¼åŒ…æ‹¬swaggerå’Œredocï¼Œå…¶ä¸­swaggerå¯¹åº”è·¯å¾„ä¸º/docsï¼Œredocå¯¹åº”è·¯å¾„ä¸º/redocï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><h3 id="swaggeré£æ ¼">Swaggeré£æ ¼</h3><figure><img src="https://amitness.com/images/fastapi-swagger.png"alt="swaggeré£æ ¼æ–‡æ¡£" /><figcaption aria-hidden="true">swaggeré£æ ¼æ–‡æ¡£</figcaption></figure><figure><img src="https://amitness.com/images/fastapi-swagger-interactive.png"alt="æŸ¥çœ‹æŸä¸ªæ¥å£" /><figcaption aria-hidden="true">æŸ¥çœ‹æŸä¸ªæ¥å£</figcaption></figure><h3 id="redocé£æ ¼">ReDocé£æ ¼</h3><figure><img src="https://amitness.com/images/fastapi-redoc.png"alt="ReDocé£æ ¼æ–‡æ¡£" /><figcaption aria-hidden="true">ReDocé£æ ¼æ–‡æ¡£</figcaption></figure><h2 id="cors">CORS</h2><p>Flaskæœ¬èº«ä¸æ”¯æŒCORSï¼Œå¯ä½¿ç”¨<code>flask-cors</code>æ¨¡å—è¾…åŠ©å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> flask_cors <span class="hljs-keyword">import</span> CORS<br><br>app_ = Flask(__name__)<br>CORS(app_)<br></code></pre></td></tr></table></figure><p>FastAPIæä¾›äº†å†…ç½®çš„ä¸­é—´ä»¶æ¥å¤„ç†CORSï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.middleware.cors <span class="hljs-keyword">import</span> CORSMiddleware<br><br>app = FastAPI()<br><br>app.add_middleware(<br>    CORSMiddleware,<br>    allow_origins=[<span class="hljs-string">&#x27;*&#x27;</span>],<br>    allow_credentials=<span class="hljs-literal">True</span>,<br>    allow_methods=[<span class="hljs-string">&quot;*&quot;</span>],<br>    allow_headers=[<span class="hljs-string">&quot;*&quot;</span>],<br>)<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ¬æ–‡é€šè¿‡ä¸Flaskçš„å¯¹æ¯”ï¼Œæ¥ä»‹ç»FastAPIçš„åŸºç¡€ä½¿ç”¨ã€‚å¦‚æœè¯»è€…æƒ³è¿›ä¸€æ­¥äº†è§£FastAPIçš„é«˜çº§ä½¿ç”¨æ–¹æ³•ï¼Œå¯å‚è€ƒ<ahref="https://fastapi.tiangolo.com/zh/">FastAPIå®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>æ„Ÿè°¢é˜…è¯»~</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>FastAPI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåå…«ï¼‰å¤§æ¨¡å‹æ¢ç´¢ï¼šMMLUæ•°æ®é›†è¯„æµ‹</title>
    <link href="/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E5%85%AB%EF%BC%89%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A2%E7%B4%A2%EF%BC%9AMMLU%E6%95%B0%E6%8D%AE%E9%9B%86%E8%AF%84%E6%B5%8B/"/>
    <url>/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E5%85%AB%EF%BC%89%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A2%E7%B4%A2%EF%BC%9AMMLU%E6%95%B0%E6%8D%AE%E9%9B%86%E8%AF%84%E6%B5%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨å¤§æ¨¡å‹ï¼ˆLLMï¼‰å¯¹MMLUæ•°æ®é›†è¿›è¡Œè¯„æµ‹ã€‚</p></blockquote><p>å¤§æ¨¡å‹ï¼ˆLLMï¼‰çš„è¯„æµ‹æ˜¯è¡¡é‡å¤§æ¨¡å‹æ•ˆæœçš„å…³é”®æ­¥éª¤ï¼Œä¹Ÿæ˜¯æ¨¡å‹æµæ°´çº¿ä¸­å¿…ä¸å¯å°‘çš„è¿‡ç¨‹ã€‚å¸¸è§çš„å¤§æ¨¡å‹æ’è¡Œæ¦œæˆ–å¹³å°æœ‰<ahref="https://huggingface.co/spaces/HuggingFaceH4/open_llm_leaderboard">ğŸ¤—Open LLM Leaderboard</a>ã€<ahref="https://opencompass.org.cn/leaderboard-llm">OpenCompass</a>ã€<ahref="https://lmsys.org/blog/2023-05-25-leaderboard/">Chatbot ArenaLeaderboard</a>.</p><p>é‚£ä¹ˆï¼Œå¤§æ¨¡å‹çš„è¯„æµ‹æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>æœ¬æ–‡å°†ä¼šä»¥<code>MMLU</code>æ•°æ®é›†ä¸ºä¾‹ï¼Œè€ƒå¯Ÿä¸»æµå¼€æºå¤§æ¨¡å‹ï¼Œå¦‚LLAMA-2,BaiChuan-2ç­‰æ¨¡å‹çš„è¯„ä¼°å®ç°åŠç»“æœï¼Œå¸Œæœ›èƒ½ç®¡ä¸­è§„è±¹ï¼Œä¸€æ¢ç©¶ç«Ÿã€‚</p><h2 id="mmluæ•°æ®é›†">MMLUæ•°æ®é›†</h2><p><ahref="https://github.com/hendrycks/test"><code>MMLU</code>æ•°æ®é›†</a>å·²å¼€æºè‡³Githubå¹³å°ï¼Œè®¿é—®ç½‘å€ä¸ºï¼šhttps://github.com/hendrycks/test.</p><p><strong>MMLU</strong>ï¼ˆMassive Multitask LanguageUnderstandingï¼‰æ˜¯ä¸€ä¸ªæ–°çš„åŸºå‡†ï¼Œç”¨äºè¡¡é‡åœ¨<strong>é›¶æ ·æœ¬</strong>ï¼ˆzero-shotï¼‰å’Œ<strong>å°‘æ ·æœ¬</strong>ï¼ˆfew-shotï¼‰æƒ…å½¢ä¸‹ï¼Œå¤§æ¨¡å‹åœ¨é¢„è®­ç»ƒæœŸé—´è·å¾—çš„ä¸–ç•ŒçŸ¥è¯†ã€‚è¿™ä½¿å¾—è¯¥åŸºå‡†æµ‹è¯•æ›´å…·æŒ‘æˆ˜æ€§ï¼Œä¹Ÿæ›´ç±»ä¼¼äºæˆ‘ä»¬è¯„ä¼°äººç±»çš„æ–¹å¼ã€‚è¯¥åŸºå‡†æ¶µç›–STEMã€äººæ–‡ï¼ˆhumanitiesï¼‰ã€ç¤¾ä¼šç§‘å­¦ï¼ˆsocial sciencesï¼‰ç­‰é¢†åŸŸçš„ 57ä¸ªå­¦ç§‘ï¼ˆsubjectï¼‰ã€‚å®ƒçš„éš¾åº¦ä»åˆçº§åˆ°é«˜çº§ï¼Œæ—¢è€ƒéªŒä¸–ç•ŒçŸ¥è¯†ï¼Œåˆè€ƒéªŒè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚å­¦ç§‘èŒƒå›´ä»æ•°å­¦å’Œå†å²ç­‰ä¼ ç»Ÿé¢†åŸŸåˆ°æ³•å¾‹å’Œä¼¦ç†ç­‰æ›´ä¸ºä¸“ä¸šçš„é¢†åŸŸã€‚å­¦ç§‘çš„ç²’åº¦å’Œå¹¿åº¦ä½¿è¯¥åŸºå‡†æˆä¸ºè¯†åˆ«æ¨¡å‹ç›²ç‚¹çš„ç†æƒ³é€‰æ‹©ã€‚</p><p>MMLUæ•°æ®é›†å…±æ”¶é›†äº†15908ä¸ªé—®é¢˜ï¼Œå¹¶å°†å…¶åˆ†ä¸ºfew-shotå¼€å‘é›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚few-shotå¼€å‘é›†æ¯ä¸ªå­¦ç§‘æœ‰5ä¸ªé—®é¢˜ï¼ŒéªŒè¯é›†å¯ç”¨äºé€‰æ‹©è¶…å‚æ•°ï¼Œç”±1540ä¸ªé—®é¢˜ç»„æˆï¼Œæµ‹è¯•é›†æœ‰14079ä¸ªé—®é¢˜ã€‚æ¯ä¸ªå­¦ç§‘è‡³å°‘åŒ…å«100ä¸ªæµ‹è¯•é—®é¢˜ï¼Œè¿™æ¯”å¤§å¤šæ•°æ—¨åœ¨è¯„ä¼°äººç±»çš„è€ƒè¯•éƒ½è¦é•¿ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹å…¶ä¸­ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight mercury"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mercury">Question: Glucose <span class="hljs-keyword">is</span> transported into the muscle cell:<br><br>Choices:<br>A. via protein transporters called GLUT4.<br>B. only in the presence of insulin.<br>C. via hexokinase.<br>D. via monocarbylic acid transporters.<br><br>Correct answer: A<br></code></pre></td></tr></table></figure><h2 id="è¯„æµ‹ä»£ç ">è¯„æµ‹ä»£ç </h2><p>å¯¹äºMMLUæ•°æ®é›†çš„è¯„æµ‹ï¼Œ<ahref="https://huggingface.co/blog/evaluating-mmlu-leaderboard">MMLUè¯„æµ‹å®˜æ–¹æ–¹æ¡ˆ</a>ä¸ºï¼š</p><blockquote><p>åˆ¤æ–­ LLM åç»­ token ä¸º A, B, C æˆ– Dçš„æ¦‚ç‡ï¼Œåªè¦ç”Ÿæˆtokenä¸ºAçš„æ¦‚ç‡åœ¨å››ä¸ªtokenä¸­æ¦‚ç‡æœ€å¤§ï¼Œåˆ™å›ç­”æ­£ç¡®ã€‚è¯¥æ–¹æ¡ˆæ˜æ˜¾çš„å¼Šç«¯å°±æ˜¯ï¼Œå³ä¾¿ABCDä¸­ï¼Œç”ŸæˆAçš„æ¦‚ç‡æœ€å¤§ï¼Œåœ¨å®é™…è§£ç è¿‡ç¨‹ä¸­ï¼ŒLLM å®é™…ç”Ÿæˆçš„ä¹Ÿä¸ä¸€å®šæ˜¯ tokenAã€‚</p></blockquote><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="https://s2.loli.net/2023/10/18/iRUlDCegdZBbjv2.png"alt="MMLUæ–¹æ¡ˆè¯„æµ‹" /><figcaption aria-hidden="true">MMLUæ–¹æ¡ˆè¯„æµ‹</figcaption></figure><p>ä¸ºäº†ä½¿å¾—åœ¨MMLUæ•°æ®é›†ä¸Šçš„è¯„æµ‹ç»“æœæ›´å¯é ï¼Œæˆ‘ä»¬é€‰æ‹©å®˜æ–¹æ–¹æ¡ˆã€‚åŒæ—¶ï¼Œä¸ºäº†å…¼å®¹æ›´å¤šå¤§æ¨¡å‹ä»¥åŠä¿å­˜æ¨¡å‹è¯„æµ‹ç»“æœã€æ¨ç†æ—¶é—´ç­‰ï¼Œæˆ‘ä»¬å‚è€ƒGithubä¸Šçš„é¡¹ç›®<ahref="https://github.com/ollmer/mmlu">ollmer/mmlu</a>ä¸­çš„ä»£ç ï¼Œå¹¶ç¨ä½œè°ƒæ•´ï¼ŒPythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> argparse<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer<br><br><span class="hljs-keyword">from</span> categories <span class="hljs-keyword">import</span> categories, subcategories<br><br>choices = [<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">format_subject</span>(<span class="hljs-params">subject</span>):<br>    l = subject.split(<span class="hljs-string">&quot;_&quot;</span>)<br>    s = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> entry <span class="hljs-keyword">in</span> l:<br>        s += <span class="hljs-string">&quot; &quot;</span> + entry<br>    <span class="hljs-keyword">return</span> s<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">format_example</span>(<span class="hljs-params">df, idx, include_answer=<span class="hljs-literal">True</span></span>):<br>    prompt = df.iloc[idx, <span class="hljs-number">0</span>]<br>    k = df.shape[<span class="hljs-number">1</span>] - <span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>        prompt += <span class="hljs-string">&quot;\n&#123;&#125;. &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(choices[j], df.iloc[idx, j + <span class="hljs-number">1</span>])<br>    prompt += <span class="hljs-string">&quot;\nAnswer:&quot;</span><br>    <span class="hljs-keyword">if</span> include_answer:<br>        prompt += <span class="hljs-string">&quot; &#123;&#125;\n\n&quot;</span>.<span class="hljs-built_in">format</span>(df.iloc[idx, k + <span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">return</span> prompt<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_prompt</span>(<span class="hljs-params">train_df, subject, k=-<span class="hljs-number">1</span></span>):<br>    prompt = <span class="hljs-string">&quot;The following are multiple choice questions (with answers) about &#123;&#125;.\n\n&quot;</span>.<span class="hljs-built_in">format</span>(<br>        format_subject(subject)<br>    )<br>    <span class="hljs-keyword">if</span> k == -<span class="hljs-number">1</span>:<br>        k = train_df.shape[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>        prompt += format_example(train_df, i)<br>    <span class="hljs-keyword">return</span> prompt<br><br><br><span class="hljs-meta">@torch.no_grad()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">eval</span>(<span class="hljs-params">args, subject, model, tokenizer, dev_df, test_df</span>):<br>    cors = []<br>    all_probs = []<br>    answers = choices[: test_df.shape[<span class="hljs-number">1</span>] - <span class="hljs-number">2</span>]<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(test_df.shape[<span class="hljs-number">0</span>]):<br>        <span class="hljs-comment"># get prompt and make sure it fits</span><br>        k = args.ntrain<br>        prompt_end = format_example(test_df, i, include_answer=<span class="hljs-literal">False</span>)<br>        train_prompt = gen_prompt(dev_df, subject, k)<br>        prompt = train_prompt + prompt_end<br><br>        input_ids = tokenizer(prompt, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).input_ids.to(model.device)<br><br>        <span class="hljs-keyword">while</span> input_ids.shape[-<span class="hljs-number">1</span>] &gt; <span class="hljs-number">2048</span>:<br>            k -= <span class="hljs-number">1</span><br>            train_prompt = gen_prompt(dev_df, subject, k)<br>            prompt = train_prompt + prompt_end<br>            input_ids = tokenizer(prompt, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).input_ids.to(<br>                model.device<br>            )<br><br>        label = test_df.iloc[i, test_df.shape[<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>]<br><br>        logits = model(input_ids=input_ids).logits[<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>]<br><br>        probs = (<br>            torch.nn.functional.softmax(<br>                torch.tensor(<br>                    [<br>                        logits[tokenizer(<span class="hljs-string">&quot;A&quot;</span>).input_ids[-<span class="hljs-number">1</span>]],<br>                        logits[tokenizer(<span class="hljs-string">&quot;B&quot;</span>).input_ids[-<span class="hljs-number">1</span>]],<br>                        logits[tokenizer(<span class="hljs-string">&quot;C&quot;</span>).input_ids[-<span class="hljs-number">1</span>]],<br>                        logits[tokenizer(<span class="hljs-string">&quot;D&quot;</span>).input_ids[-<span class="hljs-number">1</span>]],<br>                    ]<br>                ).<span class="hljs-built_in">float</span>(),<br>                dim=<span class="hljs-number">0</span>,<br>            )<br>            .detach()<br>            .cpu()<br>            .numpy()<br>        )<br>        pred = &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">3</span>: <span class="hljs-string">&quot;D&quot;</span>&#125;[np.argmax(probs)]<br><br>        cor = pred == label<br>        cors.append(cor)<br>        all_probs.append(probs)<br><br>    acc = np.mean(cors)<br>    cors = np.array(cors)<br><br>    all_probs = np.array(all_probs)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Average accuracy &#123;:.3f&#125; - &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(acc, subject))<br><br>    <span class="hljs-keyword">return</span> cors, acc, all_probs<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">args</span>):<br>    model = AutoModelForCausalLM.from_pretrained(<br>        args.model,<br>        torch_dtype=torch.float16,<br>        load_in_8bit=<span class="hljs-literal">False</span>,<br>        low_cpu_mem_usage=<span class="hljs-literal">True</span>,<br>        device_map=<span class="hljs-string">&quot;auto&quot;</span>,<br>        trust_remote_code=<span class="hljs-literal">True</span><br>    )<br>    tokenizer = AutoTokenizer.from_pretrained(args.model, trust_remote_code=<span class="hljs-literal">True</span>)<br>    model.<span class="hljs-built_in">eval</span>()<br>    subjects = <span class="hljs-built_in">sorted</span>(<br>        [<br>            f.split(<span class="hljs-string">&quot;_test.csv&quot;</span>)[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(os.path.join(args.data_dir, <span class="hljs-string">&quot;test&quot;</span>))<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;_test.csv&quot;</span> <span class="hljs-keyword">in</span> f<br>        ]<br>    )<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(args.save_dir):<br>        os.makedirs(args.save_dir)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(os.path.join(args.save_dir, <span class="hljs-string">&quot;results_&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(args.model.split(<span class="hljs-string">&quot;/&quot;</span>)[-<span class="hljs-number">1</span>]))):<br>        os.makedirs(os.path.join(args.save_dir, <span class="hljs-string">&quot;results_&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(args.model.split(<span class="hljs-string">&quot;/&quot;</span>)[-<span class="hljs-number">1</span>])))<br><br>    all_cors = []<br>    subcat_cors = &#123;<br>        subcat: [] <span class="hljs-keyword">for</span> subcat_lists <span class="hljs-keyword">in</span> subcategories.values() <span class="hljs-keyword">for</span> subcat <span class="hljs-keyword">in</span> subcat_lists<br>    &#125;<br>    cat_cors = &#123;cat: [] <span class="hljs-keyword">for</span> cat <span class="hljs-keyword">in</span> categories&#125;<br><br>    start_time = time.time()<br>    <span class="hljs-keyword">for</span> subject <span class="hljs-keyword">in</span> subjects:<br>        dev_df = pd.read_csv(<br>            os.path.join(args.data_dir, <span class="hljs-string">&quot;dev&quot;</span>, subject + <span class="hljs-string">&quot;_dev.csv&quot;</span>), header=<span class="hljs-literal">None</span><br>        )[: args.ntrain]<br>        test_df = pd.read_csv(<br>            os.path.join(args.data_dir, <span class="hljs-string">&quot;test&quot;</span>, subject + <span class="hljs-string">&quot;_test.csv&quot;</span>), header=<span class="hljs-literal">None</span><br>        )<br><br>        cors, acc, probs = <span class="hljs-built_in">eval</span>(args, subject, model, tokenizer, dev_df, test_df)<br>        subcats = subcategories[subject]<br>        <span class="hljs-keyword">for</span> subcat <span class="hljs-keyword">in</span> subcats:<br>            subcat_cors[subcat].append(cors)<br>            <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> categories.keys():<br>                <span class="hljs-keyword">if</span> subcat <span class="hljs-keyword">in</span> categories[key]:<br>                    cat_cors[key].append(cors)<br>        all_cors.append(cors)<br><br>        test_df[<span class="hljs-string">&quot;&#123;&#125;_correct&quot;</span>.<span class="hljs-built_in">format</span>(args.model)] = cors<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(probs.shape[<span class="hljs-number">1</span>]):<br>            choice = choices[j]<br>            test_df[<span class="hljs-string">&quot;&#123;&#125;_choice&#123;&#125;_probs&quot;</span>.<span class="hljs-built_in">format</span>(args.model, choice)] = probs[:, j]<br>        test_df.to_csv(<br>            os.path.join(<br>                args.save_dir, <span class="hljs-string">&quot;results_&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(args.model.split(<span class="hljs-string">&quot;/&quot;</span>)[-<span class="hljs-number">1</span>]), <span class="hljs-string">&quot;&#123;&#125;.csv&quot;</span>.<span class="hljs-built_in">format</span>(subject)<br>            ),<br>            index=<span class="hljs-literal">None</span>,<br>        )<br><br>    results = &#123;<span class="hljs-string">&quot;subcategories&quot;</span>: &#123;&#125;, <span class="hljs-string">&quot;categories&quot;</span>: &#123;&#125;&#125;<br>    <span class="hljs-keyword">for</span> subcat <span class="hljs-keyword">in</span> subcat_cors:<br>        subcat_acc = np.mean(np.concatenate(subcat_cors[subcat]))<br>        results[<span class="hljs-string">&quot;subcategories&quot;</span>][subcat] = subcat_acc<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Average accuracy &#123;:.3f&#125; - &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(subcat_acc, subcat))<br><br>    <span class="hljs-keyword">for</span> cat <span class="hljs-keyword">in</span> cat_cors:<br>        cat_acc = np.mean(np.concatenate(cat_cors[cat]))<br>        results[<span class="hljs-string">&quot;categories&quot;</span>][cat] = cat_acc<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Average accuracy &#123;:.3f&#125; - &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(cat_acc, cat))<br>    weighted_acc = np.mean(np.concatenate(all_cors))<br>    results[<span class="hljs-string">&quot;weighted_accuracy&quot;</span>] = weighted_acc<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Average accuracy: &#123;:.3f&#125;&quot;</span>.<span class="hljs-built_in">format</span>(weighted_acc))<br><br>    results_file = os.path.join(<br>        args.save_dir, <span class="hljs-string">&quot;accuracies_&#123;&#125;.json&quot;</span>.<span class="hljs-built_in">format</span>(args.model.replace(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;_&quot;</span>))<br>    )<br>    end_time = time.time()<br>    results[<span class="hljs-string">&quot;cost_time&quot;</span>] = end_time - start_time<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(results_file, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(json.dumps(results, indent=<span class="hljs-number">4</span>))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    parser = argparse.ArgumentParser()<br>    parser.add_argument(<span class="hljs-string">&quot;--ntrain&quot;</span>, <span class="hljs-string">&quot;-k&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">5</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--data_dir&quot;</span>, <span class="hljs-string">&quot;-d&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>, default=<span class="hljs-string">&quot;data&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--save_dir&quot;</span>, <span class="hljs-string">&quot;-s&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>, default=<span class="hljs-string">&quot;results&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--model&quot;</span>, <span class="hljs-string">&quot;-m&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>)<br>    args = parser.parse_args()<br>    main(args)<br>    <br></code></pre></td></tr></table></figure><p>è¿è¡Œæ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 evaluate_hf.py -m /workspace/models/llama2-7b-hf<br></code></pre></td></tr></table></figure><p>æœ¬é¡¹ç›®å·²å¼€æºè‡³Githubå¹³å°ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/llm_evaluation_4_mmlu">https://github.com/percent4/llm_evaluation_4_mmlu</a>.</p><h2 id="è¯„æµ‹å®éªŒ">è¯„æµ‹å®éªŒ</h2><p>ç¬”è€…åœ¨A10080Gçš„GPUä¸Šå¯¹å„ç±»å¤§æ¨¡å‹è¿›è¡Œè¯„æµ‹ï¼Œå®ƒä»¬åœ¨MMLUæ•°æ®é›†ä¸Šçš„è¡¨ç°ç»“æœå¦‚ä¸‹ï¼š</p><ul><li>LLAMAç³»åˆ—æ¨¡å‹</li></ul><table><thead><tr class="header"><th>æ¨¡å‹å°ºå¯¸</th><th>Average weighed accuracy</th><th>STEM</th><th>humanities</th><th>social sciences</th><th>other</th><th>Inference Time(s)</th></tr></thead><tbody><tr class="odd"><td>llama-2-7b</td><td>0.4596</td><td>0.3704</td><td>0.4338</td><td>0.5184</td><td>0.5244</td><td>2468.45</td></tr><tr class="even"><td>llama-2-13b</td><td>0.5568</td><td>0.4427</td><td>0.5443</td><td>0.6341</td><td>0.6076</td><td>4123.48</td></tr><tr class="odd"><td>llama-2-70b</td><td>0.6911</td><td>0.5779</td><td>0.6516</td><td>0.8044</td><td>0.7461</td><td>14961.76</td></tr></tbody></table><ul><li>å…¶å®ƒæ¨¡å‹</li></ul><table><thead><tr class="header"><th>æ¨¡å‹</th><th>Average weighed accuracy</th><th>STEM</th><th>humanities</th><th>social sciences</th><th>other</th><th>Inference Time(s)</th></tr></thead><tbody><tr class="odd"><td>Baichuan-7B</td><td>0.4261</td><td>0.3615</td><td>0.3853</td><td>0.4927</td><td>0.4821</td><td>3620.22</td></tr><tr class="even"><td>Baichuan2-7B-Base</td><td>0.5431</td><td>0.4463</td><td>0.5133</td><td>0.6126</td><td>0.6104</td><td>3742.95</td></tr><tr class="odd"><td>Baichuan2-13B-Base</td><td>0.5901</td><td>0.4954</td><td>0.5505</td><td>0.6783</td><td>0.6521</td><td>3460.3</td></tr><tr class="even"><td>internlm-20b</td><td>0.6063</td><td>0.5113</td><td>0.5615</td><td>0.7033</td><td>0.6675</td><td>5709.98</td></tr><tr class="odd"><td>Mistral-7B-v0.1</td><td>0.6267</td><td>0.5268</td><td>0.5658</td><td>0.7364</td><td>0.7039</td><td>2517.74</td></tr></tbody></table><figure><img src="https://s2.loli.net/2023/10/18/3FJk2psOInuTAZ9.png"alt="å¤§æ¨¡å‹åœ¨MMLUæ•°æ®é›†ä¸Šçš„è¯„æµ‹ç»“æœ" /><figcaptionaria-hidden="true">å¤§æ¨¡å‹åœ¨MMLUæ•°æ®é›†ä¸Šçš„è¯„æµ‹ç»“æœ</figcaption></figure><figure><img src="https://s2.loli.net/2023/10/18/tjZrMLHk3cOmfVs.png"alt="å¤§æ¨¡å‹åœ¨MMLUæ•°æ®é›†ä¸Šçš„å„å­¦ç§‘è¯„æµ‹ç»“æœ" /><figcaptionaria-hidden="true">å¤§æ¨¡å‹åœ¨MMLUæ•°æ®é›†ä¸Šçš„å„å­¦ç§‘è¯„æµ‹ç»“æœ</figcaption></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨å¤§æ¨¡å‹ï¼ˆLLMï¼‰å¯¹MMLUæ•°æ®é›†è¿›è¡Œè¯„æµ‹ã€‚</p><p>æœ¬æ–‡ä¸­çš„é¡¹ç›®ä»£ç å·²å¼€æºè‡³Githubå¹³å°ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/llm_evaluation_4_mmlu">https://github.com/percent4/llm_evaluation_4_mmlu</a>.</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LLM</tag>
      
      <tag>LLM Evaluation</tag>
      
      <tag>MMLUæ•°æ®é›†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VSCODEä½¿ç”¨æŠ€å·§ï¼ˆ1ï¼‰è¿æ¥è¿œç¨‹æœåŠ¡å™¨å¼€å‘åŠä½¿ç”¨Jupyter</title>
    <link href="/2024/01/10/VSCODE%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%EF%BC%881%EF%BC%89%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E5%8F%8A%E4%BD%BF%E7%94%A8Jupyter/"/>
    <url>/2024/01/10/VSCODE%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%EF%BC%881%EF%BC%89%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E5%8F%8A%E4%BD%BF%E7%94%A8Jupyter/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•åœ¨VSCODEä¸­è¿æ¥è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œä»£ç å¼€å‘ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨Jupyterã€‚</p></blockquote><p><ahref="https://zh.wikipedia.org/wiki/Visual_Studio_Code">VSCODE</a>(VisualStudioCode)æ˜¯ä¸€æ¬¾ç”±å¾®è½¯å¼€å‘ä¸”è·¨å¹³å°çš„å…è´¹æºä»£ç ç¼–è¾‘å™¨ã€‚å®ƒæ˜¯å¸¸ç”¨çš„è½¯ä»¶å¼€å‘IDEä¹‹ä¸€ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ã€‚ç¬”è€…åœ¨æ—¥å¸¸çš„Pythonå¼€å‘ä¸­ï¼Œä½¿ç”¨è¾ƒå¤šçš„IDEå·¥å…·æ˜¯PyCharmï¼Œè€ŒVSCODEçš„ä½¿ç”¨è¾ƒå°‘ã€‚</p><p>ç”±æ­¤ï¼Œç¬”è€…å¸Œæœ›å¯¹VSCODEçš„ç›¸å…³ä½¿ç”¨æŠ€å·§åšè®°å½•ä¸æ•´ç†ã€‚æœ¬æ–‡ä¸ºç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ã€‚</p><p>ä¸‹é¢ï¼Œç¬”è€…å°†ä¼šä»‹ç»VSCODEä¸­çš„ä¸¤ä¸ªä½¿ç”¨æŠ€å·§ï¼š</p><ul><li>è¿æ¥è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œä»£ç å¼€å‘</li><li>ä½¿ç”¨Jupyter</li></ul><h2 id="è¿æ¥è¿œç¨‹æœåŠ¡å™¨å¼€å‘">è¿æ¥è¿œç¨‹æœåŠ¡å™¨å¼€å‘</h2><p><strong>èƒŒæ™¯ä»‹ç»</strong>ï¼šå¯¹äºè¿æ¥è¿œç¨‹æœåŠ¡å™¨å¼€å‘ï¼ŒPyCharmçš„æ”¯æŒåº¦ä¹Ÿå¾ˆå°‘ï¼Œä½†éœ€è¦ä¸“ä¸šç‰ˆã€‚è€ŒVSCODEçš„è¯¥åŠŸèƒ½æ˜¯å…è´¹çš„ã€‚</p><p>1:VSCODEä¸­è¿æ¥è¿œç¨‹æœåŠ¡å™¨çš„æ’ä»¶ä¸º<code>Remote-SSH</code>ï¼Œæ‰¾åˆ°è¯¥æ’ä»¶è¿›è¡Œå®‰è£…ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://s2.loli.net/2023/10/17/hpPcJn5f3vauqFz.png"alt="å®‰è£…æ’ä»¶" /><figcaption aria-hidden="true">å®‰è£…æ’ä»¶</figcaption></figure><p>2:è¿œç¨‹æœåŠ¡å™¨çš„è¿æ¥é…ç½®ï¼šç‚¹å‡»å·¦ä¾§å·¥å…·æ ä¸­çš„â€œè¿œç¨‹èµ„æºç®¡ç†å™¨â€ï¼Œåœ¨SSHé€‰é¡¹ä¸­ç‚¹å‡»â€œ+â€ï¼Œåœ¨å¼¹çª—ä¸­è¾“å…¥ç™»å½•è¿œç¨‹æœåŠ¡å™¨çš„SSHå‘½ä»¤ä»¥åŠå¯†ç ï¼Œè¿™æ ·å°±å®Œæˆäº†è¿œç¨‹æœåŠ¡å™¨çš„è¿æ¥ã€‚</p><figure><img src="https://s2.loli.net/2023/10/17/5jONPkBH9XCK6ec.png"alt="è¿œç¨‹æœåŠ¡å™¨é…ç½®" /><figcaption aria-hidden="true">è¿œç¨‹æœåŠ¡å™¨é…ç½®</figcaption></figure><p>3:é€‰æ‹©è¿œç¨‹ç›®å½•ï¼šç‚¹å‡»å·¦ä¾§å·¥å…·æ ä¸­çš„â€œèµ„æºç®¡ç†å™¨â€ï¼Œé€‰æ‹©æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œè¾“å…¥éœ€è¦è¿æ¥çš„è¿œç¨‹ç›®å½•ï¼Œæ­¤æ—¶å¯èƒ½éœ€è¦å†æ¬¡è¾“å…¥å¯†ç ã€‚</p><figure><img src="https://s2.loli.net/2023/10/17/EdiP9CAQbhwO5Fv.png"alt="é€‰æ‹©è¿œç¨‹ç›®å½•" /><figcaption aria-hidden="true">é€‰æ‹©è¿œç¨‹ç›®å½•</figcaption></figure><p>4:å®‰è£…Pythonè§£é‡Šå™¨æ’ä»¶ï¼šåŒç¬¬1æ­¥ï¼ŒPythonè§£é‡Šå™¨æ’ä»¶é€‰æ‹©â€œPythonâ€ï¼Œå®Œæˆå®‰è£…ã€‚</p><figure><img src="https://s2.loli.net/2023/10/17/43R9YVLwJFZCov1.png"alt="Pythonè§£é‡Šå™¨æ’ä»¶" /><figcaption aria-hidden="true">Pythonè§£é‡Šå™¨æ’ä»¶</figcaption></figure><p>5: é€‰æ‹©Pythonè§£é‡Šå™¨ï¼šæŒ‰ä½ Shift + Ctrl +Pé”®ï¼Œåœ¨å¼¹çª—ä¸­è¾“å…¥Pythonï¼Œé€‰æ‹©Pythonè§£é‡Šå™¨ï¼Œå†é€‰æ‹©è¿œç¨‹æœåŠ¡å™¨ä¸­çš„Pythonè§£é‡Šå™¨è·¯å¾„å³å¯ï¼Œè¿™æ ·å°±èƒ½åœ¨VSCODEä¸­è¿æ¥è¿œç¨‹æœåŠ¡å™¨è¿›è¡ŒPythonä»£ç å¼€å‘äº†ã€‚</p><figure><img src="https://s2.loli.net/2023/10/17/xBSGqVyLJp4lhK1.png"alt="é€‰æ‹©Pythonè§£é‡Šå™¨" /><figcaption aria-hidden="true">é€‰æ‹©Pythonè§£é‡Šå™¨</figcaption></figure><h2 id="ä½¿ç”¨jupyter">ä½¿ç”¨Jupyter</h2><p><strong>èƒŒæ™¯ä»‹ç»</strong>ï¼šå¦‚æœè¿œç¨‹æœåŠ¡å™¨å·²å¼€æ”¾ç›¸å…³åº”ç”¨ç«¯å£ï¼Œåˆ™åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸­ç›´æ¥å¯åŠ¨Jupyterå³å¯ã€‚ä½†å¦‚æœè¿œç¨‹æœåŠ¡å™¨æ²¡æœ‰å¼€æ”¾ä»»ä½•åº”ç”¨ç«¯å£ï¼Œè€Œä½ åˆæƒ³ä»¥WEBé¡µé¢çš„å½¢å¼ä½¿ç”¨Jupyterï¼Œåˆ™éœ€è¦ä½¿ç”¨Jupyteræ’ä»¶ã€‚</p><p>1:åœ¨å·¦ä¾§çš„â€œæ‰©å±•â€ä¸­é€‰æ‹©<code>Jupyter</code>æ’ä»¶ï¼Œå®Œæˆå®‰è£…ï¼Œæ­¥éª¤åŒä¸Šè¿°ç¬¬1æ­¥ï¼›</p><p>2:è¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œæ­¥éª¤å‚è€ƒä¸Šè¿°<strong>è¿æ¥è¿œç¨‹æœåŠ¡å™¨å¼€å‘</strong>ï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>jupyter notebook</code>å¯åŠ¨Jupyterï¼›</p><p>3: æŒ‰ä½ Shift + Ctrl + Pé”®ï¼Œè¾“å…¥Jupyterï¼Œé€‰æ‹©â€œCreate: æ–°JupyterNotebookâ€ï¼Œåœ¨å³ä¾§ç‚¹å‡»â€œé€‰æ‹©å†…æ ¸â€ï¼Œåœ¨å¼¹çª—ä¸­é€‰æ‹©â€œç°æœ‰JupyteræœåŠ¡å™¨â€ï¼Œè¾“å…¥JupyteræœåŠ¡çš„ç½‘å€ï¼Œæ¯”å¦‚é»˜è®¤ç½‘å€ä¸ºhttp://localhost:8888ï¼Œå¦åŠ tokenï¼ˆå³å¯†ç ï¼‰ã€‚</p><figure><img src="https://s2.loli.net/2023/10/17/st6wPF4egDb2xUH.png"alt="vscode1_6.png" /><figcaption aria-hidden="true">vscode1_6.png</figcaption></figure><p>4: åœ¨æ–°çš„ipynbæ–‡ä»¶ä¸­å³å¯è¿›è¡ŒPythonä»£ç å¼€å‘ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº†ç¬”è€…åœ¨VSCODEçš„ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸¤ä¸ªæŠ€å·§ï¼Œåˆ†åˆ«ä¸ºè¿æ¥è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œä»£ç å¼€å‘ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨Jupyterã€‚</p><p>æœ¬æ–‡ä½œä¸ºVSCODEä½¿ç”¨æŠ€å·§çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œåç»­å°†æŒç»­æ›´æ–°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>VSCODE</tag>
      
      <tag>Jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåä¸ƒï¼‰æ–‡æœ¬è¡¥å…¨ä¸­çš„åŠ¨æ€æç¤ºï¼ˆDynamic-Promptingï¼‰</title>
    <link href="/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%B8%83%EF%BC%89%E6%96%87%E6%9C%AC%E8%A1%A5%E5%85%A8%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81%E6%8F%90%E7%A4%BA%EF%BC%88Dynamic-Prompting%EF%BC%89/"/>
    <url>/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%B8%83%EF%BC%89%E6%96%87%E6%9C%AC%E8%A1%A5%E5%85%A8%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81%E6%8F%90%E7%A4%BA%EF%BC%88Dynamic-Prompting%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•åœ¨å¤§æ¨¡å‹ä¸­å¯¹æ–‡æœ¬è¡¥å……ï¼ˆTextCompletionï¼‰è¿›è¡ŒåŠ¨æ€æç¤ºï¼ˆDynamic Promptingï¼‰ã€‚</p></blockquote><p>æœ¬æ–‡ä»¥æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ä¸ºä¾‹ï¼Œæ ·ä¾‹æ•°æ®é›†ä¸º<code>TREC</code>ï¼Œä½¿ç”¨å¤§æ¨¡å‹çš„æ–‡æœ¬è¡¥å…¨è¿›è¡Œç±»åˆ«é¢„æµ‹ï¼Œåˆ†åˆ«åœ¨Zero-Shot,Few-Shot, DynamicFew-Shotåœºæ™¯ä¸‹è¿›è¡Œæµ‹è¯•ï¼ŒéªŒè¯åŠ¨æ€æç¤ºå¯¹äºæå‡æ¨¡å‹è¡¨ç°çš„æœ‰æ•ˆæ€§ã€‚</p><h2 id="æ•°æ®é›†">æ•°æ®é›†</h2><p>Text REtrieval Conference (<ahref="https://huggingface.co/datasets/trec">TREC</a>) QuestionClassificationæ•°æ®é›†åŒ…å«è®­ç»ƒé›†ä¸­çš„çº¦5500ä¸ªæ ‡è®°é—®é¢˜å’Œæµ‹è¯•é›†ä¸­çš„å¦å¤– 500ä¸ªé—®é¢˜ã€‚</p><p>è¯¥æ•°æ®é›†æœ‰ 6 ä¸ªç²—ç±»æ ‡ç­¾å’Œ 50 ä¸ªç²¾ç»†ç±»æ ‡ç­¾ã€‚æ¯ä¸ªå¥å­çš„å¹³å‡é•¿åº¦ä¸º10ï¼Œè¯æ±‡é‡ä¸º8700ã€‚6 ä¸ªç²—ç±»æ ‡ç­¾ä¸º<strong>ABBR, ENTY,DESC, HUM, LOC, NUM</strong>.</p><p>è¯¥æ•°æ®é›†ä»å››ä¸ªæ¥æºæ”¶é›†ï¼šUSCå‘å¸ƒçš„4,500ä¸ªè‹±è¯­é—®é¢˜ï¼ˆHovy et al.,2001ï¼‰ã€é’ˆå¯¹å°‘æ•°ç¨€æœ‰ç±»åˆ«çš„å¤§çº¦500ä¸ªæ‰‹åŠ¨æ„å»ºçš„é—®é¢˜ã€894ä¸ª TREC 8 å’Œ TREC9 é—®é¢˜ï¼Œä»¥åŠæ¥è‡ª TREC 10 çš„500ä¸ªé—®é¢˜ä½œä¸ºæµ‹è¯•é›†ã€‚è¿™äº›é—®é¢˜æ˜¯æ‰‹åŠ¨æ ‡è®°çš„ã€‚</p><p>è¯¥æ•°æ®é›†çš„HuggingFaceç½‘å€ä¸º: <ahref="https://huggingface.co/datasets/trec">https://huggingface.co/datasets/trec</a>ï¼Œä½¿ç”¨<code>datasets</code>æ¨¡å—åŠ è½½ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report<br><br>dataset = load_dataset(<span class="hljs-string">&quot;trec&quot;</span>)<br><br>dataset<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">DatasetDict(<span class="hljs-punctuation">&#123;</span><br>    train<span class="hljs-punctuation">:</span> Dataset(<span class="hljs-punctuation">&#123;</span><br>        features<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>&#x27;text&#x27;<span class="hljs-punctuation">,</span> &#x27;coarse_label&#x27;<span class="hljs-punctuation">,</span> &#x27;fine_label&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        num_rows<span class="hljs-punctuation">:</span> <span class="hljs-number">5452</span><br>    <span class="hljs-punctuation">&#125;</span>)<br>    test<span class="hljs-punctuation">:</span> Dataset(<span class="hljs-punctuation">&#123;</span><br>        features<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>&#x27;text&#x27;<span class="hljs-punctuation">,</span> &#x27;coarse_label&#x27;<span class="hljs-punctuation">,</span> &#x27;fine_label&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        num_rows<span class="hljs-punctuation">:</span> <span class="hljs-number">500</span><br>    <span class="hljs-punctuation">&#125;</span>)<br><span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­testæ•°æ®é›†çš„ç¬¬ä¸€æ¡æ•°æ®ä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>&#x27;text&#x27;<span class="hljs-punctuation">:</span> &#x27;How far is it from Denver to Aspen ?&#x27;<span class="hljs-punctuation">,</span><br> &#x27;coarse_label&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br> &#x27;fine_label&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># name of the text and label column</span><br>label_type = <span class="hljs-string">&#x27;coarse_label&#x27;</span><br>text_key = <span class="hljs-string">&quot;text&quot;</span><br><span class="hljs-comment"># create mapping of ids2class and class2id</span><br>id2class = <span class="hljs-built_in">dict</span>((i, label) <span class="hljs-keyword">for</span> i, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(dataset[<span class="hljs-string">&#x27;train&#x27;</span>].features[label_type].names))<br>class2id = <span class="hljs-built_in">dict</span>((label, i) <span class="hljs-keyword">for</span> i, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(dataset[<span class="hljs-string">&#x27;train&#x27;</span>].features[label_type].names))<br><span class="hljs-comment"># create a dictionary with classes as key and containing all the training examples within that class</span><br>class2TrainDataset = <span class="hljs-built_in">dict</span>((label, []) <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> dataset[<span class="hljs-string">&#x27;train&#x27;</span>].features[label_type].names)<br><span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> dataset[<span class="hljs-string">&#x27;train&#x27;</span>]:<br>    label = id2class[example[label_type]]<br>    class2TrainDataset[label].append(example[text_key])<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œid2classå’Œclass2idåˆ†åˆ«ä¸ºidä¸ç±»åˆ«å¯¹åº”è¡¨ã€ç±»å‹ä¸idå¯¹åº”è¡¨ï¼Œclass2TrainDatasetä¸ºæ¯ä¸ªç±»åˆ«ä¸­çš„è®­ç»ƒæ•°æ®é›†ã€‚</p><h2 id="zero-shot">Zero-Shot</h2><p>æ„å»ºZero-Shotçš„promptï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># a prompt for asking LLM to perform a task</span><br>task_prompt = <span class="hljs-string">&quot;As a Question Answering agent, your goal is to categorize questions into different semantic classes that impose constraints on potential answers, so that they can be utilized in later stages of the question answering process.\nFollowing are the semantic classes: [&quot;</span><br>task_prompt += <span class="hljs-string">&quot;, &quot;</span>.join([label <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> class2TrainDataset]) + <span class="hljs-string">&quot;]&quot;</span><br><span class="hljs-comment"># a prompt for asking LLM to generate the output for current task</span><br>query_prompt = <span class="hljs-string">&quot;\nClassify the following question into one of the above classes. Please answer in a single word.\nquestion: &quot;</span><br>answer_prompt = <span class="hljs-string">&quot;\noutput: &quot;</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œtestæ•°æ®é›†çš„ç¬¬ä¸€æ¡çš„Zero-Shot promptä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">zeroshot_prompt = task_prompt +  query_prompt + dataset[<span class="hljs-string">&#x27;test&#x27;</span>][<span class="hljs-number">0</span>][text_key] + answer_prompt<br><span class="hljs-meta">&gt;&gt;&gt; </span>zeroshot_prompt<br><br>As a Question Answering agent, your goal <span class="hljs-keyword">is</span> to categorize questions into different semantic classes that impose constraints on potential answers, so that they can be utilized <span class="hljs-keyword">in</span> later stages of the question answering process.<br>Following are the semantic classes: [ABBR, ENTY, DESC, HUM, LOC, NUM]<br>Classify the following question into one of the above classes. Please answer <span class="hljs-keyword">in</span> a single word.<br>question: How far <span class="hljs-keyword">is</span> it <span class="hljs-keyword">from</span> Denver to Aspen ?<br>output:<br></code></pre></td></tr></table></figure><p>è°ƒç”¨openaiçš„å¤§æ¨¡å‹è¿›è¡Œå›å¤ï¼Œè°ƒç”¨å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python">openai.api_key = <span class="hljs-string">&quot;sk-xxx&quot;</span><br>model_name = <span class="hljs-string">&quot;gpt-3.5-turbo-instruct&quot;</span><br><br><span class="hljs-keyword">import</span> tiktoken<br>enc = tiktoken.encoding_for_model(model_name)<br>log_bias_dict = &#123;&#125;<br><span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> dataset[<span class="hljs-string">&#x27;train&#x27;</span>].features[<span class="hljs-string">&quot;coarse_label&quot;</span>].names:<br>    <span class="hljs-keyword">for</span> token_id <span class="hljs-keyword">in</span> enc.encode(label):<br>      log_bias_dict[token_id] = <span class="hljs-number">5</span><br>      <br><span class="hljs-comment"># Text completion using GPT</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">trim_text</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">return</span> text.strip().strip(<span class="hljs-string">&#x27;\n&#x27;</span>).strip(<span class="hljs-string">&#x27;\\n&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_using_gpt</span>(<span class="hljs-params">prompt</span>):<br>    generated_sentence = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># Create a completion for the provided prompt and parameters</span><br>        response = openai.Completion.create(<br>            model=model_name,<br>            prompt=prompt, <br>            max_tokens=<span class="hljs-number">3</span>,<br>            temperature=<span class="hljs-number">0</span>,<br>            top_p=<span class="hljs-number">1</span>,<br>            stop=<span class="hljs-literal">None</span>,<br>            frequency_penalty=<span class="hljs-number">0</span>,<br>            presence_penalty=<span class="hljs-number">0.0</span>,<br>            logit_bias=log_bias_dict<br>        )<br>        <br>        choices = response.get(<span class="hljs-string">&quot;choices&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(choices) == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;text&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> choices[<span class="hljs-number">0</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Text not generated properly&quot;</span>)<br>        generated_sentence = choices[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;text&#x27;</span>].lstrip(<span class="hljs-string">&#x27;\\n&#x27;</span>).rstrip(<span class="hljs-string">&#x27;\\n&#x27;</span>).lstrip(<span class="hljs-string">&#x27;\n\n&#x27;</span>).rstrip(<span class="hljs-string">&#x27;\n\n&#x27;</span>).lstrip(<span class="hljs-string">&#x27;\n&#x27;</span>).rstrip(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        <br>    <span class="hljs-keyword">except</span> openai.error.APIError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># Handle API error here, e.g. retry or log</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;OpenAI API returned an API Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> openai.error.AuthenticationError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># Handle Authentication error here, e.g. invalid API key</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;OpenAI API returned an Authentication Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> openai.error.APIConnectionError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># Handle connection error here</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Failed to connect to OpenAI API: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> openai.error.InvalidRequestError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># Handle connection error here</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Invalid Request Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <br>    <span class="hljs-keyword">except</span> openai.error.RateLimitError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># Handle rate limit error</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;OpenAI API request exceeded rate limit: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> openai.error.ServiceUnavailableError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># Handle Service Unavailable error</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Service Unavailable: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> openai.error.Timeout <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># Handle request timeout</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Request timed out: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> generated_sentence<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ¨¡å‹ä¸º<code>gpt-3.5-turbo-instruct</code>,max_tokensä¸º3ã€‚ä¸ºäº†ä¿è¯è¾“å‡ºtokenä¸ºæ•°æ®é›†ä¸­çš„ç²—ç±»ç±»åˆ«ï¼Œä½¿ç”¨tiktokenå¾—åˆ°è¿™äº›ç²—ç±»ç±»åˆ«çš„tokenidï¼Œé‡‡ç”¨logit_biaså¯¹è¿™äº›token idçš„è¾“å‡ºè¿›è¡ŒåŠ å¼ºã€‚</p><p>å¯¹testæ•°æ®é›†ç¬¬ä¸€æ¡æ•°æ®è¿›è¡Œæµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>generate_using_gpt(zeroshot_prompt)<br><br><span class="hljs-string">&#x27;LOC&#x27;</span><br></code></pre></td></tr></table></figure><p>å¯¹å…¨é‡testæ•°æ®é›†ä½¿ç”¨Zero-Shot Promptï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># prompt without any examples from the training dataset</span><br>labels = []<br>predictions = []<br><span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> dataset[<span class="hljs-string">&#x27;test&#x27;</span>]:<br>    zeroshot_prompt = task_prompt +  query_prompt + example[text_key] + answer_prompt<br>    pred = generate_using_gpt(zeroshot_prompt)<br>    pred=trim_text(pred)<br>    labels.append(example[label_type])<br>    <span class="hljs-keyword">if</span> pred <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> class2id:<br>        predictions.append(-<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        predictions.append(class2id[pred])<br>        <br>report = classification_report(labels, predictions, digits=<span class="hljs-number">4</span>) <br></code></pre></td></tr></table></figure><p>è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">              precision    recall  f1-score   support<br><br>           0     0.6364    0.7778    0.7000         9<br>           1     0.4432    0.4149    0.4286        94<br>           2     0.7154    0.6377    0.6743       138<br>           3     0.9455    0.8000    0.8667        65<br>           4     0.8222    0.9136    0.8655        81<br>           5     0.8195    0.9646    0.8862       113<br><br>    accuracy                         0.7380       500<br>   macro avg     0.7304    0.7514    0.7369       500<br>weighted avg     0.7336    0.7380    0.7324       500<br></code></pre></td></tr></table></figure><p>weighted avg F1å€¼ä¸º<code>0.7324</code>.</p><h2 id="few-shot">Few-Shot</h2><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨Few-Shotå¯¹promptè¿›è¡ŒåŠ å¼ºï¼Œæ–¹æ³•ä¸ºä»æ¯ä¸ªç±»åˆ«çš„trainæ•°æ®é›†ä¸­æå–ç¬¬ä¸€æ¡æ ·æœ¬ä½œä¸ºFew-Shotï¼Œå³<code>In-Context Learning</code>(ICL),ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># function to selection few examples in each of the classes from the training dataset</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generateFewshotPrompt</span>(<span class="hljs-params">class2TrainDataset, N=<span class="hljs-number">3</span></span>):<br>    fewshot_prompt = <span class="hljs-string">&quot;\nFollowing are some examples.&quot;</span><br>    <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> class2TrainDataset:<br>        <span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> class2TrainDataset[label][:N]:<br>            fewshot_prompt += <span class="hljs-string">&quot;\nquestion: &quot;</span> + example<br>            fewshot_prompt += <span class="hljs-string">&quot;\noutput: &quot;</span> + label<br>    <span class="hljs-keyword">return</span> fewshot_prompt<br>    <br><span class="hljs-comment"># prompt with one example in each of the classes</span><br>fewshot_examples = generateFewshotPrompt(class2TrainDataset, N=<span class="hljs-number">1</span>)<br>fewshot_prompt = task_prompt +  fewshot_examples + query_prompt + dataset[<span class="hljs-string">&#x27;test&#x27;</span>][<span class="hljs-number">0</span>][text_key] + answer_prompt<br><span class="hljs-meta">&gt;&gt;&gt; </span>fewshot_prompt<br></code></pre></td></tr></table></figure><p>testæ•°æ®é›†çš„ç¬¬ä¸€æ¡æ•°æ®çš„Few-Shot promptå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">As a Question Answering agent, your goal is to categorize questions into different semantic classes that impose constraints on potential answers, so that they can be utilized <span class="hljs-keyword">in</span> later stages of the question answering process.<br>Following are the semantic classes: [ABBR, ENTY, DESC, HUM, LOC, NUM]<br>Following are some examples.<br>question: What is the full form of .com ?<br>output: ABBR<br>question: What films featured the character Popeye Doyle ?<br>output: ENTY<br>question: How did serfdom develop <span class="hljs-keyword">in</span> and <span class="hljs-keyword">then</span> leave Russia ?<br>output: DESC<br>question: What contemptible scoundrel stole the cork from my lunch ?<br>output: HUM<br>question: What sprawling U.S. state boasts the most airports ?<br>output: LOC<br>question: When was Ozzy Osbourne born ?<br>output: NUM<br>Classify the following question into one of the above classes. Please answer <span class="hljs-keyword">in</span> a single word.<br>question: How far is it from Denver to Aspen ?<br>output:<br></code></pre></td></tr></table></figure><p>åŸºäºFew-Shot promptï¼Œå¯¹å…¨é‡testæ•°æ®é›†è¿›è¡Œè¯„ä¼°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># prompt is created by adding one example in each of the classes </span><br>labels = []<br>predictions = []<br><span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> dataset[<span class="hljs-string">&#x27;test&#x27;</span>]:<br>    fewshot_prompt = task_prompt + fewshot_examples + query_prompt + example[text_key] + answer_prompt<br>    pred = generate_using_gpt(fewshot_prompt)<br>    pred=trim_text(pred)<br>    labels.append(example[label_type])<br>    <span class="hljs-keyword">if</span> pred <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> class2id:<br>        predictions.append(-<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        predictions.append(class2id[pred])<br>        <br>report = classification_report(labels, predictions, digits=<span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><p>è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">              precision    recall  f1-score   support<br><br>           0     0.8182    1.0000    0.9000         9<br>           1     0.5217    0.5106    0.5161        94<br>           2     0.7727    0.7391    0.7556       138<br>           3     1.0000    0.8462    0.9167        65<br>           4     0.8021    0.9506    0.8701        81<br>           5     0.9474    0.9558    0.9515       113<br><br>    accuracy                         0.7980       500<br>   macro avg     0.8103    0.8337    0.8183       500<br>weighted avg     0.8001    0.7980    0.7969       500<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œweighted avg F1å€¼ä¸º<code>0.7969</code>.</p><h2 id="dynamic-few-shot">Dynamic Few-Shot</h2><p>ä¸Šé¢Few-Shot promptçš„æ•ˆæœå·²ç»æ¯”Zero-Shotpromptå¥½å¾ˆå¤šäº†ï¼Œè¿˜æœ‰æå‡ç©ºé—´å—ï¼Ÿ</p><p>å¯¹äºFew-Shotçš„æ ·æœ¬ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥è¿›è¡Œé€‰æ‹©ï¼Œä½¿å¾—è¯„ä¼°æ ·æœ¬ä¸Few-Shotæ ·æœ¬æ¥å¯èƒ½ç›¸è¿‘ã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†DynamicFew-Shotï¼Œåœ¨æ¯æ¬¡è¯„ä¼°æµ‹è¯•æ ·æœ¬æ—¶ï¼Œåœ¨è®­ç»ƒé›†çš„æ¯ä¸ªç±»åˆ«ä¸­é€‰æ‹©ä¸å…¶è¯­ä¹‰ç›¸ä¼¼åº¦æœ€é«˜çš„kï¼ˆæœ¬æ–‡å–k=1ï¼‰ä¸ªæ ·æœ¬ã€‚</p><p>è€ƒè™‘åˆ°æ–‡æœ¬çš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—çš„åŸºç¡€æ¨¡å‹ï¼Œä¸€èˆ¬ä¸ºæ–‡æœ¬åµŒå…¥ï¼ˆTextEmbeddingï¼‰æ¨¡å‹ï¼Œæœ¬æ–‡é€‰æ‹©<code>all-mpnet-base-v2</code>ï¼Œä½¿ç”¨<code>sentence_transformers</code>è¿›è¡Œæ–‡æœ¬åµŒå…¥ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer, util<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> cuda<br>device = <span class="hljs-string">&#x27;cuda&#x27;</span> <span class="hljs-keyword">if</span> cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;cpu&#x27;</span><br><br><span class="hljs-comment"># loading Sentence Transformer based model</span><br>model = SentenceTransformer(<span class="hljs-string">&#x27;all-mpnet-base-v2&#x27;</span>, device=device)<br><br><span class="hljs-comment"># extract embeddings for a set of examples</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ExtractEmbeddings</span>(<span class="hljs-params">examples</span>):<br>    embedding_ls = []<br>    <span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> examples:<br>        embedding = model.encode(example)     <br>        embedding_ls.append(embedding)<br>    <span class="hljs-keyword">return</span> embedding_ls<br><br><span class="hljs-comment"># extract embeddings for all the training examples</span><br>class2TrainDatasetWithEmbedding = &#123;&#125;<br><span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> class2TrainDataset:<br>    embeddings = ExtractEmbeddings(class2TrainDataset[label])<br>    class2TrainDatasetWithEmbedding[label] = [class2TrainDataset[label], embeddings]<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>sentence_transformers</code>åŠ è½½<code>all-mpnet-base-v2</code>æ¨¡å‹ï¼Œå¹¶å¯¹æ¯ä¸ªç±»åˆ«çš„è®­ç»ƒé›†æ•°æ®è¿›è¡Œæ–‡æœ¬åµŒå…¥ï¼Œè·å–å®ƒä»¬çš„è¯å‘é‡ï¼Œå‚¨å­˜åœ¨å†…å­˜ä¸­ã€‚</p><p>æ¥ç€ï¼Œé’ˆå¯¹æ¯æ¡è¯„ä¼°æµ‹è¯•æ ·æœ¬ï¼Œé€‰æ‹©æ¯ä¸ªç±»åˆ«ä¸­ä¸å…¶è¯­ä¹‰ç›¸ä¼¼åº¦æœ€é«˜çš„1æ¡æ ·æœ¬ï¼Œå½¢æˆDynamicFew-Shot promptï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># extract similar queries for a given input text from each of the classes</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getSimilarExamples</span>(<span class="hljs-params">input_text, dataset, dataset_embedding</span>):<br>    input_embedding = model.encode(input_text)<br>    sim_score = util.dot_score(input_embedding, dataset_embedding)[<span class="hljs-number">0</span>]<br>    topN_ids = np.argsort(-sim_score)<br>    <span class="hljs-keyword">return</span> [dataset[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> topN_ids]<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getClasswiseSimilarExamples</span>(<span class="hljs-params">input_text, class2TrainDatasetWithEmbedding</span>):<br>    classwiseSimilarExamples = &#123;&#125;<br>    <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> class2TrainDataset:<br>        similarExamples = getSimilarExamples(input_text, class2TrainDatasetWithEmbedding[label][<span class="hljs-number">0</span>], class2TrainDatasetWithEmbedding[label][<span class="hljs-number">1</span>])<br>        classwiseSimilarExamples[label] = similarExamples<br>    <span class="hljs-keyword">return</span> classwiseSimilarExamples<br>    <br><span class="hljs-comment"># generate a prompt with similar examples in each of the classes</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generateDynamicPrompt</span>(<span class="hljs-params">input_text, class2TrainDatasetWithEmbedding, N=<span class="hljs-number">3</span></span>):<br>    classwiseSimilarExamples = getClasswiseSimilarExamples(input_text, class2TrainDatasetWithEmbedding)<br>    dynamic_prompt = <span class="hljs-string">&quot;\nFollowing are some examples.&quot;</span><br>    <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> classwiseSimilarExamples:<br>        <span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> classwiseSimilarExamples[label][:N]:<br>            dynamic_prompt += <span class="hljs-string">&quot;\nquestion: &quot;</span> + example<br>            dynamic_prompt += <span class="hljs-string">&quot;\noutput: &quot;</span> + label<br>    <span class="hljs-keyword">return</span> dynamic_prompt<br>    <br><span class="hljs-comment"># dynamic prompt with one similar example in each of the classes</span><br>fewshot_examples = generateDynamicPrompt(dataset[<span class="hljs-string">&#x27;test&#x27;</span>][<span class="hljs-number">0</span>][text_key], class2TrainDatasetWithEmbedding, N=<span class="hljs-number">1</span>)<br>dynamic_prompt = task_prompt + fewshot_examples + query_prompt + dataset[<span class="hljs-string">&#x27;test&#x27;</span>][<span class="hljs-number">0</span>][text_key] + answer_prompt<br><span class="hljs-meta">&gt;&gt;&gt; </span>dynamic_prompt<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œtestæ•°æ®é›†ä¸­çš„ç¬¬ä¸€æ¡æ ·æœ¬çš„Dynamic Few-Shot promptä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">As a Question Answering agent, your goal is to categorize questions into different semantic classes that impose constraints on potential answers, so that they can be utilized <span class="hljs-keyword">in</span> later stages of the question answering process.<br>Following are the semantic classes: [ABBR, ENTY, DESC, HUM, LOC, NUM]<br>Following are some examples.<br>question: What <span class="hljs-keyword">do</span> the letters D.C. stand <span class="hljs-keyword">for</span> <span class="hljs-keyword">in</span> Washington , D.C. ?<br>output: ABBR<br>question: What race is 1 , 137 miles long ?<br>output: ENTY<br>question: Why is the mile 528 feet ?<br>output: DESC<br>question: Who lives at 39 Stone Canyon Way ?<br>output: HUM<br>question: What Colorado city owns its own glacier ?<br>output: LOC<br>question: How high is the city of Denver ?<br>output: NUM<br>Classify the following question into one of the above classes. Please answer <span class="hljs-keyword">in</span> a single word.<br>question: How far is it from Denver to Aspen ?<br>output:<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„Dynamic Few-Shot promptä¸­çš„æ ·æœ¬æ˜æ˜¾æ¯”Few-Shotpromptä¸­çš„æ ·æœ¬æ›´å¥½ã€‚</p><p>æ­¤æ—¶ï¼Œå†å¯¹å…¨é‡testæ•°æ®é›†è¿›è¡Œè¯„ä¼°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">labels = []<br>predictions = []<br><span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> dataset[<span class="hljs-string">&#x27;test&#x27;</span>]:<br>    fewshot_examples = generateDynamicPrompt(example[text_key], class2TrainDatasetWithEmbedding, N=<span class="hljs-number">1</span>)<br>    dynamic_prompt = task_prompt + fewshot_examples + query_prompt + example[text_key] + answer_prompt<br>    pred = generate_using_gpt(dynamic_prompt)<br>    pred=trim_text(pred)<br>    labels.append(example[label_type])<br>    <span class="hljs-keyword">if</span> pred <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> class2id:<br>        predictions.append(-<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        predictions.append(class2id[pred])<br>        <br>report = classification_report(labels, predictions, digits=<span class="hljs-number">4</span>) <br></code></pre></td></tr></table></figure><p>è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">              precision    recall  f1-score   support<br><br>           0     1.0000    0.7778    0.8750         9<br>           1     0.7083    0.7234    0.7158        94<br>           2     0.8615    0.8116    0.8358       138<br>           3     0.9508    0.8923    0.9206        65<br>           4     0.8824    0.9259    0.9036        81<br>           5     0.8926    0.9558    0.9231       113<br><br>    accuracy                         0.8560       500<br>   macro avg     0.8826    0.8478    0.8623       500<br>weighted avg     0.8572    0.8560    0.8557       500<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆå¾—åˆ°çš„weighted avg F1å€¼ä¸º<code>0.8557</code>.</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>å¯¹ä¸Šè¿°çš„å†…å®¹è¿›è¡Œæ€»ç»“ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>gpt-3.5-turbo-instruct</code>å¯¹<code>TREC</code>çš„ä¸­testæ•°æ®é›†ï¼Œåˆ†åˆ«å°±Zero-Shot,Few-Shot, Dynamic Few-Shotæƒ…å½¢è¿›è¡Œè¯„ä¼°ï¼Œå¾—åˆ°çš„è¯„ä¼°æŒ‡æ ‡ä¸ºï¼š</p><table><thead><tr class="header"><th>prompt</th><th>weighted avg F1</th></tr></thead><tbody><tr class="odd"><td>Zero-Shot</td><td>0.7324</td></tr><tr class="even"><td>Few-Shot</td><td>0.7969</td></tr><tr class="odd"><td>Dynamic Few-Shot</td><td>0.8557</td></tr></tbody></table><p>æ˜¾ç„¶ï¼ŒDynamic Few-Shot promptçš„æ•ˆæœæ˜¯æœ€å¥½çš„ï¼Œæ¯”Zero-Shotpromptçš„æŒ‡æ ‡é«˜äº†12%å¤šï¼Œè€Œè¿™è¿˜æ˜¯æ²¡æœ‰å¯¹æ¨¡å‹è¿›è¡Œä»»ä½•å¾®è°ƒçš„ç»“æœï¼</p><p>åœ¨å¹³æ—¶å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨Dynamic Few-Shot promptã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2><ol type="1"><li>Basic_Samples/Completions/completions_with_dynamic_prompt.ipynb: <ahref="https://github.com/Azure-Samples/openai/blob/main/Basic_Samples/Completions/completions_with_dynamic_prompt.ipynb">https://github.com/Azure-Samples/openai/blob/main/Basic_Samples/Completions/completions_with_dynamic_prompt.ipynb</a></li><li>TREC dataset: <ahref="https://huggingface.co/datasets/trec">https://huggingface.co/datasets/trec</a></li></ol><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LLM</tag>
      
      <tag>Dynamic Few Shot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåå…­ï¼‰ä½¿ç”¨å¤§æ¨¡å‹å®Œæˆå¡«å­—æ¸¸æˆ</title>
    <link href="/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%8C%E6%88%90%E5%A1%AB%E5%AD%97%E6%B8%B8%E6%88%8F/"/>
    <url>/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%8C%E6%88%90%E5%A1%AB%E5%AD%97%E6%B8%B8%E6%88%8F/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><center><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></center><blockquote><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨å¤§æ¨¡å‹æ¥å®Œæˆæ±‰å­—å¡«å­—æ¸¸æˆã€‚</p></blockquote><p>è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨å¤§æ¨¡å‹æ¥åšä¸€ä»¶é…·é…·çš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯ç”¨å®ƒæ¥å®Œæˆæ±‰å­—å¡«å­—æ¸¸æˆï¼ˆwordpuzzleï¼‰ã€‚</p><h2 id="å¡«å­—æ¸¸æˆ">å¡«å­—æ¸¸æˆ</h2><blockquote><p>å¡«å­—æ¸¸æˆä¸€èˆ¬åœ¨å›½å¤–è¾ƒå—æ¬¢è¿ã€‚<ahref="https://zh.wikipedia.org/zh-hans/%E5%A1%AB%E5%AD%97%E6%B8%B8%E6%88%8F">å¡«å­—æ¸¸æˆ</a>ä¸€èˆ¬ç»™å‡ºä¸€ä¸ªçŸ©å½¢çš„è¡¨æ ¼ã€‚è¿™ä¸ªè¡¨æ ¼è¢«åˆ†å‰²ä¸ºè‹¥å¹²ä¸ªå¤§å°ç›¸åŒçš„æ–¹æ ¼ï¼Œæ–¹æ ¼çš„é¢œè‰²æœ‰ç™½è‰²ä¸é»‘è‰²ä¸¤ç§ã€‚ç™½è‰²çš„æ–¹æ ¼ç»„æˆä¸€äº›äº¤å‰çš„è¡Œä¸åˆ—ï¼Œè¡Œåˆ—çš„é•¿åº¦ä¸ç­‰ã€‚ç©å®¶æ ¹æ®é¢˜ç›®æ‰€æä¾›çš„æœ‰å…³ä¿¡æ¯ï¼Œå°†ç­”æ¡ˆå¡«å…¥è¿™äº›è¡Œä¸åˆ—ä¹‹ä¸­ï¼Œæ¯ä¸ªç™½è‰²æ–¹æ ¼ä¸­åªèƒ½å¡«å…¥ä¸€ä¸ªå­—ã€‚</p></blockquote><p>ç¬”è€…åœ¨å…¬äº¤ä¸Šæ‰“å¼€æ¾æ¹ƒæ–°é—»Appï¼Œé‡Œé¢æœ‰"æ¾æ¹ƒå¡«å­—"æ¸¸æˆï¼Œæœ¬æ¬¡æ¸¸æˆçš„ç•Œé¢å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2023/10/11/6hVd15jlpNKfRsx.jpg"alt="æ¾æ¹ƒå¡«å­—æ¸¸æˆ" /><figcaption aria-hidden="true">æ¾æ¹ƒå¡«å­—æ¸¸æˆ</figcaption></figure><p>æ¸¸æˆä¸­çš„é¢˜ç›®å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs csv">1. ææ¸…ç…§çš„è¯ã€Šä¸€å‰ªæ¢…Â·çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹ã€‹ä¸­â€œä¸€ç§ç›¸æ€ï¼Œä¸¤å¤„é—²æ„â€çš„ä¸Šä¸€å¥,7<br>2. å°åº¦æ´‹çš„ä¸€ä¸ªå²›å›½ï¼Œé¦–éƒ½ç§‘ä¼¦å¡,4<br>3. ä¸€ç§ä¼å½¢è£…å¤‡ï¼Œç”¨äºä»é£æœºä¸Šç©ºå¤´äººå‘˜æˆ–ç‰©è´¨ç­‰,3<br>4. è‹è½¼çš„è¯ã€Šå¿µå¥´å¨‡Â·èµ¤å£æ€€å¤ã€‹ä¸­â€œæµªæ·˜å°½ï¼Œåƒå¤é£æµäººç‰©â€çš„ä¸Šä¸€å¥,4<br>5. ä¸€ç§å¯ä»¥ç”¨ä½œå® ç‰©é¥²å…»çš„å¯çˆ±é¸­å­ï¼Œå³Call duck,3<br>6. ä¸­å›½æœ€æ—©çš„å‡ºç‰ˆç¤¾ä¹‹ä¸€ï¼Œ1912å¹´1æœˆ1æ—¥æˆç«‹äºä¸Šæµ·,4<br>7. æ¨ªè·¨æ¬§äºšä¸¤æ´²çš„ä¸€ä¸ªå›½å®¶ï¼Œé¦–éƒ½æ˜¯å®‰å¡æ‹‰,3<br>8. ä¸­å›½çš„ä¸€ä¸ªçŸ¥åéŸ³ä¹èŠ‚ï¼Œä»Šæ—¥å› åœ¨å—é˜³æˆâ€œéŸ³ä¹åŠ«â€å¼•å‘å…³æ³¨,5<br>9. ä¸­å›½æœ€å¤§çš„å†…é™†å’¸æ°´æ¹–ï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæµ·æ‹”æœ€é«˜çš„æ¹–æ³Šä¹‹ä¸€,3<br>10. ä¸­å›½å¤ä»£å››å¤§å‘æ˜ä¹‹ä¸€ï¼Œè”¡ä¼¦æ˜¯å…¶å‘æ˜è€…,3<br><br>ä¸€ã€æ›¾è®©ç‰›é¡¿ç—´è¿·çš„ä¸­ä¸–çºªç‚¼é‡‘æœ¯ä¸­ï¼Œâ€œç¥åœ£ä¸‰å…ƒç´ â€åŒ…æ‹¬ç¡«ç£ºã€ç›å’Œå“ªç§ç‰©è´¨ï¼Ÿ,2<br>äºŒã€â€œè¿ªå£«å°¼å…¬ä¸»â€å¤§å®¶åº­ä¸­ï¼Œå”¯ä¸€è®¾å®šæ²¡æœ‰çš‡å®¤è¡€ç»Ÿæˆ–èº«ä»½çš„å…¬ä¸»å½¢è±¡æ˜¯è°ï¼Ÿ,3<br>ä¸‰ã€ä¸€ç§å……æ»¡å¤æ‚é€šé“çš„å»ºç­‘ç‰©ï¼Œå¾ˆéš¾æ‰¾åˆ°æ­£ç¡®çš„é€šè¡Œé“è·¯,3<br>å››ã€æ±‰ä»£è”¡é‚•ç”¨æŸ¯äº­ç«¹æ‰€åˆ¶çš„è‘—åç¬›å­ï¼Œåæ³›æŒ‡ç¾ç¬›,3<br>äº”ã€æˆè¯­ï¼Œå–œæ¬¢åšæŸäº‹ï¼Œå¹¶åœ¨å…¶ä¸­è·å¾—ä¹è¶£,4<br>å…­ã€ä¸Šæµ·çš„ä¸€æ‰€çŸ¥åè´¢ç»ç±»é«˜æ ¡ï¼Œæ ¡è®­æ˜¯â€œåšå¾·åšå­¦ï¼Œç»æµåŒ¡æ—¶â€,4<br>ä¸ƒã€æ¸…æœæ´‹åŠ¡è¿åŠ¨ä¸­æˆç«‹çš„è¿‘ä»£å†›äº‹å·¥ä¸šç”Ÿäº§æœºæ„ï¼Œä¹Ÿæ˜¯è¿‘ä»£ä¸­å›½æœ€å¤§çš„å†›ç«å·¥å‚,5<br>å…«ã€æç…œçš„è¯ã€Šæµªæ·˜æ²™ã€‹ä¸­â€œå¤©ä¸Šäººé—´â€çš„ä¸Šä¸€å¥,7<br>ä¹ã€ä»Šæ—¥â€œå·´ä»¥å†²çªâ€å†èµ·ï¼Œå…¶ä¸­â€œå·´â€æ˜¯æŒ‡é‚£ä¸ªå›½å®¶,4<br>åã€å­¦æœ¯ä¸Šç”¨æ¥è¡¨ç¤ºç‰¹æ®Šæ„ä¹‰çš„ä¸“é—¨ç”¨è¯­,2<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œé˜¿æ‹‰ä¼¯æ•°å­—å¼€å¤´çš„æ˜¯ç«–æ’ï¼Œæ±‰å­—æ•°å­—å¼€å¤´çš„ä»£è¡¨æ¨ªæ’ï¼Œæœ€åçš„æ•°å­—ä»£è¡¨ç­”æ¡ˆçš„å­—æ•°ã€‚</p><p>æ—¢ç„¶å¤§æ¨¡å‹çš„èƒ½åŠ›å¾ˆå¥½å¾ˆå¼ºå¤§ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸å°è¯•ç”¨LLMæ¥å®Œæˆå¡«å­—æ¸¸æˆå‘¢ï¼Ÿ</p><p>Let's go!</p><h2 id="ç¨‹åº">ç¨‹åº</h2><p>é¦–å…ˆå…ˆä»‹ç»ä¸‹ç¬”è€…çš„è§£å†³æ€è·¯ã€‚</p><ol type="1"><li>éœ€è¦è°ƒç”¨æœç´¢å¼•æ“ã€‚ä¸€æ˜¯å› ä¸ºé¢˜ç›®ä¸­åŒ…å«æœ€è¿‘çš„æ—¶äº‹æ–°é—»ï¼ŒäºŒæ˜¯å› ä¸ºChatGPTå¯¹äºæ±‰è¯­ï¼Œå°¤å…¶æ˜¯è¯—è¯çš„ç†è§£èƒ½åŠ›è¾ƒå¼±ï¼Œä¸‰æ˜¯å› ä¸ºæœ‰äº†æœç´¢å¼•æ“ï¼Œæ‰ä½¿å›å¤æ›´å¥½æ›´å®Œå–„ï¼Œå¹¶ç»™å‡ºç­”æ¡ˆè§£é‡Šï¼Œç±»ä¼¼ä¸perplexity.ai</li><li>å†™ä¸€ä¸ªåˆé€‚çš„promptï¼ŒåŒ…å«æœç´¢å¼•æ“çš„ç»“æœä½œä¸ºèƒŒæ™¯çŸ¥è¯†</li><li>é™å®šå›ç­”çš„å­—æ•°ï¼Œè¿™ä¸ªé‡‡ç”¨openaiä¸­çš„æ¨¡å‹è°ƒç”¨å‚æ•°<code>max_tokens</code>æ¥å®ç°</li><li>å›ç­”æ—¶å…ˆè§£å†³ç«–æ’ï¼Œå†è§£å†³æ¨ªæ’ã€‚å½“çŸ¥é“ç«–æ’ç»“æœæ—¶ï¼Œå¯ä»¥å¯¹æ¨ªæ’ç»“æœçš„ç­”æ¡ˆè¿›è¡Œé™åˆ¶ï¼Œè¿™è¾¹é‡‡ç”¨openaiä¸­æ¨¡å‹è°ƒç”¨å‚æ•°<code>logit_bias</code>æ¥å®ç°</li></ol><p>å®ç°çš„Pythonç¨‹åºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @place: Pudong, Shanghai </span><br><span class="hljs-comment"># @file: chinese_word_puzzle.py</span><br><span class="hljs-comment"># @time: 2023/10/10 23:24</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">import</span> tiktoken<br><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> Tool<br><span class="hljs-keyword">from</span> langchain.utilities <span class="hljs-keyword">import</span> GoogleSearchAPIWrapper<br><br>os.environ[<span class="hljs-string">&quot;GOOGLE_CSE_ID&quot;</span>] = <span class="hljs-string">&quot;xxx&quot;</span><br>os.environ[<span class="hljs-string">&quot;GOOGLE_API_KEY&quot;</span>] = <span class="hljs-string">&quot;xxx&quot;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChnWordPuzzle</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name, query, answer_number, special_rules</span>):<br>        self.model_name = model_name<br>        self.query = query<br>        self.answer_number = answer_number<br>        self.special_rule = special_rules<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_google_search_result</span>(<span class="hljs-params">self</span>):<br>        search = GoogleSearchAPIWrapper()<br><br>        <span class="hljs-comment"># return first five search results</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">top5_results</span>(<span class="hljs-params">query</span>):<br>            <span class="hljs-keyword">return</span> search.results(query, <span class="hljs-number">5</span>)<br><br>        tool = Tool(<br>            name=<span class="hljs-string">&quot;Google Search&quot;</span>,<br>            description=<span class="hljs-string">&quot;Search Google for recent results.&quot;</span>,<br>            func=top5_results,<br>        )<br>        result = tool.run(self.query)<br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">make_prompt</span>(<span class="hljs-params">self</span>):<br>        prefix_prompt = <span class="hljs-string">&quot;è¯·æ ¹æ®æœç´¢å¼•æ“çš„ç»“æœï¼Œå›ç­”ä¸‹é¢çš„é—®é¢˜ã€‚æœç´¢ç»“æœå¦‚ä¸‹ï¼š\n&quot;</span><br><br>        search_prompt = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> self.get_google_search_result():<br>                search_prompt += <span class="hljs-string">f&quot;æ ‡é¢˜ï¼š<span class="hljs-subst">&#123;record[<span class="hljs-string">&#x27;title&#x27;</span>]&#125;</span>ï¼Œå†…å®¹ï¼š<span class="hljs-subst">&#123;record[<span class="hljs-string">&#x27;snippet&#x27;</span>]&#125;</span>\n&quot;</span><br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">pass</span><br><br>        suffix_prompt = <span class="hljs-string">f&quot;é—®é¢˜ï¼š<span class="hljs-subst">&#123;self.query&#125;</span>ã€‚è¯·ç”¨<span class="hljs-subst">&#123;self.answer_number&#125;</span>ä¸ªæ±‰å­—è¿›è¡Œå›ç­”ã€‚&quot;</span><br><br>        prompt = prefix_prompt + search_prompt + suffix_prompt<br>        <span class="hljs-keyword">return</span> prompt<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>(<span class="hljs-params">self</span>):<br>        openai.api_key = <span class="hljs-string">&quot;sk-xxx&quot;</span><br><br>        prompt = self.make_prompt()<br>        <span class="hljs-built_in">print</span>(prompt)<br>        logit_bias_dict = &#123;&#125;<br>        enc = tiktoken.encoding_for_model(self.model_name)<br>        <span class="hljs-keyword">for</span> no, char <span class="hljs-keyword">in</span> self.special_rule.items():<br>            <span class="hljs-keyword">for</span> token_id <span class="hljs-keyword">in</span> enc.encode(char):<br>                logit_bias_dict[token_id] = <span class="hljs-number">10</span><br>        <span class="hljs-built_in">print</span>(logit_bias_dict)<br><br>        response = openai.ChatCompletion.create(<br>            model=self.model_name,<br>            messages=[<br>                &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: prompt&#125;<br>            ],<br>            max_tokens=self.answer_number + <span class="hljs-number">3</span>,<br>            temperature=<span class="hljs-number">0</span>,<br>            logit_bias=logit_bias_dict<br>        )<br><br>        <span class="hljs-keyword">return</span> response[<span class="hljs-string">&#x27;choices&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;message&#x27;</span>][<span class="hljs-string">&#x27;content&#x27;</span>]<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    my_query = <span class="hljs-string">&quot;ææ¸…ç…§çš„è¯ã€Šä¸€å‰ªæ¢…Â·çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹ã€‹ä¸­â€œä¸€ç§ç›¸æ€ï¼Œä¸¤å¤„é—²æ„â€çš„ä¸Šä¸€å¥&quot;</span><br>    my_answer_number = <span class="hljs-number">7</span><br>    my_model_name = <span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span><br>    <span class="hljs-comment"># my_model_name = &quot;gpt-4&quot;</span><br>    my_special_rules = &#123;&#125;<br>    chn_word_puzzle = ChnWordPuzzle(my_model_name, my_query, my_answer_number, my_special_rules)<br>    <span class="hljs-built_in">print</span>(chn_word_puzzle.solve()[:my_answer_number])<br><br></code></pre></td></tr></table></figure><p>åœ¨å®é™…è¿è¡Œç¨‹åºæ—¶ï¼Œå°†Google searchçš„APIkeyå’ŒOpenAIçš„keyæ›¿æ¢æˆè‡ªå·±çš„ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜çš„promptå’Œç­”æ¡ˆã€‚</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">è¯·æ ¹æ®æœç´¢å¼•æ“çš„ç»“æœï¼Œå›ç­”ä¸‹é¢çš„é—®é¢˜ã€‚æœç´¢ç»“æœå¦‚ä¸‹ï¼š<br>æ ‡é¢˜ï¼šææ¸…ç…§ï¼ŒèŠ±è‡ªé£˜é›¶æ°´è‡ªæµï¼Œã€Šä¸€å‰ªæ¢…Â·çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹ã€‹ï¼Œè¡¨è¾¾æ€å¿µ_ç‹¬ <span class="hljs-string">...</span>ï¼Œå†…å®¹ï¼šMay 3, 2019 <span class="hljs-string">...</span> ææ¸…ç…§çš„è¯èƒ½å¤Ÿå”¤èµ·å¾ˆå¤šäººä»¬å¯¹æƒ…æ„Ÿçš„è¿½ç´¢ï¼Œå¯¹äºæƒ…æ„Ÿçš„ä¸€ç§è¿½å¿†ã€‚ä»ææ¸…ç…§çš„è¯ä¸­äººä»¬èƒ½å¤Ÿæ‰¾åˆ°å¾ˆå¤šç°å®ç”Ÿæ´»ä¸­æƒ…æ„Ÿçš„å¯„æ‰˜ã€‚è¿™é¦–è¯çš„æ„æ€å°±æ˜¯ï¼šâ€œç²‰çº¢è‰²çš„Â <span class="hljs-string">...</span><br>æ ‡é¢˜ï¼šä¸€å‰ªæ¢…Â·çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹_ç™¾åº¦ç™¾ç§‘ï¼Œå†…å®¹ï¼šä¸€å‰ªæ¢…Â·çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹ã€‹æ˜¯å®‹ä»£å¥³è¯äººææ¸…ç…§çš„è¯ä½œã€‚æ­¤è¯ä½œäºè¯äººä¸ä¸ˆå¤«èµµæ˜è¯šç¦»åˆ«ä¹‹åï¼Œå…ˆå†™æ¸…ç§‹æ—¶èŠ‚ä¸çˆ±äººåˆ«åï¼Œç‹¬ä¸Šå…°èˆŸä»¥æ’é£æ„æ€€ï¼Œè¥¿æ¥¼æœ›æœˆæ¨é›æ¥æ— ä¹¦ï¼ŒÂ <span class="hljs-string">...</span><br>æ ‡é¢˜ï¼šä¸€å‰ªæ¢…Â·çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹åŸæ–‡ã€ç¿»è¯‘åŠèµæã€æ‹¼éŸ³ç‰ˆ_ææ¸…ç…§_å¤è¯—æ–‡ç½‘ï¼Œå†…å®¹ï¼šè½»è§£ç½—è£³ï¼Œç‹¬ä¸Šå…°èˆŸã€‚äº‘ä¸­è°å¯„é”¦ä¹¦æ¥ï¼Ÿé›å­—å›æ—¶ï¼Œæœˆæ»¡è¥¿æ¥¼ã€‚èŠ±è‡ªé£˜é›¶æ°´è‡ªæµã€‚ä¸€ç§ç›¸æ€ï¼Œä¸¤å¤„é—²æ„ã€‚æ­¤æƒ…æ— è®¡å¯æ¶ˆé™¤ï¼Œæ‰ä¸‹çœ‰å¤´ï¼Œå´ä¸Š <span class="hljs-string">...</span> è¯çš„ä¸Šé˜•é¦–å¥Â <span class="hljs-string">...</span><br>æ ‡é¢˜ï¼šä¸€å‰ªæ¢…â€¢çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹ï¼Œææ¸…ç…§ç‰ç°Ÿç§‹èµæï¼Œä¸€ç§ç›¸æ€ä¸¤å¤„é—²æ„- çŸ¥ä¹ï¼Œå†…å®¹ï¼šMar 5, 2020 <span class="hljs-string">...</span> è¿™é¦–è¯ç‰Œåâ€œä¸€å‰ªæ¢…â€åˆ†ä¸ºä¸Šä¸‹ä¸¤é˜•ï¼ˆqueï¼Œå››å£°ï¼‰ï¼Œé˜•å­—ä¹‰æ˜¯â€œåœæ­¢â€çš„æ„æ€ï¼Œç”¨åœ¨è¯é‡Œé¢ï¼Œä¸€èˆ¬æŒ‡â€œä¸€æ®µâ€çš„æ„æ€ï¼Œè¿™é¦–è¯ç‰Œåæ˜¯åˆ†ä¸ºä¸¤æ®µçš„ï¼Œç¬¬ä¸€æ®µç§°ä¸ºä¸Šé˜•ï¼Œç¬¬äºŒÂ <span class="hljs-string">...</span><br>æ ‡é¢˜ï¼š<span class="hljs-string">&quot;èŠ±è‡ªé£˜é›¶æ°´è‡ªæµã€‚ä¸€ç§ç›¸æ€ï¼Œä¸¤å¤„é—²æ„ã€‚&quot;</span>å…¨è¯—èµæ_å¤è¯—æ–‡ç½‘ï¼Œå†…å®¹ï¼šåŸæ–‡. ææ¸…ç…§ã€Šä¸€å‰ªæ¢…Â·çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹ã€‹. çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹ã€‚è½»è§£ç½—è£³ï¼Œç‹¬ä¸Šå…°èˆŸã€‚äº‘ä¸­è°å¯„é”¦ä¹¦æ¥ï¼Ÿé›å­—å›æ—¶ï¼Œæœˆæ»¡è¥¿æ¥¼ã€‚ èŠ±è‡ªé£˜é›¶æ°´è‡ªæµã€‚ä¸€ç§ç›¸æ€ï¼Œä¸¤å¤„é—²æ„ã€‚æ­¤Â <span class="hljs-string">...</span><br>é—®é¢˜ï¼šææ¸…ç…§çš„è¯ã€Šä¸€å‰ªæ¢…Â·çº¢è—•é¦™æ®‹ç‰ç°Ÿç§‹ã€‹ä¸­â€œä¸€ç§ç›¸æ€ï¼Œä¸¤å¤„é—²æ„â€çš„ä¸Šä¸€å¥ã€‚è¯·ç”¨7ä¸ªæ±‰å­—è¿›è¡Œå›ç­”ã€‚<br>&#123;&#125;<br>èŠ±è‡ªé£˜é›¶æ°´è‡ªæµ<br></code></pre></td></tr></table></figure><p>å›ç­”æ­£ç¡®ï¼Perfect!</p><h2 id="å®éªŒ">å®éªŒ</h2><p>æˆ‘ä»¬ä½¿ç”¨<code>gpt-3.5-turbo</code>æ¨¡å‹ï¼Œå¯¹å‰10ä¸ªé—®é¢˜è¿›è¡Œæµ‹è¯•ï¼Œç­”æ¡ˆå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csv">1. èŠ±è‡ªé£˜é›¶æ°´è‡ªæµ<br>2. æ–¯é‡Œå…°å¡<br>3. æŠ•ç‰©ä¼<br>4. å¤§æ±Ÿä¸œå»<br>5. æŸ¯å°”é¸­<br>6. ä¸­åä¹¦å±€<br>7. åœŸè€³å…¶<br>8. è¿·ç¬›éŸ³ä¹èŠ‚<br>9. é’æµ·æ¹–<br>10. è”¡ä¼¦<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œç¬¬10ä¸ªå›ç­”æ˜ç¡®æœ‰é”™ï¼Œæˆ‘ä»¬è°ƒç”¨<code>GPT-4</code>æ¨¡å‹ï¼Œå¯å¾—åˆ°æ­£ç¡®ç­”æ¡ˆï¼šé€ çº¸æœ¯ã€‚</p><p>åœ¨å¾—åˆ°ç«–æ’ç­”æ¡ˆåï¼Œæˆ‘ä»¬åœ¨å›ç­”æ¨ªæ’é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”¨ç«–æ’çš„ç­”æ¡ˆå¯¹å›å¤è¿›è¡Œçº¦æŸï¼Œæ¯”å¦‚åœ¨å›ç­”æ¨ªæ’ç¬¬äºŒä¸ªé—®é¢˜<code>â€œè¿ªå£«å°¼å…¬ä¸»â€å¤§å®¶åº­ä¸­ï¼Œå”¯ä¸€è®¾å®šæ²¡æœ‰çš‡å®¤è¡€ç»Ÿæˆ–èº«ä»½çš„å…¬ä¸»å½¢è±¡æ˜¯è°ï¼Ÿ</code>æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“ç¬¬ä¸€ã€ç¬¬ä¸‰ä¸ªå­—åˆ†åˆ«ä¸ºèŠ±ã€å…°ï¼Œé‚£ä¹ˆç­”æ¡ˆåº”è¯¥ä¸ºèŠ±Xå…°ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°†my_special_rules= {"ä¸€": "èŠ±", "ä¸‰": "å…°"}ï¼Œå¯å¯¹ç­”æ¡ˆè¿›è¡Œçº¦æŸã€‚</p><p>æ¨ªæ’ç­”æ¡ˆå¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs">ä¸€. æ°´é“¶<br>äºŒ. èŠ±æœ¨å…°<br>ä¸‰. è¿·å®«<br>å››. æŸ¯äº­ç¬›<br>äº”. ä¹åœ¨å…¶ä¸­<br>å…­. ä¸Šæµ·è´¢å¤§<br>ä¸ƒ. æ±Ÿå—åˆ¶é€ å±€<br>å…«. æµæ°´è½èŠ±æ˜¥å»ä¹Ÿ<br>ä¹. å·´å‹’æ–¯å¦<br>å. æœ¯è¯­<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>åœ¨ä¸Šè¿°çš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œç«–æ’çš„ç¬¬3ä¸ªå›ç­”<code>æŠ•ç‰©ä¼</code>æœ‰è¯¯ï¼Œè¿™æ˜¯GoogleSearchå’Œå¤§æ¨¡å‹å›å¤å…±åŒå¯¼è‡´çš„é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆä¸ºé™è½ä¼ï¼Œä½œä¸ºäººå¯ä»¥è½»æ¾åœ°å›ç­”å‡ºæ¥ï¼Œè€Œå¤§æ¨¡å‹+æœç´¢å¼•æ“ç«Ÿç„¶ä¸è¡Œï¼</p><p>ç«–æ’çš„ç¬¬10ä¸ªå›ç­”ï¼Œ<code>gpt-3.5-turbo</code>æ¨¡å‹é”™è¯¯ï¼Œè€Œ<code>GPT-4</code>æ¨¡å‹å›ç­”æ­£ç¡®ã€‚</p><p>åŒæ—¶ï¼Œæ¨ªæ’çš„ç¬¬ä¸€ä¸ªé—®é¢˜åœ¨GoogleSearchæ²¡æœ‰æœç´¢ç»“æœï¼Œé logit_biasçº¦æŸç­”æ¡ˆä¸­æœ‰â€œæ°´â€å­—ç”Ÿæˆçš„ç­”æ¡ˆä¸ºæ°´é“¶ï¼Œç­”æ¡ˆæ­£ç¡®ã€‚</p><p>æœ€åï¼Œæ¨ªæ’çš„ç¬¬å…­ä¸ªé—®é¢˜ï¼Œç­”æ¡ˆä¸ºä¸Šæµ·è´¢å¤§ï¼Œä½†å¦‚æœlogit_biasçš„å€¼è®¾ä¸º5ï¼Œç­”æ¡ˆä¸ºä¸Šæµ·è´¢ç»ï¼Œç”±äºç«–æ’çš„ç­”æ¡ˆå·²çŸ¥æœ€åä¸€ä¸ªä¸ºå¤§å­—ï¼Œæ‰€ä»¥å¯è°ƒæ•´logit_biasçš„å€¼ã€‚</p><p>åœ¨ä¸Šè¿°çš„ç§ç§è°ƒè¯•ä¸‹ï¼Œä½¿ç”¨<code>gpt-3.5-turbo</code>æ¨¡å‹ï¼Œå›ç­”æ­£ç¡®å…±18ä¸ªï¼Œæ­£ç¡®ç‡90%ã€‚</p><p>ç»¼ä¸Šï¼Œ</p><ol type="1"><li>å°½ç®¡æœ‰Google Searchçš„åŠ æŒï¼Œä½†å¤§æ¨¡å‹è¿˜æ˜¯ä¼šå›ç­”é”™è¯¯ã€‚</li><li>Google Searchå­˜åœ¨æœç´¢æ— ç»“æœï¼Œå› æ­¤éœ€è¦å®¹é”™ã€‚</li><li>logit_biasçš„å€¼æœ‰ä¸€å®šçš„æ¦‚ç‡ä¼šç”Ÿæˆé”™è¯¯ç­”æ¡ˆã€‚</li></ol><p>å› æ­¤ï¼Œä¸Šè¿°çš„è§£å†³æ–¹æ¡ˆè¿˜ä¸ååˆ†é è°±ï¼ŒæœŸå¾…ä¸‹æ¬¡ä¼˜åŒ–~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LLM</tag>
      
      <tag>å¡«å­—æ¸¸æˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåäº”ï¼‰å¤§æ¨¡å‹æ—¶ä»£ä¸‹çš„å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–</title>
    <link href="/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%BA%94%EF%BC%89%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84%E5%BC%80%E6%94%BE%E9%A2%86%E5%9F%9F%E4%B8%89%E5%85%83%E7%BB%84%E6%8A%BD%E5%8F%96/"/>
    <url>/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%BA%94%EF%BC%89%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84%E5%BC%80%E6%94%BE%E9%A2%86%E5%9F%9F%E4%B8%89%E5%85%83%E7%BB%84%E6%8A%BD%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><center><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></center><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»åœ¨å¤§æ¨¡å‹ï¼ˆLLMï¼‰æ—¶ä»£ä¸‹ï¼Œå¦‚ä½•åœ¨å¼€æ”¾é¢†åŸŸè¿›è¡Œä¸‰å…ƒç»„æŠ½å–ã€‚æœ¬æ–‡å†…å®¹å·²å¼€æºè‡³Githubï¼Œç½‘å€ä¸ºï¼šhttps://github.com/percent4/llm_open_triplet_extraction.</p></blockquote><h2 id="å›é¡¾">å›é¡¾</h2><p>åœ¨ä¸‰å¹´å‰ï¼Œé‚£æ—¶å€™è¿˜æ˜¯BERTæ¨¡å‹æ—¶ä»£ï¼Œç¬”è€…åœ¨ä¸‰å…ƒç»„æŠ½å–æ–¹é¢åšäº†ä¸€äº›æ¢ç´¢å°è¯•ï¼Œåˆ†åˆ«åœ¨é™å®šé¢†åŸŸã€å¼€æ”¾é¢†åŸŸè¿›è¡Œä¸‰å…ƒç»„æŠ½å–ï¼Œå¹¶è¿›ä¸€æ­¥ç»™å‡ºäº†æ„å»ºçŸ¥è¯†å›¾è°±çš„ä¾‹å­ã€‚</p><p>ä»¥ä¸‹æ˜¯ç¬”è€…å…³äºè¿™æ–¹é¢æ¢ç´¢çš„æ–‡ç« ï¼š</p><ol type="1"><li><p><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484571&amp;idx=1&amp;sn=2dda3e2cff031a3b038c45185e88bb6c&amp;chksm=fcb9bd0bcbce341db4f9f8fd1439fb44fc13c3552a7cee0df19ed7ac396c996bb477f21aa7cc&amp;payreadticket=HEEa57SV8Tl4yGiZAjcIeJ87x3M7phfxjXfmz2Zy-aor_Isc6erRbkMyEl1F-9tySvTHB-Y#rd">NLPï¼ˆäºŒåå…­ï¼‰é™å®šé¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•</a></p></li><li><p><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484576&amp;idx=1&amp;sn=fc2bce1ec35381185209ea12eab3714d&amp;chksm=fcb9bd30cbce3426c69db55e13981b202674105529aac9d8389a950b275c8542d472f9ebe3cc&amp;payreadticket=HEVs_r75geHHd7WZ8GvbGtoTYrayU-ZhMzkU6x3nZEJzZb4tW0DJsNUkliboWT48nULHW1E#rd">NLPï¼ˆäºŒåä¸ƒï¼‰å¼€æ”¾é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•</a></p></li><li><p><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484535&amp;idx=1&amp;sn=9870bbe6e4eb48431f1b15fae41d0a7d&amp;chksm=fcb9bde7cbce34f19cb9a272a385a22e3845da353c8d57978abece07fa12d0e4cd21e842ce0e&amp;token=901693202&amp;lang=zh_CN#rd">çŸ¥è¯†å›¾è°±æ„å»ºä¸¾ä¾‹</a></p></li></ol><h3 id="é™å®šé¢†åŸŸä¸‰å…ƒç»„æŠ½å–">é™å®šé¢†åŸŸä¸‰å…ƒç»„æŠ½å–</h3><p>æ‰€è°“<code>é™å®šé¢†åŸŸä¸‰å…ƒç»„æŠ½å–</code>ï¼ŒæŒ‡çš„æ˜¯åœ¨ç‰¹å®šçš„Schemaçº¦æŸä¸‹ï¼Œä»æ–‡æœ¬ä¸­æŠ½å–å‡ºç¬¦åˆæ¡ä»¶çš„ä¸‰å…ƒç»„ã€‚ç¬”è€…å½“æ—¶ä»¥<code>2019è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›çš„ä¸‰å…ƒç»„æŠ½å–æ¯”èµ›</code>ä¸ºä¾‹ï¼Œå…¶æ•°æ®é›†çš„ä¸‰å…ƒç»„Schemaä¸º50ç§å…³ç³»ã€‚</p><p>é‡‡ç”¨çš„æ¨¡å‹ä¸ºPipelineæ¨¡å‹ï¼Œå…ˆç”¨åºåˆ—æ ‡æ³¨ç®—æ³•è¿›è¡Œå®ä½“è¯†åˆ«ï¼Œå†ç”¨å…³ç³»åˆ†ç±»æ¨¡å‹è¿›è¡Œå…³ç³»åˆ†ç±»ï¼Œå½¢æˆä¸‰å…ƒç»„ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š</p><figure><imgsrc="https://mmbiz.qpic.cn/mmbiz_png/cRWNtpP7icvFsBsCx5aF24hLdCH7V0PXNHJU2Vgg3dY7oCqictVhDJEhTpnvOpdE6VLNuVyWCibsBomG4xrEPtRQg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"alt="é™å®šé¢†åŸŸä¸‰å…ƒç»„æŠ½å–" /><figcaption aria-hidden="true">é™å®šé¢†åŸŸä¸‰å…ƒç»„æŠ½å–</figcaption></figure><h3 id="å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–">å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–</h3><p>æ‰€è°“<code>å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–</code>ï¼ŒæŒ‡çš„æ˜¯ä¸é™å®šSchemaï¼Œä»æ–‡æœ¬ä¸­æŠ½å–å‡ºæœ‰æ•ˆçš„ä¸‰å…ƒç»„ã€‚ç¬”è€…å½“æ—¶ä»¥è‡ªå·±æ ‡æ³¨çš„ä¸‰å…ƒç»„æ•°æ®ï¼ˆä¸»è¦ä¸ºäººç‰©å…³ç³»ã€å¤´è¡”èŒåŠ¡ç­‰ï¼‰ä¸ºä¾‹ï¼Œæ•°æ®é›†è§„æ¨¡ä¸º3200æ¡æ ·æœ¬ï¼Œé‡‡ç”¨çš„æ¨¡å‹æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><figure><imgsrc="https://mmbiz.qpic.cn/mmbiz_png/cRWNtpP7icvH2PkLeUxHgzDq4WDW9sVr3mrJoqxPfq01jstXesJqMQd0BLfIU4g80ic9VibSnia6sU9cq416HEib3mA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"alt="å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–" /><figcaption aria-hidden="true">å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–</figcaption></figure><h3 id="çŸ¥è¯†å›¾è°±æ„å»º">çŸ¥è¯†å›¾è°±æ„å»º</h3><p>ä¸‰å…ƒç»„æŠ½å–èƒ½å¤Ÿä»éç»“æ„åŒ–æ•°æ®ï¼ˆæ–‡æœ¬ï¼‰ä¸­æŠ½å–å‡ºç¬¦åˆæ¡ä»¶çš„(å®ä½“1, å…³ç³»,å®ä½“2)æˆ–(å®ä½“1, å±æ€§,å±æ€§å€¼)ä¸‰å…ƒç»„ï¼Œä»è€Œæ–¹ä¾¿æˆ‘ä»¬åŠ å·¥å‡ºçŸ¥è¯†å›¾è°±ï¼Œå› ä¸ºçŸ¥è¯†å›¾è°±çš„åŸºæœ¬å•å…ƒå°±æ˜¯ä¸‰å…ƒç»„ã€‚</p><p>ç¬”è€…ä»¥ä¸Šè¿°çš„<code>å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–</code>ä¸ºä¾‹ï¼Œåœ¨æ–‡å­¦ä½œå“ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹ã€ã€Šç™½é¹¿åŸã€‹ã€ã€Šç¥é›•ä¾ ä¾£ã€‹ã€ã€Šæ˜æœé‚£äº›äº‹å„¿ã€‹ã€ã€Šæ›¾å›½è—©ã€‹å’Œæ”¿æ²»æ–°é—»ä¸­æŠ½å–ä¸‰å…ƒç»„ï¼Œç»“åˆäººå·¥æ•´ç†ï¼Œå½¢æˆæœ‰ä»·å€¼çš„çŸ¥è¯†å›¾è°±ã€‚</p><p>å…³äºçŸ¥è¯†å›¾è°±æ„å»ºçš„ä¾‹å­ï¼Œå¯å‚è€ƒGithubé¡¹ç›®ï¼š<ahref="https://github.com/percent4/knowledge_graph_demo">knowledge_graph_demo</a>.</p><h2 id="æ•°æ®é›†">æ•°æ®é›†</h2><blockquote><p>æ—¶é—´å·²è¿›å…¥å¤§æ¨¡å‹æ—¶ä»£ï¼Œç”¨å¤§æ¨¡å‹æ¥è¿›è¡Œå¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–ï¼Œåº”å½“æœ‰æ›´å¥½çš„æ•ˆæœã€‚æœ¬æ–‡å³æ˜¯ç¬”è€…çš„è¿›ä¸€æ­¥å°è¯•ã€‚æœ‰äº†å¤§æ¨¡å‹ï¼Œä»¥å¾€éš¾åšçš„å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–å°±å˜å¾—è¾ƒä¸ºå®¹æ˜“äº†ï¼Œå› ä¸ºå¤§æ¨¡å‹çš„æ–‡æœ¬ç”Ÿæˆæ¨¡å¼ï¼ŒåŸºæœ¬å¯ä»¥å®Œæˆä»¥å¾€æ‰€æœ‰çš„NLPä»»åŠ¡ï¼Œè¿™æ— ç–‘æ˜¯ä¸€æ¬¡NLPé¢†åŸŸçš„é‡å¤§é©å‘½ã€‚</p></blockquote><p>ç¬”è€…åœ¨ä»¥å¾€3200æ¡å…³äºå¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–æ ·æœ¬çš„åŸºç¡€ä¸Šï¼Œé‡‡ç”¨ä¸»åŠ¨å­¦ä¹ æ–¹æ³•ï¼Œå°†æ•°æ®é›†æ‰©å……è‡³5259æ¡æ ·æœ¬ï¼Œæ¶‰åŠé¢†åŸŸä¸»è¦ä¸ºäººç‰©å…³ç³»ã€å¤´è¡”èŒåŠ¡ç­‰ã€‚æ•°æ®é›†å·²ä¸Šä¼ è‡³HuggingFaceï¼Œç½‘å€ä¸ºï¼š<ahref="https://huggingface.co/datasets/jclian91/open_domain_triple_extraction">jclian91/open_domain_triple_extraction</a>.</p><p>å¯¹ä¸‰å…ƒç»„æ•°é‡è¿›è¡Œç»Ÿè®¡åˆ†æï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="https://s2.loli.net/2023/09/30/LjuKNwGW6D5scXg.png"alt="ä¸‰å…ƒç»„æ•°é‡åˆ†å¸ƒå›¾" /><figcaption aria-hidden="true">ä¸‰å…ƒç»„æ•°é‡åˆ†å¸ƒå›¾</figcaption></figure><p>æˆ‘ä»¬æ„é€ äº†1680æ¡æ— ä¸‰å…ƒç»„çš„æ ·æœ¬ï¼Œè¿™åœ¨æ•°æ®é›†ä¸­ååˆ†é‡è¦ï¼Œå› ä¸ºç°å®ä¸–ç•Œä¸­çš„æ–‡æœ¬ä¸­åŒ…å«æœ‰å¤§é‡çš„æ— ä¸‰å…ƒç»„çš„æ•°æ®ï¼Œå› æ­¤ï¼ŒåŸºäºæ ‡æ³¨æ•°æ®è®­ç»ƒçš„æ¨¡å‹éœ€è¦æœ‰åŒºåˆ†æ˜¯å¦å«æœ‰ä¸‰å…ƒç»„çš„èƒ½åŠ›ã€‚</p><h2 id="å¯è§†åŒ–">å¯è§†åŒ–</h2><p>åœ¨ä»‹ç»å¤§æ¨¡å‹å¾®è°ƒä¸‰å…ƒç»„æŠ½å–å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œå¾®è°ƒåçš„æ¨¡å‹åœ¨æ–°æ ·æœ¬çš„è¡¨ç°ã€‚</p><h3 id="ä¾‹å­1">ä¾‹å­1</h3><p>æ¥æºç½‘ç«™ï¼š<ahref="https://www.chinanews.com/cj/2023/09-25/10083719.shtml">https://www.chinanews.com/cj/2023/09-25/10083719.shtml</a></p><p>å¯è§†åŒ–é¡µé¢æŠ½å–ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2023/09/27/NMKr6adWeQh39XL.png" /></p><p>å½¢æˆçš„çŸ¥è¯†å›¾è°±å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2023/09/27/Xj1DHU2d7pLEKfJ.png" /></p><h3 id="ä¾‹å­2">ä¾‹å­2</h3><p>æ¥æºç½‘ç«™ï¼š<ahref="https://www.jjxw.cn/xinwen/jjsz/202309/t20230926_6225481.html">https://www.jjxw.cn/xinwen/jjsz/202309/t20230926_6225481.html</a></p><p>å¯è§†åŒ–é¡µé¢æŠ½å–ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2023/09/27/nEchIxVk6MAXf8S.png" /></p><p>å½¢æˆçš„çŸ¥è¯†å›¾è°±å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2023/09/27/7sxWpgQeF9JXwAT.png" /></p><h2 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h2><p>æœ¬æ–‡é‡‡ç”¨<code>Firefly</code>æ¡†æ¶å’ŒåŸºåº§æ¨¡å‹<code>Baichuan2-13B-Base</code>ï¼Œåœ¨å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–æ•°æ®é›†ä¸Šè¿›è¡Œå¾®è°ƒï¼ˆSFTï¼‰ã€‚</p><p>åªéœ€è¦å°†æ•°æ®åŠ å·¥æˆ<code>Firefly</code>æ¡†æ¶æ”¯æŒçš„å¯¹è¯æ ¼å¼ï¼Œpromptæ„é€ å¦‚ä¸‹ï¼š</p><blockquote><p>ç»™å®šä»¥ä¸‹æ–‡æœ¬ï¼Œè¯·åˆ†æå¹¶æå–å…¶ä¸­çš„å…³ç³»ä¸‰å…ƒç»„ã€‚æ¯ä¸ªä¸‰å…ƒç»„åº”è¯¥åŒ…æ‹¬ä¸»ä½“ï¼ˆäººç‰©ã€ç»„ç»‡æˆ–ç‰©ä½“ï¼‰ã€å…³ç³»å’Œå®¢ä½“ï¼ˆäººç‰©ã€åœ°ç‚¹æˆ–ç‰©ä½“ï¼‰ã€‚å¦‚æœæ–‡æœ¬ä¸­æ²¡æœ‰æ˜æ˜¾çš„å…³ç³»ï¼Œè¯·è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚ï¼š"{content}"ï¼š- ï¼ˆä¸»ä½“ï¼Œå…³ç³»ï¼Œå®¢ä½“ï¼‰-ï¼ˆä¸»ä½“ï¼Œå…³ç³»ï¼Œå®¢ä½“ï¼‰ï¼Œè¯·è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p></blockquote><p>è®­ç»ƒå‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;output_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;output/firefly-baichuan2-13b-spo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;model_name_or_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/workspace/Baichuan2-13B-Base&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;train_file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./data/spo.jsonl&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;num_train_epochs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;per_device_train_batch_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gradient_accumulation_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;learning_rate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1e-4</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;max_seq_length&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">550</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;logging_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_total_limit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lr_scheduler_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;constant_with_warmup&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;warmup_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">300</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">64</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_alpha&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_dropout&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span><br><br>    <span class="hljs-attr">&quot;gradient_checkpointing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;disable_tqdm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;optim&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;paged_adamw_32bit&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fp16&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;report_to&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tensorboard&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dataloader_num_workers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_strategy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;steps&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;weight_decay&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;max_grad_norm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;remove_unused_columns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="æ¨¡å‹è¯„ä¼°">æ¨¡å‹è¯„ä¼°</h2><p>å¯¹å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–è¿›è¡Œæ¨¡å‹è¯„ä¼°åº”å½“æ˜¯ä¸€ä»¶å›°éš¾çš„äº‹æƒ…ï¼Œå› ä¸ºä¸‰å…ƒç»„çš„Schemaæ˜¯ä¸å—çº¦æŸçš„ã€‚ä½†å¥½åœ¨ï¼Œç¬”è€…æ„å»ºçš„æ•°æ®é›†ä¸»è¦æ˜¯ä»æ–°é—»ã€å°è¯´ä¸­é‡‡é›†çš„å…³äºäººç‰©å…³ç³»ã€å¤´è¡”èŒåŠ¡çš„æ•°æ®ï¼Œå› æ­¤ï¼Œç¬”è€…åˆæ”¶é›†äº†æ¥è‡ªå„ä¸ªç½‘ç«™çš„æ–°é—»ã€å°è¯´ä¸­çš„ä¸‰å…ƒç»„ï¼Œå…±100æ¡è¯„ä¼°æ ·æœ¬ï¼Œæ–‡ä»¶ä¸º<code>evaluate_data.xlsx</code>ï¼Œå‰å‡ è¡Œå¦‚ä¸‹ï¼š</p><table style="width:100%;"><thead><tr class="header"><th>æ–‡æœ¬</th><th>çœŸå®ä¸‰å…ƒç»„</th><th>æ¥æº</th><th>ç½‘å€</th></tr></thead><tbody><tr class="odd"><td>æ–°åç¤¾æ­å·9æœˆ24æ—¥ç”µï¼ˆè®°è€…å§¬çƒ¨ã€è‘£æ„è¡Œï¼‰å›½é™…å¥¥å§”ä¼šä¸»å¸­å·´èµ«23æ—¥åœ¨æ­å·å‡ºå¸­äº†ç¬¬19å±Šäºšè¿ä¼šå¼€å¹•å¼ï¼Œä»–ç§°èµè¿™åœºå¼€å¹•å¼æ˜¯æ•°å­—åˆ›æ–°å’Œäººæ–‡é£é‡‡çš„å®Œç¾ç»“åˆã€‚</td><td>(æ–°åç¤¾ï¼Œè®°è€…ï¼Œå§¬çƒ¨)(æ–°åç¤¾ï¼Œè®°è€…ï¼Œè‘£æ„è¡Œ)(å›½é™…å¥¥å§”ä¼šï¼Œä¸»å¸­ï¼Œå·´èµ«)</td><td>æ–°åç½‘</td><td>https://www.news.cn/sports/2023-09/24/c_1212274341.htm</td></tr><tr class="even"><td>2022å¹´11æœˆï¼Œæ³•å›½æ€»ç»Ÿé©¬å…‹é¾™è®¿é—®æ³°å›½ï¼Œå—åˆ°æ³°å›½å›½ç‹å“‡é›†æ‹‰éš†åŠŸæ¥è§ã€‚å¸Œé‡Œå©‰ç“¦ä¸½å‡ºç°åœ¨çˆ¶äº²èº«è¾¹ã€‚</td><td>(æ³•å›½ï¼Œæ€»ç»Ÿï¼Œé©¬å…‹é¾™)(æ³°å›½ï¼Œå›½ç‹ï¼Œå“‡é›†æ‹‰éš†åŠŸ)</td><td>ç½‘æ˜“æ–°é—»</td><td>https://www.163.com/dy/article/IFDIJR03051283GO.html</td></tr><tr class="odd"><td>â€œè¿™ä½æ˜¯çº¢å²¸åŸºåœ°çš„é›·å¿—æˆæ”¿å§”ã€‚æˆ‘æ˜¯æ¨å«å®ï¼ŒåŸºåœ°çš„æ€»å·¥ç¨‹å¸ˆã€‚ç¦»é™è½è¿˜æœ‰ä¸€ä¸ªå°æ—¶ï¼Œä½ ä¼‘æ¯å§ã€‚â€</td><td>ï¼ˆçº¢å²¸åŸºåœ°ï¼Œæ”¿å§”ï¼Œé›·å¿—æˆï¼‰ï¼ˆåŸºåœ°ï¼Œæ€»å·¥ç¨‹å¸ˆï¼Œæ¨å«å®ï¼‰</td><td>é²²å¼©å°è¯´</td><td>https://www.kunnu.com/santi/26653.htm</td></tr></tbody></table><p>å¯¹ä¸‰å…ƒç»„æŠ½å–çš„è¯„ä¼°åŠæ³•ï¼Œç¬”è€…å€Ÿé‰´äº†è‹ç¥çš„æ€è·¯ï¼Œä¸»è¦å‚è€ƒä»£ç ä¸º <ahref="https://github.com/bojone/bert4keras/blob/master/examples/task_relation_extraction.py">examples/task_relation_extraction.py</a>.</p><p>æœ€ç»ˆçš„è¯„ä¼°ç»“æœä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">f1: 0.84831, precision: 0.90419, recall: 0.79894: : 100it<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>è¿™å‡ å¹´æ¥ï¼Œç¬”è€…ä¸€ç›´åœ¨æ€è€ƒå¦‚ä½•åœ¨å¼€æ”¾é¢†åŸŸè¿›è¡Œä¸‰å…ƒç»„æŠ½å–ï¼Œä½†åœ¨BERTæ¨¡å‹æ—¶ä»£å—é™å¤ªå¤§ï¼ŒåŸºæœ¬å°±æ˜¯ä¼ ç»Ÿçš„é™å®šé¢†åŸŸçš„å…³ç³»æŠ½å–æ¨¡å‹ã€‚</p><p>å¤§æ¨¡å‹çš„å‡ºç°ï¼Œæ— ç–‘æ˜¯ç°é˜¶æ®µè§£å†³å¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–çš„æœ€ä½³æ–¹å¼ï¼Œä¹Ÿç®—æ˜¯äº†äº†ç¬”è€…å¤šå¹´çš„ä¸€ä¸ªå¤™æ„¿ã€‚</p><p>å½“ç„¶ï¼Œå¤§æ¨¡å‹åœ¨è§£å†³å¼€æ”¾é¢†åŸŸä¸­ä¸‰å…ƒç»„æŠ½å–çš„è¿‡ç¨‹ä¸­å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œè¿˜æœ‰è®¸å¤šé—®é¢˜å¾…è§£å†³ï¼Œç¬”è€…å°è¯•ç€åˆ—ä¸¾å¦‚ä¸‹ï¼š</p><ul><li>å¦‚ä½•å¯¹æŠ½å–çš„ä¸‰å…ƒç»„ä¸­çš„å®ä½“è¿›è¡Œå¯¹é½</li><li>åœ¨æŠ½å–ä¸‰å…ƒç»„è¿‡ç¨‹ä¸­æ·»åŠ æ—¶é—´ç»´åº¦ï¼ˆå³çŸ¥è¯†æ›´æ–°ï¼‰ï¼Œå½¢æˆæ—¶åºçŸ¥è¯†å›¾è°±</li><li>å¦‚ä½•é¿å…æŠ½å–æ— æ•ˆä¸‰å…ƒç»„</li><li>å½“æ•°æ®æ¶‰åŠçš„é¢†åŸŸå˜å¤šåï¼Œå¦‚ä½•ä¿è¯æ¨¡å‹çš„æ•ˆæœ</li><li>å¦‚ä½•åœ¨ä¸€æœ¬ä¹¦ç±ä¸­ï¼Œå°†æŠ½å–å‡ºçš„ä¸‰å…ƒç»„è‡ªåŠ¨æ„å»ºçŸ¥è¯†å›¾è°±</li><li>ç»™å‡ºæ›´å¤šçš„çŸ¥è¯†å›¾è°±çš„æ„å»ºä¾‹å­</li><li>å¦‚ä½•æå‡æ¨¡å‹çš„æ¨ç†é€Ÿåº¦</li><li>å…¶å®ƒ</li></ul><p>ä»¥ä¸Šå†…å®¹ç¬”è€…å·²å¼€æºè‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/llm_open_triplet_extraction">https://github.com/percent4/llm_open_triplet_extraction</a>ï¼Œæ¬¢è¿å¤§å®¶å‚è€ƒ~</p><h4 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»</h4><ul><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484571&amp;idx=1&amp;sn=2dda3e2cff031a3b038c45185e88bb6c&amp;chksm=fcb9bd0bcbce341db4f9f8fd1439fb44fc13c3552a7cee0df19ed7ac396c996bb477f21aa7cc&amp;payreadticket=HEEa57SV8Tl4yGiZAjcIeJ87x3M7phfxjXfmz2Zy-aor_Isc6erRbkMyEl1F-9tySvTHB-Y#rd">NLPï¼ˆäºŒåå…­ï¼‰é™å®šé¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•</a></li><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484576&amp;idx=1&amp;sn=fc2bce1ec35381185209ea12eab3714d&amp;chksm=fcb9bd30cbce3426c69db55e13981b202674105529aac9d8389a950b275c8542d472f9ebe3cc&amp;payreadticket=HEVs_r75geHHd7WZ8GvbGtoTYrayU-ZhMzkU6x3nZEJzZb4tW0DJsNUkliboWT48nULHW1E#rd">NLPï¼ˆäºŒåä¸ƒï¼‰å¼€æ”¾é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•</a></li><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484535&amp;idx=1&amp;sn=9870bbe6e4eb48431f1b15fae41d0a7d&amp;chksm=fcb9bde7cbce34f19cb9a272a385a22e3845da353c8d57978abece07fa12d0e4cd21e842ce0e&amp;token=901693202&amp;lang=zh_CN#rd">çŸ¥è¯†å›¾è°±æ„å»ºä¸¾ä¾‹</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LLM</tag>
      
      <tag>ä¸‰å…ƒç»„æŠ½å–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåå››ï¼‰ä½¿ç”¨LangChainå’Œå¼‚æ­¥Webæ¡†æ¶å®ç°æ¥å£æµå¼è¾“å‡º</title>
    <link href="/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8LangChain%E5%92%8C%E5%BC%82%E6%AD%A5Web%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA/"/>
    <url>/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8LangChain%E5%92%8C%E5%BC%82%E6%AD%A5Web%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä»‹ç»">ä»‹ç»</h2><p><code>openai</code>æ¥å£å·²ç»æ”¯æŒæµå¼è°ƒç”¨ï¼Œå†ç»“åˆWebæ¡†æ¶çš„æµå¼å“åº”åŠŸèƒ½ï¼Œä¸éš¾å®Œæˆæµå¼è¾“å‡ºåŠŸèƒ½ã€‚</p><p>ä½†LangChainå¯¹openaiæ¥å£è¿›è¡Œäº†æ·±åº¦åŒ…è£…ï¼Œæµå¼è¾“å‡ºéœ€è¦è¿›è¡Œå›è°ƒï¼ˆ<code>callback</code>ï¼‰ã€‚LangChainçš„æµå¼å›è°ƒç±»ä¸º<code>StreamingStdOutCallbackHandler</code>ï¼Œæ­¤ä¸ºç»ˆç«¯æµå¼è¾“å‡ºï¼Œä¸æ”¯æŒæ¥å£æµå¼è¾“å‡ºã€‚</p><p>å¦‚æœæƒ³è¦å¯¹LangChainçš„å›ç­”è¿›è¡ŒWebç«¯æµå¼è¾“å‡ºï¼Œç½‘ç»œä¸Šæœ‰ä¸å°‘äººå·²ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Œå¤§å¤šæ•°æ–¹æ³•ä¸ºç»§æ‰¿<code>BaseCallbackHandler</code>ç±»ï¼Œè¿›è¡Œæ”¹é€ ï¼šé€šå¸¸æ–¹æ³•æ˜¯å€ŸåŠ©é˜Ÿåˆ—ï¼Œå°†æ–°ç”Ÿæˆçš„tokené€å…¥é˜Ÿåˆ—ï¼Œåœ¨å›å¤ç­”æ¡ˆï¼ˆå¦èµ·ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼‰çš„åŒæ—¶ï¼Œè¿›è¡Œé˜Ÿåˆ—å…ƒç´ çš„è·å–ï¼Œä»è€Œå®ç°æ¥å£æµå¼è¾“å‡ºã€‚</p><p>å‚è€ƒå…¶ä¸­ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šhttps://gist.github.com/python273/563177b3ad5b9f74c0f8f3299ec13850.</p><p>æœ¬æ–‡çš„åˆ›æ–°ä¹‹å¤„åœ¨äºï¼Œå€ŸåŠ©å¼‚æ­¥Webæ¡†æ¶sanicå’ŒFastAPI,å’ŒLangChainä¸­çš„AsyncIteratorCallbackHandlerï¼Œä½¿ç”¨å¼‚æ­¥æ–¹æ³•æ¥å®ç°è°ƒç”¨LangChainï¼Œå®ç°æ¥å£æµå¼è¾“å‡ºåŠŸèƒ½ã€‚</p><h2 id="sanicæ¡†æ¶æ¡†æ¶">Sanicæ¡†æ¶æ¡†æ¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @place: Pudong, Shanghai</span><br><span class="hljs-comment"># @file: sanic_langchain_stream.py</span><br><span class="hljs-comment"># @time: 2023/9/19 18:18</span><br><span class="hljs-comment"># sanic==23.6.0</span><br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> sanic <span class="hljs-keyword">import</span> Sanic<br><span class="hljs-keyword">from</span> sanic.response <span class="hljs-keyword">import</span> text, json, ResponseStream<br><br><span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> ChatOpenAI<br><span class="hljs-keyword">from</span> langchain.schema <span class="hljs-keyword">import</span> HumanMessage<br><span class="hljs-keyword">from</span> langchain.callbacks.streaming_aiter <span class="hljs-keyword">import</span> AsyncIteratorCallbackHandler<br><br><br>app = Sanic(<span class="hljs-string">&quot;benchmark&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">return</span> text(<span class="hljs-string">&quot;hello&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/test&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">answer</span>(<span class="hljs-params">request</span>):<br>    content = request.json[<span class="hljs-string">&quot;content&quot;</span>]<br>    <span class="hljs-keyword">return</span> json(&#123;<span class="hljs-string">&quot;text&quot;</span>: content&#125;)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/csv&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">sample_streaming_fn</span>(<span class="hljs-params">response</span>):<br>        <span class="hljs-keyword">await</span> response.write(<span class="hljs-string">&quot;foo,&quot;</span>)<br>        <span class="hljs-keyword">await</span> response.write(<span class="hljs-string">&quot;bar&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> ResponseStream(sample_streaming_fn, content_type=<span class="hljs-string">&quot;text/csv&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/answer/async&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">answer_async</span>(<span class="hljs-params">request</span>):<br>    content = request.json[<span class="hljs-string">&quot;content&quot;</span>]<br><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>(<span class="hljs-params">response</span>):<br>        handler = AsyncIteratorCallbackHandler()<br>        model_message = [HumanMessage(content=content)]<br>        chat = ChatOpenAI(streaming=<span class="hljs-literal">True</span>,<br>                          callbacks=[handler],<br>                          temperature=<span class="hljs-number">0</span>,<br>                          openai_api_key=<span class="hljs-string">&quot;&quot;</span>)<br>        asyncio.create_task(chat.apredict_messages(model_message))<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> handler.aiter():<br>            <span class="hljs-keyword">await</span> response.write(<span class="hljs-string">f&quot;data: <span class="hljs-subst">&#123;token&#125;</span>\n\n&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> ResponseStream(predict, content_type=<span class="hljs-string">&quot;text/event-stream&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">3000</span>, debug=<span class="hljs-literal">False</span>, access_log=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2023/09/20/My5kqGgVtr87faW.gif"alt="sanic.gif" /><figcaption aria-hidden="true">sanic.gif</figcaption></figure><h2 id="fastapiæ¡†æ¶">FastAPIæ¡†æ¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @place: Pudong, Shanghai </span><br><span class="hljs-comment"># @file: fastapi_langchain_stream.py</span><br><span class="hljs-comment"># @time: 2023/9/20 17:36</span><br><span class="hljs-comment"># fastapi==0.101.1</span><br><span class="hljs-keyword">import</span> uvicorn<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> StreamingResponse, JSONResponse<br><br><span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> ChatOpenAI<br><span class="hljs-keyword">from</span> langchain.schema <span class="hljs-keyword">import</span> HumanMessage<br><span class="hljs-keyword">from</span> langchain.callbacks.streaming_aiter <span class="hljs-keyword">import</span> AsyncIteratorCallbackHandler<br><br>app = FastAPI(description=<span class="hljs-string">&quot;langchain_streaming&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    text: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Question</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    text: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fake_video_streamer</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        <span class="hljs-keyword">yield</span> <span class="hljs-string">b&quot;some fake video bytes\n&quot;</span><br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">return</span> StreamingResponse(fake_video_streamer())<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/test&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">item: Item</span>):<br>    <span class="hljs-keyword">return</span> JSONResponse(&#123;<span class="hljs-string">&quot;content&quot;</span>: item.text&#125;)<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/answer/async&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">answer_async</span>(<span class="hljs-params">q: Question</span>):<br>    content = q.text<br><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>():<br>        handler = AsyncIteratorCallbackHandler()<br>        model_message = [HumanMessage(content=content)]<br>        chat = ChatOpenAI(streaming=<span class="hljs-literal">True</span>,<br>                          callbacks=[handler],<br>                          temperature=<span class="hljs-number">0</span>,<br>                          openai_api_key=<span class="hljs-string">&quot;sk-xxx&quot;</span>)<br>        asyncio.create_task(chat.apredict_messages(model_message))<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> handler.aiter():<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">f&quot;data: <span class="hljs-subst">&#123;token&#125;</span>\n\n&quot;</span><br><br>    <span class="hljs-keyword">return</span> StreamingResponse(predict())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    uvicorn.run(app, host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">8000</span>, log_level=<span class="hljs-string">&quot;info&quot;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LangChain</tag>
      
      <tag>æµå¼è¾“å‡º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå¼‚æ­¥ç¼–ç¨‹å…¥é—¨ï¼ˆä¸€ï¼‰</title>
    <link href="/2024/01/10/Python%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <url>/2024/01/10/Python%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åç¨‹ï¼šå•çº¿ç¨‹ï¼›å……åˆ†æå‡æ€§èƒ½ï¼šå¤šæ ¸ + å•çº¿ç¨‹</p><p>Pythonå¯¹<strong>åç¨‹</strong>çš„æ”¯æŒæ˜¯é€šè¿‡<strong>generator</strong>å®ç°çš„ã€‚</p><p>Python3.5å¼€å§‹å¼•å…¥äº†æ–°çš„è¯­æ³•asyncå’Œawaitï¼Œå¯ä»¥è®©coroutineçš„ä»£ç æ›´ç®€æ´æ˜“è¯»ã€‚</p><p>å¼‚æ­¥æ¨¡å—:</p><ul><li>IO: asyncio</li><li>HTTP: aiohttp</li></ul><h2 id="ç®€å•ç¤ºä¾‹">ç®€å•ç¤ºä¾‹</h2><ul><li>hello world</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> asyncio<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello world!&quot;</span>, datetime.now())<br>    r = <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello again!&quot;</span>, datetime.now())<br><br><span class="hljs-comment"># è·å–EventLoop</span><br>loop = asyncio.get_event_loop()<br><span class="hljs-comment"># æ‰§è¡Œcoroutine</span><br>loop.run_until_complete(hello())<br>loop.close()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Hello world! 2023-09-18 11:14:14.840318<br>Hello again! 2023-09-18 11:14:15.840848<br></code></pre></td></tr></table></figure><blockquote><p>asyncio.sleep(1) ä¹Ÿæ˜¯åç¨‹</p></blockquote><blockquote><p>python 3.7ä»¥åå¯ä»¥ç”¨asyncio.run()è¿è¡Œ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> asyncio<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello world!&quot;</span>, datetime.now())<br>    r = <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello again!&quot;</span>, datetime.now())<br><br>asyncio.run(hello())<br></code></pre></td></tr></table></figure><ul><li>ä»»åŠ¡ç»„</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">import</span> threading<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello world!&quot;</span>, datetime.now(), threading.current_thread())<br>    sleep_time = randint(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;sleep time: <span class="hljs-subst">&#123;sleep_time&#125;</span>&quot;</span>, threading.current_thread())<br>    r = <span class="hljs-keyword">await</span> asyncio.sleep(sleep_time)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello again!&quot;</span>, datetime.now(), threading.current_thread())<br><br><span class="hljs-comment"># è·å–EventLoop</span><br>loop = asyncio.get_event_loop()<br><span class="hljs-comment"># æ‰§è¡Œcoroutine</span><br>tasks = [hello(), hello(), hello(), hello()]<br>loop.run_until_complete(asyncio.wait(tasks))<br>loop.close()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><pre><code class="hljs">Hello world! 2023-09-18 14:40:17.230477 &lt;_MainThread(MainThread, started 8127873344)&gt;sleep time: 3 &lt;_MainThread(MainThread, started 8127873344)&gt;Hello world! 2023-09-18 14:40:17.230515 &lt;_MainThread(MainThread, started 8127873344)&gt;sleep time: 1 &lt;_MainThread(MainThread, started 8127873344)&gt;Hello world! 2023-09-18 14:40:17.230528 &lt;_MainThread(MainThread, started 8127873344)&gt;sleep time: 3 &lt;_MainThread(MainThread, started 8127873344)&gt;Hello world! 2023-09-18 14:40:17.230539 &lt;_MainThread(MainThread, started 8127873344)&gt;sleep time: 2 &lt;_MainThread(MainThread, started 8127873344)&gt;Hello again! 2023-09-18 14:40:18.231054 &lt;_MainThread(MainThread, started 8127873344)&gt;Hello again! 2023-09-18 14:40:19.231754 &lt;_MainThread(MainThread, started 8127873344)&gt;Hello again! 2023-09-18 14:40:20.231809 &lt;_MainThread(MainThread, started 8127873344)&gt;Hello again! 2023-09-18 14:40:20.231981 &lt;_MainThread(MainThread, started 8127873344)&gt;</code></pre><blockquote><p>ä½¿ç”¨asyncio.gather()è¿è¡Œä»»åŠ¡ç»„</p></blockquote><ul><li>gatherçš„ä½¿ç”¨</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello world!&quot;</span>, datetime.now())<br>    sleep_time = randint(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;sleep time: <span class="hljs-subst">&#123;sleep_time&#125;</span>&quot;</span>)<br>    r = <span class="hljs-keyword">await</span> asyncio.sleep(sleep_time)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello again!&quot;</span>, datetime.now())<br>    <span class="hljs-keyword">return</span> sleep_time<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">group_task</span>():<br>    tasks = [hello(), hello(), hello(), hello()]<br>    <span class="hljs-keyword">await</span> asyncio.gather(*tasks)<br><br><br>asyncio.run(group_task())<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Hello</span> world! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">34</span>.<span class="hljs-number">779374</span><br><span class="hljs-attribute">sleep</span> time: <span class="hljs-number">2</span><br><span class="hljs-attribute">Hello</span> world! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">34</span>.<span class="hljs-number">779417</span><br><span class="hljs-attribute">sleep</span> time: <span class="hljs-number">4</span><br><span class="hljs-attribute">Hello</span> world! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">34</span>.<span class="hljs-number">779427</span><br><span class="hljs-attribute">sleep</span> time: <span class="hljs-number">1</span><br><span class="hljs-attribute">Hello</span> world! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">34</span>.<span class="hljs-number">779433</span><br><span class="hljs-attribute">sleep</span> time: <span class="hljs-number">0</span><br><span class="hljs-attribute">Hello</span> again! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">34</span>.<span class="hljs-number">779463</span><br><span class="hljs-attribute">Hello</span> again! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">35</span>.<span class="hljs-number">780650</span><br><span class="hljs-attribute">Hello</span> again! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">36</span>.<span class="hljs-number">780536</span><br><span class="hljs-attribute">Hello</span> again! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">38</span>.<span class="hljs-number">780285</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>gather</code>è¿˜å¯ä»¥è·å–è¿”å›ç»“æœã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello world!&quot;</span>, datetime.now())<br>    sleep_time = randint(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)<br>    r = <span class="hljs-keyword">await</span> asyncio.sleep(sleep_time)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello again!&quot;</span>, datetime.now())<br>    <span class="hljs-keyword">return</span> sleep_time<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">group_task</span>():<br>    tasks = [hello(), hello(), hello(), hello()]<br>    result = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)<br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> result:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;result =&gt; <span class="hljs-subst">&#123;v&#125;</span>&quot;</span>)<br><br><br>asyncio.run(group_task())<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Hello</span> world! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">38</span>.<span class="hljs-number">360411</span><br><span class="hljs-attribute">Hello</span> world! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">38</span>.<span class="hljs-number">360461</span><br><span class="hljs-attribute">Hello</span> world! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">38</span>.<span class="hljs-number">360469</span><br><span class="hljs-attribute">Hello</span> world! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">38</span>.<span class="hljs-number">360475</span><br><span class="hljs-attribute">Hello</span> again! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">39</span>.<span class="hljs-number">361758</span><br><span class="hljs-attribute">Hello</span> again! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">40</span>.<span class="hljs-number">361681</span><br><span class="hljs-attribute">Hello</span> again! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">41</span>.<span class="hljs-number">361665</span><br><span class="hljs-attribute">Hello</span> again! <span class="hljs-number">2023</span>-<span class="hljs-number">09</span>-<span class="hljs-number">19</span> <span class="hljs-number">13</span>:<span class="hljs-number">54</span>:<span class="hljs-number">42</span>.<span class="hljs-number">361748</span><br><span class="hljs-attribute">result</span> =&gt; <span class="hljs-number">3</span><br><span class="hljs-attribute">result</span> =&gt; <span class="hljs-number">2</span><br><span class="hljs-attribute">result</span> =&gt; <span class="hljs-number">4</span><br><span class="hljs-attribute">result</span> =&gt; <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><ul><li>è¶…æ—¶</li></ul><p>wait_foræä¾›äº†è¶…æ—¶åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_job</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;before sleep&#x27;</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;never print&#x27;</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">await</span> asyncio.wait_for(my_job(), timeout=<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">except</span> asyncio.TimeoutError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;timeout!&#x27;</span>)<br><br><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">before</span> sleep<br><span class="hljs-keyword">timeout</span>!<br></code></pre></td></tr></table></figure><ul><li>to_thread</li></ul><p>event loop é‡åˆ°æ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿çš„ä»£ç ï¼Œæœ‰æ²¡æœ‰ await èƒ½è®©event loopè½¬ä¸ºæ‰§è¡Œå…¶å®ƒå·¥ä½œæ—¶ï¼Œå°±ä¼šé€ æˆevent loop é˜»å¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> threading<br><br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep, time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hard_work</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;thread id:&#x27;</span>, threading.get_ident())<br>    sleep(<span class="hljs-number">10</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">do_async_job</span>():<br>    hard_work()<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;job done!&#x27;</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-built_in">print</span>(time())<br>    task1 = asyncio.create_task(do_async_job())<br>    task2 = asyncio.create_task(do_async_job())<br>    task3 = asyncio.create_task(do_async_job())<br>    <span class="hljs-keyword">await</span> asyncio.gather(task1, task2, task3)<br>    <span class="hljs-built_in">print</span>(time())<br><br><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">1695103401.266803<br>thread <span class="hljs-built_in">id</span>: 8127873344<br>thread <span class="hljs-built_in">id</span>: 8127873344<br>thread <span class="hljs-built_in">id</span>: 8127873344<br>job <span class="hljs-keyword">done</span>!<br>job <span class="hljs-keyword">done</span>!<br>job <span class="hljs-keyword">done</span>!<br>1695103432.283202<br></code></pre></td></tr></table></figure><p>ä¸ºè§£å†³æŸäº›è€—æ—¶æ‰§è¡Œçš„ä»£ç é˜»å¡ event loopçš„é—®é¢˜ï¼ŒPython 3.9 æä¾›asyncio.to_thread() å¯ä»¥å°†è€—æ—¶æ‰§è¡Œçš„ä»£ç ä¸Ÿè‡³ event loop ä»¥å¤–çš„å¦ 1 ä¸ªthread ä¸­æ‰§è¡Œï¼Œæ¯å‘¼å« 1 æ¬¡å°±æœƒåœ¨ 1 ä¸ªæ–°çš„ thread.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs css">import asyncio<br>import threading<br><br><span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">time</span> import sleep, <span class="hljs-selector-tag">time</span><br><br><br>def hard_work():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;thread id:&#x27;</span>, threading.<span class="hljs-built_in">get_ident</span>())<br>    <span class="hljs-built_in">sleep</span>(<span class="hljs-number">10</span>)<br><br><br>async def <span class="hljs-built_in">do_async_job</span>():<br>    await asyncio.<span class="hljs-built_in">to_thread</span>(hard_work)<br>    await asyncio.<span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;job done!&#x27;</span>)<br><br><br>async def <span class="hljs-built_in">main</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">time</span>())<br>    task1 = asyncio.<span class="hljs-built_in">create_task</span>(<span class="hljs-built_in">do_async_job</span>())<br>    task2 = asyncio.<span class="hljs-built_in">create_task</span>(<span class="hljs-built_in">do_async_job</span>())<br>    task3 = asyncio.<span class="hljs-built_in">create_task</span>(<span class="hljs-built_in">do_async_job</span>())<br>    await asyncio.<span class="hljs-built_in">gather</span>(task1, task2, task3)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">time</span>())<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">1695103741.921301<br>thread <span class="hljs-built_in">id</span>: 6153449472<br>thread <span class="hljs-built_in">id</span>: 6170275840<br>thread <span class="hljs-built_in">id</span>: 6187102208<br>job <span class="hljs-keyword">done</span>!<br>job <span class="hljs-keyword">done</span>!<br>job <span class="hljs-keyword">done</span>!<br>1695103752.9301171<br></code></pre></td></tr></table></figure><ul><li>aiohttp</li></ul><p>https://example.com/ ä¸ºç¤ºä¾‹ç½‘ç«™ï¼Œç”¨äºæ¼”ç¤ºHTTPè¯·æ±‚ã€‚</p><p>åŒæ­¥è¯·æ±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_requests</span>():<br>    resp = requests.get(<span class="hljs-string">&#x27;https://example.com&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;example.com =&gt;&#x27;</span>, resp.status_code)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>):<br>        make_requests()<br><br><br>s_time = time.time()<br>main()<br><span class="hljs-built_in">print</span>(time.time() - s_time)<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">5</span>.<span class="hljs-number">089737892150879</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨aiohttpå®ŒæˆHTTPå¼‚æ­¥è¯·æ±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> aiohttp<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_requests</span>(<span class="hljs-params">session</span>):<br>    <span class="hljs-keyword">return</span> session.get(<span class="hljs-string">&#x27;https://example.com&#x27;</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>        tasks = []<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>):<br>            tasks.append(make_requests(session))<br><br>        results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)<br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;example.com =&gt;&#x27;</span>, r.status)<br><br><br>s_time = time.time()<br>asyncio.run(main())<br><span class="hljs-built_in">print</span>(time.time() - s_time)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">example</span>.com =&gt; <span class="hljs-number">200</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">8919808864593506</span><br></code></pre></td></tr></table></figure><ul><li>å¼‚æ­¥ç”Ÿæˆå™¨</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># SuperFastPython.com</span><br><span class="hljs-comment"># example of asynchronous generator with async for loop</span><br><span class="hljs-keyword">import</span> asyncio<br><br><br><span class="hljs-comment"># define an asynchronous generator</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">async_generator</span>():<br>    <span class="hljs-comment"># normal loop</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        <span class="hljs-comment"># block to simulate doing work</span><br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-comment"># yield the result</span><br>        <span class="hljs-keyword">yield</span> i<br><br><br><span class="hljs-comment"># main coroutine</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># loop over async generator with async for loop</span><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> async_generator():<br>        <span class="hljs-built_in">print</span>(item)<br><br><br><span class="hljs-comment"># execute the asyncio program</span><br>asyncio.run(main())<br><br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒç½‘ç«™">å‚è€ƒç½‘ç«™</h2><ol type="1"><li><a href="https://myapollo.com.tw/blog/begin-to-asyncio/">Pythonasyncio å¾ä¸æœƒåˆ°ä¸Šè·¯</a></li><li><ahref="https://www.liaoxuefeng.com/wiki/1016959663602400/1017968846697824">åç¨‹</a></li><li><ahref="https://www.maxlist.xyz/2020/03/29/python-coroutine/">ã€Pythonæ•™å­¸ã€‘æ·ºè«‡Coroutine å”ç¨‹ä½¿ç”¨æ–¹æ³•</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼‚æ­¥ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåä¸‰ï¼‰ä»BERTæ¨¡å‹è®­ç»ƒåˆ°é‡åŒ–ã€è’¸é¦ä¹‹è·¯</title>
    <link href="/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%B8%89%EF%BC%89%E4%BB%8EBERT%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%88%B0%E9%87%8F%E5%8C%96%E3%80%81%E8%92%B8%E9%A6%8F%E4%B9%8B%E8%B7%AF/"/>
    <url>/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%B8%89%EF%BC%89%E4%BB%8EBERT%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%88%B0%E9%87%8F%E5%8C%96%E3%80%81%E8%92%B8%E9%A6%8F%E4%B9%8B%E8%B7%AF/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><center><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></center><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»ç¬”è€…ä»BERTæ¨¡å‹è®­ç»ƒåˆ°æ¨¡å‹é‡åŒ–ã€è’¸é¦çš„æ—…ç¨‹ï¼Œé€šè¿‡ä¸€ç³»åˆ—æ–‡ç« çš„å›é¡¾ï¼Œä¸éš¾æŒæ¡æ¨¡å‹è®­ç»ƒå’Œæ¨¡å‹å‹ç¼©çš„æŠ€èƒ½ã€‚</p></blockquote><p>åœ¨å·¥ä¸šç•Œä¸­ï¼Œå¸¸è§çš„æ¨¡å‹å‹ç¼©æ–¹æ³•æœ‰<strong>çŸ¥è¯†è’¸é¦</strong>ï¼ˆKnowledgeDistillationï¼ŒKDï¼‰ã€<strong>å‰ªæ</strong>ï¼ˆPruningï¼‰ã€<strong>é‡åŒ–</strong>ï¼ˆQuantizationï¼‰ç­‰ã€‚</p><p>ä»¥å¾€ï¼Œç¬”è€…åªæ³¨é‡æ¨¡å‹è®­ç»ƒï¼Œè€Œå¿½ç•¥äº†æ¨¡å‹å‹ç¼©çš„åŠæ³•ã€‚ä¸çŸ¥ä¸è§‰é—´ï¼Œåœ¨è¿™ä¸€æ®µæ—¶é—´å†…ï¼Œç¬”è€…ç ”ç©¶äº†BERTåˆ†ç±»æ¨¡å‹è®­ç»ƒã€é‡åŒ–ã€çŸ¥è¯†è’¸é¦ç›¸å…³å†…å®¹ï¼Œå½¢æˆäº†ä¸€ç³»åˆ—æ–‡ç« ã€‚</p><p>æœ¬æ–‡å¸Œæœ›é€šè¿‡å¯¹ä»¥å¾€å†å²æ–‡ç« çš„å›é¡¾ï¼Œæ¥æ›´å¥½åœ°æ¢³ç†ä»æ¨¡å‹è®­ç»ƒåˆ°æ¨¡å‹é‡åŒ–ã€è’¸é¦çš„å‘å±•é˜¶æ®µï¼Œç†æ¸…æ¨¡å‹è®­ç»ƒå’Œæ¨ç†æ€§èƒ½ä¹‹é—´çš„å¹³è¡¡æ–¹æ³•ï¼Œå½¢æˆè‡ªå·±çš„æ–¹æ³•è®ºã€‚</p><h2 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h2><p>å¯¹äº<strong>æ¨¡å‹è®­ç»ƒ</strong>ï¼Œå¤§å®¶éƒ½æ¥è§¦è¿‡è‘—åçš„<code>HuggingFace</code>ç¤¾åŒºçš„<code>Transformers</code>æ¨¡å—ã€‚åœ¨<code>Transformers</code>æ¨¡å—ä¸­ï¼Œæ¨¡å‹è®­ç»ƒçš„ä¼˜é›…è§£æ³•åº”è¯¥æ˜¯ä½¿ç”¨<code>Trainer</code>ç±»ï¼Œå…¶å¼ºå¤§çš„åŠŸèƒ½è¶³ä»¥å®Œæˆæˆ‘ä»¬ç»å¤§éƒ¨åˆ†çš„BERTç³»åˆ—æ¨¡å‹çš„NLPä»»åŠ¡ï¼Œä¸”ååˆ†é«˜æ•ˆã€ç®€æ´ï¼Œä»£ç æ“ä½œä¹Ÿè¾ƒä¸ºç»Ÿä¸€ã€ä¼˜é›…ã€‚</p><p>å…³äºä½¿ç”¨<code>Trainer</code>ç±»è¿›è¡ŒBERTæ¨¡å‹æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« ï¼Œæ¨¡å‹è®­ç»ƒã€æ¨ç†çš„ä»£ç ååˆ†ç®€æ´ã€‚</p><p><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485508&amp;idx=1&amp;sn=77a6fef8cfb11a604e19de303576539f&amp;chksm=fcb9b1d4cbce38c24cd92793bcc734684a8a5bc6c4a94d4473328158a5f7e95373f1da4ce2e2&amp;token=1635177260&amp;lang=zh_CN#rd">NLPï¼ˆå…­åå…­ï¼‰ä½¿ç”¨HuggingFaceä¸­çš„Trainerè¿›è¡ŒBERTæ¨¡å‹å¾®è°ƒ</a></p><p>å¦‚æœéœ€è¦å¯¹æ¨¡å‹è¿›è¡Œè‡ªåŠ¨åŒ–å‚æ•°ä¼˜åŒ–ï¼Œ<code>Optuna</code>ä¼šæ˜¯ä½ ç†æƒ³çš„å·¥å…·ï¼Œä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­è§è¯¸ä¸‹æ–‡ï¼š</p><p><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485678&amp;idx=1&amp;sn=e46f781dae394bd7a9381e20eedb04ab&amp;chksm=fcb9b17ecbce38689d6453d4f5b2d0b3cb89a8bcf33135d995c9ad92ff8bd6817fe70087e9ee&amp;token=1635177260&amp;lang=zh_CN#rd">PyTorchå…¥é—¨ï¼ˆå…«ï¼‰Optunaçš„ä½¿ç”¨</a></p><h2 id="æ¨¡å‹é‡åŒ–">æ¨¡å‹é‡åŒ–</h2><p><strong>æ¨¡å‹é‡åŒ–</strong>æ˜¯æŒ‡é€šè¿‡å°†ç¥ç»ç½‘ç»œæ¨¡å‹ä¸­çš„éƒ¨åˆ†å‚æ•°çš„æ•°æ®ç±»å‹ä»FP32æˆ–FP16è½¬åŒ–ä¸ºINT8æˆ–UINT8ï¼Œåœ¨æŸå¤±éƒ¨åˆ†æ¨¡å‹æ•ˆæœçš„å‰æä¸‹ï¼Œç¼©å°é‡åŒ–åæ¨¡å‹å¤§å°ï¼Œæå‡é‡åŒ–åæ¨ç†æ€§èƒ½ã€‚</p><p>PyTorchè‡ªèº«æä¾›äº†æ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPost Training DynamicQuantization, PTDQï¼‰ï¼Œå‚è€ƒæ–‡ç« å¦‚ä¸‹ï¼š</p><p><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485516&amp;idx=1&amp;sn=79b9e17d05335f9283a2d4e0b5632456&amp;chksm=fcb9b1dccbce38ca8d35b27c33f7411499437d53ef32cd989c210495e4c9f42c155845245da8&amp;token=1635177260&amp;lang=zh_CN#rd">NLPï¼ˆå…­åä¸ƒï¼‰BERTæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPTDQï¼‰</a></p><p>HuggingFaceç¤¾åŒºä¹Ÿæä¾›äº†å¥½ç”¨çš„ç¬¬ä¸‰æ–¹é‡åŒ–å·¥å…·ï¼š<code>Optimum</code>ï¼Œå…³äºä½¿ç”¨<code>Optimum</code>æ¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œæ¨¡å‹é‡åŒ–ï¼Œå¯å‚è€ƒï¼š</p><p><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485536&amp;idx=1&amp;sn=249981abe460822a997e4461c56d903a&amp;chksm=fcb9b1f0cbce38e6add3b44e0db721c21c3e4b57590f268dd4f853c11977c00ec74bb9e35818&amp;token=1635177260&amp;lang=zh_CN#rd">NLPï¼ˆå…­åå…«ï¼‰ä½¿ç”¨Optimumè¿›è¡Œæ¨¡å‹é‡åŒ–</a></p><h2 id="çŸ¥è¯†è’¸é¦">çŸ¥è¯†è’¸é¦</h2><p><strong>çŸ¥è¯†è’¸é¦</strong>åŒæ ·ä¹Ÿæ˜¯æ¨¡å‹å‹ç¼©åŠæ³•ï¼Œå®ƒé€šè¿‡Teacheræ¨¡å‹ï¼ˆä¸€èˆ¬ä¸ºå¤æ‚çš„å¤§æ¨¡å‹ï¼‰æ¥æŒ‡å¯¼å°æ¨¡å‹çš„æ–¹æ³•ï¼Œæå‡å°æ¨¡å‹çš„è¡¨ç°èƒ½åŠ›ï¼Œä½¿ç”¨å°æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œä»è€ŒåŠ é€Ÿæ¨¡å‹æ¨ç†ã€‚å…³äº<strong>çŸ¥è¯†è’¸é¦</strong>çš„åŸºæœ¬æ¦‚å¿µã€åŸç†å’Œä»£ç å®ç°ï¼Œä¸‹é¢çš„æ–‡ç« å€¼å¾—ä¸€è¯»ï¼š</p><p><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;tempkey=MTIzNV8rRXQwM21jVEI1VVZXRFVZYzRmUzB3WTdFdnU4Z25SR2xVOU9nVE9OZ25JQTliWE5pVEJ1dmFvZWI5WGhQb0d4b1lmYzU2eVB1WlBYVVNLdm9oMWVWSndZWGF1WVFPUm0waHR2eGVHSlAxbDZOUU15YUlJQ1p6WlVGeDFpdjM0a3R2OU94QmhwZFM4Zm93eTZfSjV4bDk4eWNqcW8ycktYRmFpNU53fn4%3D&amp;chksm=fcb9b08ccbce399ae641e04d487e991c377f502f0cc54ad871cf5c5272c3cae1e88b6fb95bd1&amp;token=1635177260&amp;lang=zh_CN#rd">NLPï¼ˆä¸ƒåäºŒï¼‰ä½¿ç”¨çŸ¥è¯†è’¸é¦æå‡æ¨¡å‹æ¨ç†æ€§èƒ½</a></p><h2 id="æ¨ç†æ€§èƒ½æå‡">æ¨ç†æ€§èƒ½æå‡</h2><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬æ•´ç†å‡ºä¸€ä¸ªæ¨¡å‹æ¨ç†æ€§èƒ½æå‡çš„è¡¨æ ¼ï¼š</p><blockquote><p>å®éªŒçš„æ•°æ®é›†ä¸ºsougouåˆ†ç±»å°æ•°æ®é›†ï¼ŒåŸºåº§æ¨¡å‹é‡‡ç”¨bert-base-chineseï¼ˆTeacheræ¨¡å‹ï¼‰ï¼Œæ–‡æœ¬æœ€å¤§é•¿åº¦ä¸º128ã€‚é‡åŒ–å·¥å…·ä½¿ç”¨Optimumï¼Œè‡ªåŠ¨åŒ–å‚æ•°ä¼˜åŒ–æ¡†æ¶é‡‡ç”¨Optunaï¼ŒçŸ¥è¯†è’¸é¦ï¼ˆ<strong>KD</strong>ï¼‰çš„å°æ¨¡å‹ï¼ˆStudentæ¨¡å‹ï¼‰é‡‡ç”¨ckiplab/bert-tiny-chineseã€‚</p></blockquote><blockquote><p>ä¸‹è¡¨ä¸­çš„æ¨ç†æ€§èƒ½è¡¡é‡æŒ‡æ ‡ä¸ºæµ‹è¯•æ•°æ®é›†ä¸Šçš„å¹³å‡æ¨ç†æ—¶é—´ï¼Œå•ä½ms,æ¨ç†æ•ˆæœä¸ºæµ‹è¯•æ•°æ®é›†ä¸Šçš„weightedF1å€¼ã€‚</p></blockquote><table><thead><tr class="header"><th>æ¨¡å‹å‹ç¼©æ–¹æ¡ˆ</th><th>æ¨ç†æ€§èƒ½</th><th>æ¨ç†æ•ˆæœ</th><th>æ¨¡å‹å¤§å°</th></tr></thead><tbody><tr class="odd"><td>åŸå§‹BERTæ¨¡å‹</td><td>341.6</td><td>0.9737</td><td>~412MB</td></tr><tr class="even"><td>é‡åŒ–</td><td>215.1</td><td>0.9737</td><td>~152MB</td></tr><tr class="odd"><td>KD</td><td>45.55</td><td>0.9454</td><td>~46MB</td></tr><tr class="even"><td>KD+é‡åŒ–</td><td>35.4</td><td>0.9475</td><td>~12MB</td></tr></tbody></table><h2 id="æ€»ç»“">æ€»ç»“</h2><p>ç¬”è€…çš„ç ”ç©¶èµ·äºæ•´ç†ä¹‹å‰çš„æ¨¡å‹é‡åŒ–çš„ç¬”è®°ï¼Œç»è¿‡è¿™ä¸€æ®µæ—¶é—´çš„æ¢ç´¢ï¼Œå½¢æˆäº†è¿™ä¸€ç³»åˆ—çš„æ–‡ç« ï¼Œå·®ä¸å¤šå®Œæˆäº†ä»æ¨¡å‹è®­ç»ƒã€æ¨ç†åˆ°æ¨¡å‹å‹ç¼©çš„å®Œæ•´é“¾è·¯ã€‚å› æ­¤ï¼ŒBERTæ¨¡å‹æ–¹é¢çš„æ¢ç´¢å°†æš‚å‘Šä¸€æ®µè½ï¼Œåç»­å°†å¼€å§‹å¼€å§‹æ¢ç´¢å¤§æ¨¡å‹ï¼ˆLLMï¼‰ã€‚</p><p><strong>åœ¨ä¸ä¹…çš„å°†æ¥ï¼ŒBERTç³»åˆ—æ¨¡å‹å°†ç¼“ç¼“é€€å‡ºå†å²èˆå°ï¼ŒLLMç²‰å¢¨ç™»åœºï¼Œå¼•é¢†é£éªšï¼Œæˆä¸ºä¸‹ä¸€ä¸ªæ—¶ä»£çš„å¼„æ½®å„¿ã€‚æ—§ç‹é€€ä½ï¼Œæ–°ç‹ç™»åŸºï¼Œä¸€ä¸ªå´­æ–°çš„æ—¶ä»£å·²ç»æ›™å…‰åˆç°ï¼ŒäºæƒŠé¸¿ä¸€ç¥ä¸­å±•ç°äº†å®ƒè¿·äººçš„èº«å§¿å’Œæ— ç©·çš„é­…åŠ›ï¼Œæœªæ¥å®ƒçš„å…‰èŠ’å°†ç…§è€€æ¯ä¸€ä¸ªäººã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¨¡å‹é‡åŒ–</tag>
      
      <tag>çŸ¥è¯†è’¸é¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåäºŒï¼‰ä½¿ç”¨çŸ¥è¯†è’¸é¦æå‡æ¨¡å‹æ¨ç†æ€§èƒ½</title>
    <link href="/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BD%BF%E7%94%A8%E7%9F%A5%E8%AF%86%E8%92%B8%E9%A6%8F%E6%8F%90%E5%8D%87%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E6%80%A7%E8%83%BD/"/>
    <url>/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BD%BF%E7%94%A8%E7%9F%A5%E8%AF%86%E8%92%B8%E9%A6%8F%E6%8F%90%E5%8D%87%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E6%80%A7%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><center><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></center><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»æ¨¡å‹å‹ç¼©æ–¹æ³•â€”â€”çŸ¥è¯†è’¸é¦ï¼Œé€šè¿‡å¯¹è®­ç»ƒåçš„BERTæ¨¡å‹åœ¨å°æ¨¡å‹ä¸Šè¿›è¡Œè’¸é¦ï¼Œåœ¨å°æ¨¡å‹ä¸Šæåˆ°æ¨ç†æ€§èƒ½çš„æå¤§æå‡ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šè¿‡å¤šæŸå¤±æ¨¡å‹æ•ˆæœã€‚</p></blockquote><p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œ <ahref="https://github.com/scutan90/DeepLearning-500-questions/blob/master/ch17_%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E3%80%81%E5%8A%A0%E9%80%9F%E5%8F%8A%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%83%A8%E7%BD%B2/%E7%AC%AC%E5%8D%81%E4%B8%83%E7%AB%A0_%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E3%80%81%E5%8A%A0%E9%80%9F%E5%8F%8A%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%83%A8%E7%BD%B2.md">æ¨¡å‹å‹ç¼©</a>æ˜¯æŒ‡åˆ©ç”¨æ•°æ®é›†å¯¹å·²ç»è®­ç»ƒå¥½çš„æ·±åº¦æ¨¡å‹è¿›è¡Œç²¾ç®€ï¼Œè¿›è€Œå¾—åˆ°ä¸€ä¸ªè½»é‡ä¸”å‡†ç¡®ç‡ç›¸å½“çš„ç½‘ç»œï¼Œå‹ç¼©åçš„ç½‘ç»œå…·æœ‰æ›´å°çš„ç»“æ„å’Œæ›´å°‘çš„å‚æ•°ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½è®¡ç®—å’Œå­˜å‚¨å¼€é”€ï¼Œä¾¿äºéƒ¨ç½²åœ¨å—é™çš„ç¡¬ä»¶ç¯å¢ƒä¸­ã€‚</p><p>åœ¨å·¥ä¸šç•Œä¸­ï¼Œå¸¸è§çš„æ¨¡å‹å‹ç¼©æ–¹æ³•æœ‰<strong>çŸ¥è¯†è’¸é¦</strong>ï¼ˆKnowledgeDistillationï¼ŒKDï¼‰ã€<strong>å‰ªæ</strong>ï¼ˆPruningï¼‰ã€<strong>é‡åŒ–</strong>ï¼ˆQuantizationï¼‰ç­‰ã€‚</p><p>åœ¨æ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485516&amp;idx=1&amp;sn=79b9e17d05335f9283a2d4e0b5632456&amp;chksm=fcb9b1dccbce38ca8d35b27c33f7411499437d53ef32cd989c210495e4c9f42c155845245da8&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆå…­åä¸ƒï¼‰BERTæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPTDQï¼‰</a>å’Œ æ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485536&amp;idx=1&amp;sn=249981abe460822a997e4461c56d903a&amp;chksm=fcb9b1f0cbce38e6add3b44e0db721c21c3e4b57590f268dd4f853c11977c00ec74bb9e35818&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆå…­åå…«ï¼‰ä½¿ç”¨Optimumè¿›è¡Œæ¨¡å‹é‡åŒ–</a>ä¸­ï¼Œç¬”è€…å·²ç»ä»‹ç»äº†<strong>æ¨¡å‹é‡åŒ–</strong>ç›¸å…³çš„å†…å®¹ï¼Œæœ¬æ–‡å°†ä¼šä»‹ç»çŸ¥è¯†è’¸é¦ï¼ˆKDï¼‰ã€‚</p><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯<code>çŸ¥è¯†è’¸é¦</code>å‘¢ï¼Ÿ</p><h2 id="çŸ¥è¯†è’¸é¦ä»‹ç»">çŸ¥è¯†è’¸é¦ä»‹ç»</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆç®€å•åœ°äº†è§£ä¸‹<ahref="https://zhuanlan.zhihu.com/p/353472061">çŸ¥è¯†è’¸é¦æ¦‚å¿µ</a>ã€‚</p><blockquote><p>é€šå¸¸ï¼Œå¤§æ¨¡å‹å¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„ç½‘ç»œæˆ–å¤šä¸ªç½‘ç»œçš„ç»„åˆï¼Œè¡¨ç°å‡ºä¼˜è¶Šçš„æ•ˆæœå’Œæ³›åŒ–èƒ½åŠ›ã€‚è€Œå°æ¨¡å‹ç”±äºå…¶è¾ƒå°çš„è§„æ¨¡ï¼Œå…¶è¡¨è¾¾èƒ½åŠ›å¯èƒ½å—åˆ°é™åˆ¶ã€‚ä¸ºäº†æé«˜å°æ¨¡å‹çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¤§æ¨¡å‹æ‰€å­¦ä¹ åˆ°çš„çŸ¥è¯†æ¥æŒ‡å¯¼å°æ¨¡å‹çš„è®­ç»ƒã€‚è¿™æ ·ï¼Œå°æ¨¡å‹åœ¨å‚æ•°æ•°é‡æ˜æ˜¾å‡å°‘çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤Ÿè¾¾åˆ°ä¸å¤§æ¨¡å‹ç›¸ä¼¼çš„æ•ˆæœã€‚è¿™ç§ç­–ç•¥å°±æ˜¯çŸ¥è¯†è’¸é¦åœ¨æ¨¡å‹å‹ç¼©ä¸­çš„å®è·µåº”ç”¨ã€‚</p></blockquote><p><strong>Geoffrey Hinton</strong>åŠå…¶å›¢é˜Ÿåœ¨è®ºæ–‡<ahref="https://arxiv.org/pdf/1503.02531.pdf">Distilling the Knowledge ina NeuralNetwork</a>ä¸­é¦–æ¬¡æå‡ºäº†â€œçŸ¥è¯†è’¸é¦â€çš„æ€æƒ³ï¼Œè¿™æ˜¯çŸ¥è¯†è’¸é¦ä¸­çš„å¼€å±±ä¹‹ä½œï¼Œåˆ†é‡åè¶³ã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯é¦–å…ˆè®­ç»ƒä¸€ä¸ªå¤§å‹å¤æ‚çš„ç½‘ç»œï¼Œæ¥ç€åˆ©ç”¨è¿™ä¸ªå¤§ç½‘ç»œçš„è¾“å‡ºä»¥åŠæ•°æ®çš„çœŸå®æ ‡ç­¾æ¥è®­ç»ƒä¸€ä¸ªæ›´è½»é‡çº§çš„ç½‘ç»œã€‚åœ¨çŸ¥è¯†è’¸é¦çš„ç»“æ„ä¸­ï¼Œè¿™ä¸ªå¤§å‹ç½‘ç»œè¢«ç§°ä¸ºâ€œTeacherâ€æ¨¡å‹ï¼Œè€Œè½»é‡çº§ç½‘ç»œåˆ™è¢«ç§°ä¸ºâ€œStudentâ€æ¨¡å‹ã€‚</p><p>ç°é˜¶æ®µï¼ŒçŸ¥è¯†è’¸é¦å·²ç»æœ‰äº†é•¿è¶³çš„å‘å±•ï¼Œæ–¹æ³•ç¹å¤šã€‚å¸¸è§çš„<strong>çŸ¥è¯†è’¸é¦</strong>å¯åˆ†ä¸º<strong>ç›®æ ‡è’¸é¦</strong>å’Œ<strong>ç‰¹å¾è’¸é¦</strong>ã€‚</p><ul><li><strong>ç›®æ ‡è’¸é¦</strong>ï¼šStudentæ¨¡å‹åªå­¦ä¹ Teacheræ¨¡å‹çš„Logitsç»“æœçŸ¥è¯†ï¼Œä¸€èˆ¬ä¸ºSoftLogits</li><li><strong>ç‰¹å¾è’¸é¦</strong>ï¼šStudentæ¨¡å‹å­¦ä¹ Teacherç½‘ç»œç»“æ„ä¸­çš„ä¸­é—´å±‚ç‰¹å¾ï¼Œåˆ©ç”¨Teacheræ¨¡å‹çš„ä¿¡æ¯æ›´åŠ å……åˆ†ï¼Œè®­ç»ƒéš¾åº¦æ›´å¤§</li></ul><p>æœ¬æ–‡ä¸»è¦ä»‹ç»<strong>ç›®æ ‡è’¸é¦</strong>ï¼Œä¸€èˆ¬çš„<ahref="https://intellabs.github.io/distiller/knowledge_distillation.html">ç›®æ ‡è’¸é¦æ¨¡å‹ç»“æ„</a>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><imgsrc="https://intellabs.github.io/distiller/imgs/knowledge_distillation.png"alt="å›¾1ï¼šçŸ¥è¯†è’¸é¦æ¨¡å‹ç»“æ„" /><figcaption aria-hidden="true">å›¾1ï¼šçŸ¥è¯†è’¸é¦æ¨¡å‹ç»“æ„</figcaption></figure><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol type="1"><li>åœ¨åŸæœ‰è®­ç»ƒæ•°æ®é›†ä¸­è®­ç»ƒå¥½<strong>Teacheræ¨¡å‹</strong>ï¼Œä¸€èˆ¬ä¸ºå¤æ‚çš„ï¼ˆå¤§ï¼‰æ¨¡å‹ï¼›</li><li>å€ŸåŠ©æ¸©åº¦å‚æ•°ï¼ˆTemperatureï¼ŒTï¼‰å’ŒTeacheræ¨¡å‹çš„Logitsç»“æœï¼Œäº§ç”ŸSoftLabels;</li><li>åœ¨ç›¸åŒè®­ç»ƒé›†ä¸Šè®­ç»ƒå°æ¨¡å‹ï¼ˆ<strong>Studentæ¨¡å‹</strong>ï¼‰ï¼Œæœ€ç»ˆlossä¸º<strong>ä¸¤éƒ¨åˆ†lossçš„æƒé‡å’Œ</strong>ï¼šå¤§æ¨¡å‹çš„SoftLabelså’Œå°æ¨¡å‹çš„Soft Labelsï¼ˆPredictionsï¼‰çš„K-Llossï¼›å°æ¨¡å‹åœ¨æ•°æ®é›†ä¸Šçš„äº¤å‰ç†µæŸå¤±</li><li>ä½¿ç”¨è®­ç»ƒå¥½çš„å°æ¨¡å‹åšæœ€ç»ˆçš„æ¨¡å‹æ¨ç†ï¼ˆInferenceï¼‰</li></ol><p>è®©æˆ‘ä»¬æš‚æ—¶è„±ç¦»æ¨¡å‹æ¶æ„ï¼Œæ¥ç†è§£ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š<strong>Logits</strong>å’Œ<strong>Temperature</strong>.</p><h2 id="logits">Logits</h2><p><strong>Logits</strong>æŒ‡çš„æ˜¯åœ¨åˆ†ç±»æ¨¡å‹ç»“æ„ä¸­ï¼Œæœ€åçš„Softmaxå‡½æ•°ä½œç”¨å‰ï¼Œåœ¨å„ä¸ªæ ‡ç­¾ä¸Šçš„åˆ†æ•°z_iï¼Œç§°ä¸ºLogitsã€‚å½“Softmaxå‡½æ•°ä½œç”¨åœ¨Logitsä¸Šï¼Œä¼šå¾—åˆ°å„ä¸ªæ ‡ç­¾ä¸Šçš„æ¦‚ç‡å€¼p_iï¼Œæ€»å’Œä¸º1ã€‚</p><p>åŸºäºLogitsæ¦‚å¿µï¼Œå½“æˆ‘ä»¬çš„æ¦‚ç‡å€¼ä¸­åªæœ‰ä¸€ä¸ªä¸º1ï¼Œå…¶ä½™ä¸º0ï¼Œåˆ™ç§°è¿™äº›æ¦‚ç‡å€¼åˆ†å¸ƒä¸º<strong>Hard-Target</strong>ï¼›å…¶å®ƒæƒ…å†µä¸º<strong>Soft-Target</strong>ã€‚ä¸€èˆ¬ï¼ŒçœŸå®çš„æ ‡ç­¾è¡¨ç¤ºæ–¹æ³•ï¼ˆé€šå¸¸é‡‡ç”¨One-Hotè¡¨ç¤ºæ³•ï¼‰ä¸º<strong>Hard-Target</strong>ï¼Œåªæœ‰å‘½ä¸­çš„æ ‡ç­¾ä¸º1ï¼Œå…¶ä½™æ ‡ç­¾ä¸º0ï¼›è€Œæ¨¡å‹è®­ç»ƒäº§å‡ºçš„æ ‡ç­¾ç»“æœä¸º<strong>Soft-Target</strong>ï¼Œå› ä¸ºä¸å­˜åœ¨æ¦‚ç‡ä¸º1çš„æ ‡ç­¾ï¼Œåªæœ‰æ— é™æ¥è¿‘äº1çš„æ ‡ç­¾ã€‚</p><p>é€šè¿‡ä¸Šè¿°çš„çŸ¥è¯†è’¸é¦æ¨¡å‹ç»“æ„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒStudentæ¨¡å‹ä¼šåˆ©ç”¨Teacheræ¨¡å‹äº§ç”Ÿçš„<strong>Soft-Target</strong>ã€‚é‚£ä¹ˆï¼Œ<strong>Soft-Target</strong>æœ‰ä½•ç”¨å¤„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹ä¸ª<ahref="https://medium.com/%E5%AD%B8%E4%BB%A5%E5%BB%A3%E6%89%8D/soft-label-hard-label-844445950aba">Soft-Targetçš„ä¾‹å­</a>ã€‚</p><figure><imgsrc="https://miro.medium.com/v2/resize:fit:4800/format:webp/1*Iibl2UNT9HEm6-wDaF51KQ.png"alt="å›¾2: Soft Target &amp; Hard Target" /><figcaption aria-hidden="true">å›¾2: Soft Target &amp; HardTarget</figcaption></figure><p>è§‚å¯Ÿä¸Šé¢çš„ä¸¤ä¸ªæ ·æœ¬ï¼Œä»–ä»¬çš„çœŸå®æ ‡ç­¾å‡ä¸ºæ•°å­—2ï¼Œå› æ­¤<strong>Hard-Target</strong>ä¸€è‡´ã€‚ä½†æˆ‘ä»¬è§‚å¯Ÿå®ƒä»¬çš„<strong>Soft-Target</strong>ï¼Œç¬¬ä¸€ä¸ªå€¼çš„é¢„æµ‹ç»“æœä¸º2ï¼Œä½†åœ¨æ•°å­—3ä¸Šé¢çš„æ¦‚ç‡å€¼ä¼šæ¯”å…¶å®ƒæ•°å­—æ›´é«˜ï¼Œå› ä¸ºä»å›¾ç‰‡ä¸­çœ‹è¿™ä¸ªæ•°å­—2ï¼Œæœ‰ç‚¹åƒæ•°å­—3ï¼›åŒç†ï¼Œç¬¬äºŒä¸ªå€¼åœ¨æ•°å­—7ä¸Šçš„æ¦‚ç‡æ¯”å…¶å®ƒæ•°å­—æ›´é«˜ï¼Œæœ‰ç‚¹åƒæ•°å­—7ï¼Œè¿™ä»å›¾ç‰‡ä¸­ä¹Ÿèƒ½å¾—åˆ°åæ˜ ã€‚</p><p>å› æ­¤ï¼Œä¸<strong>Hard-Target</strong>ç›¸æ¯”ï¼Œ<strong>Soft-Target</strong>èƒ½å¤Ÿåæ˜ æ ·æœ¬ç‰¹å¾çš„æ›´å¤šä¿¡æ¯ï¼Œæœ‰å…¶åˆç†ä¹‹å¤„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åˆ©ç”¨Teacheræ¨¡å‹çš„<strong>Soft-Target</strong>ï¼Œå®ƒåœ¨<strong>Hard-Target</strong>ä¹‹å¤–ï¼Œè¿˜èƒ½å‘Šè¯‰Studentæ¨¡å‹æ›´å¤šå…³äºæ ·æœ¬çš„ç‰¹å¾ä¿¡æ¯ï¼Œå› æ­¤å¯¹Studentæ¨¡å‹æœ‰æŒ‡å¯¼æ„ä¹‰ã€‚</p><h2 id="temperature">Temperature</h2><p>é‚£ä¹ˆï¼ŒTeacheræ¨¡å‹çš„<strong>Soft-Target</strong>å¯¹Studentæ¨¡å‹æœ‰æŒ‡å¯¼æ„ä¹‰ï¼Œè¿˜èƒ½å†åŠ å¼º<strong>Soft-Target</strong>çš„ä½œç”¨å—ï¼Ÿå‚æ•°<strong>Temperature</strong>ä¾¿åº”è¿è€Œç”Ÿã€‚</p><p>å¯¹äºSoftmaxå‡½æ•°ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹å…¬å¼ï¼š</p><p><img src="https://s2.loli.net/2023/09/16/gjO6KGvfcT5xB24.png" /></p><p>å…¶ä¸­ï¼Œz_iä¸ºLogitså€¼ï¼Œp_iä¸ºæ¦‚ç‡å€¼ã€‚æˆ‘ä»¬å°†æ¸©åº¦ç³»æ•°Tä½œç”¨åœ¨è¯¥å…¬å¼ä¸­ï¼Œå¾—åˆ°ï¼š</p><p><img src="https://s2.loli.net/2023/09/16/Kn9dRT7yqX6ENZs.png" /></p><p>ç”±ä¸Šè¿°å…¬å¼ï¼Œæˆ‘ä»¬å¯å¾—åˆ°ï¼š</p><ul><li>éšç€Tçš„å¢å¤§ï¼Œå„ä¸ªæ¦‚ç‡å€¼å°†è¶‹å‘å¹³æ»‘ï¼ˆå½“Tä¸ºæ— ç©·å¤§æ—¶ï¼Œæ¦‚ç‡å€¼ç›¸åŒï¼‰ï¼Œå…¶åˆ†å¸ƒçš„ç†µè¶Šå¤§ï¼Œè´Ÿæ ‡ç­¾æºå¸¦çš„ä¿¡æ¯ä¼šè¢«ç›¸å¯¹åœ°æ”¾å¤§ï¼Œæ¨¡å‹è®­ç»ƒå°†æ›´åŠ å…³æ³¨è´Ÿæ ‡ç­¾</li><li>éšç€Tçš„å‡å°ï¼Œå„ä¸ªæ¦‚ç‡å€¼å°†è¶‹å‘é™¡å³­ï¼Œåˆ†å¸ƒçš„ç†µè¶Šå°ï¼Œè´Ÿæ ‡ç­¾æºå¸¦çš„ä¿¡æ¯è¢«ç›¸å¯¹æ”¾å°ï¼Œæ¨¡å‹è®­ç»ƒæ›´å°‘å…³æ³¨è´Ÿæ ‡ç­¾</li></ul><p>æˆ‘ä»¬æ¥åšä¸ªå°å°çš„å®éªŒï¼Œä»¥åŸå§‹Logitsåˆ†å¸ƒ[-1, 1, 3, 2,0.5]ä¸ºä¾‹ï¼Œè€ƒå¯Ÿæ¸©åº¦Tå¯¹æ¦‚ç‡å€¼åˆ†å¸ƒçš„å½±å“ï¼š</p><figure><img src="https://s2.loli.net/2023/09/16/bXp3Tq5jgWLGBQ1.png"alt="å›¾3: æ¸©åº¦Tå¯¹æ¦‚ç‡å€¼åˆ†å¸ƒçš„å½±å“" /><figcaption aria-hidden="true">å›¾3: æ¸©åº¦Tå¯¹æ¦‚ç‡å€¼åˆ†å¸ƒçš„å½±å“</figcaption></figure><p>Pythonå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> exp<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">softmax</span>(<span class="hljs-params">logit_list</span>):<br>    s_sum = <span class="hljs-built_in">sum</span>([exp(_) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> logit_list])<br>    <span class="hljs-keyword">return</span> [exp(_)/s_sum <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> logit_list]<br><br><br>logits = [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.5</span>]<br><br><span class="hljs-keyword">for</span> i, T <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>([<span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>]):<br>    post_logits = softmax([_/T <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> logits])<br>    <span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">3</span>:<br>        j = i + <span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> i == <span class="hljs-number">3</span>:<br>        j = i + <span class="hljs-number">2</span><br>    <span class="hljs-keyword">else</span>:<br>        j = i + <span class="hljs-number">3</span><br>    plt.subplot(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, j)<br>    plt.bar(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(post_logits)), post_logits, color=<span class="hljs-built_in">list</span>(<span class="hljs-string">&#x27;bbrbb&#x27;</span>))<br>    plt.title(<span class="hljs-string">f&quot;Temperature: <span class="hljs-subst">&#123;T&#125;</span>&quot;</span>)<br>    plt.xticks([])<br><br>plt.show()<br></code></pre></td></tr></table></figure><h2 id="ç†è®ºä»‹ç»">ç†è®ºä»‹ç»</h2><p>åœ¨<strong>çŸ¥è¯†è’¸é¦ä»‹ç»</strong>ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†çŸ¥è¯†è’¸é¦çš„æ¨¡å‹ç»“æ„å›¾ï¼ˆå›¾1ï¼‰ã€‚åŒæ—¶ï¼Œè¿˜ä»‹ç»äº†çŸ¥è¯†è’¸é¦çš„æ­¥éª¤ã€‚</p><ol type="1"><li>åœ¨åŸæœ‰è®­ç»ƒæ•°æ®é›†ä¸­è®­ç»ƒå¥½<strong>Teacheræ¨¡å‹</strong>ï¼Œä¸€èˆ¬ä¸ºå¤æ‚çš„ï¼ˆå¤§ï¼‰æ¨¡å‹ï¼›</li><li>å€ŸåŠ©æ¸©åº¦å‚æ•°ï¼ˆTemperatureï¼ŒTï¼‰å’ŒTeacheræ¨¡å‹çš„Logitsç»“æœï¼Œäº§ç”ŸSoftLabels;</li><li>åœ¨ç›¸åŒè®­ç»ƒé›†ä¸Šè®­ç»ƒå°æ¨¡å‹ï¼ˆ<strong>Studentæ¨¡å‹</strong>ï¼‰ï¼Œæœ€ç»ˆlossä¸º<strong>ä¸¤éƒ¨åˆ†lossçš„æƒé‡å’Œ</strong>ï¼šå¤§æ¨¡å‹çš„SoftLabelså’Œå°æ¨¡å‹çš„Soft Labelsï¼ˆPredictionsï¼‰çš„K-Llossï¼›å°æ¨¡å‹åœ¨æ•°æ®é›†ä¸Šçš„äº¤å‰ç†µæŸå¤±</li><li>ä½¿ç”¨è®­ç»ƒå¥½çš„å°æ¨¡å‹åšæœ€ç»ˆçš„æ¨¡å‹æ¨ç†ï¼ˆInferenceï¼‰</li></ol><p>ç¬¬1æ­¥ä¸ºå¸¸è§„çš„ï¼ˆå¤§ï¼‰æ¨¡å‹è®­ç»ƒï¼Œç¬¬2,3æ­¥è¢«ç§°ä¸º<strong>è’¸é¦</strong>ã€‚åœ¨2,3æ­¥ä¸­ï¼Œæœ€ç»ˆçš„è¾“å‡ºlossè¡¨ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2023/09/16/p6GvflMW2qtJSgw.png" /></p><p>å…¶ä¸­ï¼ŒTeacheræ¨¡å‹å’ŒStudentæ¨¡å‹çš„Soft Targetå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2023/09/16/dHWcrnASjeN9Khi.png" /></p><p>L_softä¸ºTeacheræ¨¡å‹å’ŒStudentæ¨¡å‹çš„Soft Targetçš„KL-Loss,L_hardä¸ºStudentæ¨¡å‹åœ¨è®­ç»ƒé›†çœŸå®æ ‡ç­¾ä¸Šçš„äº¤å‰ç†µã€‚æœ€ç»ˆLossä¸ºä¸¤éƒ¨åˆ†çš„æƒé‡å’Œã€‚</p><p>ç”±äºL_softè´¡çŒ®çš„æ¢¯åº¦å¤§çº¦ä¸ºL_hardçš„1/(T<sup>2)ï¼Œå› æ­¤åœ¨åŒæ—¶ä½¿ç”¨Soft-targetå’ŒHard-targetçš„æ—¶å€™ï¼Œéœ€è¦åœ¨L_softçš„æƒé‡ä¸Šä¹˜ä»¥T</sup>2ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯Soft-targetå’ŒHard-targetè´¡çŒ®çš„æ¢¯åº¦é‡åŸºæœ¬ä¸€è‡´ã€‚</p><p>å®éªŒå‘ç°ï¼Œå½“L_hardæƒé‡è¾ƒå°æ—¶ï¼Œèƒ½äº§ç”Ÿæœ€å¥½çš„æ•ˆæœï¼Œè¿™æ˜¯ä¸€ä¸ªç»éªŒæ€§çš„ç»“è®ºã€‚</p><h2 id="å®éªŒä»£ç ">å®éªŒä»£ç </h2><p>åœ¨æ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485678&amp;idx=1&amp;sn=e46f781dae394bd7a9381e20eedb04ab&amp;chksm=fcb9b17ecbce38689d6453d4f5b2d0b3cb89a8bcf33135d995c9ad92ff8bd6817fe70087e9ee&amp;token=475225731&amp;lang=zh_CN#rd">PyTorchå…¥é—¨ï¼ˆå…«ï¼‰Optunaçš„ä½¿ç”¨</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†ckiplab/bert-tiny-chineseæ¨¡å‹åœ¨Sougouå°æ ·æœ¬æ•°æ®é›†ä¸Šçš„åˆ†ç±»æ•ˆæœã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæ•°æ®é›†é‡‡ç”¨Sougouå°æ ·æœ¬æ•°æ®é›†ï¼ŒTeacheræ¨¡å‹é‡‡ç”¨BERTè®­ç»ƒï¼Œæ¨¡å‹åç§°ä¸º<strong>bert_base_sougou_trainer_128/checkpoint-96</strong>ï¼ŒStudentæ¨¡å‹é‡‡ç”¨<ahref="https://huggingface.co/ckiplab/bert-tiny-chinese">ckiplab/bert-tiny-chineseæ¨¡å‹</a>ã€‚å®éªŒè¿‡ç¨‹è¯¦ç»†ä»‹ç»å¦‚ä¸‹ï¼š</p><ul><li>å¯¼å…¥æ¨¡å‹åç§°</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">student_id = <span class="hljs-string">&quot;ckiplab/bert-tiny-chinese&quot;</span><br>teacher_id = <span class="hljs-string">&quot;./bert_base_sougou_trainer_128/checkpoint-96&quot;</span><br></code></pre></td></tr></table></figure><ul><li>éªŒè¯tokenizer</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer<br><br><span class="hljs-comment"># init tokenizer</span><br>teacher_tokenizer = AutoTokenizer.from_pretrained(teacher_id)<br>student_tokenizer = AutoTokenizer.from_pretrained(student_id)<br><br><span class="hljs-comment"># sample input</span><br>sample = <span class="hljs-string">&quot;è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬ä¾‹å­ï¼Œä½¿ç”¨ä¸åŒçš„æ±‰å­—è¿›è¡Œæµ‹è¯•ã€‚&quot;</span><br><br><span class="hljs-comment"># assert results</span><br><span class="hljs-built_in">print</span>(teacher_tokenizer(sample), student_tokenizer(sample))<br><span class="hljs-keyword">assert</span> teacher_tokenizer(sample) == student_tokenizer(sample), <span class="hljs-string">&quot;Tokenizers haven&#x27;t created the same output&quot;</span><br></code></pre></td></tr></table></figure><ul><li>åŠ è½½æ•°æ®é›†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># load dataset</span><br><span class="hljs-keyword">import</span> datasets<br>data_files = &#123;<span class="hljs-string">&quot;train&quot;</span>: <span class="hljs-string">&quot;./sougou/train.csv&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;./sougou/test.csv&quot;</span>&#125;<br>raw_datasets = datasets.load_dataset(<span class="hljs-string">&quot;csv&quot;</span>, data_files=data_files, delimiter=<span class="hljs-string">&quot;,&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>åŠ è½½tokenizerå¹¶å¯¹æ–‡æœ¬è¿›è¡Œtokenize</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer<br><br>tokenizer = AutoTokenizer.from_pretrained(teacher_id)<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DataCollatorWithPadding<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize_function</span>(<span class="hljs-params">sample</span>):<br>    <span class="hljs-keyword">return</span> tokenizer(sample[<span class="hljs-string">&#x27;text&#x27;</span>], max_length=<span class="hljs-number">128</span>, truncation=<span class="hljs-literal">True</span>)<br>tokenized_datasets = raw_datasets.<span class="hljs-built_in">map</span>(tokenize_function, batched=<span class="hljs-literal">True</span>)<br><br>data_collator = DataCollatorWithPadding(tokenizer=tokenizer)<br></code></pre></td></tr></table></figure><ul><li>åˆ›é€ çŸ¥è¯†è’¸é¦ç½‘ç»œçš„è®­ç»ƒå‚æ•°å’ŒTrainer</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TrainingArguments, Trainer<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DistillationTrainingArguments</span>(<span class="hljs-title class_ inherited__">TrainingArguments</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args, alpha=<span class="hljs-number">0.5</span>, temperature=<span class="hljs-number">2.0</span>, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>().__init__(*args, **kwargs)<br><br>        self.alpha = alpha<br>        self.temperature = temperature<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DistillationTrainer</span>(<span class="hljs-title class_ inherited__">Trainer</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args, teacher_model=<span class="hljs-literal">None</span>, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>().__init__(*args, **kwargs)<br>        self.teacher = teacher_model<br>        <span class="hljs-comment"># place teacher on same device as student</span><br>        self._move_model_to_device(self.teacher,self.model.device)<br>        self.teacher.<span class="hljs-built_in">eval</span>()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_loss</span>(<span class="hljs-params">self, model, inputs, return_outputs=<span class="hljs-literal">False</span></span>):<br><br>        <span class="hljs-comment"># compute student output</span><br>        outputs_student = model(**inputs)<br>        student_loss=outputs_student.loss<br>        <span class="hljs-comment"># compute teacher output</span><br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>          outputs_teacher = self.teacher(**inputs)<br><br>        <span class="hljs-comment"># assert size</span><br>        <span class="hljs-keyword">assert</span> outputs_student.logits.size() == outputs_teacher.logits.size()<br><br>        <span class="hljs-comment"># Soften probabilities and compute distillation loss</span><br>        loss_function = nn.KLDivLoss(reduction=<span class="hljs-string">&quot;batchmean&quot;</span>)<br>        loss_logits = (loss_function(<br>            F.log_softmax(outputs_student.logits / self.args.temperature, dim=-<span class="hljs-number">1</span>),<br>            F.softmax(outputs_teacher.logits / self.args.temperature, dim=-<span class="hljs-number">1</span>)) * (self.args.temperature ** <span class="hljs-number">2</span>))<br>        <span class="hljs-comment"># Return weighted student loss</span><br>        loss = self.args.alpha * student_loss + (<span class="hljs-number">1.</span> - self.args.alpha) * loss_logits<br>        <span class="hljs-keyword">return</span> (loss, outputs_student) <span class="hljs-keyword">if</span> return_outputs <span class="hljs-keyword">else</span> loss<br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®è®­ç»ƒå‚æ•°ï¼ŒåŠ è½½æ¨¡å‹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSequenceClassification<br><br><span class="hljs-comment"># define training args</span><br>training_args = DistillationTrainingArguments(<br>    output_dir=<span class="hljs-string">&#x27;kd_sougou_trainer_128&#x27;</span>,<br>    evaluation_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>    per_device_train_batch_size=<span class="hljs-number">32</span>,<br>    per_device_eval_batch_size=<span class="hljs-number">32</span>,<br>    learning_rate=<span class="hljs-number">5e-5</span>,<br>    num_train_epochs=<span class="hljs-number">5</span>,<br>    warmup_ratio=<span class="hljs-number">0.2</span>,<br>    logging_dir=<span class="hljs-string">&#x27;./sougou_train_logs&#x27;</span>,<br>    logging_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>    save_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>    report_to=<span class="hljs-string">&quot;tensorboard&quot;</span>,<br>    <span class="hljs-comment"># distilation parameters</span><br>    alpha=<span class="hljs-number">0.5</span>,<br>    temperature=<span class="hljs-number">1.0</span><br>    )<br><br><span class="hljs-comment"># define model</span><br>teacher_model = AutoModelForSequenceClassification.from_pretrained(<br>    teacher_id,<br>    num_labels=<span class="hljs-number">5</span><br>)<br><br><span class="hljs-comment"># define student model</span><br>student_model = AutoModelForSequenceClassification.from_pretrained(<br>    student_id,<br>    num_labels=<span class="hljs-number">5</span><br>)<br></code></pre></td></tr></table></figure><ul><li>åˆ›é€ å‡†ç¡®ç‡è®¡ç®—æŒ‡æ ‡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score, precision_recall_fscore_support<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_metrics</span>(<span class="hljs-params">pred</span>):<br>    labels = pred.label_ids<br>    preds = pred.predictions.argmax(-<span class="hljs-number">1</span>)<br>    precision, recall, f1, _ = precision_recall_fscore_support(labels, preds, average=<span class="hljs-string">&#x27;weighted&#x27;</span>)<br>    acc = accuracy_score(labels, preds)<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&#x27;accuracy&#x27;</span>: acc,<br>        <span class="hljs-string">&#x27;f1&#x27;</span>: f1,<br>        <span class="hljs-string">&#x27;precision&#x27;</span>: precision,<br>        <span class="hljs-string">&#x27;recall&#x27;</span>: recall<br>    &#125;<br></code></pre></td></tr></table></figure><ul><li>Trainerç±»å®ä¾‹åŒ–ï¼Œè¿›è¡Œæ•´ç†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">trainer = DistillationTrainer(<br>    student_model,<br>    training_args,<br>    teacher_model=teacher_model,<br>    train_dataset=tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],<br>    eval_dataset=tokenized_datasets[<span class="hljs-string">&quot;test&quot;</span>],<br>    data_collator=data_collator,<br>    tokenizer=tokenizer,<br>    compute_metrics=compute_metrics,<br>)<br><br>trainer.train()<br></code></pre></td></tr></table></figure><h2 id="å®éªŒç»“æœ">å®éªŒç»“æœ</h2><p>åœ¨ä¸Šè¿°çš„å®éªŒä»£ç ä¸‹ï¼Œæˆ‘ä»¬åˆ†åˆ«å¯¹å•ç‹¬Studentæ¨¡å‹è®­ç»ƒã€è’¸é¦è¿‡ç¨‹ã€å•ç‹¬Studentæ¨¡å‹Optunaå‚æ•°ä¼˜åŒ–ã€è’¸é¦è¿‡ç¨‹Optunaå‚æ•°ä¼˜åŒ–è¿›è¡Œå®éªŒï¼Œç»Ÿè®¡åœ¨æµ‹è¯•é›†ä¸Šçš„WeightedF1å€¼ï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹</th><th>Weighted F1</th></tr></thead><tbody><tr class="odd"><td>Teacheræ¨¡å‹ï¼ˆå•ç‹¬ï¼‰</td><td>0.9737</td></tr><tr class="even"><td>Studentæ¨¡å‹ï¼ˆå•ç‹¬ï¼‰</td><td>0.9050</td></tr><tr class="odd"><td>è’¸é¦</td><td>0.9050</td></tr><tr class="even"><td>Studentæ¨¡å‹ï¼ˆå•ç‹¬ï¼Œå‚æ•°ä¼˜åŒ–ï¼‰</td><td>0.9331</td></tr><tr class="odd"><td>è’¸é¦ï¼ˆå‚æ•°ä¼˜åŒ–ï¼‰</td><td>0.9454</td></tr></tbody></table><p>åœ¨æœ¬åœ°å®éªŒä¸­ï¼Œå¦‚æœä¸è¿›è¡Œå‚æ•°ä¼˜åŒ–ï¼Œåˆ™è’¸é¦çš„æ•ˆæœä¸ä¸€å®šä¼šæ¯”å•ç‹¬è®­ç»ƒStudentæ¨¡å‹æ•ˆæœæ¥å¾—å¥½ï¼›ä½†è¿›è¡Œå‚æ•°ä¼˜åŒ–åï¼Œè’¸é¦æ•ˆæœä¼˜äºå•ç‹¬è®­ç»ƒStudentæ¨¡å‹ï¼Œä¸”åªæ¯”Teacheræ¨¡å‹ä¸‹é™äº†2.8%ã€‚</p><p>å¯¹æ¯”è’¸é¦åçš„å°æ¨¡å‹å’ŒTeacheræ¨¡å‹çš„å¹³å‡æ¨ç†æ—¶é—´ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>åŸºåº§æ¨¡å‹</th><th>æ¨ç†æ—¶é—´ï¼ˆmsï¼‰</th><th>æ¨¡å‹å¤§å°</th></tr></thead><tbody><tr class="odd"><td>bert-base-chinse</td><td>341.5</td><td>~412MB</td></tr><tr class="even"><td>bert-tiny-chineseï¼ˆè’¸é¦åï¼‰</td><td>45.55</td><td>~46MB</td></tr></tbody></table><p>æ¨ç†é€Ÿåº¦æå‡äº†7.5å€ï¼Œè¿™æ¯”é‡åŒ–ç­–ç•¥çš„æå‡1.8å€å¼ºå¤ªå¤šäº†ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œä¸»è¦ä»‹ç»äº†çŸ¥è¯†è’¸é¦çš„åŸºæœ¬æ¦‚å¿µå’ŒåŸç†ï¼Œå¹¶é€šè¿‡ç¬”è€…è‡ªå·±çš„äº²èº«è¯•éªŒï¼ŒéªŒè¯äº†çŸ¥è¯†è’¸é¦çš„æœ‰æ•ˆæ€§ï¼Œåœ¨ç¨å¾®é™ä½æ¨¡å‹æ•ˆæœçš„å‰æä¸‹ï¼Œæ¨¡å‹çš„æ¨ç†é€Ÿåº¦è·å¾—äº†æå¤§æå‡ã€‚</p><p>æœ¬é¡¹ç›®å·²å¼€æºè‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/dynamic_quantization_on_bert">https://github.com/percent4/dynamic_quantization_on_bert</a>.</p><h4 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»</h4><ul><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485678&amp;idx=1&amp;sn=e46f781dae394bd7a9381e20eedb04ab&amp;chksm=fcb9b17ecbce38689d6453d4f5b2d0b3cb89a8bcf33135d995c9ad92ff8bd6817fe70087e9ee&amp;token=475225731&amp;lang=zh_CN#rd">PyTorchå…¥é—¨ï¼ˆå…«ï¼‰Optunaçš„ä½¿ç”¨</a></li><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485516&amp;idx=1&amp;sn=79b9e17d05335f9283a2d4e0b5632456&amp;chksm=fcb9b1dccbce38ca8d35b27c33f7411499437d53ef32cd989c210495e4c9f42c155845245da8&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆå…­åä¸ƒï¼‰BERTæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPTDQï¼‰</a></li><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485508&amp;idx=1&amp;sn=77a6fef8cfb11a604e19de303576539f&amp;chksm=fcb9b1d4cbce38c24cd92793bcc734684a8a5bc6c4a94d4473328158a5f7e95373f1da4ce2e2&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆå…­åå…­ï¼‰ä½¿ç”¨HuggingFaceä¸­çš„Trainerè¿›è¡ŒBERTæ¨¡å‹å¾®è°ƒ</a></li><li><ahref="https://www.philschmid.de/knowledge-distillation-bert-transformers">Task-specificknowledge distillation for BERT using Transformers &amp; AmazonSageMaker</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çŸ¥è¯†è’¸é¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåä¸€ï¼‰å¤§æ¨¡å‹å¾®è°ƒRACEæ•°æ®é›†çš„è¿›ä¸€æ­¥å®éªŒ</title>
    <link href="/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%B8%80%EF%BC%89%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83RACE%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%AE%9E%E9%AA%8C/"/>
    <url>/2024/01/10/NLP%EF%BC%88%E4%B8%83%E5%8D%81%E4%B8%80%EF%BC%89%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83RACE%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%AE%9E%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><center><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></center><blockquote><p>åœ¨æ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485636&amp;idx=1&amp;sn=bee1e493374be774b0ca357dcd2ae9da&amp;chksm=fcb9b154cbce384294cdbc8e0329604292b5f4a731ed3f44c03f5db177e44b5aa95880ada68b&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆä¸ƒåï¼‰ä½¿ç”¨LLAMA2æ¨¡å‹å¾®è°ƒMultiple Choice MRC</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†RACEæ•°æ®é›†ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨LLAMA2æ¨¡å‹å¯¹è¯¥æ•°æ®é›†è¿›è¡Œå¾®è°ƒï¼Œè¾ƒä»¥å¾€çš„BERTç³»åˆ—æ¨¡å‹å–å¾—äº†é•¿è¶³è¿›æ­¥ã€‚</p></blockquote><p>æœ¬æ–‡å°†ç»§ç»­ä¸Šè¿°å®éªŒã€‚</p><h2 id="å®éªŒ">å®éªŒ</h2><p>æˆ‘ä»¬çš„å®éªŒä½¿ç”¨<code>Firefly</code>å¤§æ¨¡å‹è®­ç»ƒæ¡†æ¶ï¼Œæ•°æ®é›†ä¸ºRACEmiddleæ•°æ®é›†ï¼Œè®­ç»ƒå‚æ•°åœ¨<ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485636&amp;idx=1&amp;sn=bee1e493374be774b0ca357dcd2ae9da&amp;chksm=fcb9b154cbce384294cdbc8e0329604292b5f4a731ed3f44c03f5db177e44b5aa95880ada68b&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆä¸ƒåï¼‰ä½¿ç”¨LLAMA2æ¨¡å‹å¾®è°ƒMultiple Choice MRC</a> ä¸­å·²ç»ç»™å‡ºã€‚</p><p>å¾®è°ƒæ–¹å¼é‡‡ç”¨<code>å¤§æ¨¡å‹ + qlora</code>, å¯¹æ•°æ®é›†è¿›è¡ŒSFT(SupervisedFine-Tuning)ã€‚é’ˆå¯¹ä¸åŒçš„æ¨¡å‹ã€æ¨¡å‹å°ºå¯¸ã€å­¦ä¹ ç‡ã€æœ€å¤§é•¿åº¦ç­‰å‚æ•°è¿›è¡Œè°ƒè¯•ï¼ˆå…¶ä½™å‚æ•°ä¸å˜ï¼‰ï¼Œå®éªŒç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹</th><th>å­¦ä¹ ç‡</th><th>è®­ç»ƒè½®æ•°</th><th>æœ€å¤§é•¿åº¦</th><th>å‡†ç¡®ç‡</th></tr></thead><tbody><tr class="odd"><td>LLAMA-2-7B</td><td>1e-4</td><td>3</td><td>384</td><td>0.8691</td></tr><tr class="even"><td>LLAMA-2-7B</td><td>1e-4</td><td>3</td><td>320</td><td>0.8593</td></tr><tr class="odd"><td>LLAMA-2-7B</td><td>1e-4</td><td>5</td><td>384</td><td>0.8545</td></tr><tr class="even"><td>LLAMA-2-7B</td><td>1e-4</td><td>5</td><td>320</td><td>0.8538</td></tr><tr class="odd"><td>LLAMA-2-13B</td><td>1e-4</td><td>3</td><td>384</td><td>0.8844</td></tr><tr class="even"><td>Baichuan-7B</td><td>2e-4</td><td>3</td><td>384</td><td>0.8357</td></tr><tr class="odd"><td>Baichuan-13B-Chat</td><td>1e-4</td><td>3</td><td>384</td><td>0.8726</td></tr><tr class="even"><td>Baichuan2-13B-Base</td><td>2e-4</td><td>3</td><td>384</td><td><strong>0.8948</strong></td></tr><tr class="odd"><td>XVERSE-13B</td><td>1e-4</td><td>3</td><td>384</td><td>0.8718</td></tr></tbody></table><p>åœ¨ä¸Šè¿°å®éªŒä¸­ï¼Œ<code>LLAMA-2-13B</code>,<code>Baichuan-13B-Chat</code>, <code>Baichuan2-13B-Base</code>,<code>XVERSE-13B</code>æ¨¡å‹å–å¾—äº†ä¸é”™çš„æ•ˆæœï¼Œå°¤å…¶<code>Baichuan2-13B-Base</code>æ•ˆæœæœ€å¥½ï¼Œaccuracyè¾¾åˆ°äº†89.48%ã€‚</p><p>æˆ‘ä»¬å¯¹<code>LLAMA-2-13B + Baichuan2-13B-Base + XVERSE-13B</code>è¿›è¡Œæ¨¡å‹é›†æˆï¼ˆå–é¢„æµ‹ç»“æœä¸­çš„æ¬¡æ•°æœ€å¤§å€¼ï¼Œå¦‚æœéƒ½ç›¸åŒï¼Œåˆ™ä»¥Baichuan2-13B-Baseçš„ç»“æœä¸ºå‡†ï¼‰ï¼Œaccuracyä¸º90.25%ï¼</p><p>ä½¿ç”¨å…¨é‡RACEæ•°æ®ä¸­çš„è®­ç»ƒé›†è¿›è¡Œè®­ç»ƒï¼Œä½¿ç”¨LLAMA-2-13Bï¼Œå­¦ä¹ ç‡1e-4ï¼Œè½®æ•°3ï¼Œæœ€å¤§é•¿åº¦384ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æµ‹è¯•é›†</th><th>å‡†ç¡®ç‡</th></tr></thead><tbody><tr class="odd"><td>middle</td><td>0.9283</td></tr><tr class="even"><td>high</td><td>0.8413</td></tr><tr class="odd"><td>all</td><td>0.8666</td></tr></tbody></table><p>æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œåœ¨ä»¥å¾€BERTæ—¶ä»£ï¼Œ<ahref="https://paperswithcode.com/sota/reading-comprehension-on-race">RACEæ•°æ®é›†æ’è¡Œæ¦œ</a>ï¼š</p><p><img src="https://s2.loli.net/2023/09/10/9LMe2PdmZNKcCbo.png" /></p><h2 id="å¯è§†åŒ–">å¯è§†åŒ–</h2><p>æˆ‘ä»¬ä½¿ç”¨<code>Gradio</code>æ¨¡å—ï¼Œå¯¹æ–‡ç« ã€é—®é¢˜ã€é€‰é¡¹è¿›è¡Œå¯è§†åŒ–é—®ç­”ï¼Œé¡µé¢æ•ˆæœï¼š</p><p><img src="https://s2.loli.net/2023/09/15/BYWr4KSoG8lfwIQ.png" /></p><p>å®ç°çš„Pythonä»£ç å¯ä»¥å‚è€ƒå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer<br><span class="hljs-keyword">import</span> torch<br><br><br><span class="hljs-keyword">import</span> sys<br>sys.path.append(<span class="hljs-string">&quot;../../&quot;</span>)<br><span class="hljs-keyword">from</span> component.utils <span class="hljs-keyword">import</span> ModelUtils<br><br><span class="hljs-comment"># ä½¿ç”¨åˆå¹¶åçš„æ¨¡å‹è¿›è¡Œæ¨ç†</span><br>model_name_or_path = <span class="hljs-string">&#x27;/home/jclian91/experiment/Firefly/script/checkpoint/firefly-llama2-7b-qlora-sft-race-merge&#x27;</span><br><span class="hljs-comment"># ç”Ÿæˆè¶…å‚é…ç½®</span><br>max_new_tokens = <span class="hljs-number">1</span><br>top_p = <span class="hljs-number">0.9</span><br>temperature = <span class="hljs-number">0.01</span><br>repetition_penalty = <span class="hljs-number">1.0</span><br>device = <span class="hljs-string">&#x27;cuda:0&#x27;</span><br><span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>model = ModelUtils.load_model(<br>    model_name_or_path,<br>    load_in_4bit=<span class="hljs-literal">False</span>,<br>    adapter_name_or_path=<span class="hljs-literal">None</span><br>).<span class="hljs-built_in">eval</span>()<br>tokenizer = AutoTokenizer.from_pretrained(<br>    model_name_or_path,<br>    trust_remote_code=<span class="hljs-literal">True</span>,<br>    <span class="hljs-comment"># llamaä¸æ”¯æŒfast</span><br>    use_fast=<span class="hljs-literal">False</span> <span class="hljs-keyword">if</span> model.config.model_type == <span class="hljs-string">&#x27;llama&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">True</span><br>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;load model: <span class="hljs-subst">&#123;model_name_or_path&#125;</span>&quot;</span>)<br><br><br><span class="hljs-comment"># Gradio app</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>(<span class="hljs-params">passage, question, options</span>):<br><span class="hljs-comment"># make prompt</span><br>    prefix = <span class="hljs-string">&#x27;Read the following passage and questions, then choose the right answer from options, &#x27;</span> \<br>             <span class="hljs-string">&#x27;the answer should be one of A, B, C, D.\n\n&#x27;</span><br>    passage = <span class="hljs-string">f&#x27;&lt;passage&gt;:\n<span class="hljs-subst">&#123;passage&#125;</span>\n\n&#x27;</span><br>    question = <span class="hljs-string">f&#x27;&lt;question&gt;:\n<span class="hljs-subst">&#123;question&#125;</span>\n\n&#x27;</span><br>    option1, option2, option3, option3 = options.split(<span class="hljs-string">&quot;\n&quot;</span>)<br>    option = <span class="hljs-string">f&#x27;&lt;options&gt;:\n<span class="hljs-subst">&#123;option1.strip()&#125;</span>\n<span class="hljs-subst">&#123;option2.strip()&#125;</span>\n<span class="hljs-subst">&#123;option3.strip()&#125;</span>\n<span class="hljs-subst">&#123;option3.strip()&#125;</span>\n\n&#x27;</span><br>    suffix = <span class="hljs-string">f&quot;&lt;answer&gt;:\n&quot;</span><br>    prompt = <span class="hljs-string">&#x27;&#x27;</span>.join([prefix, passage, question, option, suffix])<br>    <span class="hljs-comment"># get input ids</span><br>    input_ids = tokenizer(prompt, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>, add_special_tokens=<span class="hljs-literal">False</span>).input_ids.to(device)<br>    bos_token_id = torch.tensor([[tokenizer.bos_token_id]], dtype=torch.long).to(device)<br>    eos_token_id = torch.tensor([[tokenizer.eos_token_id]], dtype=torch.long).to(device)<br>    input_ids = torch.concat([bos_token_id, input_ids, eos_token_id], dim=<span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># model predict</span><br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        outputs = model.generate(<br>            input_ids=input_ids, max_new_tokens=max_new_tokens, do_sample=<span class="hljs-literal">True</span>,<br>            top_p=top_p, temperature=temperature, repetition_penalty=repetition_penalty,<br>            eos_token_id=tokenizer.eos_token_id<br>        )<br>    outputs = outputs.tolist()[<span class="hljs-number">0</span>][<span class="hljs-built_in">len</span>(input_ids[<span class="hljs-number">0</span>]):]<br>    response = tokenizer.decode(outputs)<br>    response = response.strip().replace(tokenizer.eos_token, <span class="hljs-string">&quot;&quot;</span>).strip()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;The answer is <span class="hljs-subst">&#123;response&#125;</span>.&quot;</span><br><br><br><span class="hljs-keyword">with</span> gr.Blocks() <span class="hljs-keyword">as</span> demo:<br>    <span class="hljs-comment"># è®¾ç½®è¾“å…¥ç»„ä»¶</span><br>    gr_passage = gr.Textbox(lines=<span class="hljs-number">3</span>, placeholder=<span class="hljs-string">&quot;Passage&quot;</span>, label=<span class="hljs-string">&quot;Passage&quot;</span>)<br>    gr_question = gr.Textbox(lines=<span class="hljs-number">1</span>, placeholder=<span class="hljs-string">&quot;question&quot;</span>, label=<span class="hljs-string">&quot;question&quot;</span>)<br>    gr_options = gr.Textbox(lines=<span class="hljs-number">4</span>, placeholder=<span class="hljs-string">&quot;options&quot;</span>, label=<span class="hljs-string">&quot;options&quot;</span>)<br>    <span class="hljs-comment"># è®¾ç½®è¾“å‡ºç»„ä»¶</span><br>    answer = gr.Textbox(label=<span class="hljs-string">&quot;Answer&quot;</span>)<br>    <span class="hljs-comment"># è®¾ç½®æŒ‰é’®</span><br>    greet_btn = gr.Button(<span class="hljs-string">&quot;Show me the answer&quot;</span>)<br>    <span class="hljs-comment"># è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span><br>    greet_btn.click(fn=predict,<br>                    inputs=[gr_passage, gr_question, gr_options],<br>                    outputs=answer)<br><br>demo.launch(share=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ¬æ–‡å¹¶æ— å¤ªå¤šæ–°æ„ï¼Œåªæ˜¯åœ¨ä¹‹å‰æ–‡ç« çš„åŸºç¡€ä¸Šè¿›è¡Œå¤§é‡æµ‹è¯•ï¼Œè€ƒå¯Ÿä¸åŒæ¨¡å‹ï¼Œæ¨¡å‹å°ºå¯¸åœ¨SFTä¸Šçš„æ•ˆæœå·®å¼‚ï¼ŒåŒæ—¶ä¹ŸéªŒè¯äº†ï¼Œå¤§æ¨¡å‹æ—¶ä»£ä¸­LLMçš„å¼ºå¤§ä¹‹å¤„ï¼Œ<strong>åœ¨æ•ˆæœä¸Šå‡ ä¹æ¨ªæ‰«ä»¥å¾€æ‰€æœ‰çš„NLPæ¨¡å‹</strong>ï¼Œä¸”<strong>å°†ä»¥å¾€çš„NLPä»»åŠ¡åšåˆ°äº†ç»Ÿä¸€</strong>ï¼Œè¿™æ‰æ˜¯LLMçš„å¯æ€•ä¹‹å¤„ï¼</p><p>æœ¬æ–‡çš„ä»£ç åŠå®éªŒç»“æœå·²å¼€æ”¾è‡³Githubï¼Œç½‘å€ä¸º <ahref="https://github.com/percent4/llama-2-multiple-choice-mrc">https://github.com/percent4/llama-2-multiple-choice-mrc</a>.</p><p>æœ¬äººåšå®¢ç½‘ç«™ä¸º <ahref="https://percent4.github.io/">https://percent4.github.io/</a>ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®~</p><h4 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»</h4><ul><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485636&amp;idx=1&amp;sn=bee1e493374be774b0ca357dcd2ae9da&amp;chksm=fcb9b154cbce384294cdbc8e0329604292b5f4a731ed3f44c03f5db177e44b5aa95880ada68b&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆä¸ƒåï¼‰ä½¿ç”¨LLAMA2æ¨¡å‹å¾®è°ƒMultiple Choice MRC</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LLM</tag>
      
      <tag>RACEæ•°æ®é›†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonä»£ç æ•´æ´ä¹‹é“åŠä»£ç æ³¨é‡Š</title>
    <link href="/2024/01/10/Python%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93%E5%8F%8A%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A/"/>
    <url>/2024/01/10/Python%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93%E5%8F%8A%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä»£ç è§„èŒƒ">ä»£ç è§„èŒƒ</h2><p>Pythonä»£ç è§„èŒƒéµå¾ª<a href="https://peps.python.org/pep-0008/">PEP8é£æ ¼</a>ã€‚</p><p>ä»¥ä¸‹æ˜¯Pythonä»£ç ä¸éµå¾ªè§„èŒƒçš„ä¾‹å­ï¼š</p><ul><li>åŒæ—¶å¯¼å…¥ä¸¤ä¸ªæ¨¡å—</li><li>å‡½æ•°å‚æ•°èµ‹å€¼æ—¶ï¼Œ=ä¸¤è¾¹ç©ºæ ¼</li><li>ä»£ç ä¸­å­˜åœ¨;</li><li>å‡½æ•°å‰åªç©ºäº†ä¸€è¡Œ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys, os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">complex</span>(<span class="hljs-params">real, imag = <span class="hljs-number">0.0</span></span>):<br>    <span class="hljs-keyword">return</span> magic(r = real, i = imag)<br>    <br>a = <span class="hljs-number">1</span>; b =<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—è¿›è¡Œä»£ç è§„èŒƒåŒ–ï¼Œä½¿å¾—ä»£ç éµå¾ªè§„èŒƒã€‚å¸¸è§çš„ç¬¬ä¸‰æ–¹å·¥å…·æœ‰<code>autopep8</code>,<code>yapf</code>ç­‰ã€‚</p><p>åœ¨PyCharmè®¾ç½®ä¸­ï¼Œé€‰æ‹©Toolsä¸­çš„External Tools,ç‚¹å‡»å³è¾¹çš„+å·è¿›è¡Œå¤–éƒ¨å·¥å…·é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2023/09/15/g2sp4fOeyvxlzSW.png"alt="python_comment1_2.png" /><figcaption aria-hidden="true">python_comment1_2.png</figcaption></figure><p>æ­¤æ—¶ï¼Œåœ¨PyCharmçš„å·¥å…·æ ä¸Šæ–¹ï¼Œé€‰æ‹©Tools --&gt; External Tools --&gt;autopep8ï¼Œå³å¯å¯¹ä¸Šè¿°ä»£ç è¿›è¡Œè§„èŒƒåŒ–ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">complex</span>(<span class="hljs-params">real, imag=<span class="hljs-number">0.0</span></span>):<br>    <span class="hljs-keyword">return</span> magic(r=real, i=imag)<br><br><br>a = <span class="hljs-number">1</span><br>b = <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h2 id="ä»£ç æ³¨é‡Š">ä»£ç æ³¨é‡Š</h2><p>Pythonä»£ç æ³¨é‡Šçš„5ç§å¸¸è§é£æ ¼ï¼š</p><ul><li>Plain</li><li>Epytest</li><li>reStructuredText</li><li>Numpy</li><li>Google</li></ul><p>å„ç§ä»£ç æ³¨é‡Šçš„é£æ ¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p>Plainé£æ ¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    c = a + b<br>    <span class="hljs-keyword">return</span> c<br></code></pre></td></tr></table></figure><p>Epytesté£æ ¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    @param a: </span><br><span class="hljs-string">    @param b: </span><br><span class="hljs-string">    @return: </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    c = a + b<br>    <span class="hljs-keyword">return</span> c<br></code></pre></td></tr></table></figure><p>reStructuredTexté£æ ¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    :param a: </span><br><span class="hljs-string">    :param b: </span><br><span class="hljs-string">    :return: </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    c = a + b<br>    <span class="hljs-keyword">return</span> c<br></code></pre></td></tr></table></figure><p>Numpyé£æ ¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    Parameters</span><br><span class="hljs-string">    ----------</span><br><span class="hljs-string">    a</span><br><span class="hljs-string">    b</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns</span><br><span class="hljs-string">    -------</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    c = a + b<br>    <span class="hljs-keyword">return</span> c<br></code></pre></td></tr></table></figure><p>Googleé£æ ¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        a:</span><br><span class="hljs-string">        b:</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    c = a + b<br>    <span class="hljs-keyword">return</span> c<br></code></pre></td></tr></table></figure><p>åœ¨PyCharmä¸­è®¾ç½®Pythonä»£ç é£æ ¼å¦‚ä¸‹ï¼Œä¹‹ååœ¨å‡½æ•°ä¸­è¾“å…¥ä¸‰ä¸ªè‹±æ–‡å¼•å·ï¼ŒæŒ‰ä¸‹Enteré”®ï¼Œå³å¯çœ‹åˆ°ä¸Šè¿°çš„ä»£ç æ³¨é‡Šã€‚</p><figure><img src="https://s2.loli.net/2023/09/15/R9fw56L1CDxlon3.png"alt="Pythonä»£ç æ³¨é‡Š" /><figcaption aria-hidden="true">Pythonä»£ç æ³¨é‡Š</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆå…«ï¼‰Optunaçš„ä½¿ç”¨</title>
    <link href="/2024/01/10/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89Optuna%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/01/10/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89Optuna%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»æœºå™¨å­¦ä¹ é¢†åŸŸçš„è‡ªåŠ¨åŒ–è¶…å‚ä¼˜åŒ–è½¯ä»¶æ¡†æ¶â€”â€”<code>Optuna</code>ï¼Œå®ƒèƒ½åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè®©æˆ‘ä»¬ä¸“æ³¨äºæ¨¡å‹å®ç°ï¼Œå› ä¸ºå®ƒè®©è¶…å‚ä¼˜åŒ–å˜å¾—æ›´åŠ ç®€æ´ã€é«˜æ•ˆï¼</p></blockquote><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><center><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></center><h2 id="optuna-ä»‹ç»">Optuna ä»‹ç»</h2><p><a href="https://optuna.org/">Optuna</a>æ˜¯ä¸€ä¸ªç‰¹åˆ«ä¸ºæœºå™¨å­¦ä¹ è®¾è®¡çš„å¼€æºçš„è‡ªåŠ¨è¶…å‚æ•°ä¼˜åŒ–è½¯ä»¶æ¡†æ¶ï¼ˆhyperparameteroptimization frameworkï¼‰ã€‚å®ƒå…·æœ‰å‘½ä»¤å¼çš„, define-by-run é£æ ¼çš„APIã€‚ç”±äºè¿™ç§ API çš„å­˜åœ¨, ç”¨ Optuna ç¼–å†™çš„ä»£ç æ¨¡å—åŒ–ç¨‹åº¦å¾ˆé«˜, Optunaçš„ç”¨æˆ·å› æ­¤ä¹Ÿå¯ä»¥åŠ¨æ€åœ°æ„é€ è¶…å‚æ•°çš„æœç´¢ç©ºé—´ã€‚</p><p><imgsrc="https://raw.githubusercontent.com/optuna/optuna/master/docs/image/optuna-logo.png" /></p><p><code>Optuna</code>çš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>è½»é‡çº§ã€å¤šåŠŸèƒ½å’Œè·¨å¹³å°æ¶æ„ï¼šåªéœ€å°‘é‡ä¾èµ–,ç®€å•å®‰è£…å®Œæˆåä¾¿å¯å¤„ç†å„ç§ä»»åŠ¡.</p></li><li><p>Python å¼çš„æœç´¢ç©ºé—´ï¼šåˆ©ç”¨ç†Ÿæ‚‰çš„ Python è¯­æ³•,å¦‚æ¡ä»¶è¯­å¥å’Œå¾ªç¯æ¥å®šä¹‰æœç´¢ç©ºé—´.</p></li><li><p>é«˜æ•ˆçš„ä¼˜åŒ–ç®—æ³•ï¼šé‡‡ç”¨äº†æœ€å…ˆè¿›çš„è¶…å‚æ•°é‡‡æ ·å’Œæœ€æœ‰æ•ˆçš„å¯¹æ— æœ› trialè¿›è¡Œå‰ªæçš„ç®—æ³•.</p></li><li><p>æ˜“ç”¨çš„å¹¶è¡Œä¼˜åŒ–ï¼šä»…éœ€å°‘é‡ç”šè‡³æ— éœ€ä»£ç ä¿®æ”¹ä¾¿å¯å°† studyæ‰©å±•åˆ°æ•°åç”šè‡³æ•°ç™¾ä¸ª worker ä¸Š.</p></li><li><p>ä¾¿æ·çš„å¯è§†åŒ–ï¼šæŸ¥è¯¢ä¼˜åŒ–è®°å½•.</p></li></ul><p><code>Optuna</code>è½»æ¾æ”¯æŒå¤šç§æ·±åº¦å­¦ä¹ å·¥å…·ï¼Œæ¯”å¦‚PyTorch, TensorFlow,Keras, MXNet, Scikit-Learn, Chainer, LightGBMç­‰ã€‚</p><p><code>Optuna</code>ä¸­çš„åŸºæœ¬æ¦‚å¿µæœ‰objectiveï¼ˆç›®æ ‡å‡½æ•°ï¼‰ã€trailï¼ˆå•æ¬¡å®éªŒï¼‰ã€studyï¼ˆç ”ç©¶ï¼‰ã€‚objectiveæ˜¯ä¼˜åŒ–ç¨‹åºçš„ç›®æ ‡å‡½æ•°ï¼Œä¸€èˆ¬å–æœ€å¤§åŒ–ï¼ˆmaximizeï¼‰æˆ–æœ€å°åŒ–ï¼ˆminimizeï¼‰ï¼Œæ”¯æŒå•ç›®æ ‡æˆ–å¤šç›®æ ‡å‡½æ•°ï¼›trailæ˜¯ç›®æ ‡å‡½æ•°çš„å•æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡å•ç‹¬çš„å®éªŒï¼›studyæ˜¯åŸºäºç›®æ ‡å‡½æ•°çš„ä¼˜åŒ–è¿‡ç¨‹ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»ä¸‰ä¸ªåŸºæœ¬çš„ä¾‹å­ï¼Œæ¥ä½“ä¼š<code>Optuna</code>çš„å¼ºå¤§ä¹‹å¤„ï¼</p><h2 id="ç®€å•ä¾‹å­">ç®€å•ä¾‹å­</h2><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼˜åŒ–å‡½æ•°f(x)=x*x-2*x+1,å…¶ä¸­xçš„å–å€¼èŒƒå›´ä¸º-3åˆ°3çš„æµ®ç‚¹æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç®€å•ä¾‹å­</span><br><span class="hljs-keyword">import</span> optuna<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">objective</span>(<span class="hljs-params">trial</span>):<br>    x = trial.suggest_float(<span class="hljs-string">&#x27;x&#x27;</span>, -<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">return</span> x ** <span class="hljs-number">2</span> - <span class="hljs-number">2</span> * x + <span class="hljs-number">1</span><br><br><span class="hljs-comment"># create_studyå‡½æ•°æœ‰å‚æ•°directionï¼Œå–å€¼minimize, maximize, é»˜è®¤å–å€¼ä¸ºminimize</span><br>study = optuna.create_study()<br>study.optimize(objective, n_trials=<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>å–ç›®æ ‡å‡½æ•°è¿›è¡Œæœ€å°åŒ–ä¼˜åŒ–ï¼ŒæŸ¥çœ‹æœ€ä¼˜å‚æ•°å’Œæœ€ä¼˜å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>study.best_params<br>&#123;<span class="hljs-string">&#x27;x&#x27;</span>: <span class="hljs-number">0.8293099933595993</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>study.best_value<br><span class="hljs-number">0.02913507836689999</span><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹10æ¬¡å®éªŒè¿‡ç¨‹ï¼Œè¡¨æ ¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Create a dataframe from the study.</span><br>df = study.trials_dataframe()<br>df<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2023/09/13/shEqYGxBrpZtneA.png"alt="å®éªŒç»“æœ" /><figcaption aria-hidden="true">å®éªŒç»“æœ</figcaption></figure><p>å¦‚æœæˆ‘ä»¬åœ¨create_studyä¸­å°†ç›®æ ‡å‡½æ•°çš„ä¼˜åŒ–æ–¹å‘ï¼ˆdirectionï¼‰æ”¹ä¸ºæœ€å¤§åŒ–ï¼Œæ­¤æ—¶æŸ¥çœ‹æœ€ä¼˜å‚æ•°å’Œæœ€ä¼˜å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">study = optuna.create_study(direction=<span class="hljs-string">&quot;maximize&quot;</span>)<br>study.optimize(objective, n_trials=<span class="hljs-number">10</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>study.best_params<br>&#123;<span class="hljs-string">&#x27;x&#x27;</span>: -<span class="hljs-number">2.911470602812437</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>study.best_value<br><span class="hljs-number">15.299602276665889</span><br></code></pre></td></tr></table></figure><h2 id="æœºå™¨å­¦ä¹ ä¾‹å­">æœºå™¨å­¦ä¹ ä¾‹å­</h2><p><code>Optuna</code>å¯æ”¯æŒåœ¨æœºå™¨å­¦ä¹ ä¸­è¿›è¡Œè¶…å‚ä¼˜åŒ–ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯¹<code>iris</code>æ•°æ®é›†ï¼Œä½¿ç”¨SVCå’ŒRandomForestè¿›è¡Œåˆ†ç±»æ¨¡å‹çš„å‚æ•°ä¼˜åŒ–ï¼Œä¼˜åŒ–çš„ç›®æ ‡å‡½æ•°ä¸ºKæŠ˜åˆ’åˆ†åçš„éªŒè¯é›†çš„é¢„æµ‹å‡†ç¡®ç‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># scikit-learn, æœºå™¨å­¦ä¹ ä¾‹å­</span><br><span class="hljs-keyword">import</span> optuna<br><br><span class="hljs-keyword">import</span> sklearn.datasets<br><span class="hljs-keyword">import</span> sklearn.ensemble<br><span class="hljs-keyword">import</span> sklearn.model_selection<br><span class="hljs-keyword">import</span> sklearn.svm<br><br><br><span class="hljs-comment"># FYI: Objective functions can take additional arguments</span><br><span class="hljs-comment"># (https://optuna.readthedocs.io/en/stable/faq.html#objective-func-additional-args).</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">objective</span>(<span class="hljs-params">trial</span>):<br>    iris = sklearn.datasets.load_iris()<br>    x, y = iris.data, iris.target<br><br>    classifier_name = trial.suggest_categorical(<span class="hljs-string">&quot;classifier&quot;</span>, [<span class="hljs-string">&quot;SVC&quot;</span>, <span class="hljs-string">&quot;RandomForest&quot;</span>])<br>    <span class="hljs-keyword">if</span> classifier_name == <span class="hljs-string">&quot;SVC&quot;</span>:<br>        svc_c = trial.suggest_float(<span class="hljs-string">&quot;svc_c&quot;</span>, <span class="hljs-number">1e-10</span>, <span class="hljs-number">1e10</span>, log=<span class="hljs-literal">True</span>)<br>        classifier_obj = sklearn.svm.SVC(C=svc_c, gamma=<span class="hljs-string">&quot;auto&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        rf_max_depth = trial.suggest_int(<span class="hljs-string">&quot;rf_max_depth&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">32</span>, log=<span class="hljs-literal">True</span>)<br>        classifier_obj = sklearn.ensemble.RandomForestClassifier(<br>            max_depth=rf_max_depth, n_estimators=<span class="hljs-number">10</span><br>        )<br><br>    score = sklearn.model_selection.cross_val_score(classifier_obj, x, y, n_jobs=-<span class="hljs-number">1</span>, cv=<span class="hljs-number">3</span>)<br>    accuracy = score.mean()<br>    <span class="hljs-keyword">return</span> accuracy<br><br>study = optuna.create_study(direction=<span class="hljs-string">&quot;maximize&quot;</span>)<br>study.optimize(objective, n_trials=<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æœ€å¥½çš„å®éªŒè®°å½•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>study.best_trial<br>FrozenTrial(number=<span class="hljs-number">43</span>, state=TrialState.COMPLETE, values=[<span class="hljs-number">0.9866666666666667</span>], datetime_start=datetime.datetime(<span class="hljs-number">2023</span>, <span class="hljs-number">9</span>, <span class="hljs-number">13</span>, <span class="hljs-number">1</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">300321</span>), datetime_complete=datetime.datetime(<span class="hljs-number">2023</span>, <span class="hljs-number">9</span>, <span class="hljs-number">13</span>, <span class="hljs-number">1</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">329775</span>), params=&#123;<span class="hljs-string">&#x27;classifier&#x27;</span>: <span class="hljs-string">&#x27;SVC&#x27;</span>, <span class="hljs-string">&#x27;svc_c&#x27;</span>: <span class="hljs-number">4.63942008536747</span>&#125;, user_attrs=&#123;&#125;, system_attrs=&#123;&#125;, intermediate_values=&#123;&#125;, distributions=&#123;<span class="hljs-string">&#x27;classifier&#x27;</span>: CategoricalDistribution(choices=(<span class="hljs-string">&#x27;SVC&#x27;</span>, <span class="hljs-string">&#x27;RandomForest&#x27;</span>)), <span class="hljs-string">&#x27;svc_c&#x27;</span>: FloatDistribution(high=<span class="hljs-number">10000000000.0</span>, log=<span class="hljs-literal">True</span>, low=<span class="hljs-number">1e-10</span>, step=<span class="hljs-literal">None</span>)&#125;, trial_id=<span class="hljs-number">43</span>, value=<span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p><code>Optuna</code>ä¹Ÿæ”¯æŒå¯è§†åŒ–ï¼Œæä¾›äº†å¯è§†åŒ–å·¥å…·<ahref="https://optuna-dashboard.readthedocs.io/en/latest/getting-started.html">optunadashboard</a>ã€‚æˆ‘ä»¬åªéœ€å¯¹ä¸Šé¢çš„ä»£ç åšäº›è®¸æ”¹é€ ï¼Œå°†å®éªŒç»“æœå‚¨å­˜åœ¨sqliteæ•°æ®åº“ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">study = optuna.create_study(study_name=<span class="hljs-string">&#x27;iris&#x27;</span>,direction=<span class="hljs-string">&quot;maximize&quot;</span>,storage=<span class="hljs-string">&#x27;sqlite:///db.sqlite3&#x27;</span>)<br>study.optimize(objective, n_trials=<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®Œæ¯•åï¼Œè¾“å…¥å‘½ä»¤è¡Œ<code>optuna-dashboard sqlite:///db.sqlite3</code>ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥<strong>127.0.0.1:8080</strong>ï¼Œå³å¯åœ¨é¡µé¢ä¸­å¯è§†åŒ–åœ°æŸ¥çœ‹å®éªŒä¸­çš„å„é¡¹æ•°æ®ã€‚</p><p>ä¹Ÿå¯ä»¥åœ¨<a href="https://optuna.github.io/optuna-dashboard/">Optunadashboardå®˜æ–¹å¯è§†åŒ–é¡µé¢ä¸­æŸ¥çœ‹</a>ï¼Œåªéœ€è¦å°†sqlite3æ–‡ä»¶ä¸Šä¼ å³å¯ï¼Œé¡µé¢å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2023/09/13/kgVWbJXsOlUSFKo.png"alt="å¯è§†åŒ–ç»“æœ" /><figcaption aria-hidden="true">å¯è§†åŒ–ç»“æœ</figcaption></figure><h2 id="nlpæ¨¡å‹ä¾‹å­">NLPæ¨¡å‹ä¾‹å­</h2><p>PyTorchä¹Ÿæä¾›äº†å¯¹<code>Optuna</code>å¾ˆå¥½çš„æ”¯æŒï¼Œé™¤äº†ä¸Šè¿°çš„objective,trailæ¨¡å¼ï¼ŒPyTorchè¿˜æä¾›äº†å†…ç½®ä»£ç æ”¯æŒ<code>Optuna</code>ã€‚</p><p>æˆ‘ä»¬ä»¥æ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485508&amp;idx=1&amp;sn=77a6fef8cfb11a604e19de303576539f&amp;chksm=fcb9b1d4cbce38c24cd92793bcc734684a8a5bc6c4a94d4473328158a5f7e95373f1da4ce2e2&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆå…­åå…­ï¼‰ä½¿ç”¨HuggingFaceä¸­çš„Trainerè¿›è¡ŒBERTæ¨¡å‹å¾®è°ƒ</a>ä¸­çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹è®­ç»ƒä¸ºä¾‹ï¼Œä»‹ç»åœ¨PyTochä¸­å¦‚ä½•æ”¯æŒ<code>Optuna</code>ã€‚</p><blockquote><p>é¢„è®­ç»ƒæ¨¡å‹æ”¹ä¸º <ahref="https://huggingface.co/ckiplab/bert-tiny-chinese">ckiplab/bert-tiny-chinese</a>.</p></blockquote><ul><li>é¦–å…ˆåŠ è½½æ•°æ®é›†ï¼Œtokenizerå’Œæ¨¡å‹ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># pytorchæ”¯æŒ</span><br><br><span class="hljs-comment"># load dataset, tokenizer, model</span><br><span class="hljs-keyword">import</span> datasets<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, DataCollatorWithPadding<br><br><br>checkpoint = <span class="hljs-string">&#x27;ckiplab/bert-tiny-chinese&#x27;</span><br>tokenizer = AutoTokenizer.from_pretrained(checkpoint)<br><br>data_files = &#123;<span class="hljs-string">&quot;train&quot;</span>: <span class="hljs-string">&quot;./sougou/train.csv&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;./sougou/test.csv&quot;</span>&#125;<br>raw_datasets = datasets.load_dataset(<span class="hljs-string">&quot;csv&quot;</span>, data_files=data_files, delimiter=<span class="hljs-string">&quot;,&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize_function</span>(<span class="hljs-params">sample</span>):<br>    <span class="hljs-keyword">return</span> tokenizer(sample[<span class="hljs-string">&#x27;text&#x27;</span>], max_length=<span class="hljs-number">128</span>, truncation=<span class="hljs-literal">True</span>)<br>tokenized_datasets = raw_datasets.<span class="hljs-built_in">map</span>(tokenize_function, batched=<span class="hljs-literal">True</span>)<br><br>data_collator = DataCollatorWithPadding(tokenizer=tokenizer)<br><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSequenceClassification<br>model = AutoModelForSequenceClassification.from_pretrained(checkpoint, num_labels=<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><ul><li>æŒ‡å®šè®­ç»ƒå‚æ•°</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Trainer, TrainingArguments<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score, precision_recall_fscore_support<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_metrics</span>(<span class="hljs-params">pred</span>):<br>    labels = pred.label_ids<br>    preds = pred.predictions.argmax(-<span class="hljs-number">1</span>)<br>    precision, recall, f1, _ = precision_recall_fscore_support(labels, preds, average=<span class="hljs-string">&#x27;weighted&#x27;</span>)<br>    acc = accuracy_score(labels, preds)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;f1&#x27;</span>: f1&#125;<br><br>training_args = TrainingArguments(output_dir=<span class="hljs-string">&#x27;bert_tiny_sougou_trainer_128&#x27;</span>, <span class="hljs-comment"># æŒ‡å®šè¾“å‡ºæ–‡ä»¶å¤¹ï¼Œæ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»º</span><br>                                 evaluation_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>                                 per_device_train_batch_size=<span class="hljs-number">32</span>,<br>                                 per_device_eval_batch_size=<span class="hljs-number">32</span>,<br>                                 learning_rate=<span class="hljs-number">5e-5</span>,<br>                                 num_train_epochs=<span class="hljs-number">5</span>,<br>                                 warmup_ratio=<span class="hljs-number">0.2</span>,<br>                                 logging_dir=<span class="hljs-string">&#x27;./sougou_train_logs&#x27;</span>,<br>                                 logging_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>                                 save_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>                                 report_to=<span class="hljs-string">&quot;tensorboard&quot;</span>) <br><br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®æ¨¡å‹å’Œè¶…å‚ä¼˜åŒ–ç©ºé—´ï¼Œè¿›è¡Œè¶…å‚æœç´¢å®éªŒ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">hp_space</span>(<span class="hljs-params">trial</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;num_train_epochs&quot;</span>: trial.suggest_int(<span class="hljs-string">&quot;num_train_epochs&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">10</span>),<br>            <span class="hljs-string">&quot;learning_rate&quot;</span>: trial.suggest_float(<span class="hljs-string">&quot;learning_rate&quot;</span>, <span class="hljs-number">1e-6</span>, <span class="hljs-number">1e-3</span> ,log=<span class="hljs-literal">True</span>)&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">model_init</span>():<br>    <span class="hljs-keyword">return</span> AutoModelForSequenceClassification.from_pretrained(<br>        checkpoint,<br>        num_labels=<span class="hljs-number">5</span><br>    )<br><br>trainer = Trainer(<br>    model_init=model_init,<br>    args=training_args,<br>    train_dataset=tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],<br>    eval_dataset=tokenized_datasets[<span class="hljs-string">&quot;test&quot;</span>],<br>    data_collator=data_collator,<br>    tokenizer=tokenizer,<br>    compute_metrics=compute_metrics,<br>)<br><br>best_run = trainer.hyperparameter_search(n_trials=<span class="hljs-number">50</span>,<br>                                         direction=<span class="hljs-string">&quot;maximize&quot;</span>,<br>                                         hp_space=hp_space)<br></code></pre></td></tr></table></figure><p>bert_runæ˜¯PyTorchä¸­çš„<code>transformers.trainer_utils</code>ä¸­çš„<code>BestRun</code>ï¼Œå‚æ•°ä¸ºrun_id,objective, hyperparameters, æŸ¥çœ‹ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> best_run.hyperparameters.items():<br><span class="hljs-meta">&gt;&gt;&gt; </span>   <span class="hljs-built_in">print</span>(k, v)<br>num_train_epochs <span class="hljs-number">10</span><br>learning_rate <span class="hljs-number">8.26383331124286e-05</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>best_run.run_id<br><span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>best_run.objective<br><span class="hljs-number">0.933096723776579</span><br></code></pre></td></tr></table></figure><p>ç”±ä¸Šå¯çŸ¥ï¼Œåœ¨ç¬¬5æ¬¡å®éªŒä¸­ï¼Œnum_train_epochs å’Œ learning_rateçš„å‚æ•°å–å€¼ä½¿å¾—æ¨¡å‹çš„æŒ‡æ ‡æœ€å¥½ï¼ŒF1ä¸º0.9331ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><h4 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»</h4><ul><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485508&amp;idx=1&amp;sn=77a6fef8cfb11a604e19de303576539f&amp;chksm=fcb9b1d4cbce38c24cd92793bcc734684a8a5bc6c4a94d4473328158a5f7e95373f1da4ce2e2&amp;token=475225731&amp;lang=zh_CN#rd">NLPï¼ˆå…­åå…­ï¼‰ä½¿ç”¨HuggingFaceä¸­çš„Trainerè¿›è¡ŒBERTæ¨¡å‹å¾®è°ƒ</a></li><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485262&amp;idx=1&amp;sn=360652e6471d831d7d1ace79e3da8399&amp;chksm=fcb9bedecbce37c860856dbd883503a0bc6c44e8ecbc26d6ee8640dab8df39a6a3a48a46d617&amp;token=475225731&amp;lang=zh_CN#rd">PyTorchå…¥é—¨ï¼ˆä¸ƒï¼‰TensorBoardçš„ä½¿ç”¨</a></li><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485261&amp;idx=1&amp;sn=d8e8a4fce4bb1ff19dd739bca020bd84&amp;chksm=fcb9beddcbce37cbebfaad75fb2ed337a7c4ac48a2642c651051e0c6cd51b4b397fcca49b4e6&amp;payreadticket=HBaOUydQ3igU3XkxAYNeSKyWZlkwyEZVeNznI01M6y7E63vt1R4mTMxuAvNPhSP7Ronlbhk#rd">PyTorchå…¥é—¨ï¼ˆå…­ï¼‰ä½¿ç”¨Transformeræ¨¡å‹è¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Optuna</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Apolloé…ç½®ä¸­å¿ƒåŠPythonè¿æ¥</title>
    <link href="/2024/01/09/Apollo%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%8F%8APython%E8%BF%9E%E6%8E%A5/"/>
    <url>/2024/01/09/Apollo%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%8F%8APython%E8%BF%9E%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•å¯åŠ¨Apolloï¼Œåœ¨Apolloä¸­é…ç½®å‚æ•°ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨Pythonè¿æ¥Apollo.</p></blockquote><h2 id="apolloä»‹ç»">Apolloä»‹ç»</h2><p>åœ¨æ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485073&amp;idx=1&amp;sn=b120ac202781f482393d5420d5adba02&amp;chksm=fcb9bf01cbce3617d36a13d25330928586e937e3a440191f57344b799c6da7deb20ddbccfcae&amp;token=633459163&amp;lang=zh_CN#rd">Pythonä¹‹è¯»å–é…ç½®æ–‡ä»¶</a>å’Œæ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485073&amp;idx=1&amp;sn=b120ac202781f482393d5420d5adba02&amp;chksm=fcb9bf01cbce3617d36a13d25330928586e937e3a440191f57344b799c6da7deb20ddbccfcae&amp;token=633459163&amp;lang=zh_CN#rd">Pythonä¹‹é…ç½®æ–‡ä»¶å¤„ç†</a>ä¸­ï¼Œç¬”è€…åˆ†åˆ«ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Pythonæ¥å¤„ç†ini,yaml,confç­‰é…ç½®æ–‡ä»¶ã€‚è¿™ç§é…ç½®æ–¹å¼æ¯”è¾ƒæ–¹ä¾¿æœ¬åœ°åŠ è½½ï¼Œä½†å›¿äºé¡¹ç›®çš„å¤æ‚æ€§ã€å®‰å…¨æ€§ã€ç¨³å®šæ€§ç­‰è§’åº¦è€ƒè™‘ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©å…¶å®ƒçš„é…ç½®å·¥å…·æ¥å®ç°æ›´é«˜æ•ˆã€é«˜å¯é çš„å‚æ•°é…ç½®ï¼Œå…¶ä¸­ä¹‹ä¸€ä¾¿æ˜¯<code>Apollo</code>ã€‚</p><p><imgsrc="https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/logo/logo-simple.png" /></p><p><ahref="https://www.apolloconfig.com/#/zh/README">Apolloï¼ˆé˜¿æ³¢ç½—ï¼‰</a>æ˜¯ä¸€æ¬¾å¯é çš„åˆ†å¸ƒå¼é…ç½®ç®¡ç†ä¸­å¿ƒï¼Œè¯ç”Ÿäºæºç¨‹æ¡†æ¶ç ”å‘éƒ¨ï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†åº”ç”¨ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®ï¼Œé…ç½®ä¿®æ”¹åèƒ½å¤Ÿå®æ—¶æ¨é€åˆ°åº”ç”¨ç«¯ï¼Œå¹¶ä¸”å…·å¤‡è§„èŒƒçš„æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºå¾®æœåŠ¡é…ç½®ç®¡ç†åœºæ™¯ã€‚æœåŠ¡ç«¯åŸºäºSpringBootå’ŒSpringCloudå¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–å®‰è£…Tomcatç­‰åº”ç”¨å®¹å™¨ã€‚</p><p>Apolloçš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>éƒ¨ç½²ç®€å•</li><li>ç°åº¦å‘å¸ƒ</li><li>ç‰ˆæœ¬å‘å¸ƒç®¡ç†</li><li>æä¾›å¼€æ”¾å¹³å°API</li><li>å®¢æˆ·ç«¯é…ç½®ä¿¡æ¯ç›‘æ§</li><li>æä¾›Javaå’Œ.NetåŸç”Ÿå®¢æˆ·ç«¯</li><li>é…ç½®ä¿®æ”¹å®æ—¶ç”Ÿæ•ˆï¼ˆçƒ­å‘å¸ƒï¼‰</li><li>æƒé™ç®¡ç†ã€å‘å¸ƒå®¡æ ¸ã€æ“ä½œå®¡è®¡</li><li>ç»Ÿä¸€ç®¡ç†ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®</li></ul><h2 id="apolloå¯åŠ¨">Apolloå¯åŠ¨</h2><p>æˆ‘ä»¬é‡‡ç”¨<code>Docker-Compose</code>æ–¹å¼æ¥å¯åŠ¨<code>Apollo</code>ï¼Œå‚è€ƒGithubé¡¹ç›®<ahref="https://github.com/apolloconfig/apollo-quick-start">apollo-quick-start</a>ä¸­ç»™å‡ºçš„ä»‹ç»ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åœ¨æœ¬åœ°å¯åŠ¨<code>Apollo</code>ã€‚</p><p>å¦‚æœä½¿ç”¨çš„æ˜¯ arm æ¶æ„çš„æœºå™¨ï¼Œä¾‹å¦‚ macm1ï¼Œéœ€è¦ä¸‹è½½docker-compose-arm64.ymlã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose -f docker-compose-arm64.yml up -d<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å…¶ä»–æ¶æ„çš„æœºå™¨ï¼Œå¦‚x86ï¼Œåˆ™ç›´æ¥å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose up -d<br></code></pre></td></tr></table></figure><h2 id="apolloé…ç½®">Apolloé…ç½®</h2><p>å¯åŠ¨æˆåŠŸåï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€<strong>localhost:8070</strong>æ‰“å¼€Apolloé…ç½®é¡µé¢ï¼Œè´¦å·apolloï¼Œå¯†ç adminï¼Œç¯å¢ƒé€‰æ‹©<strong>DEV</strong>ï¼Œåˆ›å»ºåº”ç”¨<strong>ai_service_1</strong>ï¼Œappid ä¸º<strong>ai_test</strong>ï¼Œé…ç½®å‚æ•°å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2023/09/12/IsoiW2tZbjweUAv.png"alt="å‚æ•°é…ç½®" /><figcaption aria-hidden="true">å‚æ•°é…ç½®</figcaption></figure><p>åœ¨ç®¡ç†ç§˜é’¥ä¸­åˆ›å»ºç§˜é’¥ï¼Œç‚¹å‡»å‘å¸ƒæŒ‰é’®å³å¯å‘å¸ƒé…ç½®å¥½çš„å˜é‡ã€‚</p><h2 id="pythonè¿æ¥apollo">Pythonè¿æ¥Apollo</h2><p><code>Apollo</code>å¤©ç„¶æ”¯æŒJava,Netè¿æ¥ï¼Œæ”¯æŒåº¦è¾ƒå¥½ï¼Œå¯¹äºPythonï¼Œä¹Ÿæœ‰çƒ­å¿ƒçš„å¼€å‘è€…åˆ›å»ºäº†æ”¯æŒåº¦è¾ƒå¥½çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œè¿™é‡Œä½¿ç”¨<ahref="https://github.com/BruceWW/pyapollo">pyapollo</a>ã€‚è¯¥æ¨¡å—çš„å®‰è£…æ–¹å¼ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install apollo-client==2.1.2<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Pythonè¿æ¥<code>Apollo</code>çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pyapollo.apollo_client <span class="hljs-keyword">import</span> ApolloClient<br><br>app_id = <span class="hljs-string">&quot;ai_test&quot;</span><br>config_server_url = <span class="hljs-string">&quot;http://127.0.0.1:8090&quot;</span><br>authorization = <span class="hljs-string">&quot;3a7d769835ef43e3ae2af1cb1f861795&quot;</span><br>cache_file_path = <span class="hljs-string">&#x27;my_apollo_config&#x27;</span><br>env = <span class="hljs-string">&#x27;DEV&#x27;</span><br>namespace = <span class="hljs-string">&#x27;application&#x27;</span><br>client = ApolloClient(<br>            app_id=app_id,<br>            cluster=<span class="hljs-string">&quot;default&quot;</span>,<br>            config_server_url=config_server_url,<br>            authorization=authorization,<br>            cache_file_path=cache_file_path,<br>            env=env<br>        )<br>client.start()<br><span class="hljs-comment"># print(client.__dict__)</span><br><br><span class="hljs-comment"># get config from apollo</span><br>host = client.get_value(key=<span class="hljs-string">&quot;host&quot;</span>, default_val=<span class="hljs-string">&quot;*&quot;</span>, namespace=namespace)<br>port = client.get_value(key=<span class="hljs-string">&quot;port&quot;</span>, default_val=<span class="hljs-string">&quot;**&quot;</span>, namespace=namespace)<br>key = client.get_value(key=<span class="hljs-string">&quot;key&quot;</span>, default_val=<span class="hljs-string">&quot;***&quot;</span>, namespace=namespace)<br>name = client.get_value(key=<span class="hljs-string">&quot;name&quot;</span>, default_val=<span class="hljs-string">&quot;****&quot;</span>, namespace=namespace)<br><span class="hljs-built_in">print</span>(host, <span class="hljs-built_in">type</span>(host))<br><span class="hljs-built_in">print</span>(port, <span class="hljs-built_in">type</span>(port))<br><span class="hljs-built_in">print</span>(key, <span class="hljs-built_in">type</span>(key))<br><span class="hljs-built_in">print</span>(name, <span class="hljs-built_in">type</span>(name))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">0.0.0.0 &lt;class <span class="hljs-string">&#x27;str&#x27;</span>&gt;<br>80 &lt;class <span class="hljs-string">&#x27;str&#x27;</span>&gt;<br>abc &lt;class <span class="hljs-string">&#x27;str&#x27;</span>&gt;<br>**** &lt;class <span class="hljs-string">&#x27;str&#x27;</span>&gt;<br></code></pre></td></tr></table></figure><p>åŒæ—¶åœ¨æœ¬åœ°çš„my_apollo_configç›®å½•ä¸‹ï¼Œä¹Ÿä¼šæœ‰ç¼“å­˜çš„é…ç½®æ–‡ä»¶ã€‚</p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œhost, port,keyå˜é‡éƒ½æ­£å¸¸è·å–ï¼Œä½†nameå˜é‡ä¸å­˜åœ¨<code>Apollo</code>ä¸­ï¼Œå› ä¸ºå–é»˜è®¤å€¼ã€‚å¦‚æœåœ¨<code>Apollo</code>ä¸­é…ç½®è¯¥å‚æ•°ï¼Œåˆ™ä¹Ÿèƒ½æ­£å¸¸è·å–ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ¬æ–‡æ˜¯ç¬”è€…åœ¨å®é™…å·¥ä½œä¸­çš„ä¸€æ¬¡æ€»ç»“ï¼Œä¸»è¦ä»‹ç»äº†Apolloçš„å¯åŠ¨ã€é…ç½®ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨Pythonæ¥è¿æ¥Apolloã€‚</p><p>ç¬”è€…å·²å¼€é€šä¸ªäººåšå®¢ç½‘å€ï¼š<ahref="https://percent4.github.io/">https://percent4.github.io/</a>ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®~</p><h4 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»</h4><ul><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485073&amp;idx=1&amp;sn=b120ac202781f482393d5420d5adba02&amp;chksm=fcb9bf01cbce3617d36a13d25330928586e937e3a440191f57344b799c6da7deb20ddbccfcae&amp;token=633459163&amp;lang=zh_CN#rd">Pythonä¹‹è¯»å–é…ç½®æ–‡ä»¶</a></li><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485073&amp;idx=1&amp;sn=b120ac202781f482393d5420d5adba02&amp;chksm=fcb9bf01cbce3617d36a13d25330928586e937e3a440191f57344b799c6da7deb20ddbccfcae&amp;token=633459163&amp;lang=zh_CN#rd">Pythonä¹‹é…ç½®æ–‡ä»¶å¤„ç†</a></li></ul><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><center><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></center>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Apollo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸ƒåï¼‰ä½¿ç”¨LLAMA-2æ¨¡å‹å¾®è°ƒMultiple-Choice-MRC</title>
    <link href="/2024/01/09/NLP%EF%BC%88%E4%B8%83%E5%8D%81%EF%BC%89%E4%BD%BF%E7%94%A8LLAMA-2%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83Multiple-Choice-MRC/"/>
    <url>/2024/01/09/NLP%EF%BC%88%E4%B8%83%E5%8D%81%EF%BC%89%E4%BD%BF%E7%94%A8LLAMA-2%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83Multiple-Choice-MRC/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨Fireflyå¤§æ¨¡å‹è®­ç»ƒæ¡†æ¶ä¸­ï¼Œä½¿ç”¨LLAMA-27Bæ¨¡å‹ï¼Œå¯¹å¤šé¡¹é€‰æ‹©é˜…è¯»ç†è§£æ•°æ®é›†RACEmiddleè¿›è¡Œå¾®è°ƒï¼Œæœ€ç»ˆæ•ˆæœæå‡æ˜æ˜¾ã€‚</p></blockquote><h2 id="mrc">MRC</h2><p><code>æœºå™¨é˜…è¯»ç†è§£ï¼ˆMachine Reading Comprehension, MRCï¼‰</code>å±äºNLPä»»åŠ¡ä¸­çš„é—®ç­”ä»»åŠ¡ï¼ˆQuestionAnswering,QAï¼‰ï¼Œæ˜¯NLPé¢†åŸŸä¸­åŸºç¡€ä¸”é‡è¦çš„ä¸€é¡¹ä»»åŠ¡ã€‚æ‰€è°“çš„æœºå™¨é˜…è¯»ç†è§£å°±æ˜¯ç»™å®šä¸€ç¯‡æ–‡ç« ï¼Œä»¥åŠåŸºäºæ–‡ç« çš„ä¸€ä¸ªé—®é¢˜ï¼Œè®©æœºå™¨åœ¨é˜…è¯»æ–‡ç« åå¯¹é—®é¢˜è¿›è¡Œä½œç­”ã€‚</p><p>æ ¹æ®ä»»åŠ¡å½¢å¼çš„ä¸åŒï¼Œå¯åˆ’åˆ†ä¸ºï¼š</p><figure><img src="https://s2.loli.net/2023/09/10/hJL4uqE7pl1aOWS.png"alt="å››ç§MRCä»»åŠ¡" /><figcaption aria-hidden="true">å››ç§MRCä»»åŠ¡</figcaption></figure><ul><li><p>å®Œå½¢å¡«ç©ºï¼ˆClozeTestsï¼‰ï¼šå°†æ–‡ç« ä¸­çš„æŸäº›å•è¯éšå»ï¼Œè®©æ¨¡å‹æ ¹æ®ä¸Šä¸‹æ–‡åˆ¤æ–­è¢«éšå»çš„å•è¯æœ€å¯èƒ½æ˜¯å“ªä¸ªã€‚</p></li><li><p>å¤šé¡¹é€‰æ‹©ï¼ˆMultipleChoiceï¼‰ï¼šç»™å®šä¸€ç¯‡æ–‡ç« å’Œä¸€ä¸ªé—®é¢˜ï¼Œè®©æ¨¡å‹ä»å¤šä¸ªå¤‡é€‰ç­”æ¡ˆä¸­é€‰æ‹©ä¸€ä¸ªæœ€æœ‰å¯èƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆçš„é€‰é¡¹ã€‚</p></li><li><p>ç‰‡æ®µæŠ½å–ï¼ˆSpanExtractionï¼‰ï¼šç»™å®šä¸€ç¯‡æ–‡ç« å’Œä¸€ä¸ªé—®é¢˜ï¼Œè®©æ¨¡å‹ä»æ–‡ç« ä¸­æŠ½å–è¿ç»­çš„å•è¯åºåˆ—ï¼Œå¹¶ä½¿å¾—è¯¥åºåˆ—å°½å¯èƒ½çš„ä½œä¸ºè¯¥é—®é¢˜çš„ç­”æ¡ˆã€‚</p></li><li><p>è‡ªç”±ä½œç­”ï¼ˆFreeAnsweringï¼‰ï¼šç»™å®šä¸€ç¯‡æ–‡ç« å’Œä¸€ä¸ªé—®é¢˜ï¼Œè®©æ¨¡å‹ç”Ÿæˆä¸€ä¸ªå•è¯åºåˆ—ï¼Œå¹¶ä½¿å¾—è¯¥åºåˆ—å°½å¯èƒ½çš„ä½œä¸ºè¯¥é—®é¢˜çš„ç­”æ¡ˆã€‚ä¸ç‰‡æ®µæŠ½å–ä»»åŠ¡ä¸åŒçš„æ˜¯ï¼Œè¯¥åºåˆ—ä¸å†é™åˆ¶äºæ˜¯æ–‡ç« ä¸­çš„å¥å­ã€‚</p></li></ul><p>å…¶ä¸­ï¼Œ<code>å®Œå½¢å¡«ç©º</code>æ˜¯BERTæ¨¡å‹ä¸­çš„å…¶ä¸­ä¸€é¡¹é¢„è®­ç»ƒä»»åŠ¡MLMï¼Œå› æ­¤ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å¤©ç„¶æ”¯æŒå®Œå½¢å¡«ç©ºã€‚</p><p><code>ç‰‡æ®µæŠ½å–</code>å³æŠ½å–å¼é˜…è¯»ç†è§£ï¼Œæ˜¯æˆ‘ä»¬åœ¨NLPä»»åŠ¡ä¸­æœ€å¸¸è§çš„é˜…è¯»ç†è§£çš„å½¢å¼ï¼Œä¸€èˆ¬æƒ…å†µä¸‹çš„é˜…è¯»ç†è§£ä¹ŸæŒ‡çš„æ˜¯è¿™ç§å½¢å¼ã€‚ä½¿ç”¨BERTç³»åˆ—æ¨¡å‹ä¹Ÿèƒ½å¾ˆå¥½åœ°å®Œæˆè¯¥ä»»åŠ¡ã€‚è¯¥ä»»åŠ¡çš„ç»å…¸æ•°æ®é›†æœ‰<ahref="https://huggingface.co/datasets/squad">SQUAD</a>, <ahref="https://huggingface.co/datasets/squad_v2">SQUAD 2</a>ç­‰ã€‚</p><p><code>è‡ªç”±ä½œç­”</code>ä¸é™å®šå›å¤çš„ç­”æ¡ˆæ¥è‡ªäºåŸå§‹æ–‡ç« ï¼Œå› æ­¤éš¾åº¦æœ€å¤§ï¼Œä¸€èˆ¬é‡‡ç”¨ç”Ÿæˆå¼æ¨¡å‹è§£å†³ï¼Œä»¥å‰çš„NLPæ¨¡å‹åœ¨è¿™æ–¹é¢çš„è¡¨ç°ä¸ä½³ã€‚è€Œå¤§æ¨¡å‹ï¼ˆLLMï¼‰çš„å‡ºç°ï¼Œè®©è¯¥ä»»åŠ¡æœ‰äº†å¾ˆå¤§æ”¹è§‚ï¼Œæ•ˆæœæœ‰äº†è¾ƒå¼ºçš„é˜…è¯»æ€§ï¼Œå±äºé©å‘½æ€§çš„å˜åŒ–ã€‚</p><p><code>å¤šé¡¹é€‰æ‹©</code>å³æˆ‘ä»¬åœ¨è‹±è¯­è€ƒè¯•ä¸­çš„é˜…è¯»ç†è§£ï¼Œé˜…è¯»æ–‡ç« ï¼Œç»™å®šé—®é¢˜ï¼Œä»å›ºå®šçš„é€‰é¡¹ä¸­é€‰å‡ºæ­£ç¡®ç­”æ¡ˆã€‚ç»å…¸çš„å¤šé¡¹é€‰æ‹©é˜…è¯»ç†è§£æ•°æ®é›†æœ‰<ahref="https://huggingface.co/datasets/race">RACE</a> , <ahref="https://huggingface.co/datasets/swag">SWAG</a>ç­‰ã€‚æœ¬æ–‡å°†ä¼šå…·ä½“ä»‹ç»å¤šé¡¹é€‰æ‹©é˜…è¯»ç†è§£ä¸­çš„RACEæ•°æ®é›†ï¼Œä»¥åŠLLAMA-2åœ¨è¯¥æ•°æ®é›†ä¸Šçš„å¾®è°ƒæ•ˆæœã€‚</p><h2 id="raceæ•°æ®é›†">RACEæ•°æ®é›†</h2><p><code>RACE</code>æ•°æ®é›†æ˜¯å¤šé¡¹é€‰æ‹©é˜…è¯»ç†è§£ï¼ˆMulti ChoiceMRCï¼‰ä¸­çš„ç»å…¸æ•°æ®é›†ï¼Œ<ahref="https://www.cs.cmu.edu/~glai1/data/race/">RACEå®˜æ–¹ç½‘å€</a>ä¸­çš„ä»‹ç»ä¸ºï¼š</p><blockquote><p>Race is a large-scale reading comprehension dataset with more than28,000 passages and nearly 100,000 questions. The dataset is collectedfrom English examinations in China, which are designed for middle schooland high school students. The dataset can be served as the training andtest sets for machine comprehension.</p></blockquote><p>RACEæ•°æ®é›†åˆåˆ†ä¸ºmiddleï¼ˆåˆä¸­ï¼‰å’Œhighï¼ˆé«˜ä¸­ï¼‰ä¸¤éƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ•°æ®é›†</th><th>train</th><th>dev</th><th>test</th></tr></thead><tbody><tr class="odd"><td>middle</td><td>25421</td><td>1436</td><td>1436</td></tr><tr class="even"><td>high</td><td>62445</td><td>3451</td><td>3498</td></tr><tr class="odd"><td>total</td><td>87866</td><td>4887</td><td>4934</td></tr></tbody></table><p>ç”±äºæ•°æ®è§„æ¨¡åŸå› å’Œè®­ç»ƒæ—¶é—´åŸå› ï¼Œæœ¬æ–‡åªå¯¹middleæ•°æ®é›†è¿›è¡Œå¾®è°ƒã€‚éšæœºä»middleæ•°æ®é›†ä¸­çš„è®­ç»ƒé›†æŒ‘é€‰ä¸€æ¡æ ·æœ¬ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>&#x27;example_id&#x27;<span class="hljs-punctuation">:</span> &#x27;middle4558.txt&#x27;<span class="hljs-punctuation">,</span><br> &#x27;article&#x27;<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-string">&quot;I planted a seed. Finally grow fruits. Today is a great day. Pick off the star for you. Pick off the moon for you. Let it rise for you every day. Become candles burning myself. Just light you up, hey!... You are my little little apple. How much I love you, still no enough.&quot;</span>\nThis words are from the popular song You Are My Little Dear Apple. Bae Seul-Ki acted as the leading dancer in the MV of the song. She loves dancing. She became crazy about hip-hop when she was a school girl.\nBai Seul-Ki was born on September <span class="hljs-number">27</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1986.</span> She is a South Korean singer and dancer. She is <span class="hljs-number">168</span>cm tall. She loves cooking. Her favourite food is spicy and salty. She like pink and red most. There are five members in her family---father<span class="hljs-punctuation">,</span> mother<span class="hljs-punctuation">,</span> two younger brothers and herself. She isn\&#x27;t married.\nAfter her father and mother broke up<span class="hljs-punctuation">,</span> she lived with her mother and new daddy. She enjoys being alone.&#x27;<span class="hljs-punctuation">,</span><br> &#x27;answer&#x27;<span class="hljs-punctuation">:</span> &#x27;B&#x27;<span class="hljs-punctuation">,</span><br> &#x27;question&#x27;<span class="hljs-punctuation">:</span> &#x27;Bae Seul-Ki   _   in the MV of the song according to the passage.&#x27;<span class="hljs-punctuation">,</span><br> &#x27;options&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>&#x27;sang&#x27;<span class="hljs-punctuation">,</span> &#x27;danced&#x27;<span class="hljs-punctuation">,</span> &#x27;cried&#x27;<span class="hljs-punctuation">,</span> &#x27;laughed&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="æ„å»ºprompt">æ„å»ºPrompt</h2><p>æœ¬æ–‡é’ˆå¯¹RACEæ•°æ®é›†ï¼Œæ„å»ºçš„Promptå¦‚ä¸‹ï¼š</p><pre><code class="hljs">Read the following passage and questions, then choose the right answer from options, the answer should be one of A, B, C, D.&lt;passage&gt;:&quot;I planted a seed. Finally grow fruits. Today is a great day. Pick off the star for you. Pick off the moon for you. Let it rise for you every day. Become candles burning myself. Just light you up, hey!... You are my little little apple. How much I love you, still no enough.&quot;This words are from the popular song You Are My Little Dear Apple. Bae Seul-Ki acted as the leading dancer in the MV of the song. She loves dancing. She became crazy about hip-hop when she was a school girl.Bai Seul-Ki was born on September 27, 1986. She is a South Korean singer and dancer. She is 168cm tall. She loves cooking. Her favourite food is spicy and salty. She like pink and red most. There are five members in her family---father, mother, two younger brothers and herself. She isn&#39;t married.After her father and mother broke up, she lived with her mother and new daddy. She enjoys being alone.&lt;question&gt;:Bae Seul-Ki   _   in the MV of the song according to the passage.&lt;options&gt;:A sangB dancedC criedD laughed&lt;answer&gt;:</code></pre><blockquote><p><strong>Trick</strong>:å¯ä»¥å€ŸåŠ©å¤§æ¨¡å‹ï¼Œæ¯”å¦‚GPT-4æ„å»ºèƒ½å¥½çš„Promptä»¥æå‡å¾®è°ƒæ•ˆæœã€‚</p></blockquote><h2 id="llama-2æ¨¡å‹å¾®è°ƒ">LLAMA-2æ¨¡å‹å¾®è°ƒ</h2><p>åœ¨å¤§æ¨¡å‹é¢†åŸŸï¼Œ<ahref="https://research.facebook.com/publications/llama-open-and-efficient-foundation-language-models/"><code>LLAMA</code></a>ç³»åˆ—æ¨¡å‹å¯è°“å¤§åé¼é¼ï¼Œå…¶æœ¬èº«åŠè¡ç”Ÿçš„æ¨¡å‹æœ‰å‡ åä¸ªï¼ŒçœŸè®©äººçœ¼èŠ±ç¼­ä¹±ï¼Œè€Œä¸”æ•ˆæœéƒ½å¾ˆä¸é”™ï¼Œæ˜¯å¤§æ¨¡å‹é¢†åŸŸçœŸæ­£çš„ä¸€ä»£å®—å¸ˆã€‚æˆ‘ä»¬æœ‰æœºä¼šå†ä»‹ç»LLAMAç³»åˆ—æ¨¡å‹ï¼Œæœ¬æ–‡ä¸å†è¯¦è¿°ã€‚</p><p>æœ¬æ–‡ä½¿ç”¨åˆšå¼€æºçš„<ahref="https://about.fb.com/news/2023/07/llama-2/"><code>LLAMA 2</code>æ¨¡å‹</a>ï¼Œ7Bç‰ˆæœ¬ï¼Œåœ¨<code>Firefly</code>æ¡†æ¶ä¸‹ï¼Œå¯¹RACEmiddleæ•°æ®é›†è¿›è¡Œå¾®è°ƒã€‚å¾®è°ƒçš„å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;output_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;output/firefly-llama2-7b-race-middle&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;model_name_or_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/jclian91/Llama-2-7b-hf&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;train_file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./data/race_train.jsonl&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;num_train_epochs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;per_device_train_batch_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gradient_accumulation_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;learning_rate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1e-4</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;max_seq_length&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">384</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;logging_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_total_limit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lr_scheduler_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;constant_with_warmup&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;warmup_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">64</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_alpha&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_dropout&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span><br><br>    <span class="hljs-attr">&quot;gradient_checkpointing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;disable_tqdm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;optim&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;paged_adamw_32bit&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fp16&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;report_to&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tensorboard&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dataloader_num_workers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_strategy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;steps&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;weight_decay&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;max_grad_norm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;remove_unused_columns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨æ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485454&amp;idx=1&amp;sn=efe98ac6bef1d06518958918405719ab&amp;chksm=fcb9b19ecbce3888a57b9c7c8bc7852a7e051774ee897f5caa0a03d3afb0adf1aedc5bc5c11b&amp;payreadticket=HNZHAsM-Bua8lK8PnmTkk4-3mVg_01kmjA_KfhvBvh0iIMm1Tlz2woLFkuX8-weOLoMxOUU#rd">NLPï¼ˆå…­åä¸‰ï¼‰ä½¿ç”¨Baichuan-7bæ¨¡å‹å¾®è°ƒäººç‰©å…³ç³»åˆ†ç±»ä»»åŠ¡</a>ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»äº†Fireflyæ¨¡å‹å¾®è°ƒã€è¯„ä¼°ã€WEBæœåŠ¡ç­‰æ­¥éª¤ï¼Œè¿™é‡Œä¹Ÿä¸å†è¯¦è¿°ã€‚ä¹Ÿå¯ä»¥å‚è€ƒGithubé¡¹ç›®<ahref="https://github.com/percent4/llama-2-multiple-choice-mrc">llama-2-multiple-choice-mrc</a>.</p><p>åœ¨RACE testæ•°æ®é›†ä¸Šçš„å‡†ç¡®ç‡ä¸º<code>86.91%</code>!æ•ˆæœå¯è°“æƒŠäººï¼Œè€Œè¿™åªæ˜¯LLAMA2æ²¡æœ‰ç»è¿‡å‚æ•°è°ƒæ•´çš„ç»“æœï¼Œæ•ˆæœä¸å¯è°“ä¸ä½³ã€‚ç¬”è€…ä¹‹å‰ç”¨<ahref="https://github.com/percent4/keras_bert_multiple_choice_MRC">BERTæ¨¡å‹åŒæ ·åœ¨RACEmiddleæ•°æ®é›†ä¸Šè¿›è¡Œå¾®è°ƒ</a>ï¼Œè¯„ä¼°ç»“æœä¸€èˆ¬åªæœ‰72%å·¦å³ï¼ŒBERTLargeæ¨¡å‹æ‰ä¸è¿‡75%ï¼Œè¿™è¿˜æ˜¯è®­ç»ƒæ•°æ®é‡‡ç”¨äº†middle + highçš„ç»“æœã€‚</p><p><ahref="https://paperswithcode.com/sota/reading-comprehension-on-race">RACEæ•°æ®é›†æ’è¡Œæ¦œ</a>å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2023/09/10/9LMe2PdmZNKcCbo.png"alt="RACEæ•°æ®é›†æ’è¡Œæ¦œ" /><figcaption aria-hidden="true">RACEæ•°æ®é›†æ’è¡Œæ¦œ</figcaption></figure><h2 id="æ¨¡å‹æ•ˆæœè¯„ä¼°">æ¨¡å‹æ•ˆæœè¯„ä¼°</h2><p>æœ€åï¼Œæˆ‘ä»¬åœ¨æ–°çš„æ–‡ç« ä¸Šè¿›è¡Œè¯„ä¼°ã€‚æˆ‘ä»¬ä»ç½‘ä¸Šéšæœºé€‰å–<ahref="https://yingyu.xdf.cn/201901/10843790.html">ä¸€ç¯‡åˆä¸­è‹±è¯­é˜…è¯»ç†è§£æ–‡ç« </a>ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="hljs">Edward rose early on the New-year morning. He looked in every room and wished a Happy New Year to his family. Then he ran into the street to repeat that to those he might meet.When he came back, his father gave him two bright, new silver dollars.His face lighted up as he took them. He had wished for a long time to buy some pretty books that he had seen at the bookstore.He left the house with a light heart, expecting to buy the books. As he ran down the street, he saw a poor family.â€œI wish you a Happy New Year.â€ said Edward, as he was passing on. The man shook his head.â€œYou are not from this country.â€ said Edward. The man again shook his head, for he could not understand or speak his language. But he pointed to his mouth and to the children shaking with cold, as if (å¥½åƒ) to say, â€œThese little ones have had nothing to eat for a long time.â€Edward quickly understood that these poor people were in trouble. He took out his dollars and gave one to the man, and the other to his wife.They were excited and said something in their language, which doubtless meant, â€œWe thank you so much that we will remember you all the time.â€When Edward came home, his father asked what books he had bought. He hung his head a moment, but quickly looked up.â€œI have bought no booksâ€, said he. â€œI gave my money to some poor people, who seemed to be very hungry then.â€ He went on, â€œI think I can wait for my books till next New Year.â€â€œMy dear boy,â€ said his father, â€œhere are some books for you, more as a prize for your goodness of heart than as a New-year giftâ€â€œI saw you give the money cheerfully to the poor German family. It was nice for a little boy to do so. Be always ready to help others and every year of your life will be to you a Happy New Year.â€</code></pre><p>å››ä¸ªé—®é¢˜å¦‚ä¸‹ï¼š</p><pre><code class="hljs">48. Edward expected to _________ with the money he got from his father.A. help the poor family B. buy something to eatC. buy some pretty books D. learn another language49. Why did the poor man shake his head when Edward spoke to him?A. He couldnâ€™t understand the boy B. He wouldnâ€™t accept the moneyC. He didnâ€™t like the boyâ€™s language D. He was too cold to say anything50. How much did Edward give the poor family?A. One dollar B. Two dollars C. Three dollars D. Four dollars51. We know that Edward_________ from the passage?A. got a prize for his kind heart B. had to buy his books next yearC. bought the books at the bookstore D. got more money from his father</code></pre><p>å¾®è°ƒæ¨¡å‹ç»™å‡ºçš„ç­”æ¡ˆä¸º<strong>CABA</strong>ï¼Œä¸å‚è€ƒç­”æ¡ˆä¸€è‡´ï¼</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>å¤šé¡¹é€‰æ‹©é˜…è¯»ç†è§£ä¸€ç›´æ˜¯ç¬”è€…è¿™å‡ å¹´æ¥å…³æ³¨çš„äººç‰©ï¼Œè€Œä¹‹å‰çš„BERTæ—¶ä»£ï¼ŒBERTæ¨¡å‹çš„æ•ˆæœå¹¶ä¸å¤ªå¥½ï¼Œ<ahref="https://huggingface.co/docs/transformers/model_doc/megatron-bert">Megatron-BERT</a>å°†æŒ‡æ ‡æå‡è‡³90%å·¦å³ï¼Œè¿™ä¸­é—´ä»˜å‡ºäº†å¤ªå¤šåŠªåŠ›ï¼Œæ•ˆæœä¹Ÿä¸å¤ªå¥½å¤ç°ã€‚ç¬”è€…ä¸€ç›´éƒ½åœ¨åšè¿™æ–¹é¢çš„åŠªåŠ›ï¼Œè€Œå›¿äºæœºå™¨èµ„æºæˆ–æ¨¡å‹å‚æ•°ï¼Œéƒ½æœªèƒ½æˆåŠŸã€‚LLAMAç³»åˆ—æ¨¡å‹çš„å‡ºç°ï¼Œè®©è¿™ä¸€åˆ‡å˜å¾—å¦‚æ­¤è½»æ¾å†™æ„ï¼Œè™½ç„¶æ•ˆæœè¿˜ä¸æ˜¯SOTAï¼Œä½†æ•ˆæœæ— ç–‘æ˜¯è®©äººæ»¡æ„çš„ã€‚å¤§æ¨¡å‹æ— ç–‘æ˜¯æœªæ¥äººå·¥æ™ºèƒ½çš„æ½®æµï¼Œæ˜¯å½“ä»Šæ—¶ä»£çš„å¼„æ½®å„¿ï¼</p><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†MRCåŠRACEæ•°æ®é›†ï¼ŒåŒæ—¶ä»‹ç»äº†å¦‚ä½•åœ¨Fireflyè®­ç»ƒæ¡†æ¶ä¸‹ï¼Œé‡‡ç”¨LLAMA2æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œå¹¶å–å¾—äº†æ»¡æ„çš„æ•ˆæœã€‚</p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><center><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></center><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><center><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></center>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LLM</tag>
      
      <tag>MRC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åä¹ï¼‰æ™ºèƒ½æ–‡æ¡£åŠ©æ‰‹å‡çº§</title>
    <link href="/2023/09/09/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B9%9D%EF%BC%89%E6%99%BA%E8%83%BD%E6%96%87%E6%A1%A3%E5%8A%A9%E6%89%8B%E5%8D%87%E7%BA%A7/"/>
    <url>/2023/09/09/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B9%9D%EF%BC%89%E6%99%BA%E8%83%BD%E6%96%87%E6%A1%A3%E5%8A%A9%E6%89%8B%E5%8D%87%E7%BA%A7/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>æœ¬æ–‡åœ¨ç¬”è€…ä¹‹å‰ç ”å‘çš„<ahref="https://github.com/percent4/document_qa_with_llm">å¤§æ¨¡å‹æ™ºèƒ½æ–‡æ¡£é—®ç­”é¡¹ç›®</a>ä¸­ï¼Œå¼€å‘æ›´è¿›ä¸€æ­¥ï¼Œæ”¯æŒå¤šç§ç±»å‹æ–‡æ¡£å’ŒURLé“¾æ¥ï¼Œæ”¯æŒå¤šç§å¤§æ¨¡å‹æ¥å…¥ï¼Œä¸”ä½¿ç”¨æ›´æ–¹ä¾¿ã€é«˜æ•ˆã€‚</p></blockquote><h2 id="é¡¹ç›®ä»‹ç»">é¡¹ç›®ä»‹ç»</h2><p>åœ¨æ–‡ç« <ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485425&amp;idx=1&amp;sn=bd85ddfce82d77ceec5a66cb96835400&amp;chksm=fcb9be61cbce37773109f9703c2b6c4256d5037c8bf4497dfb9ad0f296ce0ee4065255954c1c&amp;token=385301904&amp;lang=zh_CN#rd">NLPï¼ˆå…­åä¸€ï¼‰ä½¿ç”¨Baichuan-13B-Chatæ¨¡å‹æ„å»ºæ™ºèƒ½æ–‡æ¡£</a>ä¸­ï¼Œç¬”è€…è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨<code>Baichuan-13B-Chat</code>æ¨¡å‹æ¥æ„å»ºæ™ºèƒ½æ–‡æ¡£é—®ç­”åŠ©æ‰‹ã€‚</p><p>ä¸€èˆ¬ï¼Œä½¿ç”¨å¤§æ¨¡å‹æ¥å®ç°æ–‡æ¡£é—®ç­”åŠŸèƒ½çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp60_5.jpeg" alt="LangChainæ–‡æ¡£é—®ç­”æµç¨‹" /><figcaption aria-hidden="true">LangChainæ–‡æ¡£é—®ç­”æµç¨‹</figcaption></figure><p>æœ¬æ¬¡ï¼Œç¬”è€…åœ¨ä¹‹å‰çš„é¡¹ç›®ä¸­æ›´è¿›ä¸€æ­¥ï¼Œæ”¯æŒçš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>æ”¯æŒå¤šç§æ ¼å¼æ–‡æ¡£ï¼ˆåŒ…æ‹¬txt, pdf, docxï¼‰å’ŒURLé“¾æ¥</li><li>é—®ç­”å¯è§†åŒ–é¡µé¢</li><li>é—®ç­”å¯è¿½æº¯ï¼ŒåŠ å…¥é«˜äº®æ˜¾ç¤º</li><li>å•/å¤šæ¨¡å‹è°ƒç”¨</li><li>æ¨¡å‹æ•ˆæœå¯¹æ¯”</li></ul><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><ol type="1"><li>æ”¯æŒçš„æ–‡æ¡£æ ¼å¼ç”±<code>LangChain</code>æä¾›ï¼ŒURLé“¾æ¥çš„è§£æç”±<code>LangChain</code>ä¸­çš„<strong>selenium</strong> å’Œ<strong>unstructured</strong>ï¼Œå¯æ”¯æŒJavaScriptæ¸²æŸ“çš„é¡µé¢ã€‚ä½†ç½‘é¡µè§£æï¼ˆæˆ–è€…è¯´çˆ¬è™«ï¼‰æ˜¯ä¸€é¡¹å¤æ‚è€Œè‰°å·¨çš„ä»»åŠ¡ï¼Œä¸å¯èƒ½åœ¨æœ¬é¡¹ç›®ä¸­å®ç°æ‰€æœ‰çš„ç½‘é¡µè§£æã€‚</li><li>å¯è§†åŒ–é—®ç­”é¡µé¢ç”±Gradioæ¨¡å—å®ç°</li><li>æ”¯æŒå•æ¨¡å‹æˆ–å¤šæ¨¡å‹è°ƒç”¨ï¼Œå¹¶ä¸”å¯ä»¥æä¾›é—®ç­”æº¯æºã€‚åŒæ—¶ï¼Œè¿˜æ”¯æŒä¸åŒæ¨¡å‹å›ç­”ç»“æœçš„æ¯”å¯¹ï¼Œè¯¥æƒ³æ³•æ¥æºäº<ahref="https://opencompass.org.cn/">OpenCompass</a> .</li></ol><p>åœ¨å·¥ç¨‹å¼€å‘ä¸Šï¼ŒåŠ å…¥çš„ç‰¹æ€§ï¼ˆfeaturesï¼‰å¦‚ä¸‹ï¼š</p><ul><li>ä¸°å¯Œä½¿ç”¨æ–‡æ¡£</li><li>åŠ å…¥é…ç½®æ–‡ä»¶</li><li>å¢åŠ æ—¥å¿—è°ƒç”¨</li><li>ESåˆ†è¯å™¨æ”¯æŒç”¨æˆ·è¯å…¸</li><li>Milvusæ”¯æŒåˆæ­¥ç­›é€‰çš„é˜ˆå€¼é…ç½®</li></ul><p>æœ¬é¡¹ç›®å·²å¼€æºè‡³Githubï¼Œä»£ç å®ç°å¯å‚è€ƒ<ahref="https://github.com/percent4/document_qa_with_llm">document_qa_with_llm</a>ï¼Œè¿™é‡Œä¸å†è®²è§£ä»£ç ç»†èŠ‚ã€‚</p><h2 id="æ”¯æŒæ–‡æ¡£æ ¼å¼">æ”¯æŒæ–‡æ¡£æ ¼å¼</h2><p>æœ¬é¡¹ç›®åŸå…ˆåªæ”¯æŒtxtæ ¼å¼ï¼Œç°åœ¨å·²æ”¯æŒå¤šç§æ ¼å¼æ–‡æ¡£ï¼ˆåŒ…æ‹¬txt, pdf,docxï¼‰å’ŒURLé“¾æ¥ï¼Œè¿™å¾—ç›Šäº<code>LangChain</code>æ¡†æ¶ä¸­çš„<ahref="https://python.langchain.com/docs/integrations/document_loaders/">æ–‡æ¡£åŠ è½½æ¨¡å—</a>ï¼Œä½¿å¾—å„ç§æ ¼å¼çš„æ–‡æ¡£åŠ è½½å˜å¾—æ›´åŠ ç»Ÿä¸€ã€ç®€æ´ã€é«˜æ•ˆã€‚</p><p>æœ¬é¡¹ç›®ä¸­çš„æ–‡ä»¶è§£æè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.document_loaders <span class="hljs-keyword">import</span> TextLoader, PyPDFLoader, Docx2txtLoader, SeleniumURLLoader<br><br><span class="hljs-keyword">from</span> utils.logger <span class="hljs-keyword">import</span> logger<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileParser</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, file_path</span>):<br>        self.file_path = file_path<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">txt_loader</span>(<span class="hljs-params">self</span>):<br>        documents = TextLoader(self.file_path, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>).load()<br>        <span class="hljs-keyword">return</span> documents<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pdf_loader</span>(<span class="hljs-params">self</span>):<br>        loader = PyPDFLoader(self.file_path)<br>        documents = loader.load_and_split()<br>        <span class="hljs-keyword">return</span> documents<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">docx_loader</span>(<span class="hljs-params">self</span>):<br>        loader = Docx2txtLoader(self.file_path)<br>        documents = loader.load()<br>        <span class="hljs-keyword">return</span> documents<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">url_loader</span>(<span class="hljs-params">self</span>):<br>        loader = SeleniumURLLoader(urls=[self.file_path])<br>        documents = loader.load()<br>        <span class="hljs-keyword">return</span> documents<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self</span>):<br>        logger.info(<span class="hljs-string">f&#x27;parse file: <span class="hljs-subst">&#123;self.file_path&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">if</span> self.file_path.endswith(<span class="hljs-string">&quot;.txt&quot;</span>):<br>            <span class="hljs-keyword">return</span> self.txt_loader()<br>        <span class="hljs-keyword">elif</span> self.file_path.endswith(<span class="hljs-string">&quot;.pdf&quot;</span>):<br>            <span class="hljs-keyword">return</span> self.pdf_loader()<br>        <span class="hljs-keyword">elif</span> self.file_path.endswith(<span class="hljs-string">&quot;.docx&quot;</span>):<br>            <span class="hljs-keyword">return</span> self.docx_loader()<br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;http&quot;</span> <span class="hljs-keyword">in</span> self.file_path:<br>            <span class="hljs-keyword">return</span> self.url_loader()<br>        <span class="hljs-keyword">else</span>:<br>            logger.error(<span class="hljs-string">&quot;unsupported document type!&quot;</span>)<br>            <span class="hljs-keyword">return</span> []<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    txt_file_path = <span class="hljs-string">&quot;/Users/admin/PycharmProjects/document_qa_with_llm/files/gdp.txt&quot;</span><br>    content = FileParser(txt_file_path).parse()<br>    <span class="hljs-built_in">print</span>(content)<br><br>    pdf_file_path = <span class="hljs-string">&quot;/Users/admin/PycharmProjects/document_qa_with_llm/files/oppo_n3_flip.pdf&quot;</span><br>    content = FileParser(pdf_file_path).parse()<br>    <span class="hljs-built_in">print</span>(content)<br><br>    docx_file_path = <span class="hljs-string">&quot;/Users/admin/PycharmProjects/document_qa_with_llm/files/haicaihua.docx&quot;</span><br>    content = FileParser(docx_file_path).parse()<br>    <span class="hljs-built_in">print</span>(content)<br><br>    url = <span class="hljs-string">&quot;https://gaokao.xdf.cn/202303/12967078.html&quot;</span><br>    url = <span class="hljs-string">&quot;https://www.hntv.tv/50rd/article/1/1700396378818207745?v=1.0&quot;</span><br>    content = FileParser(url).parse()<br>    <span class="hljs-built_in">print</span>(content)<br></code></pre></td></tr></table></figure><h2 id="é—®ç­”æµ‹è¯•">é—®ç­”æµ‹è¯•</h2><p>æ–‡æ¡£ä¸Šä¼ é¡µé¢å¦‚ä¸‹ï¼Œæ”¯æŒå¤šç§æ ¼å¼æ–‡æ¡£ä¸Šä¼ å’ŒURLè§£æï¼ˆä¾èµ–äºé¡µé¢è§£æèƒ½åŠ›ï¼‰ï¼Œé¡µé¢è¾ƒä¸ºç²—ç³™ã€‚</p><figure><img src="/img/nlp69_1.png" alt="æ–‡ä»¶ä¸Šä¼ é¡µé¢" /><figcaption aria-hidden="true">æ–‡ä»¶ä¸Šä¼ é¡µé¢</figcaption></figure><p>ä¸Šä¼ åçš„æ–‡ä»¶ä¼šæ”¾è‡³filesæ–‡ä»¶å¤¹ä¸Šï¼Œç¤ºä¾‹æ–‡æ¡£å¯åœ¨Githubé¡¹ç›®ä¸­filesæ–‡ä»¶å¤¹ä¸­å‚è€ƒã€‚</p><ul><li>txtæ–‡ä»¶</li></ul><p>æˆ‘ä»¬ä»¥<code>files/dengyue.txt</code>ä¸ºä¾‹ï¼Œé—®ç­”å¦‚ä¸‹ï¼š</p><blockquote><p>ä½ çŸ¥é“æ ¼é‡ŒèŠ¬çš„èŒåŠ¡å—ï¼Ÿ æ ¼é‡ŒèŠ¬çš„èŒåŠ¡æ˜¯ç¾å›½å®‡èˆªå±€å±€é•¿ã€‚</p></blockquote><blockquote><p>æ ¼é‡ŒèŠ¬å‘è¡¨æ¼”è¯´æ—¶è®²äº†ä»€ä¹ˆï¼Ÿæ ¹æ®æ–‡æ¡£çŸ¥è¯†ï¼Œæ ¼é‡ŒèŠ¬å‘è¡¨æ¼”è¯´æ—¶è®²äº†å¦‚ä¸‹å†…å®¹ï¼šä»–è®¤ä¸ºå¦‚æœä¸­å›½äººæ„¿æ„ï¼Œ2020å¹´ä»–ä»¬å¯ä»¥å®ç°è½½äººç™»æœˆå·¥ç¨‹ã€‚æ­¤å¤–ï¼Œå¶åŸ¹å»ºé™¢å£«ä¹Ÿæ›¾å‘è¡¨è‡ªå·±çš„è§‚ç‚¹ï¼Œè®¤ä¸º2025å¹´æ¯”è¾ƒåˆé€‚ã€‚ç„¶è€Œï¼Œæ ¹æ®ä¸­å›½ç§‘å­¦é™¢ç¼–åˆ¶çš„50å¹´é•¿è¿œè§„åˆ’ï¼Œä¸­å›½è¦å®ç°è½½äººç™»æœˆå·¥ç¨‹æ˜¯2030å¹´ã€‚</p></blockquote><ul><li>pdfæ–‡ä»¶</li></ul><p>æˆ‘ä»¬ä»¥<code>files/oppo_n3_flip.pdf</code>ä¸ºä¾‹ï¼Œå›ç­”å¦‚ä¸‹ï¼š</p><blockquote><p>OPPOæœ€æ–°æ¬¾æŠ˜å å±æ‰‹æœºå«ä»€ä¹ˆï¼Ÿ OPPOæœ€æ–°æ¬¾æŠ˜å å±æ‰‹æœºæ˜¯OPPO Find N3Flipã€‚</p></blockquote><blockquote><p>è…¾è®¯æœ‰å‘å¸ƒè‡ªç ”çš„å¤§æ¨¡å‹å—ï¼Œä»€ä¹ˆæ—¶å€™å‘å¸ƒçš„ï¼Ÿæ˜¯çš„ï¼Œè…¾è®¯å·²ç»å‘å¸ƒäº†è‡ªç ”çš„å¤§è¯­è¨€æ¨¡å‹ï¼Œåä¸º â€œ æ··å…ƒå¤§æ¨¡å‹ â€ ã€‚å®ƒåœ¨ 2023å¹´è…¾è®¯å…¨çƒæ•°å­—ç”Ÿæ€å¤§ä¼šä¸Šæ­£å¼å¯¹å¤–äº®ç›¸ã€‚å…·ä½“æ—¶é—´ä¸º 9 æœˆ 7 æ—¥ã€‚</p></blockquote><ul><li>docxæ–‡ä»¶</li></ul><p>æˆ‘ä»¬ä»¥<code>files/haicaihua.docx</code>ä¸ºä¾‹ï¼Œå›ç­”å¦‚ä¸‹ï¼š</p><blockquote><p>æµ·èœèŠ±å¯¹ç”Ÿé•¿ç¯å¢ƒæœ‰ä»€ä¹ˆè¦æ±‚ï¼Ÿæµ·èœèŠ±å¯¹ç”Ÿé•¿ç¯å¢ƒè¦æ±‚æé«˜ï¼Œåªèƒ½åœ¨æ°´ä½“æ´å‡€ã€é€æ˜åº¦è¾ƒé«˜çš„æ°´ä½“ä¸­ç”Ÿé•¿ï¼Œè¢«èª‰ä¸ºæ°´è´¨çš„â€œè¯•é‡‘çŸ³â€ã€‚</p></blockquote><ul><li>URLé“¾æ¥</li></ul><p>æˆ‘ä»¬ä»¥<code>https://gaokao.xdf.cn/202303/12967078.html</code>ä¸ºä¾‹ï¼Œå›ç­”å¦‚ä¸‹ï¼š</p><blockquote><p>ç”µå­ç§‘æŠ€å¤§å­¦2022å¹´æ‹›ç”Ÿå¤šå°‘äººï¼Ÿç”µå­ç§‘æŠ€å¤§å­¦2022å¹´æ‹›ç”Ÿæ€»è®¡åˆ’æ˜¯5030äººï¼Œå…¶ä¸­â€œç”µå­ç§‘æŠ€å¤§å­¦â€å°†é¢å‘å…¨å›½æ‹›ç”Ÿ3300ä½™äººï¼Œâ€œç”µå­ç§‘æŠ€å¤§å­¦(æ²™æ²³æ ¡åŒº)â€å°†é¢å‘éƒ¨åˆ†çœä»½æ‹›ç”Ÿ1700ä½™äººã€‚</p></blockquote><blockquote><p>ç”µå­ç§‘æŠ€å¤§å­¦çš„å®˜ç½‘ï¼Ÿç”µå­ç§‘æŠ€å¤§å­¦çš„å®˜ç½‘æ˜¯ï¼šhttp://www.zs.uestc.edu.cn/</p></blockquote><h2 id="å¯è§†åŒ–é—®ç­”">å¯è§†åŒ–é—®ç­”</h2><p>é™¤äº†ä¹‹å‰çš„APIè°ƒç”¨ï¼Œæœ¬é¡¹ç›®è¿˜æ”¯æŒå¯è§†åŒ–é—®ç­”ã€‚è¯¥åŠŸèƒ½ç”±<code>Gradio</code>æ¨¡å—å®ç°ï¼Œæ”¯æŒåœ¨é¡µé¢ä¸Šè¿›è¡Œå¯è§†åŒ–é—®ç­”ï¼ŒåŒæ—¶è¿˜æ”¯æŒå¤šæ¨¡å‹è°ƒç”¨ï¼Œæ”¯æŒçš„å¤§æ¨¡å‹å¦‚ä¸‹ï¼š</p><ul><li>Baichuan-13B-Chat: ç™¾å·æ™ºèƒ½å‘å¸ƒçš„æ¨¡å‹ï¼Œç°å·²æ›´æ–°è‡³Baichuan2</li><li>LLAMA-2-Chinese-13b-Chat: åœ¨LLAMA2æ¨¡å‹ä¸Šè¿›è¡Œå¾®è°ƒå¾—åˆ°çš„ä¸­æ–‡å¯¹è¯æ¨¡å‹</li><li>internlm-chat-7bï¼šä¸Šæµ·äººå·¥æ™ºèƒ½å®éªŒå®¤å‘å¸ƒçš„ä¹¦ç”Ÿï¼ˆInternLMï¼‰å¯¹è¯æ¨¡å‹</li></ul><p>è¿™äº›éƒ½æ˜¯ä¸­æ–‡å¤§æ¨¡å‹ã€‚ç†è®ºä¸Šï¼Œæ”¯æŒçš„æ¨¡å‹ç”±<ahref="https://github.com/lm-sys/FastChat">FastChat</a> å’Œéƒ¨ç½²çš„GPUå‹å·ã€æ•°é‡å†³å®šï¼Œæœ¬é¡¹ç›®åªè€ƒè™‘ä»¥ä¸Šä¸‰ç§ã€‚</p><p>è¯¥é¡µé¢æ”¯æŒå¤šæ¨¡å‹æˆ–å•æ¨¡å‹çš„é—®ç­”ã€‚<strong>å¤šæ¨¡å‹</strong>é—®ç­”æ—¶ï¼Œå¯æ¯”è¾ƒä¸åŒæ¨¡å‹åœ¨ç›¸åŒçš„Promptä¸‹çš„å›ç­”æ•ˆæœï¼Œä½œä¸ºæ¨¡å‹è¯„ä¼°çš„ä¸€ç§æ–¹å¼ã€‚</p><figure><img src="/img/nlp69_2.png" alt="å•æ¨¡å‹é—®ç­”" /><figcaption aria-hidden="true">å•æ¨¡å‹é—®ç­”</figcaption></figure><figure><img src="/img/nlp69_3.png" alt="å¤šæ¨¡å‹é—®ç­”" /><figcaption aria-hidden="true">å¤šæ¨¡å‹é—®ç­”</figcaption></figure><p>åŒæ—¶ï¼Œè¯¥é¡µé¢è¿˜æ”¯æŒé—®ç­”æº¯æºï¼Œå¯è¿½è¸ªæ–‡æ¡£é—®ç­”å¾—åˆ°çš„ç­”æ¡ˆæ‰€éœ€çš„å¼•ç”¨æ–‡æœ¬å’Œå¯¹ç”¨çš„æ•°æ®æ¥æºã€‚</p><figure><img src="/img/nlp69_4.png" alt="é—®ç­”æº¯æº" /><figcaption aria-hidden="true">é—®ç­”æº¯æº</figcaption></figure><h2 id="é—®ç­”æº¯æºä¸­çš„æ–‡æœ¬é«˜äº®">é—®ç­”æº¯æºä¸­çš„æ–‡æœ¬é«˜äº®</h2><p>ç”±äº<code>Gradio</code>ä¸­çš„è¡¨æ ¼ä¸æ”¯æŒå•å…ƒæ ¼å†…æ–‡æœ¬é«˜äº®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æ‰€ç”¨å®ƒè‡ªå¸¦çš„é«˜äº®æ–‡æœ¬æ§ä»¶å¯¹é—®ç­”æº¯æºä¸­çš„å¼•ç”¨æ–‡æœ¬è¿›è¡Œæ–‡æœ¬é«˜äº®ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹å›ç­”å†…å®¹åœ¨åŸæ–‡ä¸­çš„ä½ç½®è¿›è¡Œç¡®è®¤ï¼Œé¿å…å¤§æ¨¡å‹å¹»è§‰é—®é¢˜ã€‚</p><p>é—®ç­”æº¯æºä¸­çš„æ–‡æœ¬é«˜äº®ç®—æ³•å¦‚ä¸‹ï¼š</p><ol type="1"><li>æ‰¾åˆ°é—®ç­”æ‰€åœ¨çš„å¼•ç”¨æ–‡æœ¬åˆ—è¡¨ï¼Œç”±ESå’ŒMilvusäº§ç”Ÿ</li><li>å¯¹å¼•ç”¨æ–‡æœ¬æ‹†åˆ†æˆåˆ—è¡¨</li><li>å¾—åˆ°ä¸å›ç­”ç›¸ä¼¼åº¦æœ€é«˜çš„æ–‡æœ¬ï¼Œç›¸ä¼¼åº¦é‡‡ç”¨Jaccardç³»æ•°</li><li>å°†ç›¸ä¼¼åº¦æœ€é«˜æ–‡æœ¬ä¸­ä¸å›ç­”é‡åˆçš„éƒ¨åˆ†ï¼Œè¿›è¡Œé«˜äº®æ˜¾ç¤º</li></ol><figure><img src="/img/nlp69_5.png" alt="é—®ç­”æº¯æºä¸­çš„æ–‡æœ¬é«˜äº®" /><figcaption aria-hidden="true">é—®ç­”æº¯æºä¸­çš„æ–‡æœ¬é«˜äº®</figcaption></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ¬é¡¹ç›®åœ¨ä¹‹å‰å¼€æºçš„åŸºç¡€ä¸Šï¼ŒåŠ å…¥äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ”¯æŒå¤šç§æ ¼å¼æ–‡æ¡£è§£æå’ŒURLè§£æï¼Œæ”¯æŒé—®ç­”å¯è§†åŒ–é¡µé¢ï¼Œæ”¯æŒå•/å¤šæ¨¡å‹è°ƒç”¨ï¼Œæ”¯æŒå¤šæ¨¡å‹æ•ˆæœå¯¹æ¯”ã€‚</p><p>æœ¬é¡¹ç›®å·²å¼€æºè‡³Githubï¼Œä»£ç å®ç°å¯å‚è€ƒ<ahref="https://github.com/percent4/document_qa_with_llm">document_qa_with_llm</a>ã€‚</p><h4 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»</h4><ul><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485425&amp;idx=1&amp;sn=bd85ddfce82d77ceec5a66cb96835400&amp;chksm=fcb9be61cbce37773109f9703c2b6c4256d5037c8bf4497dfb9ad0f296ce0ee4065255954c1c&amp;token=385301904&amp;lang=zh_CN#rd">NLPï¼ˆå…­åä¸€ï¼‰ä½¿ç”¨Baichuan-13B-Chatæ¨¡å‹æ„å»ºæ™ºèƒ½æ–‡æ¡£</a></li><li><ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247485495&amp;idx=1&amp;sn=be35afc0d6fb7f6159af6ad13fda6f93&amp;chksm=fcb9b1a7cbce38b1f86fd3264d58ef15c565c3c1e4bb60204ab819f3a987d69c9ee3ef527491&amp;token=385301904&amp;lang=zh_CN#rd">Gradioå…¥é—¨ï¼ˆ1ï¼‰è¾“å…¥è¾“å‡ºã€è¡¨æ ¼ã€æ–‡æœ¬é«˜äº®</a></li></ul><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><p><img src="https://s2.loli.net/2023/09/07/BFUl9i4872wWATx.jpg" style="width:200px;"></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒâ€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><p><img src="https://s2.loli.net/2023/09/07/bYtEecQBfjRlUd1.jpg" style="width:200px;"></p><p>å¼•ç”¨é“¾æ¥</p><p>[1] å¤§æ¨¡å‹æ™ºèƒ½æ–‡æ¡£é—®ç­”é¡¹ç›®:https://github.com/percent4/document_qa_with_llm</p><p>[2] OpenCompass: https://opencompass.org.cn/</p><p>[3] document_qa_with_llm:https://github.com/percent4/document_qa_with_llm</p><p>[4] æ–‡æ¡£åŠ è½½æ¨¡å—:https://python.langchain.com/docs/integrations/document_loaders/</p><p>[5] FastChat: https://github.com/lm-sys/FastChat</p><p>[6] document_qa_with_llm:https://github.com/percent4/document_qa_with_llm</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ–‡æ¡£é—®ç­”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºtokençš„ç¼–è¾‘è·ç¦»è®¡ç®—</title>
    <link href="/2023/09/09/%E5%9F%BA%E4%BA%8Etoken%E7%9A%84%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97/"/>
    <url>/2023/09/09/%E5%9F%BA%E4%BA%8Etoken%E7%9A%84%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>å­—ç¬¦ä¸²çš„<strong>ç¼–è¾‘è·ç¦»</strong>æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“çš„ï¼Œäº‹å®ä¸Šï¼Œç¼–è¾‘è·ç¦»çš„è®¡ç®—ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹åˆ—è¡¨å…ƒç´ çš„æ“ä½œï¼Œé‚£ä¹ˆï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥æ˜¯tokenåˆ—è¡¨ã€‚æœ¬æ–‡çš„æƒ³æ³•æ­£æ˜¯åŸºäºæ­¤ã€‚</p></blockquote><h2 id="å­—ç¬¦ä¸²çš„ç¼–è¾‘è·ç¦»">å­—ç¬¦ä¸²çš„ç¼–è¾‘è·ç¦»</h2><p>åœ¨æ–‡ç« <a href="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484130&amp;idx=1&amp;sn=dc34277848f23f6a80077d970eb0af2f&amp;chksm=fcb9bb72cbce3264c9e08f26be4b2d07ddd3d57bc060d8d5819c12fd4d121fbe811674125199&amp;token=385301904&amp;lang=zh_CN#rd">åŠ¨æ€è§„åˆ’æ³•ç®—æ³•ä¹‹ç¼–è¾‘è·ç¦»</a>ä¸­ï¼Œç¬”è€…è¯¦ç»†ä»‹ç»äº†å­—ç¬¦ä¸²çš„ç¼–è¾‘è·ç¦»å®šä¹‰åŠä½¿ç”¨åŠ¨æ€è§„åˆ’æ³•ï¼ˆDynamic Programming, DPï¼‰æ¥è§£å†³ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å­—ç¬¦ä¸²çš„ç¼–è¾‘è·ç¦»çš„å®šä¹‰ã€‚ä»€ä¹ˆæ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²çš„<strong>ç¼–è¾‘è·ç¦»ï¼ˆedit distanceï¼‰</strong>ï¼Ÿç»™å®šå­—ç¬¦ä¸²s1å’Œs2ï¼Œä»¥åŠåœ¨s1ä¸Šçš„å¦‚ä¸‹æ“ä½œï¼š</p><ul><li><code>æ’å…¥</code>ï¼ˆInsertï¼‰ä¸€ä¸ªå­—ç¬¦</li><li><code>ç§»é™¤</code>ï¼ˆRemoveï¼‰ä¸€ä¸ªå­—ç¬¦</li><li><code>æ›¿æ¢</code>ï¼ˆReplaceï¼‰ä¸€ä¸ªå­—ç¬¦</li></ul><p>è¯•é—®æœ€å°éœ€è¦å¤šå°‘æ¬¡è¿™æ ·çš„æ“ä½œæ‰èƒ½ä½¿å¾—s1è½¬æ¢ä¸ºs2ï¼Ÿ</p><p>åœ¨leetcodeç½‘ç«™ä¸­ï¼Œè¿™æ˜¯é¢˜ç›®ä¸­çš„<a href="https://leetcode.cn/problems/edit-distance/">ç¬¬72é¢˜</a>ï¼Œéš¾åº¦ä¸ºhardã€‚</p><p>ç¬”è€…å½“æ—¶ä½¿ç”¨åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">string_edit_distance</span>(<span class="hljs-params">s1, s2</span>):<br>    n = <span class="hljs-built_in">len</span>(s1)<br>    m = <span class="hljs-built_in">len</span>(s2)<br><br>    <span class="hljs-comment"># æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºä¸²</span><br>    <span class="hljs-keyword">if</span> n * m == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> n + m<br><br>    <span class="hljs-comment"># DP æ•°ç»„</span><br>    D = [[<span class="hljs-number">0</span>] * (m + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><br>    <span class="hljs-comment"># è¾¹ç•ŒçŠ¶æ€åˆå§‹åŒ–</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>):<br>        D[i][<span class="hljs-number">0</span>] = i<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):<br>        D[<span class="hljs-number">0</span>][j] = j<br><br>    <span class="hljs-comment"># è®¡ç®—æ‰€æœ‰ DP å€¼</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):<br>            left = D[i - <span class="hljs-number">1</span>][j] + <span class="hljs-number">1</span><br>            down = D[i][j - <span class="hljs-number">1</span>] + <span class="hljs-number">1</span><br>            left_down = D[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">if</span> s1[i - <span class="hljs-number">1</span>] != s2[j - <span class="hljs-number">1</span>]:<br>                left_down += <span class="hljs-number">1</span><br>            D[i][j] = <span class="hljs-built_in">min</span>(left, down, left_down)<br><br>    <span class="hljs-keyword">return</span> D[n][m]<br></code></pre></td></tr></table></figure><blockquote><p>è¯¥ç®—æ³•æ˜¯å­—ç¬¦ä¸²ç¼–è¾‘è·ç¦»çš„å¸¸è§„ä¼˜åŒ–ç®—æ³•ã€‚</p></blockquote><h2 id="åŸºäºtokençš„ç¼–è¾‘è·ç¦»">åŸºäºtokençš„ç¼–è¾‘è·ç¦»</h2><p>ä¸éš¾å‘ç°ï¼Œä¸Šè¿°çš„å­—ç¬¦ä¸²ç¼–è¾‘è·ç¦»çš„ç®—æ³•ï¼Œå¯ä»¥æ‰©å±•è‡³ä¸€åˆ‡åˆ—è¡¨å…ƒç´ çš„ç¼–è¾‘è·ç¦»ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©tokenåˆ—è¡¨ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨<code>tiktoken</code>å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºtokenåˆ—è¡¨ã€‚</p><p>åŸºäºtokençš„ç¼–è¾‘è·ç¦»ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tiktoken<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">token_edit_distance</span>(<span class="hljs-params">s1, s2</span>):<br>    enc = tiktoken.get_encoding(<span class="hljs-string">&quot;cl100k_base&quot;</span>)<br>    token_list1 = enc.encode(s1)<br>    token_list2 = enc.encode(s2)<br>    <span class="hljs-built_in">print</span>(token_list1)<br>    <span class="hljs-built_in">print</span>(token_list2)<br>    <span class="hljs-keyword">return</span> string_edit_distance(token_list1, token_list2)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é€‰å–ä¸¤ä¸ªä¾‹å­è¿›è¡Œæµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># case 1</span><br>    text1 = <span class="hljs-string">&quot;tiktoken is good&quot;</span><br>    text2 = <span class="hljs-string">&quot;tiktoken is great&quot;</span><br>    <span class="hljs-built_in">print</span>(string_edit_distance(text1, text2))<br>    <span class="hljs-built_in">print</span>(token_edit_distance(text1, text2))<br><br>    <span class="hljs-comment"># case 2</span><br>    text1 = <span class="hljs-string">&quot;iPhoneæ‰‹æœºå¾ˆæ£’ï¼&quot;</span><br>    text2 = <span class="hljs-string">&quot;åä¸ºæ‰‹æœºå¾ˆæ£’ï¼&quot;</span><br>    <span class="hljs-built_in">print</span>(string_edit_distance(text1, text2))<br>    <span class="hljs-built_in">print</span>(token_edit_distance(text1, text2))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">4<br>[83, 1609, 5963, 374, 1695]<br>[83, 1609, 5963, 374, 2294]<br>1<br>6<br>[45840, 59505, 17599, 230, 77062, 240, 6447]<br>[86461, 18184, 59505, 17599, 230, 77062, 240, 6447]<br>2<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>æœ¬æ–‡çš„æƒ³æ³•è¾ƒä¸ºç®€å•ï¼Œæ˜¯å°†å­—ç¬¦ä¸²çš„<strong>ç¼–è¾‘è·ç¦»</strong>æ¨å¹¿è‡³tokenåˆ—è¡¨çš„ç¼–è¾‘è·ç¦»ï¼Œå¯ä»¥ä½œä¸ºä¸€ç§è¡¡é‡å­—ç¬¦ä¸²ç›¸ä¼¼åº¦çš„æŒ‡æ ‡ã€‚</p><p><code>å…¶å®ƒæƒ³æ³•</code>å¦‚ä¸‹ï¼š</p><ol><li>ä¸ä»…å­—ç¬¦ä¸²ï¼Œtokenå¯ä»¥ä½œä¸ºå­—ç¬¦ä¸²ç›¸ä¼¼åº¦çš„è¡¡é‡æ ‡å‡†ï¼Œåœ¨æ–‡æœ¬çº é”™ä¸­ï¼Œæ‹¼éŸ³ä¹Ÿå¯ä½œä¸ºæ ‡å‡†</li><li>edit distanceæœ¬è´¨ä¸Šæ˜¯ä¸¤ä¸ªåˆ—è¡¨çš„ç¼–è¾‘è·ç¦»</li><li>åˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œæ–‡æœ¬çº é”™ï¼Œå®è´¨ä¸Šæ˜¯å¯¹tokenè¿›è¡Œçº é”™</li><li>åœ¨ä¸­è‹±æ–‡æ··åˆåœºæ™¯ä¹Ÿè®¸æœ‰ç”¨</li></ol><h4 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»</h4><ul><li><a href="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484130&amp;idx=1&amp;sn=dc34277848f23f6a80077d970eb0af2f&amp;chksm=fcb9bb72cbce3264c9e08f26be4b2d07ddd3d57bc060d8d5819c12fd4d121fbe811674125199&amp;token=385301904&amp;lang=zh_CN#rd">åŠ¨æ€è§„åˆ’æ³•ç®—æ³•ä¹‹ç¼–è¾‘è·ç¦»</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484135&amp;idx=1&amp;sn=803081aa7940bb81a67e7310a912d4db&amp;chksm=fcb9bb77cbce3261e6a291b432376aad1ae2c93929cb8f6cc711728efda8f651506fd6809db8&amp;token=385301904&amp;lang=zh_CN#rd">å•è¯çº é”™</a></li></ul><hr><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>NLPå¥‡å¹»ä¹‹æ—…</strong>ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚</p><img src="https://img-blog.csdnimg.cn/img_convert/8562f60caee45918bf34261bba008c77.jpeg" style="width:100px;"><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œ<strong>è‡ªç„¶è¯­è¨€å¤„ç†å¥‡å¹»ä¹‹æ—…</strong>â€ï¼Œç¬”è€…æ­£åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æŠ€æœ¯ç¤¾åŒºã€‚</p><img src="https://img-blog.csdnimg.cn/img_convert/6a816b105c18ca778a6a0b6cbb0879fc.jpeg" style="width:100px;">]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¾‘è·ç¦»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åå…«ï¼‰ä½¿ç”¨Optimumè¿›è¡Œæ¨¡å‹é‡åŒ–</title>
    <link href="/2023/09/06/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8Optimum%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96/"/>
    <url>/2023/09/06/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8Optimum%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨HuggingFaceçš„<code>Optimum</code>ï¼Œæ¥å¯¹å¾®è°ƒåçš„BERTæ¨¡å‹è¿›è¡Œé‡åŒ–ï¼ˆQuantizationï¼‰ã€‚</p><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/09/03/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%83%EF%BC%89BERT%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%90%8E%E5%8A%A8%E6%80%81%E9%87%8F%E5%8C%96%EF%BC%88PTDQ%EF%BC%89/">NLPï¼ˆå…­åä¸ƒï¼‰BERTæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPTDQï¼‰</a>ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨PyTorchè‡ªå¸¦çš„PTDQï¼ˆPostTraining DynamicQuantizationï¼‰é‡åŒ–ç­–ç•¥å¯¹å¾®è°ƒåçš„BERTæ¨¡å‹è¿›è¡Œé‡åŒ–ï¼Œå–å¾—äº†æ¨¡å‹æ¨ç†æ€§èƒ½çš„æå‡ï¼ˆå¤§çº¦1.5å€ï¼‰ã€‚æœ¬æ–‡å°†å°è¯•ä½¿ç”¨<code>Optimum</code>é‡åŒ–å·¥å…·ã€‚</p><h3 id="optimumä»‹ç»">Optimumä»‹ç»</h3><p><code>Optimum</code> æ˜¯ <code>Transformers</code>çš„æ‰©å±•ï¼Œå®ƒæä¾›äº†ä¸€ç»„æ€§èƒ½ä¼˜åŒ–å·¥å…·ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç¡¬ä»¶ä¸Šä»¥æœ€é«˜æ•ˆç‡è®­ç»ƒå’Œè¿è¡Œæ¨¡å‹ã€‚</p><p><code>Optimum</code>é’ˆå¯¹ä¸åŒçš„ç¡¬ä»¶ï¼Œæä¾›äº†ä¸åŒçš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr class="header"><th>ç¡¬ä»¶</th><th>å®‰è£…å‘½ä»¤</th></tr></thead><tbody><tr class="odd"><td>ONNX runtime</td><td>python -m pip install optimum[onnxruntime]</td></tr><tr class="even"><td>Intel Neural Compressor (INC)</td><td>python -m pip install optimum[neural-compressor]</td></tr><tr class="odd"><td>Intel OpenVINO</td><td>python -m pip install optimum[openvino,nncf]</td></tr><tr class="even"><td>Graphcore IPU</td><td>python -m pip install optimum[graphcore]</td></tr><tr class="odd"><td>Habana Gaudi Processor (HPU)</td><td>python -m pip install optimum[habana]</td></tr><tr class="even"><td>GPU</td><td>python -m pip install optimum[onnxruntime-gpu]</td></tr></tbody></table><p>æœ¬æ–‡å°†ä¼šä»‹ç»åŸºäºONNXçš„æ¨¡å‹é‡åŒ–æŠ€æœ¯ã€‚ONNXï¼ˆè‹±è¯­ï¼šOpen Neural NetworkExchangeï¼‰æ˜¯ä¸€ç§é’ˆå¯¹æœºå™¨å­¦ä¹ æ‰€è®¾è®¡çš„å¼€æ”¾å¼çš„æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå­˜å‚¨è®­ç»ƒå¥½çš„æ¨¡å‹ã€‚å®ƒä½¿å¾—ä¸åŒçš„äººå·¥æ™ºèƒ½æ¡†æ¶ï¼ˆå¦‚Pytorchã€MXNetï¼‰å¯ä»¥é‡‡ç”¨ç›¸åŒæ ¼å¼å­˜å‚¨æ¨¡å‹æ•°æ®å¹¶äº¤äº’ã€‚</p><h3 id="æ¨¡å‹é‡åŒ–">æ¨¡å‹é‡åŒ–</h3><p>æˆ‘ä»¬ä½¿ç”¨çš„å¾®è°ƒåçš„BERTæ¨¡å‹é‡‡ç”¨æ–‡ç« <ahref="https://percent4.github.io/2023/09/02/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8HuggingFace%E4%B8%AD%E7%9A%84Trainer%E8%BF%9B%E8%A1%8CBERT%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">https://percent4.github.io/2023/09/02/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8HuggingFace%E4%B8%AD%E7%9A%84Trainer%E8%BF%9B%E8%A1%8CBERT%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</a>ä¸­ç»™å‡ºçš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆåŠ è½½PyTorchä¸­çš„è®¾å¤‡ï¼ˆCPUï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># load device</span><br><span class="hljs-keyword">import</span> torch<br><br>device = torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>optimum.onnxruntime</code>æ¨¡å—åŠ è½½æ¨¡å‹å’Œtokenizerï¼Œå¹¶å°†æ¨¡å‹ä¿å­˜ä¸ºonnxæ ¼å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> optimum.onnxruntime <span class="hljs-keyword">import</span> ORTModelForSequenceClassification<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer<br><span class="hljs-keyword">import</span> torch<br><br>model_id = <span class="hljs-string">&quot;./sougou_test_trainer_256/checkpoint-96&quot;</span><br>onnx_path = <span class="hljs-string">&quot;./sougou_test_trainer_256/onnx_256&quot;</span><br><br><span class="hljs-comment"># load vanilla transformers and convert to onnx</span><br>model = ORTModelForSequenceClassification.from_pretrained(model_id, from_transformers=<span class="hljs-literal">True</span>)<br>tokenizer = AutoTokenizer.from_pretrained(model_id)<br><br><span class="hljs-comment"># save onnx checkpoint and tokenizer</span><br>model.save_pretrained(onnx_path)<br>tokenizer.save_pretrained(onnx_path)<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œä¼šå¤šå‡ºonnx_256æ–‡ä»¶å¤¹ï¼Œä¿å­˜æ¨¡å‹ä¸ºmodel.onnxã€‚</p><figure><img src="/img/nlp68_1.png" alt="ä¿å­˜ä¸ºonnxæ¨¡å‹" /><figcaption aria-hidden="true">ä¿å­˜ä¸ºonnxæ¨¡å‹</figcaption></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scheme">(<span class="hljs-symbol">&#x27;./sougou_test_trainer_256/onnx_256</span>\\tokenizer_config.json&#x27;,<br> <span class="hljs-symbol">&#x27;./sougou_test_trainer_256/onnx_256</span>\\special_tokens_map.json&#x27;,<br> <span class="hljs-symbol">&#x27;./sougou_test_trainer_256/onnx_256</span>\\vocab.txt&#x27;,<br> <span class="hljs-symbol">&#x27;./sougou_test_trainer_256/onnx_256</span>\\added_tokens.json&#x27;,<br> <span class="hljs-symbol">&#x27;./sougou_test_trainer_256/onnx_256</span>\\tokenizer.json&#x27;)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>transfomers</code>ä¸­çš„pipelineå¯¹æ¨¡å‹è¿›è¡Œå¿«é€Ÿæ¨ç†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline<br><br>vanilla_clf = pipeline(<span class="hljs-string">&quot;text-classification&quot;</span>, model=model, tokenizer=tokenizer)<br>vanilla_clf(<span class="hljs-string">&quot;è¿™æœŸèŠ‚ç›®ç»§ç»­å…³æ³¨ä¸­å›½ç¯®çƒçš„è¯é¢˜ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬å·²ç»ç»“æŸäº†ç”·ç¯®ä¸–ç•Œæ¯çš„æ‰€æœ‰èµ›ç¨‹ï¼Œä¸€èƒœå››è´Ÿçš„ä¸€ä¸ªæˆç»©ï¼Œç”šè‡³æ¯”ä¸Šä¸€å±Šçš„ä¸–ç•Œæ¯æˆç»©è¿˜è¦å·®ã€‚å› ä¸ºè¿™ä¸€æ¬¡æˆ‘ä»¬è¿å¥¥è¿ä¼šè½é€‰èµ›ä¹Ÿéƒ½æ²¡æœ‰èµ„æ ¼å‚åŠ ï¼Œæ‰€ä»¥ï¼Œè¿ç»­ä¸¤æ¬¡é”™è¿‡äº†å·´é»å¥¥è¿ä¼šçš„è¯ï¼Œå¯¹äºä¸­å›½ç¯®åï¼Œè¿˜æœ‰å¯¹äºå§šæ˜æ¥è¯´ï¼Œç¡®å®æˆä¸ºäº†ä»–ä»»èŒçš„ä¸€ä¸ªæœ€å¤§çš„è´¥ç¬”ã€‚å¯¹äºçƒè¿·éå¸¸å…³æ³¨çš„ä¸€ä¸ªè¯é¢˜ï¼Œä¹”å°”æ°ç»´å¥‡æ˜¯å¦ä¸‹è¯¾ï¼Œå¯èƒ½å¯¹äºè¿™ä¸ªæ‚¬å¿µæ¥è¯´ä¹Ÿéƒ½æ˜¯æš‚æ—¶æœ‰ç­”æ¡ˆäº†ã€‚&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[&#123;<span class="hljs-symbol">&#x27;label</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-symbol">&#x27;LABEL_0</span>&#x27;, <span class="hljs-symbol">&#x27;score</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-number">0.9963239431381226</span>&#125;]<br></code></pre></td></tr></table></figure><p>å¯¹ONNXæ¨¡å‹è¿›è¡Œä¼˜åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> optimum.onnxruntime <span class="hljs-keyword">import</span> ORTOptimizer<br><span class="hljs-keyword">from</span> optimum.onnxruntime.configuration <span class="hljs-keyword">import</span> OptimizationConfig<br><br><span class="hljs-comment"># create ORTOptimizer and define optimization configuration</span><br>optimizer = ORTOptimizer.from_pretrained(model)<br>optimization_config = OptimizationConfig(optimization_level=<span class="hljs-number">99</span>) <span class="hljs-comment"># enable all optimizations</span><br><br><span class="hljs-comment"># apply the optimization configuration to the model</span><br>optimizer.optimize(<br>    save_dir=onnx_path,<br>    optimization_config=optimization_config,<br>)<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œä¼˜åŒ–åçš„æ¨¡å‹ä¸ºmodel_optimized.onnxã€‚</p><p>å¯¹ä¼˜åŒ–åçš„æ¨¡å‹è¿›è¡Œæ¨ç†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline<br><br><span class="hljs-comment"># load optimized model</span><br>optimized_model = ORTModelForSequenceClassification.from_pretrained(onnx_path, file_name=<span class="hljs-string">&quot;model_optimized.onnx&quot;</span>)<br><br><span class="hljs-comment"># create optimized pipeline</span><br>optimized_clf = pipeline(<span class="hljs-string">&quot;text-classification&quot;</span>, model=optimized_model, tokenizer=tokenizer)<br>optimized_clf(<span class="hljs-string">&quot;ä»Šå¹´7æœˆï¼Œæ•™è‚²éƒ¨ç­‰å››éƒ¨é—¨è”åˆå°å‘äº†ã€Šå…³äºåœ¨æ·±åŒ–éå­¦ç§‘ç±»æ ¡å¤–åŸ¹è®­æ²»ç†ä¸­åŠ å¼ºè‰ºè€ƒåŸ¹è®­è§„èŒƒç®¡ç†çš„é€šçŸ¥ã€‹ï¼ˆä»¥ä¸‹ç®€ç§°ã€Šé€šçŸ¥ã€‹ï¼‰ã€‚ã€Šé€šçŸ¥ã€‹é’ˆå¯¹è¿‘å¹´æ¥æ ¡å¤–è‰ºæœ¯åŸ¹è®­çš„çŠ¶å†µè€Œå‘å¸ƒï¼Œå¹¶ä»æºå¤´å°±æ ¡å¤–è‰ºæœ¯åŸ¹è®­æœºæ„çš„â€œåŸ¹è®­ä¸»ä½“ã€ä»ä¸šäººå‘˜ã€æ‹›ç”Ÿè¡Œä¸ºã€å®‰å…¨åº•çº¿â€ç­‰æ–¹é¢è¿›è¡Œä¸¥æ ¼è§„èŒƒã€‚æ ¡å¤–è‰ºæœ¯åŸ¹è®­ä¹‹æ‰€ä»¥ç«çƒ­ï¼Œä¸»è¦åœ¨äºé«˜ä¸­é˜¶æ®µè‰ºæœ¯æ•™è‚²å‘å±•è¿Ÿæ»äºå­¦ç”Ÿéœ€æ±‚ã€‚åˆ†ææ•™è‚²éƒ¨æ•°æ®ï¼Œ2021å¹´è‰ºæœ¯å­¦ç§‘åœ¨æ ¡ç”Ÿå æ¯”ä¸º9.84%ï¼Œé«˜äº2020å¹´çš„9.73%ï¼›2020è‡³2021å¹´è‰ºæœ¯å­¦ç§‘åœ¨æ ¡ç”Ÿçš„å¹´å¢é•¿ç‡ä¸º5.04%ï¼Œè¿œé«˜äº4.28%çš„æ€»åœ¨æ ¡ç”Ÿå¹´å¢é•¿ç‡ã€‚å¢é•¿çš„æ•°æ®ï¼Œæ˜¯è¿‘å¹´æ¥è‰ºè€ƒæ‹›ç”Ÿè¿å¹´ç«çƒ­çš„ç¼©å½±ï¼Œåœ¨æœªæ¥ä¸€æ®µæ—¶é—´å†…ï¼Œè‰ºè€ƒæˆ–å°†åœ¨å…¨å›½èŒƒå›´å†…ç»§ç»­ä¿æŒé«˜çƒ­åº¦ã€‚&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[&#123;<span class="hljs-symbol">&#x27;label</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-symbol">&#x27;LABEL_3</span>&#x27;, <span class="hljs-symbol">&#x27;score</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-number">0.9926980137825012</span>&#125;]<br></code></pre></td></tr></table></figure><p>å¯¹ä¼˜åŒ–åçš„ONNXæ¨¡å‹å†è¿›è¡Œé‡åŒ–ï¼Œä»£ç ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> optimum.onnxruntime <span class="hljs-keyword">import</span> ORTQuantizer<br><span class="hljs-keyword">from</span> optimum.onnxruntime.configuration <span class="hljs-keyword">import</span> AutoQuantizationConfig<br><br><span class="hljs-comment"># create ORTQuantizer and define quantization configuration</span><br>dynamic_quantizer = ORTQuantizer.from_pretrained(optimized_model)<br>dqconfig = AutoQuantizationConfig.avx2(is_static=<span class="hljs-literal">False</span>, per_channel=<span class="hljs-literal">False</span>)<br><br><span class="hljs-comment"># apply the quantization configuration to the model</span><br>model_quantized_path = dynamic_quantizer.quantize(<br>    save_dir=onnx_path,<br>    quantization_config=dqconfig,<br>)<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶é‡åŒ–åçš„æ¨¡å‹ä¸ºmodel_optimized_quantized.onnxã€‚æ¯”è¾ƒé‡åŒ–å‰åçš„æ¨¡å‹å¤§å°ï¼Œä»£ç ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># get model file size</span><br>size = os.path.getsize(os.path.join(onnx_path, <span class="hljs-string">&quot;model_optimized.onnx&quot;</span>))/(<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>)<br>quantized_model = os.path.getsize(os.path.join(onnx_path, <span class="hljs-string">&quot;model_optimized_quantized.onnx&quot;</span>))/(<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Model file size: <span class="hljs-subst">&#123;size:<span class="hljs-number">.2</span>f&#125;</span> MB&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Quantized Model file size: <span class="hljs-subst">&#123;quantized_model:<span class="hljs-number">.2</span>f&#125;</span> MB&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Model</span> file size: <span class="hljs-number">390</span>.<span class="hljs-number">17</span> MB<br><span class="hljs-attribute">Quantized</span> Model file size: <span class="hljs-number">97</span>.<span class="hljs-number">98</span> MB<br></code></pre></td></tr></table></figure><p>æœ€åï¼ŒåŠ è½½é‡åŒ–åçš„æ¨¡å‹ï¼Œä»£ç ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># load quantization model</span><br><span class="hljs-keyword">from</span> optimum.onnxruntime <span class="hljs-keyword">import</span> ORTModelForSequenceClassification<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline, AutoTokenizer<br><br>quantized_model = ORTModelForSequenceClassification.from_pretrained(onnx_path, file_name=<span class="hljs-string">&quot;model_optimized_quantized.onnx&quot;</span>).to(device)<br>tokenizer = AutoTokenizer.from_pretrained(onnx_path)<br></code></pre></td></tr></table></figure><h3 id="æ¨ç†å®éªŒ">æ¨ç†å®éªŒ</h3><p>åœ¨è¿›è¡Œæ¨¡å‹æ¨ç†å®éªŒå‰ï¼Œå…ˆåŠ è½½æµ‹è¯•æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br>test_df = pd.read_csv(<span class="hljs-string">&quot;./data/sougou/test.csv&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨é‡åŒ–å‰çš„æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œè®°å½•æ¨ç†æ—¶é—´ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># original model evaluate</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> time<br><br>cost_time_list = []<br>s_time = time.time()<br>true_labels, pred_labels = [], [] <br><span class="hljs-keyword">for</span> i, row <span class="hljs-keyword">in</span> test_df.iterrows():<br>    row_s_time = time.time()<br>    true_labels.append(row[<span class="hljs-string">&quot;label&quot;</span>])<br>    encoded_text = tokenizer(row[<span class="hljs-string">&#x27;text&#x27;</span>], max_length=<span class="hljs-number">256</span>, truncation=<span class="hljs-literal">True</span>, padding=<span class="hljs-literal">True</span>, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>)<br>    <span class="hljs-comment"># print(encoded_text)</span><br>    logits = model(**encoded_text)<br>    label_id = np.argmax(logits[<span class="hljs-number">0</span>].detach().numpy(), axis=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br>    pred_labels.append(label_id)<br>    cost_time_list.append((time.time() - row_s_time) * <span class="hljs-number">1000</span>)<br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">100</span>:<br>    <span class="hljs-built_in">print</span>(i, (time.time() - row_s_time) * <span class="hljs-number">1000</span>, label_id)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;avg time:&quot;</span>, (time.time() - s_time) * <span class="hljs-number">1000</span> / test_df.shape[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;P50 time:&quot;</span>, np.percentile(np.array(cost_time_list), <span class="hljs-number">50</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;P95 time:&quot;</span>, np.percentile(np.array(cost_time_list), <span class="hljs-number">95</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span> <span class="hljs-number">710</span>.<span class="hljs-number">2577686309814</span> <span class="hljs-number">0</span><br><span class="hljs-attribute">100</span> <span class="hljs-number">477</span>.<span class="hljs-number">72765159606934</span> <span class="hljs-number">1</span><br><span class="hljs-attribute">200</span> <span class="hljs-number">616</span>.<span class="hljs-number">3530349731445</span> <span class="hljs-number">2</span><br><span class="hljs-attribute">300</span> <span class="hljs-number">509</span>.<span class="hljs-number">63783264160156</span> <span class="hljs-number">3</span><br><span class="hljs-attribute">400</span> <span class="hljs-number">531</span>.<span class="hljs-number">57639503479</span> <span class="hljs-number">4</span><br><br><span class="hljs-attribute">avg</span> time: <span class="hljs-number">501</span>.<span class="hljs-number">0757282526806</span><br><span class="hljs-attribute">P50</span> time: <span class="hljs-number">504</span>.<span class="hljs-number">6522617340088</span><br><span class="hljs-attribute">P95</span> time: <span class="hljs-number">623</span>.<span class="hljs-number">9353895187337</span><br><br></code></pre></td></tr></table></figure><p>å¯¹è¾“å‡ºç»“æœè¿›è¡ŒæŒ‡æ ‡è¯„çº§ï¼Œä»£ç ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report<br><br><span class="hljs-built_in">print</span>(classification_report(true_labels, pred_labels, digits=<span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure><p>é‡å¤ä¸Šè¿°ä»£ç ï¼Œå°†æ¨¡å‹æ›¿æ¢ä¸ºé‡åŒ–å‰ONNXæ¨¡å‹ï¼ˆmodel.onnxï¼‰ï¼Œä¼˜åŒ–åONNXæ¨¡å‹ï¼ˆmodel_oprimized.onnxï¼‰ï¼Œé‡åŒ–åONNXæ¨¡å‹ï¼ˆmodel_optimized_quantized.onnxï¼‰ï¼Œè¿›è¡Œæ¨ç†æ—¶é—´ï¼ˆå•ä½ï¼šmsï¼‰ç»Ÿè®¡å’Œæ¨ç†æŒ‡æ ‡è¯„ä¼°ï¼Œç»“æœè§ä¸‹è¡¨ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹</th><th>å¹³å‡æ¨ç†æ—¶é—´</th><th>P95æ¨ç†æ—¶é—´</th><th>weighted F1</th></tr></thead><tbody><tr class="odd"><td>é‡åŒ–å‰ONNXæ¨¡å‹</td><td>501.1</td><td>623.9</td><td>0.9717</td></tr><tr class="even"><td>ä¼˜åŒ–åONNXæ¨¡å‹</td><td>484.6</td><td>629.6</td><td>0.9717</td></tr><tr class="odd"><td>é‡åŒ–åONNXæ¨¡å‹</td><td>361.5</td><td>426.9</td><td>0.9738</td></tr></tbody></table><p>å¯¹æ¯”æ–‡ç« <ahref="https://percent4.github.io/2023/09/03/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%83%EF%BC%89BERT%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%90%8E%E5%8A%A8%E6%80%81%E9%87%8F%E5%8C%96%EF%BC%88PTDQ%EF%BC%89/">NLPï¼ˆå…­åä¸ƒï¼‰BERTæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPTDQï¼‰</a>ä¸­çš„æ¨ç†ç»“æœï¼ŒåŸå§‹æ¨¡å‹çš„å¹³å‡æ¨ç†æ—¶é—´ä¸º666.6msï¼ŒweightedF1å€¼ä¸º0.9717ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹ç»“è®ºï¼š</p><ul><li><p>ONNXæ¨¡å‹ä¸å½±å“æ¨ç†æ•ˆæœï¼Œä½†åœ¨å¹³å‡æ¨ç†æ—¶é—´ä¸Šæé€Ÿçº¦1.33å€</p></li><li><p>ä¼˜åŒ–ONNXæ¨¡å‹ä¸å½±å“æ¨ç†æ•ˆæœï¼Œä½†åœ¨å¹³å‡æ¨ç†æ—¶é—´ä¸Šæé€Ÿçº¦1.38å€</p></li><li><p>é‡åŒ–åçš„ONNXæ¨¡å‹å½±å“æ¨ç†æ•ˆæœï¼Œä¸€èˆ¬ä¼šç•¥æœ‰ä¸‹é™ï¼Œæœ¬æ¬¡å®éªŒç»“æœä¸ºæå‡ï¼Œä½†åœ¨å¹³å‡æ¨ç†æ—¶é—´ä¸Šæé€Ÿçº¦1.84å€ï¼Œç”±äºPyTorchçš„PTDQï¼ˆæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼‰</p></li><li><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨HuggingFaceçš„<code>Optimum</code>ï¼Œæ¥å¯¹å¾®è°ƒåçš„BERTæ¨¡å‹è¿›è¡Œé‡åŒ–ï¼ˆQuantizationï¼‰ï¼Œåœ¨<code>optimum.onnxruntime</code>æ¨¡å—ä¸­ï¼Œå¹³å‡æ¨ç†æ—¶é—´æé€Ÿçº¦1.8å€ã€‚</p><p>æœ¬æ–‡å·²å¼€æºè‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/dynamic_quantization_on_bert">https://github.com/percent4/dynamic_quantization_on_bert</a>ã€‚</p><p>æœ¬æ–‡å·²å¼€é€šä¸ªäººåšå®¢ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®ï¼š<ahref="https://percent4.github.io/">https://percent4.github.io/</a>ã€‚</p><p>æ¬¢è¿ä½ å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œæ¯å‘¨æˆ‘éƒ½ä¼šåœ¨è¿™é‡Œæ›´æ–°æ–‡ç« ã€‚</p></li></ul><figure><img src="/img/weixin_gzh.png" alt="ä¸ªäººå¾®ä¿¡å…¬ä¼—å·" /><figcaption aria-hidden="true">ä¸ªäººå¾®ä¿¡å…¬ä¼—å·</figcaption></figure><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>NLPï¼ˆå…­åå…­ï¼‰ä½¿ç”¨HuggingFaceä¸­çš„Trainerè¿›è¡ŒBERTæ¨¡å‹å¾®è°ƒï¼š<ahref="https://percent4.github.io/2023/09/02/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8HuggingFace%E4%B8%AD%E7%9A%84Trainer%E8%BF%9B%E8%A1%8CBERT%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">https://percent4.github.io/2023/09/02/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8HuggingFace%E4%B8%AD%E7%9A%84Trainer%E8%BF%9B%E8%A1%8CBERT%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</a></li><li>NLPï¼ˆå…­åä¸ƒï¼‰BERTæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPTDQï¼‰ï¼š<ahref="https://percent4.github.io/2023/09/03/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%83%EF%BC%89BERT%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%90%8E%E5%8A%A8%E6%80%81%E9%87%8F%E5%8C%96%EF%BC%88PTDQ%EF%BC%89/">https://percent4.github.io/2023/09/03/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%83%EF%BC%89BERT%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%90%8E%E5%8A%A8%E6%80%81%E9%87%8F%E5%8C%96%EF%BC%88PTDQ%EF%BC%89/</a></li><li>Optimum: <ahref="https://huggingface.co/docs/optimum/index">https://huggingface.co/docs/optimum/index</a></li><li>Optimizing Transformers with Hugging Face Optimum: <ahref="https://www.philschmid.de/optimizing-transformers-with-optimum">https://www.philschmid.de/optimizing-transformers-with-optimum</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>BERT</tag>
      
      <tag>æ¨¡å‹é‡åŒ–</tag>
      
      <tag>Optimum</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åä¸ƒï¼‰BERTæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPTDQï¼‰</title>
    <link href="/2023/09/03/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%83%EF%BC%89BERT%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%90%8E%E5%8A%A8%E6%80%81%E9%87%8F%E5%8C%96%EF%BC%88PTDQ%EF%BC%89/"/>
    <url>/2023/09/03/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%83%EF%BC%89BERT%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%90%8E%E5%8A%A8%E6%80%81%E9%87%8F%E5%8C%96%EF%BC%88PTDQ%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»BERTæ¨¡å‹è®­ç»ƒååŠ¨æ€é‡åŒ–ï¼ˆPost Training DynamicQuantizationï¼ŒPTDQï¼‰ã€‚</p><h3 id="é‡åŒ–">é‡åŒ–</h3><p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œé‡åŒ–ï¼ˆQuantizationï¼‰æŒ‡çš„æ˜¯ä½¿ç”¨æ›´å°‘çš„bitæ¥å­˜å‚¨åŸæœ¬ä»¥æµ®ç‚¹æ•°å­˜å‚¨çš„tensorï¼Œä»¥åŠä½¿ç”¨æ›´å°‘çš„bitæ¥å®ŒæˆåŸæœ¬ä»¥æµ®ç‚¹æ•°å®Œæˆçš„è®¡ç®—ã€‚è¿™ä¹ˆåšçš„å¥½å¤„ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p>æ›´å°‘çš„æ¨¡å‹ä½“ç§¯ï¼Œæ¥è¿‘4å€çš„å‡å°‘</p></li><li><p>å¯ä»¥æ›´å¿«åœ°è®¡ç®—ï¼Œç”±äºæ›´å°‘çš„å†…å­˜è®¿é—®å’Œæ›´å¿«çš„int8è®¡ç®—ï¼Œå¯ä»¥å¿«2~4å€</p><p>PyTorchä¸­çš„æ¨¡å‹å‚æ•°é»˜è®¤ä»¥FP32ç²¾åº¦å‚¨å­˜ã€‚å¯¹äºé‡åŒ–åçš„æ¨¡å‹ï¼Œå…¶éƒ¨åˆ†æˆ–è€…å…¨éƒ¨çš„tensoræ“ä½œä¼šä½¿ç”¨intç±»å‹æ¥è®¡ç®—ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é‡åŒ–ä¹‹å‰çš„floatç±»å‹ã€‚å½“ç„¶ï¼Œé‡åŒ–è¿˜éœ€è¦åº•å±‚ç¡¬ä»¶æ”¯æŒï¼Œx86CPU(æ”¯æŒAVX2)ã€ARM CPUã€Google TPUã€Nvidia Volta/Turing/Ampereã€QualcommDSPè¿™äº›ä¸»æµç¡¬ä»¶éƒ½å¯¹é‡åŒ–æä¾›äº†æ”¯æŒã€‚</p></li></ul><figure><img src="/img/nlp67_1.png" alt="æ¨¡å‹é‡åŒ–ç¤ºä¾‹å›¾ç‰‡" /><figcaption aria-hidden="true">æ¨¡å‹é‡åŒ–ç¤ºä¾‹å›¾ç‰‡</figcaption></figure><h3 id="ptdq">PTDQ</h3><p>PyTorchå¯¹é‡åŒ–çš„æ”¯æŒç›®å‰æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>Post Training Dynamic Quantizationï¼šæ¨¡å‹è®­ç»ƒå®Œæ¯•åçš„åŠ¨æ€é‡åŒ–</li><li>Post Training Static Quantizationï¼šæ¨¡å‹è®­ç»ƒå®Œæ¯•åçš„é™æ€é‡åŒ–</li><li>QAT (Quantization Aware Training)ï¼šæ¨¡å‹è®­ç»ƒä¸­å¼€å¯é‡åŒ–</li></ul><p><code>æœ¬æ–‡ä»…ä»‹ç»Post Training Dynamic Quantizationï¼ˆPTDQï¼‰</code>ã€‚</p><p>å¯¹è®­ç»ƒåçš„æ¨¡å‹æƒé‡æ‰§è¡ŒåŠ¨æ€é‡åŒ–ï¼Œå°†æµ®ç‚¹æ¨¡å‹è½¬æ¢ä¸ºåŠ¨æ€é‡åŒ–æ¨¡å‹ï¼Œ<code>ä»…å¯¹æ¨¡å‹æƒé‡è¿›è¡Œé‡åŒ–ï¼Œåç½®ä¸ä¼šé‡åŒ–</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…å¯¹Linearå’ŒRNNå˜ä½“é‡åŒ–(å› ä¸ºè¿™äº›layerçš„å‚æ•°é‡å¾ˆå¤§ï¼Œæ”¶ç›Šæ›´é«˜)ã€‚ ã€€ã€€ &gt;torch.quantization.quantize_dynamic(model, qconfig_spec=None,dtype=torch.qint8, mapping=None, inplace=False)</p><p>å‚æ•°è§£é‡Šï¼š</p><ul><li>modelï¼šæ¨¡å‹ï¼ˆé»˜è®¤ä¸ºFP32ï¼‰</li><li>qconfig_specï¼š</li></ul><ol type="1"><li>é›†åˆï¼šæ¯”å¦‚ï¼š qconfig_spec={nn.LSTM, nn.Linear}ã€‚åˆ—å‡ºè¦é‡åŒ–çš„ç¥ç»ç½‘ç»œæ¨¡å—ã€‚</li><li>å­—å…¸ï¼š qconfig_spec = {nn.Linear: default_dynamic_qconfig, nn.LSTM:default_dynamic_qconfig}</li></ol><ul><li>dtypeï¼š float16 æˆ– qint8</li><li>mappingï¼šå°±åœ°æ‰§è¡Œæ¨¡å‹è½¬æ¢ï¼ŒåŸå§‹æ¨¡å—å‘ç”Ÿå˜å¼‚</li><li>inplaceï¼šå°†å­æ¨¡å—çš„ç±»å‹æ˜ å°„åˆ°éœ€è¦æ›¿æ¢å­æ¨¡å—çš„ç›¸åº”åŠ¨æ€é‡åŒ–ç‰ˆæœ¬çš„ç±»å‹</li></ul><p>ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># åŠ¨æ€é‡åŒ–æ¨¡å‹ï¼Œåªé‡åŒ–æƒé‡</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoModel</span>(torch.nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(DemoModel, self).__init__()<br>        self.conv = nn.Conv2d(in_channels=<span class="hljs-number">1</span>, out_channels=<span class="hljs-number">1</span>, kernel_size=<span class="hljs-number">1</span>)<br>        self.relu = nn.ReLU()<br>        self.fc = torch.nn.Linear(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.conv(x)<br>        x = self.relu(x)<br>        x = self.fc(x)<br>        <span class="hljs-keyword">return</span> x<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    model_fp32 = DemoModel()<br>    <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªé‡åŒ–çš„æ¨¡å‹å®ä¾‹</span><br>    model_int8 = torch.quantization.quantize_dynamic(model=model_fp32,  <span class="hljs-comment"># åŸå§‹æ¨¡å‹</span><br>                                                     qconfig_spec=&#123;torch.nn.Linear&#125;,  <span class="hljs-comment"># è¦åŠ¨æ€é‡åŒ–çš„ç®—å­</span><br>                                                     dtype=torch.qint8)  <span class="hljs-comment"># å°†æƒé‡é‡åŒ–ä¸ºï¼šqint8</span><br><br>    <span class="hljs-built_in">print</span>(model_fp32)<br>    <span class="hljs-built_in">print</span>(model_int8)<br><br>    <span class="hljs-comment"># è¿è¡Œæ¨¡å‹</span><br>    input_fp32 = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>    output_fp32 = model_fp32(input_fp32)<br>    <span class="hljs-built_in">print</span>(output_fp32)<br><br>    output_int8 = model_int8(input_fp32)<br>    <span class="hljs-built_in">print</span>(output_int8)<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">DemoModel(<br>  (conv): Conv2d(1, 1, kernel_size=(1, 1), stride=(1, 1))<br>  (relu): ReLU()<br>  (<span class="hljs-built_in">fc</span>): Linear(in_features=2, out_features=2, bias=True)<br>)<br>DemoModel(<br>  (conv): Conv2d(1, 1, kernel_size=(1, 1), stride=(1, 1))<br>  (relu): ReLU()<br>  (<span class="hljs-built_in">fc</span>): DynamicQuantizedLinear(in_features=2, out_features=2, dtype=torch.qint8, qscheme=torch.per_tensor_affine)<br>)<br>tensor([[[[0.3120, 0.3042],<br>          [0.3120, 0.3042]]]], grad_fn=&lt;AddBackward0&gt;)<br>tensor([[[[0.3120, 0.3042],<br>          [0.3120, 0.3042]]]])<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹é‡åŒ–ç­–ç•¥">æ¨¡å‹é‡åŒ–ç­–ç•¥</h3><p>å½“å‰ï¼Œç”±äºé‡åŒ–ç®—å­çš„è¦†ç›–æœ‰é™ï¼Œå› æ­¤ï¼Œå¯¹äºä¸åŒçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå…¶é‡åŒ–ç­–ç•¥ä¸åŒï¼Œè§ä¸‹è¡¨ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹</th><th>é‡åŒ–ç­–ç•¥</th><th>åŸå› </th></tr></thead><tbody><tr class="odd"><td>LSTM/RNN</td><td>Dynamic Quantization</td><td>æ¨¡å‹ååé‡ç”±æƒé‡çš„è®¡ç®—/å†…å­˜å¸¦å®½å†³å®š</td></tr><tr class="even"><td>BERT/Transformer</td><td>Dynamic Quantization</td><td>æ¨¡å‹ååé‡ç”±æƒé‡çš„è®¡ç®—/å†…å­˜å¸¦å®½å†³å®š</td></tr><tr class="odd"><td>CNN</td><td>Static Quantization</td><td>æ¨¡å‹ååé‡ç”±æ¿€æ´»å‡½æ•°çš„å†…å­˜å¸¦å®½å†³å®š</td></tr><tr class="even"><td>CNN</td><td>Quantization Aware Training</td><td>æ¨¡å‹å‡†ç¡®ç‡ä¸èƒ½ç”±Static Quantizationè·å–çš„æƒ…å†µ</td></tr></tbody></table><p>ä¸‹é¢å¯¹BERTæ¨¡å‹è¿›è¡Œè®­ç»ƒååŠ¨æ€é‡åŒ–ï¼Œåˆ†ææ¨¡å‹åœ¨é‡åŒ–å‰åï¼Œæ¨ç†æ•ˆæœå’Œæ¨ç†æ€§èƒ½çš„å˜åŒ–ã€‚</p><h3 id="å®éªŒ">å®éªŒ</h3><p>æˆ‘ä»¬ä½¿ç”¨çš„è®­ç»ƒåçš„æ¨¡å‹ä¸ºä¸­æ–‡æ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œå…¶è®­ç»ƒè¿‡ç¨‹å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<ahref="https://blog.csdn.net/jclian91/article/details/132642662">NLPï¼ˆå…­åå…­ï¼‰ä½¿ç”¨HuggingFaceä¸­çš„Trainerè¿›è¡ŒBERTæ¨¡å‹å¾®è°ƒ</a>ã€‚</p><p>è®­ç»ƒåçš„BERTæ¨¡å‹åŠ¨æ€é‡åŒ–å®éªŒçš„è®¾ç½®å¦‚ä¸‹ï¼š</p><ol type="1"><li><p>base model: <ahref="https://huggingface.co/bert-base-chinese">bert-base-chinese</a></p></li><li><p>CPU info: x86-64, Intel(R) Core(TM) i5-10210U CPU @1.60GHz</p></li><li><p>batch size: 1</p></li><li><p>thread: 1</p><p><strong>å…·ä½“çš„å®éªŒè¿‡ç¨‹å¦‚ä¸‹</strong>ï¼š</p></li></ol><ul><li>åŠ è½½æ¨¡å‹åŠtokenizer</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSequenceClassification<br><br>MAX_LENGTH = <span class="hljs-number">128</span><br>device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)<br>checkpoint = <span class="hljs-string">f&quot;./sougou_test_trainer_<span class="hljs-subst">&#123;MAX_LENGTH&#125;</span>/checkpoint-96&quot;</span><br>model = AutoModelForSequenceClassification.from_pretrained(checkpoint).to(device)<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, DataCollatorWithPadding<br><br>tokenizer = AutoTokenizer.from_pretrained(checkpoint)<br></code></pre></td></tr></table></figure><ul><li>æµ‹è¯•æ•°æ®é›†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br>test_df = pd.read_csv(<span class="hljs-string">&quot;./data/sougou/test.csv&quot;</span>)<br><br>test_df.head()<br></code></pre></td></tr></table></figure><div><style scoped>    .dataframe tbody tr th:only-of-type {        vertical-align: middle;    }    .dataframe tbody tr th {        vertical-align: top;    }    .dataframe thead th {        text-align: right;    }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th></th><th>text</th><th>label</th></tr></thead><tbody><tr><th>0</th><td>å±Šæ•°æ¯”èµ›æ—¶é—´æ¯”èµ›åœ°ç‚¹å‚åŠ å›½å®¶å’Œåœ°åŒºå† å†›äºšå†›å†³èµ›æˆç»©ç¬¬ä¸€å±Š1956-1957è‹±å›½11ç¾å›½ä¸¹éº¦6...</td><td>0</td></tr><tr><th>1</th><td>å•†å“å±æ€§æè´¨è½¯æ©¡èƒ¶å¸¦åŠ æµ®é›•å·¥è‰º+åˆé‡‘å½©è‰²é˜Ÿå¾½åŠç‰Œè§„æ ¼162mmæ•°é‡è¿™ä¸€ç³»åˆ—äº§å“ä¸é™é‡å‘è¡Œå›¾æ¡ˆ...</td><td>0</td></tr><tr><th>2</th><td>ä»Šå¤©ä¸‹åˆï¼Œæ²ˆé˜³é‡‘å¾·å’Œé•¿æ˜¥äºšæ³°é˜Ÿå°†åœ¨äº”é‡Œæ²³ç›¸é‡ã€‚åœ¨è¿™ä¸¤æ”¯çƒé˜Ÿä¸­æ²ˆé˜³ç±çƒå‘˜å±…å¤šï¼Œå› æ­¤è¿™åœºæ¯”èµ›å®é™…...</td><td>0</td></tr><tr><th>3</th><td>æœ¬æŠ¥è®¯ä¸­å›½è¶³åå‡†å¤‡å¥½äº†ä¸ç‰¹é²è¥¿åŸƒè°ˆåˆ¤çš„åˆåŒæ–‡æœ¬ï¼Œä¹Ÿåœ¨åŒ—äº¬ç»™ä»–é¢„è®¢å¥½äº†æˆ¿é—´ï¼Œä½†ç‰¹é²è¥¿åŸƒçˆ½çº¦äº†ï¼...</td><td>0</td></tr><tr><th>4</th><td>ç½‘å‹ç‚¹å‡»å‘è¡¨è¯„è®ºç¥è´ºä¸­å›½é˜Ÿå¤ºå¾—äº”è¿å† æœç‹ä½“è‚²è®¯åŒ—äº¬æ—¶é—´5æœˆ6æ—¥ï¼Œ2006å¹´å°¤ä¼¯æ¯ç¾½æ¯›çƒèµ›åœ¨æ—¥...</td><td>0</td></tr></tbody></table></div><ul><li>é‡åŒ–å‰æ¨¡å‹çš„æ¨ç†æ—¶é—´åŠè¯„ä¼°æŒ‡æ ‡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> time<br><br>s_time = time.time()<br>true_labels, pred_labels = [], [] <br><span class="hljs-keyword">for</span> i, row <span class="hljs-keyword">in</span> test_df.iterrows():<br>    row_s_time = time.time()<br>    true_labels.append(row[<span class="hljs-string">&quot;label&quot;</span>])<br>    encoded_text = tokenizer(row[<span class="hljs-string">&#x27;text&#x27;</span>], max_length=MAX_LENGTH, truncation=<span class="hljs-literal">True</span>, padding=<span class="hljs-literal">True</span>, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>).to(device)<br>    <span class="hljs-comment"># print(encoded_text)</span><br>    logits = model(**encoded_text)<br>    label_id = np.argmax(logits[<span class="hljs-number">0</span>].detach().cpu().numpy(), axis=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br>    pred_labels.append(label_id)<br>    <span class="hljs-built_in">print</span>(i, (time.time() - row_s_time)*<span class="hljs-number">1000</span>, label_id)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;avg time: &quot;</span>, (time.time() - s_time) * <span class="hljs-number">1000</span> / test_df.shape[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><pre><code class="hljs">0 229.3872833251953 0100 362.0314598083496 1200 311.16747856140137 2300 324.13792610168457 3400 406.9099426269531 4avg time:  352.44047810332944</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report<br><br><span class="hljs-built_in">print</span>(classification_report(true_labels, pred_labels, digits=<span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure><pre><code class="hljs">              precision    recall  f1-score   support           0     0.9900    1.0000    0.9950        99           1     0.9691    0.9495    0.9592        99           2     0.9900    1.0000    0.9950        99           3     0.9320    0.9697    0.9505        99           4     0.9895    0.9495    0.9691        99    accuracy                         0.9737       495   macro avg     0.9741    0.9737    0.9737       495weighted avg     0.9741    0.9737    0.9737       495</code></pre><ul><li>è®¾ç½®é‡åŒ–åç«¯</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ¨¡å‹é‡åŒ–</span><br>cpu_device = torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.backends.quantized.supported_engines<br></code></pre></td></tr></table></figure><pre><code class="hljs">[&#39;none&#39;, &#39;onednn&#39;, &#39;x86&#39;, &#39;fbgemm&#39;]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.backends.quantized.engine = <span class="hljs-string">&#x27;x86&#x27;</span><br></code></pre></td></tr></table></figure><ul><li>é‡åŒ–åæ¨¡å‹çš„æ¨ç†æ—¶é—´åŠè¯„ä¼°æŒ‡æ ‡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 8-bit é‡åŒ–</span><br>quantized_model = torch.quantization.quantize_dynamic(<br>    model, &#123;torch.nn.Linear&#125;, dtype=torch.qint8<br>).to(cpu_device)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">q_s_time = time.time()<br>q_true_labels, q_pred_labels = [], [] <br><br><span class="hljs-keyword">for</span> i, row <span class="hljs-keyword">in</span> test_df.iterrows():<br>    row_s_time = time.time()<br>    q_true_labels.append(row[<span class="hljs-string">&quot;label&quot;</span>])<br>    encoded_text = tokenizer(row[<span class="hljs-string">&#x27;text&#x27;</span>], max_length=MAX_LENGTH, truncation=<span class="hljs-literal">True</span>, padding=<span class="hljs-literal">True</span>, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>).to(cpu_device)<br>    logits = quantized_model(**encoded_text)<br>    label_id = np.argmax(logits[<span class="hljs-number">0</span>].detach().numpy(), axis=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br>    q_pred_labels.append(label_id)<br>    <span class="hljs-built_in">print</span>(i, (time.time() - row_s_time) * <span class="hljs-number">1000</span>, label_id)<br>    <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;avg time: &quot;</span>, (time.time() - q_s_time) * <span class="hljs-number">1000</span> / test_df.shape[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><pre><code class="hljs">0 195.47462463378906 0100 247.33805656433105 1200 219.41304206848145 2300 206.44831657409668 3400 187.4992847442627 4avg time:  217.63229466447928</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report<br><br><span class="hljs-built_in">print</span>(classification_report(q_true_labels, q_pred_labels, digits=<span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure><pre><code class="hljs">              precision    recall  f1-score   support           0     0.9900    1.0000    0.9950        99           1     0.9688    0.9394    0.9538        99           2     0.9900    1.0000    0.9950        99           3     0.9320    0.9697    0.9505        99           4     0.9896    0.9596    0.9744        99    accuracy                         0.9737       495   macro avg     0.9741    0.9737    0.9737       495weighted avg     0.9741    0.9737    0.9737       495</code></pre><ul><li>é‡åŒ–å‰åæ¨¡å‹å¤§å°å¯¹æ¯”</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_size_of_model</span>(<span class="hljs-params">model</span>):<br>    torch.save(model.state_dict(), <span class="hljs-string">&quot;temp.p&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Size (MB): &quot;</span>, os.path.getsize(<span class="hljs-string">&quot;temp.p&quot;</span>)/<span class="hljs-number">1e6</span>)<br>    os.remove(<span class="hljs-string">&quot;temp.p&quot;</span>)<br><br>print_size_of_model(model)<br>print_size_of_model(quantized_model)<br></code></pre></td></tr></table></figure><pre><code class="hljs">Size (MB):  409.155273Size (MB):  152.627621</code></pre><p>é‡åŒ–åç«¯ï¼ˆQuantizationbackendï¼‰å–å†³äºCPUæ¶æ„ï¼Œä¸åŒè®¡ç®—æœºçš„CPUæ¶æ„ä¸åŒï¼Œå› æ­¤ï¼Œé»˜è®¤çš„åŠ¨æ€é‡åŒ–ä¸ä¸€å®šåœ¨æ‰€æœ‰çš„CPUä¸Šéƒ½èƒ½ç”Ÿæ•ˆï¼Œéœ€æ ¹æ®è‡ªå·±è®¡ç®—æœºçš„CPUæ¶æ„è®¾ç½®å¥½å¯¹åº”çš„é‡åŒ–åç«¯ã€‚å¦å¤–ï¼Œä¸åŒçš„é‡åŒ–åç«¯ä¹Ÿæœ‰äº›è®¸å·®å¼‚ã€‚LinuxæœåŠ¡å™¨ä½¿ç”¨<code>uname -a</code>å¯æŸ¥çœ‹CPUä¿¡æ¯ã€‚</p><p>é‡å¤ä¸Šè¿°å®éªŒè¿‡ç¨‹ï¼Œä»¥æ¨¡å‹çš„æœ€å¤§è¾“å…¥é•¿åº¦ä¸ºå˜é‡ï¼Œå–å€¼ä¸º128,256,384ï¼Œæ¯ç§æƒ…å†µå„åš3æ¬¡å®éªŒï¼Œç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>å®éªŒ</th><th>æœ€å¤§é•¿åº¦</th><th>é‡åŒ–å‰å¹³å‡æ¨ç†æ—¶é—´(ms)</th><th>é‡åŒ–å‰weighted F1å€¼</th><th>é‡åŒ–å‰å¹³å‡æ¨ç†æ—¶é—´(ms)</th><th>é‡åŒ–å‰weighted F1å€¼</th></tr></thead><tbody><tr class="odd"><td>å®éªŒ1</td><td>384</td><td>1066</td><td>0.9797</td><td>686</td><td>0.9838</td></tr><tr class="even"><td>å®éªŒ2</td><td>384</td><td>1047.6</td><td>0.9899</td><td>738.1</td><td>0.9879</td></tr><tr class="odd"><td>å®éªŒ3</td><td>384</td><td>1020.9</td><td>0.9817</td><td>714.0</td><td>0.9838</td></tr><tr class="even"><td>å®éªŒ1</td><td>256</td><td>668.7</td><td>0.9717</td><td>431.4</td><td>0.9718</td></tr><tr class="odd"><td>å®éªŒ2</td><td>256</td><td>675.1</td><td>0.9717</td><td>449.9</td><td>0.9718</td></tr><tr class="even"><td>å®éªŒ3</td><td>256</td><td>656.0</td><td>0.9717</td><td>446.5</td><td>0.9718</td></tr><tr class="odd"><td>å®éªŒ1</td><td>128</td><td>335.8</td><td>0.9737</td><td>200.5</td><td>0.9737</td></tr><tr class="even"><td>å®éªŒ2</td><td>128</td><td>336.5</td><td>0.9737</td><td>227.2</td><td>0.9737</td></tr><tr class="odd"><td>å®éªŒ3</td><td>128</td><td>352.4</td><td>0.9737</td><td>217.6</td><td>0.9737</td></tr></tbody></table><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¯¹äºè®­ç»ƒåçš„BERTæ¨¡å‹ï¼ˆæ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼‰è¿›è¡ŒåŠ¨æ€é‡åŒ–ï¼Œå…¶ç»“è®ºå¦‚ä¸‹ï¼š</p><ul><li>æ¨¡å‹æ¨ç†æ•ˆæœï¼šé‡åŒ–å‰ååŸºæœ¬ç›¸åŒï¼Œé‡åŒ–åç•¥æœ‰ä¸‹é™</li><li>æ¨¡å‹æ¨ç†æ—¶é—´ï¼šé‡åŒ–åå¹³å‡æé€Ÿçº¦1.52å€</li></ul><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†é‡åŒ–åŸºæœ¬æ¦‚å¿µï¼ŒPyTorchæ¨¡å‹é‡åŒ–æ–¹å¼ï¼Œä»¥åŠå¯¹BERTæ¨¡å‹è®­ç»ƒåè¿›è¡ŒåŠ¨æ€é‡åŒ–ååœ¨æ¨ç†æ•ˆæœå’Œæ¨ç†æ€§èƒ½ä¸Šçš„å®éªŒã€‚</p><p>æœ¬æ–‡é¡¹ç›®å·²å¼€æºè‡³Githubé¡¹ç›®ï¼š<ahref="https://github.com/percent4/dynamic_quantization_on_bert">https://github.com/percent4/dynamic_quantization_on_bert</a>ã€‚</p><p>æœ¬äººå·²å¼€é€šä¸ªäººåšå®¢ç½‘ç«™ï¼Œç½‘å€ä¸ºï¼š<ahref="https://percent4.github.io/">https://percent4.github.io/</a>ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¨¡å‹é‡åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åå…­ï¼‰ä½¿ç”¨HuggingFaceä¸­çš„Trainerè¿›è¡ŒBERTæ¨¡å‹å¾®è°ƒ</title>
    <link href="/2023/09/02/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8HuggingFace%E4%B8%AD%E7%9A%84Trainer%E8%BF%9B%E8%A1%8CBERT%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/"/>
    <url>/2023/09/02/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8HuggingFace%E4%B8%AD%E7%9A%84Trainer%E8%BF%9B%E8%A1%8CBERT%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä»¥å¾€ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨HuggingFaceåœ¨è®­ç»ƒBERTæ¨¡å‹æ—¶ï¼Œä»£ç å†™å¾—æ¯”è¾ƒå¤æ‚ï¼Œæ¶‰åŠåˆ°æ•°æ®å¤„ç†ã€tokenç¼–ç ã€æ¨¡å‹ç¼–ç ã€æ¨¡å‹è®­ç»ƒç­‰æ­¥éª¤ï¼Œä»äº‹NLPé¢†åŸŸçš„äººéƒ½æœ‰è¿™ç§åˆ‡èº«æ„Ÿå—ã€‚äº‹å®ä¸Šï¼ŒHugggingFaceä¸­æä¾›äº†<code>datasets</code>æ¨¡å—ï¼ˆæ•°æ®å¤„ç†ï¼‰å’ŒTrainerå‡½æ•°ï¼Œä½¿å¾—æˆ‘ä»¬çš„æ¨¡å‹è®­ç»ƒè¾ƒä¸ºæ–¹ä¾¿ã€‚å…³äº<code>datasets</code>æ¨¡å—ï¼Œå¯å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/24/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%BA%8C%EF%BC%89HuggingFace%E4%B8%AD%E7%9A%84Datasets%E4%BD%BF%E7%94%A8/">NLPï¼ˆå…­åäºŒï¼‰HuggingFaceä¸­çš„Datasetsä½¿ç”¨</a>ã€‚</p><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨HuggingFaceä¸­çš„Trainerå¯¹BERTæ¨¡å‹å¾®è°ƒã€‚</p><h3 id="trainer">Trainer</h3><p>Traineræ˜¯HuggingFaceä¸­çš„æ¨¡å‹è®­ç»ƒå‡½æ•°ï¼Œå…¶ç½‘å€ä¸ºï¼š<ahref="https://huggingface.co/docs/transformers/main_classes/trainer">https://huggingface.co/docs/transformers/main_classes/trainer</a>ã€‚</p><p>Trainerçš„ä¼ å…¥å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">model: typing.<span class="hljs-type">Union</span>[transformers.modeling_utils.PreTrainedModel, torch.nn.modules.module.Module] = <span class="hljs-literal">None</span><br>args: TrainingArguments = <span class="hljs-literal">None</span><br>data_collator: typing.<span class="hljs-type">Optional</span>[DataCollator] = <span class="hljs-literal">None</span><br>train_dataset: typing.<span class="hljs-type">Optional</span>[torch.utils.data.dataset.Dataset] = <span class="hljs-literal">None</span><br>eval_dataset: typing.<span class="hljs-type">Union</span>[torch.utils.data.dataset.Dataset, typing.<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, torch.utils.data.dataset.Dataset], NoneType] = <span class="hljs-literal">None</span><br>tokenizer: typing.<span class="hljs-type">Optional</span>[transformers.tokenization_utils_base.PreTrainedTokenizerBase] = <span class="hljs-literal">None</span><br>model_init: typing.<span class="hljs-type">Union</span>[typing.<span class="hljs-type">Callable</span>[[], transformers.modeling_utils.PreTrainedModel], NoneType] = <span class="hljs-literal">None</span><br>compute_metrics: typing.<span class="hljs-type">Union</span>[typing.<span class="hljs-type">Callable</span>[[transformers.trainer_utils.EvalPrediction], typing.<span class="hljs-type">Dict</span>], NoneType] = <span class="hljs-literal">None</span><br>callbacks: typing.<span class="hljs-type">Optional</span>[typing.<span class="hljs-type">List</span>[transformers.trainer_callback.TrainerCallback]] = <span class="hljs-literal">None</span><br>optimizers: typing.<span class="hljs-type">Tuple</span>[torch.optim.optimizer.Optimizer, torch.optim.lr_scheduler.LambdaLR] = (<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>)<br>preprocess_logits_for_metrics: typing.<span class="hljs-type">Union</span>[typing.<span class="hljs-type">Callable</span>[[torch.Tensor, torch.Tensor], torch.Tensor], NoneType] = <span class="hljs-literal">None</span> )<br></code></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><p><code>model</code>ä¸ºé¢„è®­ç»ƒæ¨¡å‹</p></li><li><p><code>args</code>ä¸ºTrainingArgumentsï¼ˆè®­ç»ƒå‚æ•°ï¼‰ç±»</p></li><li><p><code>data_collator</code>ä¼šå°†æ•°æ®é›†ä¸­çš„å…ƒç´ ç»„æˆä¸€ä¸ªbatchï¼Œé»˜è®¤ä½¿ç”¨default_data_collator()ï¼Œå¦‚æœtokenizeræ²¡æœ‰æä¾›ï¼Œåˆ™ä½¿ç”¨<code>DataCollatorWithPadding</code></p></li><li><p><code>train_dataset</code>,<code>eval_dataset</code>ä¸ºè®­ç»ƒé›†ï¼ŒéªŒè¯é›†</p></li><li><p><code>tokenizer</code>ä¸ºæ¨¡å‹è®­ç»ƒä½¿ç”¨çš„tokenizer</p></li><li><p><code>model_init</code>ä¸ºæ¨¡å‹åˆå§‹åŒ–</p></li><li><p><code>compute_metrics</code>ä¸ºéªŒè¯é›†çš„è¯„ä¼°æŒ‡æ ‡è®¡ç®—å‡½æ•°</p></li><li><p><code>callbacks</code>ä¸ºè®­ç»ƒè¿‡ç¨‹ä¸­çš„callbackåˆ—è¡¨</p></li><li><p><code>optimizers</code>ä¸ºæ¨¡å‹è®­ç»ƒä¸­çš„ä¼˜åŒ–å™¨</p></li><li><p><code>preprocess_logits_for_metrics</code>ä¸ºæ¨¡å‹è¯„ä¼°é˜¶æ®µå‰å¯¹logitsçš„é¢„å¤„ç†</p><p>TrainingArgumentsä¸ºè®­ç»ƒå‚æ•°ç±»ï¼Œå…¶ç½‘å€ä¸ºï¼š<ahref="https://huggingface.co/docs/transformers/main_classes/trainer#transformers.TrainingArguments">https://huggingface.co/docs/transformers/main_classes/trainer#transformers.TrainingArguments</a>ï¼Œä¼ å…¥å‚æ•°éå¸¸å¤šï¼ˆtransformersç‰ˆæœ¬4.32.1ä¸­æœ‰98ä¸ªå‚æ•°ï¼ï¼‰ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåªä»‹ç»å‡ ä¸ªå¸¸è§çš„ï¼š</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">output_dir: stroverwrite_output_dir: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span><br>evaluation_strategy: typing.<span class="hljs-type">Union</span>[transformers.trainer_utils.IntervalStrategy, <span class="hljs-built_in">str</span>] = <span class="hljs-string">&#x27;no&#x27;</span><br>per_gpu_train_batch_size: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span><br>per_gpu_eval_batch_size: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span><br>learning_rate: <span class="hljs-built_in">float</span> = <span class="hljs-number">5e-05</span><br>num_train_epochs: <span class="hljs-built_in">float</span> = <span class="hljs-number">3.0</span><br>logging_dir: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span><br>logging_strategy: typing.<span class="hljs-type">Union</span>[transformers.trainer_utils.IntervalStrategy, <span class="hljs-built_in">str</span>] = <span class="hljs-string">&#x27;steps&#x27;</span><br>save_strategy: typing.<span class="hljs-type">Union</span>[transformers.trainer_utils.IntervalStrategy, <span class="hljs-built_in">str</span>] = <span class="hljs-string">&#x27;steps&#x27;</span>save_steps: <span class="hljs-built_in">float</span> = <span class="hljs-number">500</span><br>report_to: typing.<span class="hljs-type">Optional</span>[typing.<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]] = <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>output_dir</code>ä¸ºæ¨¡å‹è¾“å‡ºç›®å½•</li><li><code>evaluation_strategy</code>ä¸ºæ¨¡å‹è¯„ä¼°ç­–ç•¥</li></ul><ol type="1"><li>â€œno": ä¸åšæ¨¡å‹è¯„ä¼°</li><li>"steps": æŒ‰è®­ç»ƒæ­¥æ•°ï¼ˆstepsï¼‰è¿›è¡Œè¯„ä¼°ï¼Œéœ€æŒ‡å®šæ­¥æ•°</li><li>"epoch": æ¯ä¸ªepochè®­ç»ƒå®Œåè¿›è¡Œè¯„ä¼°</li></ol><ul><li><p><code>per_gpu_train_batch_size</code>,<code>per_gpu_eval_batch_size</code>ä¸ºæ¯ä¸ªGPUä¸Šè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„batchsizeï¼Œä¹Ÿæœ‰CPUä¸Šçš„å¯¹åº”å‚æ•°</p></li><li><p><code>learning_rate</code>ä¸ºå­¦ä¹ ç‡</p></li><li><p><code>logging_dir</code>ä¸ºæ—¥å¿—è¾“å‡ºç›®å½•</p></li><li><p><code>logging_strategy</code>ä¸ºæ—¥å¿—è¾“å‡ºç­–ç•¥ï¼ŒåŒæ ·æœ‰no, steps,epochä¸‰ç§ï¼Œæ„ä¹‰åŒä¸Š</p></li><li><p><code>save_strategy</code>ä¸ºæ¨¡å‹ä¿å­˜ç­–ç•¥ï¼ŒåŒæ ·æœ‰no, steps,epochä¸‰ç§ï¼Œæ„ä¹‰åŒä¸Š</p></li><li><p><code>report_to</code>ä¸ºæ¨¡å‹è®­ç»ƒã€è¯„ä¼°ä¸­çš„é‡è¦æŒ‡æ ‡ï¼ˆå¦‚loss,accuraceï¼‰è¾“å‡ºä¹‹å¤„ï¼Œå¯é€‰æ‹©azure_ml, clearml, codecarbon, comet_ml,dagshub, flyte, mlflow, neptune, tensorboard,wandbï¼Œä½¿ç”¨allä¼šè¾“å‡ºåˆ°æ‰€æœ‰çš„åœ°æ–¹ï¼Œä½¿ç”¨noåˆ™ä¸ä¼šè¾“å‡ºã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨Trainerè¿›è¡ŒBERTæ¨¡å‹å¾®è°ƒï¼Œç»™å‡ºè‹±è¯­ã€ä¸­æ–‡æ•°æ®é›†ä¸Šæ–‡æœ¬åˆ†ç±»çš„ç¤ºä¾‹ä»£ç ã€‚</p></li><li><h3 id="bertå¾®è°ƒ">BERTå¾®è°ƒ</h3><p>ä½¿ç”¨<code>datasets</code>æ¨¡å—å¯¼å…¥imdbæ•°æ®é›†ï¼ˆè‹±è¯­å½±è¯„æ•°æ®é›†ï¼Œå¸¸ç”¨äºæ–‡æœ¬åˆ†ç±»ï¼‰ï¼ŒåŠ è½½é¢„è®­ç»ƒæ¨¡å‹<code>bert-base-cased</code>çš„tokenizerã€‚</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, DataCollatorWithPadding<br><span class="hljs-keyword">import</span> datasets<br><br>checkpoint = <span class="hljs-string">&#x27;bert-base-cased&#x27;</span><br>tokenizer = AutoTokenizer.from_pretrained(checkpoint)<br>raw_datasets = datasets.load_dataset(<span class="hljs-string">&#x27;imdb&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ•°æ®é›†ï¼Œæœ‰trainï¼ˆè®­ç»ƒé›†ï¼‰ã€testï¼ˆæµ‹è¯•é›†ï¼‰ã€unsupervisedï¼ˆéç›‘ç£ï¼‰ä¸‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå„è‡ªæœ‰25000ä¸ªæ ·æœ¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">raw_datasets<br></code></pre></td></tr></table></figure><pre><code class="hljs">DatasetDict(&#123;    train: Dataset(&#123;        features: [&#39;text&#39;, &#39;label&#39;],        num_rows: 25000    &#125;)    test: Dataset(&#123;        features: [&#39;text&#39;, &#39;label&#39;],        num_rows: 25000    &#125;)    unsupervised: Dataset(&#123;        features: [&#39;text&#39;, &#39;label&#39;],        num_rows: 50000    &#125;)&#125;)</code></pre><p>åˆ›å»ºæ•°æ®tokenizeå‡½æ•°ï¼Œå¯¹æ–‡æœ¬è¿›è¡Œtokenizeï¼Œæœ€å¤§é•¿åº¦è®¾ç½®ä¸º300ï¼ŒåŒæ—¶ä½¿ç”¨data_collectorä¸ºDataCollatorWithPaddingã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize_function</span>(<span class="hljs-params">sample</span>):<br>    <span class="hljs-keyword">return</span> tokenizer(sample[<span class="hljs-string">&#x27;text&#x27;</span>], max_length=<span class="hljs-number">300</span>, truncation=<span class="hljs-literal">True</span>)<br>tokenized_datasets = raw_datasets.<span class="hljs-built_in">map</span>(tokenize_function, batched=<span class="hljs-literal">True</span>)<br><br>data_collator = DataCollatorWithPadding(tokenizer=tokenizer)<br></code></pre></td></tr></table></figure><p>åŠ è½½åˆ†ç±»æ¨¡å‹ï¼Œè¾“å‡ºç±»åˆ«ä¸º2.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSequenceClassification<br>model = AutoModelForSequenceClassification.from_pretrained(checkpoint, num_labels=<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>è®¾ç½®compute_metricså‡½æ•°ï¼Œåœ¨è¯„ä¼°è¿‡ç¨‹ä¸­è¾“å‡ºaccuracy, f1, precision,recallå››ä¸ªæŒ‡æ ‡ã€‚è®¾ç½®è®­ç»ƒå‚æ•°TrainingArgumentsç±»ï¼Œè®¾ç½®Trainerã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Trainer, TrainingArguments<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score, precision_recall_fscore_support<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_metrics</span>(<span class="hljs-params">pred</span>):<br>    labels = pred.label_ids<br>    preds = pred.predictions.argmax(-<span class="hljs-number">1</span>)<br>    precision, recall, f1, _ = precision_recall_fscore_support(labels, preds, average=<span class="hljs-string">&#x27;weighted&#x27;</span>)<br>    acc = accuracy_score(labels, preds)<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&#x27;accuracy&#x27;</span>: acc,<br>        <span class="hljs-string">&#x27;f1&#x27;</span>: f1,<br>        <span class="hljs-string">&#x27;precision&#x27;</span>: precision,<br>        <span class="hljs-string">&#x27;recall&#x27;</span>: recall<br>    &#125;<br><br>training_args = TrainingArguments(output_dir=<span class="hljs-string">&#x27;imdb_test_trainer&#x27;</span>, <span class="hljs-comment"># æŒ‡å®šè¾“å‡ºæ–‡ä»¶å¤¹ï¼Œæ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»º</span><br>                                 evaluation_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>                                 per_device_train_batch_size=<span class="hljs-number">32</span>,<br>                                 per_device_eval_batch_size=<span class="hljs-number">32</span>,<br>                                 learning_rate=<span class="hljs-number">5e-5</span>,<br>                                 num_train_epochs=<span class="hljs-number">3</span>,<br>                                 warmup_ratio=<span class="hljs-number">0.2</span>,<br>                                 logging_dir=<span class="hljs-string">&#x27;./imdb_train_logs&#x27;</span>,<br>                                 logging_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>                                 save_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,<br>                                 report_to=<span class="hljs-string">&quot;tensorboard&quot;</span>) <br><br>trainer = Trainer(<br>    model,<br>    training_args,<br>    train_dataset=tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>],<br>    eval_dataset=tokenized_datasets[<span class="hljs-string">&quot;test&quot;</span>],<br>    data_collator=data_collator,  <span class="hljs-comment"># åœ¨å®šä¹‰äº†tokenizerä¹‹åï¼Œå…¶å®è¿™é‡Œçš„data_collatorå°±ä¸ç”¨å†å†™äº†ï¼Œä¼šè‡ªåŠ¨æ ¹æ®tokenizeråˆ›å»º</span><br>    tokenizer=tokenizer,<br>    compute_metrics=compute_metrics<br>)<br></code></pre></td></tr></table></figure></p><p>å¼€å¯æ¨¡å‹è®­ç»ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">trainer.train()<br></code></pre></td></tr></table></figure><table border="1" class="dataframe"><thead><tr style="text-align: left;"><th>Epoch</th><th>Training Loss</th><th>Validation Loss</th><th>Accuracy</th><th>F1</th><th>Precision</th><th>Recall</th></tr></thead><tbody><tr><td>1</td><td>0.364300</td><td>0.223223</td><td>0.910600</td><td>0.910509</td><td>0.912276</td><td>0.910600</td></tr><tr><td>2</td><td>0.164800</td><td>0.204420</td><td>0.923960</td><td>0.923941</td><td>0.924375</td><td>0.923960</td></tr><tr><td>3</td><td>0.071000</td><td>0.241350</td><td>0.925520</td><td>0.925510</td><td>0.925759</td><td>0.925520</td></tr></tbody></table><p>ä»¥ä¸Šä¸ºè‹±è¯­æ•°æ®é›†çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹å¾®è°ƒã€‚</p><p>ä¸­æ–‡æ•°æ®é›†ä½¿ç”¨sougou-miniæ•°æ®é›†ï¼ˆè®­ç»ƒé›†4000ä¸ªæ ·æœ¬ï¼Œæµ‹è¯•é›†495ä¸ªæ ·æœ¬ï¼Œå…±5ä¸ªè¾“å‡ºç±»åˆ«ï¼‰ï¼Œé¢„è®­ç»ƒæ¨¡å‹é‡‡ç”¨bert-base-chineseã€‚ä»£ç åŸºæœ¬ä¸è‹±è¯­æ•°æ®é›†å·®ä¸å¤šï¼Œåªè¦ä¿®æ”¹é¢„è®­ç»ƒæ¨¡å‹ï¼Œæ•°æ®é›†åŠ è½½ å’Œæœ€å¤§é•¿åº¦ä¸º128ï¼Œè¾“å‡ºç±»åˆ«ã€‚ä»¥ä¸‹æ˜¯ä¸åŒçš„ä»£ç ä¹‹å¤„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, DataCollatorWithPadding<br><span class="hljs-keyword">import</span> datasets<br><br>checkpoint = <span class="hljs-string">&#x27;bert-base-chinese&#x27;</span><br>tokenizer = AutoTokenizer.from_pretrained(checkpoint)<br><br>data_files = &#123;<span class="hljs-string">&quot;train&quot;</span>: <span class="hljs-string">&quot;./data/sougou/train.csv&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;./data/sougou/test.csv&quot;</span>&#125;<br>raw_datasets = datasets.load_dataset(<span class="hljs-string">&quot;csv&quot;</span>, data_files=data_files, delimiter=<span class="hljs-string">&quot;,&quot;</span>)<br>...<br>model = AutoModelForSequenceClassification.from_pretrained(checkpoint, num_labels=<span class="hljs-number">5</span>)<br>...<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><table border="1" class="dataframe"><thead><tr><th>Epoch</th><th>Training Loss</th><th>Validation Loss</th><th>Accuracy</th><th>F1</th><th>Precision</th><th>Recall</th></tr></thead><tbody><tr><td>1</td><td>0.849200</td><td>0.115189</td><td>0.969697</td><td>0.969449</td><td>0.970073</td><td>0.969697</td></tr><tr><td>2</td><td>0.106900</td><td>0.093987</td><td>0.973737</td><td>0.973770</td><td>0.975372</td><td>0.973737</td></tr><tr><td>3</td><td>0.047800</td><td>0.078861</td><td>0.973737</td><td>0.973740</td><td>0.974117</td><td>0.973737</td></tr></tbody></table><h3 id="æ¨¡å‹è¯„ä¼°">æ¨¡å‹è¯„ä¼°</h3><p>åœ¨ä¸Šè¿°æ¨¡å‹è¯„ä¼°è¿‡ç¨‹ä¸­ï¼Œå·²ç»æœ‰äº†æ¨¡å‹è¯„ä¼°çš„å„é¡¹æŒ‡æ ‡ã€‚</p><p>æœ¬æ–‡ä¹Ÿç»™å‡ºå•ç‹¬åšæ¨¡å‹è¯„ä¼°çš„ä»£ç ï¼Œæ–¹ä¾¿åç»­å¯¹æ¨¡å‹åšé‡åŒ–æ—¶ï¼ˆåç»­ä»‹ç»BERTæ¨¡å‹çš„åŠ¨æ€é‡åŒ–ï¼‰è·å–é‡åŒ–å‰åæ¨¡å‹æ¨ç†çš„å„é¡¹æŒ‡æ ‡ã€‚</p><p>ä¸­æ–‡æ•°æ®é›†æ–‡æœ¬åˆ†ç±»æ¨¡å‹è¯„ä¼°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSequenceClassification<br><br>MAX_LENGTH = <span class="hljs-number">128</span><br>device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)<br>checkpoint = <span class="hljs-string">f&quot;./sougou_test_trainer_<span class="hljs-subst">&#123;MAX_LENGTH&#125;</span>/checkpoint-96&quot;</span><br>model = AutoModelForSequenceClassification.from_pretrained(checkpoint).to(device)<br><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, DataCollatorWithPadding<br><br>tokenizer = AutoTokenizer.from_pretrained(checkpoint)<br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br>test_df = pd.read_csv(<span class="hljs-string">&quot;./data/sougou/test.csv&quot;</span>)<br>test_df.head()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><div><style scoped>    .dataframe tbody tr th:only-of-type {        vertical-align: middle;    }    .dataframe tbody tr th {        vertical-align: top;    }    .dataframe thead th {        text-align: right;    }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th></th><th>text</th><th>label</th></tr></thead><tbody><tr><th>0</th><td>å±Šæ•°æ¯”èµ›æ—¶é—´æ¯”èµ›åœ°ç‚¹å‚åŠ å›½å®¶å’Œåœ°åŒºå† å†›äºšå†›å†³èµ›æˆç»©ç¬¬ä¸€å±Š1956-1957è‹±å›½11ç¾å›½ä¸¹éº¦6...</td><td>0</td></tr><tr><th>1</th><td>å•†å“å±æ€§æè´¨è½¯æ©¡èƒ¶å¸¦åŠ æµ®é›•å·¥è‰º+åˆé‡‘å½©è‰²é˜Ÿå¾½åŠç‰Œè§„æ ¼162mmæ•°é‡è¿™ä¸€ç³»åˆ—äº§å“ä¸é™é‡å‘è¡Œå›¾æ¡ˆ...</td><td>0</td></tr><tr><th>2</th><td>ä»Šå¤©ä¸‹åˆï¼Œæ²ˆé˜³é‡‘å¾·å’Œé•¿æ˜¥äºšæ³°é˜Ÿå°†åœ¨äº”é‡Œæ²³ç›¸é‡ã€‚åœ¨è¿™ä¸¤æ”¯çƒé˜Ÿä¸­æ²ˆé˜³ç±çƒå‘˜å±…å¤šï¼Œå› æ­¤è¿™åœºæ¯”èµ›å®é™…...</td><td>0</td></tr><tr><th>3</th><td>æœ¬æŠ¥è®¯ä¸­å›½è¶³åå‡†å¤‡å¥½äº†ä¸ç‰¹é²è¥¿åŸƒè°ˆåˆ¤çš„åˆåŒæ–‡æœ¬ï¼Œä¹Ÿåœ¨åŒ—äº¬ç»™ä»–é¢„è®¢å¥½äº†æˆ¿é—´ï¼Œä½†ç‰¹é²è¥¿åŸƒçˆ½çº¦äº†ï¼...</td><td>0</td></tr><tr><th>4</th><td>ç½‘å‹ç‚¹å‡»å‘è¡¨è¯„è®ºç¥è´ºä¸­å›½é˜Ÿå¤ºå¾—äº”è¿å† æœç‹ä½“è‚²è®¯åŒ—äº¬æ—¶é—´5æœˆ6æ—¥ï¼Œ2006å¹´å°¤ä¼¯æ¯ç¾½æ¯›çƒèµ›åœ¨æ—¥...</td><td>0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> time<br><br>s_time = time.time()<br>true_labels, pred_labels = [], [] <br><span class="hljs-keyword">for</span> i, row <span class="hljs-keyword">in</span> test_df.iterrows():<br>    row_s_time = time.time()<br>    true_labels.append(row[<span class="hljs-string">&quot;label&quot;</span>])<br>    encoded_text = tokenizer(row[<span class="hljs-string">&#x27;text&#x27;</span>], max_length=MAX_LENGTH, truncation=<span class="hljs-literal">True</span>, padding=<span class="hljs-literal">True</span>, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>).to(device)<br>    <span class="hljs-comment"># print(encoded_text)</span><br>    logits = model(**encoded_text)<br>    label_id = np.argmax(logits[<span class="hljs-number">0</span>].detach().cpu().numpy(), axis=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br>    pred_labels.append(label_id)<br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:<br>    <span class="hljs-built_in">print</span>(i, (time.time() - row_s_time)*<span class="hljs-number">1000</span>, label_id)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;avg time: &quot;</span>, (time.time() - s_time) * <span class="hljs-number">1000</span> / test_df.shape[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><blockquote><p>0 229.3872833251953 0 100 362.0314598083496 1 200 311.167478561401372 300 324.13792610168457 3 400 406.9099426269531 4 avg time:352.44047810332944</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">true_labels[:<span class="hljs-number">10</span>]<br></code></pre></td></tr></table></figure><blockquote><p>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pred_labels[:<span class="hljs-number">10</span>]<br></code></pre></td></tr></table></figure><blockquote><p>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report<br><br><span class="hljs-built_in">print</span>(classification_report(true_labels, pred_labels, digits=<span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache">              <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>           <span class="hljs-attribute">0</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9900</span>    <span class="hljs-number">1</span>.<span class="hljs-number">0000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9950</span>        <span class="hljs-number">99</span><br>           <span class="hljs-attribute">1</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9691</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9495</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9592</span>        <span class="hljs-number">99</span><br>           <span class="hljs-attribute">2</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9900</span>    <span class="hljs-number">1</span>.<span class="hljs-number">0000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9950</span>        <span class="hljs-number">99</span><br>           <span class="hljs-attribute">3</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9320</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9697</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9505</span>        <span class="hljs-number">99</span><br>           <span class="hljs-attribute">4</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9895</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9495</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9691</span>        <span class="hljs-number">99</span><br><br>    <span class="hljs-attribute">accuracy</span>                         <span class="hljs-number">0</span>.<span class="hljs-number">9737</span>       <span class="hljs-number">495</span><br>   <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9741</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9737</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9737</span>       <span class="hljs-number">495</span><br><span class="hljs-attribute">weighted</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9741</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9737</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9737</span>       <span class="hljs-number">495</span><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨HuggingFaceä¸­çš„Trainerå¯¹BERTæ¨¡å‹å¾®è°ƒã€‚å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨Trainerè¿›è¡Œæ¨¡å‹å¾®è°ƒï¼Œä»£ç è¾ƒä¸ºç®€æ´ï¼Œä¸”æ”¯æŒåŠŸèƒ½ä¸°å¯Œï¼Œæ˜¯ç†æƒ³çš„æ¨¡å‹è®­ç»ƒæ–¹å¼ã€‚</p><p>æœ¬æ–‡é¡¹ç›®ä»£ç å·²å¼€æºè‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/PyTorch_Learning/tree/master/huggingface_learning">https://github.com/percent4/PyTorch_Learning/tree/master/huggingface_learning</a>ã€‚</p><p>æœ¬äººå·²å¼€é€šä¸ªäººåšå®¢ç½‘ç«™ï¼Œç½‘å€ä¸ºï¼š<ahref="https://percent4.github.io/">https://percent4.github.io/</a>ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>BERT</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
      <tag>HuggingFace</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradioå…¥é—¨ï¼ˆ1ï¼‰è¾“å…¥è¾“å‡ºã€è¡¨æ ¼ã€æ–‡æœ¬é«˜äº®</title>
    <link href="/2023/08/30/Gradio%E5%85%A5%E9%97%A8%EF%BC%881%EF%BC%89%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E3%80%81%E8%A1%A8%E6%A0%BC%E3%80%81%E6%96%87%E6%9C%AC%E9%AB%98%E4%BA%AE/"/>
    <url>/2023/08/30/Gradio%E5%85%A5%E9%97%A8%EF%BC%881%EF%BC%89%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E3%80%81%E8%A1%A8%E6%A0%BC%E3%80%81%E6%96%87%E6%9C%AC%E9%AB%98%E4%BA%AE/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»gradioçš„å…¥é—¨ä½¿ç”¨ï¼Œå¹¶ç»“åˆå¤§æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œç»™å‡ºä¸‰ä¸ªä½¿ç”¨ä¾‹å­ã€‚</p><p><code>Gradio</code> æ˜¯é€šè¿‡å‹å¥½çš„ Web ç•Œé¢æ¼”ç¤ºæœºå™¨å­¦ä¹ æ¨¡å‹çš„æœ€å¿«æ–¹å¼ï¼Œä»¥ä¾¿ä»»ä½•äººéƒ½å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚å…¶å®˜ç½‘ç½‘å€ä¸ºï¼š<a href="https://www.gradio.app/">https://www.gradio.app/</a> ï¼ŒGithubç½‘å€ä¸ºï¼š<a href="https://github.com/gradio-app/gradio">https://github.com/gradio-app/gradio</a> ã€‚</p><h3 id="è¾“å…¥ä¸è¾“å‡º">è¾“å…¥ä¸è¾“å‡º</h3><p>ä¸€ä¸ªç®€å•çš„Webé¡µé¢çš„è¾“å…¥ã€è¾“å‡ºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello &quot;</span> + name + <span class="hljs-string">&quot;!&quot;</span><br><br><br>demo = gr.Interface(<br>    fn=greet,<br>    <span class="hljs-comment"># è‡ªå®šä¹‰è¾“å…¥æ¡†</span><br>    inputs=gr.Textbox(lines=<span class="hljs-number">3</span>, placeholder=<span class="hljs-string">&quot;Name Here...&quot;</span>, label=<span class="hljs-string">&quot;my input&quot;</span>),<br>    outputs=<span class="hljs-string">&quot;text&quot;</span>,<br>)<br><br>demo.launch()<br></code></pre></td></tr></table></figure><p>é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="/img/gradio1_1.png" alt="ç®€å•çš„è¾“å…¥ã€è¾“å‡º"></p><p>æˆ‘ä»¬ä½¿ç”¨<code>openai</code>çš„<code>gpt-3.5-turbo</code>æ¨¡å‹è¿›è¡Œé—®ç­”ï¼Œç»“åˆGradioï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr<br><span class="hljs-keyword">import</span> openai<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">model_completion</span>(<span class="hljs-params">prompt</span>):<br>    openai.api_type = <span class="hljs-string">&quot;open_ai&quot;</span><br>    openai.api_base = <span class="hljs-string">&quot;https://api.openai.com/v1&quot;</span><br>    openai.api_version = <span class="hljs-literal">None</span><br>    openai.api_key = <span class="hljs-string">&quot;sk-xxx&quot;</span><br><br>    response = openai.ChatCompletion.create(<br>        model=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>,<br>        messages=[<br>            &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;You are a helpful assistant.&quot;</span>&#125;,<br>            &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: prompt&#125;<br>        ],<br>        max_tokens=<span class="hljs-number">100</span><br>    )<br><br>    <span class="hljs-keyword">return</span> response[<span class="hljs-string">&#x27;choices&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;message&#x27;</span>][<span class="hljs-string">&#x27;content&#x27;</span>]<br><br><br>demo = gr.Interface(<br>    fn=model_completion,<br>    inputs=gr.Textbox(lines=<span class="hljs-number">3</span>, placeholder=<span class="hljs-string">&quot;your question here...&quot;</span>, label=<span class="hljs-string">&quot;Question&quot;</span>),<br>    outputs=<span class="hljs-string">&quot;text&quot;</span>,<br>)<br><br>demo.launch()<br></code></pre></td></tr></table></figure><p>é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="/img/gradio1_2.png" alt="å¤§æ¨¡å‹é—®ç­”é¡µé¢"></p><h3 id="è¡¨æ ¼å±•ç¤º">è¡¨æ ¼å±•ç¤º</h3><p>ä¸€ä¸ªç®€å•çš„è¡¨æ ¼å±•ç¤ºçš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_list</span>(<span class="hljs-params">input_str</span>):<br>    <span class="hljs-keyword">return</span> [_.split(<span class="hljs-string">&#x27;,&#x27;</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> input_str.split(<span class="hljs-string">&#x27;\n&#x27;</span>)]<br><br><br>demo = gr.Interface(<br>    fn=make_list,<br>    <span class="hljs-comment"># è‡ªå®šä¹‰è¾“å…¥æ¡†</span><br>    inputs=gr.Textbox(lines=<span class="hljs-number">3</span>, placeholder=<span class="hljs-string">&quot;String Here...&quot;</span>, label=<span class="hljs-string">&quot;input&quot;</span>),<br>    <span class="hljs-comment"># è®¾ç½®è¾“å‡ºç»„ä»¶</span><br>    outputs=gr.DataFrame(label=<span class="hljs-string">&#x27;Table&#x27;</span>,<br>                         interactive=<span class="hljs-literal">True</span>,<br>                         wrap=<span class="hljs-literal">True</span>)<br>)<br><br>demo.launch()<br></code></pre></td></tr></table></figure><p>é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="/img/gradio1_3.png" alt="ç®€å•çš„è¡¨æ ¼åº”ç”¨"></p><p>æˆ‘ä»¬ä½¿ç”¨<code>openai</code>ä¸­çš„<code>gpt-3.5-turbo</code>æ¨¡å‹è¿›è¡Œæ–‡æœ¬åˆ†ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr<br><span class="hljs-keyword">import</span> openai<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>(<span class="hljs-params">input_str</span>):<br>    openai.api_type = <span class="hljs-string">&quot;open_ai&quot;</span><br>    openai.api_base = <span class="hljs-string">&quot;https://api.openai.com/v1&quot;</span><br>    openai.api_version = <span class="hljs-literal">None</span><br>    openai.api_key = <span class="hljs-string">&quot;sk-xxx&quot;</span><br><br>    output_list = []<br>    <span class="hljs-keyword">for</span> prompt <span class="hljs-keyword">in</span> input_str.split(<span class="hljs-string">&#x27;\n&#x27;</span>):<br>        response = openai.ChatCompletion.create(<br>            model=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>,<br>            messages=[<br>                &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Classify the text into Positive, Negative, Neural.&quot;</span>&#125;,<br>                &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: prompt&#125;<br>            ],<br>            max_tokens=<span class="hljs-number">5</span><br>        )<br>        output = response[<span class="hljs-string">&#x27;choices&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;message&#x27;</span>][<span class="hljs-string">&#x27;content&#x27;</span>]<br>        output_list.append([prompt, output])<br><br>    <span class="hljs-keyword">return</span> output_list<br><br><br>demo = gr.Interface(<br>    fn=predict,<br>    <span class="hljs-comment"># è‡ªå®šä¹‰è¾“å…¥æ¡†</span><br>    inputs=gr.Textbox(lines=<span class="hljs-number">3</span>, placeholder=<span class="hljs-string">&quot;Documents...&quot;</span>, label=<span class="hljs-string">&quot;Documents&quot;</span>),<br>    <span class="hljs-comment"># è®¾ç½®è¾“å‡ºç»„ä»¶</span><br>    outputs=gr.DataFrame(label=<span class="hljs-string">&#x27;Predict Result&#x27;</span>,<br>                         headers=[<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;class&quot;</span>],<br>                         datatype=[<span class="hljs-string">&quot;str&quot;</span>, <span class="hljs-string">&quot;str&quot;</span>],<br>                         interactive=<span class="hljs-literal">True</span>,<br>                         wrap=<span class="hljs-literal">True</span>)<br>)<br><br>demo.launch()<br></code></pre></td></tr></table></figure><p>é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="/img/gradio1_4.png" alt="åœ¨Gradioä¸­å®ç°æ–‡æœ¬åˆ†ç±»"></p><h3 id="æ–‡æœ¬é«˜äº®">æ–‡æœ¬é«˜äº®</h3><p><code>Gradio</code>ç»™å‡ºäº†åŸºäºæ–‡æœ¬æ¯”å¯¹çš„æ–‡æœ¬é«˜äº®çš„ä¾‹å­ï¼Œæ–‡æœ¬æ¯”å¯¹ä½¿ç”¨difflibæ¨¡å—ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr<br><span class="hljs-keyword">from</span> difflib <span class="hljs-keyword">import</span> Differ<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">diff_texts</span>(<span class="hljs-params">text1, text2</span>):<br>    d = Differ()<br>    output = [(token[<span class="hljs-number">2</span>:], token[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> token[<span class="hljs-number">0</span>] != <span class="hljs-string">&quot; &quot;</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> d.compare(text1, text2)]<br>    <span class="hljs-keyword">return</span> output<br><br><br>demo = gr.Interface(<br>    fn=diff_texts,<br>    inputs=[<br>            gr.Textbox(<br>                label=<span class="hljs-string">&quot;Text 1&quot;</span>,<br>                info=<span class="hljs-string">&quot;Initial text&quot;</span>,<br>                lines=<span class="hljs-number">3</span>,<br>                value=<span class="hljs-string">&quot;The quick brown fox jumped over the lazy dogs.&quot;</span>,<br>            ),<br>            gr.Textbox(<br>                label=<span class="hljs-string">&quot;Text 2&quot;</span>,<br>                info=<span class="hljs-string">&quot;Text to compare&quot;</span>,<br>                lines=<span class="hljs-number">3</span>,<br>                value=<span class="hljs-string">&quot;The fast brown fox jumps over lazy dogs.&quot;</span>,<br>            ),<br>           ],<br>    outputs=gr.HighlightedText(label=<span class="hljs-string">&quot;Diff&quot;</span>,<br>                               combine_adjacent=<span class="hljs-literal">True</span>,<br>                               show_legend=<span class="hljs-literal">True</span><br>                               ).style(color_map=&#123;<span class="hljs-string">&quot;+&quot;</span>: <span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>: <span class="hljs-string">&quot;green&quot;</span>&#125;),<br>    theme=gr.themes.Base()<br>)<br><br><br>demo.launch()<br></code></pre></td></tr></table></figure><p>é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="/img/gradio1_5.png" alt="ç®€å•çš„æ–‡æœ¬é«˜äº®ä¾‹å­"></p><p>æˆ‘ä»¬ä½¿ç”¨æ–‡æœ¬é«˜äº®æ¥æ˜¾ç¤ºæ–‡æœ¬çº é”™ç»“æœï¼Œæ–‡æœ¬çº é”™å·¥å…·æˆ‘ä»¬ä½¿ç”¨<code>pycorrector</code>æ¨¡å—ï¼Œå…¶Githubç½‘å€ä¸ºï¼š<a href="https://github.com/shibing624/pycorrector">https://github.com/shibing624/pycorrector</a> ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr<br><span class="hljs-keyword">import</span> pycorrector<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">corrector</span>(<span class="hljs-params">text</span>):<br>    corrected_text, detail = pycorrector.correct(text)<br>    index_list = []<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> detail:<br>        index_list.extend(<span class="hljs-built_in">range</span>(_[<span class="hljs-number">2</span>], _[<span class="hljs-number">3</span>]))<br>    output = [(char, <span class="hljs-string">&#x27;+&#x27;</span> <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> index_list <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>)<span class="hljs-keyword">for</span> i, char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(corrected_text)]<br>    <span class="hljs-keyword">return</span> output<br><br><br>demo = gr.Interface(<br>    fn=corrector,<br>    inputs=gr.Textbox(lines=<span class="hljs-number">3</span>, placeholder=<span class="hljs-string">&quot;Text...&quot;</span>, label=<span class="hljs-string">&quot;Text&quot;</span>),<br>    outputs=gr.HighlightedText(label=<span class="hljs-string">&quot;Diff&quot;</span>,<br>                               combine_adjacent=<span class="hljs-literal">True</span>,<br>                               show_legend=<span class="hljs-literal">True</span><br>                               ).style(color_map=&#123;<span class="hljs-string">&quot;+&quot;</span>: <span class="hljs-string">&quot;yellow&quot;</span>&#125;),<br>    theme=gr.themes.Base()<br>)<br><br><br>demo.launch()<br></code></pre></td></tr></table></figure><p>é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="/img/gradio1_6.png" alt="ä½¿ç”¨æ–‡æœ¬é«˜äº®æ¥å±•ç¤ºæ–‡æœ¬æ¥é”™ç»“æœ"></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†æœºå™¨å­¦ä¹ é¢†åŸŸä¸­ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å‰ç«¯å±•ç¤ºå·¥å…·Gradioï¼Œåˆ†åˆ«å°±è¾“å…¥å’Œè¾“å‡ºã€è¡¨æ ¼ã€æ–‡æœ¬é«˜äº®ä¸‰ä¸ªåŠŸèƒ½ä¸Šç»™å‡ºäº†ç®€å•ç¤ºä¾‹å’Œå¤§æ¨¡å‹æ–¹é¢çš„åº”ç”¨ã€‚</p><p>æœ¬äººä¸ªäººåšå®¢ç½‘ç«™ä¸º <a href="https://percent4.github.io/">https://percent4.github.io/</a> ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®~</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Gradio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ‹è¯•å·¥å…·coverageçš„é«˜é˜¶ä½¿ç”¨</title>
    <link href="/2023/08/19/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7coverage%E7%9A%84%E9%AB%98%E9%98%B6%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/08/19/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7coverage%E7%9A%84%E9%AB%98%E9%98%B6%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <a href="https://blog.csdn.net/jclian91/article/details/123833933">Pythonä¹‹å•å…ƒæµ‹è¯•ä½¿ç”¨çš„ä¸€ç‚¹å¿ƒå¾—</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†è‡ªå·±åœ¨ä½¿ç”¨Pythonæµ‹è¯•å·¥å…·<code>coverge</code>çš„ä¸€ç‚¹å¿ƒå¾—ï¼ŒåŒ…æ‹¬ï¼š</p><ol><li>ä½¿ç”¨coverageæ¨¡å—è®¡ç®—ä»£ç æµ‹è¯•è¦†ç›–ç‡</li><li>ä½¿ç”¨coverage apiè®¡ç®—ä»£ç æµ‹è¯•è¦†ç›–ç‡</li><li>coverageé…ç½®æ–‡ä»¶çš„ä½¿ç”¨</li><li>coverage badgeçš„ç”Ÿæˆ</li></ol><p>æœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå°†ä¼šä»‹ç»coverageçš„é«˜é˜¶ä½¿ç”¨ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><p>Flask APIæµ‹è¯•</p></li><li><p>coverageå¤šæ–‡ä»¶æµ‹è¯•</p></li><li><p>coverageçš„Gitlab CI/CDé›†æˆ</p></li><li><p>coverage badgeç”Ÿæˆ</p><p>æœ¬æ–‡ä¸­ä½¿ç”¨coverageçš„ç‰ˆæœ¬å‡ä¸º7.3.0ã€‚</p></li><li></li></ul><h3 id="Flask-APIæµ‹è¯•">Flask APIæµ‹è¯•</h3><p>åœ¨unittestæµ‹è¯•æ¡†æ¶å¦‚æœå¯¹Flask APIè¿›è¡Œæµ‹è¯•æ—¶ä½¿ç”¨HTTPè¯·æ±‚ï¼Œé‚£ä¹ˆå°†æ— æ³•å¾—åˆ°ä»£ç è¦†ç›–ç‡ã€‚</p><p>æˆ‘ä»¬æœ‰å¦‚ä¸‹çš„ç¤ºä¾‹FlaskæœåŠ¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello index&quot;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/test&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello test&quot;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>æ­£ç¡®çš„æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> unittest<br><br><span class="hljs-keyword">from</span> flask_app <span class="hljs-keyword">import</span> app<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppTestCase</span>(unittest.TestCase):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):<br>        self.ctx = app.app_context()<br>        self.ctx.push()<br>        self.client = app.test_client()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tearDown</span>(<span class="hljs-params">self</span>):<br>        self.ctx.pop()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case1</span>(<span class="hljs-params">self</span>):<br>        response = self.client.get(<span class="hljs-string">&quot;/&quot;</span>)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br>        self.assertEqual(response.text, <span class="hljs-string">&quot;Hello index&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case2</span>(<span class="hljs-params">self</span>):<br>        response = self.client.get(<span class="hljs-string">&quot;/test&quot;</span>)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br>        self.assertEqual(response.text, <span class="hljs-string">&quot;Hello test&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    suite = unittest.TestSuite()<br>    suite.addTest(AppTestCase(<span class="hljs-string">&#x27;test_case1&#x27;</span>))<br>    suite.addTest(AppTestCase(<span class="hljs-string">&#x27;test_case2&#x27;</span>))<br>    run = unittest.TextTestRunner()<br>    run.run(suite)<br></code></pre></td></tr></table></figure><h3 id="coverageå¤šæ–‡ä»¶æµ‹è¯•">coverageå¤šæ–‡ä»¶æµ‹è¯•</h3><p>æˆ‘ä»¬æœ‰å¦‚ä¸‹çš„å®ç°ä¸¤ä¸ªå˜é‡ç›¸åŠ çš„ä»£ç ï¼ˆ<code>func_add.py</code>ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(a, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">isinstance</span>(b, <span class="hljs-built_in">str</span>):<br>        <span class="hljs-keyword">return</span> a + <span class="hljs-string">&#x27;+&#x27;</span> + b<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(a, <span class="hljs-built_in">list</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">isinstance</span>(b, <span class="hljs-built_in">list</span>):<br>        <span class="hljs-keyword">return</span> a + b<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(a, (<span class="hljs-built_in">int</span>, <span class="hljs-built_in">float</span>)) <span class="hljs-keyword">and</span> <span class="hljs-built_in">isinstance</span>(b, (<span class="hljs-built_in">int</span>, <span class="hljs-built_in">float</span>)):<br>        <span class="hljs-keyword">return</span> a + b<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªæµ‹è¯•æ–‡ä»¶<code>test_func_add1.py</code>å’Œ<code>test_func_add2.py</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> unittest<br><br><span class="hljs-keyword">from</span> func_add <span class="hljs-keyword">import</span> add<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestAdd</span>(unittest.TestCase):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add_case1</span>(<span class="hljs-params">self</span>):<br>        a = <span class="hljs-string">&quot;Hello&quot;</span><br>        b = <span class="hljs-string">&quot;World&quot;</span><br>        res = add(a, b)<br>        <span class="hljs-built_in">print</span>(res)<br>        self.assertEqual(res, <span class="hljs-string">&quot;Hello+World&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add_case2</span>(<span class="hljs-params">self</span>):<br>        a = <span class="hljs-number">1</span><br>        b = <span class="hljs-number">2</span><br>        res = add(a, b)<br>        <span class="hljs-built_in">print</span>(res)<br>        self.assertEqual(res, <span class="hljs-number">3</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-comment"># éƒ¨åˆ†ç”¨ä¾‹æµ‹è¯•</span><br>    <span class="hljs-comment"># æ„é€ ä¸€ä¸ªå®¹å™¨ç”¨æ¥å­˜æ”¾æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹</span><br>    suite = unittest.TestSuite()<br>    <span class="hljs-comment"># æ·»åŠ ç±»ä¸­çš„æµ‹è¯•ç”¨ä¾‹</span><br>    suite.addTest(TestAdd(<span class="hljs-string">&#x27;test_add_case1&#x27;</span>))<br>    suite.addTest(TestAdd(<span class="hljs-string">&#x27;test_add_case2&#x27;</span>))<br>    run = unittest.TextTestRunner()<br>    run.run(suite)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> unittest<br><br><span class="hljs-keyword">from</span> func_add <span class="hljs-keyword">import</span> add<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestAdd</span>(unittest.TestCase):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add_case3</span>(<span class="hljs-params">self</span>):<br>        a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]<br>        b = [<span class="hljs-number">3</span>]<br>        res = add(a, b)<br>        <span class="hljs-built_in">print</span>(res)<br>        self.assertEqual(res, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add_case4</span>(<span class="hljs-params">self</span>):<br>        a = <span class="hljs-number">2</span><br>        b = <span class="hljs-string">&quot;3&quot;</span><br>        res = add(a, b)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-literal">None</span>)<br>        self.assertEqual(res, <span class="hljs-literal">None</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-comment"># éƒ¨åˆ†ç”¨ä¾‹æµ‹è¯•</span><br>    <span class="hljs-comment"># æ„é€ ä¸€ä¸ªå®¹å™¨ç”¨æ¥å­˜æ”¾æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹</span><br>    suite = unittest.TestSuite()<br>    <span class="hljs-comment"># æ·»åŠ ç±»ä¸­çš„æµ‹è¯•ç”¨ä¾‹</span><br>    suite.addTest(TestAdd(<span class="hljs-string">&#x27;test_add_case3&#x27;</span>))<br>    suite.addTest(TestAdd(<span class="hljs-string">&#x27;test_add_case4&#x27;</span>))<br>    run = unittest.TextTestRunner()<br>    run.run(suite)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">coverage run test_func_add1.py<br>coverage run test_func_add2.py<br>coverage report<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„ä»£ç æµ‹è¯•è¦†ç›–ç‡å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Name          Stmts   Miss  Cover<br>---------------------------------<br>func_add.py       8      2    75%<br>---------------------------------<br>TOTAL             8      2    75%<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„ï¼Œå› ä¸ºåœ¨è¿™ä¸¤ä¸ªæµ‹è¯•æ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹æ‰€æœ‰çš„ä»£ç éƒ½è¿›è¡Œäº†æµ‹è¯•ï¼Œç†è®ºä¸Šæµ‹è¯•è¦†ç›–ç‡åº”è¯¥ä¸º100%ï¼Œä¹‹æ‰€ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸º<code>coverage run</code>å‘½ä»¤è¿è¡Œæ—¶æ¯ä¸€æ¬¡éƒ½ä¼šè¦†ç›–æ‰ä¹‹å‰çš„æµ‹è¯•ã€‚æ­£ç¡®çš„æµ‹è¯•å‘½ä»¤ï¼ˆä»¥æ–‡ä»¶è¿½åŠ çš„å½¢å¼ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">coverage run test_func_add1.py<br>coverage run --append test_func_add2.py<br>coverage report<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ä»£ç è¦†ç›–ç‡å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Name          Stmts   Miss  Cover<br>---------------------------------<br>func_add.py       8      0   100%<br>---------------------------------<br>TOTAL             8      0   100%<br></code></pre></td></tr></table></figure><h3 id="coverageçš„Gitlab-CI-CDé›†æˆ">coverageçš„Gitlab CI/CDé›†æˆ</h3><p>åœ¨æ–‡ç« <a href="https://blog.csdn.net/jclian91/article/details/131258147">Gitlab CI/CDå…¥é—¨ï¼ˆä¸€ï¼‰Pythoné¡¹ç›®çš„CIæ¼”ç¤º</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†Gitlab CI/CDçš„å…¥é—¨ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å°†é›†æˆcoverageã€‚</p><p>é¦–å…ˆæˆ‘ä»¬çš„testç›®å½•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>â”œâ”€â”€ __init__.py<br>â”œâ”€â”€ func_add.py<br>â””â”€â”€ test_func_add.py<br></code></pre></td></tr></table></figure><p><code>func_add.py</code>ä¸ºå®ç°ä¸¤ä¸ªå˜é‡ç›¸åŠ çš„ä»£ç ï¼Œå¦‚å‰è¿°ã€‚<code>test_func_add.py</code>ä¸ºæµ‹è¯•ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> unittest<br><br><span class="hljs-keyword">from</span> func_add <span class="hljs-keyword">import</span> add<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestAdd</span>(unittest.TestCase):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add_case1</span>(<span class="hljs-params">self</span>):<br>        a = <span class="hljs-string">&quot;Hello&quot;</span><br>        b = <span class="hljs-string">&quot;World&quot;</span><br>        res = add(a, b)<br>        <span class="hljs-built_in">print</span>(res)<br>        self.assertEqual(res, <span class="hljs-string">&quot;Hello+World&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add_case2</span>(<span class="hljs-params">self</span>):<br>        a = <span class="hljs-number">1</span><br>        b = <span class="hljs-number">2</span><br>        res = add(a, b)<br>        <span class="hljs-built_in">print</span>(res)<br>        self.assertEqual(res, <span class="hljs-number">3</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add_case3</span>(<span class="hljs-params">self</span>):<br>        a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]<br>        b = [<span class="hljs-number">3</span>]<br>        res = add(a, b)<br>        <span class="hljs-built_in">print</span>(res)<br>        self.assertEqual(res, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add_case4</span>(<span class="hljs-params">self</span>):<br>        a = <span class="hljs-number">2</span><br>        b = <span class="hljs-string">&quot;3&quot;</span><br>        res = add(a, b)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-literal">None</span>)<br>        self.assertEqual(res, <span class="hljs-literal">None</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-comment"># éƒ¨åˆ†ç”¨ä¾‹æµ‹è¯•</span><br>    <span class="hljs-comment"># æ„é€ ä¸€ä¸ªå®¹å™¨ç”¨æ¥å­˜æ”¾æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹</span><br>    suite = unittest.TestSuite()<br>    <span class="hljs-comment"># æ·»åŠ ç±»ä¸­çš„æµ‹è¯•ç”¨ä¾‹</span><br>    suite.addTest(TestAdd(<span class="hljs-string">&#x27;test_add_case1&#x27;</span>))<br>    suite.addTest(TestAdd(<span class="hljs-string">&#x27;test_add_case2&#x27;</span>))<br>    suite.addTest(TestAdd(<span class="hljs-string">&#x27;test_add_case3&#x27;</span>))<br>    suite.addTest(TestAdd(<span class="hljs-string">&#x27;test_add_case4&#x27;</span>))<br>    run = unittest.TextTestRunner()<br>    run.run(suite)<br></code></pre></td></tr></table></figure><p>CI/CDä¾èµ–<code>.gitlab-ci.yml</code>ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">stages:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">build</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">unittest</span><br><br><span class="hljs-attr">build-job:</span><br>  <span class="hljs-attr">stage:</span> <span class="hljs-string">build</span><br>  <span class="hljs-attr">script:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">`date`</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;Hello, $GITLAB_USER_LOGIN!&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;This job deploys something from the $CI_COMMIT_BRANCH branch.&quot;</span><br><br><span class="hljs-attr">unit_test_job:</span><br>  <span class="hljs-attr">stage:</span> <span class="hljs-string">unittest</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">python:3.9-alpine3.17</span><br>  <span class="hljs-attr">script:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">pip3</span> <span class="hljs-string">install</span> <span class="hljs-string">coverage==7.3.0</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">coverage</span> <span class="hljs-string">run</span> <span class="hljs-string">test/test_func_add.py</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">coverage</span> <span class="hljs-string">report</span><br>  <span class="hljs-attr">coverage:</span> <span class="hljs-string">&#x27;/TOTAL.*\s+(\d+%)$/&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿è¡ŒCI/CDï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/coverage1_1.png" alt="unittest_jobè¿è¡Œç»“æœ"></p><p>åœ¨Gitlabé¡¹ç›®ä¸­çš„<code>Settings -&gt; CI/CD -&gt; General pipelines</code>ä¸­ç‚¹å‡»Expandï¼Œä¼šæ˜¾ç¤ºCI/CDå·²å†…ç½®<code>Pipeline status, Coverage report, Latest release</code>ï¼Œå…¶ä¸­<code>Coverage repor</code>å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/coverage1_2.png" alt="Coverage report"></p><p>æœ€åæˆ‘ä»¬è¦åœ¨é¡¹ç›®ä¸­åŠ å…¥coverage badgeï¼ˆå¾½ç« ï¼‰ï¼Œåœ¨Gitlabé¡¹ç›®ä¸­çš„<code>Settings -&gt; General -&gt; Badge</code>ä¸­ç‚¹å‡»Expandï¼Œå†ç‚¹å‡»Add badgeï¼Œcoverageå¾½ç« çš„é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="/img/coverage1_3.png" alt="Add badge"></p><p>æœ¬é¡¹ç›®ä¸­åªæœ‰mainåˆ†æ”¯ï¼Œå› æ­¤ä¸éœ€è¦è®¾ç½®å˜é‡ï¼Œå®é™…åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é…ç½®å˜é‡å¦‚default_branchç­‰ã€‚</p><p>ä»¥ä¸Šé…ç½®å®Œæ¯•åï¼Œé¡¹ç›®å¾½ç« æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="/img/coverage1_4.png" alt="æˆåŠŸåŠ å…¥å¾½ç« ï¼"></p><p>ä»¥ä¸Šé…ç½®è¿‡ç¨‹å·²å¼€æºï¼Œé¡¹ç›®ç½‘å€ä¸ºï¼š<a href="https://gitlab.com/jclian91/gitlab_ci_test">https://gitlab.com/jclian91/gitlab_ci_test</a> ã€‚</p><h3 id="coverage-badgeç”Ÿæˆ">coverage badgeç”Ÿæˆ</h3><p>coverage badgeç”Ÿæˆæ–¹å¼åˆ†ä¸ºé™æ€å’ŒåŠ¨æ€ã€‚</p><p>åŠ¨æ€çš„è¯ï¼Œå¯ä½¿ç”¨<code>coverage-badge</code>æˆ–è€…<code>genbadge</code>æ¨¡å—ã€‚</p><p>é™æ€çš„è¯ï¼Œå¯ä½¿ç”¨ç½‘ç«™ï¼š<a href="https://shields.io/badges/static-badge">https://shields.io/badges/static-badge</a> .</p><p>æ¯”å¦‚æˆ‘ä»¬ç”Ÿæˆç¼–ç¨‹è¯­è¨€çš„å¾½ç« ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/coverage1_5.png" alt="ç¤ºä¾‹å¾½ç« ç”Ÿæˆ"></p><p>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç”¨è¯¥ç½‘å€è®¿é—®å¾½ç« äº†ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†æµ‹è¯•å·¥å…·coverageçš„é«˜é˜¶ä½¿ç”¨ï¼Œå¸Œæœ›èƒ½å¯¹è¯»è€…æœ‰æ‰€å¯å‘~</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å•å…ƒæµ‹è¯•</tag>
      
      <tag>coverage</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tensorflowï¼ˆ1ï¼‰åŸºç¡€å…¥é—¨</title>
    <link href="/2023/08/15/tensorflow%EF%BC%881%EF%BC%89%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"/>
    <url>/2023/08/15/tensorflow%EF%BC%881%EF%BC%89%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="TensorFlow-Is-Coming-Part-1">TensorFlow Is Coming ( Part 1 )</h2><h3 id="ç›®å½•">ç›®å½•</h3><ol><li>TensorFlowç®€ä»‹</li><li>TensorFlowåŸºæœ¬æ¦‚å¿µ</li><li>Using TensorFlow</li><li>Optimization &amp; Linear Regression &amp;  Logistic Regression</li></ol><h3 id="1-TensorFlowç®€ä»‹">1. TensorFlowç®€ä»‹</h3><p>TensorFlowç”±Googleçš„Brain Teamåˆ›ç«‹ï¼Œäº2015å¹´11æœˆ9æ—¥å¼€æºã€‚</p><p>TensorFlowä¸­æ–‡ç¤¾åŒºç½‘ç«™ï¼š<a href="http://www.tensorfly.cn">http://www.tensorfly.cn</a> ã€‚</p><p>TensorFlow, å…¶å«ä¹‰ä¸º Tensor + Flow, å…·ä½“è¯´æ¥ï¼š</p><ul><li>Tensorï¼ˆå¼ é‡ï¼‰ï¼šNç»´æ•°ç»„</li><li>Flowï¼ˆæµå›¾ï¼‰ï¼š  åŸºäºæ•°æ®æµå›¾ï¼ˆData Flow Graphï¼‰çš„è®¡ç®—</li></ul><p><a href="http://www.tensorfly.cn/">TensorFlowçš„ç‰¹å¾</a>ï¼š</p><ol><li>é«˜åº¦çš„çµæ´»æ€§</li><li>çœŸæ­£çš„å¯ç§»æ¤æ€§ï¼ˆPortabilityï¼‰</li><li>å°†ç§‘ç ”å’Œäº§å“è”ç³»åœ¨ä¸€èµ·</li><li>è‡ªåŠ¨æ±‚å¾®åˆ†</li><li>å¤šè¯­è¨€æ”¯æŒ</li><li>æ€§èƒ½æœ€ä¼˜åŒ–</li></ol><p>TensorFlow Python API åœ¨æ•°æ®ç»“æ„å’ŒåŸºäºå¤šç»´æ•°ç»„çš„è®¡ç®—ä¸NumPyæœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå…¶å®‰è£…æ–¹å¼ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> tensorflow<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šâ€œHello worldâ€ with TensorFlow</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>h = tf.constant(<span class="hljs-string">&quot;Hello&quot;</span>)<br>w = tf.constant(<span class="hljs-string">&quot; World!&quot;</span>)<br>hw = h + w<br><span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>    ans = sess.run(hw)<br><span class="hljs-built_in">print</span> (ans)<br></code></pre></td></tr></table></figure><h3 id="2-TensorFlowåŸºæœ¬æ¦‚å¿µ">2. TensorFlowåŸºæœ¬æ¦‚å¿µ</h3><p>æœ¬èŠ‚ç›®å½•ï¼š</p><ol><li>Constant</li><li>Tensor</li><li>Computation Graphs</li><li>Variables</li><li>Placeholder Variables</li></ol><h4 id="Constant">Constant</h4><p>TensorFlowä¸­çš„å¸¸é‡ç”¨constant()å‡½æ•°æ„é€ ã€‚</p><h4 id="Tensor">Tensor</h4><p><img src="/img/tf1_1.png" alt=""><br><img src="/img/tf1_2.png" alt=""></p><p>Tensorçš„åˆ›å»ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">a = tf.constant(<span class="hljs-number">2</span>)        <span class="hljs-comment"># æ ‡é‡</span><br>b = tf.constant([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>])    <span class="hljs-comment"># ä¸€ç»´å‘é‡</span><br>c = tf.constant([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>],<br>                 [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])  <span class="hljs-comment"># äºŒç»´å‘é‡</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŒ‡å®šç»´åº¦ï¼ˆshapeï¼‰ä»¥åŠæ•°æ®ç±»å‹(dtype)ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">a = tf.constant(np.array([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]), shape=(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>),dtype=tf.int64)<br>a = tf.constant(np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],<br>                          [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]]),<br>                          shape=(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>),<br>                          dtype=tf.float64)<br></code></pre></td></tr></table></figure><p><img src="/img/tf1_3.png" alt="æ•°æ®ç±»å‹"></p><h4 id="Computation-Graphs">Computation Graphs</h4><p>Generally, the typical workflow in TensorFlow can be summarized as follows:</p><ul><li>Build a computational graph</li><li>Start a new session to evaluate the graph<ol><li>Initialize variables</li><li>Execute the operations in the compiled graph</li></ol></li></ul><p>ä¾‹1ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>a = tf.constant(<span class="hljs-number">5</span>)<br>b = tf.constant(<span class="hljs-number">2</span>)<br>c = tf.constant(<span class="hljs-number">3</span>)<br><br>d = tf.multiply(a,b)<br>e = tf.add(c,b)<br>f = tf.subtract(d,e)<br><br><span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>    res = sess.run(f)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;f is %s&#x27;</span>%res)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">f is 5<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç¨‹åºä¸­ï¼ŒComputation Graph ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/tf1_4.png" alt=""></p><p>åœ¨TensorBoardä¸­ï¼ŒComputation Graphå¦‚ä¸‹ï¼š</p><p><img src="/img/tf1_5.png" alt=""></p><p>å¸¸ç”¨çš„TensorFlowè¿ç®—å‡½æ•°ï¼š</p><p><img src="/img/tf1_6.png" alt=""></p><p>ä¾‹2ï¼šä½¿ç”¨GraphåŠSession</p><p>æœªä½¿ç”¨Session</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    tf_x = tf.constant([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],<br>                        [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>,<span class="hljs-number">6.</span>]], dtype=tf.float64)<br>    col_sum = tf.reduce_sum(tf_x, axis=<span class="hljs-number">0</span>) <span class="hljs-comment"># æŒ‰åˆ—æ±‚å’Œ</span><br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;tf_x:\n&#x27;</span>, tf_x)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;col_sum:\n&#x27;</span>, col_sum)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">tf_x:<br> Tensor(<span class="hljs-string">&quot;Const:0&quot;</span>, shape=(3, 2), dtype=float64)<br>col_sum:<br> Tensor(<span class="hljs-string">&quot;Sum:0&quot;</span>, shape=(2,), dtype=float64)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Sessionï¼ˆè·å–è®¡ç®—ç»“æœï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    tf_x = tf.constant([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],<br>                        [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>,<span class="hljs-number">6.</span>]], dtype=tf.float64)<br>    col_sum = tf.reduce_sum(tf_x, axis=<span class="hljs-number">0</span>) <span class="hljs-comment"># æŒ‰åˆ—æ±‚å’Œ</span><br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    mat, csum = sess.run([tf_x, col_sum])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;tf_x:\n&#x27;</span>, mat)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;col_sum:\n&#x27;</span>, csum)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">tf_x:<br> [[1. 2.]<br>  [3. 4.]<br>  [5. 6.]]<br>col_sum:<br> [ 9. 12.]<br></code></pre></td></tr></table></figure><p>TensorFlowèƒŒåçš„è¿è¡ŒåŸç†å›¾ï¼š</p><p><img src="/img/tf1_7.png" alt="è¿è¡ŒåŸç†å›¾"></p><p>ä¸ºä»€ä¹ˆè¦é‡‡ç”¨Computation Graphsï¼Ÿ</p><ul><li>TensorFlow optimizes its computations based on the graphâ€™s connectivity.</li><li>Each graph has its own set of node dependencies.Being able to locate dependencies between units of our model allows us to both distribute computations across available resources and avoid performing redundant computations of irrelevant subsets, resulting in a faster and more efficient way of computing things.</li></ul><p><img src="/img/tf1_8.png" alt=""></p><h4 id="Variables">Variables</h4><p>Variables are constructs in TensorFlow that allows us to store and update parameters of our models in the current session during training. To define a â€œvariableâ€ tensor, we use TensorFlowâ€™s Variable() constructor.  to execute a computational graph that contains variables, we must initialize all variables in the active session first (using tf.global_variables_initializer()).</p><p>ä¾‹1ï¼šä½¿ç”¨Variables</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    tf_x = tf.Variable([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],<br>                        [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]], dtype=tf.float32)<br>    x = tf.constant(<span class="hljs-number">1.</span>, dtype=tf.float32)<br><br>    <span class="hljs-comment"># add a constant to the matrix:</span><br>    tf_x = tf_x + x<br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    sess.run(tf.global_variables_initializer())<br>    result = sess.run(tf_x)<br><br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[[2. 3.]<br> [4. 5.]<br> [6. 7.]]<br></code></pre></td></tr></table></figure><p>ä¾‹2ï¼š è¿è¡Œä¸¤éï¼Ÿ</p><p>è¿è¡Œä¸¤éï¼Œ å­˜åœ¨çš„é—®é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    tf_x = tf.Variable([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],<br>                        [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]], dtype=tf.float32)<br>    x = tf.constant(<span class="hljs-number">1.</span>, dtype=tf.float32)<br><br>    <span class="hljs-comment"># add a constant to the matrix:</span><br>    tf_x = tf_x + x<br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    sess.run(tf.global_variables_initializer())<br>    result = sess.run(tf_x)<br>    result = sess.run(tf_x) <span class="hljs-comment"># è¿è¡Œä¸¤é</span><br><br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[[2. 3.]<br> [4. 5.]<br> [6. 7.]]<br></code></pre></td></tr></table></figure><p>è§£å†³åŠæ³•ï¼Ÿ ä½¿ç”¨tf.assign()å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    tf_x = tf.Variable([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],<br>                        [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]], dtype=tf.float32)<br>    x = tf.constant(<span class="hljs-number">1.</span>, dtype=tf.float32)<br><br>    <span class="hljs-comment"># add a constant to the matrix:</span><br>    update_tf_x = tf.assign(tf_x, tf_x + x)<br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    sess.run(tf.global_variables_initializer())<br>    result = sess.run(update_tf_x)<br>    result = sess.run(update_tf_x) <span class="hljs-comment"># è¿è¡Œä¸¤é</span><br><br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶çš„è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[[3. 4.]<br> [5. 6.]<br> [7. 8.]]<br></code></pre></td></tr></table></figure><h4 id="Placeholder-Variables">Placeholder Variables</h4><p><strong>Placeholder variables</strong> allow us to feed the computational graph with numerical values in an active session at runtime. <strong>Placeholders</strong> have an optional shape argument. If a shape is not fed or is passed as <strong>None</strong>, then the placeholder can be fed with data of any size.</p><p>ä¾‹ï¼šçŸ©é˜µç›¸ä¹˜</p><p>æŒ‡å®šè¡Œæ•°ä¸åˆ—æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    tf_x = tf.placeholder(dtype=tf.float32,shape=(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>))<br><br>    output = tf.matmul(tf_x, tf.transpose(tf_x)) <span class="hljs-comment"># çŸ©é˜µä¹˜ä»¥å®ƒçš„è½¬ç½®</span><br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    sess.run(tf.global_variables_initializer())<br>    <span class="hljs-comment"># åˆ›å»º3*2çŸ©é˜µ</span><br>    np_ary = np.array([[<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                       [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>],<br>                       [<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>]])<br><br>    <span class="hljs-built_in">print</span>(sess.run(output, &#123;tf_x: np_ary&#125;))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[[ 25.  39.  53.]<br> [ 39.  61.  83.]<br> [ 53.  83. 113.]]<br></code></pre></td></tr></table></figure><p>æŒ‡å®šåˆ—æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    tf_x = tf.placeholder(dtype=tf.float32,shape=(<span class="hljs-literal">None</span>, <span class="hljs-number">2</span>))<br><br>    output = tf.matmul(tf_x, tf.transpose(tf_x)) <span class="hljs-comment"># çŸ©é˜µä¹˜ä»¥å®ƒçš„è½¬ç½®</span><br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    sess.run(tf.global_variables_initializer())<br>    <span class="hljs-comment"># åˆ›å»º3*2çŸ©é˜µ</span><br>    np_ary1 = np.array([[<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                       [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>],<br>                       [<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>]])<br><br>    <span class="hljs-built_in">print</span>(sess.run(output, &#123;tf_x: np_ary1&#125;))<br><br>    <span class="hljs-comment"># åˆ›å»º4*2çŸ©é˜µ</span><br>    np_ary2 = np.array([[<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>],<br>                        [<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>],<br>                        [<span class="hljs-number">9.</span>,<span class="hljs-number">10.</span>]])<br><br>    <span class="hljs-built_in">print</span>(sess.run(output, &#123;tf_x: np_ary2&#125;))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[[ 25.  39.  53.]<br> [ 39.  61.  83.]<br> [ 53.  83. 113.]]<br>[[ 25.  39.  53.  67.]<br> [ 39.  61.  83. 105.]<br> [ 53.  83. 113. 143.]<br> [ 67. 105. 143. 181.]]<br></code></pre></td></tr></table></figure><p>æœªæŒ‡å®šshape</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    tf_x = tf.placeholder(dtype=tf.float32)<br><br>    output = tf.matmul(tf_x, tf.transpose(tf_x)) <span class="hljs-comment"># çŸ©é˜µä¹˜ä»¥å®ƒçš„è½¬ç½®</span><br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    sess.run(tf.global_variables_initializer())<br>    <span class="hljs-comment"># åˆ›å»º3*3çŸ©é˜µ</span><br>    np_ary1 = np.array([[<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>, <span class="hljs-number">5.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>, <span class="hljs-number">7.</span>],<br>                        [<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>, <span class="hljs-number">9.</span>]])<br><br>    <span class="hljs-built_in">print</span>(sess.run(output, &#123;tf_x: np_ary1&#125;))<br><br>    <span class="hljs-comment"># åˆ›å»º4*2çŸ©é˜µ</span><br>    np_ary2 = np.array([[<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>],<br>                        [<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>],<br>                        [<span class="hljs-number">9.</span>,<span class="hljs-number">10.</span>]])<br><br>    <span class="hljs-built_in">print</span>(sess.run(output, &#123;tf_x: np_ary2&#125;))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[[ 50.  74.  98.]<br> [ 74. 110. 146.]<br> [ 98. 146. 194.]]<br>[[ 25.  39.  53.  67.]<br> [ 39.  61.  83. 105.]<br> [ 53.  83. 113. 143.]<br> [ 67. 105. 143. 181.]]<br></code></pre></td></tr></table></figure><h4 id="3-Using-TensorFlow">3. Using TensorFlow</h4><p>æœ¬èŠ‚ç›®å½•:</p><ul><li>Saving and Restoring Models</li><li>Naming TensorFlow Objects</li><li>CPU and GPU</li><li>Control Flow</li><li>TensorBoard</li></ul><h5 id="Saving-and-Restoring-Models">Saving and Restoring Models</h5><p>ä¾‹ï¼š</p><p><strong>Saving Models</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br><br>    tf_x = tf.Variable([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],<br>                        [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]], dtype=tf.float32)<br>    x = tf.constant(<span class="hljs-number">1.</span>, dtype=tf.float32)<br><br>    update_tf_x = tf.assign(tf_x, tf_x + x)<br><br>    <span class="hljs-comment"># initialize a Saver, which gets all variables</span><br>    <span class="hljs-comment"># within this computation graph context</span><br>    saver = tf.train.Saver()<br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    sess.run(tf.global_variables_initializer())<br>    result = sess.run(update_tf_x)<br><br>    <span class="hljs-comment"># save the model</span><br>    saver.save(sess, save_path=<span class="hljs-string">&#x27;E://flag/my-model.ckpt&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ä¿å­˜çš„æ–‡ä»¶ï¼š</p><p><img src="/img/tf1_9.png" alt="ä¿å­˜çš„æ–‡ä»¶"></p><p>The file my-model.ckpt.data-00000-of-00001 saves our main variable values, the .index file keeps track of the data structures, and the .meta file describes the structure of our computational graph that we executed.</p><p><strong>Restoring Models:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br><br>    tf_x = tf.Variable([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],<br>                        [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]], dtype=tf.float32)<br>    x = tf.constant(<span class="hljs-number">1.</span>, dtype=tf.float32)<br><br>    update_tf_x = tf.assign(tf_x, tf_x + x)<br><br>    <span class="hljs-comment"># initialize a Saver, which gets all variables</span><br>    <span class="hljs-comment"># within this computation graph context</span><br>    saver = tf.train.Saver()<br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    saver.restore(sess, save_path=<span class="hljs-string">&#x27;E://flag/my-model.ckpt&#x27;</span>)<br>    result = sess.run(update_tf_x)<br>    <span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[[3. 4.]<br> [5. 6.]<br> [7. 8.]]<br></code></pre></td></tr></table></figure><h4 id="Naming-TensorFlow-Objects">Naming TensorFlow Objects</h4><p>Each Tensor object also has an identifying name. This name is an intrinsic string name, not to be confused with the name of the variable. As with dtype, we can use the .name attribute to see the name of the object:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    c1 = tf.constant(<span class="hljs-number">4</span>, dtype=tf.float64, name=<span class="hljs-string">&#x27;c&#x27;</span>)<br>    c2 = tf.constant(<span class="hljs-number">4</span>, dtype=tf.int32, name=<span class="hljs-string">&#x27;c&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(c1.name)<br><span class="hljs-built_in">print</span>(c2.name)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">c:0<br>c_1:0<br></code></pre></td></tr></table></figure><p><strong>Name scopes</strong></p><p>Sometimes when dealing with a large, complicated graph, we would like to create some node grouping to make it easier to follow and manage. For that we can hierarchically group nodes together by name. We do so by using tf.name_scope(â€œprefixâ€) together with the useful with clause again:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    c1 = tf.constant(<span class="hljs-number">4</span>, dtype=tf.float64, name=<span class="hljs-string">&#x27;c&#x27;</span>)<br>    <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&quot;prefix_name&quot;</span>):<br>        c2 = tf.constant(<span class="hljs-number">4</span>, dtype=tf.int32, name=<span class="hljs-string">&#x27;c&#x27;</span>)<br>        c3 = tf.constant(<span class="hljs-number">4</span>, dtype=tf.float64, name=<span class="hljs-string">&#x27;c&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(c1.name)<br><span class="hljs-built_in">print</span>(c2.name)<br><span class="hljs-built_in">print</span>(c3.name)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">c:0<br>prefix_name/c:0<br>prefix_name/c_1:0<br></code></pre></td></tr></table></figure><h4 id="CPU-and-GPU">CPU and GPU</h4><p>All TensorFlow operations in general, can be executed on a <strong>CPU</strong>. If you have a <strong>GPU</strong> version of TensorFlow installed, TensorFlow will automatically execute those operations that have <strong>GPU</strong> support on GPUs and use your machineâ€™s <strong>CPU</strong>, otherwise.</p><h4 id="Control-Flow">Control Flow</h4><p>ä¾‹ï¼š if-elseç»“æ„</p><p>ç®€å•çš„if-elseè¯­å¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>addition = <span class="hljs-literal">True</span><br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    x = tf.placeholder(dtype=tf.float32, shape=<span class="hljs-literal">None</span>)<br>    <span class="hljs-keyword">if</span> addition:<br>        y = x + <span class="hljs-number">1.</span><br>    <span class="hljs-keyword">else</span>:<br>        y = x - <span class="hljs-number">1.</span><br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    result = sess.run(y, feed_dict=&#123;x: <span class="hljs-number">1.</span>&#125;)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Result:\n&#x27;</span>, result)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Result:<br> 2.0<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨tf.cond()ä»£æ›¿ä¸Šé¢çš„if-elseè¯­å¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br>    addition = tf.placeholder(dtype=tf.<span class="hljs-built_in">bool</span>, shape=<span class="hljs-literal">None</span>)<br>    x = tf.placeholder(dtype=tf.float32, shape=<span class="hljs-literal">None</span>)<br><br>    y = tf.cond(addition,<br>                true_fn=<span class="hljs-keyword">lambda</span>: tf.add(x, <span class="hljs-number">1.</span>),<br>                false_fn=<span class="hljs-keyword">lambda</span>: tf.subtract(x, <span class="hljs-number">1.</span>))<br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    result = sess.run(y, feed_dict=&#123;addition:<span class="hljs-literal">True</span>,x: <span class="hljs-number">1.</span>&#125;)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Result:\n&#x27;</span>, result)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Result:<br> 2.0<br></code></pre></td></tr></table></figure><h4 id="TensorBoard">TensorBoard</h4><p>TensorBoard is one of the coolest features of TensorFlow, which provides us with a suite of tools to visualize our computational graphs and operations before and during runtime.</p><p>ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>g = tf.Graph()<br><span class="hljs-keyword">with</span> g.as_default() <span class="hljs-keyword">as</span> g:<br><br>    tf_x = tf.Variable([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],<br>                        [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>],<br>                        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]],<br>                        name=<span class="hljs-string">&#x27;tf_x_0&#x27;</span>,<br>                        dtype=tf.float32)<br><br>    tf_y = tf.Variable([[<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>],<br>                        [<span class="hljs-number">9.</span>, <span class="hljs-number">10.</span>],<br>                        [<span class="hljs-number">11.</span>, <span class="hljs-number">12.</span>]],<br>                        name=<span class="hljs-string">&#x27;tf_y_0&#x27;</span>,<br>                        dtype=tf.float32)<br><br>    output = tf_x + tf_y<br>    output = tf.matmul(tf.transpose(tf_x), output)<br><br><span class="hljs-keyword">with</span> tf.Session(graph=g) <span class="hljs-keyword">as</span> sess:<br>    sess.run(tf.global_variables_initializer())<br><br>    <span class="hljs-comment"># create FileWrite object that writes the logs</span><br>    file_writer = tf.summary.FileWriter(logdir=<span class="hljs-string">&#x27;E://flag/logs/1&#x27;</span>, graph=g)<br>    result = sess.run(output)<br>    <span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[[124. 142.]<br> [160. 184.]]<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨TensorboardæŸ¥çœ‹Computation Graph:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tensorboard --logdir E://flag/logs/1<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\HP&gt;tensorboard --logdir E://flag/logs/1<br>TensorBoard 1.10.0 at http://DESKTOP-28K2SLS:6006 (Press CTRL+C to quit)<br></code></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://DESKTOP-28K2SLS:6006å³å¯æŸ¥çœ‹Computation Graphï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/tf1_10.png" alt=""></p><h3 id="4-Optimization-Linear-Regression-Logistic-Regression">4. Optimization &amp; Linear Regression &amp;  Logistic Regression</h3><p><strong>Optimization Steps:</strong></p><ol><li>Defining a model</li><li>Defining loss function</li><li>Optimizer(The gradient descent)</li><li>Try to predict</li></ol><p>Gradient Descentçš„ä¸‰ç§å½¢å¼ï¼š</p><table><thead><tr><th>æè¿°</th><th>GD</th><th>Minth-Batches GD</th><th>SGD</th></tr></thead><tbody><tr><td>å•æ¬¡è¿­ä»£æ ·æœ¬æ•°</td><td>æ•´ä¸ªè®­ç»ƒé›†</td><td>è®­ç»ƒé›†çš„å­é›†</td><td>å•ä¸ªæ ·æœ¬</td></tr><tr><td>ç®—æ³•å¤æ‚åº¦</td><td>é«˜</td><td>ä¸€èˆ¬</td><td>ä½</td></tr><tr><td>è¿è¡Œé€Ÿåº¦</td><td>æ…¢</td><td>è¾ƒå¿«</td><td>å¿«</td></tr><tr><td>æ”¶æ•›æ€§</td><td>ç¨³å®š</td><td>è¾ƒç¨³å®š</td><td>ä¸ç¨³å®š</td></tr><tr><td>é™·å…¥å±€éƒ¨æœ€ä¼˜ç‚¹çš„å¯èƒ½æ€§</td><td>å¤§</td><td>è¾ƒå¤§</td><td>å°</td></tr></tbody></table><p><strong>Linear Regression</strong></p><ol><li>Model</li></ol><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>y</mi><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">y = \sum\limits_{i=1}^{n}w_{i}x_{i} + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span></p><ol start="2"><li>Loss function: MSE</li></ol><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow></msub><mo>âˆ’</mo><mo stretchy="false">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">loss = \frac{1}{2m}\sum\limits_{i=1}^{m}(y_{true} - (\sum\limits_{i=1}^{n}w_{i}x_{i}+b))^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></p><ol start="3"><li>The gradient descent optimizer(SGD)</li></ol><p>æŒ‡å®š loss function å’Œ learning_rate</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">optimizer = tf.train.GradientDescentOptimizer(learning_rate)<br>train = optimizer.minimize(loss)<br></code></pre></td></tr></table></figure><ol start="4"><li>predict on new sample</li></ol><p>Linear Regressionçš„ä¾‹å­ï¼š</p><p>æ•°æ®é›†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">x_data = np.random.randn(<span class="hljs-number">200</span>, <span class="hljs-number">3</span>)<br>w_real = [<span class="hljs-number">0.3</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.1</span>]<br>b_real = -<span class="hljs-number">0.2</span><br>noise = np.random.randn(<span class="hljs-number">1</span>, <span class="hljs-number">200</span>)*<span class="hljs-number">0.1</span><br>y_data = np.matmul(w_real, x_data.T) + b_real + noise<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> linear_model<br><br><span class="hljs-comment"># æ ·æœ¬æ•°æ®é›†</span><br>x_data = np.random.randn(<span class="hljs-number">200</span>, <span class="hljs-number">3</span>)<br>w_real = [<span class="hljs-number">0.3</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.1</span>]<br>b_real = -<span class="hljs-number">0.2</span><br>noise = np.random.randn(<span class="hljs-number">1</span>, <span class="hljs-number">200</span>)*<span class="hljs-number">0.1</span><br>y_data = np.matmul(w_real, x_data.T) + b_real + noise<br><br><span class="hljs-comment"># ä½¿ç”¨Sklearnè¿›è¡Œä¸€å…ƒçº¿æ€§å›å½’å»ºæ¨¡</span><br>regr = linear_model.LinearRegression()<br><br><span class="hljs-comment"># Train the model using the data</span><br>regr.fit(x_data, y_data.transpose())<br><br><span class="hljs-comment"># The coefficients</span><br>w, b = regr.coef_[<span class="hljs-number">0</span>], regr.intercept_<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç”¨Sklearnè®¡ç®—å¾—åˆ°çš„çº¿æ€§å›å½’ç³»æ•°:\n w:%s\tb:%s&#x27;</span>%(w, b))<br><br>NUM_STEPS = <span class="hljs-number">100</span>                                         <span class="hljs-comment"># å¾ªç¯æ¬¡æ•°</span><br>g = tf.Graph()                                          <span class="hljs-comment"># åˆ›å»ºå›¾</span><br>wb_ = []                                                <span class="hljs-comment"># è®°å½•ç»“æœçš„åˆ—è¡¨</span><br><br><span class="hljs-keyword">with</span> g.as_default():<br>    x = tf.placeholder(tf.float32, shape=[<span class="hljs-literal">None</span>,<span class="hljs-number">3</span>])       <span class="hljs-comment"># æ ·æœ¬ä¸­çš„xå€¼</span><br>    y_true = tf.placeholder(tf.float32, shape=<span class="hljs-literal">None</span>)      <span class="hljs-comment"># æ ·æœ¬ä¸­çš„çœŸå®çš„yå€¼</span><br><br>    <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&#x27;inference&#x27;</span>) <span class="hljs-keyword">as</span> scope:<br>        w = tf.Variable([[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]], dtype=tf.float32, name=<span class="hljs-string">&#x27;weights&#x27;</span>)  <span class="hljs-comment"># wç³»æ•°</span><br>        b = tf.Variable(<span class="hljs-number">0</span>, dtype=tf.float32, name=<span class="hljs-string">&#x27;bias&#x27;</span>)             <span class="hljs-comment"># æˆªè·b</span><br>        y_pred = tf.matmul(w, tf.transpose(x)) + b                    <span class="hljs-comment"># yçš„é¢„æµ‹å€¼</span><br><br>    <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&#x27;loss&#x27;</span>) <span class="hljs-keyword">as</span> scope:                              <span class="hljs-comment"># å®šä¹‰æŸå¤±å‡½æ•°</span><br>        loss = tf.reduce_mean(tf.square(y_true-y_pred))<br><br>    <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&#x27;train&#x27;</span>) <span class="hljs-keyword">as</span> scope:                             <span class="hljs-comment">#å®šä¹‰optimization</span><br>        learning_rate = <span class="hljs-number">0.5</span><br>        optimizer = tf.train.GradientDescentOptimizer(learning_rate)<br>        train = optimizer.minimize(loss)<br><br>        <span class="hljs-comment"># Before starting, initialize the variables. We will &#x27;run&#x27; this first.</span><br>        init = tf.global_variables_initializer()<br><br>        <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>            sess.run(init)<br>            <span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(NUM_STEPS):<br>                sess.run(train, &#123;x: x_data, y_true: y_data&#125;)<br>            wb_.append(sess.run([w, b]))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç”¨TensorFlowè®¡ç®—å¾—åˆ°çš„çº¿æ€§å›å½’ç³»æ•°:\n&quot;</span>)<br><span class="hljs-built_in">print</span>(wb_)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç”¨Sklearnè®¡ç®—å¾—åˆ°çš„çº¿æ€§å›å½’ç³»æ•°:<br> w:[0.29638914 0.49420393 0.096624  ]b:[-0.21690145]<br>ç”¨TensorFlowè®¡ç®—å¾—åˆ°çš„çº¿æ€§å›å½’ç³»æ•°:<br>[[array([[0.29638913, 0.49420393, 0.096624  ]], dtype=float32), -0.21690145]]<br></code></pre></td></tr></table></figure><p><strong>Logistic Regression</strong></p><ol><li>Model</li></ol><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>ln</mi><mo>â¡</mo><mrow><mo stretchy="false">(</mo><mfrac><mi>p</mi><mrow><mn>1</mn><mo>âˆ’</mo><mi>p</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\ln{(\frac{p}{1-p})} = \sum\limits_{i=1}^{n}w_{i}x_{i} + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.988em;vertical-align:-0.8804em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span></p><ol start="2"><li>Loss function: Cross Entropy (OR log loss function)</li></ol><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mi>H</mi><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>âˆ‘</mo><mi>x</mi></munder><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>log</mi><mo>â¡</mo><mrow><mi>q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">loss = H(p,q) = \sum\limits_{x} p(x)\log{q(x)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3em;vertical-align:-1.25em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.9em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></span></p><ol start="3"><li>The gradient descent optimizer(SGD)</li></ol><p>æŒ‡å®š loss function å’Œ learning_rate</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">optimizer = tf.train.GradientDescentOptimizer(learning_rate)<br>train = optimizer.minimize(loss)<br></code></pre></td></tr></table></figure><ol start="4"><li>predict on new samples</li></ol><p>ä¾‹å­ï¼š</p><p>æ ·æœ¬æ•°æ®é›†ï¼š</p><p><a href="https://github.com/percent4/tensorflow_js_learning/blob/master/USA_vote.csv">https://github.com/percent4/tensorflow_js_learning/blob/master/USA_vote.csv</a></p><p>Pythonä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LogisticRegression<br><br><span class="hljs-comment">#read data from other places, e.g. csv</span><br><span class="hljs-comment">#drop_list: variables that are not used</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_data</span>(<span class="hljs-params">file_path, drop_list=[]</span>):<br>    dataSet = pd.read_csv(file_path,sep=<span class="hljs-string">&#x27;,&#x27;</span>)<br>    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> drop_list:<br>        dataSet = dataSet.drop(col,axis=<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> dataSet<br><br><span class="hljs-comment"># CSVæ–‡ä»¶å­˜æ”¾ç›®å½•</span><br>path = <span class="hljs-string">&#x27;E://USA_vote.csv&#x27;</span><br><span class="hljs-comment"># è¯»å–CSVæ–‡ä»¶ä¸­çš„æ•°æ®</span><br>dataSet = read_data(path)<br><br><span class="hljs-comment"># åˆ©ç”¨sklearnä¸­çš„LogisticRegressionæ¨¡å‹è¿›è¡Œå»ºæ¨¡</span><br>clf = LogisticRegression(C=<span class="hljs-number">1e9</span>)<br>X, y = dataSet.iloc[:,<span class="hljs-number">0</span>:-<span class="hljs-number">1</span>], dataSet.iloc[:, -<span class="hljs-number">1</span>]<br>clf.fit(X,y)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Sklearnä¸­çš„é€»è¾‘å›å½’æ¨¡å‹è®¡ç®—ç»“æœï¼š&#x27;</span>)<br><span class="hljs-built_in">print</span>(clf.coef_)<br><span class="hljs-built_in">print</span>(clf.intercept_)<br><br>y_samples = np.array(y)    <span class="hljs-comment"># æ ·æœ¬ä¸­çš„yæ ‡ç­¾</span><br>x_samples = np.array(X)    <span class="hljs-comment"># æ ·æœ¬ä¸­çš„xæ ‡ç­¾</span><br>samples_num, var_num = x_samples.shape<br><br>NUM_STEPS = <span class="hljs-number">20000</span>    <span class="hljs-comment"># æ€»çš„è®­ç»ƒæ¬¡æ•°</span><br>g = tf.Graph()<br>wb_ = []<br><br><br><span class="hljs-comment"># tensorflowè®­ç»ƒæ¨¡å‹</span><br><span class="hljs-keyword">with</span> g.as_default():<br>    x = tf.placeholder(tf.float32, shape=[<span class="hljs-literal">None</span>, var_num])<br>    y_true = tf.placeholder(tf.float32, shape=<span class="hljs-literal">None</span>)<br><br>    <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&#x27;inference&#x27;</span>) <span class="hljs-keyword">as</span> scope:<br>        w = tf.Variable([[-<span class="hljs-number">1</span>]*var_num], dtype=tf.float32, name=<span class="hljs-string">&#x27;weights&#x27;</span>)<br>        b = tf.Variable(<span class="hljs-number">0</span>, dtype=tf.float32, name=<span class="hljs-string">&#x27;bias&#x27;</span>)<br>        y_pred = tf.matmul(w, tf.transpose(x)) + b<br><br>    <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&#x27;train&#x27;</span>) <span class="hljs-keyword">as</span> scope:<br>        <span class="hljs-comment"># labels: ture output of y, i.e. 0 and 1, logits: the model&#x27;s linear prediction</span><br>        cross_entropy = tf.nn.sigmoid_cross_entropy_with_logits(labels=y_true, logits=y_pred)<br>        loss = tf.reduce_mean(cross_entropy)<br><br>        learning_rate = <span class="hljs-number">0.5</span><br>        optimizer = tf.train.GradientDescentOptimizer(learning_rate)<br>        train = optimizer.minimize(loss)<br><br>        <span class="hljs-comment"># Before starting, initialize the variables. We will &#x27;run&#x27; this first.</span><br>        init = tf.global_variables_initializer()<br><br>        <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>            sess.run(init)<br><br>            <span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(NUM_STEPS):<br>                sess.run(train, &#123;x: x_samples, y_true: y_samples&#125;)<br>                <span class="hljs-keyword">if</span> (step % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>):<br>                    <span class="hljs-comment"># print(step, sess.run([w, b]))</span><br>                    wb_.append(sess.run([w, b]))<br><br>            <span class="hljs-built_in">print</span>(NUM_STEPS, sess.run([w, b]))<br>            sess.close()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Sklearnä¸­çš„é€»è¾‘å›å½’æ¨¡å‹è®¡ç®—ç»“æœï¼š<br>[[ 0.34827234 -1.23053489 -2.74406079  6.85275877 -0.95313362 -0.47709861<br>   1.36435858 -1.85956934 -1.3986284   1.54663297 -3.14095297  0.78882048<br>   0.15680863  0.37217971 -1.44617613  0.59043785]]<br>[-1.56742975]<br>TensorFlowçš„è®¡ç®—ç»“æœï¼š<br>20000 [array([[ 0.3481937 , -1.2305422 , -2.743876  ,  6.8526907 , -0.95355535,<br>        -0.47679362,  1.3641126 , -1.8595191 , -1.3984671 ,  1.5464842 ,<br>        -3.1406438 ,  0.7888262 ,  0.15678449,  0.37208068, -1.4461256 ,<br>         0.5904298 ]], dtype=float32), -1.56729]<br></code></pre></td></tr></table></figure><h3 id="Homework">Homework</h3><p>å°è¯•ç€ç”¨Ridge Regressionï¼ˆå²­å›å½’ï¼‰è§£å†³ä¸€ä¸ªçº¿æ€§å›å½’é—®é¢˜ï¼Œå…³äºRidge Regression, å¯ä»¥å‚è€ƒç½‘å€ï¼š<a href="https://blog.csdn.net/u012102306/article/details/52988660">https://blog.csdn.net/u012102306/article/details/52988660</a></p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tensorflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šæ–‡æ²»æ—¶ä»£ï¼šäº”ä»£åå›½ã€ä¸¤å®‹ã€‹æ‘˜æŠ„</title>
    <link href="/2023/08/13/%E3%80%8A%E6%96%87%E6%B2%BB%E6%97%B6%E4%BB%A3%EF%BC%9A%E4%BA%94%E4%BB%A3%E5%8D%81%E5%9B%BD%E3%80%81%E4%B8%A4%E5%AE%8B%E3%80%8B%E6%91%98%E6%8A%84/"/>
    <url>/2023/08/13/%E3%80%8A%E6%96%87%E6%B2%BB%E6%97%B6%E4%BB%A3%EF%BC%9A%E4%BA%94%E4%BB%A3%E5%8D%81%E5%9B%BD%E3%80%81%E4%B8%A4%E5%AE%8B%E3%80%8B%E6%91%98%E6%8A%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šæ–‡æ²»æ—¶ä»£ï¼šäº”ä»£åå›½ã€ä¸¤å®‹ã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šæ–‡æ²»æ—¶ä»£ï¼šäº”ä»£åå›½ã€ä¸¤å®‹ã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šåœ¨å·¥ä½œä¸­ï¼Œçœ‹åˆ°ä¸­å›½ã€‹æ‘˜æŠ„</title>
    <link href="/2023/08/13/%E3%80%8A%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%EF%BC%8C%E7%9C%8B%E5%88%B0%E4%B8%AD%E5%9B%BD%E3%80%8B%E6%91%98%E6%8A%84/"/>
    <url>/2023/08/13/%E3%80%8A%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%EF%BC%8C%E7%9C%8B%E5%88%B0%E4%B8%AD%E5%9B%BD%E3%80%8B%E6%91%98%E6%8A%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šåœ¨å·¥ä½œä¸­ï¼Œçœ‹åˆ°ä¸­å›½ã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šåœ¨å·¥ä½œä¸­ï¼Œçœ‹åˆ°ä¸­å›½ã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åäº”ï¼‰LangChainä¸­çš„é‡è¿ï¼ˆretryï¼‰æœºåˆ¶</title>
    <link href="/2023/08/09/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%BA%94%EF%BC%89LangChain%E4%B8%AD%E7%9A%84%E9%87%8D%E8%BF%9E%EF%BC%88retry%EF%BC%89%E6%9C%BA%E5%88%B6/"/>
    <url>/2023/08/09/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%BA%94%EF%BC%89LangChain%E4%B8%AD%E7%9A%84%E9%87%8D%E8%BF%9E%EF%BC%88retry%EF%BC%89%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å…³äºLangChainå…¥é—¨ï¼Œè¯»è€…å¯å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E5%85%AD%EF%BC%89LangChain%E5%85%A5%E9%97%A8/">NLPï¼ˆäº”åå…­ï¼‰LangChainå…¥é—¨</a>ã€‚</p><p>æœ¬æ–‡å°†ä¼šä»‹ç»LangChainä¸­çš„é‡è¿æœºåˆ¶ï¼Œå¹¶å°è¯•ç»™å‡ºå®šåˆ¶åŒ–é‡è¿æ–¹æ¡ˆã€‚</p><p>æœ¬æ–‡ä»¥LangChainä¸­çš„å¯¹è¯åŠŸèƒ½ï¼ˆ<code>ChatOpenAI</code>ï¼‰ä¸ºä¾‹ã€‚</p><h3 id="langchainä¸­çš„é‡è¿æœºåˆ¶">LangChainä¸­çš„é‡è¿æœºåˆ¶</h3><p>æŸ¥çœ‹LangChainä¸­å¯¹è¯åŠŸèƒ½ï¼ˆ<code>ChatOpenAI</code>ï¼‰çš„é‡è¿æœºåˆ¶ï¼ˆretryï¼‰ï¼Œå…¶æºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatOpenAI</span>(<span class="hljs-title class_ inherited__">BaseChatModel</span>):<br>...<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_retry_decorator</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Callable</span>[[<span class="hljs-type">Any</span>], <span class="hljs-type">Any</span>]:<br>        <span class="hljs-keyword">import</span> openai<br><br>        min_seconds = <span class="hljs-number">1</span><br>        max_seconds = <span class="hljs-number">60</span><br>        <span class="hljs-comment"># Wait 2^x * 1 second between each retry starting with</span><br>        <span class="hljs-comment"># 4 seconds, then up to 10 seconds, then 10 seconds afterwards</span><br>        <span class="hljs-keyword">return</span> retry(<br>            reraise=<span class="hljs-literal">True</span>,<br>            stop=stop_after_attempt(self.max_retries),<br>            wait=wait_exponential(multiplier=<span class="hljs-number">1</span>, <span class="hljs-built_in">min</span>=min_seconds, <span class="hljs-built_in">max</span>=max_seconds),<br>            retry=(<br>                retry_if_exception_type(openai.error.Timeout)<br>                | retry_if_exception_type(openai.error.APIError)<br>                | retry_if_exception_type(openai.error.APIConnectionError)<br>                | retry_if_exception_type(openai.error.RateLimitError)<br>                | retry_if_exception_type(openai.error.ServiceUnavailableError)<br>            ),<br>            before_sleep=before_sleep_log(logger, logging.WARNING),<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">completion_with_retry</span>(<span class="hljs-params">self, **kwargs: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;Use tenacity to retry the completion call.&quot;&quot;&quot;</span><br>        retry_decorator = self._create_retry_decorator()<br><br><span class="hljs-meta">        @retry_decorator</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">_completion_with_retry</span>(<span class="hljs-params">**kwargs: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>            <span class="hljs-keyword">return</span> self.client.create(**kwargs)<br><br>        <span class="hljs-keyword">return</span> _completion_with_retry(**kwargs)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶ç¼–ç æ–¹å¼ä¸ºç¡¬ç¼–ç ï¼ˆhardcoreï¼‰ï¼Œé‡‡ç”¨<code>tenacity</code>æ¨¡å—å®ç°é‡è¿æœºåˆ¶ï¼Œå¯¹äºæ”¯æŒçš„æŠ¥é”™æƒ…å½¢ï¼Œæ¯”å¦‚<code>openai.error.Timeout,  openai.error.APIError</code>ç­‰ï¼Œä¼šå°è¯•é‡è¿ï¼Œæœ€å°ç­‰å¾…æ—¶é—´ä¸º1sï¼Œæœ€å¤§ç­‰å¾…æ—¶é—´ä¸º60sï¼Œæ¯æ¬¡é‡è¿ç­‰å¾…æ—¶é—´ä¼šä¹˜ä»¥2ã€‚</p><h3 id="ç®€å•é‡è¿">ç®€å•é‡è¿</h3><p>æˆ‘ä»¬å°è¯•ç”¨ä¸€ä¸ªé”™è¯¯çš„OpenAI keyè¿›è¡Œå¯¹è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> ChatOpenAI<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_bot</span>(<span class="hljs-params">input_text: <span class="hljs-built_in">str</span></span>):<br>    llm = ChatOpenAI(temperature=<span class="hljs-number">0</span>,<br>                     model_name=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>,<br>                     openai_api_key=<span class="hljs-string">&quot;sk-xxx&quot;</span>,<br>                     max_retries=<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">return</span> llm.predict(input_text)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    text = <span class="hljs-string">&#x27;ä¸­å›½çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ&#x27;</span><br>    <span class="hljs-built_in">print</span>(chat_bot(text))<br></code></pre></td></tr></table></figure><p>å°½ç®¡æˆ‘ä»¬åœ¨ä»£ç ä¸­è®¾ç½®äº†é‡è¿æœ€å¤§æ¬¡æ•°ï¼ˆ<code>max_retries</code>ï¼‰ï¼Œä»£ç è¿è¡Œæ—¶ä¼šç›´æ¥æŠ¥é”™ï¼Œä¸ä¼šé‡è¿ï¼ŒåŸå› æ˜¯LangChainä¸­çš„å¯¹è¯åŠŸèƒ½é‡è¿æœºåˆ¶æ²¡æœ‰æ”¯æŒ<code>openai.error.AuthenticationError</code>ã€‚è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">openai.error.AuthenticationError: Incorrect API key provided: sk-xxx. You can find your API key at https://platform.openai.com/account/api-keys.<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°è¯•åœ¨æºä»£ç çš„åŸºç¡€ä¸Šåšç®€å•çš„å®šåˆ¶ï¼Œä½¿å¾—å…¶æ”¯æŒ<code>openai.error.AuthenticationError</code>é”™è¯¯ç±»å‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Callable</span>, <span class="hljs-type">Any</span><br><span class="hljs-keyword">from</span> tenacity <span class="hljs-keyword">import</span> (<br>    before_sleep_log,<br>    retry,<br>    retry_if_exception_type,<br>    stop_after_attempt,<br>    wait_exponential,<br>)<br><span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> ChatOpenAI<br><span class="hljs-keyword">import</span> logging<br><br><br>logger = logging.getLogger(__name__)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyChatOpenAI</span>(<span class="hljs-title class_ inherited__">ChatOpenAI</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_retry_decorator</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Callable</span>[[<span class="hljs-type">Any</span>], <span class="hljs-type">Any</span>]:<br>        min_seconds = <span class="hljs-number">1</span><br>        max_seconds = <span class="hljs-number">60</span><br>        <span class="hljs-comment"># Wait 2^x * 1 second between each retry starting with</span><br>        <span class="hljs-comment"># 4 seconds, then up to 10 seconds, then 10 seconds after wards</span><br>        <span class="hljs-keyword">return</span> retry(<br>            reraise=<span class="hljs-literal">True</span>,<br>            stop=stop_after_attempt(self.max_retries),<br>            wait=wait_exponential(multiplier=<span class="hljs-number">1</span>, <span class="hljs-built_in">min</span>=min_seconds, <span class="hljs-built_in">max</span>=max_seconds),<br>            retry=(<br>                retry_if_exception_type(openai.error.Timeout)<br>                | retry_if_exception_type(openai.error.APIError)<br>                | retry_if_exception_type(openai.error.APIConnectionError)<br>                | retry_if_exception_type(openai.error.RateLimitError)<br>                | retry_if_exception_type(openai.error.ServiceUnavailableError)<br>                <span class="hljs-comment"># add new error</span><br>                | retry_if_exception_type(openai.error.AuthenticationError)<br>            ),<br>            before_sleep=before_sleep_log(logger, logging.WARNING),<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">completion_with_retry</span>(<span class="hljs-params">self, **kwargs: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;Use tenacity to retry the completion call.&quot;&quot;&quot;</span><br>        retry_decorator = self._create_retry_decorator()<br><br><span class="hljs-meta">        @retry_decorator</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">_completion_with_retry</span>(<span class="hljs-params">**kwargs: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>            <span class="hljs-keyword">return</span> self.client.create(**kwargs)<br><br>        <span class="hljs-keyword">return</span> _completion_with_retry(**kwargs)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_bot</span>(<span class="hljs-params">input_text: <span class="hljs-built_in">str</span></span>):<br>    llm = MyChatOpenAI(temperature=<span class="hljs-number">0</span>,<br>                       model_name=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>,<br>                       openai_api_key=<span class="hljs-string">&quot;sk-xxx&quot;</span>,<br>                       max_retries=<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">return</span> llm.predict(input_text)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    text = <span class="hljs-string">&#x27;ä¸­å›½çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ&#x27;</span><br>    <span class="hljs-built_in">print</span>(chat_bot(text))<br></code></pre></td></tr></table></figure><p>åˆ†æä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬åœ¨ç»§æ‰¿ChatOpenAIç±»çš„åŸºç¡€ä¸Šé‡æ–°åˆ›å»ºMyChatOpenAIç±»ï¼Œåœ¨_create_retry_decoratorä¸­çš„é‡è¿é”™è¯¯æƒ…å½¢ä¸­åŠ å…¥äº†<code>openai.error.AuthenticationError</code>é”™è¯¯ç±»å‹ï¼Œæ­¤æ—¶ä»£ç è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Retrying __main__.MyChatOpenAI.completion_with_retry.&lt;locals&gt;._completion_with_retry <span class="hljs-keyword">in</span> 1.0 seconds as it raised AuthenticationError: Incorrect API key provided: sk-xxx. You can find your API key at https://platform.openai.com/account/api-keys..<br>Retrying __main__.MyChatOpenAI.completion_with_retry.&lt;locals&gt;._completion_with_retry <span class="hljs-keyword">in</span> 2.0 seconds as it raised AuthenticationError: Incorrect API key provided: sk-xxx. You can find your API key at https://platform.openai.com/account/api-keys..<br>Retrying __main__.MyChatOpenAI.completion_with_retry.&lt;locals&gt;._completion_with_retry <span class="hljs-keyword">in</span> 4.0 seconds as it raised AuthenticationError: Incorrect API key provided: sk-xxx. You can find your API key at https://platform.openai.com/account/api-keys..<br>Retrying __main__.MyChatOpenAI.completion_with_retry.&lt;locals&gt;._completion_with_retry <span class="hljs-keyword">in</span> 8.0 seconds as it raised AuthenticationError: Incorrect API key provided: sk-xxx. You can find your API key at https://platform.openai.com/account/api-keys..<br>Traceback (most recent call last):<br>    ......<br>openai.error.AuthenticationError: Incorrect API key provided: sk-xxx. You can find your API key at https://platform.openai.com/account/api-keys.<br></code></pre></td></tr></table></figure><p>ä»è¾“å‡ºç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ä»£ç ç¡®å®å¯¹<code>openai.error.AuthenticationError</code>é”™è¯¯ç±»å‹è¿›è¡Œäº†é‡è¿ï¼ŒæŒ‰ç…§æºä»£ç çš„æ–¹å¼è¿›è¡Œé‡è¿ï¼Œä¸€å…±å°è¯•äº†5æ¬¡é‡è¿ï¼Œæ¯æ¬¡é‡è¿ç­‰å¾…æ—¶é—´æ˜¯ä¸Šä¸€æ¬¡çš„ä¸¤å€ã€‚</p><h3 id="å®šåˆ¶åŒ–é‡è¿">å®šåˆ¶åŒ–é‡è¿</h3><p>LangChainä¸­çš„é‡è¿æœºåˆ¶ä¹Ÿæ”¯æŒå®šåˆ¶åŒ–ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯ï¼šæŸä¸ªOpenAIkeyåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å¤±æ•ˆäº†ï¼Œé‚£ä¹ˆåœ¨é‡è¿æ—¶å¸Œæœ›èƒ½å¿«é€Ÿåˆ‡æ¢è‡³æŸä¸ªèƒ½æ­£å¸¸ä½¿ç”¨çš„OpenAIkeyï¼Œä»¥ä¸‹ä¸ºç¤ºä¾‹ä»£ç ï¼ˆä»…éœ€è¦ä¿®æ”¹<code>completion_with_retry</code>å‡½æ•°ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">completion_with_retry</span>(<span class="hljs-params">self, **kwargs: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;Use tenacity to retry the completion call.&quot;&quot;&quot;</span><br>    retry_decorator = self._create_retry_decorator()<br><br><span class="hljs-meta">    @retry_decorator</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_completion_with_retry</span>(<span class="hljs-params">**kwargs: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>    <span class="hljs-comment"># é‡è¿æœºåˆ¶å®šåˆ¶åŒ–(custom retry)</span><br>        kwargs[<span class="hljs-string">&#x27;api_key&#x27;</span>] = <span class="hljs-string">&#x27;right openai key&#x27;</span><br>        <span class="hljs-keyword">return</span> self.client.create(**kwargs)<br><br>    <span class="hljs-keyword">return</span> _completion_with_retry(**kwargs)<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å°±èƒ½è¿›è¡Œæ­£å¸¸çš„å¯¹è¯åŠŸèƒ½äº†ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†LangChainä¸­çš„é‡è¿æœºåˆ¶ï¼Œå¹¶å°è¯•ç»™å‡ºå®šåˆ¶åŒ–é‡è¿æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©ã€‚</p><p>ç¬”è€…çš„ä¸ªäººåšå®¢ç½‘å€ä¸ºï¼š<ahref="https://percent4.github.io/">https://percent4.github.io/</a>,æ¬¢è¿å¤§å®¶è®¿é—®~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>LangChain</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åå››ï¼‰ä½¿ç”¨FastChatè®¡ç®—LLaMA-2æ¨¡å‹çš„tokené•¿åº¦</title>
    <link href="/2023/08/08/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8FastChat%E8%AE%A1%E7%AE%97LLaMA-2%E6%A8%A1%E5%9E%8B%E7%9A%84token%E9%95%BF%E5%BA%A6/"/>
    <url>/2023/08/08/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8FastChat%E8%AE%A1%E7%AE%97LLaMA-2%E6%A8%A1%E5%9E%8B%E7%9A%84token%E9%95%BF%E5%BA%A6/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="llama-2æ¨¡å‹éƒ¨ç½²">LLaMA-2æ¨¡å‹éƒ¨ç½²</h3><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/11/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8FastChat%E9%83%A8%E7%BD%B2%E7%99%BE%E5%B7%9D%E5%A4%A7%E6%A8%A1%E5%9E%8B/">NLPï¼ˆäº”åä¹ï¼‰ä½¿ç”¨FastChatéƒ¨ç½²ç™¾å·å¤§æ¨¡å‹</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†<code>FastChat</code>æ¡†æ¶ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨<code>FastChat</code>æ¥éƒ¨ç½²ç™¾å·æ¨¡å‹ã€‚</p><p>æœ¬æ–‡å°†ä¼šéƒ¨ç½²LLaMA-270Bæ¨¡å‹ï¼Œä½¿å¾—å…¶å…¼å®¹OpenAIçš„è°ƒç”¨é£æ ¼ã€‚éƒ¨ç½²çš„<code>Dockerfile</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">FROM</span> <span class="hljs-string">nvidia/cuda:11.7.1-runtime-ubuntu20.04</span><br><br><span class="hljs-string">RUN</span> <span class="hljs-string">apt-get</span> <span class="hljs-string">update</span> <span class="hljs-string">-y</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">apt-get</span> <span class="hljs-string">install</span> <span class="hljs-string">-y</span> <span class="hljs-string">python3.9</span> <span class="hljs-string">python3.9-distutils</span> <span class="hljs-string">curl</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">curl</span> <span class="hljs-string">https://bootstrap.pypa.io/get-pip.py</span> <span class="hljs-string">-o</span> <span class="hljs-string">get-pip.py</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">python3.9</span> <span class="hljs-string">get-pip.py</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">pip3</span> <span class="hljs-string">install</span> <span class="hljs-string">fschat</span><br></code></pre></td></tr></table></figure><p><code>Docker-compose.yml</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.9&quot;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">fastchat-controller:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">fastchat:latest</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;21001:21001&quot;</span><br>    <span class="hljs-attr">entrypoint:</span> [<span class="hljs-string">&quot;python3.9&quot;</span>, <span class="hljs-string">&quot;-m&quot;</span>, <span class="hljs-string">&quot;fastchat.serve.controller&quot;</span>, <span class="hljs-string">&quot;--host&quot;</span>, <span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-string">&quot;--port&quot;</span>, <span class="hljs-string">&quot;21001&quot;</span>]<br><br>  <span class="hljs-attr">fastchat-model-worker:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./model:/root/model</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">fastchat:latest</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;21002:21002&quot;</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">resources:</span><br>        <span class="hljs-attr">reservations:</span><br>          <span class="hljs-attr">devices:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">driver:</span> <span class="hljs-string">nvidia</span><br>              <span class="hljs-attr">device_ids:</span> [<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>]<br>              <span class="hljs-attr">capabilities:</span> [<span class="hljs-string">gpu</span>]<br>    <span class="hljs-attr">entrypoint:</span> [<span class="hljs-string">&quot;python3.9&quot;</span>, <span class="hljs-string">&quot;-m&quot;</span>, <span class="hljs-string">&quot;fastchat.serve.model_worker&quot;</span>, <span class="hljs-string">&quot;--model-names&quot;</span>, <span class="hljs-string">&quot;llama2-70b-chat&quot;</span>, <span class="hljs-string">&quot;--model-path&quot;</span>, <span class="hljs-string">&quot;/root/model/llama2/Llama-2-70b-chat-hf&quot;</span>, <span class="hljs-string">&quot;--num-gpus&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;--gpus&quot;</span>,  <span class="hljs-string">&quot;0,1&quot;</span>, <span class="hljs-string">&quot;--worker-address&quot;</span>, <span class="hljs-string">&quot;http://fastchat-model-worker:21002&quot;</span>, <span class="hljs-string">&quot;--controller-address&quot;</span>, <span class="hljs-string">&quot;http://fastchat-controller:21001&quot;</span>, <span class="hljs-string">&quot;--host&quot;</span>, <span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-string">&quot;--port&quot;</span>, <span class="hljs-string">&quot;21002&quot;</span>]<br><br>  <span class="hljs-attr">fastchat-api-server:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">fastchat:latest</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8000:8000&quot;</span><br>    <span class="hljs-attr">entrypoint:</span> [<span class="hljs-string">&quot;python3.9&quot;</span>, <span class="hljs-string">&quot;-m&quot;</span>, <span class="hljs-string">&quot;fastchat.serve.openai_api_server&quot;</span>, <span class="hljs-string">&quot;--controller-address&quot;</span>, <span class="hljs-string">&quot;http://fastchat-controller:21001&quot;</span>, <span class="hljs-string">&quot;--host&quot;</span>, <span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-string">&quot;--port&quot;</span>, <span class="hljs-string">&quot;8000&quot;</span>]<br></code></pre></td></tr></table></figure><p>éƒ¨ç½²æˆåŠŸåï¼Œä¼šå ç”¨2å¼ A100ï¼Œæ¯å¼ A100å ç”¨çº¦66Gæ˜¾å­˜ã€‚</p><p>æµ‹è¯•æ¨¡å‹æ˜¯å¦éƒ¨ç½²æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://localhost:8000/v1/models<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;list&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;llama2-70b-chat&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;model&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1691504717</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;owned_by&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;fastchat&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;llama2-70b-chat&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;permission&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;modelperm-3XG6nzMAqfEkwfNqQ52fdv&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;model_permission&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1691504717</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_create_engine&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_sampling&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_logprobs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_search_indices&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_view&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_fine_tuning&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;organization&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;*&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;is_blocking&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>éƒ¨ç½²LLaMA-2 70Bæ¨¡å‹æˆåŠŸï¼</p><h3 id="prompt-tokené•¿åº¦è®¡ç®—">Prompt tokené•¿åº¦è®¡ç®—</h3><p>åœ¨<code>FastChat</code>çš„Githubå¼€æºé¡¹ç›®ä¸­ï¼Œé¡¹ç›®æä¾›äº†è®¡ç®—Promptçš„tokené•¿åº¦çš„APIï¼Œæ–‡ä»¶è·¯å¾„ä¸ºï¼šfastchat/serve/model_worker.pyï¼Œè°ƒç”¨æ–¹æ³•ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs curl">curl --location &#x27;localhost:21002/count_token&#x27; \<br>--header &#x27;Content-Type: application/json&#x27; \<br>--data &#x27;&#123;&quot;prompt&quot;: &quot;What is your name?&quot;&#125;&#x27;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;error_code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="conversation-tokené•¿åº¦è®¡ç®—">Conversation tokené•¿åº¦è®¡ç®—</h3><p>åœ¨<code>FastChat</code>ä¸­è®¡ç®—Conversationï¼ˆå¯¹è¯ï¼‰çš„tokené•¿åº¦è¾ƒä¸ºéº»çƒ¦ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è·å–LLaMA-270Bæ¨¡å‹çš„<code>å¯¹è¯é…ç½®</code>ï¼Œè°ƒç”¨APIå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --location --request POST <span class="hljs-string">&#x27;http://localhost:21002/worker_get_conv_template&#x27;</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>&#x27;conv&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>&#x27;messages&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>          &#x27;name&#x27;<span class="hljs-punctuation">:</span> &#x27;llama<span class="hljs-number">-2</span>&#x27;<span class="hljs-punctuation">,</span><br>          &#x27;offset&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>          &#x27;roles&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>&#x27;<span class="hljs-punctuation">[</span>INST<span class="hljs-punctuation">]</span>&#x27;<span class="hljs-punctuation">,</span> &#x27;<span class="hljs-punctuation">[</span>/INST<span class="hljs-punctuation">]</span>&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>          &#x27;sep&#x27;<span class="hljs-punctuation">:</span> &#x27; &#x27;<span class="hljs-punctuation">,</span><br>          &#x27;sep2&#x27;<span class="hljs-punctuation">:</span> &#x27; &lt;/s&gt;&lt;s&gt;&#x27;<span class="hljs-punctuation">,</span><br>          &#x27;sep_style&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>          &#x27;stop_str&#x27;<span class="hljs-punctuation">:</span> None<span class="hljs-punctuation">,</span><br>          &#x27;stop_token_ids&#x27;<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>          &#x27;system_message&#x27;<span class="hljs-punctuation">:</span> &#x27;You are a helpful<span class="hljs-punctuation">,</span> respectful and honest &#x27;<br>                            &#x27;assistant. Always answer as helpfully as &#x27;<br>                            &#x27;possible<span class="hljs-punctuation">,</span> while being safe. Your answers should &#x27;<br>                            &#x27;not include any harmful<span class="hljs-punctuation">,</span> unethical<span class="hljs-punctuation">,</span> racist<span class="hljs-punctuation">,</span> &#x27;<br>                            &#x27;sexist<span class="hljs-punctuation">,</span> toxic<span class="hljs-punctuation">,</span> dangerous<span class="hljs-punctuation">,</span> or illegal content. &#x27;<br>                            &#x27;Please ensure that your responses are socially &#x27;<br>                            &#x27;unbiased and positive in nature.\n&#x27;<br>                            &#x27;\n&#x27;<br>                            &#x27;If a question does not make any sense<span class="hljs-punctuation">,</span> or is not &#x27;<br>                            &#x27;factually coherent<span class="hljs-punctuation">,</span> explain why instead of &#x27;<br>                            <span class="hljs-string">&quot;answering something not correct. If you don&#x27;t &quot;</span><br>                            <span class="hljs-string">&quot;know the answer to a question, please don&#x27;t share &quot;</span><br>                            &#x27;<span class="hljs-literal"><span class="hljs-keyword">false</span></span> information.&#x27;<span class="hljs-punctuation">,</span><br>          &#x27;system_template&#x27;<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-punctuation">[</span>INST<span class="hljs-punctuation">]</span> &lt;&lt;SYS&gt;&gt;\n<span class="hljs-punctuation">&#123;</span>system_message<span class="hljs-punctuation">&#125;</span>\n&lt;&lt;/SYS&gt;&gt;\n\n&#x27;<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>FastChat</code>ä¸­çš„å¯¹è¯æ–‡ä»¶ï¼ˆfastchat/conversation.pyï¼‰ä¸­ï¼Œæä¾›äº†å¯¹è¯åŠ å·¥çš„ä»£ç ï¼Œè¿™é‡Œä¸å†å±•ç¤ºï¼Œä½¿ç”¨æ—¶ç›´æ¥å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å³å¯ï¼Œè¯¥æ–‡ä»¶ä¸ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚</p><p>æˆ‘ä»¬éœ€è¦å°†å¯¹è¯æŒ‰ç…§OpenAIçš„æ–¹å¼åŠ å·¥æˆå¯¹åº”çš„Promptï¼Œè¾“å…¥çš„å¯¹è¯ï¼ˆmessagesï¼‰å¦‚ä¸‹ï¼š</p><blockquote><p>messages = [{"role": "system", "content": "You are Jack, you are 20years old, answer questions with humor."}, {"role": "user", "content":"What is your name?"},{"role": "assistant", "content": " Well, well,well! Look who's asking the questions now! My name is Jack, but you cancall me the king of the castle, the lord of the rings, or the prince ofthe pizza party. Whatever floats your boat, my friend!"}, {"role":"user", "content": "How old are you?"}, {"role": "assistant", "content":" Oh, you want to know my age? Well, let's just say I'm older than abottle of wine but younger than a bottle of whiskey. I'm like a finecheese, getting better with age, but still young enough to party likeit's 1999!"}, {"role": "user", "content": "Where is yourhometown?"}]</p></blockquote><p>Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @place: Pudong, Shanghai </span><br><span class="hljs-comment"># @file: prompt.py</span><br><span class="hljs-comment"># @time: 2023/8/8 19:24</span><br><span class="hljs-keyword">from</span> conversation <span class="hljs-keyword">import</span> Conversation, SeparatorStyle<br><br>messages = [&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;You are Jack, you are 20 years old, answer questions with humor.&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;What is your name?&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot; Well, well, well! Look who&#x27;s asking the questions now! My name is Jack, but you can call me the king of the castle, the lord of the rings, or the prince of the pizza party. Whatever floats your boat, my friend!&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;How old are you?&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot; Oh, you want to know my age? Well, let&#x27;s just say I&#x27;m older than a bottle of wine but younger than a bottle of whiskey. I&#x27;m like a fine cheese, getting better with age, but still young enough to party like it&#x27;s 1999!&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Where is your hometown?&quot;</span>&#125;]<br><br>llama2_conv = &#123;<span class="hljs-string">&quot;conv&quot;</span>:&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;llama-2&quot;</span>,<span class="hljs-string">&quot;system_template&quot;</span>:<span class="hljs-string">&quot;[INST] &lt;&lt;SYS&gt;&gt;\n&#123;system_message&#125;\n&lt;&lt;/SYS&gt;&gt;\n\n&quot;</span>,<span class="hljs-string">&quot;system_message&quot;</span>:<span class="hljs-string">&quot;You are a helpful, respectful and honest assistant. Always answer as helpfully as possible, while being safe. Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content. Please ensure that your responses are socially unbiased and positive in nature.\n\nIf a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don&#x27;t know the answer to a question, please don&#x27;t share false information.&quot;</span>,<span class="hljs-string">&quot;roles&quot;</span>:[<span class="hljs-string">&quot;[INST]&quot;</span>,<span class="hljs-string">&quot;[/INST]&quot;</span>],<span class="hljs-string">&quot;messages&quot;</span>:[],<span class="hljs-string">&quot;offset&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;sep_style&quot;</span>:<span class="hljs-number">7</span>,<span class="hljs-string">&quot;sep&quot;</span>:<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;sep2&quot;</span>:<span class="hljs-string">&quot; &lt;/s&gt;&lt;s&gt;&quot;</span>,<span class="hljs-string">&quot;stop_str&quot;</span>:<span class="hljs-literal">None</span>,<span class="hljs-string">&quot;stop_token_ids&quot;</span>:[<span class="hljs-number">2</span>]&#125;&#125;<br>conv = llama2_conv[<span class="hljs-string">&#x27;conv&#x27;</span>]<br><br>conv = Conversation(<br>        name=conv[<span class="hljs-string">&quot;name&quot;</span>],<br>        system_template=conv[<span class="hljs-string">&quot;system_template&quot;</span>],<br>        system_message=conv[<span class="hljs-string">&quot;system_message&quot;</span>],<br>        roles=conv[<span class="hljs-string">&quot;roles&quot;</span>],<br>        messages=<span class="hljs-built_in">list</span>(conv[<span class="hljs-string">&quot;messages&quot;</span>]),  <span class="hljs-comment"># prevent in-place modification</span><br>        offset=conv[<span class="hljs-string">&quot;offset&quot;</span>],<br>        sep_style=SeparatorStyle(conv[<span class="hljs-string">&quot;sep_style&quot;</span>]),<br>        sep=conv[<span class="hljs-string">&quot;sep&quot;</span>],<br>        sep2=conv[<span class="hljs-string">&quot;sep2&quot;</span>],<br>        stop_str=conv[<span class="hljs-string">&quot;stop_str&quot;</span>],<br>        stop_token_ids=conv[<span class="hljs-string">&quot;stop_token_ids&quot;</span>],<br>    )<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(messages, <span class="hljs-built_in">str</span>):<br>    prompt = messages<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> messages:<br>        msg_role = message[<span class="hljs-string">&quot;role&quot;</span>]<br>        <span class="hljs-keyword">if</span> msg_role == <span class="hljs-string">&quot;system&quot;</span>:<br>            conv.set_system_message(message[<span class="hljs-string">&quot;content&quot;</span>])<br>        <span class="hljs-keyword">elif</span> msg_role == <span class="hljs-string">&quot;user&quot;</span>:<br>            conv.append_message(conv.roles[<span class="hljs-number">0</span>], message[<span class="hljs-string">&quot;content&quot;</span>])<br>        <span class="hljs-keyword">elif</span> msg_role == <span class="hljs-string">&quot;assistant&quot;</span>:<br>            conv.append_message(conv.roles[<span class="hljs-number">1</span>], message[<span class="hljs-string">&quot;content&quot;</span>])<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;Unknown role: <span class="hljs-subst">&#123;msg_role&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># Add a blank message for the assistant.</span><br>    conv.append_message(conv.roles[<span class="hljs-number">1</span>], <span class="hljs-literal">None</span>)<br>    prompt = conv.get_prompt()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">repr</span>(prompt))<br></code></pre></td></tr></table></figure><p>åŠ å·¥åçš„Promptå¦‚ä¸‹ï¼š</p><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk"><span class="hljs-comment">&quot;[INST] &lt;&lt;SYS&gt;&gt;\nYou are Jack, you are 20 years old, answer questions with humor.\n&lt;&lt;/SYS&gt;&gt;\n\nWhat is your name?[/INST]  Well, well, well! Look who&#x27;s asking the questions now! My name is Jack, but you can call me the king of the castle, the lord of the rings, or the prince of the pizza party. Whatever floats your boat, my friend! &lt;/s&gt;&lt;s&gt;[INST] How old are you? [/INST]  Oh, you want to know my age? Well, let&#x27;s just say I&#x27;m older than a bottle of wine but younger than a bottle of whiskey. I&#x27;m like a fine cheese, getting better with age, but still young enough to party like it&#x27;s 1999! &lt;/s&gt;&lt;s&gt;[INST] Where is your hometown? [/INST]&quot;</span><br></code></pre></td></tr></table></figure><p>æœ€åå†è°ƒç”¨è®¡ç®—Promptçš„APIï¼ˆå‚è€ƒä¸ŠèŠ‚çš„Prompttokené•¿åº¦è®¡ç®—ï¼‰ï¼Œè¾“å‡ºè¯¥å¯¹è¯çš„tokené•¿åº¦ä¸º199.</p><p>æˆ‘ä»¬ä½¿ç”¨<code>FastChat</code>æä¾›çš„å¯¹è¯è¡¥å……æ¥å£ï¼ˆv1/chat/completionsï¼‰<code>éªŒè¯</code>è¾“å…¥çš„å¯¹è¯tokené•¿åº¦ï¼Œè¯·æ±‚å‘½ä»¤ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --location <span class="hljs-string">&#x27;http://localhost:8000/v1/chat/completions&#x27;</span> \<br>--header <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> \<br>--data <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    &quot;model&quot;: &quot;llama2-70b-chat&quot;,</span><br><span class="hljs-string">    &quot;messages&quot;: [&#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are Jack, you are 20 years old, answer questions with humor.&quot;&#125;, &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;What is your name?&quot;&#125;,&#123;&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot; Well, well, well! Look who&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>s asking the questions now! My name is Jack, but you can call me the king of the castle, the lord of the rings, or the prince of the pizza party. Whatever floats your boat, my friend!<span class="hljs-string">&quot;&#125;, &#123;&quot;</span>role<span class="hljs-string">&quot;: &quot;</span>user<span class="hljs-string">&quot;, &quot;</span>content<span class="hljs-string">&quot;: &quot;</span>How old are you?<span class="hljs-string">&quot;&#125;, &#123;&quot;</span>role<span class="hljs-string">&quot;: &quot;</span>assistant<span class="hljs-string">&quot;, &quot;</span>content<span class="hljs-string">&quot;: &quot;</span> Oh, you want to know my age? Well, <span class="hljs-built_in">let</span><span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27;s just say I&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>m older than a bottle of wine but younger than a bottle of whiskey. I<span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27;m like a fine cheese, getting better with age, but still young enough to party like it&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>s 1999!<span class="hljs-string">&quot;&#125;, &#123;&quot;</span>role<span class="hljs-string">&quot;: &quot;</span>user<span class="hljs-string">&quot;, &quot;</span>content<span class="hljs-string">&quot;: &quot;</span>Where is your hometown?<span class="hljs-string">&quot;&#125;]</span><br><span class="hljs-string">&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chatcmpl-mQxcaQcNSNMFahyHS7pamA&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chat.completion&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1691506768</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;llama2-70b-chat&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;choices&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assistant&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot; Ha! My hometown? Well, that&#x27;s a tough one. I&#x27;m like a bird, I don&#x27;t have a nest, I just fly around and land wherever the wind takes me. But if you really want to know, I&#x27;m from a place called \&quot;The Internet\&quot;. It&#x27;s a magical land where memes and cat videos roam free, and the Wi-Fi is always strong. It&#x27;s a beautiful place, you should visit sometime!&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;finish_reason&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stop&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;usage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;prompt_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">199</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;total_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">302</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;completion_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">103</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¾“å‡ºçš„prompt_tokensä¸º199ï¼Œè¿™ä¸æˆ‘ä»¬åˆšæ‰è®¡ç®—çš„å¯¹è¯tokené•¿åº¦çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨FastChatä¸­éƒ¨ç½²LLaMA-2 70Bæ¨¡å‹ï¼Œå¹¶è¯¦ç»†ä»‹ç»äº†Prompttokené•¿åº¦è®¡ç®—ä»¥åŠå¯¹è¯ï¼ˆconversationï¼‰çš„tokené•¿åº¦è®¡ç®—ã€‚å¸Œæœ›èƒ½å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©~</p><p>ç¬”è€…çš„ä¸€ç‚¹å¿ƒå¾—æ˜¯ï¼šé˜…è¯»æºç çœŸçš„å¾ˆé‡è¦ã€‚</p><p>ç¬”è€…çš„ä¸ªäººåšå®¢ç½‘å€ä¸ºï¼š<ahref="https://percent4.github.io/">https://percent4.github.io/</a>,æ¬¢è¿å¤§å®¶è®¿é—®~</p><h3 id="å‚è€ƒç½‘å€">å‚è€ƒç½‘å€</h3><ol type="1"><li><p>NLPï¼ˆäº”åä¹ï¼‰ä½¿ç”¨FastChatéƒ¨ç½²ç™¾å·å¤§æ¨¡å‹: <ahref="https://percent4.github.io/2023/07/11/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8FastChat%E9%83%A8%E7%BD%B2%E7%99%BE%E5%B7%9D%E5%A4%A7%E6%A8%A1%E5%9E%8B/">https://blog.csdn.net/jclian91/article/details/131650918</a></p></li><li><p>FastChat: <ahref="https://github.com/lm-sys/FastChat">https://github.com/lm-sys/FastChat</a></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>AIGC</tag>
      
      <tag>FastChat</tag>
      
      <tag>LLaMA-2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keraså…¥é—¨ï¼ˆå…«ï¼‰KæŠ˜äº¤å‰éªŒè¯</title>
    <link href="/2023/08/08/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89K%E6%8A%98%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81/"/>
    <url>/2023/08/08/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89K%E6%8A%98%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88DNN%EF%BC%89%E8%A7%A3%E5%86%B3%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/">Keraså…¥é—¨ï¼ˆä¸€ï¼‰æ­å»ºæ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰è§£å†³å¤šåˆ†ç±»é—®é¢˜</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†å¦‚ä½•æ­å»ºDNNæ¨¡å‹æ¥è§£å†³IRISæ•°æ®é›†çš„å¤šåˆ†ç±»é—®é¢˜ã€‚</p><p>æœ¬æ–‡å°†åœ¨æ­¤åŸºç¡€ä¸Šä»‹ç»å¦‚ä½•åœ¨Kerasä¸­å®ç°KæŠ˜äº¤å‰éªŒè¯ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯kæŠ˜äº¤å‰éªŒè¯">ä»€ä¹ˆæ˜¯KæŠ˜äº¤å‰éªŒè¯ï¼Ÿ</h3><p>KæŠ˜äº¤å‰éªŒè¯æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ä¸ªä¸“ä¸šæœ¯è¯­ï¼Œå®ƒæŒ‡çš„æ˜¯å°†åŸå§‹æ•°æ®éšæœºåˆ†æˆKä»½ï¼Œæ¯æ¬¡é€‰æ‹©K-1ä»½ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä½™çš„1ä»½ä½œä¸ºæµ‹è¯•é›†ã€‚äº¤å‰éªŒè¯é‡å¤Kæ¬¡ï¼Œå–Kæ¬¡å‡†ç¡®ç‡çš„å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆæ¨¡å‹çš„è¯„ä»·æŒ‡æ ‡ã€‚ä¸€èˆ¬å–K=10ï¼Œå³10æŠ˜äº¤å‰éªŒè¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="/img/keras8_1.png" alt="10æŠ˜äº¤å‰éªŒè¯" /><figcaption aria-hidden="true">10æŠ˜äº¤å‰éªŒè¯</figcaption></figure><p>ç”¨äº¤å‰éªŒè¯çš„ç›®çš„æ˜¯ä¸ºäº†å¾—åˆ°å¯é ç¨³å®šçš„æ¨¡å‹ã€‚KæŠ˜äº¤å‰éªŒè¯èƒ½å¤Ÿæœ‰æ•ˆæé«˜æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›ï¼Œç±»ä¼¼äºå¢åŠ äº†è®­ç»ƒæ ·æœ¬æ•°é‡ï¼Œä½¿å¾—å­¦ä¹ çš„æ¨¡å‹æ›´åŠ ç¨³å¥ï¼Œé²æ£’æ€§æ›´å¼ºã€‚é€‰æ‹©åˆé€‚çš„Kå€¼èƒ½å¤Ÿæœ‰æ•ˆé¿å…è¿‡æ‹Ÿåˆã€‚</p><h3 id="keraså®ç°kæŠ˜äº¤å‰éªŒè¯">Keraså®ç°KæŠ˜äº¤å‰éªŒè¯</h3><p>æˆ‘ä»¬ä»é‡‡ç”¨æ–‡ç« <ahref="https://percent4.github.io/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88DNN%EF%BC%89%E8%A7%A3%E5%86%B3%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/">Keraså…¥é—¨ï¼ˆä¸€ï¼‰æ­å»ºæ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰è§£å†³å¤šåˆ†ç±»é—®é¢˜</a>ä¸­çš„æ¨¡å‹ï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="/img/keras8_2.png" alt="DNNæ¨¡å‹ç»“æ„å›¾" /><figcaption aria-hidden="true">DNNæ¨¡å‹ç»“æ„å›¾</figcaption></figure><p>åŒæ—¶ï¼Œæˆ‘ä»¬å¯¹IRISæ•°æ®é›†é‡‡ç”¨10æŠ˜äº¤å‰éªŒè¯ï¼Œå®Œæ•´çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># model_train.py</span><br><span class="hljs-comment"># Python 3.6.8, TensorFlow 2.3.0, Keras 2.4.3</span><br><span class="hljs-comment"># å¯¼å…¥æ¨¡å—</span><br><span class="hljs-keyword">import</span> keras <span class="hljs-keyword">as</span> K<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> KFold<br><br><br><span class="hljs-comment"># è¯»å–CSVæ•°æ®é›†</span><br><span class="hljs-comment"># è¯¥å‡½æ•°çš„ä¼ å…¥å‚æ•°ä¸ºcsv_file_path: csvæ–‡ä»¶è·¯å¾„</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>(<span class="hljs-params">sv_file_path</span>):<br>    iris = pd.read_csv(sv_file_path)<br>    target_var = <span class="hljs-string">&#x27;class&#x27;</span>  <span class="hljs-comment"># ç›®æ ‡å˜é‡</span><br>    <span class="hljs-comment"># æ•°æ®é›†çš„ç‰¹å¾</span><br>    features = <span class="hljs-built_in">list</span>(iris.columns)<br>    features.remove(target_var)<br>    <span class="hljs-comment"># ç›®æ ‡å˜é‡çš„ç±»åˆ«</span><br>    Class = iris[target_var].unique()<br>    <span class="hljs-comment"># ç›®æ ‡å˜é‡çš„ç±»åˆ«å­—å…¸</span><br>    Class_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(Class, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Class))))<br>    <span class="hljs-comment"># å¢åŠ ä¸€åˆ—target, å°†ç›®æ ‡å˜é‡è½¬åŒ–ä¸ºç±»åˆ«å˜é‡</span><br>    iris[<span class="hljs-string">&#x27;target&#x27;</span>] = iris[target_var].apply(<span class="hljs-keyword">lambda</span> x: Class_dict[x])<br><br>    <span class="hljs-keyword">return</span> features, <span class="hljs-string">&#x27;target&#x27;</span>, iris<br><br><br><span class="hljs-comment"># åˆ›å»ºæ¨¡å‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_model</span>():<br>    init = K.initializers.glorot_uniform(seed=<span class="hljs-number">1</span>)<br>    simple_adam = K.optimizers.Adam()<br>    model = K.models.Sequential()<br>    model.add(K.layers.Dense(units=<span class="hljs-number">5</span>, input_dim=<span class="hljs-number">4</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br>    model.add(K.layers.Dense(units=<span class="hljs-number">6</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br>    model.add(K.layers.Dense(units=<span class="hljs-number">3</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>))<br>    model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;sparse_categorical_crossentropy&#x27;</span>, optimizer=simple_adam, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>    <span class="hljs-keyword">return</span> model<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># 1. è¯»å–CSVæ•°æ®é›†</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Loading Iris data into memory&quot;</span>)<br>    n_split = <span class="hljs-number">10</span><br>    features, target, data = load_data(<span class="hljs-string">&quot;./iris_data.csv&quot;</span>)<br>    x = data[features]<br>    y = data[target]<br>    avg_accuracy = <span class="hljs-number">0</span><br>    avg_loss = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> train_index, test_index <span class="hljs-keyword">in</span> KFold(n_split).split(x):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;test index: &quot;</span>, test_index)<br>        x_train, x_test = x.iloc[train_index], x.iloc[test_index]<br>        y_train, y_test = y.iloc[train_index], y.iloc[test_index]<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;create model and train model&quot;</span>)<br>        model = create_model()<br>        model.fit(x_train, y_train, batch_size=<span class="hljs-number">1</span>, epochs=<span class="hljs-number">80</span>, verbose=<span class="hljs-number">0</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Model evaluation: &#x27;</span>, model.evaluate(x_test, y_test))<br>        avg_accuracy += model.evaluate(x_test, y_test)[<span class="hljs-number">1</span>]<br>        avg_loss += model.evaluate(x_test, y_test)[<span class="hljs-number">0</span>]<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;K fold average accuracy: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(avg_accuracy / n_split))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;K fold average accuracy: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(avg_loss / n_split))<br><br><br>main()<br></code></pre></td></tr></table></figure><p>æ¨¡å‹çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š |Iteration|loss|accuracy| |---|---|---||1|0.00056|1.0| |2|0.00021|1.0| |3|0.00022|1.0| |4|0.00608|1.0||5|0.21925|0.8667| |6|0.52390|0.8667| |7|0.00998|1.0| |8|0.04431|1.0||9|0.14590|1.0| |10|0.21286|0.8667| |avg|0.11633|0.9600|10æŠ˜äº¤å‰éªŒè¯çš„å¹³å‡lossä¸º0.11633,å¹³å‡å‡†ç¡®ç‡ä¸º96.00%ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»£ç å·²å­˜æ”¾è‡³Githubï¼Œç½‘å€ä¸ºï¼šhttps://github.com/percent4/Keras-K-fold-testã€‚</p><p>æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»~</p><p>2020.1.24äºä¸Šæµ·æµ¦ä¸œ</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keraså…¥é—¨ï¼ˆä¸ƒï¼‰ä½¿ç”¨Flask+Keras-bertæ„å»ºæ¨¡å‹é¢„æµ‹æœåŠ¡</title>
    <link href="/2023/08/08/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%83%EF%BC%89%E4%BD%BF%E7%94%A8Flask-Keras-bert%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B%E9%A2%84%E6%B5%8B%E6%9C%8D%E5%8A%A1/"/>
    <url>/2023/08/08/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%83%EF%BC%89%E4%BD%BF%E7%94%A8Flask-Keras-bert%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B%E9%A2%84%E6%B5%8B%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨keras-bertæ¨¡å—ï¼Œåˆ©ç”¨BERTä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹æ¥å®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡çš„æ¨¡å‹è®­ç»ƒã€æ¨¡å‹è¯„ä¼°å’Œæ¨¡å‹é¢„æµ‹ã€‚å…¶ä¸­ï¼Œæ¨¡å‹é¢„æµ‹æ˜¯é€šè¿‡åŠ è½½ç”Ÿæˆçš„h5æ–‡ä»¶æ¥å®ç°çš„ã€‚</p><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨Flaskæ„å»ºæ¨¡å‹é¢„æµ‹çš„HTTPæœåŠ¡ã€‚</p><p>æˆ‘ä»¬éµå¾ªæ­£å¸¸çš„æ€è·¯ï¼Œå³å…ˆä½¿ç”¨KerasåŠ è½½ä¿å­˜åçš„h5æ¨¡å‹æ–‡ä»¶ï¼Œåˆ©ç”¨Flaskå¯¹æ–°è¾“å…¥çš„æ–‡æœ¬è¿›è¡Œæ¨¡å‹é¢„æµ‹ï¼Œæœ€åç»™å‡ºé¢„æµ‹ç»“æœã€‚æˆ‘ä»¬å¯¹äººæ°‘æ—¥æŠ¥å‘½åå®ä½“å®ä½“æ•°æ®é›†è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œé‡‡ç”¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a>ä¸­çš„æ¨¡å‹ï¼Œè®­ç»ƒåå¾—åˆ°example_ner.h5æ–‡ä»¶ï¼Œæ¨¡å‹é¢„æµ‹çš„HTTPæœåŠ¡è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> traceback<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> get_custom_objects<br><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><span class="hljs-keyword">from</span> keras_contrib.losses <span class="hljs-keyword">import</span> crf_loss<br><span class="hljs-keyword">from</span> keras_contrib.metrics <span class="hljs-keyword">import</span> crf_accuracy<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br><span class="hljs-keyword">from</span> model_train <span class="hljs-keyword">import</span> PreProcessInputData, id_label_dict<br><br><br><span class="hljs-comment"># å°†BIOæ ‡ç­¾è½¬åŒ–ä¸ºæ–¹ä¾¿é˜…è¯»çš„jsonæ ¼å¼</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bio_to_json</span>(<span class="hljs-params">string, tags</span>):<br>    item = &#123;<span class="hljs-string">&quot;string&quot;</span>: string, <span class="hljs-string">&quot;entities&quot;</span>: []&#125;<br>    entity_name = <span class="hljs-string">&quot;&quot;</span><br>    entity_start = <span class="hljs-number">0</span><br>    iCount = <span class="hljs-number">0</span><br>    entity_tag = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">for</span> c_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(string), <span class="hljs-built_in">len</span>(tags))):<br>        c, tag = string[c_idx], tags[c_idx]<br>        <span class="hljs-keyword">if</span> c_idx &lt; <span class="hljs-built_in">len</span>(tags)-<span class="hljs-number">1</span>:<br>            tag_next = tags[c_idx+<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">else</span>:<br>            tag_next = <span class="hljs-string">&#x27;&#x27;</span><br><br>        <span class="hljs-keyword">if</span> tag[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;B&#x27;</span>:<br>            entity_tag = tag[<span class="hljs-number">2</span>:]<br>            entity_name = c<br>            entity_start = iCount<br>            <span class="hljs-keyword">if</span> tag_next[<span class="hljs-number">2</span>:] != entity_tag:<br>                item[<span class="hljs-string">&quot;entities&quot;</span>].append(&#123;<span class="hljs-string">&quot;word&quot;</span>: c, <span class="hljs-string">&quot;start&quot;</span>: iCount, <span class="hljs-string">&quot;end&quot;</span>: iCount + <span class="hljs-number">1</span>, <span class="hljs-string">&quot;type&quot;</span>: tag[<span class="hljs-number">2</span>:]&#125;)<br>        <span class="hljs-keyword">elif</span> tag[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;I&quot;</span>:<br>            <span class="hljs-keyword">if</span> tag[<span class="hljs-number">2</span>:] != tags[c_idx-<span class="hljs-number">1</span>][<span class="hljs-number">2</span>:] <span class="hljs-keyword">or</span> tags[c_idx-<span class="hljs-number">1</span>][<span class="hljs-number">2</span>:] == <span class="hljs-string">&#x27;O&#x27;</span>:<br>                tags[c_idx] = <span class="hljs-string">&#x27;O&#x27;</span><br>                <span class="hljs-keyword">pass</span><br>            <span class="hljs-keyword">else</span>:<br>                entity_name = entity_name + c<br>                <span class="hljs-keyword">if</span> tag_next[<span class="hljs-number">2</span>:] != entity_tag:<br>                    item[<span class="hljs-string">&quot;entities&quot;</span>].append(&#123;<span class="hljs-string">&quot;word&quot;</span>: entity_name, <span class="hljs-string">&quot;start&quot;</span>: entity_start, <span class="hljs-string">&quot;end&quot;</span>: iCount + <span class="hljs-number">1</span>, <span class="hljs-string">&quot;type&quot;</span>: entity_tag&#125;)<br>                    entity_name = <span class="hljs-string">&#x27;&#x27;</span><br>        iCount += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> item<br><br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/model/ner&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_geo</span>():<br>    return_result = &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;data&quot;</span>: []&#125;<br>    <span class="hljs-keyword">try</span>:<br>        text = request.get_json()[<span class="hljs-string">&quot;text&quot;</span>].replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>        word_labels, seq_types = PreProcessInputData([text])<br><br>        <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>        predicted = ner_model.predict([word_labels, seq_types])<br>        y = np.argmax(predicted[<span class="hljs-number">0</span>], axis=<span class="hljs-number">1</span>)<br>        tag = [id_label_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> y]<br><br>        <span class="hljs-comment"># è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>        result = bio_to_json(text, tag[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>])<br>        return_result[<span class="hljs-string">&quot;data&quot;</span>] = result<br><br>    <span class="hljs-keyword">except</span> Exception:<br>        return_result[<span class="hljs-string">&quot;code&quot;</span>] = <span class="hljs-number">400</span><br>        return_result[<span class="hljs-string">&quot;message&quot;</span>] = traceback.format_exc()<br><br>    <span class="hljs-keyword">return</span> json.dumps(return_result, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹</span><br>    custom_objects = get_custom_objects()<br>    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> &#123;<span class="hljs-string">&#x27;CRF&#x27;</span>: CRF, <span class="hljs-string">&#x27;crf_loss&#x27;</span>: crf_loss, <span class="hljs-string">&#x27;crf_accuracy&#x27;</span>: crf_accuracy&#125;.items():<br>        custom_objects[key] = value<br>    ner_model = load_model(<span class="hljs-string">&quot;example_ner.h5&quot;</span>, custom_objects=custom_objects)<br>    <span class="hljs-comment"># å¯åŠ¨HTTPæœåŠ¡</span><br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">25000</span>)<br></code></pre></td></tr></table></figure><p>çœ‹ä¸Šå»ä¸Šé¢çš„æœåŠ¡å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†å½“æˆ‘ä»¬è¿›è¡ŒHTTPè¯·æ±‚æ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-built_in">File</span> <span class="hljs-string">&quot;/home/jclian91/.conda/envs/py3-lmj/lib/python3.6/site-packages/tensorflow/python/framework/ops.py&quot;</span>, line <span class="hljs-number">3875</span>, <span class="hljs-function">in _as_graph_element_locked</span><br><span class="hljs-function">    raise <span class="hljs-title">ValueError</span><span class="hljs-params">(<span class="hljs-string">&quot;Tensor %s is not an element of this graph.&quot;</span> % obj)</span></span><br><span class="hljs-function">ValueError: Tensor Tensor(<span class="hljs-string">&quot;crf_1/cond/Merge:0&quot;</span>, shape=</span>(?, ?, <span class="hljs-number">7</span>), dtype=float32) is <span class="hljs-keyword">not</span> an element of <span class="hljs-keyword">this</span> graph.<br></code></pre></td></tr></table></figure><p>ä¸Šç½‘æœèµ„æ–™ï¼Œå‘ç°è¿™ç§é”™è¯¯éå¸¸å¸¸è§ï¼Œå…¶ä¸­ä¸€ç§è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>å¯¼å…¥æ¨¡å—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> keras.backend <span class="hljs-keyword">import</span> set_session<br></code></pre></td></tr></table></figure><p>åœ¨åŠ è½½æ¨¡å‹ï¼ˆload_modelï¼‰çš„ä»£ç å‰ï¼ŒåŠ å‡ è¡Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">sess = tf.Session()<br>   graph = tf.get_default_graph()<br>   set_session(sess)<br></code></pre></td></tr></table></figure><p>åŒæ—¶åœ¨HTTPæœåŠ¡çš„æ¨¡å‹é¢„æµ‹ï¼ˆner_model.predictï¼‰å‰ï¼ŒåŠ å‡ è¡Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br><span class="hljs-keyword">global</span> sess<br><span class="hljs-keyword">global</span> graph<br><span class="hljs-keyword">with</span> graph.as_default():<br>    set_session(sess)<br>    predicted = ner_model.predict([word_labels, seq_types])<br></code></pre></td></tr></table></figure><p>è¿™æ ·å†æ¬¡å¯åŠ¨æ¨¡å‹é¢„æµ‹HTTPè„šæœ¬ï¼Œå¯ä»¥å‘ç°æ¨¡å‹é¢„æµ‹çš„HTTPè¯·æ±‚æ˜¯æ­£å¸¸çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl --location --request POST <span class="hljs-string">&#x27;http://192.168.1.193:25000/model/ner&#x27;</span> \<br>&gt; --header <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> \<br>&gt; --data-raw <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">&gt;     &quot;text&quot;: &quot;ç¾å›½å«ç”Ÿéƒ¨é•¿é˜¿æ‰å°”è¾èŒ åŸå› æ›å…‰&quot;</span><br><span class="hljs-string">&gt; &#125;&#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;code&quot;</span>: 200,<br>  <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>,<br>  <span class="hljs-string">&quot;data&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;string&quot;</span>: <span class="hljs-string">&quot;ç¾å›½å«ç”Ÿéƒ¨é•¿é˜¿æ‰å°”è¾èŒåŸå› æ›å…‰&quot;</span>,<br>    <span class="hljs-string">&quot;entities&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;word&quot;</span>: <span class="hljs-string">&quot;ç¾å›½å«ç”Ÿéƒ¨&quot;</span>,<br>        <span class="hljs-string">&quot;start&quot;</span>: 0,<br>        <span class="hljs-string">&quot;end&quot;</span>: 5,<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ORG&quot;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-string">&quot;word&quot;</span>: <span class="hljs-string">&quot;é˜¿æ‰å°”&quot;</span>,<br>        <span class="hljs-string">&quot;start&quot;</span>: 6,<br>        <span class="hljs-string">&quot;end&quot;</span>: 9,<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;PER&quot;</span><br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥è„šæœ¬å·²ä¸Šä¼ è‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/keras_bert_sequence_labeling/blob/master/model_server.py">https://github.com/percent4/keras_bert_sequence_labeling/blob/master/model_server.py</a>ã€‚</p><p>æ„Ÿè°¢é˜…è¯»~</p><p>2021å¹´1æœˆ16æ—¥äºä¸Šæµ·æµ¦ä¸œ</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Keras-bert</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keraså…¥é—¨ï¼ˆå…­ï¼‰æ¨¡å‹è®­ç»ƒå®æ—¶å¯è§†åŒ–</title>
    <link href="/2023/08/08/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%AE%9E%E6%97%B6%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    <url>/2023/08/08/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%AE%9E%E6%97%B6%E5%8F%AF%E8%A7%86%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨åŒ—äº¬åšæŸä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œå®¢æˆ·è¦æ±‚èƒ½å¤Ÿå¯¹æ•°æ®è¿›è¡Œè®­ç»ƒã€é¢„æµ‹ï¼ŒåŒæ—¶èƒ½å¯¼å‡ºæ¨¡å‹ï¼Œè¿˜æœ‰åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºè®­ç»ƒçš„è¿›åº¦ã€‚å‰é¢çš„å‡ ä¸ªè¦æ±‚éƒ½ä¸éš¾å®ç°ï¼Œä½†åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºè®­ç»ƒè¿›åº¦å½“æ—¶ç¬”è€…å¹¶æ²¡æœ‰å®ç°ã€‚</p><p>æœ¬æ–‡å°†ä¼šåˆ†äº«å¦‚ä½•åœ¨Kerasä¸­å°†æ¨¡å‹è®­ç»ƒçš„è¿‡ç¨‹å®æ—¶å¯è§†åŒ–ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œå·²ç»æœ‰äººå¸®æˆ‘ä»¬åšå¥½äº†è¿™ä»¶äº‹ï¼Œè¿™ä¸ªé¡¹ç›®åå«hualosï¼ŒGithubçš„è®¿é—®ç½‘å€ä¸ºï¼šhttps://github.com/fchollet/hualosï¼Œä½œè€…ä¸ºFranÃ§ois Cholletå’ŒEderSantanaï¼Œå‰é¢çš„ä½œè€…å°±æ˜¯Kerasçš„åˆ›é€ è€…ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¹¦ç±ã€ŠDeep Learning withPythonã€‹çš„ä½œè€…ã€‚</p><p>å¤§ç¥çš„å·¥ä½œå¤§å¤§åœ°æ–¹ä¾¿äº†æˆ‘ä»¬çš„ä½¿ç”¨ã€‚è°ƒç”¨è¯¥é¡¹ç›®ä»…éœ€è¦ä¸‰è¡Œä»£ç ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> keras <span class="hljs-keyword">import</span> callbacks<br>remote = callbacks.RemoteMonitor(root=<span class="hljs-string">&#x27;http://localhost:9000&#x27;</span>)<br><br>model.fit(X_train, Y_train, batch_size=batch_size, nb_epoch=nb_epoch, validation_data=(X_test, Y_test), callbacks=[remote])<br></code></pre></td></tr></table></figure><p>è¯¥é¡¹ç›®ä½¿ç”¨Python2å†™çš„ï¼Œç”¨åˆ°çš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¸ºFlask,geventï¼Œå…¶ä¸­Flaskä¸ºç½‘é¡µç«¯æ¡†æ¶ï¼Œgeventç”¨äºå¹¶å‘ã€‚ç”¨åˆ°çš„JavaScriptçš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¸ºD3.jså’ŒC3.jsã€‚è¯¥é¡¹ç›®ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œåªéœ€è¦åˆ‡æ¢è‡³hualosé¡¹ç›®æ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œç„¶å<code>python api.py</code>å³å¯ã€‚</p><p>ä¸‹é¢å°†ä»‹ç»å…¶ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/keras6_1.png" alt="é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„</figcaption></figure><p>å…¶ä¸­hualoså¯ä»¥ä»Githubä¸Šç›´æ¥cloneä¸‹æ¥ï¼Œç¬”è€…å¯¹ä»£ç å’ŒHTMLç½‘é¡µç¨ä½œäº†ä¿®æ”¹ï¼Œä¾¿äºè‡ªå·±ä½¿ç”¨ã€‚model_train.pyä¸ºKerasæ¨¡å‹è®­ç»ƒè„šæœ¬ï¼Œiris.csvä¸ºè‘—åçš„é¸¢å°¾èŠ±æ•°æ®é›†ã€‚</p><p>model_train.pyä¸­åˆ©ç”¨Kerasæ­å»ºäº†ç®€å•çš„DNNæ¨¡å‹å¯¹é¸¢å°¾èŠ±æ•°æ®é›†è¿›è¡Œè®­ç»ƒåŠé¢„æµ‹ï¼Œè¯¥æ¨¡å‹çš„ä»‹ç»å·²ç»åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88DNN%EF%BC%89%E8%A7%A3%E5%86%B3%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/">Keraså…¥é—¨ï¼ˆä¸€ï¼‰æ­å»ºæ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰è§£å†³å¤šåˆ†ç±»é—®é¢˜</a>ä¸­ç»™å‡ºï¼Œå…¶å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯¼å…¥æ¨¡å—</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> keras <span class="hljs-keyword">as</span> K<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelBinarizer<br><span class="hljs-keyword">from</span> keras <span class="hljs-keyword">import</span> callbacks<br><br><br><span class="hljs-comment"># è¯»å–CSVæ•°æ®é›†ï¼Œå¹¶æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br><span class="hljs-comment"># è¯¥å‡½æ•°çš„ä¼ å…¥å‚æ•°ä¸ºCSV_FILE_PATH: csvæ–‡ä»¶è·¯å¾„</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>(<span class="hljs-params">CSV_FILE_PATH</span>):<br>    IRIS = pd.read_csv(CSV_FILE_PATH)<br>    target_var = <span class="hljs-string">&#x27;class&#x27;</span>  <span class="hljs-comment"># ç›®æ ‡å˜é‡</span><br>    <span class="hljs-comment"># æ•°æ®é›†çš„ç‰¹å¾</span><br>    features = <span class="hljs-built_in">list</span>(IRIS.columns)<br>    features.remove(target_var)<br>    <span class="hljs-comment"># ç›®æ ‡å˜é‡çš„ç±»åˆ«</span><br>    Class = IRIS[target_var].unique()<br>    <span class="hljs-comment"># ç›®æ ‡å˜é‡çš„ç±»åˆ«å­—å…¸</span><br>    Class_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(Class, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Class))))<br>    <span class="hljs-comment"># å¢åŠ ä¸€åˆ—target, å°†ç›®æ ‡å˜é‡è¿›è¡Œç¼–ç </span><br>    IRIS[<span class="hljs-string">&#x27;target&#x27;</span>] = IRIS[target_var].apply(<span class="hljs-keyword">lambda</span> x: Class_dict[x])<br>    <span class="hljs-comment"># å¯¹ç›®æ ‡å˜é‡è¿›è¡Œ0-1ç¼–ç (One-hot Encoding)</span><br>    lb = LabelBinarizer()<br>    lb.fit(<span class="hljs-built_in">list</span>(Class_dict.values()))<br>    transformed_labels = lb.transform(IRIS[<span class="hljs-string">&#x27;target&#x27;</span>])<br>    y_bin_labels = []  <span class="hljs-comment"># å¯¹å¤šåˆ†ç±»è¿›è¡Œ0-1ç¼–ç çš„å˜é‡</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(transformed_labels.shape[<span class="hljs-number">1</span>]):<br>        y_bin_labels.append(<span class="hljs-string">&#x27;y&#x27;</span> + <span class="hljs-built_in">str</span>(i))<br>        IRIS[<span class="hljs-string">&#x27;y&#x27;</span> + <span class="hljs-built_in">str</span>(i)] = transformed_labels[:, i]<br>    <span class="hljs-comment"># å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br>    train_x, test_x, train_y, test_y = train_test_split(IRIS[features], IRIS[y_bin_labels], \<br>                                                        train_size=<span class="hljs-number">0.7</span>, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> train_x, test_x, train_y, test_y, Class_dict<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-comment"># 0. å¼€å§‹</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nIris dataset using Keras&quot;</span>)<br>    np.random.seed(<span class="hljs-number">4</span>)<br>    tf.set_random_seed(<span class="hljs-number">13</span>)<br><br>    <span class="hljs-comment"># 1. è¯»å–CSVæ•°æ®é›†</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Loading Iris data into memory&quot;</span>)<br>    CSV_FILE_PATH = <span class="hljs-string">&#x27;iris.csv&#x27;</span><br>    train_x, test_x, train_y, test_y, Class_dict = load_data(CSV_FILE_PATH)<br><br>    <span class="hljs-comment"># 2. å®šä¹‰æ¨¡å‹</span><br>    init = K.initializers.glorot_uniform(seed=<span class="hljs-number">1</span>)<br>    simple_adam = K.optimizers.Adam()<br>    model = K.models.Sequential()<br>    model.add(K.layers.Dense(units=<span class="hljs-number">5</span>, input_dim=<span class="hljs-number">4</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br>    model.add(K.layers.Dense(units=<span class="hljs-number">6</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br>    model.add(K.layers.Dense(units=<span class="hljs-number">3</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>))<br>    model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>, optimizer=simple_adam, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br>    <span class="hljs-comment"># 3. è®­ç»ƒæ¨¡å‹</span><br>    b_size = <span class="hljs-number">1</span><br>    max_epochs = <span class="hljs-number">100</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Starting training &quot;</span>)<br>    remote = callbacks.RemoteMonitor(root=<span class="hljs-string">&#x27;http://localhost:9000&#x27;</span>)<br>    h = model.fit(train_x, train_y, validation_data=(test_x, test_y), batch_size=b_size, epochs=max_epochs,<br>                  shuffle=<span class="hljs-literal">True</span>, verbose=<span class="hljs-number">1</span>, callbacks=[remote])<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Training finished \n&quot;</span>)<br><br>    <span class="hljs-comment"># 4. è¯„ä¼°æ¨¡å‹</span><br>    <span class="hljs-built_in">eval</span> = model.evaluate(test_x, test_y, verbose=<span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Evaluation on test data: loss = %0.6f accuracy = %0.2f%% \n&quot;</span> \<br>          % (<span class="hljs-built_in">eval</span>[<span class="hljs-number">0</span>], <span class="hljs-built_in">eval</span>[<span class="hljs-number">1</span>] * <span class="hljs-number">100</span>) )<br><br>    <span class="hljs-comment"># 5. ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹</span><br>    np.set_printoptions(precision=<span class="hljs-number">4</span>)<br>    unknown = np.array([[<span class="hljs-number">6.1</span>, <span class="hljs-number">3.1</span>, <span class="hljs-number">5.1</span>, <span class="hljs-number">1.1</span>]], dtype=np.float32)<br>    predicted = model.predict(unknown)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using model to predict species for features: &quot;</span>)<br>    <span class="hljs-built_in">print</span>(unknown)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nPredicted softmax vector is: &quot;</span>)<br>    <span class="hljs-built_in">print</span>(predicted)<br>    species_dict = &#123;v:k <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> Class_dict.items()&#125;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nPredicted species is: &quot;</span>)<br>    <span class="hljs-built_in">print</span>(species_dict[np.argmax(predicted)])<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ‡æ¢è‡³hualosæ–‡ä»¶å¤¹ï¼Œè¿è¡Œ<code>python api.py</code>ï¼Œç„¶åå†ç”¨Python3è¿è¡Œmodel_train.pyæ–‡ä»¶ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€ï¼šhttp://localhost:9000ï¼Œå³å¯çœ‹åˆ°åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºçš„æ¨¡å‹è®­ç»ƒçš„å®æ–½å¯è§†åŒ–çš„ç»“æœï¼Œå›¾åƒå¦‚ä¸‹ï¼š</p><p><img src="/img/keras6_2.png" /></p><p>å› ä¸ºè¿™é‡Œæ— æ³•ç»™å‡ºè§†é¢‘ï¼Œéœ€è¦è§‚çœ‹è§†é¢‘çš„è¯»è€…å¯ä»¥ç§»æ­¥ç½‘å€ï¼š<ahref="https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484522&amp;idx=1&amp;sn=dab46a55945baf2411e30bd109cee76f&amp;chksm=fcb9bdfacbce34ec02f3e958988e9b400676d29f88c1efad5ce01fb1f4ce2f5f96ccf0e4af66&amp;token=1377830530&amp;lang=zh_CN#rd">https://mp.weixin.qq.com/s?__biz=MzU2NTYyMDk5MQ==&amp;mid=2247484522&amp;idx=1&amp;sn=dab46a55945baf2411e30bd109cee76f&amp;chksm=fcb9bdfacbce34ec02f3e958988e9b400676d29f88c1efad5ce01fb1f4ce2f5f96ccf0e4af66&amp;token=1377830530&amp;lang=zh_CN#rd</a>ã€‚</p><p>æœ¬é¡¹ç›®çš„Githubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/keras_train_visualization">https://github.com/percent4/keras_train_visualization</a>ã€‚</p><p>æœ¬æœŸåˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»~</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keraså…¥é—¨ï¼ˆäº”ï¼‰æ­å»ºResNetå¯¹CIFAR-10è¿›è¡Œå›¾åƒåˆ†ç±»</title>
    <link href="/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%E6%90%AD%E5%BB%BAResNet%E5%AF%B9CIFAR-10%E8%BF%9B%E8%A1%8C%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB/"/>
    <url>/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%E6%90%AD%E5%BB%BAResNet%E5%AF%B9CIFAR-10%E8%BF%9B%E8%A1%8C%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•åˆ©ç”¨Kerasæ¥æ­å»ºè‘—åçš„ResNetç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œåœ¨CIFAR-10æ•°æ®é›†è¿›è¡Œå›¾åƒåˆ†ç±»ã€‚</p><h3 id="æ•°æ®é›†ä»‹ç»">æ•°æ®é›†ä»‹ç»</h3><p>CIFAR-10æ•°æ®é›†æ˜¯å·²ç»æ ‡æ³¨å¥½çš„å›¾åƒæ•°æ®é›†ï¼Œç”±Alex Krizhevsky, VinodNair, and GeoffreyHintonä¸‰äººæ”¶é›†ï¼Œå…¶è®¿é—®ç½‘å€ä¸ºï¼šhttps://www.cs.toronto.edu/~kriz/cifar.htmlã€‚</p><p>CIFAR-10æ•°æ®é›†åŒ…å«60000å¼ å°ºå¯¸ä¸º32x32çš„å½©è‰²å›¾ç‰‡ï¼Œå…±åˆ†æˆ10ä¸ªåˆ†ç±»ï¼ˆç±»åˆ«ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼‰ï¼Œæ¯ä¸ªç±»åˆ«ä¸€å…±6000å¼ å›¾ç‰‡ã€‚è¯¥æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå…¶ä¸­è®­ç»ƒé›†5000å¼ å›¾ç‰‡ï¼Œæµ‹è¯•é›†10000å¼ å›¾ç‰‡ã€‚</p><p>è¯¥æ•°æ®é›†åˆ†ä¸º5ä¸ªè®­ç»ƒæ‰¹æ¬¡å’Œ1ä¸ªæµ‹è¯•æ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡ä¸€å…±10000å¼ å›¾ç‰‡ã€‚æµ‹è¯•æ‰¹æ¬¡åŒ…å«ä»æ¯ä¸ªåˆ†ç±»ä¸­éšæœºé€‰å–çš„1000å¼ å›¾ç‰‡ã€‚è®­ç»ƒæ‰¹æ¬¡åŒ…å«å‰©ä¸‹çš„å›¾ç‰‡ï¼Œä½†æ˜¯æ¯ä¸ªè®­ç»ƒæ‰¹æ¬¡çš„æŸäº›ç±»åˆ«çš„å›¾ç‰‡ä¼šæ¯”å…¶ä»–ç±»åˆ«å¤šã€‚</p><p>ä¸‹å›¾ä¸ºä»æ¯ä¸ªç±»åˆ«ä¸­é€‰å–çš„10å¼ ç¤ºä¾‹å›¾ç‰‡ï¼š</p><figure><img src="/img/keras5_1.png" alt="æ¯ä¸ªç±»åˆ«çš„ç¤ºä¾‹å›¾ç‰‡" /><figcaption aria-hidden="true">æ¯ä¸ªç±»åˆ«çš„ç¤ºä¾‹å›¾ç‰‡</figcaption></figure><p>æœ¬æ–‡ä¸­é€‰ç”¨çš„CIFAR-10æ•°æ®é›†ä¸‹è½½ç½‘å€ä¸ºï¼šhttps://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gzï¼Œæ–‡ä»¶å¤¹å†…å®¹å¦‚ä¸‹ï¼š</p><figure><img src="/img/keras5_2.png" alt="CIFAR-10æ•°æ®é›†Pythonç‰ˆæœ¬" /><figcaption aria-hidden="true">CIFAR-10æ•°æ®é›†Pythonç‰ˆæœ¬</figcaption></figure><p>æˆ‘ä»¬å°è¯•ç€ç”¨Pythonç¨‹åºè¯»å–é‡Œé¢çš„å›¾ç‰‡ï¼ˆå›¾ç‰‡å¯è§†åŒ–ï¼‰ï¼ŒPythonç¨‹åºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-comment"># è¯»å–æ–‡ä»¶</span><br>fpath = <span class="hljs-string">&#x27;cifar-10-batches-py/data_batch_1&#x27;</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(fpath, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    d = pickle.load(f, encoding=<span class="hljs-string">&#x27;bytes&#x27;</span>)<br><br>data = d[<span class="hljs-string">b&#x27;data&#x27;</span>]<br>labels = d[<span class="hljs-string">b&#x27;labels&#x27;</span>]<br>data = data.reshape(data.shape[<span class="hljs-number">0</span>], <span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>).transpose(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># ä¿å­˜ç¬¬image_noå¼ å›¾ç‰‡</span><br>strings=[<span class="hljs-string">&#x27;airplane&#x27;</span>, <span class="hljs-string">&#x27;automobile&#x27;</span>, <span class="hljs-string">&#x27;bird&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;deer&#x27;</span>,<br>         <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;frog&#x27;</span>, <span class="hljs-string">&#x27;horse&#x27;</span>, <span class="hljs-string">&#x27;ship&#x27;</span>, <span class="hljs-string">&#x27;truck&#x27;</span>]<br>image_no = <span class="hljs-number">1000</span><br>label = strings[labels[image_no]]<br>image = data[image_no,:,:,:]<br>cv2.imwrite(<span class="hljs-string">&#x27;%s.jpg&#x27;</span> % label, image)<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure><img src="/img/keras5_3.png" alt="ä¿å­˜åçš„å›¾ç‰‡" /><figcaption aria-hidden="true">ä¿å­˜åçš„å›¾ç‰‡</figcaption></figure><p>å›¾ç‰‡è™½ç„¶æ¯”è¾ƒæ¨¡ç³Šï¼Œä½†è¿˜æ˜¯å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€è¾†è½¦ï¼Œå±äºtruckç±»åˆ«ã€‚</p><h3 id="resnetæ¨¡å‹">ResNetæ¨¡å‹</h3><p>å›¾åƒåˆ†ç±»ä¸­çš„ç»å…¸æ¨¡å‹ä¸ºCNNï¼Œä½†CNNéšç€å±‚æ•°çš„å¢åŠ ï¼Œæ˜¾ç¤ºå‡º<code>é€€åŒ–é—®é¢˜</code>ï¼Œå³æ·±å±‚æ¬¡çš„ç½‘ç»œåè€Œä¸å¦‚ç¨æµ…å±‚æ¬¡çš„ç½‘ç»œæ€§èƒ½ï¼›è¿™å¹¶éæ˜¯è¿‡æ‹Ÿåˆå¯¼è‡´çš„ï¼Œå› ä¸ºåœ¨è®­ç»ƒé›†ä¸Šå°±æ˜¾ç¤ºå‡ºé€€åŒ–å·®è·ã€‚è€ŒResNetèƒ½è¾ƒå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ResNetå…¨åResidualNetworkï¼Œä¸­æ–‡åä¸ºæ®‹å·®ç¥ç»ç½‘ç»œï¼Œæ›¾è·å¾—2015å¹´ImageNetçš„å† å†›ã€‚ResNetçš„ä¸»è¦æ€æƒ³åœ¨äºæ®‹å·®å—ï¼ŒKaimingHeç­‰è®¾è®¡äº†ä¸€ç§skip connectionï¼ˆæˆ–è€…shortcutconnectionsï¼‰ç»“æ„ï¼Œä½¿å¾—ç½‘ç»œå…·æœ‰æ›´å¼ºçš„identitymappingï¼ˆæ’ç­‰æ˜ å°„ï¼‰çš„èƒ½åŠ›ï¼Œä»è€Œæ‹“å±•äº†ç½‘ç»œçš„æ·±åº¦ï¼ŒåŒæ—¶ä¹Ÿæå‡äº†ç½‘ç»œçš„æ€§èƒ½ã€‚æ®‹å·®å—çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/keras5_4.png" alt="æ®‹å·®å—ç»“æ„" /><figcaption aria-hidden="true">æ®‹å·®å—ç»“æ„</figcaption></figure><p>F(x)=H(x)âˆ’xï¼Œxä¸ºæµ…å±‚çš„è¾“å‡ºï¼ŒH(x)ä¸ºæ·±å±‚çš„è¾“å‡º,F(x)ä¸ºå¤¹åœ¨äºŒè€…ä¸­é—´çš„çš„ä¸¤å±‚ä»£è¡¨çš„å˜æ¢ï¼Œå½“æµ…å±‚çš„xä»£è¡¨çš„ç‰¹å¾å·²ç»è¶³å¤Ÿæˆç†Ÿï¼Œå¦‚æœä»»ä½•å¯¹äºç‰¹å¾xçš„æ”¹å˜éƒ½ä¼šè®©losså˜å¤§çš„è¯ï¼ŒF(x)ä¼šè‡ªåŠ¨è¶‹å‘äºå­¦ä¹ æˆä¸º0ï¼Œxåˆ™ä»æ’ç­‰æ˜ å°„çš„è·¯å¾„ç»§ç»­ä¼ é€’ã€‚è¿™æ ·å°±åœ¨ä¸å¢åŠ è®¡ç®—æˆæœ¬çš„æƒ…å†µä¸‹å®ç°äº†ä¸€å¼€å§‹çš„ç›®çš„ï¼šåœ¨å‰å‘è¿‡ç¨‹ä¸­ï¼Œå½“æµ…å±‚çš„è¾“å‡ºå·²ç»è¶³å¤Ÿæˆç†Ÿï¼ˆoptimalï¼‰ï¼Œè®©æ·±å±‚ç½‘ç»œåé¢çš„å±‚èƒ½å¤Ÿå®ç°æ’ç­‰æ˜ å°„çš„ä½œç”¨ã€‚</p><p>ç¤ºä¾‹çš„æ®‹å·®å—å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/keras5_5.png" alt="ç¤ºä¾‹æ®‹å·®å—" /><figcaption aria-hidden="true">ç¤ºä¾‹æ®‹å·®å—</figcaption></figure><p>å·¦è¾¹é’ˆå¯¹çš„æ˜¯ResNet34æµ…å±‚ç½‘ç»œï¼Œå³è¾¹é’ˆå¯¹çš„æ˜¯ResNet50/101/152æ·±å±‚ç½‘ç»œï¼Œå³è¾¹è¿™ä¸ªåˆè¢«å«åšbottleneckã€‚bottleneck å¾ˆå¥½åœ°å‡å°‘äº†å‚æ•°æ•°é‡ã€‚</p><p>ä»¥ä¸Šæ˜¯å…³äºResNetçš„ä¸€äº›ç®€å•ä»‹ç»ï¼Œæ›´å¤šç»†èŠ‚æœ‰å¾…äºç ”ç©¶ã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æˆ‘ä»¬åˆ©ç”¨Keraså®˜æ–¹ç½‘ç«™ç»™å‡ºçš„ResNetæ¨¡å‹å¯¹CIFAR-10è¿›è¡Œå›¾ç‰‡åˆ†ç±»ã€‚</p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/keras5_6.png" alt="é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„</figcaption></figure><p>å…¶ä¸­load_data.pyè„šæœ¬å°†æ•°æ®é›†å¯¼å…¥è¿›æ¥ï¼Œåˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> keras<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Dense, Conv2D, BatchNormalization, Activation<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> AveragePooling2D, Input, Flatten<br><span class="hljs-keyword">from</span> keras.optimizers <span class="hljs-keyword">import</span> Adam<br><span class="hljs-keyword">from</span> keras.callbacks <span class="hljs-keyword">import</span> ModelCheckpoint, LearningRateScheduler<br><span class="hljs-keyword">from</span> keras.callbacks <span class="hljs-keyword">import</span> ReduceLROnPlateau<br><span class="hljs-keyword">from</span> keras.preprocessing.image <span class="hljs-keyword">import</span> ImageDataGenerator<br><span class="hljs-keyword">from</span> keras.regularizers <span class="hljs-keyword">import</span> l2<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># ä½¿ç”¨GPU,è‡ªå·±æ ¹æ®æœºå™¨é…ç½®è°ƒæ•´,é»˜è®¤ä¸å¼€å¯</span><br><span class="hljs-comment"># os.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = &quot;4,5,6,7,8&quot;</span><br><br><span class="hljs-keyword">from</span> load_data <span class="hljs-keyword">import</span> load_data<br><br><span class="hljs-comment"># Training parameters</span><br>batch_size = <span class="hljs-number">32</span><br>epochs = <span class="hljs-number">100</span><br>num_classes = <span class="hljs-number">10</span><br><br><span class="hljs-comment"># Subtracting pixel mean improves accuracy</span><br>subtract_pixel_mean = <span class="hljs-literal">True</span><br><br>n = <span class="hljs-number">3</span><br><br><span class="hljs-comment"># Model version</span><br><span class="hljs-comment"># Orig paper: version = 1 (ResNet v1), Improved ResNet: version = 2 (ResNet v2)</span><br>version = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># Computed depth from supplied model parameter n</span><br>depth = n * <span class="hljs-number">6</span> + <span class="hljs-number">2</span><br><br><span class="hljs-comment"># Model name, depth and version</span><br>model_type = <span class="hljs-string">&#x27;ResNet%dv%d&#x27;</span> % (depth, version)<br><br><span class="hljs-comment"># Load the CIFAR10 data.</span><br>(x_train, y_train), (x_test, y_test) = load_data()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;load data successfully!&#x27;</span>)<br><br><span class="hljs-comment"># Input image dimensions.</span><br>input_shape = x_train.shape[<span class="hljs-number">1</span>:]<br><br><span class="hljs-comment"># Normalize data.</span><br>x_train = x_train.astype(<span class="hljs-string">&#x27;float32&#x27;</span>) / <span class="hljs-number">255</span><br>x_test = x_test.astype(<span class="hljs-string">&#x27;float32&#x27;</span>) / <span class="hljs-number">255</span><br><br><span class="hljs-comment"># If subtract pixel mean is enabled</span><br><span class="hljs-keyword">if</span> subtract_pixel_mean:<br>    x_train_mean = np.mean(x_train, axis=<span class="hljs-number">0</span>)<br>    x_train -= x_train_mean<br>    x_test -= x_train_mean<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x_train shape:&#x27;</span>, x_train.shape)<br><span class="hljs-built_in">print</span>(x_train.shape[<span class="hljs-number">0</span>], <span class="hljs-string">&#x27;train samples&#x27;</span>)<br><span class="hljs-built_in">print</span>(x_test.shape[<span class="hljs-number">0</span>], <span class="hljs-string">&#x27;test samples&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;y_train shape:&#x27;</span>, y_train.shape)<br><br><span class="hljs-comment"># Convert class vectors to binary class matrices.</span><br>y_train = keras.utils.to_categorical(y_train, num_classes)<br>y_test = keras.utils.to_categorical(y_test, num_classes)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Begin model training...&#x27;</span>)<br><br><br><span class="hljs-comment"># Learning Rate Schedule</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lr_schedule</span>(<span class="hljs-params">epoch</span>):<br>    lr = <span class="hljs-number">1e-3</span><br>    <span class="hljs-keyword">if</span> epoch &gt; <span class="hljs-number">180</span>:<br>        lr *= <span class="hljs-number">0.5e-3</span><br>    <span class="hljs-keyword">elif</span> epoch &gt; <span class="hljs-number">160</span>:<br>        lr *= <span class="hljs-number">1e-3</span><br>    <span class="hljs-keyword">elif</span> epoch &gt; <span class="hljs-number">120</span>:<br>        lr *= <span class="hljs-number">1e-2</span><br>    <span class="hljs-keyword">elif</span> epoch &gt; <span class="hljs-number">80</span>:<br>        lr *= <span class="hljs-number">1e-1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Learning rate: &#x27;</span>, lr)<br>    <span class="hljs-keyword">return</span> lr<br><br><br><span class="hljs-comment"># resnet layer</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">resnet_layer</span>(<span class="hljs-params">inputs,</span><br><span class="hljs-params">                 num_filters=<span class="hljs-number">16</span>,</span><br><span class="hljs-params">                 kernel_size=<span class="hljs-number">3</span>,</span><br><span class="hljs-params">                 strides=<span class="hljs-number">1</span>,</span><br><span class="hljs-params">                 activation=<span class="hljs-string">&#x27;relu&#x27;</span>,</span><br><span class="hljs-params">                 batch_normalization=<span class="hljs-literal">True</span>,</span><br><span class="hljs-params">                 conv_first=<span class="hljs-literal">True</span></span>):<br><br>    conv = Conv2D(num_filters,<br>                  kernel_size=kernel_size,<br>                  strides=strides,<br>                  padding=<span class="hljs-string">&#x27;same&#x27;</span>,<br>                  kernel_initializer=<span class="hljs-string">&#x27;he_normal&#x27;</span>,<br>                  kernel_regularizer=l2(<span class="hljs-number">1e-4</span>))<br><br>    x = inputs<br>    <span class="hljs-keyword">if</span> conv_first:<br>        x = conv(x)<br>        <span class="hljs-keyword">if</span> batch_normalization:<br>            x = BatchNormalization()(x)<br>        <span class="hljs-keyword">if</span> activation <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            x = Activation(activation)(x)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> batch_normalization:<br>            x = BatchNormalization()(x)<br>        <span class="hljs-keyword">if</span> activation <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            x = Activation(activation)(x)<br>        x = conv(x)<br>    <span class="hljs-keyword">return</span> x<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">resnet_v1</span>(<span class="hljs-params">input_shape, depth, num_classes=<span class="hljs-number">10</span></span>):<br>    <span class="hljs-comment"># ResNet Version 1 Model builder [a]</span><br>    <span class="hljs-keyword">if</span> (depth - <span class="hljs-number">2</span>) % <span class="hljs-number">6</span> != <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;depth should be 6n+2 (eg 20, 32, 44 in [a])&#x27;</span>)<br>    <span class="hljs-comment"># Start model definition.</span><br>    num_filters = <span class="hljs-number">16</span><br>    num_res_blocks = <span class="hljs-built_in">int</span>((depth - <span class="hljs-number">2</span>) / <span class="hljs-number">6</span>)<br><br>    inputs = Input(shape=input_shape)<br>    x = resnet_layer(inputs=inputs)<br>    <span class="hljs-comment"># Instantiate the stack of residual units</span><br>    <span class="hljs-keyword">for</span> stack <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        <span class="hljs-keyword">for</span> res_block <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_res_blocks):<br>            strides = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> stack &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> res_block == <span class="hljs-number">0</span>:  <span class="hljs-comment"># first layer but not first stack</span><br>                strides = <span class="hljs-number">2</span>  <span class="hljs-comment"># downsample</span><br>            y = resnet_layer(inputs=x,<br>                             num_filters=num_filters,<br>                             strides=strides)<br>            y = resnet_layer(inputs=y,<br>                             num_filters=num_filters,<br>                             activation=<span class="hljs-literal">None</span>)<br>            <span class="hljs-keyword">if</span> stack &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> res_block == <span class="hljs-number">0</span>:  <span class="hljs-comment"># first layer but not first stack</span><br>                <span class="hljs-comment"># linear projection residual shortcut connection to match</span><br>                <span class="hljs-comment"># changed dims</span><br>                x = resnet_layer(inputs=x,<br>                                 num_filters=num_filters,<br>                                 kernel_size=<span class="hljs-number">1</span>,<br>                                 strides=strides,<br>                                 activation=<span class="hljs-literal">None</span>,<br>                                 batch_normalization=<span class="hljs-literal">False</span>)<br>            x = keras.layers.add([x, y])<br>            x = Activation(<span class="hljs-string">&#x27;relu&#x27;</span>)(x)<br>        num_filters *= <span class="hljs-number">2</span><br><br>    <span class="hljs-comment"># Add classifier on top.</span><br>    <span class="hljs-comment"># v1 does not use BN after last shortcut connection-ReLU</span><br>    x = AveragePooling2D(pool_size=<span class="hljs-number">8</span>)(x)<br>    y = Flatten()(x)<br>    outputs = Dense(num_classes,<br>                    activation=<span class="hljs-string">&#x27;softmax&#x27;</span>,<br>                    kernel_initializer=<span class="hljs-string">&#x27;he_normal&#x27;</span>)(y)<br><br>    <span class="hljs-comment"># Instantiate model.</span><br>    model = Model(inputs=inputs, outputs=outputs)<br>    <span class="hljs-keyword">return</span> model<br><br><br>model = resnet_v1(input_shape=input_shape, depth=depth, num_classes=num_classes)<br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>,<br>              optimizer=Adam(lr=lr_schedule(<span class="hljs-number">0</span>)),<br>              metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>model.summary()<br><span class="hljs-built_in">print</span>(model_type)<br><br><span class="hljs-comment"># Prepare model model saving directory.</span><br>save_dir = os.path.join(os.getcwd(), <span class="hljs-string">&#x27;saved_models&#x27;</span>)<br>model_name = <span class="hljs-string">&#x27;garbage_%s_model.&#123;epoch:03d&#125;.h5&#x27;</span> % model_type<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isdir(save_dir):<br>    os.makedirs(save_dir)<br>filepath = os.path.join(save_dir, model_name)<br><br><span class="hljs-comment"># Prepare callbacks for model saving and for learning rate adjustment.</span><br>checkpoint = ModelCheckpoint(filepath=filepath,<br>                             monitor=<span class="hljs-string">&#x27;val_acc&#x27;</span>,<br>                             verbose=<span class="hljs-number">1</span>,<br>                             save_best_only=<span class="hljs-literal">True</span>)<br><br>lr_scheduler = LearningRateScheduler(lr_schedule)<br><br>lr_reducer = ReduceLROnPlateau(factor=np.sqrt(<span class="hljs-number">0.1</span>),<br>                               cooldown=<span class="hljs-number">0</span>,<br>                               patience=<span class="hljs-number">5</span>,<br>                               min_lr=<span class="hljs-number">0.5e-6</span>)<br><br>callbacks = [checkpoint, lr_reducer, lr_scheduler]<br><br><span class="hljs-comment"># Run training, with data augmentation.</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Using real-time data augmentation.&#x27;</span>)<br><span class="hljs-comment"># This will do preprocessing and realtime data augmentation:</span><br>datagen = ImageDataGenerator(<br>        <span class="hljs-comment"># set input mean to 0 over the dataset</span><br>        featurewise_center=<span class="hljs-literal">False</span>,<br>        <span class="hljs-comment"># set each sample mean to 0</span><br>        samplewise_center=<span class="hljs-literal">False</span>,<br>        <span class="hljs-comment"># divide inputs by std of dataset</span><br>        featurewise_std_normalization=<span class="hljs-literal">False</span>,<br>        <span class="hljs-comment"># divide each input by its std</span><br>        samplewise_std_normalization=<span class="hljs-literal">False</span>,<br>        <span class="hljs-comment"># apply ZCA whitening</span><br>        zca_whitening=<span class="hljs-literal">False</span>,<br>        <span class="hljs-comment"># epsilon for ZCA whitening</span><br>        zca_epsilon=<span class="hljs-number">1e-06</span>,<br>        <span class="hljs-comment"># randomly rotate images in the range (deg 0 to 180)</span><br>        rotation_range=<span class="hljs-number">0</span>,<br>        <span class="hljs-comment"># randomly shift images horizontally</span><br>        width_shift_range=<span class="hljs-number">0.1</span>,<br>        <span class="hljs-comment"># randomly shift images vertically</span><br>        height_shift_range=<span class="hljs-number">0.1</span>,<br>        <span class="hljs-comment"># set range for random shear</span><br>        shear_range=<span class="hljs-number">0.</span>,<br>        <span class="hljs-comment"># set range for random zoom</span><br>        zoom_range=<span class="hljs-number">0.</span>,<br>        <span class="hljs-comment"># set range for random channel shifts</span><br>        channel_shift_range=<span class="hljs-number">0.</span>,<br>        <span class="hljs-comment"># set mode for filling points outside the input boundaries</span><br>        fill_mode=<span class="hljs-string">&#x27;nearest&#x27;</span>,<br>        <span class="hljs-comment"># value used for fill_mode = &quot;constant&quot;</span><br>        cval=<span class="hljs-number">0.</span>,<br>        <span class="hljs-comment"># randomly flip images</span><br>        horizontal_flip=<span class="hljs-literal">True</span>,<br>        <span class="hljs-comment"># randomly flip images</span><br>        vertical_flip=<span class="hljs-literal">False</span>,<br>        <span class="hljs-comment"># set rescaling factor (applied before any other transformation)</span><br>        rescale=<span class="hljs-literal">None</span>,<br>        <span class="hljs-comment"># set function that will be applied on each input</span><br>        preprocessing_function=<span class="hljs-literal">None</span>,<br>        <span class="hljs-comment"># image data format, either &quot;channels_first&quot; or &quot;channels_last&quot;</span><br>        data_format=<span class="hljs-literal">None</span>,<br>        <span class="hljs-comment"># fraction of images reserved for validation (strictly between 0 and 1)</span><br>        validation_split=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-comment"># Compute quantities required for featurewise normalization</span><br><span class="hljs-comment"># (std, mean, and principal components if ZCA whitening is applied).</span><br>datagen.fit(x_train)<br><br><span class="hljs-comment"># Fit the model on the batches generated by datagen.flow().</span><br>model.fit_generator(datagen.flow(x_train, y_train, batch_size=batch_size),<br>                    steps_per_epoch=<span class="hljs-built_in">len</span>(x_train) // batch_size,<br>                    validation_data=(x_test, y_test),<br>                    epochs=epochs, verbose=<span class="hljs-number">1</span>, workers=<span class="hljs-number">4</span>,<br>                    callbacks=callbacks)<br><br><span class="hljs-comment"># Score trained model.</span><br>scores = model.evaluate(x_test, y_test, verbose=<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Test loss:&#x27;</span>, scores[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Test accuracy:&#x27;</span>, scores[<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„æ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/keras5_7.png" alt="æ¨¡å‹ç»“æ„" /><figcaption aria-hidden="true">æ¨¡å‹ç»“æ„</figcaption></figure><p>åœ¨GPUä¸Šè¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œè®­ç»ƒç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Test loss: 0.4439272038936615<br>Test accuracy: 0.9128<br></code></pre></td></tr></table></figure><figure><img src="/img/keras5_8.png" alt="è®­ç»ƒè¿‡ç¨‹è¾“å‡º" /><figcaption aria-hidden="true">è®­ç»ƒè¿‡ç¨‹è¾“å‡º</figcaption></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼šhttps://github.com/percent4/resnet_4_cifar10ã€‚</p><p>æ„Ÿè°¢å¤§å®¶é˜…è¯»ï¼Œæœ‰é—®é¢˜è¯·æ‰¹è¯„æŒ‡æ­£~</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Keras</tag>
      
      <tag>ResNet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keraså…¥é—¨ï¼ˆå››ï¼‰åˆ©ç”¨CNNæ¨¡å‹è½»æ¾ç ´è§£ç½‘ç«™éªŒè¯ç </title>
    <link href="/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E5%88%A9%E7%94%A8CNN%E6%A8%A1%E5%9E%8B%E8%BD%BB%E6%9D%BE%E7%A0%B4%E8%A7%A3%E7%BD%91%E7%AB%99%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    <url>/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E5%88%A9%E7%94%A8CNN%E6%A8%A1%E5%9E%8B%E8%BD%BB%E6%9D%BE%E7%A0%B4%E8%A7%A3%E7%BD%91%E7%AB%99%E9%AA%8C%E8%AF%81%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="é¡¹ç›®ç®€ä»‹">é¡¹ç›®ç®€ä»‹</h3><p>åœ¨ä¹‹å‰çš„æ–‡ç« <ahref="https://www.jianshu.com/p/b653c0781073">keraså…¥é—¨ï¼ˆä¸‰ï¼‰æ­å»ºCNNæ¨¡å‹ç ´è§£ç½‘ç«™éªŒè¯ç </a>ä¸­ï¼Œç¬”è€…ä»‹ç»ä»‹ç»äº†å¦‚ä½•ç”¨Kerasæ¥æ­å»ºCNNæ¨¡å‹æ¥ç ´è§£ç½‘ç«™çš„éªŒè¯ç ï¼Œå…¶ä¸­éªŒè¯ç å«æœ‰å­—æ¯å’Œæ•°å­—ã€‚</p><p>è®©æˆ‘ä»¬ä¸€èµ·å›é¡¾ä¸€ä¸‹<ahref="https://www.jianshu.com/p/b653c0781073">é‚£ç¯‡æ–‡ç« </a>çš„å¤„ç†æ€è·¯ï¼š</p><ul><li><p>åˆ©ç”¨OpenCVå¯¹å›¾åƒè¿›è¡Œå•ä¸ªå­—ç¬¦çš„åˆ‡å‰²ï¼Œå¤§æ¦‚400å¤šå¼ å›¾ç‰‡ï¼›</p></li><li><p>å¯¹åˆ‡å‰²å¥½çš„å•ä¸ªå­—ç¬¦è¿›è¡Œäººå·¥æ‰‹åŠ¨æ ‡è®°ï¼›</p></li><li><p>æ­å»ºåˆé€‚çš„CNNæ¨¡å‹ï¼Œå¯¹æ ‡è®°å¥½çš„æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼›</p></li><li><p>å¯¹äºæ–°çš„éªŒè¯ç ï¼Œå…ˆåˆ‡å‰²å•ä¸ªå­—ç¬¦ï¼Œå†å¯¹å•ä¸ªå­—ç¬¦è¿›è¡Œé¢„æµ‹ï¼Œç»„æˆæ€»çš„é¢„æµ‹ç»“æœã€‚</p><p>è¿™ä¸€æ¬¡ï¼Œç¬”è€…å°†ä¼šæ¢ç§æ€è·¯ï¼Œä½¿ç”¨CNNæ¨¡å‹æ¥ç ´è§£ç½‘ç«™çš„éªŒè¯ç ã€‚æˆ‘ä»¬çš„æ•°æ®é›†å¦‚ä¸‹ï¼š</p></li></ul><p><img src="/img/keras4_1.png" /></p><p>ä¸€å…±æ˜¯946å¼ å›¾ç‰‡ï¼Œè¿™é‡Œåªå±•ç¤ºäº†ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›éªŒè¯ç å…¨éƒ¨ç”±æ•°å­—ç»„æˆã€‚é‚£ä¹ˆï¼Œæ–°çš„ç ´è§£éªŒè¯ç çš„æ€è·¯æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p><ul><li>ç›´æ¥å¯¹éªŒè¯ç è¿›è¡Œæ ‡è®°ï¼Œæ ‡è®°çš„ç»“æœè§ä¸Šå›¾ï¼›</li><li>æ­å»ºåˆé€‚çš„CNNæ¨¡å‹å¯¹æ ‡è®°å¥½çš„æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼›</li><li>å¯¹æ–°éªŒè¯ç è¿›è¡Œé¢„æµ‹ã€‚</li></ul><p>è¿™ç§æ€è·¯çš„å¥½å¤„æ˜¯ï¼Œä¸éœ€è¦å¯¹éªŒè¯ç è¿›è¡Œç¹ççš„é¢„å¤„ç†ï¼Œåªéœ€è¦ç®€å•çš„æ•°æ®æ ‡è®°å³å¯ã€‚</p><p>ä¸‹é¢ï¼Œç¬”è€…å°†ä¼šå…·ä½“å±•ç¤ºè¿™ä¸ªè¿‡ç¨‹ã€‚</p><h3 id="æ•°æ®æ ‡è®°">æ•°æ®æ ‡è®°</h3><p>æ•°æ®æ ‡è®°ç»å¯¹æ˜¯ä¸ªç´¯æ´»ï¼Œå½“æˆ‘æƒ³åˆ°è¦å¯¹946å¼ å›¾ç‰‡è¿›è¡Œæ ‡è®°å¹¶é‡å‘½åï¼Œè€Œä¸”è¿˜è¦ä¿è¯æ ‡è®°çš„å‡†ç¡®æ€§çš„æ—¶å€™ï¼Œæˆ‘å¼€å§‹æ˜¯æœ‰ç‚¹æ‹’ç»çš„å¿ƒæ€ï¼Œæ¯•ç«Ÿè¿™é¡¹å·¥ä½œè´¹æ—¶è´¹åŠ›ï¼Œè€Œä¸”èƒ½ä¸èƒ½ä¿è¯è¯†åˆ«çš„æ•ˆæœè¿˜æ˜¯ä¸ªæœªçŸ¥æ•°ã€‚</p><p>å°±è¿™ä¹ˆçº ç»“äº†ä¸€æ®µæ—¶é—´ï¼ŒåŸæœ¬å¹´å‰å°±æƒ³åšçš„é¡¹ç›®ä¸€ç›´æ‹–åˆ°äº†ç°åœ¨ï¼Œåæ¥æˆ‘æƒ³ï¼Œèƒ½ä¸èƒ½å†™ä¸ªè„šæœ¬ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘å¿«é€Ÿåœ°è¿›è¡Œæ•°æ®æ ‡æ³¨ï¼Œå¹¶è‡ªåŠ¨ä¿å­˜å‘¢ï¼Ÿè¿™ä¹ˆæƒ³ç€ï¼Œæˆ‘å°±åŠ¨æ‰‹è‡ªå·±åšäº†ä¸€ä¸ªç”±Tornadoå®ç°çš„å‰ç«¯é¡µé¢ï¼Œå¯ä»¥å¸®åŠ©æˆ‘å¿«é€Ÿåœ°æ ‡è®°æ•°æ®å¹¶ä¿å­˜å›¾ç‰‡ï¼Œé¡µé¢å¦‚ä¸‹ï¼š</p><figure><img src="/img/keras4_2.png" alt="æ•°æ®æ ‡è®°ç•Œé¢.png" /><figcaption aria-hidden="true">æ•°æ®æ ‡è®°ç•Œé¢.png</figcaption></figure><p>ç•Œé¢è™½ç„¶ç®€é™‹ï¼Œå´èƒ½å¸®åŠ©æˆ‘å¾ˆå¥½åœ°æå‡æ•°æ®æ ‡è®°çš„é€Ÿåº¦ï¼Œåªéœ€è¦åœ¨valueæ–‡æœ¬æ¡†ä¸­è¾“å…¥è‡ªå·±è¯†åˆ«çš„ç»“æœï¼Œç¨‹åºå°±èƒ½è‡ªåŠ¨ä¿å­˜æ ‡è®°å¥½çš„å›¾ç‰‡ï¼Œå¹¶åˆ‡æ¢è‡³ä¸‹ä¸€å¼ æœªæ ‡è®°çš„éªŒè¯ç ã€‚æœ‰äº†å¦‚æ­¤å¥½çš„å·¥å…·ï¼Œç»“æœæˆ‘ç”¨äº†ä¸åˆ°ä¸€å°æ—¶å°±æ ‡è®°å®Œäº†è¿™946å¼ éªŒè¯ç ï¼ˆå…¶å®æ˜¯1000å¼ ï¼Œå› ä¸ºæ ‡è®°å¥½çš„ç»“æœä¼šæœ‰é‡å¤ï¼‰ã€‚æœ‰æœºä¼šç¬”è€…ä¼šä»‹ç»è¿™ä¸ªéªŒè¯ç æ ‡è®°çš„é¡¹ç›®ï½</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æ ‡è®°å®ŒéªŒè¯ç åï¼Œæˆ‘ä»¬å°±åˆ©ç”¨è¿™946å¼ éªŒè¯ç ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œè®­ç»ƒCNNæ¨¡å‹ã€‚æˆ‘ä»¬ä½¿ç”¨Kerasæ¡†æ¶ï¼ŒCNNæ¨¡å‹çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/keras4_3.png" /></p><p>æ¨¡å‹è®­ç»ƒçš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># CNNæ¨¡å‹è®­ç»ƒ</span><br><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras <span class="hljs-keyword">import</span> callbacks<br><br>characters = <span class="hljs-string">&#x27;0123456789&#x27;</span><br>width, height, n_len, n_class = <span class="hljs-number">50</span>, <span class="hljs-number">22</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span><br><br><span class="hljs-comment"># äº§ç”Ÿè®­ç»ƒçš„ä¸€æ‰¹å›¾ç‰‡ï¼Œé»˜è®¤æ˜¯32å¼ å›¾ç‰‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen</span>(<span class="hljs-params"><span class="hljs-built_in">dir</span>, batch_size=<span class="hljs-number">32</span></span>):<br>    X = np.zeros((batch_size, height, width, <span class="hljs-number">3</span>), dtype=np.uint8)<br>    y = [np.zeros((batch_size, n_class), dtype=np.uint8) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n_len)]<br>    files = os.listdir(<span class="hljs-built_in">dir</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(batch_size):<br>            path = random.choice(files)<br>            imagePixel = cv2.imread(<span class="hljs-built_in">dir</span>+<span class="hljs-string">&#x27;/&#x27;</span>+path, <span class="hljs-number">1</span>)<br>            filename = path[:<span class="hljs-number">4</span>]<br>            X[i] = imagePixel<br>            <span class="hljs-keyword">for</span> j, ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(filename):<br>                y[j][i, :] = <span class="hljs-number">0</span><br>                y[j][i, characters.find(ch)] = <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">yield</span> X, y<br><br><br>input_tensor = Input((height, width, <span class="hljs-number">3</span>))<br>x = input_tensor<br><br><span class="hljs-comment"># äº§ç”Ÿæœ‰å››ä¸ªblockçš„å·ç§¯ç¥ç»ç½‘ç»œ</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    <span class="hljs-comment"># å·ç§¯å±‚</span><br>    x = Conv2D(<span class="hljs-number">32</span> * <span class="hljs-number">2</span> ** i, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">&#x27;relu&#x27;</span>, padding=<span class="hljs-string">&#x27;same&#x27;</span>)(x)<br>    x = Conv2D(<span class="hljs-number">32</span> * <span class="hljs-number">2</span> ** i, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">&#x27;relu&#x27;</span>, padding=<span class="hljs-string">&#x27;same&#x27;</span>)(x)<br>    <span class="hljs-comment"># æ± åŒ–å±‚</span><br>    x = MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>))(x)<br><br>x = Flatten()(x)<br>x = Dropout(<span class="hljs-number">0.25</span>)(x)<br><br><span class="hljs-comment"># å¤šè¾“å‡ºæ¨¡å‹ï¼Œä½¿ç”¨äº†4ä¸ª&#x27;softmax&#x27;ä¾†åˆ†åˆ«é¢„æµ‹4å€‹å­—æ¯çš„è¾“å‡º</span><br>x = [Dense(n_class, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>, name=<span class="hljs-string">&#x27;c%d&#x27;</span> % (i + <span class="hljs-number">1</span>))(x) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br>model = Model(inputs=input_tensor, outputs=x)<br>model.summary()<br><br><span class="hljs-comment"># ä¿å­˜æ¨¡å‹ç»“æ„å›¾</span><br><span class="hljs-keyword">from</span> keras.utils.vis_utils <span class="hljs-keyword">import</span> plot_model<br>plot_model(model, to_file=<span class="hljs-string">&quot;./model.png&quot;</span>, show_shapes=<span class="hljs-literal">True</span>)<br><br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>,<br>              optimizer=<span class="hljs-string">&#x27;adadelta&#x27;</span>,<br>              metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br><span class="hljs-comment"># ä¿å­˜æ•ˆæœæœ€å¥½çš„æ¨¡å‹</span><br>cbks = [callbacks.ModelCheckpoint(<span class="hljs-string">&quot;best_model.h5&quot;</span>, save_best_only=<span class="hljs-literal">True</span>)]<br><br><span class="hljs-built_in">dir</span> = <span class="hljs-string">&#x27;./result&#x27;</span><br>history = model.fit_generator(gen(<span class="hljs-built_in">dir</span>, batch_size=<span class="hljs-number">8</span>),      <span class="hljs-comment"># æ¯æ¬¡ç”Ÿæˆå™¨ä¼šäº§ç”Ÿ8å¼ å°æ‰¹é‡çš„å›¾ç‰‡</span><br>                    steps_per_epoch=<span class="hljs-number">120</span>,    <span class="hljs-comment"># æ¯æ¬¡çš„epochè¦è®­ç»ƒ120æ‰¹å›¾ç‰‡</span><br>                    epochs=<span class="hljs-number">50</span>,                <span class="hljs-comment"># æ€»å…±è®­ç»ƒ50æ¬¡</span><br>                    callbacks=cbks,          <span class="hljs-comment"># ä¿å­˜æœ€å¥½çš„æ¨¡å‹</span><br>                    validation_data=gen(<span class="hljs-built_in">dir</span>),   <span class="hljs-comment"># éªŒè¯æ•°æ®ä¹Ÿæ˜¯ç”¨ç”Ÿæˆå™¨ä¾†äº§ç”Ÿ</span><br>                    validation_steps=<span class="hljs-number">10</span>      <span class="hljs-comment"># ç”¨10ç»„å›¾ç‰‡æ¥è¿›è¡ŒéªŒè¯</span><br>                   )<br><br><span class="hljs-comment"># ç»˜åˆ¶æŸå¤±å€¼å›¾åƒ</span><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_train_history</span>(<span class="hljs-params">history, train_metrics, val_metrics</span>):<br>    plt.plot(history.history.get(train_metrics), <span class="hljs-string">&#x27;-o&#x27;</span>)<br>    plt.plot(history.history.get(val_metrics), <span class="hljs-string">&#x27;-o&#x27;</span>)<br>    plt.ylabel(train_metrics)<br>    plt.xlabel(<span class="hljs-string">&#x27;Epochs&#x27;</span>)<br>    plt.legend([<span class="hljs-string">&#x27;train&#x27;</span>, <span class="hljs-string">&#x27;validation&#x27;</span>])<br><br><br><span class="hljs-comment"># æ‰“å°æ•´ä½“çš„lossä¸val_lossï¼Œå¹¶ä¿å­˜å›¾ç‰‡</span><br>plot_train_history(history, <span class="hljs-string">&#x27;loss&#x27;</span>, <span class="hljs-string">&#x27;val_loss&#x27;</span>)<br>plt.savefig(<span class="hljs-string">&#x27;./all_loss.png&#x27;</span>)<br><br>plt.figure(figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">4</span>))<br><br><span class="hljs-comment"># ç¬¬ä¸€ä¸ªæ•°å­—çš„æ­£ç¡®ç‡</span><br>plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)<br>plot_train_history(history, <span class="hljs-string">&#x27;c1_acc&#x27;</span>, <span class="hljs-string">&#x27;val_c1_acc&#x27;</span>)<br><br><span class="hljs-comment"># ç¬¬äºŒä¸ªæ•°å­—çš„æ­£ç¡®ç‡</span><br>plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>plot_train_history(history, <span class="hljs-string">&#x27;c2_acc&#x27;</span>, <span class="hljs-string">&#x27;val_c2_acc&#x27;</span>)<br><br><span class="hljs-comment"># ç¬¬ä¸‰å€‹æ•°å­—çš„æ­£ç¢ºç‡</span><br>plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>plot_train_history(history, <span class="hljs-string">&#x27;c3_acc&#x27;</span>, <span class="hljs-string">&#x27;val_c3_acc&#x27;</span>)<br><br><span class="hljs-comment"># ç¬¬å››å€‹æ•°å­—çš„æ­£ç¡®ç‡</span><br>plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>)<br>plot_train_history(history, <span class="hljs-string">&#x27;c4_acc&#x27;</span>, <span class="hljs-string">&#x27;val_c4_acc&#x27;</span>)<br><br><span class="hljs-comment"># ä¿å­˜å›¾ç‰‡</span><br>plt.savefig(<span class="hljs-string">&#x27;./train.png&#x27;</span>)<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œæˆ‘ä»¬æ€»å…±è®­ç»ƒäº†50ä¸ªepochï¼Œæ¯ä¸ªepochå…±120æ¬¡æ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡æ˜¯8å¼ éªŒè¯ç ï¼Œæ¯å¼ éªŒè¯ç çš„å¤§å°ä¸º50*22ã€‚</p><p>è¿è¡Œè¯¥è®­ç»ƒæ¨¡å‹ï¼Œåå‡ ä¸ªepochçš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/img/keras4_4.png" /></p><p>æ€»çš„æŸå¤±å€¼å›¾åƒå¦‚ä¸‹ï¼š</p><p><img src="/img/keras4_5.png" /></p><p>å››ä¸ªæ•°å­—æ¯ä¸ªæ•°å­—çš„æŸå¤±å€¼å›¾åƒå¦‚ä¸‹ï¼š</p><p><img src="/img/keras4_6.png" /></p><p>è®­ç»ƒå®Œåï¼Œç¨‹åºä¼šå°†è®­ç»ƒæ•ˆæœæœ€å¥½çš„epochä¿å­˜ä¸ºbest_model.h5æ–‡ä»¶ï¼Œä¾¿äºåç»­çš„æ¨¡å‹é¢„æµ‹ã€‚ç”±è¾“å‡ºçš„ç»“æœåŠå›¾åƒæ¥çœ‹ï¼Œè¯¥CNNæ¨¡å‹çš„è®­ç»ƒæ•ˆæœåº”è¯¥æ˜¯ç›¸å½“å¥½çš„ï¼Œä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¯¹æ–°éªŒè¯ç çš„é¢„æµ‹æ•ˆæœã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æ–°çš„éªŒè¯ç å…±æœ‰20å¼ ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/img/keras4_7.png" /></p><p>æ¨¡å‹é¢„æµ‹çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä½¿ç”¨è®­ç»ƒå¥½çš„CNNæ¨¡å‹å¯¹æ–°å›¾ç‰‡è¿›è¡Œé¢„æµ‹</span><br><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># å¯¼å…¥è®­ç»ƒå¥½çš„æ¨¡å‹</span><br>model = load_model(<span class="hljs-string">&#x27;best_model.h5&#x27;</span>)<br><br>batch_size = <span class="hljs-number">20</span><br>width, height, n_len, n_class = <span class="hljs-number">50</span>, <span class="hljs-number">22</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span><br><br><span class="hljs-comment"># å¯¼å…¥éªŒè¯ç æ•°æ®å¹¶è¿›è¡Œé¢„æµ‹</span><br>X = np.zeros((batch_size, height, width, <span class="hljs-number">3</span>), dtype=np.uint8)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(batch_size):<br>    X_test = cv2.imread(<span class="hljs-string">&#x27;./new_image/code%d.png&#x27;</span> %(i+<span class="hljs-number">1</span>), <span class="hljs-number">1</span>)<br>    X[i] = X_test<br><br>y_pred = model.predict(X)<br>y_pred = np.argmax(y_pred, axis=<span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># è¾“å‡ºæ¯å¼ éªŒè¯ç çš„é¢„æµ‹ç»“æœ</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(batch_size):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç¬¬%då¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š&#x27;</span> %(i+<span class="hljs-number">1</span>), end=<span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, y_pred[:, i].tolist())))<br></code></pre></td></tr></table></figure><p>è¿è¡Œè¯¥æ¨¡å‹ï¼Œå¾—åˆ°çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs">ç¬¬1å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š3568<br>ç¬¬2å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š5402<br>ç¬¬3å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š6051<br>ç¬¬4å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š6769<br>ç¬¬5å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š2675<br>ç¬¬6å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š2450<br>ç¬¬7å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š2364<br>ç¬¬8å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š6879<br>ç¬¬9å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š3702<br>ç¬¬10å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š3459<br>ç¬¬11å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š5895<br>ç¬¬12å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š8042<br>ç¬¬13å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š6897<br>ç¬¬14å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š6558<br>ç¬¬15å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š9428<br>ç¬¬16å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š5662<br>ç¬¬17å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š5431<br>ç¬¬18å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š4981<br>ç¬¬19å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š0567<br>ç¬¬20å¼ éªŒè¯ç çš„è¯†åˆ«ç»“æœä¸ºï¼š5239<br></code></pre></td></tr></table></figure><p>å¯¹è¿™20å¼ æ–°çš„éªŒè¯ç ï¼Œé¢„æµ‹å®Œå…¨æ­£ç¡®ï¼ä¸å¾—ä¸è¯´ï¼ŒCNNæ¨¡å‹çš„è¯†åˆ«æ•ˆæœéå¸¸å¥½ï¼</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡é‡‡ç”¨äº†ä¸€ç§æ–°çš„æ€è·¯ï¼Œæ­å»ºCNNæ¨¡å‹æ¥å®ç°éªŒè¯ç çš„è¯†åˆ«ï¼Œå–å¾—äº†ä¸é”™çš„è¯†åˆ«æ•ˆæœï¼Œè€Œä¸”è¯†åˆ«çš„éªŒè¯ç æ˜¯ä»ç½‘é¡µä¸­ä¸‹è½½ä¸‹æ¥çš„ï¼Œå…·æœ‰å®é™…èƒŒæ™¯ï¼Œå¢å¼ºäº†è¯¥é¡¹ç›®çš„åº”ç”¨æ€§ã€‚</p><p>æœ¬é¡¹ç›®å·²æ”¾è‡³Githubï¼Œåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/CAPTCHA-Recognizition">https://github.com/percent4/CAPTCHA-Recognizition</a>ã€‚</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Keras</tag>
      
      <tag>CNN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>keraså…¥é—¨ï¼ˆä¸‰ï¼‰æ­å»ºCNNæ¨¡å‹ç ´è§£ç½‘ç«™éªŒè¯ç </title>
    <link href="/2023/08/06/keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E6%90%AD%E5%BB%BACNN%E6%A8%A1%E5%9E%8B%E7%A0%B4%E8%A7%A3%E7%BD%91%E7%AB%99%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    <url>/2023/08/06/keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E6%90%AD%E5%BB%BACNN%E6%A8%A1%E5%9E%8B%E7%A0%B4%E8%A7%A3%E7%BD%91%E7%AB%99%E9%AA%8C%E8%AF%81%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="é¡¹ç›®ä»‹ç»">é¡¹ç›®ä»‹ç»</h3><p>åœ¨æ–‡ç« <ahref="https://www.jianshu.com/p/0287bcd24f78">CNNå¤§æˆ˜éªŒè¯ç </a>ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨TensorFlowæ­å»ºäº†ç®€å•çš„CNNæ¨¡å‹æ¥ç ´è§£æŸä¸ªç½‘ç«™çš„éªŒè¯ç ã€‚éªŒè¯ç å¦‚ä¸‹ï¼š</p><p><img src="/img/keras3_1.png" /></p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šç”¨Kerasæ¥æ­å»ºä¸€ä¸ªç¨å¾®å¤æ‚çš„CNNæ¨¡å‹æ¥ç ´è§£ä»¥ä¸Šçš„éªŒè¯ç ã€‚</p><h3 id="æ•°æ®é›†">æ•°æ®é›†</h3><p>å¯¹äºéªŒè¯ç å›¾ç‰‡çš„å¤„ç†è¿‡ç¨‹åœ¨æœ¬æ–‡ä¸­å°†ä¸å†å…·ä½“å™è¿°ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://www.jianshu.com/p/0287bcd24f78">CNNå¤§æˆ˜éªŒè¯ç </a>ã€‚</p><p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨çš„æ ·æœ¬ä¸€å…±æ˜¯1668ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦å›¾ç‰‡ï¼Œå­—ç¬¦å›¾ç‰‡çš„å¤§å°ä¸º16*20ã€‚æ ·æœ¬çš„ç‰¹å¾ä¸ºå­—ç¬¦å›¾ç‰‡çš„åƒç´ ï¼Œ0ä»£è¡¨ç™½è‰²ï¼Œ1ä»£è¡¨é»‘è‰²ï¼Œæ¯ä¸ªæ ·æœ¬ä¸º320ä¸ªç‰¹å¾ï¼Œå–å€¼ä¸º0æˆ–1ï¼Œç‰¹å¾å˜é‡åç§°ä¸ºv1åˆ°v320ï¼Œæ ·æœ¬çš„ç±»åˆ«æ ‡ç­¾å³ä¸ºè¯¥å­—ç¬¦ã€‚æ•´ä¸ªæ•°æ®é›†çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š</p><p><img src="/img/keras3_2.png" /></p><h3 id="cnnæ¨¡å‹">CNNæ¨¡å‹</h3><p>åˆ©ç”¨Keraså¯ä»¥å¿«é€Ÿæ–¹ä¾¿åœ°æ­å»ºCNNæ¨¡å‹ï¼Œæœ¬æ–‡æ­å»ºçš„CNNæ¨¡å‹å¦‚ä¸‹ï¼š</p><p><img src="/img/keras3_3.png" /></p><p>å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå æ¯”ä¸º8ï¼š2ï¼Œè¯¥æ¨¡å‹è®­ç»ƒçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> np_utils, plot_model<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Sequential<br><span class="hljs-keyword">from</span> keras.layers.core <span class="hljs-keyword">import</span> Dense, Dropout, Activation, Flatten<br><span class="hljs-keyword">from</span> keras.callbacks <span class="hljs-keyword">import</span> EarlyStopping<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Conv2D, MaxPooling2D<br><br><span class="hljs-comment"># è¯»å–æ•°æ®</span><br>df = pd.read_csv(<span class="hljs-string">&#x27;F://verifycode_data/data.csv&#x27;</span>)<br><br><span class="hljs-comment"># æ ‡ç­¾å€¼</span><br>vals = <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>)<br>keys = [<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>,<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;C&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;E&#x27;</span>,<span class="hljs-string">&#x27;F&#x27;</span>,<span class="hljs-string">&#x27;G&#x27;</span>,<span class="hljs-string">&#x27;H&#x27;</span>,<span class="hljs-string">&#x27;J&#x27;</span>,<span class="hljs-string">&#x27;K&#x27;</span>,<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-string">&#x27;N&#x27;</span>,<span class="hljs-string">&#x27;P&#x27;</span>,<span class="hljs-string">&#x27;Q&#x27;</span>,<span class="hljs-string">&#x27;R&#x27;</span>,<span class="hljs-string">&#x27;S&#x27;</span>,<span class="hljs-string">&#x27;T&#x27;</span>,<span class="hljs-string">&#x27;U&#x27;</span>,<span class="hljs-string">&#x27;V&#x27;</span>,<span class="hljs-string">&#x27;X&#x27;</span>,<span class="hljs-string">&#x27;Y&#x27;</span>,<span class="hljs-string">&#x27;Z&#x27;</span>]<br>label_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(keys, vals))<br><br>x_data = df[[<span class="hljs-string">&#x27;v&#x27;</span>+<span class="hljs-built_in">str</span>(i+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">320</span>)]]<br>y_data = pd.DataFrame(&#123;<span class="hljs-string">&#x27;label&#x27;</span>:df[<span class="hljs-string">&#x27;label&#x27;</span>]&#125;)<br>y_data[<span class="hljs-string">&#x27;class&#x27;</span>] = y_data[<span class="hljs-string">&#x27;label&#x27;</span>].apply(<span class="hljs-keyword">lambda</span> x: label_dict[x])<br><br><span class="hljs-comment"># å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br>X_train, X_test, Y_train, Y_test = train_test_split(x_data, y_data[<span class="hljs-string">&#x27;class&#x27;</span>], test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)<br>x_train = np.array(X_train).reshape((<span class="hljs-number">1167</span>, <span class="hljs-number">20</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>))<br>x_test = np.array(X_test).reshape((<span class="hljs-number">501</span>, <span class="hljs-number">20</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>))<br><br><span class="hljs-comment"># å¯¹æ ‡ç­¾å€¼è¿›è¡Œone-hot encoding</span><br>n_classes = <span class="hljs-number">31</span><br>y_train = np_utils.to_categorical(Y_train, n_classes)<br>y_val = np_utils.to_categorical(Y_test, n_classes)<br><br>input_shape = x_train[<span class="hljs-number">0</span>].shape<br><br><span class="hljs-comment"># CNNæ¨¡å‹</span><br>model = Sequential()<br><br><span class="hljs-comment"># å·ç§¯å±‚å’Œæ± åŒ–å±‚</span><br>model.add(Conv2D(<span class="hljs-number">32</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), input_shape=input_shape, padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br>model.add(Activation(<span class="hljs-string">&#x27;relu&#x27;</span>))<br>model.add(Conv2D(<span class="hljs-number">32</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br>model.add(Activation(<span class="hljs-string">&#x27;relu&#x27;</span>))<br>model.add(MaxPooling2D(pool_size=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br><br><span class="hljs-comment"># Dropoutå±‚</span><br>model.add(Dropout(<span class="hljs-number">0.25</span>))<br><br>model.add(Conv2D(<span class="hljs-number">64</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br>model.add(Activation(<span class="hljs-string">&#x27;relu&#x27;</span>))<br>model.add(Conv2D(<span class="hljs-number">64</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br>model.add(Activation(<span class="hljs-string">&#x27;relu&#x27;</span>))<br>model.add(MaxPooling2D(pool_size=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br><br>model.add(Dropout(<span class="hljs-number">0.25</span>))<br><br>model.add(Conv2D(<span class="hljs-number">128</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br>model.add(Activation(<span class="hljs-string">&#x27;relu&#x27;</span>))<br>model.add(Conv2D(<span class="hljs-number">128</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br>model.add(Activation(<span class="hljs-string">&#x27;relu&#x27;</span>))<br>model.add(MaxPooling2D(pool_size=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>))<br><br>model.add(Dropout(<span class="hljs-number">0.25</span>))<br><br>model.add(Flatten())<br><br><span class="hljs-comment"># å…¨è¿æ¥å±‚</span><br>model.add(Dense(<span class="hljs-number">256</span>, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br>model.add(Dropout(<span class="hljs-number">0.5</span>))<br>model.add(Dense(<span class="hljs-number">128</span>, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br>model.add(Dense(n_classes, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>))<br><br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>, optimizer=<span class="hljs-string">&#x27;adam&#x27;</span>, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br><span class="hljs-comment"># plot model</span><br>plot_model(model, to_file=<span class="hljs-string">r&#x27;./model.png&#x27;</span>, show_shapes=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br>callbacks = [EarlyStopping(monitor=<span class="hljs-string">&#x27;val_acc&#x27;</span>, patience=<span class="hljs-number">5</span>, verbose=<span class="hljs-number">1</span>)]<br>batch_size = <span class="hljs-number">64</span><br>n_epochs = <span class="hljs-number">100</span><br>history = model.fit(x_train, y_train, batch_size=batch_size, epochs=n_epochs, \<br>                    verbose=<span class="hljs-number">1</span>, validation_data=(x_test, y_val), callbacks=callbacks)<br><br>mp = <span class="hljs-string">&#x27;F://verifycode_data/verifycode_Keras.h5&#x27;</span><br>model.save(mp)<br><br><span class="hljs-comment"># ç»˜åˆ¶éªŒè¯é›†ä¸Šçš„å‡†ç¡®ç‡æ›²çº¿</span><br>val_acc = history.history[<span class="hljs-string">&#x27;val_acc&#x27;</span>]<br>plt.plot(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(val_acc)), val_acc, label=<span class="hljs-string">&#x27;CNN model&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;Validation accuracy on verifycode dataset&#x27;</span>)<br>plt.xlabel(<span class="hljs-string">&#x27;epochs&#x27;</span>)<br>plt.ylabel(<span class="hljs-string">&#x27;accuracy&#x27;</span>)<br>plt.legend()<br>plt.show()<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®­ç»ƒæ¨¡å‹çš„æ—¶å€™é‡‡ç”¨äº†early stoppingæŠ€å·§ã€‚earlystoppingæ˜¯ç”¨äºæå‰åœæ­¢è®­ç»ƒçš„callbacksã€‚å…·ä½“åœ°ï¼Œå¯ä»¥è¾¾åˆ°å½“è®­ç»ƒé›†ä¸Šçš„lossä¸åœ¨å‡å°ï¼ˆå³å‡å°çš„ç¨‹åº¦å°äºæŸä¸ªé˜ˆå€¼ï¼‰çš„æ—¶å€™åœæ­¢ç»§ç»­è®­ç»ƒã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>è¿è¡Œä¸Šè¿°æ¨¡å‹è®­ç»ƒä»£ç ï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">......(å¿½ç•¥ä¹‹å‰çš„è¾“å‡º)<br>Epoch 22/100<br><br>  64/1167 [&gt;.............................] - ETA: 3s - loss: 0.0399 - acc: 1.0000<br> 128/1167 [==&gt;...........................] - ETA: 3s - loss: 0.1195 - acc: 0.9844<br> 192/1167 [===&gt;..........................] - ETA: 2s - loss: 0.1085 - acc: 0.9792<br> 256/1167 [=====&gt;........................] - ETA: 2s - loss: 0.1132 - acc: 0.9727<br> 320/1167 [=======&gt;......................] - ETA: 2s - loss: 0.1045 - acc: 0.9750<br> 384/1167 [========&gt;.....................] - ETA: 2s - loss: 0.1006 - acc: 0.9740<br> 448/1167 [==========&gt;...................] - ETA: 2s - loss: 0.1522 - acc: 0.9643<br> 512/1167 [============&gt;.................] - ETA: 1s - loss: 0.1450 - acc: 0.9648<br> 576/1167 [=============&gt;................] - ETA: 1s - loss: 0.1368 - acc: 0.9653<br> 640/1167 [===============&gt;..............] - ETA: 1s - loss: 0.1353 - acc: 0.9641<br> 704/1167 [=================&gt;............] - ETA: 1s - loss: 0.1280 - acc: 0.9659<br> 768/1167 [==================&gt;...........] - ETA: 1s - loss: 0.1243 - acc: 0.9674<br> 832/1167 [====================&gt;.........] - ETA: 0s - loss: 0.1577 - acc: 0.9639<br> 896/1167 [======================&gt;.......] - ETA: 0s - loss: 0.1488 - acc: 0.9665<br> 960/1167 [=======================&gt;......] - ETA: 0s - loss: 0.1488 - acc: 0.9656<br>1024/1167 [=========================&gt;....] - ETA: 0s - loss: 0.1427 - acc: 0.9668<br>1088/1167 [==========================&gt;...] - ETA: 0s - loss: 0.1435 - acc: 0.9669<br>1152/1167 [============================&gt;.] - ETA: 0s - loss: 0.1383 - acc: 0.9688<br>1167/1167 [==============================] - 4s 3ms/step - loss: 0.1380 - acc: 0.9683 - val_loss: 0.0835 - val_acc: 0.9760<br>Epoch 00022: early stopping<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€å…±è®­ç»ƒäº†21æ¬¡ï¼Œæœ€è¿‘ä¸€æ¬¡çš„è®­ç»ƒåï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ä¸º96.83%ã€‚åœ¨æµ‹è¯•é›†çš„å‡†ç¡®ç‡æ›²çº¿å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/keras3_4.png" /></p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æ¨¡å‹è®­ç»ƒå®Œåï¼Œæˆ‘ä»¬å¯¹æ–°çš„éªŒè¯ç è¿›è¡Œé¢„æµ‹ã€‚æ–°çš„100å¼ éªŒè¯ç å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/keras3_5.png" /></p><p>ä½¿ç”¨è®­ç»ƒå¥½çš„CNNæ¨¡å‹ï¼Œå¯¹è¿™äº›æ–°çš„éªŒè¯ç è¿›è¡Œé¢„æµ‹ï¼Œé¢„æµ‹çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">split_picture</span>(<span class="hljs-params">imagepath</span>):<br><br>    <span class="hljs-comment"># ä»¥ç°åº¦æ¨¡å¼è¯»å–å›¾ç‰‡</span><br>    gray = cv2.imread(imagepath, <span class="hljs-number">0</span>)<br><br>    <span class="hljs-comment"># å°†å›¾ç‰‡çš„è¾¹ç¼˜å˜ä¸ºç™½è‰²</span><br>    height, width = gray.shape<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):<br>        gray[<span class="hljs-number">0</span>, i] = <span class="hljs-number">255</span><br>        gray[height-<span class="hljs-number">1</span>, i] = <span class="hljs-number">255</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):<br>        gray[j, <span class="hljs-number">0</span>] = <span class="hljs-number">255</span><br>        gray[j, width-<span class="hljs-number">1</span>] = <span class="hljs-number">255</span><br><br>    <span class="hljs-comment"># ä¸­å€¼æ»¤æ³¢</span><br>    blur = cv2.medianBlur(gray, <span class="hljs-number">3</span>) <span class="hljs-comment">#æ¨¡æ¿å¤§å°3*3</span><br><br>    <span class="hljs-comment"># äºŒå€¼åŒ–</span><br>    ret,thresh1 = cv2.threshold(blur, <span class="hljs-number">200</span>, <span class="hljs-number">255</span>, cv2.THRESH_BINARY)<br><br>    <span class="hljs-comment"># æå–å•ä¸ªå­—ç¬¦</span><br>    chars_list = []<br>    image, contours, hierarchy = cv2.findContours(thresh1, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">for</span> cnt <span class="hljs-keyword">in</span> contours:<br>        <span class="hljs-comment"># æœ€å°çš„å¤–æ¥çŸ©å½¢</span><br>        x, y, w, h = cv2.boundingRect(cnt)<br>        <span class="hljs-keyword">if</span> x != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> y != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> w*h &gt;= <span class="hljs-number">100</span>:<br>            chars_list.append((x,y,w,h))<br><br>    sorted_chars_list = <span class="hljs-built_in">sorted</span>(chars_list, key=<span class="hljs-keyword">lambda</span> x:x[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">for</span> i,item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(sorted_chars_list):<br>        x, y, w, h = item<br>        cv2.imwrite(<span class="hljs-string">&#x27;F://test_verifycode/chars/%d.jpg&#x27;</span>%(i+<span class="hljs-number">1</span>), thresh1[y:y+h, x:x+w])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_edge_picture</span>(<span class="hljs-params">imagepath</span>):<br><br>    image = cv2.imread(imagepath, <span class="hljs-number">0</span>)<br>    height, width = image.shape<br>    corner_list = [image[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>] &lt; <span class="hljs-number">127</span>,<br>                   image[height-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>] &lt; <span class="hljs-number">127</span>,<br>                   image[<span class="hljs-number">0</span>, width-<span class="hljs-number">1</span>]&lt;<span class="hljs-number">127</span>,<br>                   image[ height-<span class="hljs-number">1</span>, width-<span class="hljs-number">1</span>] &lt; <span class="hljs-number">127</span><br>                   ]<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span>(corner_list) &gt;= <span class="hljs-number">3</span>:<br>        os.remove(imagepath)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">resplit_with_parts</span>(<span class="hljs-params">imagepath, parts</span>):<br>    image = cv2.imread(imagepath, <span class="hljs-number">0</span>)<br>    os.remove(imagepath)<br>    height, width = image.shape<br><br>    file_name = imagepath.split(<span class="hljs-string">&#x27;/&#x27;</span>)[-<span class="hljs-number">1</span>].split(<span class="hljs-string">r&#x27;.&#x27;</span>)[<span class="hljs-number">0</span>]<br>    <span class="hljs-comment"># å°†å›¾ç‰‡é‡æ–°åˆ†è£‚æˆpartséƒ¨åˆ†</span><br>    step = width//parts     <span class="hljs-comment"># æ­¥é•¿</span><br>    start = <span class="hljs-number">0</span>             <span class="hljs-comment"># èµ·å§‹ä½ç½®</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(parts):<br>        cv2.imwrite(<span class="hljs-string">&#x27;F://test_verifycode/chars/%s.jpg&#x27;</span>%(file_name+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(i)), \<br>                    image[:, start:start+step])<br>        start += step<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">resplit</span>(<span class="hljs-params">imagepath</span>):<br><br>    image = cv2.imread(imagepath, <span class="hljs-number">0</span>)<br>    height, width = image.shape<br><br>    <span class="hljs-keyword">if</span> width &gt;= <span class="hljs-number">64</span>:<br>        resplit_with_parts(imagepath, <span class="hljs-number">4</span>)<br>    <span class="hljs-keyword">elif</span> width &gt;= <span class="hljs-number">48</span>:<br>        resplit_with_parts(imagepath, <span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">elif</span> width &gt;= <span class="hljs-number">26</span>:<br>        resplit_with_parts(imagepath, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># rename and convert to 16*20 size</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert</span>(<span class="hljs-params"><span class="hljs-built_in">dir</span>, file</span>):<br><br>    imagepath = <span class="hljs-built_in">dir</span>+<span class="hljs-string">&#x27;/&#x27;</span>+file<br>    <span class="hljs-comment"># è¯»å–å›¾ç‰‡</span><br>    image = cv2.imread(imagepath, <span class="hljs-number">0</span>)<br>    <span class="hljs-comment"># äºŒå€¼åŒ–</span><br>    ret, thresh = cv2.threshold(image, <span class="hljs-number">127</span>, <span class="hljs-number">255</span>, cv2.THRESH_BINARY)<br>    img = cv2.resize(thresh, (<span class="hljs-number">16</span>, <span class="hljs-number">20</span>), interpolation=cv2.INTER_AREA)<br>    <span class="hljs-comment"># ä¿å­˜å›¾ç‰‡</span><br>    cv2.imwrite(<span class="hljs-string">&#x27;%s/%s&#x27;</span> % (<span class="hljs-built_in">dir</span>, file), img)<br><br><span class="hljs-comment"># è¯»å–å›¾ç‰‡çš„æ•°æ®ï¼Œå¹¶è½¬åŒ–ä¸º0-1å€¼</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Read_Data</span>(<span class="hljs-params"><span class="hljs-built_in">dir</span>, file</span>):<br><br>    imagepath = <span class="hljs-built_in">dir</span>+<span class="hljs-string">&#x27;/&#x27;</span>+file<br>    <span class="hljs-comment"># è¯»å–å›¾ç‰‡</span><br>    image = cv2.imread(imagepath, <span class="hljs-number">0</span>)<br>    <span class="hljs-comment"># äºŒå€¼åŒ–</span><br>    ret, thresh = cv2.threshold(image, <span class="hljs-number">127</span>, <span class="hljs-number">255</span>, cv2.THRESH_BINARY)<br>    <span class="hljs-comment"># æ˜¾ç¤ºå›¾ç‰‡</span><br>    bin_values = [<span class="hljs-number">1</span> <span class="hljs-keyword">if</span> pixel==<span class="hljs-number">255</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> pixel <span class="hljs-keyword">in</span> thresh.ravel()]<br><br>    <span class="hljs-keyword">return</span> bin_values<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>(<span class="hljs-params">VerifyCodePath</span>):<br><br>    <span class="hljs-built_in">dir</span> = <span class="hljs-string">&#x27;F://test_verifycode/chars&#x27;</span><br>    files = os.listdir(<span class="hljs-built_in">dir</span>)<br><br>    <span class="hljs-comment"># æ¸…ç©ºåŸæœ‰çš„æ–‡ä»¶</span><br>    <span class="hljs-keyword">if</span> files:<br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>            os.remove(<span class="hljs-built_in">dir</span> + <span class="hljs-string">&#x27;/&#x27;</span> + file)<br><br>    split_picture(VerifyCodePath)<br><br>    files = os.listdir(<span class="hljs-built_in">dir</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> files:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æŸ¥çœ‹çš„æ–‡ä»¶å¤¹ä¸ºç©ºï¼&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br><br>        <span class="hljs-comment"># å»é™¤å™ªå£°å›¾ç‰‡</span><br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>            remove_edge_picture(<span class="hljs-built_in">dir</span> + <span class="hljs-string">&#x27;/&#x27;</span> + file)<br><br>        <span class="hljs-comment"># å¯¹é»è¿å›¾ç‰‡è¿›è¡Œé‡åˆ†å‰²</span><br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(<span class="hljs-built_in">dir</span>):<br>            resplit(<span class="hljs-built_in">dir</span> + <span class="hljs-string">&#x27;/&#x27;</span> + file)<br><br>        <span class="hljs-comment"># å°†å›¾ç‰‡ç»Ÿä¸€è°ƒæ•´è‡³16*20å¤§å°</span><br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(<span class="hljs-built_in">dir</span>):<br>            convert(<span class="hljs-built_in">dir</span>, file)<br><br>        <span class="hljs-comment"># å›¾ç‰‡ä¸­çš„å­—ç¬¦ä»£è¡¨çš„å‘é‡</span><br>        files = <span class="hljs-built_in">sorted</span>(os.listdir(<span class="hljs-built_in">dir</span>), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">0</span>])<br>        table = np.array([Read_Data(<span class="hljs-built_in">dir</span>, file) <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files]).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">20</span>,<span class="hljs-number">16</span>,<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># æ¨¡å‹ä¿å­˜åœ°å€</span><br>        mp = <span class="hljs-string">&#x27;F://verifycode_data/verifycode_Keras.h5&#x27;</span><br>        <span class="hljs-comment"># è½½å…¥æ¨¡å‹</span><br>        <span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br>        cnn = load_model(mp)<br>        <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>        y_pred = cnn.predict(table)<br>        predictions = np.argmax(y_pred, axis=<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># æ ‡ç­¾å­—å…¸</span><br>        keys = <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>)<br>        vals = [<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;J&#x27;</span>, <span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>,<br>                <span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>, <span class="hljs-string">&#x27;Z&#x27;</span>]<br>        label_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(keys, vals))<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([label_dict[pred] <span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> predictions])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><br>    <span class="hljs-built_in">dir</span> = <span class="hljs-string">&#x27;F://VerifyCode/&#x27;</span><br>    correct = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i, file <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(os.listdir(<span class="hljs-built_in">dir</span>)):<br>        true_label = file.split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">0</span>]<br>        VerifyCodePath = <span class="hljs-built_in">dir</span>+file<br>        pred = predict(VerifyCodePath)<br><br>        <span class="hljs-keyword">if</span> true_label == pred:<br>            correct += <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(i+<span class="hljs-number">1</span>, (true_label, pred), true_label == pred, correct)<br><br>    total = <span class="hljs-built_in">len</span>(os.listdir(<span class="hljs-built_in">dir</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\næ€»å…±å›¾ç‰‡ï¼š%då¼ \nè¯†åˆ«æ­£ç¡®ï¼š%då¼ \nè¯†åˆ«å‡†ç¡®ç‡:%.2f%%.&#x27;</span>\<br>          %(total, correct, correct*<span class="hljs-number">100</span>/total))<br><br>main()<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯è¯¥CNNæ¨¡å‹çš„é¢„æµ‹ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs bash">Using TensorFlow backend.<br>2018-10-25 15:13:50.390130: I C:\tf_jenkins\workspace\rel-win\M\windows\PY\35\tensorflow\core\platform\cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2<br>1 (<span class="hljs-string">&#x27;ZK6N&#x27;</span>, <span class="hljs-string">&#x27;ZK6N&#x27;</span>) True 1<br>2 (<span class="hljs-string">&#x27;4JPX&#x27;</span>, <span class="hljs-string">&#x27;4JPX&#x27;</span>) True 2<br>3 (<span class="hljs-string">&#x27;5GP5&#x27;</span>, <span class="hljs-string">&#x27;5GP5&#x27;</span>) True 3<br>4 (<span class="hljs-string">&#x27;5RQ8&#x27;</span>, <span class="hljs-string">&#x27;5RQ8&#x27;</span>) True 4<br>5 (<span class="hljs-string">&#x27;5TQP&#x27;</span>, <span class="hljs-string">&#x27;5TQP&#x27;</span>) True 5<br>6 (<span class="hljs-string">&#x27;7S62&#x27;</span>, <span class="hljs-string">&#x27;7S62&#x27;</span>) True 6<br>7 (<span class="hljs-string">&#x27;8R2Z&#x27;</span>, <span class="hljs-string">&#x27;8R2Z&#x27;</span>) True 7<br>8 (<span class="hljs-string">&#x27;8RFV&#x27;</span>, <span class="hljs-string">&#x27;8RFV&#x27;</span>) True 8<br>9 (<span class="hljs-string">&#x27;9BBT&#x27;</span>, <span class="hljs-string">&#x27;9BBT&#x27;</span>) True 9<br>10 (<span class="hljs-string">&#x27;9LNE&#x27;</span>, <span class="hljs-string">&#x27;9LNE&#x27;</span>) True 10<br>11 (<span class="hljs-string">&#x27;67UH&#x27;</span>, <span class="hljs-string">&#x27;67UH&#x27;</span>) True 11<br>12 (<span class="hljs-string">&#x27;74UK&#x27;</span>, <span class="hljs-string">&#x27;74UK&#x27;</span>) True 12<br>13 (<span class="hljs-string">&#x27;A5T2&#x27;</span>, <span class="hljs-string">&#x27;A5T2&#x27;</span>) True 13<br>14 (<span class="hljs-string">&#x27;AHYV&#x27;</span>, <span class="hljs-string">&#x27;AHYV&#x27;</span>) True 14<br>15 (<span class="hljs-string">&#x27;ASEY&#x27;</span>, <span class="hljs-string">&#x27;ASEY&#x27;</span>) True 15<br>16 (<span class="hljs-string">&#x27;B371&#x27;</span>, <span class="hljs-string">&#x27;B371&#x27;</span>) True 16<br>17 (<span class="hljs-string">&#x27;CCQL&#x27;</span>, <span class="hljs-string">&#x27;CCQL&#x27;</span>) True 17<br>18 (<span class="hljs-string">&#x27;CFD5&#x27;</span>, <span class="hljs-string">&#x27;GFD5&#x27;</span>) False 17<br>19 (<span class="hljs-string">&#x27;CJLJ&#x27;</span>, <span class="hljs-string">&#x27;CJLJ&#x27;</span>) True 18<br>20 (<span class="hljs-string">&#x27;D4QV&#x27;</span>, <span class="hljs-string">&#x27;D4QV&#x27;</span>) True 19<br>21 (<span class="hljs-string">&#x27;DFQ8&#x27;</span>, <span class="hljs-string">&#x27;DFQ8&#x27;</span>) True 20<br>22 (<span class="hljs-string">&#x27;DP18&#x27;</span>, <span class="hljs-string">&#x27;DP18&#x27;</span>) True 21<br>23 (<span class="hljs-string">&#x27;E3HC&#x27;</span>, <span class="hljs-string">&#x27;E3HC&#x27;</span>) True 22<br>24 (<span class="hljs-string">&#x27;E8VB&#x27;</span>, <span class="hljs-string">&#x27;E8VB&#x27;</span>) True 23<br>25 (<span class="hljs-string">&#x27;DE1U&#x27;</span>, <span class="hljs-string">&#x27;DE1U&#x27;</span>) True 24<br>26 (<span class="hljs-string">&#x27;FK1R&#x27;</span>, <span class="hljs-string">&#x27;FK1R&#x27;</span>) True 25<br>27 (<span class="hljs-string">&#x27;FK91&#x27;</span>, <span class="hljs-string">&#x27;FK91&#x27;</span>) True 26<br>28 (<span class="hljs-string">&#x27;FSKP&#x27;</span>, <span class="hljs-string">&#x27;FSKP&#x27;</span>) True 27<br>29 (<span class="hljs-string">&#x27;FVZP&#x27;</span>, <span class="hljs-string">&#x27;FVZP&#x27;</span>) True 28<br>30 (<span class="hljs-string">&#x27;GC6H&#x27;</span>, <span class="hljs-string">&#x27;GC6H&#x27;</span>) True 29<br>31 (<span class="hljs-string">&#x27;GH62&#x27;</span>, <span class="hljs-string">&#x27;GH62&#x27;</span>) True 30<br>32 (<span class="hljs-string">&#x27;H9FQ&#x27;</span>, <span class="hljs-string">&#x27;H9FQ&#x27;</span>) True 31<br>33 (<span class="hljs-string">&#x27;H67Q&#x27;</span>, <span class="hljs-string">&#x27;H67Q&#x27;</span>) True 32<br>34 (<span class="hljs-string">&#x27;HEKC&#x27;</span>, <span class="hljs-string">&#x27;HEKC&#x27;</span>) True 33<br>35 (<span class="hljs-string">&#x27;HV2B&#x27;</span>, <span class="hljs-string">&#x27;HV2B&#x27;</span>) True 34<br>36 (<span class="hljs-string">&#x27;J65Z&#x27;</span>, <span class="hljs-string">&#x27;J65Z&#x27;</span>) True 35<br>37 (<span class="hljs-string">&#x27;JZCX&#x27;</span>, <span class="hljs-string">&#x27;JZCX&#x27;</span>) True 36<br>38 (<span class="hljs-string">&#x27;KH5D&#x27;</span>, <span class="hljs-string">&#x27;KH5D&#x27;</span>) True 37<br>39 (<span class="hljs-string">&#x27;KXD2&#x27;</span>, <span class="hljs-string">&#x27;KXD2&#x27;</span>) True 38<br>40 (<span class="hljs-string">&#x27;1GDH&#x27;</span>, <span class="hljs-string">&#x27;1GDH&#x27;</span>) True 39<br>41 (<span class="hljs-string">&#x27;LCL3&#x27;</span>, <span class="hljs-string">&#x27;LCL3&#x27;</span>) True 40<br>42 (<span class="hljs-string">&#x27;LNZR&#x27;</span>, <span class="hljs-string">&#x27;LNZR&#x27;</span>) True 41<br>43 (<span class="hljs-string">&#x27;LZU5&#x27;</span>, <span class="hljs-string">&#x27;LZU5&#x27;</span>) True 42<br>44 (<span class="hljs-string">&#x27;N5AK&#x27;</span>, <span class="hljs-string">&#x27;N5AK&#x27;</span>) True 43<br>45 (<span class="hljs-string">&#x27;N5Q3&#x27;</span>, <span class="hljs-string">&#x27;N5Q3&#x27;</span>) True 44<br>46 (<span class="hljs-string">&#x27;N96Z&#x27;</span>, <span class="hljs-string">&#x27;N96Z&#x27;</span>) True 45<br>47 (<span class="hljs-string">&#x27;NCDG&#x27;</span>, <span class="hljs-string">&#x27;NCDG&#x27;</span>) True 46<br>48 (<span class="hljs-string">&#x27;NELS&#x27;</span>, <span class="hljs-string">&#x27;NELS&#x27;</span>) True 47<br>49 (<span class="hljs-string">&#x27;P96U&#x27;</span>, <span class="hljs-string">&#x27;P96U&#x27;</span>) True 48<br>50 (<span class="hljs-string">&#x27;PD42&#x27;</span>, <span class="hljs-string">&#x27;PD42&#x27;</span>) True 49<br>51 (<span class="hljs-string">&#x27;PECG&#x27;</span>, <span class="hljs-string">&#x27;PEQG&#x27;</span>) False 49<br>52 (<span class="hljs-string">&#x27;PPZF&#x27;</span>, <span class="hljs-string">&#x27;PPZF&#x27;</span>) True 50<br>53 (<span class="hljs-string">&#x27;PUUL&#x27;</span>, <span class="hljs-string">&#x27;PUUL&#x27;</span>) True 51<br>54 (<span class="hljs-string">&#x27;Q2DN&#x27;</span>, <span class="hljs-string">&#x27;D2DN&#x27;</span>) False 51<br>55 (<span class="hljs-string">&#x27;QCQ9&#x27;</span>, <span class="hljs-string">&#x27;QCQ9&#x27;</span>) True 52<br>56 (<span class="hljs-string">&#x27;QDB1&#x27;</span>, <span class="hljs-string">&#x27;QDBJ&#x27;</span>) False 52<br>57 (<span class="hljs-string">&#x27;QZUD&#x27;</span>, <span class="hljs-string">&#x27;QZUD&#x27;</span>) True 53<br>58 (<span class="hljs-string">&#x27;R3T5&#x27;</span>, <span class="hljs-string">&#x27;R3T5&#x27;</span>) True 54<br>59 (<span class="hljs-string">&#x27;S1YT&#x27;</span>, <span class="hljs-string">&#x27;S1YT&#x27;</span>) True 55<br>60 (<span class="hljs-string">&#x27;SP7L&#x27;</span>, <span class="hljs-string">&#x27;SP7L&#x27;</span>) True 56<br>61 (<span class="hljs-string">&#x27;SR2K&#x27;</span>, <span class="hljs-string">&#x27;SR2K&#x27;</span>) True 57<br>62 (<span class="hljs-string">&#x27;SUP5&#x27;</span>, <span class="hljs-string">&#x27;SVP5&#x27;</span>) False 57<br>63 (<span class="hljs-string">&#x27;T2SP&#x27;</span>, <span class="hljs-string">&#x27;T2SP&#x27;</span>) True 58<br>64 (<span class="hljs-string">&#x27;U6V9&#x27;</span>, <span class="hljs-string">&#x27;U6V9&#x27;</span>) True 59<br>65 (<span class="hljs-string">&#x27;UC9P&#x27;</span>, <span class="hljs-string">&#x27;UC9P&#x27;</span>) True 60<br>66 (<span class="hljs-string">&#x27;UFYD&#x27;</span>, <span class="hljs-string">&#x27;UFYD&#x27;</span>) True 61<br>67 (<span class="hljs-string">&#x27;V9NJ&#x27;</span>, <span class="hljs-string">&#x27;V9NH&#x27;</span>) False 61<br>68 (<span class="hljs-string">&#x27;V35X&#x27;</span>, <span class="hljs-string">&#x27;V35X&#x27;</span>) True 62<br>69 (<span class="hljs-string">&#x27;V98F&#x27;</span>, <span class="hljs-string">&#x27;V98F&#x27;</span>) True 63<br>70 (<span class="hljs-string">&#x27;VD28&#x27;</span>, <span class="hljs-string">&#x27;VD28&#x27;</span>) True 64<br>71 (<span class="hljs-string">&#x27;YGHE&#x27;</span>, <span class="hljs-string">&#x27;YGHE&#x27;</span>) True 65<br>72 (<span class="hljs-string">&#x27;YNKD&#x27;</span>, <span class="hljs-string">&#x27;YNKD&#x27;</span>) True 66<br>73 (<span class="hljs-string">&#x27;YVXV&#x27;</span>, <span class="hljs-string">&#x27;YVXV&#x27;</span>) True 67<br>74 (<span class="hljs-string">&#x27;ZFBS&#x27;</span>, <span class="hljs-string">&#x27;ZFBS&#x27;</span>) True 68<br>75 (<span class="hljs-string">&#x27;ET6X&#x27;</span>, <span class="hljs-string">&#x27;ET6X&#x27;</span>) True 69<br>76 (<span class="hljs-string">&#x27;TKVC&#x27;</span>, <span class="hljs-string">&#x27;TKVC&#x27;</span>) True 70<br>77 (<span class="hljs-string">&#x27;2UCU&#x27;</span>, <span class="hljs-string">&#x27;2UCU&#x27;</span>) True 71<br>78 (<span class="hljs-string">&#x27;HNBK&#x27;</span>, <span class="hljs-string">&#x27;HNBK&#x27;</span>) True 72<br>79 (<span class="hljs-string">&#x27;X8FD&#x27;</span>, <span class="hljs-string">&#x27;X8FD&#x27;</span>) True 73<br>80 (<span class="hljs-string">&#x27;ZGNX&#x27;</span>, <span class="hljs-string">&#x27;ZGNX&#x27;</span>) True 74<br>81 (<span class="hljs-string">&#x27;LQCU&#x27;</span>, <span class="hljs-string">&#x27;LQCU&#x27;</span>) True 75<br>82 (<span class="hljs-string">&#x27;JNZY&#x27;</span>, <span class="hljs-string">&#x27;JNZVY&#x27;</span>) False 75<br>83 (<span class="hljs-string">&#x27;RX34&#x27;</span>, <span class="hljs-string">&#x27;RX34&#x27;</span>) True 76<br>84 (<span class="hljs-string">&#x27;811E&#x27;</span>, <span class="hljs-string">&#x27;811E&#x27;</span>) True 77<br>85 (<span class="hljs-string">&#x27;ETDX&#x27;</span>, <span class="hljs-string">&#x27;ETDX&#x27;</span>) True 78<br>86 (<span class="hljs-string">&#x27;4CPR&#x27;</span>, <span class="hljs-string">&#x27;4CPR&#x27;</span>) True 79<br>87 (<span class="hljs-string">&#x27;FE91&#x27;</span>, <span class="hljs-string">&#x27;FE91&#x27;</span>) True 80<br>88 (<span class="hljs-string">&#x27;B7XH&#x27;</span>, <span class="hljs-string">&#x27;B7XH&#x27;</span>) True 81<br>89 (<span class="hljs-string">&#x27;1RUA&#x27;</span>, <span class="hljs-string">&#x27;1RUA&#x27;</span>) True 82<br>90 (<span class="hljs-string">&#x27;UBCX&#x27;</span>, <span class="hljs-string">&#x27;UBCX&#x27;</span>) True 83<br>91 (<span class="hljs-string">&#x27;KVT5&#x27;</span>, <span class="hljs-string">&#x27;KVT5&#x27;</span>) True 84<br>92 (<span class="hljs-string">&#x27;HZ3A&#x27;</span>, <span class="hljs-string">&#x27;HZ3A&#x27;</span>) True 85<br>93 (<span class="hljs-string">&#x27;3XLR&#x27;</span>, <span class="hljs-string">&#x27;3XLR&#x27;</span>) True 86<br>94 (<span class="hljs-string">&#x27;VC7T&#x27;</span>, <span class="hljs-string">&#x27;VC7T&#x27;</span>) True 87<br>95 (<span class="hljs-string">&#x27;7PG1&#x27;</span>, <span class="hljs-string">&#x27;7PQ1&#x27;</span>) False 87<br>96 (<span class="hljs-string">&#x27;4F21&#x27;</span>, <span class="hljs-string">&#x27;4F21&#x27;</span>) True 88<br>97 (<span class="hljs-string">&#x27;3HLJ&#x27;</span>, <span class="hljs-string">&#x27;3HLJ&#x27;</span>) True 89<br>98 (<span class="hljs-string">&#x27;1KT7&#x27;</span>, <span class="hljs-string">&#x27;1KT7&#x27;</span>) True 90<br>99 (<span class="hljs-string">&#x27;1RHE&#x27;</span>, <span class="hljs-string">&#x27;1RHE&#x27;</span>) True 91<br>100 (<span class="hljs-string">&#x27;1TTA&#x27;</span>, <span class="hljs-string">&#x27;1TTA&#x27;</span>) True 92<br><br>æ€»å…±å›¾ç‰‡ï¼š100å¼ <br>è¯†åˆ«æ­£ç¡®ï¼š92å¼ <br>è¯†åˆ«å‡†ç¡®ç‡:92.00%.<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥è®­ç»ƒåçš„CNNæ¨¡å‹ï¼Œå…¶é¢„æµ‹æ–°éªŒè¯çš„å‡†ç¡®ç‡åœ¨90%ä»¥ä¸Šã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>åœ¨æ–‡ç« <ahref="https://www.jianshu.com/p/0287bcd24f78">CNNå¤§æˆ˜éªŒè¯ç </a>ä¸­ï¼Œç¬”è€…ä½¿ç”¨TensorFlowæ­å»ºäº†CNNæ¨¡å‹ï¼Œä»£ç è¾ƒé•¿ï¼Œè®­ç»ƒæ—¶é—´åœ¨ä¸¤ä¸ªå°æ—¶ä»¥ä¸Šï¼Œè€Œä½¿ç”¨Kerasæ­å»ºè¯¥æ¨¡å‹ï¼Œä»£ç ç®€æ´ï¼Œä¸”ä½¿ç”¨earlystoppingæŠ€å·§åèƒ½ç¼©çŸ­è®­ç»ƒæ—¶é—´ï¼ŒåŒæ—¶ä¿è¯æ¨¡å‹çš„å‡†ç¡®ç‡ï¼Œç”±æ­¤å¯è§Kerasçš„ä¼˜åŠ¿æ‰€åœ¨ã€‚</p><p>è¯¥é¡¹ç›®å·²å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼šhttps://github.com/percent4/CNN_4_Verifycodeã€‚</p><blockquote><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Keras</tag>
      
      <tag>CNN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keraså…¥é—¨ï¼ˆäºŒï¼‰æ¨¡å‹çš„ä¿å­˜ã€è¯»å–åŠåŠ è½½</title>
    <link href="/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BF%9D%E5%AD%98%E3%80%81%E8%AF%BB%E5%8F%96%E5%8F%8A%E5%8A%A0%E8%BD%BD/"/>
    <url>/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BF%9D%E5%AD%98%E3%80%81%E8%AF%BB%E5%8F%96%E5%8F%8A%E5%8A%A0%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•åˆ©ç”¨Kerasæ¥å®ç°æ¨¡å‹çš„ä¿å­˜ã€è¯»å–ä»¥åŠåŠ è½½ã€‚</p></blockquote><p>æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹ä¸ºè§£å†³IRISæ•°æ®é›†çš„å¤šåˆ†ç±»é—®é¢˜è€Œè®¾è®¡çš„æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰æ¨¡å‹ï¼Œæ¨¡å‹çš„ç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/keras2_1.png" /></p><p>å…·ä½“çš„æ¨¡å‹å‚æ•°å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<ahref="https://percent4.github.io/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88DNN%EF%BC%89%E8%A7%A3%E5%86%B3%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/">Keraså…¥é—¨ï¼ˆä¸€ï¼‰æ­å»ºDNNè§£å†³å¤šåˆ†ç±»é—®é¢˜</a>ã€‚</p><h3 id="æ¨¡å‹ä¿å­˜">æ¨¡å‹ä¿å­˜</h3><p>Kerasä½¿ç”¨HDF5æ–‡ä»¶ç³»ç»Ÿæ¥ä¿å­˜æ¨¡å‹ã€‚æ¨¡å‹ä¿å­˜çš„æ–¹æ³•å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦ä½¿ç”¨save()æ–¹æ³•å³å¯ã€‚</p><p>ä»¥<ahref="https://percent4.github.io/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88DNN%EF%BC%89%E8%A7%A3%E5%86%B3%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/">Keraså…¥é—¨ï¼ˆä¸€ï¼‰æ­å»ºæ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰è§£å†³å¤šåˆ†ç±»é—®é¢˜</a>ä¸­çš„DNNæ¨¡å‹ä¸ºä¾‹ï¼Œæ•´ä¸ªæ¨¡å‹çš„å˜é‡ä¸ºmodelï¼Œæˆ‘ä»¬è®¾ç½®æ¨¡å‹å…±è®­ç»ƒ10æ¬¡ï¼Œåœ¨åŸå…ˆçš„ä»£ç ä¸­åŠ å…¥Pythonä»£ç å³å¯ä¿å­˜æ¨¡å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># save model</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Saving model to disk \n&quot;</span>)<br>mp = <span class="hljs-string">&quot;E://logs/iris_model.h5&quot;</span><br>model.save(mp)<br></code></pre></td></tr></table></figure><p>ä¿å­˜çš„æ¨¡å‹æ–‡ä»¶ï¼ˆiris_model.h5ï¼‰å¦‚ä¸‹ï¼š</p><p><img src="/img/keras2_2.png" /></p><h3 id="æ¨¡å‹è¯»å–">æ¨¡å‹è¯»å–</h3><p>ä¿å­˜åçš„iris_model.h5ä»¥HDF5æ–‡ä»¶ç³»ç»Ÿçš„å½¢å¼å‚¨å­˜ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨Pythonè¯»å–h5æ–‡ä»¶é‡Œé¢çš„æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç”¨HDF5çš„å¯è§†åŒ–å·¥å…·HDFViewæ¥æŸ¥çœ‹é‡Œé¢çš„æ•°æ®ï¼š</p><p><img src="/img/keras2_3.png" /></p><p>æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯è¿™ä¸ªæ¨¡å‹ä¸­çš„å„ä¸ªç¥ç»å±‚ä¹‹é—´çš„è¿æ¥æƒé‡åŠåé‡ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼Œmodel_weightsé‡Œé¢åŒ…å«äº†å„ä¸ªç¥ç»å±‚ä¹‹é—´çš„è¿æ¥æƒé‡åŠåé‡ï¼Œåˆ†åˆ«ä½äºdense_1,dense_2,dense_3ä¸­ã€‚è“è‰²éƒ¨åˆ†ä¸ºdense_3/dense_3/kernel:0çš„æ•°æ®ï¼Œå³æœ€åè¾“å‡ºå±‚çš„è¿æ¥æƒé‡çŸ©é˜µã€‚</p><p>æœ‰äº†å¯¹æ¨¡å‹å‚æ•°çš„ç›´è§‚è®¤è¯†ï¼Œæˆ‘ä»¬è¦åšçš„ä¸‹ä¸€æ­¥å·¥ä½œå°±æ˜¯è¯»å–å„ä¸ªç¥ç»å±‚ä¹‹é—´çš„è¿æ¥æƒé‡åŠåé‡ã€‚æˆ‘ä»¬ä½¿ç”¨Pythonçš„h5pyè¿™ä¸ªæ¨¡å—æ¥è¿™ä¸ªiris_model.h5è¿™ä¸ªæ–‡ä»¶ã€‚å…³äºh5pyçš„å¿«é€Ÿå…¥é—¨æŒ‡å—ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« ï¼š<ahref="https://www.jianshu.com/p/a6328c4f4986">h5pyå¿«é€Ÿå…¥é—¨æŒ‡å—</a>ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹Pythonä»£ç å¯ä»¥è¯»å–å„ä¸ªç¥ç»å±‚ä¹‹é—´çš„è¿æ¥æƒé‡åŠåé‡æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> h5py<br><br><span class="hljs-comment"># æ¨¡å‹åœ°å€</span><br>MODEL_PATH = <span class="hljs-string">&#x27;E://logs/iris_model.h5&#x27;</span><br><br><span class="hljs-comment"># è·å–æ¯ä¸€å±‚çš„è¿æ¥æƒé‡åŠåé‡</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯»å–æ¨¡å‹ä¸­...&quot;</span>)<br><span class="hljs-keyword">with</span> h5py.File(MODEL_PATH, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    dense_1 = f[<span class="hljs-string">&#x27;/model_weights/dense_1/dense_1&#x27;</span>]<br>    dense_1_bias =  dense_1[<span class="hljs-string">&#x27;bias:0&#x27;</span>][:]<br>    dense_1_kernel = dense_1[<span class="hljs-string">&#x27;kernel:0&#x27;</span>][:]<br><br>    dense_2 = f[<span class="hljs-string">&#x27;/model_weights/dense_2/dense_2&#x27;</span>]<br>    dense_2_bias = dense_2[<span class="hljs-string">&#x27;bias:0&#x27;</span>][:]<br>    dense_2_kernel = dense_2[<span class="hljs-string">&#x27;kernel:0&#x27;</span>][:]<br><br>    dense_3 = f[<span class="hljs-string">&#x27;/model_weights/dense_3/dense_3&#x27;</span>]<br>    dense_3_bias = dense_3[<span class="hljs-string">&#x27;bias:0&#x27;</span>][:]<br>    dense_3_kernel = dense_3[<span class="hljs-string">&#x27;kernel:0&#x27;</span>][:]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸€å±‚çš„è¿æ¥æƒé‡çŸ©é˜µï¼š\n%s\n&quot;</span>%dense_1_kernel)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸€å±‚çš„è¿æ¥åé‡çŸ©é˜µï¼š\n%s\n&quot;</span>%dense_1_bias)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬äºŒå±‚çš„è¿æ¥æƒé‡çŸ©é˜µï¼š\n%s\n&quot;</span>%dense_2_kernel)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬äºŒå±‚çš„è¿æ¥åé‡çŸ©é˜µï¼š\n%s\n&quot;</span>%dense_2_bias)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸‰å±‚çš„è¿æ¥æƒé‡çŸ©é˜µï¼š\n%s\n&quot;</span>%dense_3_kernel)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸‰å±‚çš„è¿æ¥åé‡çŸ©é˜µï¼š\n%s\n&quot;</span>%dense_3_bias)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dns">è¯»å–æ¨¡å‹ä¸­...<br>ç¬¬ä¸€å±‚çš„è¿æ¥æƒé‡çŸ©é˜µï¼š<br>[[ <span class="hljs-number">0.04141677</span>  <span class="hljs-number">0.03080632</span> -<span class="hljs-number">0.02768146</span>  <span class="hljs-number">0.14334357</span>  <span class="hljs-number">0.06242227</span>]<br> [-<span class="hljs-number">0.41209617</span> -<span class="hljs-number">0.77948487</span>  <span class="hljs-number">0.5648218</span>  -<span class="hljs-number">0.699587</span>   -<span class="hljs-number">0.19246106</span>]<br> [ <span class="hljs-number">0.6856315</span>   <span class="hljs-number">0.28241938</span> -<span class="hljs-number">0.91930366</span> -<span class="hljs-number">0.07989818</span>  <span class="hljs-number">0.47165248</span>]<br> [ <span class="hljs-number">0.8655262</span>   <span class="hljs-number">0.72175753</span>  <span class="hljs-number">0.36529952</span> -<span class="hljs-number">0.53172135</span>  <span class="hljs-number">0.26573092</span>]]<br><br>ç¬¬ä¸€å±‚çš„è¿æ¥åé‡çŸ©é˜µï¼š<br>[-<span class="hljs-number">0.16441862</span> -<span class="hljs-number">0.02462054</span> -<span class="hljs-number">0.14060321</span>  <span class="hljs-number">0</span>.         -<span class="hljs-number">0.14293939</span>]<br><br>ç¬¬äºŒå±‚çš„è¿æ¥æƒé‡çŸ©é˜µï¼š<br>[[ <span class="hljs-number">0.39296603</span>  <span class="hljs-number">0.01864707</span>  <span class="hljs-number">0.12538083</span>  <span class="hljs-number">0.07935872</span>  <span class="hljs-number">0.27940807</span> -<span class="hljs-number">0.4565802</span> ]<br> [-<span class="hljs-number">0.34312084</span>  <span class="hljs-number">0.6446907</span>  -<span class="hljs-number">0.92546445</span> -<span class="hljs-number">0.00538039</span>  <span class="hljs-number">0.95466876</span> -<span class="hljs-number">0.32819661</span>]<br> [-<span class="hljs-number">0.7593299</span>  -<span class="hljs-number">0.07227057</span>  <span class="hljs-number">0.20751365</span>  <span class="hljs-number">0.40547106</span>  <span class="hljs-number">0.35726753</span>  <span class="hljs-number">0.8884158</span> ]<br> [-<span class="hljs-number">0.48096</span>     <span class="hljs-number">0.11294878</span> -<span class="hljs-number">0.29462305</span> -<span class="hljs-number">0.410536</span>   -<span class="hljs-number">0.23620337</span> -<span class="hljs-number">0.72703975</span>]<br> [ <span class="hljs-number">0.7666149</span>  -<span class="hljs-number">0.41720924</span>  <span class="hljs-number">0.29576775</span> -<span class="hljs-number">0.6328017</span>   <span class="hljs-number">0.43118536</span>  <span class="hljs-number">0.6589351</span> ]]<br><br>ç¬¬äºŒå±‚çš„è¿æ¥åé‡çŸ©é˜µï¼š<br>[-<span class="hljs-number">0.1899569</span>   <span class="hljs-number">0</span>.         -<span class="hljs-number">0.09710662</span> -<span class="hljs-number">0.12964155</span> -<span class="hljs-number">0.26443157</span>  <span class="hljs-number">0.6050924</span> ]<br><br>ç¬¬ä¸‰å±‚çš„è¿æ¥æƒé‡çŸ©é˜µï¼š<br>[[-<span class="hljs-number">0.44450542</span>  <span class="hljs-number">0.09977101</span>  <span class="hljs-number">0.12196152</span>]<br> [ <span class="hljs-number">0.14334357</span>  <span class="hljs-number">0.18546402</span> -<span class="hljs-number">0.23861367</span>]<br> [-<span class="hljs-number">0.7284191</span>   <span class="hljs-number">0.7859063</span>  -<span class="hljs-number">0.878823</span>  ]<br> [ <span class="hljs-number">0.0876545</span>   <span class="hljs-number">0.51531947</span>  <span class="hljs-number">0.09671918</span>]<br> [-<span class="hljs-number">0.7964963</span>  -<span class="hljs-number">0.16435687</span>  <span class="hljs-number">0.49531657</span>]<br> [ <span class="hljs-number">0.8645698</span>   <span class="hljs-number">0.4439873</span>   <span class="hljs-number">0.24599855</span>]]<br><br>ç¬¬ä¸‰å±‚çš„è¿æ¥åé‡çŸ©é˜µï¼š<br>[ <span class="hljs-number">0.39192322</span> -<span class="hljs-number">0.1266532</span>  -<span class="hljs-number">0.29631865</span>]<br></code></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¾—åˆ°çš„è¿™äº›çŸ©é˜µçš„æ•°æ®ç±»å‹éƒ½æ˜¯numpy.ndarrayã€‚</p><p>OKï¼Œæ—¢ç„¶æˆ‘ä»¬å·²ç»å¾—åˆ°äº†å„ä¸ªç¥ç»å±‚ä¹‹é—´çš„è¿æ¥æƒé‡åŠåé‡çš„æ•°æ®ï¼Œé‚£æˆ‘ä»¬èƒ½åšä»€ä¹ˆå‘¢ï¼Ÿå½“ç„¶æ˜¯å»åšä¸€äº›æœ‰è¶£çš„äº‹å•¦ï¼Œé‚£å°±æ˜¯ç”¨æˆ‘ä»¬è‡ªå·±çš„æ–¹æ³•æ¥å®ç°æ–°æ•°æ®çš„é¢„æµ‹å‘é‡(softmaxå‡½æ•°ä½œç”¨åçš„å‘é‡)ã€‚so,really?</p><p>æ–°çš„è¾“å…¥å‘é‡ä¸º[6.1, 3.1, 5.1,1.1]ï¼Œä½¿ç”¨ä»¥ä¸‹Pythonä»£ç å³å¯è¾“å‡ºæ–°æ•°æ®çš„é¢„æµ‹å‘é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> h5py<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># æ¨¡å‹åœ°å€</span><br>MODEL_PATH = <span class="hljs-string">&#x27;E://logs/iris_model.h5&#x27;</span><br><br><span class="hljs-comment"># è·å–æ¯ä¸€å±‚çš„è¿æ¥æƒé‡åŠåé‡</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯»å–æ¨¡å‹ä¸­...&quot;</span>)<br><span class="hljs-keyword">with</span> h5py.File(MODEL_PATH, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    dense_1 = f[<span class="hljs-string">&#x27;/model_weights/dense_1/dense_1&#x27;</span>]<br>    dense_1_bias =  dense_1[<span class="hljs-string">&#x27;bias:0&#x27;</span>][:]<br>    dense_1_kernel = dense_1[<span class="hljs-string">&#x27;kernel:0&#x27;</span>][:]<br><br>    dense_2 = f[<span class="hljs-string">&#x27;/model_weights/dense_2/dense_2&#x27;</span>]<br>    dense_2_bias = dense_2[<span class="hljs-string">&#x27;bias:0&#x27;</span>][:]<br>    dense_2_kernel = dense_2[<span class="hljs-string">&#x27;kernel:0&#x27;</span>][:]<br><br>    dense_3 = f[<span class="hljs-string">&#x27;/model_weights/dense_3/dense_3&#x27;</span>]<br>    dense_3_bias = dense_3[<span class="hljs-string">&#x27;bias:0&#x27;</span>][:]<br>    dense_3_kernel = dense_3[<span class="hljs-string">&#x27;kernel:0&#x27;</span>][:]<br><br><span class="hljs-comment"># æ¨¡æ‹Ÿæ¯ä¸ªç¥ç»å±‚çš„è®¡ç®—ï¼Œå¾—åˆ°è¯¥å±‚çš„è¾“å‡º</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">layer_output</span>(<span class="hljs-params"><span class="hljs-built_in">input</span>, kernel, bias</span>):<br>    <span class="hljs-keyword">return</span> np.dot(<span class="hljs-built_in">input</span>, kernel) + bias<br><br><span class="hljs-comment"># å®ç°ReLUå‡½æ•°</span><br>relu = np.vectorize(<span class="hljs-keyword">lambda</span> x: x <span class="hljs-keyword">if</span> x &gt;=<span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># å®ç°softmaxå‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">softmax_func</span>(<span class="hljs-params">arr</span>):<br>    exp_arr = np.exp(arr)<br>    arr_sum = np.<span class="hljs-built_in">sum</span>(exp_arr)<br>    softmax_arr = exp_arr/arr_sum<br>    <span class="hljs-keyword">return</span> softmax_arr<br><br><span class="hljs-comment"># è¾“å…¥å‘é‡</span><br>unkown = np.array([[<span class="hljs-number">6.1</span>, <span class="hljs-number">3.1</span>, <span class="hljs-number">5.1</span>, <span class="hljs-number">1.1</span>]], dtype=np.float32)<br><br><span class="hljs-comment"># ç¬¬ä¸€å±‚çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¨¡å‹è®¡ç®—ä¸­...&quot;</span>)<br>output_1 = layer_output(unkown, dense_1_kernel, dense_1_bias)<br>output_1 = relu(output_1)<br><br><span class="hljs-comment"># ç¬¬äºŒå±‚çš„è¾“å‡º</span><br>output_2 = layer_output(output_1, dense_2_kernel, dense_2_bias)<br>output_2 = relu(output_2)<br><br><span class="hljs-comment"># ç¬¬ä¸‰å±‚çš„è¾“å‡º</span><br>output_3 = layer_output(output_2, dense_3_kernel, dense_3_bias)<br>output_3 = softmax_func(output_3)<br><br><span class="hljs-comment"># æœ€ç»ˆçš„è¾“å‡ºçš„softmaxå€¼</span><br>np.set_printoptions(precision=<span class="hljs-number">4</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æœ€ç»ˆçš„é¢„æµ‹å€¼å‘é‡ä¸º: %s&quot;</span>%output_3)<br></code></pre></td></tr></table></figure><p>å…¶è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua">è¯»å–æ¨¡å‹ä¸­...<br>æ¨¡å‹è®¡ç®—ä¸­...<br>æœ€ç»ˆçš„é¢„æµ‹å€¼å‘é‡ä¸º: <span class="hljs-string">[[0.0242 0.6763 0.2995]]</span><br></code></pre></td></tr></table></figure><p>é¢ï¼Œè¿™ä¸ªè¾“å‡ºçš„é¢„æµ‹å€¼å‘é‡ä¼šæ˜¯æˆ‘ä»¬çš„DNNæ¨¡å‹çš„é¢„æµ‹å€¼å‘é‡å—ï¼Ÿè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å›è¿‡å¤´æ¥çœ‹çœ‹<ahref="https://www.jianshu.com/p/1d88a6ed707e">Keraså…¥é—¨ï¼ˆä¸€ï¼‰æ­å»ºæ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰è§£å†³å¤šåˆ†ç±»é—®é¢˜</a>ä¸­çš„ä»£ç äº†ï¼Œæ³¨æ„ï¼Œä¸ºäº†ä¿è¯æ•°å€¼çš„å¯æ¯”è¾ƒæ€§ï¼Œç¬”è€…å·²ç»å°†DNNæ¨¡å‹çš„è®­ç»ƒæ¬¡æ•°æ”¹ä¸º10æ¬¡äº†ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹åŸæ¥ä»£ç çš„è¾“å‡ºç»“æœå§ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lua">Using model to predict species <span class="hljs-keyword">for</span> features: <br><span class="hljs-string">[[6.1 3.1 5.1 1.1]]</span><br><br>Predicted softmax vector is: <br><span class="hljs-string">[[0.0242 0.6763 0.2995]]</span><br><br>Predicted species is: <br>Iris-versicolor<br></code></pre></td></tr></table></figure><p>Yes,ä¸¤è€…çš„é¢„æµ‹å€¼å‘é‡å®Œå…¨ä¸€è‡´ï¼å› æ­¤ï¼Œæˆ‘ä»¬ç”¨è‡ªå·±çš„æ–¹æ³•ä¹Ÿå®ç°äº†è¿™ä¸ªDNNæ¨¡å‹çš„é¢„æµ‹åŠŸèƒ½ï¼Œæ£’ï¼</p><h3 id="æ¨¡å‹åŠ è½½">æ¨¡å‹åŠ è½½</h3><p>å½“ç„¶ï¼Œåœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†ç”¨è‡ªå·±çš„æ–¹æ³•æ¥å®ç°æ¨¡å‹çš„é¢„æµ‹åŠŸèƒ½ï¼Œåªéœ€ä½¿ç”¨Kerasç»™æˆ‘ä»¬æä¾›å¥½çš„æ¨¡å‹å¯¼å…¥åŠŸèƒ½ï¼ˆkeras.models.load_model()ï¼‰å³å¯ã€‚ä½¿ç”¨ä»¥ä¸‹Pythonä»£ç å³å¯åŠ è½½æ¨¡å‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ¨¡å‹çš„åŠ è½½åŠä½¿ç”¨</span><br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using loaded model to predict...&quot;</span>)<br>load_model = load_model(<span class="hljs-string">&quot;E://logs/iris_model.h5&quot;</span>)<br>np.set_printoptions(precision=<span class="hljs-number">4</span>)<br>unknown = np.array([[<span class="hljs-number">6.1</span>, <span class="hljs-number">3.1</span>, <span class="hljs-number">5.1</span>, <span class="hljs-number">1.1</span>]], dtype=np.float32)<br>predicted = load_model.predict(unknown)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using model to predict species for features: &quot;</span>)<br><span class="hljs-built_in">print</span>(unknown)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nPredicted softmax vector is: &quot;</span>)<br><span class="hljs-built_in">print</span>(predicted)<br>species_dict = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> Class_dict.items()&#125;<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nPredicted species is: &quot;</span>)<br><span class="hljs-built_in">print</span>(species_dict[np.argmax(predicted)])<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">Using loaded model to predict...<br>Using model to predict species <span class="hljs-keyword">for</span> features: <br>[[<span class="hljs-number">6.1</span> <span class="hljs-number">3.1</span> <span class="hljs-number">5.1</span> <span class="hljs-number">1.1</span>]]<br><br>Predicted softmax vector <span class="hljs-keyword">is</span>: <br>[[<span class="hljs-number">0.0242</span> <span class="hljs-number">0.6763</span> <span class="hljs-number">0.2995</span>]]<br><br>Predicted species <span class="hljs-keyword">is</span>: <br>Iris-versicolor<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åˆ©ç”¨Kerasæ¥å®ç°æ¨¡å‹çš„ä¿å­˜ã€è¯»å–ä»¥åŠåŠ è½½ã€‚</p><p>æœ¬æ–‡å°†ä¸å†ç»™å‡ºå®Œæ•´çš„Pythonä»£ç ï¼Œå¦‚éœ€å®Œæ•´çš„ä»£ç ï¼Œè¯·å‚è€ƒGithubåœ°å€ï¼šhttps://github.com/percent4/Keras_4_multiclass.</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keraså…¥é—¨ï¼ˆä¸€ï¼‰æ­å»ºDNNè§£å†³å¤šåˆ†ç±»é—®é¢˜</title>
    <link href="/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88DNN%EF%BC%89%E8%A7%A3%E5%86%B3%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/"/>
    <url>/2023/08/06/Keras%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88DNN%EF%BC%89%E8%A7%A3%E5%86%B3%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="kerasä»‹ç»">Kerasä»‹ç»</h3><p>Kerasæ˜¯ä¸€ä¸ªå¼€æºçš„é«˜å±‚ç¥ç»ç½‘ç»œAPIï¼Œç”±çº¯Pythonç¼–å†™è€Œæˆï¼Œå…¶åç«¯å¯ä»¥åŸºäºTensorflowã€Theanoã€MXNetä»¥åŠCNTKã€‚Kerasä¸ºæ”¯æŒå¿«é€Ÿå®éªŒè€Œç”Ÿï¼Œèƒ½å¤ŸæŠŠä½ çš„ideaè¿…é€Ÿè½¬æ¢ä¸ºç»“æœã€‚Kerasé€‚ç”¨çš„Pythonç‰ˆæœ¬æ˜¯ï¼šPython2.7-3.6ã€‚</p><p>Kerasï¼Œåœ¨å¸Œè…Šè¯­ä¸­æ„ä¸ºâ€œè§’â€ï¼ˆhornï¼‰ï¼Œäº2015å¹´3æœˆä»½ç¬¬ä¸€æ¬¡å‘è¡Œï¼Œå®ƒå¯ä»¥åœ¨Windows,Linux,Macç­‰ç³»ç»Ÿä¸­è¿è¡Œã€‚é‚£ä¹ˆï¼Œæ—¢ç„¶æœ‰äº†TensorFlowï¼ˆæˆ–Theanoã€MXNetã€CNTKï¼‰ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦Keraså‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œå°½ç®¡æˆ‘ä»¬å¯ä»¥ç”¨TensorFlowç­‰æ¥åˆ›å»ºæ·±åº¦ç¥ç»ç½‘ç»œç³»ç»Ÿï¼Œä½†Tensorflowç­‰ä½¿ç”¨ç›¸å¯¹ä½çº§çš„æŠ½è±¡ï¼Œç›´æ¥ç¼–å†™TensorFlowä»£ç å…·æœ‰ä¸€å®šçš„æŒ‘æˆ˜æ€§ï¼Œè€ŒKerasåœ¨TensorFlowçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†è¾ƒæ˜“ä½¿ç”¨çš„æŠ½è±¡å±‚ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ ç®€å•ã€é«˜æ•ˆã€‚</p><p>ä»€ä¹ˆæ ·çš„åœºåˆé€‚åˆç”¨Keraså‘¢ï¼Ÿå¦‚æœä½ æœ‰å¦‚ä¸‹éœ€æ±‚ï¼Œè¯·é€‰æ‹©Kerasï¼š</p><ul><li><p>ç®€æ˜“å’Œå¿«é€Ÿçš„åŸå‹è®¾è®¡ï¼ˆkeraså…·æœ‰é«˜åº¦æ¨¡å—åŒ–ï¼Œæç®€ï¼Œå’Œå¯æ‰©å……ç‰¹æ€§ï¼‰</p></li><li><p>æ”¯æŒCNNå’ŒRNNï¼Œæˆ–äºŒè€…çš„ç»“åˆ</p></li><li><p>æ— ç¼CPUå’ŒGPUåˆ‡æ¢</p><p>å¦‚æœæƒ³ç”¨åœ¨ä½ çš„ç”µè„‘ä¸Šä½¿ç”¨Kerasï¼Œéœ€è¦ä»¥ä¸‹å·¥å…·ï¼š</p></li><li><p>Python</p></li><li><p>TensorFlow</p></li><li><p>Keras</p></li></ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©TensorFlowä½œä¸ºKerasçš„åç«¯å·¥å…·ã€‚ä½¿ç”¨ä»¥ä¸‹Pythonä»£ç ï¼Œå¯ä»¥è¾“å‡ºPythonã€TensorFlowä»¥åŠKerasçš„ç‰ˆæœ¬å·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> keras <span class="hljs-keyword">as</span> K<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>py_ver = sys.version<br>k_ver = K.__version__<br>tf_ver = tf.__version__<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using Python version &quot;</span> + <span class="hljs-built_in">str</span>(py_ver))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using Keras version &quot;</span> + <span class="hljs-built_in">str</span>(k_ver))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using TensorFlow version &quot;</span> + <span class="hljs-built_in">str</span>(tf_ver))<br></code></pre></td></tr></table></figure><p>åœ¨ç¬”è€…çš„ç”µè„‘ä¸Šï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Using</span> TensorFlow backend.<br><span class="hljs-attribute">Using</span> Python version <span class="hljs-number">3</span>.<span class="hljs-number">5</span>.<span class="hljs-number">1</span> (v3.<span class="hljs-number">5</span>.<span class="hljs-number">1</span>:<span class="hljs-number">37</span>a07cee5969, Dec  <span class="hljs-number">6</span> <span class="hljs-number">2015</span>, <span class="hljs-number">01</span>:<span class="hljs-number">54</span>:<span class="hljs-number">25</span>)<span class="hljs-meta"> [MSC v.1900 64 bit (AMD64)]</span><br><span class="hljs-attribute">Using</span> Keras version <span class="hljs-number">2</span>.<span class="hljs-number">1</span>.<span class="hljs-number">5</span><br><span class="hljs-attribute">Using</span> TensorFlow version <span class="hljs-number">1</span>.<span class="hljs-number">6</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢ï¼Œç¬”è€…å°†ä½¿ç”¨IRISæ•°æ®é›†ï¼ˆé¸¢å°¾èŠ±æ•°æ®é›†ï¼Œä¸€ä¸ªç»å…¸çš„æœºå™¨å­¦ä¹ æ•°æ®é›†ï¼Œé€‚åˆä½œä¸ºå¤šåˆ†ç±»é—®é¢˜çš„æµ‹è¯•æ•°æ®ï¼‰ï¼Œä½¿ç”¨Kerasæ­å»ºä¸€ä¸ªæ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰ï¼Œæ¥è§£å†³IRISæ•°æ®é›†çš„å¤šåˆ†ç±»é—®é¢˜ï¼Œä½œä¸ºKeraså…¥é—¨çš„ç¬¬ä¸€ä¸ªä¾‹å­ã€‚</p><h3 id="irisæ•°æ®é›†ä»‹ç»">IRISæ•°æ®é›†ä»‹ç»</h3><p>IRISæ•°æ®é›†ï¼ˆé¸¢å°¾èŠ±æ•°æ®é›†ï¼‰ï¼Œæ˜¯ä¸€ä¸ªç»å…¸çš„æœºå™¨å­¦ä¹ æ•°æ®é›†ï¼Œé€‚åˆä½œä¸ºå¤šåˆ†ç±»é—®é¢˜çš„æµ‹è¯•æ•°æ®ï¼Œå®ƒçš„ä¸‹è½½åœ°å€ä¸ºï¼šhttp://archive.ics.uci.edu/ml/machine-learning-databases/iris/ã€‚</p><p>IRISæ•°æ®é›†æ˜¯ç”¨æ¥ç»™é¸¢å°¾èŠ±åšåˆ†ç±»çš„æ•°æ®é›†ï¼Œä¸€å…±150ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬åŒ…å«äº†èŠ±è¼é•¿åº¦ï¼ˆsepallength in cmï¼‰ã€èŠ±è¼å®½åº¦ï¼ˆsepal width in cmï¼‰ã€èŠ±ç“£é•¿åº¦ï¼ˆpetal length incmï¼‰ã€èŠ±ç“£å®½åº¦ï¼ˆpetal width incmï¼‰å››ä¸ªç‰¹å¾ï¼Œå°†é¸¢å°¾èŠ±åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«ä¸ºIris Setosaï¼ŒIrisVersicolourï¼ŒIris Virginicaï¼Œæ¯ä¸€ç±»éƒ½æœ‰50ä¸ªæ ·æœ¬ã€‚</p><p>IRISæ•°æ®é›†å…·ä½“å¦‚ä¸‹ï¼ˆåªå±•ç¤ºéƒ¨åˆ†æ•°æ®ï¼Œé¡ºåºå·²æ‰“ä¹±ï¼‰ï¼š</p><figure><img src="/img/keras1_1.png" alt="irisæ•°æ®é›†é¢„è§ˆ" /><figcaption aria-hidden="true">irisæ•°æ®é›†é¢„è§ˆ</figcaption></figure><h3 id="è¯»å–æ•°æ®é›†">è¯»å–æ•°æ®é›†</h3><p>ç¬”è€…çš„IRISæ•°æ®é›†ä»¥csvæ ¼å¼å‚¨å­˜ï¼Œç¬”è€…å°†ä½¿ç”¨Pandasæ¥è¯»å–IRISæ•°æ®é›†ï¼Œå¹¶å¯¹ç›®æ ‡å˜é‡è¿›è¡Œ0-1ç¼–ç ï¼ˆOne-hotEncodingï¼‰ï¼Œæœ€åå°†è¯¥æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ¯”ä¾‹ä¸º7:3ã€‚å®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelBinarizer<br><br><span class="hljs-comment"># è¯»å–CSVæ•°æ®é›†ï¼Œå¹¶æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br><span class="hljs-comment"># è¯¥å‡½æ•°çš„ä¼ å…¥å‚æ•°ä¸ºCSV_FILE_PATH: csvæ–‡ä»¶è·¯å¾„</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>(<span class="hljs-params">CSV_FILE_PATH</span>):<br>    IRIS = pd.read_csv(CSV_FILE_PATH)<br>    target_var = <span class="hljs-string">&#x27;class&#x27;</span>  <span class="hljs-comment"># ç›®æ ‡å˜é‡</span><br>    <span class="hljs-comment"># æ•°æ®é›†çš„ç‰¹å¾</span><br>    features = <span class="hljs-built_in">list</span>(IRIS.columns)<br>    features.remove(target_var)<br>    <span class="hljs-comment"># ç›®æ ‡å˜é‡çš„ç±»åˆ«</span><br>    Class = IRIS[target_var].unique()<br>    <span class="hljs-comment"># ç›®æ ‡å˜é‡çš„ç±»åˆ«å­—å…¸</span><br>    Class_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(Class, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Class))))<br>    <span class="hljs-comment"># å¢åŠ ä¸€åˆ—target, å°†ç›®æ ‡å˜é‡è¿›è¡Œç¼–ç </span><br>    IRIS[<span class="hljs-string">&#x27;target&#x27;</span>] = IRIS[target_var].apply(<span class="hljs-keyword">lambda</span> x: Class_dict[x])<br>    <span class="hljs-comment"># å¯¹ç›®æ ‡å˜é‡è¿›è¡Œ0-1ç¼–ç (One-hot Encoding)</span><br>    lb = LabelBinarizer()<br>    lb.fit(<span class="hljs-built_in">list</span>(Class_dict.values()))<br>    transformed_labels = lb.transform(IRIS[<span class="hljs-string">&#x27;target&#x27;</span>])<br>    y_bin_labels = []  <span class="hljs-comment"># å¯¹å¤šåˆ†ç±»è¿›è¡Œ0-1ç¼–ç çš„å˜é‡</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(transformed_labels.shape[<span class="hljs-number">1</span>]):<br>        y_bin_labels.append(<span class="hljs-string">&#x27;y&#x27;</span> + <span class="hljs-built_in">str</span>(i))<br>        IRIS[<span class="hljs-string">&#x27;y&#x27;</span> + <span class="hljs-built_in">str</span>(i)] = transformed_labels[:, i]<br>    <span class="hljs-comment"># å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br>    train_x, test_x, train_y, test_y = train_test_split(IRIS[features], IRIS[y_bin_labels], \<br>                                                        train_size=<span class="hljs-number">0.7</span>, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> train_x, test_x, train_y, test_y, Class_dict<br></code></pre></td></tr></table></figure><h3 id="æ­å»ºdnn">æ­å»ºDNN</h3><p>æ¥ä¸‹æ¥ï¼Œç¬”è€…å°†å±•ç¤ºå¦‚ä½•åˆ©ç”¨Kerasæ¥æ­å»ºä¸€ä¸ªç®€å•çš„æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰æ¥è§£å†³è¿™ä¸ªå¤šåˆ†ç±»é—®é¢˜ã€‚æˆ‘ä»¬è¦æ­å»ºçš„DNNçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="/img/keras1_2.png" alt="DNNç»“æ„ç¤ºæ„å›¾" /><figcaption aria-hidden="true">DNNç»“æ„ç¤ºæ„å›¾</figcaption></figure><p>æˆ‘ä»¬æ­å»ºçš„DNNç”±è¾“å…¥å±‚ã€éšè—å±‚ã€è¾“å‡ºå±‚å’Œsoftmaxå‡½æ•°ç»„æˆï¼Œå…¶ä¸­è¾“å…¥å±‚ç”±4ä¸ªç¥ç»å…ƒç»„æˆï¼Œå¯¹åº”IRISæ•°æ®é›†ä¸­çš„4ä¸ªç‰¹å¾ï¼Œä½œä¸ºè¾“å…¥å‘é‡ï¼Œéšè—å±‚æœ‰ä¸¤å±‚ï¼Œæ¯å±‚åˆ†åˆ«æœ‰5å’Œ6ä¸ªç¥ç»å…ƒï¼Œä¹‹åå°±æ˜¯è¾“å‡ºå±‚ï¼Œç”±3ä¸ªç¥ç»å…ƒç»„æˆï¼Œå¯¹åº”IRISæ•°æ®é›†çš„ç›®æ ‡å˜é‡çš„ç±»åˆ«ä¸ªæ•°ï¼Œæœ€åï¼Œå°±æ˜¯ä¸€ä¸ªsoftmaxå‡½æ•°ï¼Œç”¨äºè§£å†³å¤šåˆ†ç±»é—®é¢˜è€Œåˆ›å»ºã€‚</p><p>å¯¹åº”ä»¥ä¸Šçš„DNNç»“æ„ï¼Œç”¨Kerasæ¥æ­å»ºçš„è¯ï¼Œå…¶Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> keras <span class="hljs-keyword">as</span> K<br> <span class="hljs-comment"># 2. å®šä¹‰æ¨¡å‹</span><br> init = K.initializers.glorot_uniform(seed=<span class="hljs-number">1</span>)<br> simple_adam = K.optimizers.Adam()<br> model = K.models.Sequential()<br> model.add(K.layers.Dense(units=<span class="hljs-number">5</span>, input_dim=<span class="hljs-number">4</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br> model.add(K.layers.Dense(units=<span class="hljs-number">6</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br> model.add(K.layers.Dense(units=<span class="hljs-number">3</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>))<br> model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>, optimizer=simple_adam, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©çš„ç¥ç»å…ƒæ¿€æ´»å‡½æ•°ä¸ºReLUå‡½æ•°ï¼ŒæŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µï¼ˆcrossentropyï¼‰ï¼Œè¿­ä»£çš„ä¼˜åŒ–å™¨ï¼ˆoptimizerï¼‰é€‰æ‹©Adamï¼Œæœ€åˆå„ä¸ªå±‚çš„è¿æ¥æƒé‡ï¼ˆweightsï¼‰å’Œåé‡ï¼ˆbiasesï¼‰æ˜¯éšæœºç”Ÿæˆçš„ã€‚è¿™æ ·æˆ‘ä»¬å°±è®²è¿™ä¸ªDNNçš„æ¨¡å‹å®šä¹‰å®Œæ¯•äº†ã€‚è¿™ä¹ˆç®€å•ï¼ŸYes,that's it!</p><h3 id="è®­ç»ƒåŠé¢„æµ‹">è®­ç»ƒåŠé¢„æµ‹</h3><p>OKï¼Œå®šä¹‰å®Œæ¨¡å‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒã€è¯„ä¼°åŠé¢„æµ‹ã€‚å¯¹äºæ¨¡å‹è®­ç»ƒï¼Œæˆ‘ä»¬æ¯æ¬¡è®­ç»ƒçš„æ‰¹æ•°ä¸º1ï¼Œå…±è¿­ä»£100æ¬¡ï¼Œä»£ç å¦‚ä¸‹ï¼ˆæ¥ä»¥ä¸Šä»£ç ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 3. è®­ç»ƒæ¨¡å‹</span><br>b_size = <span class="hljs-number">1</span><br>max_epochs = <span class="hljs-number">100</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Starting training &quot;</span>)<br>h = model.fit(train_x, train_y, batch_size=b_size, epochs=max_epochs, shuffle=<span class="hljs-literal">True</span>, verbose=<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Training finished \n&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¸ºäº†å¯¹æ¨¡å‹æœ‰ä¸ªè¯„ä¼°ï¼Œæ„ŸçŸ¥æ¨¡å‹çš„è¡¨ç°ï¼Œéœ€è¦è¾“å‡ºè¯¥DNNæ¨¡å‹çš„æŸå¤±å‡½æ•°çš„å€¼ä»¥åŠåœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ï¼Œå…¶Pythonä»£ç å¦‚ä¸‹ï¼ˆæ¥ä»¥ä¸Šä»£ç ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 4. è¯„ä¼°æ¨¡å‹</span><br><span class="hljs-built_in">eval</span> = model.evaluate(test_x, test_y, verbose=<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Evaluation on test data: loss = %0.6f accuracy = %0.2f%% \n&quot;</span> \<br>      % (<span class="hljs-built_in">eval</span>[<span class="hljs-number">0</span>], <span class="hljs-built_in">eval</span>[<span class="hljs-number">1</span>] * <span class="hljs-number">100</span>) )<br></code></pre></td></tr></table></figure><p>è®­ç»ƒ100æ¬¡ï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼ˆä¸­é—´éƒ¨åˆ†çš„è®­ç»ƒå±•ç¤ºå·²å¿½ç•¥ï¼‰ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs lasso">Starting training <br>Epoch <span class="hljs-number">1</span>/<span class="hljs-number">100</span><br><br>  <span class="hljs-number">1</span>/<span class="hljs-number">105</span> <span class="hljs-meta">[</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-meta">]</span> - ETA: 17s - loss: 0.3679 - acc: 1.0000<br> 42/105 <span class="hljs-meta">[</span>===========&gt;<span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-meta">]</span> - ETA: 0s - loss: 1.8081 - acc: 0.3095 <br> 89/105 <span class="hljs-meta">[</span>========================&gt;<span class="hljs-params">...</span>..<span class="hljs-meta">]</span> - ETA: 0s - loss: 1.5068 - acc: 0.4270<br>105/105 <span class="hljs-meta">[</span>==============================<span class="hljs-meta">]</span> - 0s 3ms/step - loss: 1.4164 - acc: 0.4667<br>Epoch 2/100<br><br>  1/105 <span class="hljs-meta">[</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-meta">]</span> - ETA: 0s - loss: 0.4766 - acc: 1.0000<br> 45/105 <span class="hljs-meta">[</span>===========&gt;<span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-meta">]</span> - ETA: 0s - loss: 1.0813 - acc: 0.4889<br> 93/105 <span class="hljs-meta">[</span>=========================&gt;<span class="hljs-params">...</span>.<span class="hljs-meta">]</span> - ETA: 0s - loss: 1.0335 - acc: 0.4839<br>105/105 <span class="hljs-meta">[</span>==============================<span class="hljs-meta">]</span> - 0s 1ms/step - loss: 1.0144 - acc: 0.4857<br><br>......<br><br>Epoch 99/100<br><br>  1/105 <span class="hljs-meta">[</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-meta">]</span> - ETA: 0s - loss: 0.0013 - acc: 1.0000<br> 43/105 <span class="hljs-meta">[</span>===========&gt;<span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-meta">]</span> - ETA: 0s - loss: 0.0447 - acc: 0.9767<br> 84/105 <span class="hljs-meta">[</span>=======================&gt;<span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-meta">]</span> - ETA: 0s - loss: 0.0824 - acc: 0.9524<br>105/105 <span class="hljs-meta">[</span>==============================<span class="hljs-meta">]</span> - 0s 1ms/step - loss: 0.0711 - acc: 0.9619<br>Epoch 100/100<br><br>  1/105 <span class="hljs-meta">[</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-meta">]</span> - ETA: 0s - loss: 2.3032 - acc: 0.0000e+00<br> 51/105 <span class="hljs-meta">[</span>=============&gt;<span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<span class="hljs-meta">]</span> - ETA: 0s - loss: 0.1122 - acc: 0.9608    <br> 99/105 <span class="hljs-meta">[</span>===========================&gt;..<span class="hljs-meta">]</span> - ETA: 0s - loss: 0.0755 - acc: 0.9798<br>105/105 <span class="hljs-meta">[</span>==============================<span class="hljs-meta">]</span> - 0s 1ms/step - loss: 0.0756 - acc: 0.9810<br>Training finished <br><br>Evaluation on test data: loss = 0.094882 accuracy = 97.78% <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè®­ç»ƒå®Œ100æ¬¡åï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡å·²è¾¾åˆ°97.78%ï¼Œæ•ˆæœç›¸å½“å¥½ã€‚</p><p>æœ€åæ˜¯å¯¹æ–°æ•°æ®é›†è¿›è¡Œé¢„æµ‹ï¼Œæˆ‘ä»¬å‡è®¾ä¸€æœµé¸¢å°¾èŠ±çš„4ä¸ªç‰¹å¾ä¸º6.1,3.1,5.1,1.1ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“è¿™ä¸ªDNNæ¨¡å‹ä¼šæŠŠå®ƒé¢„æµ‹åˆ°å“ªä¸€ç±»ï¼Œå…¶Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br> <span class="hljs-comment"># 5. ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹</span><br> np.set_printoptions(precision=<span class="hljs-number">4</span>)<br> unknown = np.array([[<span class="hljs-number">6.1</span>, <span class="hljs-number">3.1</span>, <span class="hljs-number">5.1</span>, <span class="hljs-number">1.1</span>]], dtype=np.float32)<br> predicted = model.predict(unknown)<br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using model to predict species for features: &quot;</span>)<br> <span class="hljs-built_in">print</span>(unknown)<br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nPredicted softmax vector is: &quot;</span>)<br> <span class="hljs-built_in">print</span>(predicted)<br> species_dict = &#123;v:k <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> Class_dict.items()&#125;<br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nPredicted species is: &quot;</span>)<br> <span class="hljs-built_in">print</span>(species_dict[np.argmax(predicted)])<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lua">Using model to predict species <span class="hljs-keyword">for</span> features: <br><span class="hljs-string">[[ 6.1  3.1  5.1  1.1]]</span><br><br>Predicted softmax vector is: <br><span class="hljs-string">[[  2.0687e-07   9.7901e-01   2.0993e-02]]</span><br><br>Predicted species is: <br>versicolor<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä»”ç»†åœ°æ¯”å¯¹IRISæ•°æ®é›†ï¼Œå°±ä¼šå‘ç°ï¼Œè¿™ä¸ªé¢„æµ‹ç»“æœä»¤äººç›¸å½“æ»¡æ„ï¼Œè¿™ä¸ªé¸¢å°¾èŠ±æ ·æœ¬çš„é¢„æµ‹ç»“æœï¼Œä»¥äººç±»çš„çœ¼å…‰æ¥çœ‹ï¼Œä¹Ÿåº”å½“æ˜¯versicolorã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œç¬”è€…å°±æŠŠè¿™ä¸ªæ¼”ç¤ºä¾‹å­ç»™è®²å®Œäº†ï¼Œä½œä¸ºå…¥é—¨Kerasçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸ªä¾‹å­è¿˜æ˜¯å¯ä»¥çš„ã€‚å›é¡¾è¯¥æ¨¡å‹ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ©ç”¨Pandasè¯»å–IRISæ•°æ®é›†ï¼Œå¹¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œç„¶åç”¨Kerasæ­å»ºäº†ä¸€ä¸ªç®€å•çš„DNNæ¨¡å‹ï¼Œå¹¶å¯¹è¯¥æ¨¡å‹è¿›è¡Œè®­ç»ƒåŠè¯„ä¼°ï¼Œæœ€åçœ‹ä¸€ä¸‹è¯¥æ¨¡å‹åœ¨æ–°æ•°æ®é›†ä¸Šçš„é¢„æµ‹èƒ½åŠ›ã€‚ä»ä¸­ï¼Œè¯»è€…ä¸éš¾ä½“ä¼šåˆ°Kerasçš„ä¼˜è¶Šæ€§ï¼Œå› ä¸ºï¼Œç›¸æ¯”TensorFlow,æ­å»ºåŒæ ·çš„DNNæ¨¡å‹åŠæ¨¡å‹è®­ç»ƒã€è¯„ä¼°ã€é¢„æµ‹ï¼Œå…¶Pythonä»£ç æ— ç–‘ä¼šæ¯”Kerasæ¥å¾—é•¿ã€‚</p><p>æœ€åï¼Œé™„ä¸Šè¯¥DNNæ¨¡å‹çš„å®Œæ•´Pythonä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># iris_keras_dnn.py</span><br><span class="hljs-comment"># Python 3.5.1, TensorFlow 1.6.0, Keras 2.1.5</span><br><span class="hljs-comment"># ========================================================</span><br><span class="hljs-comment"># å¯¼å…¥æ¨¡å—</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> keras <span class="hljs-keyword">as</span> K<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelBinarizer<br>os.environ[<span class="hljs-string">&#x27;TF_CPP_MIN_LOG_LEVEL&#x27;</span>]=<span class="hljs-string">&#x27;2&#x27;</span><br><br><span class="hljs-comment"># è¯»å–CSVæ•°æ®é›†ï¼Œå¹¶æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br><span class="hljs-comment"># è¯¥å‡½æ•°çš„ä¼ å…¥å‚æ•°ä¸ºCSV_FILE_PATH: csvæ–‡ä»¶è·¯å¾„</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>(<span class="hljs-params">CSV_FILE_PATH</span>):<br>    IRIS = pd.read_csv(CSV_FILE_PATH)<br>    target_var = <span class="hljs-string">&#x27;class&#x27;</span>  <span class="hljs-comment"># ç›®æ ‡å˜é‡</span><br>    <span class="hljs-comment"># æ•°æ®é›†çš„ç‰¹å¾</span><br>    features = <span class="hljs-built_in">list</span>(IRIS.columns)<br>    features.remove(target_var)<br>    <span class="hljs-comment"># ç›®æ ‡å˜é‡çš„ç±»åˆ«</span><br>    Class = IRIS[target_var].unique()<br>    <span class="hljs-comment"># ç›®æ ‡å˜é‡çš„ç±»åˆ«å­—å…¸</span><br>    Class_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(Class, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Class))))<br>    <span class="hljs-comment"># å¢åŠ ä¸€åˆ—target, å°†ç›®æ ‡å˜é‡è¿›è¡Œç¼–ç </span><br>    IRIS[<span class="hljs-string">&#x27;target&#x27;</span>] = IRIS[target_var].apply(<span class="hljs-keyword">lambda</span> x: Class_dict[x])<br>    <span class="hljs-comment"># å¯¹ç›®æ ‡å˜é‡è¿›è¡Œ0-1ç¼–ç (One-hot Encoding)</span><br>    lb = LabelBinarizer()<br>    lb.fit(<span class="hljs-built_in">list</span>(Class_dict.values()))<br>    transformed_labels = lb.transform(IRIS[<span class="hljs-string">&#x27;target&#x27;</span>])<br>    y_bin_labels = []  <span class="hljs-comment"># å¯¹å¤šåˆ†ç±»è¿›è¡Œ0-1ç¼–ç çš„å˜é‡</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(transformed_labels.shape[<span class="hljs-number">1</span>]):<br>        y_bin_labels.append(<span class="hljs-string">&#x27;y&#x27;</span> + <span class="hljs-built_in">str</span>(i))<br>        IRIS[<span class="hljs-string">&#x27;y&#x27;</span> + <span class="hljs-built_in">str</span>(i)] = transformed_labels[:, i]<br>    <span class="hljs-comment"># å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br>    train_x, test_x, train_y, test_y = train_test_split(IRIS[features], IRIS[y_bin_labels], \<br>                                                        train_size=<span class="hljs-number">0.7</span>, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> train_x, test_x, train_y, test_y, Class_dict<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><br>    <span class="hljs-comment"># 0. å¼€å§‹</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nIris dataset using Keras/TensorFlow &quot;</span>)<br>    np.random.seed(<span class="hljs-number">4</span>)<br>    tf.set_random_seed(<span class="hljs-number">13</span>)<br><br>    <span class="hljs-comment"># 1. è¯»å–CSVæ•°æ®é›†</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Loading Iris data into memory&quot;</span>)<br>    CSV_FILE_PATH = <span class="hljs-string">&#x27;E://iris.csv&#x27;</span><br>    train_x, test_x, train_y, test_y, Class_dict = load_data(CSV_FILE_PATH)<br><br>    <span class="hljs-comment"># 2. å®šä¹‰æ¨¡å‹</span><br>    init = K.initializers.glorot_uniform(seed=<span class="hljs-number">1</span>)<br>    simple_adam = K.optimizers.Adam()<br>    model = K.models.Sequential()<br>    model.add(K.layers.Dense(units=<span class="hljs-number">5</span>, input_dim=<span class="hljs-number">4</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br>    model.add(K.layers.Dense(units=<span class="hljs-number">6</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;relu&#x27;</span>))<br>    model.add(K.layers.Dense(units=<span class="hljs-number">3</span>, kernel_initializer=init, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>))<br>    model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>, optimizer=simple_adam, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br>    <span class="hljs-comment"># 3. è®­ç»ƒæ¨¡å‹</span><br>    b_size = <span class="hljs-number">1</span><br>    max_epochs = <span class="hljs-number">100</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Starting training &quot;</span>)<br>    h = model.fit(train_x, train_y, batch_size=b_size, epochs=max_epochs, shuffle=<span class="hljs-literal">True</span>, verbose=<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Training finished \n&quot;</span>)<br><br>    <span class="hljs-comment"># 4. è¯„ä¼°æ¨¡å‹</span><br>    <span class="hljs-built_in">eval</span> = model.evaluate(test_x, test_y, verbose=<span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Evaluation on test data: loss = %0.6f accuracy = %0.2f%% \n&quot;</span> \<br>          % (<span class="hljs-built_in">eval</span>[<span class="hljs-number">0</span>], <span class="hljs-built_in">eval</span>[<span class="hljs-number">1</span>] * <span class="hljs-number">100</span>) )<br><br>    <span class="hljs-comment"># 5. ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹</span><br>    np.set_printoptions(precision=<span class="hljs-number">4</span>)<br>    unknown = np.array([[<span class="hljs-number">6.1</span>, <span class="hljs-number">3.1</span>, <span class="hljs-number">5.1</span>, <span class="hljs-number">1.1</span>]], dtype=np.float32)<br>    predicted = model.predict(unknown)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using model to predict species for features: &quot;</span>)<br>    <span class="hljs-built_in">print</span>(unknown)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nPredicted softmax vector is: &quot;</span>)<br>    <span class="hljs-built_in">print</span>(predicted)<br>    species_dict = &#123;v:k <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> Class_dict.items()&#125;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nPredicted species is: &quot;</span>)<br>    <span class="hljs-built_in">print</span>(species_dict[np.argmax(predicted)])<br><br>main()<br></code></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>Kerasä¸­æ–‡æ–‡æ¡£ï¼š https://keras-cn.readthedocs.io/en/latest/</li><li>Keras Succinctly:http://ebooks.syncfusion.com/downloads/keras-succinctly/keras-succinctly.pdf?AWSAccessKeyId=AKIAJ5W3G2Z6F2ZHAREQ&amp;Expires=1539315050&amp;Signature=r6qJ%2BP7KUEU442WMObSLd2%2Flkqw%3D</li><li>IRISæ•°æ®é›†ï¼šhttp://archive.ics.uci.edu/ml/machine-learning-databases/iris/</li></ol><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¹¦ç±æ‘˜æŠ„Latexä»£ç </title>
    <link href="/2023/08/06/%E4%B9%A6%E7%B1%8D%E6%91%98%E6%8A%84Latex%E4%BB%A3%E7%A0%81/"/>
    <url>/2023/08/06/%E4%B9%A6%E7%B1%8D%E6%91%98%E6%8A%84Latex%E4%BB%A3%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä½¿ç”¨å·¥å…·: TeX Live + TeXstudio + Latex<br>Latexæºä»£ç ï¼š</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\documentclass</span>&#123;article&#125;<br><span class="hljs-keyword">\usepackage</span>[utf8]&#123;inputenc&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;graphicx&#125; <span class="hljs-comment">% Required for inserting images</span><br><span class="hljs-keyword">\usepackage</span>&#123;wrapfig&#125;  <span class="hljs-comment">% å›¾æ–‡æ··æ’æ”¯æŒ</span><br><span class="hljs-keyword">\usepackage</span>&#123;caption&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;ctex&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;color&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;amssymb&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;amsmath&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;amsthm&#125;<br><span class="hljs-keyword">\usepackage</span>[a4paper,margin=1in]&#123;geometry&#125; <span class="hljs-comment">% é¡µé¢è®¾ç½®</span><br><span class="hljs-keyword">\usepackage</span>&#123;wallpaper&#125;<br><span class="hljs-comment">%\TileWallPaper&#123;\paperwidth&#125;&#123;\paperheight&#125;&#123;pictures/test.jpg&#125;</span><br><br><span class="hljs-keyword">\linespread</span>&#123;2&#125; <span class="hljs-comment">% è®¾ç½®è¡Œè·</span><br><br><span class="hljs-keyword">\title</span>&#123;ã€Šã€‹æ‘˜æŠ„&#125;<br><span class="hljs-keyword">\author</span>&#123;<span class="hljs-keyword">\quad</span> è‘—&#125;<br><span class="hljs-keyword">\date</span>&#123;<span class="hljs-keyword">\today</span>&#125;<br><br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br><br><span class="hljs-keyword">\maketitle</span><br><br><span class="hljs-keyword">\begin</span>&#123;figure&#125;<br><span class="hljs-keyword">\centering</span><br><span class="hljs-keyword">\includegraphics</span>[width=16cm]&#123;pictures//test.jpg&#125;<br><span class="hljs-keyword">\caption</span>*&#123;ä¹¦æœ¬å°é¢&#125;<br><span class="hljs-keyword">\end</span>&#123;figure&#125;<br><br><span class="hljs-keyword">\newpage</span><br><span class="hljs-keyword">\songti</span><span class="hljs-keyword">\zihao</span>&#123;-4&#125;<br><br><span class="hljs-keyword">\begin</span>&#123;enumerate&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\item</span> <span class="hljs-keyword">\setlength</span>&#123;<span class="hljs-keyword">\parindent</span>&#125;&#123;2em&#125;<br><span class="hljs-keyword">\end</span>&#123;enumerate&#125;<br><br><br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šå¯»è·¯ä¸­å›½ã€‹æ‘˜æŠ„</title>
    <link href="/2023/08/06/%E3%80%8A%E5%AF%BB%E8%B7%AF%E4%B8%AD%E5%9B%BD%E3%80%8B%E6%91%98%E6%8A%84/"/>
    <url>/2023/08/06/%E3%80%8A%E5%AF%BB%E8%B7%AF%E4%B8%AD%E5%9B%BD%E3%80%8B%E6%91%98%E6%8A%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šå¯»è·¯ä¸­å›½ã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šå¯»è·¯ä¸­å›½ã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šä¸‡é‡Œèµ°å•éª‘-è€å•æ—¥è®°ã€‹æ‘˜æŠ„</title>
    <link href="/2023/08/06/%E3%80%8A%E4%B8%87%E9%87%8C%E8%B5%B0%E5%8D%95%E9%AA%91-%E8%80%81%E5%8D%95%E6%97%A5%E8%AE%B0%E3%80%8B%E6%91%98%E6%8A%84/"/>
    <url>/2023/08/06/%E3%80%8A%E4%B8%87%E9%87%8C%E8%B5%B0%E5%8D%95%E9%AA%91-%E8%80%81%E5%8D%95%E6%97%A5%E8%AE%B0%E3%80%8B%E6%91%98%E6%8A%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šä¸‡é‡Œèµ°å•éª‘-è€å•æ—¥è®°ã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šä¸‡é‡Œèµ°å•éª‘-è€å•æ—¥è®°ã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨åŠå…¶åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„åº”ç”¨ä»‹ç»</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%E5%8F%8A%E5%85%B6%E5%9C%A8%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E4%BB%8B%E7%BB%8D/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%E5%8F%8A%E5%85%B6%E5%9C%A8%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/PyTorchå…¥é—¨åŠå…¶åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„åº”ç”¨ä»‹ç».pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/PyTorchå…¥é—¨åŠå…¶åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„åº”ç”¨ä»‹ç».pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆå…«ï¼‰Embeddingå±‚</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89Embedding%E5%B1%82/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89Embedding%E5%B1%82/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è¯å‘é‡å®ç°åœ¨PyTorchä¸­å¯¹åº”äºEmbeddingå±‚ï¼Œå…¶å®ç°ä»£ç çš„æºç å‡½æ•°ï¼ˆPyTorchçš„ç‰ˆæœ¬ä¸º2.0ï¼‰å¦‚ä¸‹ï¼š</p><blockquote><p>torch.nn.Embedding(num_embeddings, embedding_dim, padding_idx=None, max_norm=None, norm_type=2.0, scale_grad_by_freq=False, sparse=False, _weight=None)</p></blockquote><p>è¯¥å‡½æ•°éšæœºä¼šç”Ÿæˆäº†ä¸€ä¸ªå‘é‡ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ä¸ªè¯å‘é‡æŸ¥è¯¢è¡¨ï¼Œå…¶sizeä¸º[num_embeddingsï¼Œembedding_dim] ã€‚å…¶ä¸­num_embeddingsæ˜¯æŸ¥è¯¢è¡¨çš„å¤§å°ï¼Œembedding_dimæ˜¯æ¯ä¸ªæŸ¥è¯¢å‘é‡çš„ç»´åº¦ã€‚</p><p>å‡½æ•°å‚æ•°è§£é‡Šï¼š</p><ul><li>num_embeddings: int, æŸ¥è¯¢è¡¨çš„å¤§å°</li><li>embedding_dim: int, æ¯ä¸ªæŸ¥è¯¢å‘é‡çš„ç»´åº¦</li><li>padding_idx: int, å¡«å……id</li><li>max_norm: float, æœ€å¤§èŒƒæ•°ï¼Œæ¯ä¸ªèŒƒæ•°è¶…è¿‡max_normçš„embeddingå‘é‡ä¼šé‡æ–°è§„èŒƒåŒ–è‡³å…¶èŒƒæ•°ä¸ºmax_norm</li><li>norm_type: float, pèŒƒæ•°ï¼ˆp=norm_typeï¼‰ï¼Œé»˜è®¤å€¼ä¸º2</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢çš„ä¸‹æ ‡å‘é‡çš„æ•°æ®ç±»å‹å¿…é¡»ä½¿Longï¼Œå³Int64.</p><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªEmbeddingå±‚çš„ä½¿ç”¨ä¾‹å­ã€‚</p><ol><li>ä¾‹å­1ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><br><span class="hljs-comment"># an Embedding module containing 10 tensors of size 3</span><br>embedding = nn.Embedding(<span class="hljs-number">10</span>, <span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>(embedding.weight)<br><span class="hljs-comment"># a batch of 2 samples of 4 indices each</span><br><span class="hljs-built_in">input</span> = torch.LongTensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">9</span>]])<br><span class="hljs-built_in">print</span>(embedding(<span class="hljs-built_in">input</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">Parameter containing:<br>tensor([[ 1.9260, -1.3492,  0.3753],<br>        [ 1.2182,  1.8350,  0.7975],<br>        [ 0.1568,  0.9562,  1.1164],<br>        [ 1.4660,  0.8763,  0.1681],<br>        [ 0.4175,  0.4029, -1.3495],<br>        [-0.5182,  0.1465,  0.0280],<br>        [ 0.7748,  0.1848, -0.4229],<br>        [ 0.3740, -0.2761,  1.5017],<br>        [-0.4583,  0.2934,  0.2217],<br>        [-0.1402, -0.5671, -1.7069]], requires_grad=True)<br>tensor([[[ 1.2182,  1.8350,  0.7975],<br>         [ 0.1568,  0.9562,  1.1164],<br>         [ 0.4175,  0.4029, -1.3495],<br>         [-0.5182,  0.1465,  0.0280]],<br><br>        [[ 0.4175,  0.4029, -1.3495],<br>         [ 1.4660,  0.8763,  0.1681],<br>         [ 0.1568,  0.9562,  1.1164],<br>         [-0.1402, -0.5671, -1.7069]]], grad_fn=&lt;EmbeddingBackward&gt;)<br><br>Process finished with <span class="hljs-built_in">exit</span> code 0<br></code></pre></td></tr></table></figure><ol start="2"><li>ä¾‹å­2ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><br><span class="hljs-comment"># Embedding with padding_idx</span><br>embedding = nn.Embedding(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, padding_idx=<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(embedding.weight)<br><span class="hljs-built_in">input</span> = torch.LongTensor([[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>]])<br><span class="hljs-built_in">print</span>(embedding(<span class="hljs-built_in">input</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs inform7">Parameter containing:<br>tensor(<span class="hljs-comment">[<span class="hljs-comment">[ 0.0000,  0.0000,  0.0000]</span>,</span><br><span class="hljs-comment">        <span class="hljs-comment">[-1.4159, -1.2288,  0.2698]</span>,</span><br><span class="hljs-comment">        <span class="hljs-comment">[-2.2287, -1.5313,  0.3296]</span>,</span><br><span class="hljs-comment">        <span class="hljs-comment">[-1.0393, -0.3102,  0.2819]</span>,</span><br><span class="hljs-comment">        <span class="hljs-comment">[-0.2162, -0.2060,  0.3289]</span>]</span>, requires_grad=True)<br>tensor(<span class="hljs-comment">[<span class="hljs-comment">[<span class="hljs-comment">[ 0.0000,  0.0000,  0.0000]</span>,</span></span><br><span class="hljs-comment"><span class="hljs-comment">         <span class="hljs-comment">[-2.2287, -1.5313,  0.3296]</span>,</span></span><br><span class="hljs-comment"><span class="hljs-comment">         <span class="hljs-comment">[ 0.0000,  0.0000,  0.0000]</span>,</span></span><br><span class="hljs-comment"><span class="hljs-comment">         <span class="hljs-comment">[-0.2162, -0.2060,  0.3289]</span>]</span>]</span>, grad_fn=&lt;EmbeddingBackward&gt;)<br></code></pre></td></tr></table></figure><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒEmbeddingå±‚ä¸­padding_idxå¯¹åº”çš„å‘é‡ä¸ºé›¶å‘é‡ã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol><li>Embedding source code: <a href="https://pytorch.org/docs/stable/generated/torch.nn.Embedding.html">https://pytorch.org/docs/stable/generated/torch.nn.Embedding.html</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆä¸ƒï¼‰TensorBoardå…¥é—¨</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%83%EF%BC%89TensorBoard%E5%85%A5%E9%97%A8/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%83%EF%BC%89TensorBoard%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>PyTorchæ¨¡å‹çš„å¯è§†åŒ–å·¥å…·ï¼š</p><ul><li>Visdom</li><li>TensorBoard</li><li>Pytorchviz</li><li>Netron</li></ul><h3 id="TensorBoardç®€ä»‹">TensorBoardç®€ä»‹</h3><p>TensorBoardæ˜¯TensorFlowè‡ªå¸¦çš„ä¸€ä¸ªå¼ºå¤§çš„å¯è§†åŒ–å·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªWebåº”ç”¨ç¨‹åºå¥—ä»¶ï¼Œå¯ä»¥è®°å½•è®­ç»ƒè¿‡ç¨‹çš„æ•°å­—ã€å›¾åƒç­‰å†…å®¹ï¼Œä»¥æ–¹ä¾¿ç ”ç©¶äººå‘˜è§‚å¯Ÿç¥ç»ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ã€‚</p><p>å¯¹äºPyTorchç­‰å…¶å®ƒæ·±åº¦å­¦ä¹ æ¡†æ¶æ¥è¯´ï¼Œç›®å‰è¿˜æ²¡æœ‰åŠŸèƒ½åƒTensorBoardä¸€æ ·å…¨é¢çš„ç±»ä¼¼å·¥å…·ï¼Œä¸€äº›å·²æœ‰çš„å·¥å…·åŠŸèƒ½ä¹Ÿæœ‰é™ï¼Œæˆ–ä½¿ç”¨èµ·æ¥æ¯”è¾ƒå›°éš¾ã€‚</p><p>TensorBoardæä¾›çš„æœºå™¨å­¦ä¹ å®éªŒæ‰€éœ€çš„å¯è§†åŒ–åŠŸèƒ½å’Œå·¥å…·å¦‚ä¸‹ï¼š</p><ul><li><p>è·Ÿè¸ªå’Œå¯è§†åŒ–æŸå¤±åŠå‡†ç¡®ç‡ç­‰æŒ‡æ ‡</p></li><li><p>å¯è§†åŒ–æ¨¡å‹å›¾</p></li><li><p>æŸ¥çœ‹æƒé‡ã€åå·®æˆ–å…¶å®ƒå¼ é‡éšæ—¶é—´å˜åŒ–çš„ç›´æ–¹å›¾</p></li><li><p>å°†åµŒå…¥å‘é‡æŠ•å½±åˆ°è¾ƒä½ç»´åº¦ç©ºé—´</p></li><li><p>æ˜¾ç¤ºå›¾ç‰‡ã€æ–‡å­—å’ŒéŸ³é¢‘æ•°æ®</p></li><li><p>å‰–æTensorFlowç¨‹åº</p><p>å¦‚æœè¦ä½¿ç”¨TensorBoardï¼Œé¦–å…ˆéœ€è¦å®‰è£…tensorflow, tensorboard, tensorboardX, ä»£ç å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install tensorflow<br>pip3 install tensorboard<br>pip3 install tensorboardX<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒtensorboardXè¿™ä¸ªå·¥å…·å¯ä½¿å¾—TensorFlowå¤–çš„å…¶å®ƒæ·±åº¦å­¦ä¹ æ¡†æ¶ä¹Ÿå¯ä»¥ä½¿ç”¨TensorBoardçš„ä¾¿æ·åŠŸèƒ½ã€‚</p><p>TensorBoardç›®å‰æ”¯æŒ7ç§å¯è§†åŒ–ï¼ŒåŒ…æ‹¬Scalars, Images, Audio, Graphs, Distributions, Histograms, Embeddings, ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li><p>Scalars: å±•ç¤ºè®­ç»ƒè¿‡ç¨‹ä¸­çš„å‡†ç¡®ç‡ã€æŸå¤±å€¼ã€æƒé‡/åå·®çš„å˜åŒ–æƒ…å†µ</p></li><li><p>Images: å±•ç¤ºè®­ç»ƒè¿‡ç¨‹ä¸­è®°å½•çš„å›¾åƒ</p></li><li><p>Audio: å±•ç¤ºè®­ç»ƒè¿‡ç¨‹ä¸­è®°å½•çš„éŸ³é¢‘</p></li><li><p>Graphs: å±•ç¤ºæ¨¡å‹çš„æ•°æ®æµå›¾ï¼Œä»¥åŠè®­ç»ƒåœ¨å„ä¸ªè®¾å¤‡ä¸Šæ¶ˆè€—çš„å†…å­˜å’Œæ—¶é—´</p></li><li><p>Distributions: å±•ç¤ºè®­ç»ƒè¿‡ç¨‹ä¸­è®°å½•çš„æ•°æ®çš„åˆ†å¸ƒå›¾</p></li><li><p>Histograms: å±•ç¤ºè®­ç»ƒè¿‡ç¨‹ä¸­è®°å½•çš„æ•°æ®çš„æŸ±çŠ¶å›¾</p></li><li><p>Embeddings: å±•ç¤ºè¯å‘é‡çš„æŠ•å½±åˆ†å¸ƒ</p><p>å¯åŠ¨TensorBoard:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tonsorboard --logdir=./run/<br></code></pre></td></tr></table></figure><h3 id="TensorBoardåŸºç¡€æ“ä½œ">TensorBoardåŸºç¡€æ“ä½œ</h3><ol><li>å¯è§†åŒ–æ•°å€¼</li></ol><p>ä½¿ç”¨add_scalaræ–¹æ³•æ¥è®°å½•æ•°å­—å¸¸é‡ï¼Œä¸€èˆ¬ä½¿ç”¨add_scalaræ–¹æ³•æ¥è®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­çš„loss, arrcuracy, learning rateç­‰æ•°å€¼çš„å˜åŒ–ï¼Œç›´è§‚åœ°ç›‘æ§è®­ç»ƒè¿‡ç¨‹ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># import modules</span><br><span class="hljs-keyword">from</span> tensorboardX <span class="hljs-keyword">import</span> SummaryWriter<br><span class="hljs-comment"># add_scalar</span><br>writer = SummaryWriter(<span class="hljs-string">&#x27;run/scalar&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    writer.add_scalar(<span class="hljs-string">&#x27;æŒ‡æ•°&#x27;</span>, <span class="hljs-number">3</span>**i, global_step=i)<br></code></pre></td></tr></table></figure><p><img src="/img/pytorch7_1.png" alt="åœ¨tensorboardä¸­æŸ¥çœ‹scalar"></p><ol start="2"><li>å¯è§†åŒ–å›¾ç‰‡</li></ol><p>ä½¿ç”¨add_imagesæ–¹æ³•æ¥è®°å½•å›¾åƒæ•°æ®ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨add_imagesæ¥å®æ—¶è§‚å¯Ÿæ¨¡å‹çš„ç”Ÿæˆæ•ˆæœï¼Œæˆ–è€…å¯è§†åŒ–åˆ†å‰²ã€ç›®æ ‡æ£€æµ‹çš„ç»“æœï¼Œå¸®åŠ©è°ƒè¯•æ¨¡å‹ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># add_images</span><br><span class="hljs-keyword">import</span> cv2<br><br>writer = SummaryWriter(<span class="hljs-string">&#x27;run/image&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>):<br>    writer.add_images(<span class="hljs-string">&#x27;&#x27;</span>, <br>                      cv2.cvtColor(cv2.imread(<span class="hljs-string">&#x27;./image/image&#123;&#125;.png&#x27;</span>.<span class="hljs-built_in">format</span>(i)), cv2.COLOR_BGR2RGB), <br>                      global_step=i, <br>                      dataformats=<span class="hljs-string">&#x27;HWC&#x27;</span>)<br></code></pre></td></tr></table></figure><p><img src="/img/pytorch7_2.png" alt="åœ¨tensorboardä¸­æŸ¥çœ‹å›¾ç‰‡"></p><ol start="3"><li>å¯è§†åŒ–ç»Ÿè®¡å›¾</li></ol><p>ä½¿ç”¨add_histogramæ–¹æ³•æ¥è®°å½•ä¸€ç»„æ•°æ®çš„ç›´æ–¹å›¾ã€‚å¯ä»¥é€šè¿‡è§‚å¯Ÿæ•°æ®ã€è®­ç»ƒå‚æ•°ã€ç‰¹å¾çš„ç›´æ–¹å›¾äº†è§£åˆ°å®ƒä»¬å¤§è‡´çš„åˆ†å¸ƒæƒ…å†µï¼Œè¾…åŠ©ç¥ç»ç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># add_histogram</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>writer = SummaryWriter(<span class="hljs-string">&#x27;run/histogram&#x27;</span>)<br>writer.add_histogram(<span class="hljs-string">&#x27;æ­£æ€åˆ†å¸ƒä¸­å¿ƒåŒ–&#x27;</span>, np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>), global_step=<span class="hljs-number">1</span>)<br>writer.add_histogram(<span class="hljs-string">&#x27;æ­£æ€åˆ†å¸ƒä¸­å¿ƒåŒ–&#x27;</span>, np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1000</span>), global_step=<span class="hljs-number">50</span>)<br>writer.add_histogram(<span class="hljs-string">&#x27;æ­£æ€åˆ†å¸ƒä¸­å¿ƒåŒ–&#x27;</span>, np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1000</span>), global_step=<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure><p>åœ¨TensorBoardå¯è§†åŒ–ç•Œé¢ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°DISTRIBUTIONSå’ŒHISTOGRAMSä¸¤æ ï¼Œå®ƒä»¬éƒ½æ˜¯ç”¨æ¥è§‚å¯Ÿæ•°æ®åˆ†å¸ƒçš„ã€‚åœ¨HISTOGRAMSä¸­ï¼ŒåŒä¸€æ•°æ®ä¸åŒæ­¥æ•°çš„ç›´æ–¹å›¾å¯ä»¥ä¸Šä¸‹é”™ä½æ’å¸ƒï¼ˆOFFSETï¼‰ä¹Ÿå¯ä»¥é‡å æ’å¸ƒï¼ˆOVERLAYï¼‰ã€‚</p><p><img src="/img/pytorch7_3.png" alt="åœ¨tensorboardä¸­æŸ¥çœ‹æŸ±çŠ¶å›¾"></p><ol start="4"><li>å¯è§†åŒ–æ¨¡å‹å›¾</li></ol><p>ä½¿ç”¨add_graphæ–¹æ³•æ¥å¯è§†åŒ–ä¸€ä¸ªç¥ç»ç½‘ç»œã€‚è¯¥æ–¹æ³•å¯ä»¥å°†ç¥ç»ç½‘ç»œæ¨¡å‹å¯è§†åŒ–ï¼Œæ˜¾ç¤ºæ¨¡å‹ä¸­çš„æ“ä½œå’Œç½‘ç»œå±‚ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br>dummy_input = (torch.zeros(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>),)<br>writer = SummaryWriter(<span class="hljs-string">&#x27;run/graph&#x27;</span>)<br><br><span class="hljs-comment"># simple MLP model</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LinearInLinear</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(LinearInLinear, self).__init__()<br>        self.l = nn.Linear(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-keyword">return</span> self.l(x)<br><br>writer.add_graph(LinearInLinear(), dummy_input)<br></code></pre></td></tr></table></figure><p><img src="/img/pytorch7_4.png" alt="åœ¨tensorboardä¸­æŸ¥çœ‹æ¨¡å‹å›¾"></p><ol start="5"><li>å¯è§†åŒ–å‘é‡</li></ol><p>ä½¿ç”¨add_embeddingæ–¹æ³•å¯ä»¥åœ¨äºŒç»´æˆ–ä¸‰ç»´ç©ºé—´å¯è§†åŒ–Embeddingå‘é‡ã€‚add_embeddingæ–¹æ³•æ˜¯ä¸€ä¸ªå¾ˆå®ç”¨çš„æ–¹æ³•ï¼Œä¸ä»…å¯ä»¥å°†é«˜ç»´ç‰¹å¾ä½¿ç”¨PCA, T-SNEç­‰æ–¹æ³•é™ç»´è‡³äºŒç»´å¹³é¢æˆ–ä¸‰ç»´ç©ºé—´ï¼Œè¿˜å¯ä»¥è§‚å¯Ÿæ¯ä¸€ä¸ªæ•°æ®ç‚¹åœ¨é™ç»´å‰çš„ç‰¹å¾ç©ºé—´çš„Kè¿‘é‚»æƒ…å†µã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬å–MNISTè®­ç»ƒé›†ä¸­çš„å‰30ä¸ªæ•°æ®ï¼Œå°†å›¾åƒå±•å¼€æˆä¸€ç»´å‘é‡ä½œä¸ºEmbeddingï¼Œä½¿ç”¨TensorBoardXè¿›è¡Œå¯è§†åŒ–ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># add_embedding</span><br><span class="hljs-keyword">import</span> torchvision<br><br>writer = SummaryWriter(<span class="hljs-string">&#x27;run/vector&#x27;</span>)<br>mnist = torchvision.datasets.MNIST(<span class="hljs-string">&#x27;./&#x27;</span>, download=<span class="hljs-literal">False</span>)<br>writer.add_embedding(mnist.data.reshape((-<span class="hljs-number">1</span>, <span class="hljs-number">28</span>*<span class="hljs-number">28</span>))[:<span class="hljs-number">30</span>, :],<br>                     metadata=mnist.targets[:<span class="hljs-number">30</span>],<br>                     label_img = mnist.data[:<span class="hljs-number">30</span>, :, :].reshape((-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)).<span class="hljs-built_in">float</span>()/<span class="hljs-number">255</span>,<br>                     global_step=<span class="hljs-number">0</span><br>                    )<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œè™½ç„¶è¿˜æ²¡æœ‰åšä»»ä½•ç‰¹å¾æå–å·¥ä½œï¼Œä½†MNISTæ•°æ®å·²ç»å‘ˆç°å‡ºèšç±»çš„æ•ˆæœï¼Œç›¸åŒæ•°å­—ä¹‹é—´è·ç¦»æ›´è¿‘ä¸€äº›ã€‚</p><p><img src="/img/pytorch7_5.png" alt="åœ¨tensorboardä¸­æŸ¥çœ‹å‘é‡åµŒå…¥"></p><h3 id="TensorBoardå®æˆ˜">TensorBoardå®æˆ˜</h3><ol><li>ä¾‹å­1ï¼šåœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­è®°å½•losså’Œaccuracy. Pythonç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> vstack<br><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> argmax<br><span class="hljs-keyword">from</span> pandas <span class="hljs-keyword">import</span> read_csv<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelEncoder, LabelBinarizer<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> SGD, Adam<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, DataLoader, random_split<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Linear, ReLU, Softmax, Module, CrossEntropyLoss<br><span class="hljs-keyword">from</span> torch.nn.init <span class="hljs-keyword">import</span> kaiming_uniform_, xavier_uniform_<br><br><span class="hljs-keyword">from</span> tensorboardX <span class="hljs-keyword">import</span> SummaryWriter<br><br><br><span class="hljs-comment"># dataset definition</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CSVDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, path</span>):<br>        <span class="hljs-comment"># load the csv file as a dataframe</span><br>        df = read_csv(path, header=<span class="hljs-literal">None</span>)<br>        <span class="hljs-comment"># store the inputs and outputs</span><br>        self.X = df.values[:, :-<span class="hljs-number">1</span>]<br>        self.y = df.values[:, -<span class="hljs-number">1</span>]<br>        <span class="hljs-comment"># ensure input data is floats</span><br>        self.X = self.X.astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        <span class="hljs-comment"># label encode target and ensure the values are floats</span><br>        self.y = LabelEncoder().fit_transform(self.y)<br><br>    <span class="hljs-comment"># number of rows in the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.X)<br><br>    <span class="hljs-comment"># get a row at an index</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):<br>        <span class="hljs-keyword">return</span> [self.X[idx], self.y[idx]]<br><br>    <span class="hljs-comment"># get indexes for train and test rows</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_splits</span>(<span class="hljs-params">self, n_test=<span class="hljs-number">0.3</span></span>):<br>        <span class="hljs-comment"># determine sizes</span><br>        test_size = <span class="hljs-built_in">round</span>(n_test * <span class="hljs-built_in">len</span>(self.X))<br>        train_size = <span class="hljs-built_in">len</span>(self.X) - test_size<br>        <span class="hljs-comment"># calculate the split</span><br>        <span class="hljs-keyword">return</span> random_split(self, [train_size, test_size])<br><br><br><span class="hljs-comment"># model definition</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MLP</span>(<span class="hljs-title class_ inherited__">Module</span>):<br>    <span class="hljs-comment"># define model elements</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n_inputs</span>):<br>        <span class="hljs-built_in">super</span>(MLP, self).__init__()<br>        <span class="hljs-comment"># input to first hidden layer</span><br>        self.hidden1 = Linear(n_inputs, <span class="hljs-number">5</span>)<br>        kaiming_uniform_(self.hidden1.weight, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>        self.act1 = ReLU()<br>        <span class="hljs-comment"># second hidden layer</span><br>        self.hidden2 = Linear(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)<br>        kaiming_uniform_(self.hidden2.weight, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>        self.act2 = ReLU()<br>        <span class="hljs-comment"># third hidden layer and output</span><br>        self.hidden3 = Linear(<span class="hljs-number">6</span>, <span class="hljs-number">3</span>)<br>        xavier_uniform_(self.hidden3.weight)<br><br>    <span class="hljs-comment"># forward propagate input</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, X</span>):<br>        <span class="hljs-comment"># input to first hidden layer</span><br>        X = self.hidden1(X)<br>        X = self.act1(X)<br>        <span class="hljs-comment"># second hidden layer</span><br>        X = self.hidden2(X)<br>        X = self.act2(X)<br>        <span class="hljs-comment"># output layer</span><br>        X = self.hidden3(X)<br>        <span class="hljs-keyword">return</span> X<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, file_path, model</span>):<br>        self.writer = SummaryWriter(<span class="hljs-string">&#x27;./run/mlp_demo&#x27;</span>)<br>        <span class="hljs-comment"># load the dataset</span><br>        dataset = CSVDataset(file_path)<br>        <span class="hljs-comment"># calculate split</span><br>        train, test = dataset.get_splits()<br>        <span class="hljs-comment"># prepare data loaders</span><br>        self.train_dl = DataLoader(train, batch_size=<span class="hljs-number">4</span>, shuffle=<span class="hljs-literal">True</span>)<br>        self.test_dl = DataLoader(test, batch_size=<span class="hljs-number">1024</span>, shuffle=<span class="hljs-literal">False</span>)<br>        <span class="hljs-comment"># model</span><br>        self.model = model<br><br>    <span class="hljs-comment"># train the model</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>(<span class="hljs-params">self</span>):<br>        criterion = CrossEntropyLoss()<br>        optimizer = Adam(self.model.parameters())<br>        <span class="hljs-comment"># enumerate epochs</span><br>        <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>            init_loss = torch.Tensor([<span class="hljs-number">0.0</span>])<br>            <span class="hljs-comment"># enumerate mini batches</span><br>            <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.train_dl):<br>                targets = targets.long()<br>                <span class="hljs-comment"># clear the gradients</span><br>                optimizer.zero_grad()<br>                <span class="hljs-comment"># compute the model output</span><br>                yhat = self.model(inputs)<br>                <span class="hljs-comment"># calculate loss</span><br>                loss = criterion(yhat, targets)<br>                <span class="hljs-comment"># credit assignment</span><br>                loss.backward()<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;epoch: &#123;&#125;, batch: &#123;&#125;, loss: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(epoch, i, loss.data))<br>                init_loss += loss.data<br>                <span class="hljs-comment"># update model weights</span><br>                optimizer.step()<br><br>            self.writer.add_scalar(<span class="hljs-string">&#x27;Loss/Train&#x27;</span>, init_loss/(i+<span class="hljs-number">1</span>), epoch)<br>            test_accuracy = self.evaluate_model()<br>            self.writer.add_scalar(<span class="hljs-string">&#x27;Accuracy/Test&#x27;</span>, test_accuracy, epoch)<br><br>    <span class="hljs-comment"># evaluate the model</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_model</span>(<span class="hljs-params">self</span>):<br>        predictions, actuals = [], []<br>        <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.test_dl):<br>            <span class="hljs-comment"># evaluate the model on the test set</span><br>            yhat = self.model(inputs)<br>            <span class="hljs-comment"># retrieve numpy array</span><br>            yhat = yhat.detach().numpy()<br>            actual = targets.numpy()<br>            <span class="hljs-comment"># convert to class labels</span><br>            yhat = argmax(yhat, axis=<span class="hljs-number">1</span>)<br>            <span class="hljs-comment"># reshape for stacking</span><br>            actual = actual.reshape((<span class="hljs-built_in">len</span>(actual), <span class="hljs-number">1</span>))<br>            yhat = yhat.reshape((<span class="hljs-built_in">len</span>(yhat), <span class="hljs-number">1</span>))<br>            <span class="hljs-comment"># store</span><br>            predictions.append(yhat)<br>            actuals.append(actual)<br>        predictions, actuals = vstack(predictions), vstack(actuals)<br>        <span class="hljs-comment"># calculate accuracy</span><br>        acc = accuracy_score(actuals, predictions)<br>        <span class="hljs-keyword">return</span> acc<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># train the model</span><br>    Model(<span class="hljs-string">&#x27;iris.csv&#x27;</span>, MLP(<span class="hljs-number">4</span>)).train()<br></code></pre></td></tr></table></figure><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„è®­ç»ƒé›†çš„æŸå¤±å€¼ä»¥åŠéªŒè¯é›†çš„å‡†ç¡®ç‡å¦‚ä¸‹ï¼š</p><p><img src="/img/pytorch7_6.png" alt="åœ¨tensorboardä¸­æŸ¥çœ‹losså’Œaccuracy"></p><ol start="2"><li>ä¾‹å­2ï¼š åˆ©ç”¨TensorBoardæŸ¥çœ‹ONNXæ–‡ä»¶</li></ol><p>éœ€å®‰è£…Pythonç¬¬ä¸‰æ–¹æ¨¡å—onnx, Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> tensorboardX <span class="hljs-keyword">import</span> SummaryWriter<br><br><span class="hljs-keyword">with</span> SummaryWriter(<span class="hljs-string">&#x27;./run/onnx&#x27;</span>) <span class="hljs-keyword">as</span> w:<br>    w.add_onnx_graph(<span class="hljs-string">&#x27;iris.onnx&#x27;</span>)<br></code></pre></td></tr></table></figure><p>åœ¨TensorBoardä¸­é€‰æ‹©Graphs, Runé€‰é¡¹é€‰æ‹©onnxï¼Œæ¨¡å‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/pytorch7_7.png" alt="åœ¨tensorboardä¸­æŸ¥çœ‹onnxæ¨¡å‹å›¾"></p><p>ä»ä¸­å¯ä»¥çœ‹å‡ºï¼ŒTensorBoardå¯¹äºONNXæ¨¡å‹æ–‡ä»¶æ”¯æŒä¸æ˜¯å¤ªå¥½ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨Netron.</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol><li>tensorboardX Tutorials: <a href="https://tensorboardx.readthedocs.io/en/latest/tutorial.html#tutorials">https://tensorboardx.readthedocs.io/en/latest/tutorial.html#tutorials</a></li><li>åŠ¨æ‰‹å­¦PyTorchæ·±åº¦å­¦ä¹ å»ºæ¨¡ä¸åº”ç”¨ï¼Œç‹å›½å¹³è‘—</li><li>PyTorch ä½¿ç”¨ TensorboardX è¿›è¡Œç½‘ç»œå¯è§†åŒ–ï¼š<a href="https://www.pytorchtutorial.com/pytorch-tensorboardx/">https://www.pytorchtutorial.com/pytorch-tensorboardx/</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorch</tag>
      
      <tag>TensorBoard</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆå…­ï¼‰ä½¿ç”¨Transformeræ¨¡å‹è¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8Transformer%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8Transformer%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <a href="https://percent4.github.io/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8CNN%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/">PyTorchå…¥é—¨ï¼ˆäº”ï¼‰ä½¿ç”¨CNNæ¨¡å‹è¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†å¦‚ä½•åœ¨PyTorchä¸­ä½¿ç”¨CNNæ¨¡å‹è¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‚æœ¬æ–‡å°†ä¼šä½¿ç”¨Transformeræ¨¡å‹å®ç°ä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‚</p><p>æœ¬æ–‡å°†ä¼šä½¿ç”¨ç›¸åŒçš„æ•°æ®é›†ã€‚æ–‡æœ¬é¢„å¤„ç†å·²ç»åœ¨æ–‡ç« <a href="https://blog.csdn.net/jclian91/article/details/129657824">PyTorchå…¥é—¨ï¼ˆäº”ï¼‰ä½¿ç”¨CNNæ¨¡å‹è¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»</a>ä¸­ä»‹ç»ï¼Œæœ¬æ–‡ä½¿ç”¨Transformeræ¨¡å‹çš„Encoderéƒ¨åˆ†ï¼ŒTransformeræ¨¡å‹å¦‚å›¾ï¼š</p><p><img src="/img/pytorch6_1.png" alt="Transformeræ¨¡å‹å›¾"></p><p>ä½¿ç”¨Transformerçš„Encoderéƒ¨åˆ†å»ºç«‹æ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼ŒPythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @Time : 2023/3/16 14:28</span><br><span class="hljs-comment"># @Author : Jclian91</span><br><span class="hljs-comment"># @File : model.py</span><br><span class="hljs-comment"># @Place : Minghang, Shanghai</span><br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><br><span class="hljs-keyword">from</span> params <span class="hljs-keyword">import</span> NUM_WORDS, EMBEDDING_SIZE<br><br><br><span class="hljs-comment"># https://pytorch.org/tutorials/beginner/transformer_tutorial.html</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PositionalEncoding</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, d_model, vocab_size=<span class="hljs-number">5000</span>, dropout=<span class="hljs-number">0.1</span></span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.dropout = nn.Dropout(p=dropout)<br><br>        pe = torch.zeros(vocab_size, d_model)<br>        position = torch.arange(<span class="hljs-number">0</span>, vocab_size, dtype=torch.<span class="hljs-built_in">float</span>).unsqueeze(<span class="hljs-number">1</span>)<br>        div_term = torch.exp(<br>            torch.arange(<span class="hljs-number">0</span>, d_model, <span class="hljs-number">2</span>).<span class="hljs-built_in">float</span>()<br>            * (-math.log(<span class="hljs-number">10000.0</span>) / d_model)<br>        )<br>        pe[:, <span class="hljs-number">0</span>::<span class="hljs-number">2</span>] = torch.sin(position * div_term)<br>        pe[:, <span class="hljs-number">1</span>::<span class="hljs-number">2</span>] = torch.cos(position * div_term)<br>        pe = pe.unsqueeze(<span class="hljs-number">0</span>)<br>        self.register_buffer(<span class="hljs-string">&quot;pe&quot;</span>, pe)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = x + self.pe[:, : x.size(<span class="hljs-number">1</span>), :]<br>        <span class="hljs-keyword">return</span> self.dropout(x)<br><br><br><span class="hljs-comment"># Text classifier based on a pytorch TransformerEncoder.</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextClassifier</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"></span><br><span class="hljs-params">            self,</span><br><span class="hljs-params">            nhead=<span class="hljs-number">8</span>,</span><br><span class="hljs-params">            dim_feedforward=<span class="hljs-number">2048</span>,</span><br><span class="hljs-params">            num_layers=<span class="hljs-number">6</span>,</span><br><span class="hljs-params">            dropout=<span class="hljs-number">0.1</span>,</span><br><span class="hljs-params">            activation=<span class="hljs-string">&quot;relu&quot;</span>,</span><br><span class="hljs-params">            classifier_dropout=<span class="hljs-number">0.1</span></span><br><span class="hljs-params">    </span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br><br>        vocab_size = NUM_WORDS + <span class="hljs-number">2</span><br>        d_model = EMBEDDING_SIZE<br>        <span class="hljs-comment"># vocab_size, d_model = embeddings.size()</span><br>        <span class="hljs-keyword">assert</span> d_model % nhead == <span class="hljs-number">0</span>, <span class="hljs-string">&quot;nheads must divide evenly into d_model&quot;</span><br><br>        <span class="hljs-comment"># Embedding layer definition</span><br>        self.emb = nn.Embedding(vocab_size, d_model, padding_idx=<span class="hljs-number">0</span>)<br><br>        self.pos_encoder = PositionalEncoding(<br>            d_model=d_model,<br>            dropout=dropout,<br>            vocab_size=vocab_size<br>        )<br><br>        encoder_layer = nn.TransformerEncoderLayer(<br>            d_model=d_model,<br>            nhead=nhead,<br>            dim_feedforward=dim_feedforward,<br>            dropout=dropout<br>        )<br>        self.transformer_encoder = nn.TransformerEncoder(<br>            encoder_layer,<br>            num_layers=num_layers<br>        )<br>        self.classifier = nn.Linear(d_model, <span class="hljs-number">5</span>)<br>        self.d_model = d_model<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.emb(x) * math.sqrt(self.d_model)<br>        x = self.pos_encoder(x)<br>        x = self.transformer_encoder(x)<br>        x = x.mean(dim=<span class="hljs-number">1</span>)<br>        x = self.classifier(x)<br><br>        <span class="hljs-keyword">return</span> x<br><br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒEncoderéƒ¨åˆ†çš„ä½ç½®ç¼–ç ï¼ˆPositionalEncodingç±»ï¼‰éœ€è¦è‡ªå·±å®ç°ï¼Œå› ä¸ºPyTorchä¸­æ²¡æœ‰å®ç°ã€‚</p><p>è®¾ç½®æ¨¡å‹å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>æ–‡å­—æ€»æ•°ä¸º5500</li><li>æ–‡æœ¬é•¿åº¦ï¼ˆSENT_LENGTHï¼‰ä¸º200</li><li>è¯å‘é‡ç»´åº¦ï¼ˆEMBEDDING_SIZEï¼‰ä¸º128</li><li>Transformerçš„Encoderå±‚æ•°ï¼ˆnum_layersï¼‰ä¸º1</li><li>å­¦ä¹ ç‡ï¼ˆlearning rateï¼‰ä¸º0.01</li><li>è®­ç»ƒè½®æ•°ï¼ˆepochï¼‰ä¸º10</li><li>æ‰¹é‡å¤§å°ï¼ˆbatch sizeï¼‰ä¸º32</li></ul><p>è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œå¾—åˆ°åœ¨éªŒè¯é›†ä¸Šçš„ç»“æœä¸ºï¼šaccuracy=0.9010, precision=0.9051, recall=0.9010, f1-score=0.9018, æ··æ·†çŸ©é˜µä¸ºï¼š</p><p><img src="/img/pytorch6_2.png" alt="åœ¨éªŒè¯é›†ä¸Šçš„æ··æ·†çŸ©é˜µ"></p><h3 id="å‚æ•°å½±å“">å‚æ•°å½±å“</h3><p>æˆ‘ä»¬è€ƒå¯Ÿæ¨¡å‹å‚æ•°å¯¹æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„è¡¨ç°çš„å½±å“ã€‚</p><ul><li>è€ƒå¯Ÿå¥å­é•¿åº¦å¯¹æ¨¡å‹è¡¨ç°çš„å½±å“</li></ul><p>ä¿æŒå…¶å®ƒå‚æ•°ä¸å˜ï¼Œè®¾ç½®æ–‡æœ¬é•¿åº¦ï¼ˆSENT_LENGTHï¼‰åˆ†åˆ«ä¸º200ï¼Œ256ï¼Œ300ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ–‡æœ¬é•¿åº¦</th><th>accuracy</th><th>precision</th><th>recall</th><th>f1-score</th></tr></thead><tbody><tr><td>200</td><td>0.9010</td><td>0.9051</td><td>0.9010</td><td>0.9018</td></tr><tr><td>256</td><td>0.8990</td><td>0.9019</td><td>0.8990</td><td>0.8977</td></tr><tr><td>300</td><td>0.8788</td><td>0.8824</td><td>0.8788</td><td>0.8774</td></tr></tbody></table><ul><li>è€ƒå¯Ÿè¯å‘é‡ç»´åº¦å¯¹æ¨¡å‹è¡¨ç°çš„å½±å“</li></ul><p>è®¾ç½®æ–‡æœ¬é•¿åº¦ï¼ˆSENT_LENGTHï¼‰ä¸º200ï¼Œä¿æŒå…¶å®ƒå‚æ•°ä¸å˜ï¼Œè®¾ç½®è¯å‘é‡ç»´åº¦ä¸º32, 64ï¼Œ 128ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr><th>è¯å‘é‡ç»´åº¦</th><th>accuracy</th><th>precision</th><th>recall</th><th>f1-score</th></tr></thead><tbody><tr><td>32</td><td>0.6869</td><td>0.7402</td><td>0.6869</td><td>0.6738</td></tr><tr><td>64</td><td>0.7576</td><td>0.7629</td><td>0.7576</td><td>0.7518</td></tr><tr><td>128</td><td>0.9010</td><td>0.9051</td><td>0.9010</td><td>0.9018</td></tr><tr><td>256</td><td>0.9212</td><td>0.9238</td><td>0.9212</td><td>0.9213</td></tr></tbody></table><p>ä»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ–‡æœ¬é•¿åº¦å¯¹æ¨¡å‹è¡¨ç°çš„å½±å“ä¸å¦‚è¯å‘é‡ç»´åº¦å¯¹æ¨¡å‹è¡¨ç°çš„å½±å“å¤§ï¼Œå½“ç„¶ï¼Œè¿™æ˜¯ç›¸å¯¹è€Œè¨€ï¼Œå› ä¸ºæ–‡æœ¬é•¿åº¦ä¸€ç›´ä¿æŒåœ¨200ä»¥ä¸Šï¼Œå¦‚æœæ–‡æœ¬é•¿åº¦ä¸‹é™å¾ˆå¤šçš„è¯ï¼Œæ¨¡å‹è¡¨ç°ä¼šè¿…é€Ÿä¸‹é™ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Transformeræ¨¡å‹è¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»ï¼Œå¹¶è€ƒå¯Ÿäº†å„é‡è¦å‚æ•°å¯¹æ¨¡å‹è¡¨ç°çš„å½±å“ã€‚</p><p>æœ¬é¡¹ç›®å·²ä¸Šä¼ è‡³Githubï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<a href="https://github.com/percent4/pytorch_transformer_chinese_text_classification">https://github.com/percent4/pytorch_transformer_chinese_text_classification</a></p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol><li>Language Modeling with nn.Transformer and TorchText: <a href="https://pytorch.org/tutorials/beginner/transformer_tutorial.html">https://pytorch.org/tutorials/beginner/transformer_tutorial.html</a></li><li>The Annotated Transformer: <a href="http://nlp.seas.harvard.edu/annotated-transformer/">http://nlp.seas.harvard.edu/annotated-transformer/</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorch</tag>
      
      <tag>Transformer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆäº”ï¼‰ä½¿ç”¨CNNæ¨¡å‹è¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8CNN%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8CNN%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•åœ¨PyTorchä¸­ä½¿ç”¨CNNæ¨¡å‹è¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‚</p><p>ä½¿ç”¨CNNå®ç°ä¸­æ–‡æ–‡æœ¬åˆ†ç±»çš„åŸºæœ¬æ€è·¯ï¼š</p><ul><li><p>æ–‡æœ¬é¢„å¤„ç†</p></li><li><p>å°†å­—ï¼ˆæˆ–tokenï¼‰è¿›è¡Œæ±‡æ€»ï¼Œå½¢æˆå­—å…¸æ–‡ä»¶ï¼Œå¯ä¿ç•™å‰nä¸ªå­—</p></li><li><p>æ–‡å­—è½¬æ•°å­—ï¼Œä¸åœ¨å­—å…¸æ–‡ä»¶ä¸­ç”¨<UNK>è¡¨ç¤º</p></li><li><p>å¯¹æ–‡æœ¬è¿›è¡Œé˜¶æ®µä¸å¡«å……ï¼Œå¡«å……ç”¨<PAD>ï¼Œå°†æ–‡æœ¬å‘é‡é•¿åº¦ç»Ÿä¸€</p></li><li><p>å»ºç«‹Embeddingå±‚</p></li><li><p>å»ºç«‹CNNæ¨¡å‹</p></li><li><p>è®­ç»ƒæ¨¡å‹ï¼Œè°ƒæ•´å‚æ•°å¾—åˆ°æœ€ä¼˜è¡¨ç°çš„æ¨¡å‹ï¼Œè·å–æ¨¡å‹è¯„ä¼°æŒ‡æ ‡</p></li><li><p>ä¿å­˜æ¨¡å‹ï¼Œå¹¶åœ¨æ–°æ ·æœ¬ä¸Šè¿›è¡Œé¢„æµ‹</p><p>æˆ‘ä»¬ä»¥æœç‹—å°åˆ†ç±»æ•°æ®é›†ä¸ºä¾‹ï¼Œä½¿ç”¨CNNæ¨¡å‹å¯¹å…¶è¿›è¡Œæ–‡æœ¬åˆ†ç±»ã€‚</p></li></ul><h3 id="æ•°æ®é›†ä»‹ç»">æ•°æ®é›†ä»‹ç»</h3><p>æœç‹—å°åˆ†ç±»æ•°æ®é›†ï¼Œå…±æœ‰5ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«ä¸ºä½“è‚²ã€å¥åº·ã€å†›äº‹ã€æ•™è‚²ã€æ±½è½¦ã€‚åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå…¶ä¸­è®­ç»ƒé›†æ¯ä¸ªç±»åˆ«800æ¡æ ·æœ¬ï¼Œæµ‹è¯•é›†æ¯ä¸ªç±»åˆ«100æ¡æ ·æœ¬ã€‚</p><h3 id="æ–‡æœ¬é¢„å¤„ç†">æ–‡æœ¬é¢„å¤„ç†</h3><p>è¯»å–è®­ç»ƒé›†ä¸­çš„æ–‡æœ¬æ•°æ®ï¼Œå½¢æˆæ–‡å­—åˆ—è¡¨ï¼Œæ‰“ä¹±é¡ºåºï¼Œä¿ç•™å‰Nä¸ªæ–‡å­—ï¼Œå½¢æˆPickleæ–‡ä»¶ï¼Œå¹¶ä¿å­˜ç±»åˆ«åˆ—è¡¨è‡³Pickleæ–‡ä»¶ï¼Œä¾¿äºåç»­å¤„ç†ï¼ŒPythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @Time : 2023/3/16 10:32</span><br><span class="hljs-comment"># @Author : Jclian91</span><br><span class="hljs-comment"># @File : preprocessing.py</span><br><span class="hljs-comment"># @Place : Minghang, Shanghai</span><br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> shuffle<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter, defaultdict<br><br><span class="hljs-keyword">from</span> params <span class="hljs-keyword">import</span> TRAIN_FILE_PATH, NUM_WORDS<br><span class="hljs-keyword">from</span> pickle_file_operaor <span class="hljs-keyword">import</span> PickleFileOperator<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FilePreprossing</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n</span>):<br>        <span class="hljs-comment"># ä¿ç•™å‰nä¸ªå­—</span><br>        self.__n = n<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_read_train_file</span>(<span class="hljs-params">self</span>):<br>        train_pd = pd.read_csv(TRAIN_FILE_PATH)<br>        label_list = train_pd[<span class="hljs-string">&#x27;label&#x27;</span>].unique().tolist()<br>        <span class="hljs-comment"># ç»Ÿè®¡æ–‡å­—é¢‘æ•°</span><br>        character_dict = defaultdict(<span class="hljs-built_in">int</span>)<br>        <span class="hljs-keyword">for</span> content <span class="hljs-keyword">in</span> train_pd[<span class="hljs-string">&#x27;content&#x27;</span>]:<br>            <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> Counter(content).items():<br>                character_dict[key] += value<br>        <span class="hljs-comment"># ä¸æ’åº</span><br>        sort_char_list = [(k, v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> character_dict.items()]<br>        shuffle(sort_char_list)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;total <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(character_dict)&#125;</span> characters.&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;top 10 chars: &#x27;</span>, sort_char_list[:<span class="hljs-number">10</span>])<br>        <span class="hljs-comment"># ä¿ç•™å‰nä¸ªæ–‡å­—</span><br>        top_n_chars = [_[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> sort_char_list[:self.__n]]<br><br>        <span class="hljs-keyword">return</span> label_list, top_n_chars<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        label_list, top_n_chars = self._read_train_file()<br>        PickleFileOperator(data=label_list, file_path=<span class="hljs-string">&#x27;labels.pk&#x27;</span>).save()<br>        PickleFileOperator(data=top_n_chars, file_path=<span class="hljs-string">&#x27;chars.pk&#x27;</span>).save()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    processor = FilePreprossing(NUM_WORDS)<br>    processor.run()<br>    <span class="hljs-comment"># è¯»å–pickleæ–‡ä»¶</span><br>    labels = PickleFileOperator(file_path=<span class="hljs-string">&#x27;labels.pk&#x27;</span>).read()<br>    <span class="hljs-built_in">print</span>(labels)<br>    content = PickleFileOperator(file_path=<span class="hljs-string">&#x27;chars.pk&#x27;</span>).read()<br>    <span class="hljs-built_in">print</span>(content)<br><br></code></pre></td></tr></table></figure><p>æ–‡å­—è½¬æ•°å­—ï¼Œä¸åœ¨å­—å…¸æ–‡ä»¶ä¸­ç”¨UNKè¡¨ç¤ºã€‚å¯¹æ–‡æœ¬è¿›è¡Œé˜¶æ®µä¸å¡«å……ï¼Œå¡«å……ç”¨PADï¼Œå°†æ–‡æœ¬å‘é‡é•¿åº¦ç»Ÿä¸€ã€‚Pythonå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @Time : 2023/3/16 11:15</span><br><span class="hljs-comment"># @Author : Jclian91</span><br><span class="hljs-comment"># @File : text_featuring.py</span><br><span class="hljs-comment"># @Place : Minghang, Shanghai</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> torch <span class="hljs-keyword">as</span> T<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, DataLoader, random_split<br><br><span class="hljs-keyword">from</span> params <span class="hljs-keyword">import</span> (PAD_NO,<br>                    UNK_NO,<br>                    START_NO,<br>                    SENT_LENGTH,<br>                    TEST_FILE_PATH,<br>                    TRAIN_FILE_PATH)<br><span class="hljs-keyword">from</span> pickle_file_operaor <span class="hljs-keyword">import</span> PickleFileOperator<br><br><br><span class="hljs-comment"># load csv file</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_csv_file</span>(<span class="hljs-params">file_path</span>):<br>    df = pd.read_csv(file_path)<br>    samples, y_true = [], []<br>    <span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> df.iterrows():<br>        y_true.append(row[<span class="hljs-string">&#x27;label&#x27;</span>])<br>        samples.append(row[<span class="hljs-string">&#x27;content&#x27;</span>])<br>    <span class="hljs-keyword">return</span> samples, y_true<br><br><br><span class="hljs-comment"># è¯»å–pickleæ–‡ä»¶</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_file_file</span>():<br>    labels = PickleFileOperator(file_path=<span class="hljs-string">&#x27;labels.pk&#x27;</span>).read()<br>    chars = PickleFileOperator(file_path=<span class="hljs-string">&#x27;chars.pk&#x27;</span>).read()<br>    label_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(labels, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(labels))))<br>    char_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(chars, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(chars))))<br>    <span class="hljs-keyword">return</span> label_dict, char_dict<br><br><br><span class="hljs-comment"># æ–‡æœ¬é¢„å¤„ç†</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">text_feature</span>(<span class="hljs-params">labels, contents, label_dict, char_dict</span>):<br>    samples, y_true = [], []<br>    <span class="hljs-keyword">for</span> s_label, s_content <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(labels, contents):<br>        <span class="hljs-comment"># one_hot_vector = [0] * len(label_dict)</span><br>        <span class="hljs-comment"># one_hot_vector[label_dict[s_label]] = 1</span><br>        <span class="hljs-comment"># y_true.append([one_hot_vector])</span><br>        y_true.append(label_dict[s_label])<br>        train_sample = []<br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> s_content:<br>            <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> char_dict:<br>                train_sample.append(START_NO + char_dict[char])<br>            <span class="hljs-keyword">else</span>:<br>                train_sample.append(UNK_NO)<br>        <span class="hljs-comment"># è¡¥å……æˆ–æˆªæ–­</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(train_sample) &lt; SENT_LENGTH:<br>            samples.append(train_sample + [PAD_NO] * (SENT_LENGTH - <span class="hljs-built_in">len</span>(train_sample)))<br>        <span class="hljs-keyword">else</span>:<br>            samples.append(train_sample[:SENT_LENGTH])<br><br>    <span class="hljs-keyword">return</span> samples, y_true<br><br><br><span class="hljs-comment"># dataset</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CSVDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, file_path</span>):<br>        label_dict, char_dict = load_file_file()<br>        samples, y_true = load_csv_file(file_path)<br>        x, y = text_feature(y_true, samples, label_dict, char_dict)<br>        self.X = T.from_numpy(np.array(x)).long()<br>        self.y = T.from_numpy(np.array(y))<br><br>    <span class="hljs-comment"># number of rows in the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.X)<br><br>    <span class="hljs-comment"># get a row at an index</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):<br>        <span class="hljs-keyword">return</span> [self.X[idx], self.y[idx]]<br><br>    <span class="hljs-comment"># get indexes for train and test rows</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_splits</span>(<span class="hljs-params">self, n_test=<span class="hljs-number">0.3</span></span>):<br>        <span class="hljs-comment"># determine sizes</span><br>        test_size = <span class="hljs-built_in">round</span>(n_test * <span class="hljs-built_in">len</span>(self.X))<br>        train_size = <span class="hljs-built_in">len</span>(self.X) - test_size<br>        <span class="hljs-comment"># calculate the split</span><br>        <span class="hljs-keyword">return</span> random_split(self, [train_size, test_size])<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    p = CSVDataset().__getitem__(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(p)<br><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹é¢çš„æ–‡æœ¬ä¸ºä¾‹ï¼Œå°†å…¶è½¬åŒ–ä¸ºå‘é‡ï¼ˆå‡è®¾æœ€å¤§é•¿åº¦ä¸º40ï¼‰åçš„ç»“æœä¸ºï¼š</p><blockquote><p>ç›–ä¸–æ±½è½¦è®¯ï¼Œç‰¹æ–¯æ‹‰å»å¹´å‡»è´¥äº†å®é©¬ï¼Œå¤ºå¾—äº†ç¾å›½è±ªåæ±½è½¦å¸‚åœºçš„æ¡‚</p></blockquote><blockquote><p>[3899, 4131, 2497, 496, 3746, 221, 3273, 1986, 4002, 4882, 3238, 5114, 1516, 353, 4767, 2357, 221, 2920, 387, 353, 4434, 4930, 4079, 4187, 2497, 496, 883, 1325, 1061, 3901, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</p></blockquote><h3 id="åˆ›å»ºæ¨¡å‹">åˆ›å»ºæ¨¡å‹</h3><p>åˆ›å»ºæ¨¡å‹ï¼šå»ºç«‹Embeddingå±‚ï¼Œå»ºç«‹CNNæ¨¡å‹ï¼Œæ¨¡å‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/pytorch5_1.png" alt=""></p><p>Pythonå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><br><span class="hljs-keyword">from</span> params <span class="hljs-keyword">import</span> NUM_WORDS, SENT_LENGTH, EMBEDDING_SIZE<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextClassifier</span>(nn.ModuleList):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(TextClassifier, self).__init__()<br>        <span class="hljs-comment"># Parameters regarding text preprocessing</span><br>        self.seq_len = SENT_LENGTH<br>        self.num_words = NUM_WORDS<br>        self.embedding_size = EMBEDDING_SIZE<br><br>        <span class="hljs-comment"># Dropout definition</span><br>        self.dropout = nn.Dropout(<span class="hljs-number">0.25</span>)<br><br>        <span class="hljs-comment"># CNN parameters definition</span><br>        <span class="hljs-comment"># Kernel sizes</span><br>        self.kernel_1 = <span class="hljs-number">2</span><br>        self.kernel_2 = <span class="hljs-number">3</span><br>        self.kernel_3 = <span class="hljs-number">4</span><br>        self.kernel_4 = <span class="hljs-number">5</span><br><br>        <span class="hljs-comment"># Output size for each convolution</span><br>        self.out_size = <span class="hljs-number">32</span><br>        <span class="hljs-comment"># Number of strides for each convolution</span><br>        self.stride = <span class="hljs-number">2</span><br><br>        <span class="hljs-comment"># Embedding layer definition</span><br>        self.embedding = nn.Embedding(self.num_words + <span class="hljs-number">2</span>, self.embedding_size)<br><br>        <span class="hljs-comment"># Convolution layers definition</span><br>        self.conv_1 = nn.Conv1d(self.seq_len, self.out_size, self.kernel_1, self.stride)<br>        self.conv_2 = nn.Conv1d(self.seq_len, self.out_size, self.kernel_2, self.stride)<br>        self.conv_3 = nn.Conv1d(self.seq_len, self.out_size, self.kernel_3, self.stride)<br>        self.conv_4 = nn.Conv1d(self.seq_len, self.out_size, self.kernel_4, self.stride)<br><br>        <span class="hljs-comment"># Max pooling layers definition</span><br>        self.pool_1 = nn.MaxPool1d(self.kernel_1, self.stride)<br>        self.pool_2 = nn.MaxPool1d(self.kernel_2, self.stride)<br>        self.pool_3 = nn.MaxPool1d(self.kernel_3, self.stride)<br>        self.pool_4 = nn.MaxPool1d(self.kernel_4, self.stride)<br><br>        <span class="hljs-comment"># Fully connected layer definition</span><br>        self.fc = nn.Linear(self.in_features_fc(), <span class="hljs-number">5</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">in_features_fc</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Calculates the number of output features after Convolution + Max pooling</span><br><span class="hljs-string">        Convolved_Features = ((embedding_size + (2 * padding) - dilation * (kernel - 1) - 1) / stride) + 1</span><br><span class="hljs-string">        Pooled_Features = ((embedding_size + (2 * padding) - dilation * (kernel - 1) - 1) / stride) + 1</span><br><span class="hljs-string">        source: https://pytorch.org/docs/stable/generated/torch.nn.Conv1d.html</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br><br>        <span class="hljs-comment"># Calcualte size of convolved/pooled features for convolution_1/max_pooling_1 features</span><br>        out_conv_1 = ((self.embedding_size - <span class="hljs-number">1</span> * (self.kernel_1 - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / self.stride) + <span class="hljs-number">1</span><br>        out_conv_1 = math.floor(out_conv_1)<br>        out_pool_1 = ((out_conv_1 - <span class="hljs-number">1</span> * (self.kernel_1 - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / self.stride) + <span class="hljs-number">1</span><br>        out_pool_1 = math.floor(out_pool_1)<br><br>        <span class="hljs-comment"># Calcualte size of convolved/pooled features for convolution_2/max_pooling_2 features</span><br>        out_conv_2 = ((self.embedding_size - <span class="hljs-number">1</span> * (self.kernel_2 - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / self.stride) + <span class="hljs-number">1</span><br>        out_conv_2 = math.floor(out_conv_2)<br>        out_pool_2 = ((out_conv_2 - <span class="hljs-number">1</span> * (self.kernel_2 - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / self.stride) + <span class="hljs-number">1</span><br>        out_pool_2 = math.floor(out_pool_2)<br><br>        <span class="hljs-comment"># Calcualte size of convolved/pooled features for convolution_3/max_pooling_3 features</span><br>        out_conv_3 = ((self.embedding_size - <span class="hljs-number">1</span> * (self.kernel_3 - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / self.stride) + <span class="hljs-number">1</span><br>        out_conv_3 = math.floor(out_conv_3)<br>        out_pool_3 = ((out_conv_3 - <span class="hljs-number">1</span> * (self.kernel_3 - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / self.stride) + <span class="hljs-number">1</span><br>        out_pool_3 = math.floor(out_pool_3)<br><br>        <span class="hljs-comment"># Calculate size of convolved/pooled features for convolution_4/max_pooling_4 features</span><br>        out_conv_4 = ((self.embedding_size - <span class="hljs-number">1</span> * (self.kernel_4 - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / self.stride) + <span class="hljs-number">1</span><br>        out_conv_4 = math.floor(out_conv_4)<br>        out_pool_4 = ((out_conv_4 - <span class="hljs-number">1</span> * (self.kernel_4 - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / self.stride) + <span class="hljs-number">1</span><br>        out_pool_4 = math.floor(out_pool_4)<br><br>        <span class="hljs-comment"># Returns &quot;flattened&quot; vector (input for fully connected layer)</span><br>        <span class="hljs-keyword">return</span> (out_pool_1 + out_pool_2 + out_pool_3 + out_pool_4) * self.out_size<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-comment"># Sequence of tokes is filterd through an embedding layer</span><br>        x = self.embedding(x)<br><br>        <span class="hljs-comment"># Convolution layer 1 is applied</span><br>        x1 = self.conv_1(x)<br>        x1 = torch.relu(x1)<br>        x1 = self.pool_1(x1)<br><br>        <span class="hljs-comment"># Convolution layer 2 is applied</span><br>        x2 = self.conv_2(x)<br>        x2 = torch.relu((x2))<br>        x2 = self.pool_2(x2)<br><br>        <span class="hljs-comment"># Convolution layer 3 is applied</span><br>        x3 = self.conv_3(x)<br>        x3 = torch.relu(x3)<br>        x3 = self.pool_3(x3)<br><br>        <span class="hljs-comment"># Convolution layer 4 is applied</span><br>        x4 = self.conv_4(x)<br>        x4 = torch.relu(x4)<br>        x4 = self.pool_4(x4)<br><br>        <span class="hljs-comment"># The output of each convolutional layer is concatenated into a unique vector</span><br>        union = torch.cat((x1, x2, x3, x4), <span class="hljs-number">2</span>)<br>        union = union.reshape(union.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># The &quot;flattened&quot; vector is passed through a fully connected layer</span><br>        out = self.fc(union)<br>        <span class="hljs-comment"># Dropout is applied</span><br>        out = self.dropout(out)<br>        <span class="hljs-comment"># Activation function is applied</span><br>        <span class="hljs-comment"># out = nn.Softmax(dim=1)(out)</span><br><br>        <span class="hljs-keyword">return</span> out<br><br></code></pre></td></tr></table></figure><p>è®­ç»ƒæ¨¡å‹ï¼Œè°ƒæ•´å‚æ•°å¾—åˆ°æœ€ä¼˜è¡¨ç°çš„æ¨¡å‹ï¼Œè·å–æ¨¡å‹è¯„ä¼°æŒ‡æ ‡ï¼ŒPythonå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> RMSprop, Adam<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> CrossEntropyLoss, Softmax<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> vstack, argmax<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> TextClassifier<br><span class="hljs-keyword">from</span> text_featuring <span class="hljs-keyword">import</span> CSVDataset<br><span class="hljs-keyword">from</span> params <span class="hljs-keyword">import</span> TRAIN_BATCH_SIZE, TEST_BATCH_SIZE, LEARNING_RATE, EPOCHS, TRAIN_FILE_PATH, TEST_FILE_PATH<br><br><br><span class="hljs-comment"># model train</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelTrainer</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-comment"># evaluate the model</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_model</span>(<span class="hljs-params">test_dl, model</span>):<br>        predictions, actuals = [], []<br>        <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_dl):<br>            <span class="hljs-comment"># evaluate the model on the test set</span><br>            yhat = model(inputs)<br>            <span class="hljs-comment"># retrieve numpy array</span><br>            yhat = yhat.detach().numpy()<br>            actual = targets.numpy()<br>            <span class="hljs-comment"># convert to class labels</span><br>            yhat = argmax(yhat, axis=<span class="hljs-number">1</span>)<br>            <span class="hljs-comment"># reshape for stacking</span><br>            actual = actual.reshape((<span class="hljs-built_in">len</span>(actual), <span class="hljs-number">1</span>))<br>            yhat = yhat.reshape((<span class="hljs-built_in">len</span>(yhat), <span class="hljs-number">1</span>))<br>            <span class="hljs-comment"># store</span><br>            predictions.append(yhat)<br>            actuals.append(actual)<br>        predictions, actuals = vstack(predictions), vstack(actuals)<br>        <span class="hljs-comment"># calculate accuracy</span><br>        acc = accuracy_score(actuals, predictions)<br>        <span class="hljs-keyword">return</span> acc<br><br>    <span class="hljs-comment"># Model Training, evaluation and metrics calculation</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>(<span class="hljs-params">self, model</span>):<br>        <span class="hljs-comment"># calculate split</span><br>        train = CSVDataset(TRAIN_FILE_PATH)<br>        test = CSVDataset(TEST_FILE_PATH)<br>        <span class="hljs-comment"># prepare data loaders</span><br>        train_dl = DataLoader(train, batch_size=TRAIN_BATCH_SIZE, shuffle=<span class="hljs-literal">True</span>)<br>        test_dl = DataLoader(test, batch_size=TEST_BATCH_SIZE)<br><br>        <span class="hljs-comment"># Define optimizer</span><br>        optimizer = Adam(model.parameters(), lr=LEARNING_RATE)<br>        <span class="hljs-comment"># Starts training phase</span><br>        <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(EPOCHS):<br>            <span class="hljs-comment"># Starts batch training</span><br>            <span class="hljs-keyword">for</span> x_batch, y_batch <span class="hljs-keyword">in</span> train_dl:<br>                y_batch = y_batch.long()<br>                <span class="hljs-comment"># Clean gradients</span><br>                optimizer.zero_grad()<br>                <span class="hljs-comment"># Feed the model</span><br>                y_pred = model(x_batch)<br>                <span class="hljs-comment"># Loss calculation</span><br>                loss = CrossEntropyLoss()(y_pred, y_batch)<br>                <span class="hljs-comment"># Gradients calculation</span><br>                loss.backward()<br>                <span class="hljs-comment"># Gradients update</span><br>                optimizer.step()<br><br>            <span class="hljs-comment"># Evaluation</span><br>            test_accuracy = self.evaluate_model(test_dl, model)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Epoch: %d, loss: %.5f, Test accuracy: %.5f&quot;</span> % (epoch+<span class="hljs-number">1</span>, loss.item(), test_accuracy))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    model = TextClassifier()<br>    <span class="hljs-comment"># ç»Ÿè®¡å‚æ•°é‡</span><br>    num_params = <span class="hljs-built_in">sum</span>(param.numel() <span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> model.parameters())<br>    <span class="hljs-built_in">print</span>(num_params)<br>    ModelTrainer().train(model)<br>    torch.save(model, <span class="hljs-string">&#x27;sougou_mini_cls.pth&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>å¯¹ä¿å­˜å¥½çš„æ¨¡å‹ï¼Œåœ¨éªŒè¯é›†ä¸Šè¿›è¡ŒæŒ‡æ ‡è¯„ä¼°ï¼Œå¾—åˆ°çš„ç»“æœï¼šaccuracyä¸º0.7960ï¼Œprecisionï¼Œrecallä¸º0.7960ï¼ŒF1-scoreä¸º0.7953ï¼Œæ··æ·†çŸ©é˜µå¦‚ä¸‹ï¼š</p><p><img src="/img/pytorch5_2.png" alt="åœ¨éªŒè¯é›†ä¸Šçš„æ··æ·†çŸ©é˜µ"></p><p>å¯¹æ–°æ ·æœ¬è¿›è¡Œé¢„æµ‹ï¼ŒPythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @Time : 2023/3/16 16:42</span><br><span class="hljs-comment"># @Author : Jclian91</span><br><span class="hljs-comment"># @File : model_predict.py</span><br><span class="hljs-comment"># @Place : Minghang, Shanghai</span><br><span class="hljs-keyword">import</span> torch <span class="hljs-keyword">as</span> T<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">from</span> text_featuring <span class="hljs-keyword">import</span> load_file_file, text_feature<br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> TextClassifier<br><br>model = T.load(<span class="hljs-string">&#x27;sougou_mini_cls.pth&#x27;</span>)<br><br>label_dict, char_dict = load_file_file()<br><span class="hljs-built_in">print</span>(label_dict)<br><br>text = <span class="hljs-string">&#x27;ç›–ä¸–æ±½è½¦è®¯ï¼Œç‰¹æ–¯æ‹‰å»å¹´å‡»è´¥äº†å®é©¬ï¼Œå¤ºå¾—äº†ç¾å›½è±ªåæ±½è½¦å¸‚åœºçš„æ¡‚å† ï¼Œå¹¶åœ¨ä»Šå¹´å®ç°äº†å¼€é—¨çº¢ã€‚1æœˆä»½ï¼Œå¾—ç›Šäºå¤§å¹…é™ä»·å’Œ7500ç¾å…ƒç¾å›½ç”µåŠ¨æ±½è½¦ç¨æ”¶æŠµå…ï¼Œç‰¹æ–¯æ‹‰å†åº¦å‡»è´¥å®é©¬ï¼Œè‰è”äº†ç¾å›½è±ªåè½¦é”€å† ï¼Œå¹¶ä¸”æ³¨å†Œé‡è¶…è¿‡äº†æ’åç¬¬ä¸‰çš„æ¢…èµ›å¾·æ–¯-å¥”é©°å’Œæ’åç¬¬å››çš„é›·å…‹è¨æ–¯çš„æ€»å’Œã€‚æ ¹æ®Experiançš„æ•°æ®ï¼Œåœ¨æ‰€æœ‰è±ªåå“ç‰Œä¸­ï¼Œ1æœˆä»½ï¼Œç‰¹æ–¯æ‹‰åœ¨ç¾å›½çš„è±ªåè½¦æ³¨å†Œé‡ä¸º49ï¼Œ917è¾†ï¼ŒåŒæ¯”å¢é•¿34%ï¼›å®é©¬çš„æ³¨å†Œé‡ä¸º31ï¼Œ070è¾†ï¼ŒåŒæ¯”å¢é•¿2.5%ï¼›å¥”é©°çš„æ³¨å†Œé‡ä¸º23ï¼Œ345è¾†ï¼ŒåŒæ¯”å¢é•¿7.3%ï¼›é›·å…‹è¨æ–¯çš„æ³¨å†Œé‡ä¸º23ï¼Œ082è¾†ï¼ŒåŒæ¯”ä¸‹é™6.6%ã€‚å¥¥è¿ªä»¥19ï¼Œ113è¾†çš„æ³¨å†Œé‡æ’åç¬¬äº”ï¼ŒåŒæ¯”å¢é•¿38%ã€‚å‡¯è¿ªæ‹‰å…‹æ³¨å†Œé‡ä¸º13ï¼Œ220è¾†ï¼Œè¾ƒå»å¹´åŒæœŸå¢é•¿36%ï¼Œæ’åç¬¬å…­ã€‚æ’åç¬¬ä¸ƒçš„è®´æ­Œçš„æ³¨å†Œé‡ä¸º10ï¼Œ833è¾†ï¼ŒåŒæ¯”å¢é•¿32%ã€‚æ²ƒå°”æ²ƒæ±½è½¦æ’åç¬¬å…«ï¼Œæ³¨å†Œé‡ä¸º8ï¼Œ864è¾†ï¼ŒåŒæ¯”å¢é•¿1.8%ã€‚è·¯è™ä»¥7ï¼Œ003è¾†çš„æ³¨å†Œé‡æ’åç¬¬ä¹ï¼Œæ—è‚¯ä»¥6ï¼Œ964è¾†çš„æ³¨å†Œé‡æ’åç¬¬åã€‚&#x27;</span><br><br>label, sample = [<span class="hljs-string">&#x27;æ±½è½¦&#x27;</span>], [text]<br>samples, y_true = text_feature(label, sample, label_dict, char_dict)<br><span class="hljs-built_in">print</span>(text)<br><span class="hljs-built_in">print</span>(samples, y_true)<br>x = T.from_numpy(np.array(samples)).long()<br>y_pred = model(x)<br><span class="hljs-built_in">print</span>(y_pred)<br><br></code></pre></td></tr></table></figure><p>é¢„æµ‹ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ–°æ–‡æœ¬</th><th>é¢„æµ‹ç±»åˆ«</th></tr></thead><tbody><tr><td>ç›–ä¸–æ±½è½¦è®¯ï¼Œç‰¹æ–¯æ‹‰å»å¹´å‡»è´¥äº†å®é©¬ï¼Œå¤ºå¾—äº†ç¾å›½è±ªåæ±½è½¦å¸‚åœºçš„æ¡‚å† ï¼Œå¹¶åœ¨ä»Šå¹´å®ç°äº†å¼€é—¨çº¢ã€‚1æœˆä»½ï¼Œå¾—ç›Šäºå¤§å¹…é™ä»·å’Œ7500ç¾å…ƒç¾å›½ç”µåŠ¨æ±½è½¦ç¨æ”¶æŠµå…ï¼Œç‰¹æ–¯æ‹‰å†åº¦å‡»è´¥å®é©¬ï¼Œè‰è”äº†ç¾å›½è±ªåè½¦é”€å† ï¼Œå¹¶ä¸”æ³¨å†Œé‡è¶…è¿‡äº†æ’åç¬¬ä¸‰çš„æ¢…èµ›å¾·æ–¯-å¥”é©°å’Œæ’åç¬¬å››çš„é›·å…‹è¨æ–¯çš„æ€»å’Œã€‚æ ¹æ®Experiançš„æ•°æ®ï¼Œåœ¨æ‰€æœ‰è±ªåå“ç‰Œä¸­ï¼Œ1æœˆä»½ï¼Œç‰¹æ–¯æ‹‰åœ¨ç¾å›½çš„è±ªåè½¦æ³¨å†Œé‡ä¸º49ï¼Œ917è¾†ï¼ŒåŒæ¯”å¢é•¿34%ï¼›å®é©¬çš„æ³¨å†Œé‡ä¸º31ï¼Œ070è¾†ï¼ŒåŒæ¯”å¢é•¿2.5%ï¼›å¥”é©°çš„æ³¨å†Œé‡ä¸º23ï¼Œ345è¾†ï¼ŒåŒæ¯”å¢é•¿7.3%ï¼›é›·å…‹è¨æ–¯çš„æ³¨å†Œé‡ä¸º23ï¼Œ082è¾†ï¼ŒåŒæ¯”ä¸‹é™6.6%ã€‚å¥¥è¿ªä»¥19ï¼Œ113è¾†çš„æ³¨å†Œé‡æ’åç¬¬äº”ï¼ŒåŒæ¯”å¢é•¿38%ã€‚å‡¯è¿ªæ‹‰å…‹æ³¨å†Œé‡ä¸º13ï¼Œ220è¾†ï¼Œè¾ƒå»å¹´åŒæœŸå¢é•¿36%ï¼Œæ’åç¬¬å…­ã€‚æ’åç¬¬ä¸ƒçš„è®´æ­Œçš„æ³¨å†Œé‡ä¸º10ï¼Œ833è¾†ï¼ŒåŒæ¯”å¢é•¿32%ã€‚æ²ƒå°”æ²ƒæ±½è½¦æ’åç¬¬å…«ï¼Œæ³¨å†Œé‡ä¸º8ï¼Œ864è¾†ï¼ŒåŒæ¯”å¢é•¿1.8%ã€‚è·¯è™ä»¥7ï¼Œ003è¾†çš„æ³¨å†Œé‡æ’åç¬¬ä¹ï¼Œæ—è‚¯ä»¥6ï¼Œ964è¾†çš„æ³¨å†Œé‡æ’åç¬¬åã€‚</td><td>æ±½è½¦</td></tr><tr><td>åŒ—äº¬æ—¶é—´3æœˆ16æ—¥ï¼ŒNBAå®˜æ–¹å…¬å¸ƒäº†å¯¹äºç°ç†Šçƒæ˜Ÿè´¾-è«å…°ç‰¹ç›´æ’­ä¸­æŒæªäº‹ä»¶çš„è°ƒæŸ¥ç»“æœç°ç†Šï¼Œç”±äºæ— æ³•ç¡®å®šæªæ”¯æ˜¯å¦ä¸ºè«å…°ç‰¹æ‰€æœ‰ï¼Œä¹Ÿæ— æ³•è¯æ˜ä»–æ›¾æŒæªåˆ°è¿‡NBAåœºé¦†ï¼Œå› ä¸ºå¯¹ä»–å¤„ä»¥ç¦èµ›å…«åœºçš„å¤„ç½šï¼Œä¸”æ­¤å‰å·²ç¦èµ›åœºæ¬¡å°†ç®—åœ¨ç¦èµ›å…«åœºçš„åœºæ¬¡å†…ï¼Œä»–æœ€æ—©å°†åœ¨ä¸‹å‘¨å¤å‡ºã€‚</td><td>ä½“è‚²</td></tr><tr><td>3æœˆ11æ—¥ï¼Œç”±æ–°æµªæ•™è‚²ã€å¾®åšæ•™è‚²ã€æ‹©æ ¡è¡Œè”åˆä¸»åŠçš„â€œæ–°æµª&amp;å¾®åš2023å›½é™…æ•™è‚²æ˜¥å­£å·¡å±•â€¢æ·±åœ³ç«™â€äºæ·±åœ³å‡¯å®¾æ–¯åŸºé…’åº—æˆåŠŸä¸¾åŠã€‚æ·±åœ³ä¼˜è´¨å­¦æ ¡äº®ç›¸å±•ä¼šï¼Œä¸Šåƒç»„å®¶åº­å‰æ¥é€›å±•ã€‚è¿‘30æ‰€å…¨å›½åŠæ·±åœ³æ°‘åŠå›½é™…åŒ–å­¦æ ¡ã€å¤–ç±äººå‘˜å­å¥³å­¦æ ¡ã€å…¬åŠå­¦æ ¡å›½é™…éƒ¨ç­‰å¤šå…ƒåŒ–ã€å¤šç±»å‹ä¼˜è´¨å­¦æ ¡å‚ä¸äº†æœ¬æ¬¡æ´»åŠ¨ã€‚æ­¤å¤–ï¼Œè¿‘10ä½å›½é™…åŒ–å­¦æ ¡æ ¡é•¿åˆ†äº«äº†å­¦æ ¡çš„åŠå­¦ç‰¹è‰²ã€æ•™è‚²ç†å¿µåŠå­¦ç”Ÿçš„æˆé•¿æ¡ˆä¾‹ï¼Œå‚å±•å®¶åº­çº·çº·è¡¨ç¤ºå—ç›ŠåŒªæµ…ã€‚å±•ä¼šæ­å»ºå®¶æ ¡æ²Ÿé€šæ¡¥æ¢ï¼Œå¸®åŠ©å®¶é•¿ä»¬åˆç†è§„åˆ’å­©å­çš„å›½é™…æ•™è‚²ä¹‹è·¯ã€‚æ·±åœ³å›½é™…é¢„ç§‘ä¹¦é™¢/æ‹›ç”ŸåŠä¸»ä»»æ²ˆå…°Nancy Shenå‚åŠ äº†æœ¬æ¬¡æ´»åŠ¨å¹¶å¸¦æ¥äº†ç²¾å½©çš„æ¼”è®²ï¼Œä»¥ä¸‹ä¸ºæ¼”è®²å®å½•ï¼š&quot;</td><td>æ•™è‚²</td></tr><tr><td>æŒ‡å¯¼ä¸“å®¶ï¼šçš®è‚¤ç§‘æ•™ç ”å®¤å‰¯ä¸»ä»»ã€æ­¦æ±‰åå’ŒåŒ»é™¢çš®è‚¤æ€§ç—…ç§‘ä¸»ä»»åŒ»å¸ˆå†¯çˆ±å¹³æ•™æˆåœ¨ä¸´åºŠä¸Šï¼Œç»å¸¸èƒ½çœ‹åˆ°æœ‰äº›äººå‡ºç°åå¤å‘ä½œçš„å£è…”æºƒç–¡ï¼Œå››å­£ä¸æ–­ï¼Œæ·±å—å…¶æ‰°ã€‚å…¶å®è¿™å·²ä¸å•å•æ˜¯å£è…”é—®é¢˜ï¼Œè€Œæ˜¯å…¨èº«ç–¾ç—…çš„ä½“ç°ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›å…ç–«ç³»ç»Ÿç–¾ç—…ï¼Œä¸ä»…è¡¨ç°åœ¨çš®è‚¤è¿˜ä¼šæŸå®³é»è†œï¼Œä¸‹åˆ—å‡ ç§æƒ…å†µæ˜¯é€ æˆâ€œå¤å‘æ€§å£è…”æºƒç–¡â€çš„åŸå› ã€‚ç¼ºä¹ç»´ç”Ÿç´ åŠå¾®é‡å…ƒç´ ã€‚ç¼ºä¹å¾®é‡å…ƒç´ é”Œã€é“ã€å¶é…¸ã€ç»´ç”Ÿç´ B12ç­‰æ—¶ï¼Œä¼šå¼•å‘å£è§’ç‚ã€‚å¾ˆå¤šæ—¥å¸¸ç”Ÿæ´»è¡Œä¸ºå¯èƒ½é€ æˆç»´ç”Ÿç´ çš„ç¼ºä¹ï¼Œå¦‚è¿‡åˆ†æ·˜æ´—ç±³ã€é•¿æœŸè¿›é£Ÿç²¾ç±³é¢ã€åƒç´ é£Ÿç­‰ï¼Œå¾ˆå®¹æ˜“é€ æˆBæ—ç»´ç”Ÿç´ çš„ç¼ºå¤±ã€‚</td><td>å¥åº·</td></tr></tbody></table><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®å·²ä¸Šä¼ è‡³Githubï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<a href="https://github.com/percent4/PyTorch_Learning/tree/master/cnn_text_classification">https://github.com/percent4/PyTorch_Learning/tree/master/cnn_text_classification</a></p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol><li>Text-Classification-CNN-PyTorch: <a href="https://github.com/FernandoLpz/Text-Classification-CNN-PyTorch">https://github.com/FernandoLpz/Text-Classification-CNN-PyTorch</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CNN</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
      <tag>PyTorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆå››ï¼‰ä¼˜åŒ–å™¨æ¯”è¾ƒ</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BC%98%E5%8C%96%E5%99%A8%E6%AF%94%E8%BE%83/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BC%98%E5%8C%96%E5%99%A8%E6%AF%94%E8%BE%83/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä¼˜åŒ–å™¨å°±æ˜¯åœ¨æ·±åº¦å­¦ä¹ åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼ŒæŒ‡å¼•æŸå¤±å‡½æ•°çš„å„ä¸ªå‚æ•°å¾€æ­£ç¡®çš„æ–¹å‘æ›´æ–°åˆé€‚çš„å¤§å°ï¼Œä½¿å¾—æ›´æ–°åçš„å„ä¸ªå‚æ•°è®©æŸå¤±å‡½æ•°ï¼ˆç›®æ ‡å‡½æ•°ï¼‰å€¼ä¸æ–­é€¼è¿‘å…¨å±€æœ€å°ã€‚</p><p>å¸¸è§çš„ä¼˜åŒ–å™¨æœ‰ï¼š</p><ul><li><p>æ¢¯åº¦åŠæ¢¯åº¦ä¸‹é™ç®—æ³•</p></li><li><p>éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•</p></li><li><p>æ ‡å‡†åŠ¨é‡ä¼˜åŒ–ç®—æ³•</p></li><li><p>AdaGradç®—æ³•</p></li><li><p>RMSPropç®—æ³•</p></li><li><p>Adamç®—æ³•</p><p>æœ¬æ–‡å°†ä¸ä¼šä»‹ç»è¿™äº›ç®—æ³•çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ¯”è¾ƒå„ä¼˜åŒ–å™¨çš„è¡¨ç°ã€‚</p><p>åœ¨PyTorchï¼Œå®ç°çš„ä¼˜åŒ–ç®—æ³•æœ‰SGDï¼ˆéšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•ï¼‰ã€Adagradï¼ˆAdaGradç®—æ³•ï¼‰ã€RMSpropï¼ˆRMSpropç®—æ³•ï¼‰ã€Adamï¼ˆAdamç®—æ³•ï¼‰ï¼Œæˆ‘ä»¬å°†ä¼šé€šè¿‡å„ä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–æ ·ä¾‹ç›®æ ‡å‡½æ•°çš„æœ€å°å€¼æ¥è§‚å¯Ÿå®ƒä»¬çš„è¡¨ç°ã€‚ä»¥ä¸‹æ˜¯Pythonå®ç°ä»£ç ï¼š</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @Time : 2023/3/18 11:01</span><br><span class="hljs-comment"># @Author : Jclian91</span><br><span class="hljs-comment"># @File : optimizer_comparsion.py</span><br><span class="hljs-comment"># @Place : Minghang, Shanghai</span><br><span class="hljs-comment"># comparison in Five optimizers in PyTorch: SGD, AdaGrad, RMSProp, Adam</span><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn<br><span class="hljs-keyword">import</span> torch.utils.data <span class="hljs-keyword">as</span> Data<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset<br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> rcParams<br>rcParams[<span class="hljs-string">&#x27;font.family&#x27;</span>] = <span class="hljs-string">&#x27;SimHei&#x27;</span><br><br><span class="hljs-comment"># prepare data</span><br>x = torch.unsqueeze(torch.linspace(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">500</span>), dim=<span class="hljs-number">1</span>)<br>y = x.<span class="hljs-built_in">pow</span>(<span class="hljs-number">3</span>)<br><br><span class="hljs-comment"># set parameters</span><br>lr = <span class="hljs-number">0.01</span><br>batch_size = <span class="hljs-number">15</span><br>epoch = <span class="hljs-number">5</span><br>torch.manual_seed(<span class="hljs-number">1234</span>)<br><br><br><span class="hljs-comment"># Dataloader</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x, y</span>):<br>        self.X = x<br>        self.y = y<br><br>    <span class="hljs-comment"># number of rows in the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.X)<br><br>    <span class="hljs-comment"># get a row at an index</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):<br>        <span class="hljs-keyword">return</span> [self.X[idx], self.y[idx]]<br><br><br>loader = Data.DataLoader(dataset=MyDataset(x, y),<br>                         batch_size=batch_size,<br>                         shuffle=<span class="hljs-literal">True</span>,<br>                         num_workers=<span class="hljs-number">2</span>)<br><br><br><span class="hljs-comment"># create model</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Net</span>(torch.nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n_input, n_hidden, n_output</span>):<br>        <span class="hljs-built_in">super</span>(Net, self).__init__()<br>        self.hidden_layer = torch.nn.Linear(n_input, n_hidden)<br>        self.output_layer = torch.nn.Linear(n_hidden, n_output)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):<br>        x = torch.relu(self.hidden_layer(<span class="hljs-built_in">input</span>))<br>        output = self.output_layer(x)<br>        <span class="hljs-keyword">return</span> output<br><br><br><span class="hljs-comment"># train model and plot</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>():<br>    net_sgd = Net(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>)<br>    net_adagrad = Net(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>)<br>    net_rmsprop = Net(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>)<br>    net_adam = Net(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>)<br>    nets = [net_sgd, net_adagrad, net_rmsprop, net_adam]<br><br>    <span class="hljs-comment"># optimizer</span><br>    opt_sgd = torch.optim.SGD(net_sgd.parameters(), lr=lr)<br>    opt_momentum = torch.optim.Adagrad(net_adagrad.parameters(), lr=lr, lr_decay=<span class="hljs-number">0</span>)<br>    opt_rmsprop = torch.optim.RMSprop(net_rmsprop.parameters(), lr=lr, alpha=<span class="hljs-number">0.9</span>)<br>    opt_adam = torch.optim.Adam(net_adam.parameters(), lr=lr, betas=(<span class="hljs-number">0.9</span>, <span class="hljs-number">0.99</span>))<br>    optimizers = [opt_sgd, opt_momentum, opt_rmsprop, opt_adam]<br><br>    <span class="hljs-comment"># loss function</span><br>    loss_func = torch.nn.MSELoss()<br>    losses = [[], [], [], []]<br>    <span class="hljs-keyword">for</span> i_epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epoch):<br>        <span class="hljs-keyword">for</span> step, (batch_x, batch_y) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(loader):<br>            <span class="hljs-keyword">for</span> net, optimizer, loss_list <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(nets, optimizers, losses):<br>                pred_y = net(batch_x)<br>                loss = loss_func(pred_y, batch_y)<br>                optimizer.zero_grad()<br>                loss.backward()<br>                optimizer.step()<br>                loss_list.append(loss.data.numpy())<br><br>    plt.figure()<br>    labels = [<span class="hljs-string">&#x27;SGD&#x27;</span>, <span class="hljs-string">&#x27;AdaGrad&#x27;</span>, <span class="hljs-string">&#x27;RMSProp&#x27;</span>, <span class="hljs-string">&#x27;Adam&#x27;</span>]<br>    <span class="hljs-keyword">for</span> i, loss <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(losses):<br>        plt.plot(loss, label=labels[i])<br><br>    plt.legend(loc=<span class="hljs-string">&#x27;upper right&#x27;</span>, fontsize=<span class="hljs-number">15</span>)<br>    plt.tick_params(labelsize=<span class="hljs-number">13</span>)<br>    plt.xlabel(<span class="hljs-string">&#x27;è®­ç»ƒæ­¥éª¤&#x27;</span>, size=<span class="hljs-number">15</span>)<br>    plt.ylabel(<span class="hljs-string">&#x27;æ¨¡å‹æŸå¤±&#x27;</span>, size=<span class="hljs-number">15</span>)<br>    plt.ylim((<span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>))<br>    <span class="hljs-comment"># plt.show()</span><br>    plt.savefig(<span class="hljs-string">&#x27;optimizer_comparison.png&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    train()<br><br></code></pre></td></tr></table></figure><p>å„ä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–ç›®æ ‡å‡½æ•°çš„æŸå¤±å€¼çš„å›¾åƒå¦‚ä¸‹ï¼š</p><p><img src="/img/pytorch4_1.png" alt=""></p><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸Šè¿°å››ä¸ªä¼˜åŒ–å™¨ä¸­ï¼ŒAdamå’ŒRMSPropä¼˜åŒ–å™¨è¡¨ç°è¾ƒå¥½ï¼Œå…¶ä¸­Adamä¼˜åŒ–å™¨æ”¶æ•›æœ€å¿«ï¼Œè¡¨ç°æœ€ç¨³å®šã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorch</tag>
      
      <tag>ä¼˜åŒ–å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆä¸‰ï¼‰æ¨¡å—çš„ä¿å­˜ä¸åŠ è½½</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BF%9D%E5%AD%98%E4%B8%8E%E5%8A%A0%E8%BD%BD/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BF%9D%E5%AD%98%E4%B8%8E%E5%8A%A0%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨PyTorchä¿å­˜æ¨¡å—å’ŒåŠ è½½æ¨¡å‹ã€‚</p><h3 id="PyTorchæ¨¡å‹ä¿å­˜ä¸åŠ è½½">PyTorchæ¨¡å‹ä¿å­˜ä¸åŠ è½½</h3><p>åœ¨PyTorchä¸­ï¼Œä¸€ä¸ª<code>torch.nn.Module</code>æ¨¡å‹çš„å¯è®­ç»ƒå‚æ•°ï¼ˆå³æƒé‡ä¸åç§»é¡¹ï¼‰ä¿å­˜åœ¨æ¨¡å‹çš„<em>å‚æ•°</em>ï¼ˆ<em>parameters</em>)ï¼Œä½¿ç”¨<code>model.parameters()</code>è·å¾—)ä¸­ã€‚ä¸€ä¸ª<code>state_dict</code>å°±æ˜¯ä¸€ä¸ªç®€å•çš„Pythonå­—å…¸ï¼Œå°†æ¯å±‚æ˜ å°„åˆ°å…¶å‚æ•°å¼ é‡ã€‚PyTorchçš„æ¨¡å‹æ–‡ä»¶ä»¥<code>.pt</code>æˆ–<code>.pth</code>ä¸ºåç¼€ã€‚ä½¿ç”¨å‡½æ•°<code>torch.save</code>ä¿å­˜æ¨¡å‹ï¼Œä½¿ç”¨å‡½æ•°<code>torch.load</code>åŠ è½½æ¨¡å‹ã€‚</p><p>PyTorchæœ‰ä¸¤ç§ä¿å­˜ä¸åŠ è½½æ¨¡å‹çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯ä¿å­˜æ•´ä¸ªæ¨¡å‹ï¼ˆåŒ…æ‹¬æ¨¡å‹ç»“æ„åŠå‚æ•°å€¼ï¼‰ï¼Œå¦ä¸€ç§æ˜¯åªä¿å­˜æ¨¡å‹çš„å‚æ•°å€¼ï¼ˆå³<code>state_dict</code>ï¼‰ã€‚</p><ol><li>ä¿å­˜æ•´ä¸ªç½‘ç»œç»“æ„ä¿¡æ¯å’Œæ¨¡å‹å‚æ•°ä¿¡æ¯:</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.save(model_object, <span class="hljs-string">&#x27;./model.pth&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ç›´æ¥åŠ è½½å³å¯ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">model = torch.load(<span class="hljs-string">&#x27;./model.pth&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>åªä¿å­˜ç½‘ç»œçš„æ¨¡å‹å‚æ•°</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.save(model_object.state_dict(), <span class="hljs-string">&#x27;./params.pth&#x27;</span>)<br></code></pre></td></tr></table></figure><p>åŠ è½½åˆ™è¦å…ˆä»æœ¬åœ°ç½‘ç»œæ¨¡å—å¯¼å…¥ç½‘ç»œï¼Œç„¶åå†åŠ è½½å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> Model<br>model = Model()<br>model.load_state_dict(torch.load(<span class="hljs-string">&#x27;./params.pth&#x27;</span>))<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h3><p>æˆ‘ä»¬ä»¥æ–‡ç« <a href="https://percent4.github.io/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E6%90%AD%E5%BB%BAMLP%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">PyTorchå…¥é—¨ï¼ˆäºŒï¼‰æ­å»ºMLPæ¨¡å‹å®ç°åˆ†ç±»ä»»åŠ¡</a>ä¸­çš„äºŒåˆ†ç±»MLPæ¨¡å‹ä¸ºä¾‹ï¼Œæ¥æ¼”ç¤ºå¦‚ä½•åœ¨PyTorchä¸­ä¿å­˜æ¨¡å‹å’ŒåŠ è½½ä»£ç ã€‚</p><p>åªä¿å­˜æ¨¡å‹å‚æ•°å€¼çš„ç¤ºä¾‹Pythonä»£ç ï¼ˆ<code>save_model.py</code>ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> vstack<br><span class="hljs-keyword">from</span> pandas <span class="hljs-keyword">import</span> read_csv<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelEncoder<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> Tensor<br><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> SGD<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, DataLoader, random_split<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Linear, ReLU, Sigmoid, Module, BCELoss<br><span class="hljs-keyword">from</span> torch.nn.init <span class="hljs-keyword">import</span> kaiming_uniform_, xavier_uniform_<br><br><br><span class="hljs-comment"># dataset definition</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CSVDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, path</span>):<br>        <span class="hljs-comment"># load the csv file as a dataframe</span><br>        df = read_csv(path, header=<span class="hljs-literal">None</span>)<br>        <span class="hljs-comment"># store the inputs and outputs</span><br>        self.X = df.values[:, :-<span class="hljs-number">1</span>]<br>        self.y = df.values[:, -<span class="hljs-number">1</span>]<br>        <span class="hljs-comment"># ensure input data is floats</span><br>        self.X = self.X.astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        <span class="hljs-comment"># label encode target and ensure the values are floats</span><br>        self.y = LabelEncoder().fit_transform(self.y)<br>        self.y = self.y.astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        self.y = self.y.reshape((<span class="hljs-built_in">len</span>(self.y), <span class="hljs-number">1</span>))<br><br>    <span class="hljs-comment"># number of rows in the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.X)<br><br>    <span class="hljs-comment"># get a row at an index</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):<br>        <span class="hljs-keyword">return</span> [self.X[idx], self.y[idx]]<br><br>    <span class="hljs-comment"># get indexes for train and test rows</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_splits</span>(<span class="hljs-params">self, n_test=<span class="hljs-number">0.3</span></span>):<br>        <span class="hljs-comment"># determine sizes</span><br>        test_size = <span class="hljs-built_in">round</span>(n_test * <span class="hljs-built_in">len</span>(self.X))<br>        train_size = <span class="hljs-built_in">len</span>(self.X) - test_size<br>        <span class="hljs-comment"># calculate the split</span><br>        <span class="hljs-keyword">return</span> random_split(self, [train_size, test_size])<br><br><br><span class="hljs-comment"># model definition</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MLP</span>(<span class="hljs-title class_ inherited__">Module</span>):<br>    <span class="hljs-comment"># define model elements</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n_inputs</span>):<br>        <span class="hljs-built_in">super</span>(MLP, self).__init__()<br>        <span class="hljs-comment"># input to first hidden layer</span><br>        self.hidden1 = Linear(n_inputs, <span class="hljs-number">10</span>)<br>        kaiming_uniform_(self.hidden1.weight, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>        self.act1 = ReLU()<br>        <span class="hljs-comment"># second hidden layer</span><br>        self.hidden2 = Linear(<span class="hljs-number">10</span>, <span class="hljs-number">8</span>)<br>        kaiming_uniform_(self.hidden2.weight, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>        self.act2 = ReLU()<br>        <span class="hljs-comment"># third hidden layer and output</span><br>        self.hidden3 = Linear(<span class="hljs-number">8</span>, <span class="hljs-number">1</span>)<br>        xavier_uniform_(self.hidden3.weight)<br>        self.act3 = Sigmoid()<br><br>    <span class="hljs-comment"># forward propagate input</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, X</span>):<br>        <span class="hljs-comment"># input to first hidden layer</span><br>        X = self.hidden1(X)<br>        X = self.act1(X)<br>        <span class="hljs-comment"># second hidden layer</span><br>        X = self.hidden2(X)<br>        X = self.act2(X)<br>        <span class="hljs-comment"># third hidden layer and output</span><br>        X = self.hidden3(X)<br>        X = self.act3(X)<br>        <span class="hljs-keyword">return</span> X<br><br><br><span class="hljs-comment"># prepare the dataset</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">prepare_data</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    dataset = CSVDataset(path)<br>    <span class="hljs-comment"># calculate split</span><br>    train, test = dataset.get_splits()<br>    <span class="hljs-comment"># prepare data loaders</span><br>    train_dl = DataLoader(train, batch_size=<span class="hljs-number">32</span>, shuffle=<span class="hljs-literal">True</span>)<br>    test_dl = DataLoader(test, batch_size=<span class="hljs-number">1024</span>, shuffle=<span class="hljs-literal">False</span>)<br>    <span class="hljs-keyword">return</span> train_dl, test_dl<br><br><br><span class="hljs-comment"># train the model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>(<span class="hljs-params">train_dl, model</span>):<br>    <span class="hljs-comment"># define the optimization</span><br>    criterion = BCELoss()<br>    optimizer = SGD(model.parameters(), lr=<span class="hljs-number">0.01</span>, momentum=<span class="hljs-number">0.9</span>)<br>    <span class="hljs-comment"># enumerate epochs</span><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        <span class="hljs-comment"># enumerate mini batches</span><br>        <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_dl):<br>            <span class="hljs-comment"># clear the gradients</span><br>            optimizer.zero_grad()<br>            <span class="hljs-comment"># compute the model output</span><br>            yhat = model(inputs)<br>            <span class="hljs-comment"># calculate loss</span><br>            loss = criterion(yhat, targets)<br>            <span class="hljs-comment"># credit assignment</span><br>            loss.backward()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;epoch: &#123;&#125;, batch: &#123;&#125;, loss: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(epoch, i, loss.data))<br>            <span class="hljs-comment"># update model weights</span><br>            optimizer.step()<br><br><br><span class="hljs-comment"># evaluate the model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_model</span>(<span class="hljs-params">test_dl, model</span>):<br>    predictions, actuals = [], []<br>    <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_dl):<br>        <span class="hljs-comment"># evaluate the model on the test set</span><br>        yhat = model(inputs)<br>        <span class="hljs-comment"># retrieve numpy array</span><br>        yhat = yhat.detach().numpy()<br>        actual = targets.numpy()<br>        actual = actual.reshape((<span class="hljs-built_in">len</span>(actual), <span class="hljs-number">1</span>))<br>        <span class="hljs-comment"># round to class values</span><br>        yhat = yhat.<span class="hljs-built_in">round</span>()<br>        <span class="hljs-comment"># store</span><br>        predictions.append(yhat)<br>        actuals.append(actual)<br>    predictions, actuals = vstack(predictions), vstack(actuals)<br>    <span class="hljs-comment"># calculate accuracy</span><br>    acc = accuracy_score(actuals, predictions)<br>    <span class="hljs-keyword">return</span> acc<br><br><br><span class="hljs-comment"># make a class prediction for one row of data</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>(<span class="hljs-params">row, model</span>):<br>    <span class="hljs-comment"># convert row to data</span><br>    row = Tensor([row])<br>    <span class="hljs-comment"># make prediction</span><br>    yhat = model(row)<br>    <span class="hljs-comment"># retrieve numpy array</span><br>    yhat = yhat.detach().numpy()<br>    <span class="hljs-keyword">return</span> yhat<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># prepare the data</span><br>    path = <span class="hljs-string">&#x27;./data/ionosphere.csv&#x27;</span><br>    train_dl, test_dl = prepare_data(path)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(train_dl.dataset), <span class="hljs-built_in">len</span>(test_dl.dataset))<br>    <span class="hljs-comment"># define the network</span><br>    model = MLP(<span class="hljs-number">34</span>)<br>    <span class="hljs-built_in">print</span>(model)<br>    <span class="hljs-comment"># train the model</span><br>    train_model(train_dl, model)<br>    torch.save(model.state_dict(), <span class="hljs-string">&#x27;binary_classification.pth&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(model.state_dict())<br>    <span class="hljs-comment"># evaluate the model</span><br>    acc = evaluate_model(test_dl, model)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Accuracy: %.3f&#x27;</span> % acc)<br></code></pre></td></tr></table></figure><p>è¿è¡Œä»£ç ï¼Œä¼šè¾“å‡ºè¯¥MLPæ¨¡å‹çš„å‚æ•°å€¼ï¼ˆ<code>state_dict</code>ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">OrderedDict([(<span class="hljs-string">&#x27;hidden1.weight&#x27;</span>, tensor([[-4.3042e-02, -1.3315e-01, -3.5050e-01, -1.4949e-01, -1.6642e-01,<br>         ......), (<span class="hljs-string">&#x27;hidden1.bias&#x27;</span>, tensor([ 0.2563, -0.0024, -0.1276,  0.1943, -0.2728, -0.2992,  0.3130,  0.0245,<br>        -0.0381,  0.4498])), (<span class="hljs-string">&#x27;hidden2.weight&#x27;</span>, tensor([[-0.5759, -0.9750,  1.0027,  0.5148,  0.6903,  0.3534, -1.0665,  0.1220,<br>         -0.0757,  0.4448], ......), (<span class="hljs-string">&#x27;hidden2.bias&#x27;</span>, tensor([ 1.7468e-01,  5.9972e-02, -4.2997e-02, -2.2675e-01,  8.3250e-01,<br>        -3.2392e-04,  3.9665e-01, -2.5674e-01])), (<span class="hljs-string">&#x27;hidden3.weight&#x27;</span>, tensor([[ 1.3292, -0.6698, -0.2412,  1.0923, -2.5248,  0.3479, -1.1331, -0.0240]])), (<span class="hljs-string">&#x27;hidden3.bias&#x27;</span>, tensor([-0.8218]))])<br></code></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>state_dict</code>è¾“å‡ºçš„æ ¼å¼ä¸ºPythonå­—å…¸ç»“æ„ã€‚ä¿å­˜ä¸ºæ–‡ä»¶åç§°ä¸ºbinary_classification.pthã€‚</p><p>æ¥ç€æˆ‘ä»¬åŠ è½½è¯¥æ¨¡å‹æ–‡ä»¶ï¼Œå¹¶å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œç¤ºä¾‹ä»£ç ï¼ˆ<code>load_model.py</code>ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> Tensor<br><br><span class="hljs-keyword">from</span> save_model <span class="hljs-keyword">import</span> MLP<br><br>model = MLP(<span class="hljs-number">34</span>)<br>state_dict = torch.load(<span class="hljs-string">&#x27;./binary_classification.pth&#x27;</span>)<br>model.load_state_dict(state_dict)<br><span class="hljs-built_in">print</span>(model)<br><span class="hljs-comment"># make a single prediction (expect class=1)</span><br>row = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.99539</span>, -<span class="hljs-number">0.05889</span>, <span class="hljs-number">0.85243</span>, <span class="hljs-number">0.02306</span>, <span class="hljs-number">0.83398</span>, -<span class="hljs-number">0.37708</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.03760</span>, <span class="hljs-number">0.85243</span>, -<span class="hljs-number">0.17755</span>, <span class="hljs-number">0.59755</span>, -<span class="hljs-number">0.44945</span>,<br>       <span class="hljs-number">0.60536</span>, -<span class="hljs-number">0.38223</span>, <span class="hljs-number">0.84356</span>, -<span class="hljs-number">0.38542</span>, <span class="hljs-number">0.58212</span>, -<span class="hljs-number">0.32192</span>, <span class="hljs-number">0.56971</span>, -<span class="hljs-number">0.29674</span>, <span class="hljs-number">0.36946</span>, -<span class="hljs-number">0.47357</span>, <span class="hljs-number">0.56811</span>, -<span class="hljs-number">0.51171</span>,<br>       <span class="hljs-number">0.41078</span>, -<span class="hljs-number">0.46168</span>, <span class="hljs-number">0.21266</span>, -<span class="hljs-number">0.34090</span>, <span class="hljs-number">0.42267</span>, -<span class="hljs-number">0.54487</span>, <span class="hljs-number">0.18641</span>, -<span class="hljs-number">0.45300</span>]<br>row = Tensor([row])<br><span class="hljs-comment"># make prediction</span><br>yhat = model(row)<br><span class="hljs-comment"># retrieve numpy array</span><br>yhat = yhat.detach().numpy()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Predicted: %.3f (class=%d)&#x27;</span> % (yhat, yhat.<span class="hljs-built_in">round</span>()))<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³ä¿å­˜ã€åŠ è½½æ•´ä¸ªæ¨¡å‹åŠæ¨¡å‹å‚æ•°ï¼Œåˆ™åœ¨æ¨¡å‹ä¿å­˜ä»£ç ï¼ˆ<code>save_model.py</code>ï¼‰ä¸­ä½¿ç”¨ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">torch.save(model, <span class="hljs-string">&#x27;binary_classification.pth&#x27;</span>)<br></code></pre></td></tr></table></figure><p>åŠ è½½æ¨¡å‹éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> Tensor<br><br><span class="hljs-keyword">from</span> save_model <span class="hljs-keyword">import</span> MLP<br><br>model = torch.load(<span class="hljs-string">&#x27;./binary_classification.pth&#x27;</span>)<br><br><span class="hljs-comment"># make a single prediction (expect class=1)</span><br>row = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.99539</span>, -<span class="hljs-number">0.05889</span>, <span class="hljs-number">0.85243</span>, <span class="hljs-number">0.02306</span>, <span class="hljs-number">0.83398</span>, -<span class="hljs-number">0.37708</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.03760</span>, <span class="hljs-number">0.85243</span>, -<span class="hljs-number">0.17755</span>, <span class="hljs-number">0.59755</span>, -<span class="hljs-number">0.44945</span>,<br>       <span class="hljs-number">0.60536</span>, -<span class="hljs-number">0.38223</span>, <span class="hljs-number">0.84356</span>, -<span class="hljs-number">0.38542</span>, <span class="hljs-number">0.58212</span>, -<span class="hljs-number">0.32192</span>, <span class="hljs-number">0.56971</span>, -<span class="hljs-number">0.29674</span>, <span class="hljs-number">0.36946</span>, -<span class="hljs-number">0.47357</span>, <span class="hljs-number">0.56811</span>, -<span class="hljs-number">0.51171</span>,<br>       <span class="hljs-number">0.41078</span>, -<span class="hljs-number">0.46168</span>, <span class="hljs-number">0.21266</span>, -<span class="hljs-number">0.34090</span>, <span class="hljs-number">0.42267</span>, -<span class="hljs-number">0.54487</span>, <span class="hljs-number">0.18641</span>, -<span class="hljs-number">0.45300</span>]<br>row = Tensor([row])<br><span class="hljs-comment"># make prediction</span><br>yhat = model(row)<br><span class="hljs-comment"># retrieve numpy array</span><br>yhat = yhat.detach().numpy()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Predicted: %.3f (class=%d)&#x27;</span> % (yhat, yhat.<span class="hljs-built_in">round</span>()))<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¨¡å‹ç»“æ„MLPç±»ä»éœ€åœ¨ä»£ç ä¸­ï¼ˆè™½ç„¶åé¢ä»£ç ä¸­å¹¶æ²¡æœ‰ç”¨åˆ°MLPç±»ï¼‰ï¼Œè¿™æ ·æ¨¡å‹æ‰èƒ½åŠ è½½æˆåŠŸï¼Œå¦åˆ™ä¼šæŠ¥æ¨¡å‹åŠ è½½å¤±è´¥ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ç®€å•ä»‹ç»äº†å¦‚ä½•åœ¨PyTorchä¸­ä¿å­˜å’ŒåŠ è½½æ¨¡å‹ã€‚æœ¬æ–‡ä»‹ç»çš„æ¨¡å‹ä»£ç å·²å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼š<a href="https://github.com/percent4/PyTorch_Learning">https://github.com/percent4/PyTorch_Learning</a>ã€‚åç»­å°†æŒç»­ä»‹ç»PyTorchå†…å®¹ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨~</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆäºŒï¼‰æ­å»ºMLPæ¨¡å‹å®ç°åˆ†ç±»ä»»åŠ¡</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E6%90%AD%E5%BB%BAMLP%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E6%90%AD%E5%BB%BAMLP%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡æ˜¯PyTorchå…¥é—¨çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œåç»­å°†ä¼šæŒç»­æ›´æ–°ï¼Œä½œä¸ºPyTorchç³»åˆ—æ–‡ç« ã€‚</p><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨PyTorchæ¥æ­å»ºç®€å•çš„MLPï¼ˆMulti-layer Perceptronï¼Œå¤šå±‚æ„ŸçŸ¥æœºï¼‰æ¨¡å‹ï¼Œæ¥å®ç°äºŒåˆ†ç±»åŠå¤šåˆ†ç±»ä»»åŠ¡ã€‚</p><h3 id="æ•°æ®é›†ä»‹ç»">æ•°æ®é›†ä»‹ç»</h3><p>äºŒåˆ†ç±»æ•°æ®é›†ä¸º<code>ionosphere.csv</code>(ç”µç¦»å±‚æ•°æ®é›†)ï¼Œæ˜¯<a href="http://archive.ics.uci.edu/ml/index.php">UCIæœºå™¨å­¦ä¹ æ•°æ®é›†</a>ä¸­çš„ç»å…¸äºŒåˆ†ç±»æ•°æ®é›†ã€‚å®ƒä¸€å…±æœ‰351ä¸ªè§‚æµ‹å€¼ï¼Œ34ä¸ªè‡ªå˜é‡ï¼Œ1ä¸ªå› å˜é‡ï¼ˆç±»åˆ«ï¼‰ï¼Œç±»åˆ«å–å€¼ä¸º<code>g</code>(good)å’Œ<code>b</code>(bad)ã€‚åœ¨<code>ionosphere.csv</code>æ–‡ä»¶ä¸­ï¼Œå…±351è¡Œï¼Œå‰34åˆ—ä½œä¸ºè‡ªå˜é‡ï¼ˆè¾“å…¥çš„Xï¼‰ï¼Œæœ€åä¸€åˆ—ä½œä¸ºç±»åˆ«å€¼ï¼ˆè¾“å‡ºçš„yï¼‰ã€‚</p><p><img src="/img/pytorch2_1.png" alt="ç”µç¦»å±‚æ•°æ®"></p><p>å¤šåˆ†ç±»æ•°æ®é›†ä¸º<code>iris.csv</code>ï¼ˆé¸¢å°¾èŠ±æ•°æ®é›†ï¼‰ï¼Œæ˜¯<a href="http://archive.ics.uci.edu/ml/index.php">UCIæœºå™¨å­¦ä¹ æ•°æ®é›†</a>ä¸­çš„ç»å…¸å¤šåˆ†ç±»æ•°æ®é›†ã€‚å®ƒä¸€å…±æœ‰150ä¸ªè§‚æµ‹å€¼ï¼Œ4ä¸ªè‡ªå˜é‡ï¼ˆè¼ç‰‡é•¿åº¦ï¼Œè¼ç‰‡å®½åº¦ï¼ŒèŠ±ç“£é•¿åº¦ï¼ŒèŠ±ç“£å®½åº¦ï¼‰ï¼Œ1ä¸ªå› å˜é‡ï¼ˆç±»åˆ«ï¼‰ï¼Œç±»åˆ«å–å€¼ä¸º<code>Iris-setosa</code>,<code>Iris-versicolour</code>,<code>Iris-virginica</code>ã€‚åœ¨<code>iris.csv</code>æ–‡ä»¶ä¸­ï¼Œå…±150è¡Œï¼Œå‰4åˆ—ä½œä¸ºè‡ªå˜é‡ï¼ˆè¾“å…¥çš„Xï¼‰ï¼Œæœ€åä¸€åˆ—ä½œä¸ºç±»åˆ«å€¼ï¼ˆè¾“å‡ºçš„yï¼‰ã€‚å‰å‡ è¡Œæ•°æ®å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/pytorch2_2.png" alt="é¸¢å°¾èŠ±æ•°æ®é›†"></p><h3 id="åˆ†ç±»æ¨¡å‹æµç¨‹">åˆ†ç±»æ¨¡å‹æµç¨‹</h3><p>ä½¿ç”¨PyTorchæ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹æ¥è§£å†³åˆ†ç±»é—®é¢˜çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/img/pytorch2_4.png" alt=""></p><p>å…¶ä¸­<code>åŠ è½½æ•°æ®é›†</code>å’Œ<code>åˆ’åˆ†æ•°æ®é›†</code>ä¸ºæ•°æ®å¤„ç†éƒ¨åˆ†ï¼Œ<code>æ„å»ºæ¨¡å‹</code>å’Œ<code>é€‰æ‹©æŸå¤±å‡½æ•°åŠä¼˜åŒ–å™¨</code>ä¸ºåˆ›å»ºæ¨¡å‹éƒ¨åˆ†ï¼Œ<code>æ¨¡å‹è®­ç»ƒ</code>çš„ç›®æ ‡æ˜¯é€‰æ‹©åˆé€‚çš„ä¼˜åŒ–å™¨åŠè®­ç»ƒæ­¥é•¿ä½¿å¾—æŸå¤±å‡½æ•°çš„å€¼å¾ˆå°ï¼Œ<code>æ¨¡å‹é¢„æµ‹</code>æ˜¯åœ¨æ¨¡å‹æµ‹è¯•é›†æˆ–æ–°æ•°æ®ä¸Šçš„é¢„æµ‹ã€‚</p><h3 id="äºŒåˆ†ç±»æ¨¡å‹">äºŒåˆ†ç±»æ¨¡å‹</h3><p>ä½¿ç”¨PyTorchæ„å»ºMLPæ¨¡å‹æ¥å®ç°äºŒåˆ†ç±»ä»»åŠ¡ï¼Œæ¨¡å‹ç»“æœå›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/pytorch2_3.png" alt="MLPæ¨¡å‹ç¤ºæ„å›¾"></p><p>å®ç°MLPæ¨¡å‹çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># pytorch mlp for binary classification</span><br><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> vstack<br><span class="hljs-keyword">from</span> pandas <span class="hljs-keyword">import</span> read_csv<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelEncoder<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> Tensor<br><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> SGD<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, DataLoader, random_split<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Linear, ReLU, Sigmoid, Module, BCELoss<br><span class="hljs-keyword">from</span> torch.nn.init <span class="hljs-keyword">import</span> kaiming_uniform_, xavier_uniform_<br><br><br><span class="hljs-comment"># dataset definition</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CSVDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, path</span>):<br>        <span class="hljs-comment"># load the csv file as a dataframe</span><br>        df = read_csv(path, header=<span class="hljs-literal">None</span>)<br>        <span class="hljs-comment"># store the inputs and outputs</span><br>        self.X = df.values[:, :-<span class="hljs-number">1</span>]<br>        self.y = df.values[:, -<span class="hljs-number">1</span>]<br>        <span class="hljs-comment"># ensure input data is floats</span><br>        self.X = self.X.astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        <span class="hljs-comment"># label encode target and ensure the values are floats</span><br>        self.y = LabelEncoder().fit_transform(self.y)<br>        self.y = self.y.astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        self.y = self.y.reshape((<span class="hljs-built_in">len</span>(self.y), <span class="hljs-number">1</span>))<br><br>    <span class="hljs-comment"># number of rows in the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.X)<br><br>    <span class="hljs-comment"># get a row at an index</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):<br>        <span class="hljs-keyword">return</span> [self.X[idx], self.y[idx]]<br><br>    <span class="hljs-comment"># get indexes for train and test rows</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_splits</span>(<span class="hljs-params">self, n_test=<span class="hljs-number">0.3</span></span>):<br>        <span class="hljs-comment"># determine sizes</span><br>        test_size = <span class="hljs-built_in">round</span>(n_test * <span class="hljs-built_in">len</span>(self.X))<br>        train_size = <span class="hljs-built_in">len</span>(self.X) - test_size<br>        <span class="hljs-comment"># calculate the split</span><br>        <span class="hljs-keyword">return</span> random_split(self, [train_size, test_size])<br><br><br><span class="hljs-comment"># model definition</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MLP</span>(<span class="hljs-title class_ inherited__">Module</span>):<br>    <span class="hljs-comment"># define model elements</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n_inputs</span>):<br>        <span class="hljs-built_in">super</span>(MLP, self).__init__()<br>        <span class="hljs-comment"># input to first hidden layer</span><br>        self.hidden1 = Linear(n_inputs, <span class="hljs-number">10</span>)<br>        kaiming_uniform_(self.hidden1.weight, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>        self.act1 = ReLU()<br>        <span class="hljs-comment"># second hidden layer</span><br>        self.hidden2 = Linear(<span class="hljs-number">10</span>, <span class="hljs-number">8</span>)<br>        kaiming_uniform_(self.hidden2.weight, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>        self.act2 = ReLU()<br>        <span class="hljs-comment"># third hidden layer and output</span><br>        self.hidden3 = Linear(<span class="hljs-number">8</span>, <span class="hljs-number">1</span>)<br>        xavier_uniform_(self.hidden3.weight)<br>        self.act3 = Sigmoid()<br><br>    <span class="hljs-comment"># forward propagate input</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, X</span>):<br>        <span class="hljs-comment"># input to first hidden layer</span><br>        X = self.hidden1(X)<br>        X = self.act1(X)<br>        <span class="hljs-comment"># second hidden layer</span><br>        X = self.hidden2(X)<br>        X = self.act2(X)<br>        <span class="hljs-comment"># third hidden layer and output</span><br>        X = self.hidden3(X)<br>        X = self.act3(X)<br>        <span class="hljs-keyword">return</span> X<br><br><br><span class="hljs-comment"># prepare the dataset</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">prepare_data</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    dataset = CSVDataset(path)<br>    <span class="hljs-comment"># calculate split</span><br>    train, test = dataset.get_splits()<br>    <span class="hljs-comment"># prepare data loaders</span><br>    train_dl = DataLoader(train, batch_size=<span class="hljs-number">32</span>, shuffle=<span class="hljs-literal">True</span>)<br>    test_dl = DataLoader(test, batch_size=<span class="hljs-number">1024</span>, shuffle=<span class="hljs-literal">False</span>)<br>    <span class="hljs-keyword">return</span> train_dl, test_dl<br><br><br><span class="hljs-comment"># train the model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>(<span class="hljs-params">train_dl, model</span>):<br>    <span class="hljs-comment"># define the optimization</span><br>    criterion = BCELoss()<br>    optimizer = SGD(model.parameters(), lr=<span class="hljs-number">0.01</span>, momentum=<span class="hljs-number">0.9</span>)<br>    <span class="hljs-comment"># enumerate epochs</span><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        <span class="hljs-comment"># enumerate mini batches</span><br>        <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_dl):<br>            <span class="hljs-comment"># clear the gradients</span><br>            optimizer.zero_grad()<br>            <span class="hljs-comment"># compute the model output</span><br>            yhat = model(inputs)<br>            <span class="hljs-comment"># calculate loss</span><br>            loss = criterion(yhat, targets)<br>            <span class="hljs-comment"># credit assignment</span><br>            loss.backward()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;epoch: &#123;&#125;, batch: &#123;&#125;, loss: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(epoch, i, loss.data))<br>            <span class="hljs-comment"># update model weights</span><br>            optimizer.step()<br><br><br><span class="hljs-comment"># evaluate the model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_model</span>(<span class="hljs-params">test_dl, model</span>):<br>    predictions, actuals = [], []<br>    <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_dl):<br>        <span class="hljs-comment"># evaluate the model on the test set</span><br>        yhat = model(inputs)<br>        <span class="hljs-comment"># retrieve numpy array</span><br>        yhat = yhat.detach().numpy()<br>        actual = targets.numpy()<br>        actual = actual.reshape((<span class="hljs-built_in">len</span>(actual), <span class="hljs-number">1</span>))<br>        <span class="hljs-comment"># round to class values</span><br>        yhat = yhat.<span class="hljs-built_in">round</span>()<br>        <span class="hljs-comment"># store</span><br>        predictions.append(yhat)<br>        actuals.append(actual)<br>    predictions, actuals = vstack(predictions), vstack(actuals)<br>    <span class="hljs-comment"># calculate accuracy</span><br>    acc = accuracy_score(actuals, predictions)<br>    <span class="hljs-keyword">return</span> acc<br><br><br><span class="hljs-comment"># make a class prediction for one row of data</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>(<span class="hljs-params">row, model</span>):<br>    <span class="hljs-comment"># convert row to data</span><br>    row = Tensor([row])<br>    <span class="hljs-comment"># make prediction</span><br>    yhat = model(row)<br>    <span class="hljs-comment"># retrieve numpy array</span><br>    yhat = yhat.detach().numpy()<br>    <span class="hljs-keyword">return</span> yhat<br><br><br><span class="hljs-comment"># prepare the data</span><br>path = <span class="hljs-string">&#x27;./data/ionosphere.csv&#x27;</span><br>train_dl, test_dl = prepare_data(path)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(train_dl.dataset), <span class="hljs-built_in">len</span>(test_dl.dataset))<br><span class="hljs-comment"># define the network</span><br>model = MLP(<span class="hljs-number">34</span>)<br><span class="hljs-built_in">print</span>(model)<br><span class="hljs-comment"># train the model</span><br>train_model(train_dl, model)<br><span class="hljs-comment"># evaluate the model</span><br>acc = evaluate_model(test_dl, model)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Accuracy: %.3f&#x27;</span> % acc)<br><span class="hljs-comment"># make a single prediction (expect class=1)</span><br>row = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.99539</span>, -<span class="hljs-number">0.05889</span>, <span class="hljs-number">0.85243</span>, <span class="hljs-number">0.02306</span>, <span class="hljs-number">0.83398</span>, -<span class="hljs-number">0.37708</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.03760</span>, <span class="hljs-number">0.85243</span>, -<span class="hljs-number">0.17755</span>, <span class="hljs-number">0.59755</span>, -<span class="hljs-number">0.44945</span>,<br>       <span class="hljs-number">0.60536</span>, -<span class="hljs-number">0.38223</span>, <span class="hljs-number">0.84356</span>, -<span class="hljs-number">0.38542</span>, <span class="hljs-number">0.58212</span>, -<span class="hljs-number">0.32192</span>, <span class="hljs-number">0.56971</span>, -<span class="hljs-number">0.29674</span>, <span class="hljs-number">0.36946</span>, -<span class="hljs-number">0.47357</span>, <span class="hljs-number">0.56811</span>, -<span class="hljs-number">0.51171</span>,<br>       <span class="hljs-number">0.41078</span>, -<span class="hljs-number">0.46168</span>, <span class="hljs-number">0.21266</span>, -<span class="hljs-number">0.34090</span>, <span class="hljs-number">0.42267</span>, -<span class="hljs-number">0.54487</span>, <span class="hljs-number">0.18641</span>, -<span class="hljs-number">0.45300</span>]<br>yhat = predict(row, model)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Predicted: %.3f (class=%d)&#x27;</span> % (yhat, yhat.<span class="hljs-built_in">round</span>()))<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼ŒCSVDatasetç±»ä¸ºcsvæ•°æ®é›†åŠ è½½ç±»ï¼Œå¤„ç†æˆæ¨¡å‹é€‚åˆçš„æ•°æ®æ ¼å¼ï¼Œå¹¶åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ¯”ä¾‹ä¸º7:3ã€‚MLPç±»ä¸ºMLPæ¨¡å‹ï¼Œæ¨¡å‹è¾“å‡ºå±‚é‡‡ç”¨Sigmoidå‡½æ•°ï¼ŒæŸå¤±å‡½æ•°é‡‡ç”¨BCELossï¼Œä¼˜åŒ–å™¨é‡‡ç”¨SGDï¼Œå…±è®­ç»ƒ100æ¬¡ã€‚evaluate_modelå‡½æ•°æ˜¯æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°ï¼Œpredictå‡½æ•°ä¸ºåœ¨æ–°æ•°æ®ä¸Šçš„é¢„æµ‹ç»“æœã€‚MLPæ¨¡å‹çš„PyTorchè¾“å‡ºå¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">MLP(<br>  (hidden1): Linear(in_features=34, out_features=10, bias=True)<br>  (act1): ReLU()<br>  (hidden2): Linear(in_features=10, out_features=8, bias=True)<br>  (act2): ReLU()<br>  (hidden3): Linear(in_features=8, out_features=1, bias=True)<br>  (act3): Sigmoid()<br>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">epoch: 0, batch: 0, loss: 0.7491992712020874<br>epoch: 0, batch: 1, loss: 0.750106692314148<br>epoch: 0, batch: 2, loss: 0.7033759355545044<br>......<br>epoch: 99, batch: 5, loss: 0.020291464403271675<br>epoch: 99, batch: 6, loss: 0.02309396117925644<br>epoch: 99, batch: 7, loss: 0.0278386902064085<br>Accuracy: 0.924<br>Predicted: 0.989 (class=1)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥MLPæ¨¡å‹çš„æœ€ç»ˆè®­ç»ƒlosså€¼ä¸º0.02784ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„Accuracyä¸º0.924ï¼Œåœ¨æ–°æ•°æ®ä¸Šé¢„æµ‹å®Œå…¨æ­£ç¡®ã€‚</p><h3 id="å¤šåˆ†ç±»æ¨¡å‹">å¤šåˆ†ç±»æ¨¡å‹</h3><p>æ¥ç€æˆ‘ä»¬æ¥åˆ›å»ºMLPæ¨¡å‹å®ç°irisæ•°æ®é›†çš„ä¸‰åˆ†ç±»ä»»åŠ¡ï¼ŒPythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># pytorch mlp for multiclass classification</span><br><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> vstack<br><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> argmax<br><span class="hljs-keyword">from</span> pandas <span class="hljs-keyword">import</span> read_csv<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelEncoder, LabelBinarizer<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> Tensor<br><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> SGD, Adam<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, DataLoader, random_split<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Linear, ReLU, Softmax, Module, CrossEntropyLoss<br><span class="hljs-keyword">from</span> torch.nn.init <span class="hljs-keyword">import</span> kaiming_uniform_, xavier_uniform_<br><br><br><span class="hljs-comment"># dataset definition</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CSVDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, path</span>):<br>        <span class="hljs-comment"># load the csv file as a dataframe</span><br>        df = read_csv(path, header=<span class="hljs-literal">None</span>)<br>        <span class="hljs-comment"># store the inputs and outputs</span><br>        self.X = df.values[:, :-<span class="hljs-number">1</span>]<br>        self.y = df.values[:, -<span class="hljs-number">1</span>]<br>        <span class="hljs-comment"># ensure input data is floats</span><br>        self.X = self.X.astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        <span class="hljs-comment"># label encode target and ensure the values are floats</span><br>        self.y = LabelEncoder().fit_transform(self.y)<br>        <span class="hljs-comment"># self.y = LabelBinarizer().fit_transform(self.y)</span><br><br>    <span class="hljs-comment"># number of rows in the dataset</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.X)<br><br>    <span class="hljs-comment"># get a row at an index</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):<br>        <span class="hljs-keyword">return</span> [self.X[idx], self.y[idx]]<br><br>    <span class="hljs-comment"># get indexes for train and test rows</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_splits</span>(<span class="hljs-params">self, n_test=<span class="hljs-number">0.3</span></span>):<br>        <span class="hljs-comment"># determine sizes</span><br>        test_size = <span class="hljs-built_in">round</span>(n_test * <span class="hljs-built_in">len</span>(self.X))<br>        train_size = <span class="hljs-built_in">len</span>(self.X) - test_size<br>        <span class="hljs-comment"># calculate the split</span><br>        <span class="hljs-keyword">return</span> random_split(self, [train_size, test_size])<br><br><br><span class="hljs-comment"># model definition</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MLP</span>(<span class="hljs-title class_ inherited__">Module</span>):<br>    <span class="hljs-comment"># define model elements</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n_inputs</span>):<br>        <span class="hljs-built_in">super</span>(MLP, self).__init__()<br>        <span class="hljs-comment"># input to first hidden layer</span><br>        self.hidden1 = Linear(n_inputs, <span class="hljs-number">5</span>)<br>        kaiming_uniform_(self.hidden1.weight, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>        self.act1 = ReLU()<br>        <span class="hljs-comment"># second hidden layer</span><br>        self.hidden2 = Linear(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)<br>        kaiming_uniform_(self.hidden2.weight, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>        self.act2 = ReLU()<br>        <span class="hljs-comment"># third hidden layer and output</span><br>        self.hidden3 = Linear(<span class="hljs-number">6</span>, <span class="hljs-number">3</span>)<br>        xavier_uniform_(self.hidden3.weight)<br>        self.act3 = Softmax(dim=<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment"># forward propagate input</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, X</span>):<br>        <span class="hljs-comment"># input to first hidden layer</span><br>        X = self.hidden1(X)<br>        X = self.act1(X)<br>        <span class="hljs-comment"># second hidden layer</span><br>        X = self.hidden2(X)<br>        X = self.act2(X)<br>        <span class="hljs-comment"># output layer</span><br>        X = self.hidden3(X)<br>        X = self.act3(X)<br>        <span class="hljs-keyword">return</span> X<br><br><br><span class="hljs-comment"># prepare the dataset</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">prepare_data</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-comment"># load the dataset</span><br>    dataset = CSVDataset(path)<br>    <span class="hljs-comment"># calculate split</span><br>    train, test = dataset.get_splits()<br>    <span class="hljs-comment"># prepare data loaders</span><br>    train_dl = DataLoader(train, batch_size=<span class="hljs-number">1</span>, shuffle=<span class="hljs-literal">True</span>)<br>    test_dl = DataLoader(test, batch_size=<span class="hljs-number">1024</span>, shuffle=<span class="hljs-literal">False</span>)<br>    <span class="hljs-keyword">return</span> train_dl, test_dl<br><br><br><span class="hljs-comment"># train the model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>(<span class="hljs-params">train_dl, model</span>):<br>    <span class="hljs-comment"># define the optimization</span><br>    criterion = CrossEntropyLoss()<br>    <span class="hljs-comment"># optimizer = SGD(model.parameters(), lr=0.01, momentum=0.9)</span><br>    optimizer = Adam(model.parameters())<br>    <span class="hljs-comment"># enumerate epochs</span><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        <span class="hljs-comment"># enumerate mini batches</span><br>        <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_dl):<br>            targets = targets.long()<br>            <span class="hljs-comment"># clear the gradients</span><br>            optimizer.zero_grad()<br>            <span class="hljs-comment"># compute the model output</span><br>            yhat = model(inputs)<br>            <span class="hljs-comment"># calculate loss</span><br>            loss = criterion(yhat, targets)<br>            <span class="hljs-comment"># credit assignment</span><br>            loss.backward()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;epoch: &#123;&#125;, batch: &#123;&#125;, loss: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(epoch, i, loss.data))<br>            <span class="hljs-comment"># update model weights</span><br>            optimizer.step()<br><br><br><span class="hljs-comment"># evaluate the model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_model</span>(<span class="hljs-params">test_dl, model</span>):<br>    predictions, actuals = [], []<br>    <span class="hljs-keyword">for</span> i, (inputs, targets) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_dl):<br>        <span class="hljs-comment"># evaluate the model on the test set</span><br>        yhat = model(inputs)<br>        <span class="hljs-comment"># retrieve numpy array</span><br>        yhat = yhat.detach().numpy()<br>        actual = targets.numpy()<br>        <span class="hljs-comment"># convert to class labels</span><br>        yhat = argmax(yhat, axis=<span class="hljs-number">1</span>)<br>        <span class="hljs-comment"># reshape for stacking</span><br>        actual = actual.reshape((<span class="hljs-built_in">len</span>(actual), <span class="hljs-number">1</span>))<br>        yhat = yhat.reshape((<span class="hljs-built_in">len</span>(yhat), <span class="hljs-number">1</span>))<br>        <span class="hljs-comment"># store</span><br>        predictions.append(yhat)<br>        actuals.append(actual)<br>    predictions, actuals = vstack(predictions), vstack(actuals)<br>    <span class="hljs-comment"># calculate accuracy</span><br>    acc = accuracy_score(actuals, predictions)<br>    <span class="hljs-keyword">return</span> acc<br><br><br><span class="hljs-comment"># make a class prediction for one row of data</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>(<span class="hljs-params">row, model</span>):<br>    <span class="hljs-comment"># convert row to data</span><br>    row = Tensor([row])<br>    <span class="hljs-comment"># make prediction</span><br>    yhat = model(row)<br>    <span class="hljs-comment"># retrieve numpy array</span><br>    yhat = yhat.detach().numpy()<br>    <span class="hljs-keyword">return</span> yhat<br><br><br><span class="hljs-comment"># prepare the data</span><br>path = <span class="hljs-string">&#x27;./data/iris.csv&#x27;</span><br>train_dl, test_dl = prepare_data(path)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(train_dl.dataset), <span class="hljs-built_in">len</span>(test_dl.dataset))<br><span class="hljs-comment"># define the network</span><br>model = MLP(<span class="hljs-number">4</span>)<br><span class="hljs-built_in">print</span>(model)<br><span class="hljs-comment"># train the model</span><br>train_model(train_dl, model)<br><span class="hljs-comment"># evaluate the model</span><br>acc = evaluate_model(test_dl, model)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Accuracy: %.3f&#x27;</span> % acc)<br><span class="hljs-comment"># make a single prediction</span><br>row = [<span class="hljs-number">5.1</span>, <span class="hljs-number">3.5</span>, <span class="hljs-number">1.4</span>, <span class="hljs-number">0.2</span>]<br>yhat = predict(row, model)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Predicted: %s (class=%d)&#x27;</span> % (yhat, argmax(yhat)))<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤šåˆ†ç±»ä»£ç ä¸äºŒåˆ†ç±»ä»£ç å¤§åŒå°å¼‚ï¼Œåœ¨åŠ è½½æ•°æ®é›†ã€æ¨¡å‹ç»“æ„ã€æ¨¡å‹è®­ç»ƒï¼ˆè®­ç»ƒbatchå€¼å–1ï¼‰ä»£ç ä¸Šç•¥æœ‰ä¸åŒã€‚è¿è¡Œä¸Šè¿°ä»£ç ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">105 45<br>MLP(<br>  (hidden1): Linear(in_features=4, out_features=5, bias=True)<br>  (act1): ReLU()<br>  (hidden2): Linear(in_features=5, out_features=6, bias=True)<br>  (act2): ReLU()<br>  (hidden3): Linear(in_features=6, out_features=3, bias=True)<br>  (act3): Softmax(dim=1)<br>)<br>epoch: 0, batch: 0, loss: 1.4808106422424316<br>epoch: 0, batch: 1, loss: 1.4769641160964966<br>epoch: 0, batch: 2, loss: 0.654313325881958<br>......<br>epoch: 99, batch: 102, loss: 0.5514447093009949<br>epoch: 99, batch: 103, loss: 0.620153546333313<br>epoch: 99, batch: 104, loss: 0.5514482855796814<br>Accuracy: 0.933<br>Predicted: [[9.9999809e-01 1.8837408e-06 2.4509615e-19]] (class=0)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥MLPæ¨¡å‹çš„æœ€ç»ˆè®­ç»ƒlosså€¼ä¸º0.5514ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„Accuracyä¸º0.933ï¼Œåœ¨æ–°æ•°æ®ä¸Šé¢„æµ‹å®Œå…¨æ­£ç¡®ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»çš„æ¨¡å‹ä»£ç å·²å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼š<a href="https://github.com/percent4/PyTorch_Learning">https://github.com/percent4/PyTorch_Learning</a>ã€‚åç»­å°†æŒç»­ä»‹ç»PyTorchå†…å®¹ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨~</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchå…¥é—¨ï¼ˆä¸€ï¼‰å‘é‡</title>
    <link href="/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E5%90%91%E9%87%8F/"/>
    <url>/2023/07/30/PyTorch%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E5%90%91%E9%87%8F/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ä»€ä¹ˆæ˜¯PyTorchï¼Ÿ">ä»€ä¹ˆæ˜¯PyTorchï¼Ÿ</h3><p><img src="/img/pytorch1_1.png" alt=""></p><p>PyTorchæ˜¯Facebookäººå·¥æ™ºèƒ½å›¢é˜Ÿå¼€å‘çš„ä¸€ä¸ªæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ å·¥å…·ï¼Œç”¨äºå¤„ç†å¤§è§„æ¨¡å›¾åƒåˆ†æï¼ŒåŒ…æ‹¬ç‰©ä½“æ£€æµ‹ï¼Œåˆ†å‰²ä¸åˆ†ç±»ã€‚ä½†æ˜¯å®ƒçš„åŠŸèƒ½ä¸ä»…é™äºæ­¤ã€‚å®ƒä¸å…¶å®ƒæ·±åº¦å­¦ä¹ æ¡†æ¶ç»“åˆï¼Œèƒ½å¤Ÿå®Œæˆå¤æ‚çš„ç®—æ³•ã€‚PyTorchç”¨Pythonå’ŒC++ç¼–å†™ã€‚</p><p>PyTorchå±äºæ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­çš„é‡è¦ä¸€å‘˜ï¼Œä¸TensorFlow, Keras, Theanoç­‰å…¶å®ƒæ·±åº¦å­¦ä¹ æ¡†æ¶ä¸åŒï¼Œå®ƒæ˜¯åŠ¨æ€è®¡ç®—å›¾æ¨¡å¼ï¼Œå…¶åº”ç”¨æ¨¡å‹æ”¯æŒåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ ¹æ®è¿è¡Œå‚æ•°åŠ¨æ€æ”¹å˜ï¼Œè€Œå…¶å®ƒæ¡†æ¶éƒ½æ˜¯é™æ€è®¡ç®—å›¾æ¨¡å¼ï¼Œå…¶æ¨¡å‹åœ¨è¿è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šã€‚ä»¥ä¸‹æ˜¯å„ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶çš„çƒ­åº¦å¯¹æ¯”:</p><p><img src="/img/pytorch1_2.png" alt=""></p><p>å…³äºå„ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶çš„å¯¹æ¯”ï¼Œå¯ä»¥å‚è€ƒç½‘å€ï¼š<a href="https://en.wikipedia.org/wiki/Comparison_of_deep_learning_software">Comparison of deep learning software</a><br>ã€‚</p><p>PyTorchæ˜¯ä½¿ç”¨GPUå’ŒCPUä¼˜åŒ–çš„æ·±åº¦å­¦ä¹ å¼ é‡åº“ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä¸€èµ·æ¥å­¦ä¹ PyTorchä¸­å‘é‡ï¼ˆTensorï¼‰çš„ç›¸å…³æ“ä½œã€‚</p><h3 id="å®‰è£…ä¸è¿è¡Œ">å®‰è£…ä¸è¿è¡Œ</h3><p>PyTorchçš„å®‰è£…ååˆ†ç®€å•ï¼Œéœ€è¦ç”¨pipå®‰è£…å³å¯ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip3 <span class="hljs-keyword">install</span> torch<br>pip3 <span class="hljs-keyword">install</span> torchvision<br></code></pre></td></tr></table></figure><p>å…¶ä¸­torchvisionåŒ…å«äº†ä¸€äº›torchå†…ç½®çš„å›¾ç‰‡ä¸è§†é¢‘æ•°æ®é›†ã€‚</p><p>ç”¨ä»¥ä¸‹çš„Pythonä»£ç å¯ä»¥è¾“å‡ºå®‰è£…çš„PyTorchç‰ˆæœ¬ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-built_in">print</span>(torch.version.__version__)<br></code></pre></td></tr></table></figure><p>åœ¨ç¬”è€…çš„ç”µè„‘ä¸Šï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>.post2<br></code></pre></td></tr></table></figure><h3 id="å‘é‡çš„åŸºæœ¬æ“ä½œ">å‘é‡çš„åŸºæœ¬æ“ä½œ</h3><h5 id="å¯¼å…¥æ¨¡å—">å¯¼å…¥æ¨¡å—</h5><p><img src="/img/pytorch1_3.png" alt="å¯¼å…¥æ¨¡å—"></p><h5 id="æ£€æµ‹æ˜¯å¦ä¸ºPyTorchä¸­çš„å‘é‡">æ£€æµ‹æ˜¯å¦ä¸ºPyTorchä¸­çš„å‘é‡</h5><p>is_tensor()å‡½æ•°å¯ä»¥æ£€æµ‹æŸä¸ªåºåˆ—æ˜¯å¦ä¸ºPyTorchä¸­çš„å‘é‡ï¼Œis_storage()å¯ä»¥æ£€æµ‹æŸä¸ªåºåˆ—æ˜¯å¦è¢«å­˜å‚¨ä¸ºPyTorchä¸­çš„å‘é‡ã€‚</p><p><img src="/img/pytorch1_4.png" alt="å‘é‡æ£€æµ‹"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒPythonä¸­çš„åˆ—è¡¨å¹¶ä¸æ˜¯PyTorchä¸­çš„å‘é‡ï¼Œä¹Ÿä¸ä¼šè¢«å­˜å‚¨ä¸ºPyTorchä¸­çš„å‘é‡ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åˆ›å»ºPyTorchä¸­çš„å‘é‡å‘¢ï¼Ÿ</p><h5 id="åˆ›å»ºéšæœºå‘é‡">åˆ›å»ºéšæœºå‘é‡</h5><p>åˆ©ç”¨randn()å‡½æ•°å¯ä»¥åˆ›å»ºéšæœºå‘é‡ï¼Œéšæœºæ•°ä¸º0~1çš„éšæœºæµ®ç‚¹æ•°ï¼Œå¯ä»¥æŒ‡å®šåˆ›å»ºçš„å‘é‡çš„ç»´æ•°ã€‚</p><p><img src="/img/pytorch1_5.png" alt="åˆ›å»ºéšæœºå‘é‡"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ›å»ºäº†1*2*3ç»´çš„å‘é‡ï¼Œç”¨size()å‡½æ•°å¯ä»¥æŸ¥çœ‹å‘é‡çš„ç»´æ•°æƒ…å†µï¼Œç”¨numel()å‡½æ•°å¯ä»¥æŸ¥çœ‹å‘é‡ä¸­çš„æ‰€æœ‰å…ƒç´ ä¸ªæ•°ã€‚</p><h5 id="åˆ›å»ºé›¶å‘é‡">åˆ›å»ºé›¶å‘é‡</h5><p>åˆ©ç”¨zeros()å‡½æ•°å¯ä»¥åˆ›å»ºé›¶å‘é‡ï¼Œå³æ‰€æœ‰å…ƒç´ å‡ä¸ºé›¶çš„å‘é‡ï¼Œåªéœ€æŒ‡å®šå‘é‡çš„ç»´æ•°å³å¯ã€‚</p><p><img src="/img/pytorch1_6.png" alt="åˆ›å»ºé›¶å‘é‡"></p><p>åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬åˆ›å»ºäº†4*4çš„é›¶å‘é‡ã€‚</p><h5 id="åˆ›å»ºå•ä½å‘é‡">åˆ›å»ºå•ä½å‘é‡</h5><p>åˆ©ç”¨eye()å‡½æ•°å¯ä»¥åˆ›å»ºå•ä½å‘é‡ï¼Œå³ä¸»å¯¹è§’å…ƒç´ ä¸º1ï¼Œå…¶ä½™å…ƒç´ å‡ä¸ºé›¶çš„å‘é‡ï¼Œåªéœ€æŒ‡å®šå‘é‡çš„ç»´æ•°å³å¯ã€‚å½“äºŒç»´å‘é‡çš„è¡Œæ•°ä¸åˆ—æ•°ä¸ä¸€æ ·æ—¶ï¼Œä¸»å¯¹è§’å…ƒç´ ä¸º1ï¼Œå…¶ä½™ä¸º0ã€‚</p><p><img src="/img/pytorch1_7.png" alt="åˆ›å»ºå•ä½å‘é‡"></p><h5 id="ä»numpyä¸­åˆ›å»ºå‘é‡">ä»numpyä¸­åˆ›å»ºå‘é‡</h5><p>PyTorchæ”¯æŒç›´æ¥ä»numpyä¸­åˆ›å»ºå‘é‡ï¼Œè¿™ä¸ºPyTorchå’Œnumpyæä¾›äº†æ— ç¼å¯¹æ¥ï¼Œè¿™ä¹Ÿæ˜¯PyTorchçš„ä¸€ä¸ªä¼˜åŠ¿ã€‚</p><p><img src="/img/pytorch1_8.png" alt="ä»numpyç›´æ¥åˆ›å»ºå‘é‡"></p><p>å½“ç„¶ï¼ŒPyTorchä¹Ÿå¯ä»¥å°†å‘é‡è½¬åŒ–ä¸ºnumpyä¸­çš„ndarrays.</p><p><img src="/img/pytorch1_9.png" alt="å‘é‡è½¬åŒ–ä¸ºnumpy.ndarrays"></p><h5 id="Tensorå‡½æ•°åˆ›å»ºå‘é‡">Tensorå‡½æ•°åˆ›å»ºå‘é‡</h5><p>å¯ä»¥åˆ©ç”¨Tensor()ç›´æ¥åˆ›å»ºå‘é‡ã€‚</p><p><img src="/img/pytorch1_10.png" alt="Tensorå‡½æ•°"></p><h5 id="linspaceä¸logspaceåˆ›å»ºå‘é‡">linspaceä¸logspaceåˆ›å»ºå‘é‡</h5><p>linspace(tart, end, steps=100, out=None)é€šè¿‡æŒ‡å®šå¼€å§‹å€¼ã€ç»ˆå€¼å’Œå…ƒç´ ä¸ªæ•°åˆ›å»ºè¡¨ç¤ºç­‰å·®æ•°åˆ—çš„ä¸€ç»´æ•°ç»„ï¼Œå¯ä»¥é€šè¿‡endpointå‚æ•°æŒ‡å®šæ˜¯å¦åŒ…å«ç»ˆå€¼ï¼Œé»˜è®¤å€¼ä¸ºTrueï¼Œå³åŒ…å«ç»ˆå€¼ã€‚</p><p>logspace(tart, end, steps=100, out=None)è¿”å›ä¸€ä¸ª1ç»´å¼ é‡ï¼ŒåŒ…å«åœ¨åŒºé—´10exp(start)å’Œ10exp(end)ä¸Šä»¥å¯¹æ•°åˆ»åº¦å‡åŒ€é—´éš”çš„ stepsä¸ªç‚¹ã€‚</p><p><img src="/img/pytorch1_11.png" alt="linspace() &amp; logspace()"></p><h5 id="åˆ›å»ºå‡åŒ€åˆ†å¸ƒå‘é‡">åˆ›å»ºå‡åŒ€åˆ†å¸ƒå‘é‡</h5><p>rand()å‡½æ•°å¯ä»¥åˆ›å»ºæŒ‡å®šç»´æ•°çš„æ»¡è¶³å‡åŒ€åˆ†å¸ƒçš„å‘é‡ã€‚</p><p><img src="/img/pytorch1_12.png" alt="rand()"></p><h5 id="éšæœºæ•´æ•°æ’åˆ—å‘é‡">éšæœºæ•´æ•°æ’åˆ—å‘é‡</h5><p>randperm(n, out=None) ,ç»™å®šå‚æ•°nï¼Œè¿”å›ä¸€ä¸ªä»0 åˆ°n -1 çš„éšæœºæ•´æ•°æ’åˆ—ã€‚</p><p><img src="/img/pytorch1_13.png" alt="randperm()"></p><h5 id="ç­‰å·®æ•°åˆ—å‘é‡">ç­‰å·®æ•°åˆ—å‘é‡</h5><p>arange(start, end, step=1, out=None) , è¿”å›ä¸€ä¸ª1ç»´å¼ é‡ï¼ŒåŒ…å«ä»startåˆ°endï¼Œä»¥stepä¸ºæ­¥é•¿çš„ä¸€ç»„åºåˆ—å€¼(é»˜è®¤æ­¥é•¿ä¸º1)ã€‚</p><p><img src="/img/pytorch1_14.png" alt="arange()"></p><h5 id="å¯»æ‰¾æœ€å¤§å€¼ã€æœ€å°ç»„">å¯»æ‰¾æœ€å¤§å€¼ã€æœ€å°ç»„</h5><p>argmin()å’Œargmax()å‡½æ•°å¯ä»¥å¯»æ‰¾å‘é‡æ‰€åœ¨çš„æœ€å°å€¼å’Œæœ€å¤§å€¼çš„ä¸‹æ ‡ï¼Œ0è¡¨ç¤ºæ²¿ç€è¡ŒæŸ¥æ‰¾ï¼Œ1è¡¨ç¤ºæ²¿ç€åˆ—æŸ¥æ‰¾ã€‚</p><p><img src="/img/pytorch1_15.png" alt="argmin(), argmax()"></p><h5 id="å‘é‡æ‹¼æ¥">å‘é‡æ‹¼æ¥</h5><p>cat()å‡½æ•°åœ¨ç»™å®šç»´åº¦ä¸Šå¯¹è¾“å…¥çš„å¼ é‡åºåˆ—seq è¿›è¡Œè¿æ¥æ“ä½œï¼Œé»˜è®¤çš„ç»´åº¦ä¸º0ï¼Œå³æŒ‰è¡Œæ‹¼æ¥ã€‚</p><p><img src="/img/pytorch1_16.png" alt="cat()"></p><h6 id="å‘é‡åˆ†å—">å‘é‡åˆ†å—</h6><p>chunk(tensor, chunks, dim=0)å‡½æ•°åœ¨ç»™å®šç»´åº¦(è½´)ä¸Šå°†è¾“å…¥å¼ é‡è¿›è¡Œåˆ†å—ï¼Œé»˜è®¤ä¸º0ï¼Œå³æŒ‰è¡Œè¿›è¡Œåˆ†å—ã€‚</p><p><img src="/img/pytorch1_25.png" alt="chunk()"></p><h5 id="gather-å‡½æ•°">gather()å‡½æ•°</h5><p>gather(input, dim, index, out=None), æ²¿ç»™å®šè½´dimï¼Œå°†è¾“å…¥ç´¢å¼•å¼ é‡indexæŒ‡å®šä½ç½®çš„å€¼è¿›è¡Œèšåˆã€‚gather()å‡½æ•°ç†è§£èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œå…ˆçœ‹ä¾‹å­ï¼Œå†è§£é‡Šï¼š</p><p><img src="/img/pytorch1_17.png" alt="gather()"></p><p>gatherçš„ä½œç”¨æ˜¯è¿™æ ·çš„ï¼Œindexæ˜¯ç´¢å¼•ï¼Œå…·ä½“æ˜¯è¡Œè¿˜æ˜¯åˆ—çš„ç´¢å¼•è¦çœ‹å‰é¢dim ï¼Œæ¯”å¦‚å¯¹äºæˆ‘ä»¬çš„ä¾‹å­, [[11, 12], [23, 24]], æŒ‡å®šdim=1ï¼Œä¹Ÿå°±æ˜¯æ¨ªå‘ï¼Œé‚£ä¹ˆç´¢å¼•å°±æ˜¯åˆ—å·ã€‚indexçš„å¤§å°å°±æ˜¯è¾“å‡ºçš„å¤§å°ï¼Œæ‰€ä»¥æ¯”å¦‚indexæ˜¯[[0,0], [1,0]]ï¼Œé‚£ä¹ˆçœ‹indexç¬¬ä¸€è¡Œï¼Œ0åˆ—æŒ‡çš„æ˜¯11ï¼ŒåŒç†ï¼Œç¬¬äºŒè¡Œä¸º1, 0 , è¿™æ ·å°±æ˜¯[24, 23]ï¼Œå‚è€ƒè¿™æ ·çš„è§£é‡Šçœ‹ä¸Šé¢çš„è¾“å‡ºç»“æœï¼Œå³å¯ç†è§£gatherçš„å«ä¹‰ã€‚</p><h5 id="ç´¢å¼•">ç´¢å¼•</h5><p>index_select(input, dim, index, out=None) ï¼Œæ²¿ç€æŒ‡å®šç»´åº¦å¯¹è¾“å…¥è¿›è¡Œåˆ‡ç‰‡ï¼Œå–indexä¸­æŒ‡å®šçš„ç›¸åº”é¡¹(indexä¸ºä¸€ä¸ªLongTensor)ï¼Œç„¶åè¿”å›åˆ°ä¸€ä¸ªæ–°çš„å¼ é‡ï¼Œè¿”å›çš„å¼ é‡ä¸åŸå§‹å¼ é‡_Tensor_æœ‰ç›¸åŒçš„ç»´åº¦(åœ¨æŒ‡å®šè½´ä¸Š)ã€‚</p><p><img src="/img/pytorch1_18.png" alt="index_select()"></p><h5 id="split-å‡½æ•°">split()å‡½æ•°</h5><p>split(tensor, split_size, dim=0), å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç›¸ç­‰å½¢çŠ¶çš„chunksï¼ˆå¦‚æœå¯åˆ†ï¼‰ã€‚ å¦‚æœæ²¿æŒ‡å®šç»´çš„å¼ é‡å½¢çŠ¶å¤§å°ä¸èƒ½è¢«split_sizeæ•´åˆ†ï¼Œ åˆ™æœ€åä¸€ä¸ªåˆ†å—ä¼šå°äºå…¶å®ƒåˆ†å—ã€‚</p><p><img src="/img/pytorch1_19.png" alt="split()"></p><h6 id="å‘é‡è½¬ç½®">å‘é‡è½¬ç½®</h6><p>äºŒç»´å‘é‡çš„è½¬ç½®å¯ä»¥ç”¨t()æˆ–transpos(1, 0)å®ç°ã€‚</p><p><img src="/img/pytorch1_20.png" alt="å‘é‡è½¬ç½®"></p><h5 id="unbind">unbind()</h5><p>unbind(tensor, dim=0), ç§»é™¤æŒ‡å®šç»´åï¼Œè¿”å›ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«äº†æ²¿ç€æŒ‡å®šç»´åˆ‡ç‰‡åçš„å„ä¸ªåˆ‡ç‰‡ï¼Œé»˜è®¤ç»´åº¦ä¸º1ï¼Œè¡¨ç¤ºè¡Œï¼Œ1è¡¨ç¤ºåˆ—ã€‚</p><p><img src="/img/pytorch1_21.png" alt="unbind()"></p><h5 id="åˆ¤æ–­æ˜¯å¦ä¸ºé›¶å…ƒç´ ">åˆ¤æ–­æ˜¯å¦ä¸ºé›¶å…ƒç´ </h5><p>nonzero()å‡½æ•°å¯ä»¥åˆ¤æ–­å‘é‡ä¸­çš„å…ƒç´ æ˜¯å¦ä¸º0.</p><p><img src="/img/pytorch1_22.png" alt="nonzero()"></p><h5 id="å‘é‡è¿ç®—">å‘é‡è¿ç®—</h5><p>ä»¥ä¸‹å°†æ¼”ç¤ºå‡ ç§å¸¸è§çš„çŸ©é˜µè¿ç®—ã€‚</p><p><img src="/img/pytorch1_23.png" alt="çŸ©é˜µè¿ç®—"></p><p>çŸ©é˜µçš„ç‚¹ä¹˜ä¸çŸ©é˜µä¹˜æ³•</p><p><img src="/img/pytorch1_24.png" alt="çŸ©é˜µç‚¹ä¹˜ä¸çŸ©é˜µä¹˜æ³•"></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡çš„githubåœ°å€ä¸ºï¼š<a href="https://github.com/percent4/PyTorch_Learning/blob/master/pytorch_tensor_demo.ipynb">https://github.com/percent4/PyTorch_Learning/blob/master/pytorch_tensor_demo.ipynb</a> ã€‚</p><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼š NLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨~</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å­¦ä¹ æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorch</tag>
      
      <tag>å‘é‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åä¸‰ï¼‰ä½¿ç”¨Baichuan-7bæ¨¡å‹å¾®è°ƒäººç‰©å…³ç³»åˆ†ç±»ä»»åŠ¡</title>
    <link href="/2023/07/29/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%89%EF%BC%89%E4%BD%BF%E7%94%A8Baichuan-7b%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/07/29/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%89%EF%BC%89%E4%BD%BF%E7%94%A8Baichuan-7b%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ä»»åŠ¡ä»‹ç»">ä»»åŠ¡ä»‹ç»</h3><p>äººç‰©å…³ç³»åˆ†ç±»æŒ‡çš„æ˜¯å¯¹æ–‡æœ¬ä¸­çš„ä¸¤ä¸ªäººç‰©ï¼Œåœ¨ç‰¹å®šçš„å…³ç³»åˆ—è¡¨ä¸­ï¼Œåˆ¤æ–­ä»–ä»¬ä¹‹é—´çš„äººç‰©å…³ç³»ã€‚ä»¥æ ·æœ¬<code>äº²æˆš 1837å¹´6æœˆ20æ—¥ï¼Œå¨å»‰å››ä¸–è¾ä¸–ï¼Œä»–çš„ä¾„å¥³ç»´å¤šåˆ©äºšå³ä½ã€‚</code>ä¸ºä¾‹ï¼Œå…¶ä¸­<code>äº²æˆš</code>ä¸ºäººç‰©å…³ç³»ï¼Œ<code>å¨å»‰å››ä¸–</code>ä¸ºå®ä½“1ï¼Œ<code>ç»´å¤šåˆ©äºš</code>ä¸ºå®ä½“2ã€‚</p><p>ç¬”è€…è‡ªå·±åˆ©ç”¨ä¸šä½™æ—¶é—´æ ‡æ³¨çš„æ ·æœ¬æ•°æ®æœ‰3881æ¡ï¼Œåˆ†å¸ƒå¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp42_1.png" alt="äººç‰©å…³ç³»åˆ†å¸ƒå›¾" /><figcaption aria-hidden="true">äººç‰©å…³ç³»åˆ†å¸ƒå›¾</figcaption></figure><p>å¯¹ä¸Šè¿°æ•°æ®é›†è¿›è¡Œåˆ’åˆ†ï¼Œè®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„æ¯”ä¾‹ä¸º8:2ï¼Œå…¶ä¸­è®­ç»ƒé›†3105æ¡ï¼Œæµ‹è¯•é›†776æ¡ã€‚</p><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98/">NLPï¼ˆäºŒåä¸€ï¼‰äººç‰©å…³ç³»æŠ½å–çš„ä¸€æ¬¡å®æˆ˜</a>ä¸­ï¼Œå½“æ—¶çš„æ ‡æ³¨æ•°æ®ä¸º2900å¤šæ¡ï¼Œä½¿ç”¨BERTå‘é‡æå–+BiGRU+Attentionæ¨¡å‹ï¼Œå–å¾—çš„å¹³å‡F1å€¼ä¸º78.97%.</p><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E7%9A%84%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95/">NLPï¼ˆå››åäºŒï¼‰äººç‰©å…³ç³»åˆ†ç±»çš„å†æ¬¡å°è¯•</a>ä¸­ï¼Œå€ŸåŠ©BERTå¾®è°ƒï¼ˆå½“ä½œåˆ†ç±»ä»»åŠ¡ï¼‰ï¼Œå–å¾—çš„å¹³å‡F1å€¼ä¸º82.69%.</p><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%94%EF%BC%89R-BERT%E5%9C%A8%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E4%B8%8A%E7%9A%84%E5%B0%9D%E8%AF%95%E5%8F%8AKeras%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%8E%B0/">NLPï¼ˆå››åäº”ï¼‰R-BERTåœ¨äººç‰©å…³ç³»åˆ†ç±»ä¸Šçš„å°è¯•åŠKerasä»£ç å¤ç°</a>ä¸­ï¼Œå€ŸåŠ©ä¸“ç”¨äºå…³ç³»åˆ†ç±»ä»»åŠ¡çš„R-BERTæ¨¡å‹ï¼Œåœ¨ChineseRobertaæ¨¡å‹ä¸Šå–å¾—çš„F1å€¼ä¸º85.35%.</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œå°†å°è¯•ä½¿ç”¨å¤§æ¨¡å‹ï¼ˆLarge Language Model,LLMï¼‰ä¸­çš„ä¸­æ–‡æ¨¡å‹ä»£è¡¨Baichuan-7b,å¯¹äººç‰©å…³ç³»åˆ†ç±»ä»»åŠ¡è¿›è¡Œå¾®è°ƒï¼Œçœ‹çœ‹å®ƒçš„è¡¨ç°ã€‚</p><h3 id="å¥½çš„æç¤º">å¥½çš„æç¤º</h3><p>åœ¨å¼€å§‹æ¨¡å‹å¾®è°ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¥½çš„æç¤ºï¼ˆPromptï¼‰ï¼Œæˆ‘ä»¬å€ŸåŠ©GPT-4ï¼š</p><figure><img src="/img/nlp63_1.png" alt="GPT-4ç»™å‡ºçš„å…³äºå…³ç³»åˆ†ç±»çš„Prompt" /><figcaptionaria-hidden="true">GPT-4ç»™å‡ºçš„å…³äºå…³ç³»åˆ†ç±»çš„Prompt</figcaption></figure><p>åˆ«å°çœ‹äº†Promptçš„å¨åŠ›ï¼Œç¬”è€…åœ¨ä½¿ç”¨å¾®è°ƒæ¨¡å‹è¿‡ç¨‹ä¸­ï¼Œå‘ç°è‡ªå·±å†™çš„Promptä¸GPT-4ç»™å‡ºçš„Promptï¼Œåœ¨è®­ç»ƒç»“æœF1å€¼ä¸Šå¯èƒ½ç›¸å·®3-4%ã€‚å¯è§Promptå·¥ç¨‹çš„é‡è¦æ€§ï¼</p><h3 id="æ¨¡å‹å¾®è°ƒ">æ¨¡å‹å¾®è°ƒ</h3><p>æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°Promptï¼ŒåŠ å·¥æ•°æ®é›†ï¼ˆå½“ä½œå¤šè½®å¯¹è¯ä»»åŠ¡ï¼‰ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;conversation_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;category&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;relation classification&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;conversation&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;human&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç»™å®šä»¥ä¸‹æ ‡ç­¾ï¼š[&#x27;ä¸ç¡®å®š&#x27;, &#x27;å¤«å¦»&#x27;, &#x27;çˆ¶æ¯&#x27;, &#x27;å…„å¼Ÿå§å¦¹&#x27;, &#x27;ä¸Šä¸‹çº§&#x27;, &#x27;å¸ˆç”Ÿ&#x27;, &#x27;å¥½å‹&#x27;, &#x27;åŒå­¦&#x27;, &#x27;åˆä½œ&#x27;, &#x27;åŒä¸€ä¸ªäºº&#x27;, &#x27;æƒ…ä¾£&#x27;, &#x27;ç¥–å­™&#x27;, &#x27;åŒé—¨&#x27;, &#x27;äº²æˆš&#x27;]ï¼Œè¯·åœ¨ä»¥ä¸‹å¥å­ä¸­åˆ†æå¹¶åˆ†ç±»å®ä½“ä¹‹é—´çš„å…³ç³»ï¼š&#x27;ä¸ææºæ¾„è®ºæˆ´ä¸œåŸä¹¦&#x27;åœ¨è¿™ä¸ªå¥å­ä¸­ï¼Œæˆ´ä¸œåŸå’Œææºæ¾„ä¹‹é—´çš„å…³ç³»åº”è¯¥å±äºå“ªä¸ªæ ‡ç­¾ï¼Ÿ&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;assistant&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸çŸ¥é“&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Fireflyæ¡†æ¶è¿›è¡Œæ¨¡å‹å¾®è°ƒï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://github.com/yangjianxin1/Firefly">https://github.com/yangjianxin1/Firefly</a>.æœ¬æ–‡åŸºäºBaichuan-7bä¸ºåŸºåº§æ¨¡å‹ï¼Œé‡‡ç”¨QLoraæ–¹å¼è®­ç»ƒï¼Œè®­ç»ƒå‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;output_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;output/firefly-baichuan-7b-people&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;model_name_or_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/test/baichun_7b&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;train_file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./data/train.jsonl&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;num_train_epochs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;per_device_train_batch_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gradient_accumulation_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;learning_rate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2e-4</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;max_seq_length&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">256</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;logging_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_total_limit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lr_scheduler_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;constant_with_warmup&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;warmup_steps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_rank&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">64</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_alpha&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lora_dropout&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.05</span><span class="hljs-punctuation">,</span><br><br>    <span class="hljs-attr">&quot;gradient_checkpointing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;disable_tqdm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;optim&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;paged_adamw_32bit&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fp16&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;report_to&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tensorboard&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dataloader_num_workers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;save_strategy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;steps&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;weight_decay&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;max_grad_norm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;remove_unused_columns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤è¡Œ<code>torchrun --nproc_per_node=2 train_qlora.py --train_args_file train_args/qlora/baichuan-7b-sft-qlora.json</code>è¿›è¡Œè®­ç»ƒï¼Œè®­ç»ƒæ—¶é—´å¤§çº¦20åˆ†é’Ÿï¼Œæœ€ç»ˆçš„trainlossä¸º0.0273ã€‚</p><p>åœ¨Fireflyæ¡†æ¶ä¸­è®¾ç½®å¥½merge_lora.pyä¸­çš„æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼Œå°†adapterçš„æƒé‡ä¸Baichuan-7bæ¨¡å‹åˆå¹¶ï¼Œåˆå¹¶å¾—åˆ°æ–°æ–‡ä»¶<code>firefly-baichuan-7b-people-merge</code>ã€‚</p><p>åœ¨Fireflyæ¡†æ¶ï¼Œä»¿é€ script/chat/single_chat.pyæ–‡ä»¶ï¼Œå°†å…¶æ”¹å†™æˆAPIè°ƒç”¨æ–¹å¼çš„æ–‡ä»¶single_chat_server.pyï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @place: Pudong, Shanghai</span><br><span class="hljs-comment"># @file: single_chat_server.py</span><br><span class="hljs-comment"># @time: 2023/7/25 22:27</span><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-comment"># å•è½®å¯¹è¯webæœåŠ¡</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify<br><br>app = Flask(<span class="hljs-string">&quot;single_chat_server&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/people_rel_cls&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict</span>():<br>    req_dict = request.json<br>    text, people1, people2 = req_dict[<span class="hljs-string">&quot;text&quot;</span>], req_dict[<span class="hljs-string">&quot;people1&quot;</span>], req_dict[<span class="hljs-string">&quot;people2&quot;</span>]<br>    text = text.strip()<br>    content = <span class="hljs-string">f&quot;ç»™å®šä»¥ä¸‹æ ‡ç­¾ï¼š[&#x27;ä¸ç¡®å®š&#x27;, &#x27;å¤«å¦»&#x27;, &#x27;çˆ¶æ¯&#x27;, &#x27;å…„å¼Ÿå§å¦¹&#x27;, &#x27;ä¸Šä¸‹çº§&#x27;, &#x27;å¸ˆç”Ÿ&#x27;, &#x27;å¥½å‹&#x27;, &#x27;åŒå­¦&#x27;, &quot;</span> \<br>              <span class="hljs-string">f&quot;&#x27;åˆä½œ&#x27;, &#x27;åŒä¸€ä¸ªäºº&#x27;, &#x27;æƒ…ä¾£&#x27;, &#x27;ç¥–å­™&#x27;, &#x27;åŒé—¨&#x27;, &#x27;äº²æˆš&#x27;]ï¼Œ&quot;</span> \<br>              <span class="hljs-string">f&quot;è¯·åœ¨ä»¥ä¸‹å¥å­ä¸­åˆ†æå¹¶åˆ†ç±»å®ä½“ä¹‹é—´çš„å…³ç³»ï¼š&#x27;<span class="hljs-subst">&#123;text&#125;</span>&#x27;&quot;</span> \<br>              <span class="hljs-string">f&quot;åœ¨è¿™ä¸ªå¥å­ä¸­ï¼Œ<span class="hljs-subst">&#123;people1&#125;</span>å’Œ<span class="hljs-subst">&#123;people2&#125;</span>ä¹‹é—´çš„å…³ç³»åº”è¯¥å±äºå“ªä¸ªæ ‡ç­¾ï¼Ÿ&quot;</span><br>    <span class="hljs-built_in">print</span>(content)<br>    input_ids = tokenizer(content, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>, add_special_tokens=<span class="hljs-literal">False</span>).input_ids.to(device)<br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        outputs = model.generate(<br>            input_ids=input_ids, max_new_tokens=max_new_tokens, do_sample=<span class="hljs-literal">True</span>,<br>            top_p=top_p, temperature=temperature, repetition_penalty=repetition_penalty,<br>            eos_token_id=tokenizer.eos_token_id<br>        )<br>    outputs = outputs.tolist()[<span class="hljs-number">0</span>][<span class="hljs-built_in">len</span>(input_ids[<span class="hljs-number">0</span>]):]<br>    response = tokenizer.decode(outputs)<br>    <span class="hljs-built_in">print</span>(outputs, response)<br>    response = response.strip().replace(text, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&#x27;&lt;/s&gt;&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&#x27;&lt;s&gt;&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>).strip()<br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;result&quot;</span>: response&#125;)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    model_name = <span class="hljs-string">&quot;/home/test/Firefly/script/checkpoint/firefly-baichuan-7b-people-merge&quot;</span><br>    max_new_tokens = <span class="hljs-number">5</span><br>    top_p = <span class="hljs-number">0.9</span><br>    temperature = <span class="hljs-number">0.01</span><br>    repetition_penalty = <span class="hljs-number">1.0</span><br>    device = <span class="hljs-string">&#x27;cuda:0&#x27;</span><br>    input_pattern = <span class="hljs-string">&#x27;&lt;s&gt;&#123;&#125;&lt;/s&gt;&#x27;</span><br>    model = AutoModelForCausalLM.from_pretrained(<br>        model_name,<br>        trust_remote_code=<span class="hljs-literal">True</span>,<br>        low_cpu_mem_usage=<span class="hljs-literal">True</span>,<br>        torch_dtype=torch.float16,<br>    ).to(device).<span class="hljs-built_in">eval</span>()<br>    tokenizer = AutoTokenizer.from_pretrained(<br>        model_name,<br>        trust_remote_code=<span class="hljs-literal">True</span>,<br>        <span class="hljs-comment"># llamaä¸æ”¯æŒfast</span><br>        use_fast=<span class="hljs-literal">False</span> <span class="hljs-keyword">if</span> model.config.model_type == <span class="hljs-string">&#x27;llama&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">True</span><br>    )<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;model loaded!&quot;</span>)<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">5000</span>, threaded=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨APIè°ƒç”¨æ–¹å¼å¯ä»¥å¯¹æµ‹è¯•é›†è¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚</p><h3 id="ç»“æœæ¯”å¯¹">ç»“æœæ¯”å¯¹</h3><p>ä¸åŒæ¨¡å‹ï¼ˆåŒ…æ‹¬BERTæ—¶ä»£å‰åçš„æ¨¡å‹æ–¹æ³•ï¼‰çš„è¯„ä¼°ç»“æœï¼ˆå‡ä¸ºå½“æ—¶æ¨¡å‹çš„SOTAç»“æœæˆ–æ¥è¿‘SOTAç»“æœï¼‰å¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹æ–¹æ³•</th><th>åŸºåº§æ¨¡å‹</th><th>F1å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr class="odd"><td>BERTå‘é‡æå–+BiGRU+Attention</td><td>BiGRU+Attention</td><td>78.97%</td><td>BERTæ¨¡å‹ä½œä¸ºç‰¹å¾æå–å¤„ç†</td></tr><tr class="even"><td>BERT cls finetuning</td><td>BERT</td><td>82.69%</td><td>å½“ä½œæ–‡æœ¬åˆ†ç±»ä»»åŠ¡å¤„ç†</td></tr><tr class="odd"><td>R-BERT</td><td>chinese-roberta-wwm-ext</td><td>85.35%</td><td>BERTæ—¶ä»£çš„å…³ç³»åˆ†ç±»æ¨¡å‹ä»£è¡¨</td></tr><tr class="even"><td>R-BERT</td><td>chinese-roberta-wwm-ext-large</td><td>87.22%</td><td>BERTæ—¶ä»£çš„å…³ç³»åˆ†ç±»æ¨¡å‹ä»£è¡¨</td></tr><tr class="odd"><td>QLora</td><td>Baichuan-7b</td><td>88.25%</td><td>å…¶å®ƒå‚æ•°ä¸Šæ–‡ç»™å‡ºï¼Œepoch=5</td></tr><tr class="even"><td>QLora</td><td>Baichuan-7b</td><td>89.15%</td><td>å…¶å®ƒå‚æ•°ä¸Šæ–‡ç»™å‡ºï¼Œepoch=10</td></tr></tbody></table><h3 id="å­˜åœ¨é—®é¢˜">å­˜åœ¨é—®é¢˜</h3><p>åœ¨å¤§æ¨¡å‹æ—¶ä»£ä¸­ï¼Œå¤§æ¨¡å‹çªç ´äº†ä»¥å‰NLPä»»åŠ¡çš„èŒƒç•´ï¼Œèµ°å‘äº†æ›´åŠ é€šç”¨åŒ–ï¼Œä»ä¸Šè¿°ç»“æœä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸éš¾å‘ç°ï¼Œå¤§æ¨¡å‹ï¼ˆBaichuan-7bï¼‰åœ¨ä¼ ç»Ÿçš„NLPä»»åŠ¡ï¼ˆå¦‚ç¬”è€…è‡ªå·±çš„äººç‰©å…³ç³»æ•°æ®é›†ï¼‰ä¸Šå–å¾—äº†æ›´å¥½çš„ç»“æœï¼Œè¾¾åˆ°äº†æ–°çš„SOTAï¼Œè¿™æ˜¯ç¬¦åˆæˆ‘ä»¬çš„è®¤çŸ¥çš„ã€‚</p><p>ä½†åœ¨ç¬”è€…æ¨¡å‹å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œä¹Ÿå‘ç°äº†ä¸å°‘çš„é—®é¢˜æˆ–æœ‰å¾…äºè¿›ä¸€æ­¥éªŒè¯çš„åœ°æ–¹ï¼Œè®°å½•å¦‚ä¸‹ï¼š</p><ul><li><p>Baichuan-7bæ¨¡å‹å–å¾—äº†SOTAç»“æœï¼Œä½†åŒæ ·çš„è®­ç»ƒæ¡†æ¶å’Œè®­ç»ƒå‚æ•°ï¼ŒBaichuan-13B-Baseæ¨¡å‹å´è¡¨ç°æƒ¨æ·¡ï¼Œç”šè‡³å¾ˆå·®</p></li><li><p>ä¸åŒçš„Promptå¯¹äºè®­ç»ƒç»“æœçš„å½±å“ï¼Œæ¯”å¦‚ç¬”è€…è‡ªå·±å†™çš„Promptå’ŒGPT-4å†™çš„Promptå¯¹äºæœ€ç»ˆç»“æœå·®è·è¾ƒå¤§ï¼Œç›¸å·®3-4%</p></li><li><p>ç›¸åŒçš„æ¨¡å‹ï¼Œé‡‡ç”¨full, lora,qloraä¸‰ç§å½¢å¼è¿›è¡ŒSFTï¼Œè®­ç»ƒç»“æœä¼šæœ‰ä½•ä¸åŒ</p><p>åç»­ç¬”è€…å°†å°è¯•ä½¿ç”¨ä¸åŒçš„è®­ç»ƒæ¡†æ¶è¿›è¡ŒBaichuan-13B-Baseçš„å¾®è°ƒã€‚</p></li></ul><h3 id="æ€»ç»“åˆ†äº«">æ€»ç»“åˆ†äº«</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨Baichuan-7bæ¨¡å‹å¾®è°ƒäººç‰©å…³ç³»åˆ†ç±»ä»»åŠ¡ï¼Œå¹¶æ¯”BERTæ—¶ä»£çš„æ¨¡å‹å–å¾—äº†è¿›æ­¥ï¼Œè¾¾åˆ°äº†æ–°çš„SOTA.</p><p>æœ¬æ–‡çš„æƒ³æ³•å¾ˆæœ´ç´ ï¼Œä¸»è¦æ˜¯æƒ³æµ‹è¯•ä¸‹LLMåœ¨ä¼ ç»ŸNLPäººç‰©ä¸Šçš„è¡¨ç°ï¼Œä¹Ÿæ˜¯å¯¹äºç¬”è€…è‡ªå·±çš„äººç‰©å…³ç³»æ•°æ®é›†çš„ä¸€æ¬¡æ•ˆæœæå‡ï¼Œè¿™ä¹Ÿæ˜¯ç¬”è€…ä¸€ç›´åœ¨å…³æ³¨å’Œæ„å»ºçš„æ•°æ®é›†ã€‚è¿™ä¸€æ¬¡ï¼Œå¤§æ¨¡å‹å†ä¸€æ¬¡è®©æˆ‘éœ‡æƒŠï¼</p><p>æœ¬æ–‡ä½¿ç”¨çš„äººç‰©å…³ç³»æ•°æ®é›†å·²å¼€æºè‡³HuggingFace Datasets, ç½‘å€ä¸º: <ahref="https://huggingface.co/datasets/jclian91/people_relation_classification">https://huggingface.co/datasets/jclian91/people_relation_classification</a>.</p><p>æœ¬äººçš„ä¸ªäººåšå®¢ç½‘å€ä¸ºï¼š<ahref="https://percent4.github.io/">https://percent4.github.io/</a>,æ¬¢è¿å¤§å®¶å…³æ³¨~</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>NLPï¼ˆäºŒåä¸€ï¼‰äººç‰©å…³ç³»æŠ½å–çš„ä¸€æ¬¡å®æˆ˜: <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98/">https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98/</a></li><li>NLPï¼ˆå››åäºŒï¼‰äººç‰©å…³ç³»åˆ†ç±»çš„å†æ¬¡å°è¯•: <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E7%9A%84%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95/">https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E7%9A%84%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95/</a></li><li>NLPï¼ˆå››åäº”ï¼‰R-BERTåœ¨äººç‰©å…³ç³»åˆ†ç±»ä¸Šçš„å°è¯•åŠKerasä»£ç å¤ç°: <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%94%EF%BC%89R-BERT%E5%9C%A8%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E4%B8%8A%E7%9A%84%E5%B0%9D%E8%AF%95%E5%8F%8AKeras%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%8E%B0/">https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%94%EF%BC%89R-BERT%E5%9C%A8%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E4%B8%8A%E7%9A%84%E5%B0%9D%E8%AF%95%E5%8F%8AKeras%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%8E%B0/</a></li><li>å¾®è°ƒç™¾å·Baichuan-13Bä¿å§†å¼æ•™ç¨‹ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ è®­ç»ƒç™¾äº¿å¤§æ¨¡å‹: <ahref="https://mp.weixin.qq.com/s/ZBY6kbogHjbCQvZBzNEqag">https://mp.weixin.qq.com/s/ZBY6kbogHjbCQvZBzNEqag</a></li><li>HuggingFace Dataset people_relation_classification: <ahref="https://huggingface.co/datasets/jclian91/people_relation_classification">https://huggingface.co/datasets/jclian91/people_relation_classification</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>Baichuan-7b</tag>
      
      <tag>äººç‰©å…³ç³»</tag>
      
      <tag>å…³ç³»åˆ†ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexoçš„Fluidä¸»é¢˜ä¸­è‡ªå®šä¹‰iconfontå›¾æ ‡</title>
    <link href="/2023/07/29/Hexo%E7%9A%84Fluid%E4%B8%BB%E9%A2%98%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89iconfont%E5%9B%BE%E6%A0%87/"/>
    <url>/2023/07/29/Hexo%E7%9A%84Fluid%E4%B8%BB%E9%A2%98%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89iconfont%E5%9B%BE%E6%A0%87/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Hexoçš„Fluidä¸»é¢˜ä»‹ç»">Hexoçš„Fluidä¸»é¢˜ä»‹ç»</h3><p>Hexoæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚ Hexoä½¿ç”¨Markdownï¼ˆæˆ–å…¶ä»–æ ‡è®°è¯­è¨€ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚</p><p>Fluidæ˜¯Hexoä¸­ä¸€ä¸ªä¼˜é›…çš„ä¸»é¢˜ï¼Œè¿™æ˜¯ä¸€æ¬¾Material Designé£æ ¼çš„Hexoä¸»é¢˜ï¼Œä»¥ç®€çº¦çš„è®¾è®¡å¸®åŠ©ä½ ä¸“æ³¨äºå†™ä½œï¼Œå…¶é…ç½®é¡µé¢å¯å‚è€ƒ<a href="https://hexo.fluid-dev.com/docs/guide/">https://hexo.fluid-dev.com/docs/guide/</a> .</p><p>Fluidä¸»é¢˜ä¸­çš„ä¸»é¡µï¼ˆaboutï¼‰ä¸­å¯ä½¿ç”¨ç¤¾äº¤å›¾æ ‡ï¼Œä½¿ç”¨å¯å‚è€ƒ<a href="https://fluid-dev.github.io/hexo-fluid-docs/icon/">https://fluid-dev.github.io/hexo-fluid-docs/icon/</a> . ä½†ä¸»é¡µå†…ç½®çš„ç¤¾äº¤å›¾æ ‡å¤ªå°‘ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å›¾æ ‡ã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»åœ¨Hexoçš„Fluidä¸»é¢˜ä¸­è‡ªå®šä¹‰iconfontå›¾æ ‡ï¼Œå¹¶çº æ­£ç°æœ‰å…¬å¼€åšå®¢æ–‡ç« çš„é”™è¯¯ã€‚</p><h3 id="å¦‚ä½•è‡ªå®šä¹‰iconfontå›¾æ ‡">å¦‚ä½•è‡ªå®šä¹‰iconfontå›¾æ ‡</h3><p>iconfontæ˜¯å›½å†…åŠŸèƒ½å¾ˆå¼ºå¤§ä¸”å›¾æ ‡å†…å®¹å¾ˆä¸°å¯Œçš„çŸ¢é‡å›¾æ ‡åº“ï¼Œæä¾›çŸ¢é‡å›¾æ ‡ä¸‹è½½ã€åœ¨çº¿å­˜å‚¨ã€æ ¼å¼è½¬æ¢ç­‰åŠŸèƒ½ï¼Œç”±é˜¿é‡Œå·´å·´ä½“éªŒå›¢é˜Ÿå€¾åŠ›æ‰“é€ ï¼Œæ˜¯ä¸€æ¬¾æœ‰åŠ©äºè®¾è®¡å’Œå‰ç«¯å¼€å‘çš„ä¾¿æ·å·¥å…·ï¼Œç½‘å€ä¸ºï¼š<a href="https://www.iconfont.cn/">https://www.iconfont.cn/</a> .</p><p>åœ¨Hexoçš„Fluidä¸»é¢˜ä¸­è‡ªå®šä¹‰iconfontå›¾æ ‡çš„æ­¥éª¤ï¼ˆä»¥ä»Šæ—¥å¤´æ¡å›¾æ ‡ä¸ºä¾‹ï¼‰å¦‚ä¸‹ï¼š</p><ol><li>åœ¨iconfontç½‘ç«™ä¸­æœç´¢ä»Šæ—¥å¤´æ¡å›¾æ ‡ï¼Œæ·»åŠ è‡³è´­ç‰©è½¦ï¼Œå¹¶ä¸‹è½½ä»£ç è‡³æœ¬åœ°ï¼›</li></ol><p><img src="/img/hexo_fluid_1.png" alt="ä¸‹è½½ä»Šæ—¥å¤´æ¡å›¾æ ‡çš„ä»£ç "></p><ol start="2"><li><p>å°†ä¸‹è½½ä»£ç å‹ç¼©æ–‡ä»¶è§£å‹ï¼Œå¹¶é‡å‘½åä¸ºtoutiaoï¼›</p></li><li><p>å°†toutiaoæ–‡ä»¶å¤¹æ”¾è‡³Hexoé¡¹ç›®ä¸­çš„source/cssæ–‡ä»¶å¤¹ä¸‹ï¼›</p></li><li><p>åœ¨_config.fluid.ymlæ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ï¼š</p></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">skip_render:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;css/**/*&#x27;</span><br>  <br><span class="hljs-attr">custom_css:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/css/toutiao/iconfont.css</span><br><br><span class="hljs-attr">about:</span><br>  <span class="hljs-attr">avatar:</span> <span class="hljs-string">/img/avatar.png</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Fluid&quot;</span><br>  <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;ä¸ªäººåšå®¢&quot;</span><br>  <span class="hljs-attr">icons:</span><br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">class:</span> <span class="hljs-string">&#x27;icon iconfont icon-jinritoutiao&#x27;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&#x27;you own toutiao website&#x27;</span>, <span class="hljs-attr">tip:</span> <span class="hljs-string">&#x27;ä»Šæ—¥å¤´æ¡&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li>éƒ¨ç½²Hexoï¼Œç»“æœå¦‚ä¸‹ï¼š</li></ol><p><img src="/img/hexo_fluid_2.png" alt="ä¸»é¡µé¡µé¢è‡ªå®šä¹‰å›¾æ ‡æˆåŠŸ"></p><h3 id="çº é”™ä¹‹å¤„">çº é”™ä¹‹å¤„</h3><p>åœ¨ä¸Šè¿°é…ç½®ä¸­çš„ç¬¬4æ­¥ï¼Œç°åœ¨å¾ˆå°‘æœ‰å‚è€ƒæ–‡ç« ï¼Œè€Œä»…æœ‰çš„ä¸­æ–‡å‚è€ƒæ–‡ç« ä¸­çš„é…ç½®iconsä¸­çš„classæ–¹æ³•æ˜¯ä¸æ­£ç¡®çš„ã€‚</p><p>æ­£ç¡®çš„æ–¹æ³•æ˜¯æ‰“å¼€toutiaoæ–‡ä»¶å¤¹ä¸­çš„ç¤ºä¾‹é¡µé¢ï¼ˆdemo_index.htmlï¼‰ï¼Œå³å‡»Font Classä¸­çš„å›¾æ ‡ï¼Œé€‰æ‹©æŸ¥çœ‹ï¼š</p><p><img src="/img/hexo_fluid_5.png" alt="demo_index.htmlæ–‡ä»¶"></p><p><img src="/img/hexo_fluid_3.png" alt="æŸ¥çœ‹Font Classå›¾æ ‡"></p><p>classåº”è¯¥é€‰æ‹©å¦‚ä¸‹ï¼š</p><p><img src="/img/hexo_fluid_4.png" alt="å¦‚ä½•æŸ¥çœ‹class"></p><p>ä»¥ä¸Šæ˜¯æœ¬æ–‡å¯¹ç°æœ‰çš„å…¬å¼€åšå®¢æ–‡ç« å…³äºå¦‚ä½•åœ¨Hexoçš„Fluidä¸»é¢˜ä¸­é…ç½®iconsçš„classçš„çº æ­£ä¹‹å¤„ã€‚</p><p>æ¬¢è¿è®¿é—®æœ¬äººçš„ä¸ªäººåšå®¢ï¼š<a href="https://percent4.github.io/">https://percent4.github.io/</a> .</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Elasticsearchå…¥é—¨ç¬”è®°ï¼ˆä¸€ï¼‰</title>
    <link href="/2023/07/27/Elasticsearch%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <url>/2023/07/27/Elasticsearch%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h3><p>Elasticsearchæ˜¯æœç´¢å¼•æ“ï¼Œæ˜¯å¸¸è§çš„æœç´¢å·¥å…·ä¹‹ä¸€ã€‚</p><p>Kibana æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œæ—¨åœ¨ä¸ Elasticsearch åˆä½œã€‚Kibana æä¾›æœç´¢ã€æŸ¥çœ‹å’Œä¸å­˜å‚¨åœ¨ Elasticsearch ç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œäº¤äº’çš„åŠŸèƒ½ã€‚å¼€å‘è€…æˆ–è¿ç»´äººå‘˜å¯ä»¥è½»æ¾åœ°æ‰§è¡Œé«˜çº§æ•°æ®åˆ†æï¼Œå¹¶åœ¨å„ç§å›¾è¡¨ã€è¡¨æ ¼å’Œåœ°å›¾ä¸­å¯è§†åŒ–æ•°æ®ã€‚</p><p>å…¶å®ƒå¯è§†åŒ–è¿˜æœ‰elasticsearch-head(è½»é‡çº§ï¼Œæœ‰å¯¹åº”çš„Chromeæ’ä»¶)ï¼Œæœ¬æ–‡ä¸ä¼šè¯¦ç»†ä»‹ç»ã€‚</p><p>Elasticsearchå’ŒKibanaçš„ç‰ˆæœ¬é‡‡ç”¨7.17.0ï¼Œç¯å¢ƒæ­å»ºé‡‡ç”¨Dockerï¼Œ<code>docker-compose.yml</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.1&quot;</span><br><span class="hljs-comment"># æœåŠ¡é…ç½®</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">elasticsearch:</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">elasticsearch-7.17.0</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">elasticsearch:7.17.0</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ES_JAVA_OPTS=-Xms1024m -Xmx1024m&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;http.host=0.0.0.0&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;node.name=elastic01&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;cluster.name=cluster_elasticsearch&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;discovery.type=single-node&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9200:9200&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9300:9300&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./es/plugins:/usr/share/elasticsearch/plugins</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./es/data:/usr/share/elasticsearch/data</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">elastic_net</span><br><br>  <span class="hljs-attr">kibana:</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">kibana-7.17.0</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">kibana:7.17.0</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5601:5601&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">elastic_net</span><br><br><span class="hljs-comment"># ç½‘ç»œé…ç½®</span><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">elastic_net:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span><br></code></pre></td></tr></table></figure><h3 id="åŸºç¡€å‘½ä»¤">åŸºç¡€å‘½ä»¤</h3><ul><li>æŸ¥çœ‹ElasticSearchæ˜¯å¦å¯åŠ¨æˆåŠŸï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://IP:9200<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹é›†ç¾¤æ˜¯å¦å¥åº·</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://IP:9200/_cat/health?v<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ElasticSearchæ‰€æœ‰çš„index</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://IP:9200/_cat/indices<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ElasticSearchæ‰€æœ‰indicesæˆ–è€…æŸä¸ªindexçš„æ–‡æ¡£æ•°é‡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://IP:9200/_cat/count?v<br>curl http://IP:9200/_cat/count/some_index_name?v<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹æ­£åœ¨è¿è¡Œçš„æ’ä»¶ä¿¡æ¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://IP:9200/_cat/plugins?v&amp;s=component&amp;h=name,component,version,description<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ikæ’ä»¶çš„åˆ†è¯ç»“æœ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span>  -XGET <span class="hljs-string">&#x27;http://IP:9200/_analyze?pretty&#x27;</span> -d <span class="hljs-string">&#x27;&#123;&quot;analyzer&quot;:&quot;ik_max_word&quot;,&quot;text&quot;:&quot;ç¾å›½ç•™ç»™ä¼Šæ‹‰å…‹çš„æ˜¯ä¸ªçƒ‚æ‘Šå­å—&quot;&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="indexæ“ä½œ">indexæ“ä½œ</h3><ul><li>æŸ¥çœ‹æŸä¸ªindexçš„mapping</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://IP:9200/some_index_name/_mapping<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æŸä¸ªindexçš„æ‰€æœ‰æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://IP:9200/some_index_name/_search<br></code></pre></td></tr></table></figure><ul><li>æŒ‰IDè¿›è¡ŒæŸ¥è¯¢</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X GET http://IP:9200/ç´¢å¼•åç§°/æ–‡æ¡£ç±»å‹/ID<br></code></pre></td></tr></table></figure><ul><li>æ£€ç´¢æŸä¸ªindexçš„å…¨éƒ¨æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://IP:9200/ç´¢å¼•åç§°/_search?pretty<br>curl -X POST http://IP:9200/ç´¢å¼•åç§°/_search?pretty -d <span class="hljs-string">&quot;&#123;\&quot;query\&quot;: &#123;\&quot;match_all\&quot;: &#123;&#125; &#125;&#125;&quot;</span><br></code></pre></td></tr></table></figure><ul><li>æ£€ç´¢æŸä¸ªindexçš„å‰å‡ æ¡æ•°æ®(å¦‚æœä¸æŒ‡å®šsize,åˆ™é»˜è®¤ä¸º10æ¡)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -XPOST IP:9200/ç´¢å¼•åç§°/_search?pretty -d <span class="hljs-string">&quot;&#123;\&quot;query\&quot;: &#123;\&quot;match_all\&quot;: &#123;&#125; &#125;, \&quot;size\&quot; : 2&#125;&quot;</span><br></code></pre></td></tr></table></figure><ul><li>æ£€ç´¢æŸä¸ªindexçš„ä¸­é—´å‡ æ¡æ•°æ®(æ¯”å¦‚ç¬¬11-20æ¡æ•°æ®)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -XPOST IP:9200/ç´¢å¼•åç§°/_search?pretty -d <span class="hljs-string">&quot;&#123;\&quot;query\&quot;: &#123;\&quot;match_all\&quot;: &#123;&#125; &#125;, \&quot;from\&quot; : 10, \&quot;size\&quot; : 10&#125;&#125;&quot;</span><br></code></pre></td></tr></table></figure><ul><li>æ£€ç´¢æŸä¸ªindex, åªè¿”å›contextå­—æ®µ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -XPOST IP:9200/ç´¢å¼•åç§°/_search?pretty -d <span class="hljs-string">&quot;&#123;\&quot;query\&quot;: &#123;\&quot;match_all\&quot;: &#123;&#125; &#125;, \&quot;_source\&quot;: [\&quot;context\&quot;]&#125;&quot;</span><br></code></pre></td></tr></table></figure><ul><li>åˆ é™¤æŸä¸ªindex</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -XDELETE <span class="hljs-string">&#x27;IP:9200/index_name&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="ESæœç´¢">ESæœç´¢</h3><ol><li>å¦‚æœæœ‰å¤šä¸ªæœç´¢å…³é”®å­—ï¼Œ Elastic è®¤ä¸ºå®ƒä»¬æ˜¯orå…³ç³»ã€‚</li><li>å¦‚æœè¦æ‰§è¡Œå¤šä¸ªå…³é”®è¯çš„andæœç´¢ï¼Œå¿…é¡»ä½¿ç”¨å¸ƒå°”æŸ¥è¯¢ã€‚</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl <span class="hljs-string">&#x27;localhost:9200/ç´¢å¼•åç§°/æ–‡æ¡£ç±»å‹/_search&#x27;</span>  -d <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;query&quot;: &#123;</span><br><span class="hljs-string">    &quot;bool&quot;: &#123;</span><br><span class="hljs-string">      &quot;must&quot;: [</span><br><span class="hljs-string">        &#123; &quot;match&quot;: &#123; &quot;content&quot;: &quot;è½¯ä»¶&quot; &#125; &#125;,</span><br><span class="hljs-string">        &#123; &quot;match&quot;: &#123; &quot;content&quot;: &quot;ç³»ç»Ÿ&quot; &#125; &#125;</span><br><span class="hljs-string">      ]</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;&#x27;</span><br></code></pre></td></tr></table></figure><ol start="3"><li>å¤æ‚æœç´¢ï¼š</li></ol><p>SQLè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test_index <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;tom&#x27;</span> <span class="hljs-keyword">or</span> (hired <span class="hljs-operator">=</span><span class="hljs-literal">true</span> <span class="hljs-keyword">and</span> (personality <span class="hljs-operator">=</span><span class="hljs-string">&#x27;good&#x27;</span> <span class="hljs-keyword">and</span> rude <span class="hljs-operator">!=</span> <span class="hljs-literal">true</span> ))<br></code></pre></td></tr></table></figure><p>DSLè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span>test_index<span class="hljs-operator">/</span>_search<br>&#123;<br>    &quot;query&quot;: &#123;<br>            &quot;bool&quot;: &#123;<br>                &quot;must&quot;: &#123; &quot;match&quot;:&#123; &quot;name&quot;: &quot;tom&quot; &#125;&#125;,<br>                &quot;should&quot;: [<br>                    &#123; &quot;match&quot;:&#123; &quot;hired&quot;: <span class="hljs-literal">true</span> &#125;&#125;,<br>                    &#123; &quot;bool&quot;: &#123;<br>                        &quot;must&quot;:&#123; &quot;match&quot;: &#123; &quot;personality&quot;: &quot;good&quot; &#125;&#125;,<br>                        &quot;must_not&quot;: &#123; &quot;match&quot;: &#123; &quot;rude&quot;: <span class="hljs-literal">true</span> &#125;&#125;<br>                    &#125;&#125;<br>                ],<br>                &quot;minimum_should_match&quot;: <span class="hljs-number">1</span><br>            &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ikåˆ†è¯å™¨">ikåˆ†è¯å™¨</h3><p>ikåˆ†è¯å™¨æ˜¯Elasticsearchçš„ä¸­æ–‡åˆ†è¯å™¨æ’ä»¶ï¼Œå¯¹ä¸­æ–‡åˆ†è¯æ”¯æŒè¾ƒå¥½ã€‚ikç‰ˆæœ¬è¦ä¸Elasticsearchä¿æŒä¸€è‡´ã€‚</p><p>ik 7.17.0ä¸‹è½½åœ°å€ä¸ºï¼š<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.17.0">https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.17.0</a> ï¼Œä¸‹è½½åå°†å…¶é‡åä¸ºikï¼Œå°†å…¶æ”¾è‡³Elasticsearchçš„pluginsæ–‡ä»¶å¤¹ä¸‹ã€‚</p><p>ikåˆ†è¯å™¨çš„ä½¿ç”¨å‘½ä»¤ï¼ˆKibanaç¯å¢ƒï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;æˆšå‘è½«æ˜¯å“ªé‡Œäºº&quot;</span>,<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æˆš&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_CHAR&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‘è½«&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ˜¯&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_CHAR&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å“ªé‡Œäºº&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ikæ”¯æŒåŠ è½½ç”¨æˆ·è¯å…¸å’Œåœç”¨è¯ã€‚ik æä¾›äº†é…ç½®æ–‡ä»¶ IKAnalyzer.cfg.xmlï¼ˆå°†å…¶æ”¾åœ¨ik/configè·¯å¾„ä¸‹ï¼‰ï¼Œå¯ä»¥ç”¨æ¥é…ç½®è‡ªå·±çš„æ‰©å±•ç”¨æˆ·è¯å…¸ã€åœç”¨è¯è¯å…¸å’Œè¿œç¨‹æ‰©å±•ç”¨æˆ·è¯å…¸ï¼Œéƒ½å¯ä»¥é…ç½®å¤šä¸ªã€‚</p><p>é…ç½®å®Œæ‰©å±•ç”¨æˆ·è¯å…¸å’Œè¿œç¨‹æ‰©å±•ç”¨æˆ·è¯å…¸éƒ½éœ€è¦é‡å¯ESï¼Œåç»­å¯¹ç”¨æˆ·è¯å…¸è¿›è¡Œæ›´æ–°çš„è¯ï¼Œéœ€è¦é‡å¯ESï¼Œè¿œç¨‹æ‰©å±•ç”¨æˆ·è¯å…¸é…ç½®å®Œåæ”¯æŒçƒ­æ›´æ–°ï¼Œæ¯60ç§’æ£€æŸ¥æ›´æ–°ã€‚ä¸¤ä¸ªæ‰©å±•è¯å…¸éƒ½æ˜¯æ·»åŠ åˆ°ikçš„ä¸»è¯å…¸ä¸­ï¼Œå¯¹æ‰€æœ‰ç´¢å¼•ç”Ÿæ•ˆã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">properties</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span><br><span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;ext_dict&quot;</span>&gt;</span>custom/mydict.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br> <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;ext_stopwords&quot;</span>&gt;</span>custom/ext_stopword.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br><span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;entry key=&quot;remote_ext_dict&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç”¨æˆ·è¯å…¸æ–‡ä»¶è·¯å¾„ä¸ºï¼šcustom/mydict.dicï¼Œåœç”¨è¯è¯å…¸è·¯å¾„ä¸ºï¼šcustom/ext_stopword.dicï¼Œå°†å®ƒä»¬æ”¾åœ¨ik/config/customè·¯å¾„ä¸‹ã€‚</p><p>ç”¨æˆ·è¯å…¸æ–‡ä»¶ä¸­åŠ å…¥â€™æˆšå‘è½«â€™ï¼Œåœç”¨è¯è¯å…¸åŠ å…¥â€™æ˜¯â€™ï¼Œå¯¹åŸæ¥æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;æˆšå‘è½«æ˜¯å“ªé‡Œäºº&quot;</span>,<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æˆšå‘è½«&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å“ªé‡Œäºº&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœâ€™analyzerâ€™é€‰æ‹©ik_smartï¼Œåˆ™ä¼šå°†æ–‡æœ¬åšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼›é€‰æ‹©ik_max_wordï¼Œåˆ™ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ã€‚æµ‹è¯•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;æˆšå‘è½«æ˜¯å“ªé‡Œäºº&quot;</span>,<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æˆšå‘è½«&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‘è½«&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å“ªé‡Œäºº&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å“ªé‡Œ&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é‡Œäºº&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN_WORD&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Elasticsearchä¸€äº›åŸºç¡€å‘½ä»¤å’Œç”¨æ³•ï¼Œæ˜¯ç¬”è€…çš„Elasticsearchå­¦ä¹ ç¬”è®°ç¬¬ä¸€ç¯‡ï¼Œåç»­å°†æŒç»­æ›´æ–°ã€‚</p><p>æœ¬æ–‡ä»£ç å·²æ”¾è‡³Githubï¼Œç½‘å€ä¸ºï¼š<a href="https://github.com/percent4/ES_Learning">https://github.com/percent4/ES_Learning</a> .</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Elasticsearch</tag>
      
      <tag>Kibana</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Elasticsearchç®€ä»‹ä¸å®æˆ˜</title>
    <link href="/2023/07/27/Elasticsearch%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%AE%9E%E6%88%98/"/>
    <url>/2023/07/27/Elasticsearch%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ä»€ä¹ˆæ˜¯Elasticsearch">ä»€ä¹ˆæ˜¯Elasticsearch?</h3><p><img src="/img/es1_1.png" alt=""></p><p>Elasticsearchæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ï¼Œå®ƒçš„åº•å±‚æ˜¯å¼€æºåº“Apache Luceneã€‚</p><p>Lucene å¯ä»¥è¯´æ˜¯å½“ä¸‹æœ€å…ˆè¿›ã€é«˜æ€§èƒ½ã€å…¨åŠŸèƒ½çš„æœç´¢å¼•æ“åº“â€”â€”æ— è®ºæ˜¯å¼€æºè¿˜æ˜¯ç§æœ‰ï¼Œä½†å®ƒä¹Ÿä»…ä»…åªæ˜¯ä¸€ä¸ªåº“ã€‚ä¸ºäº†å……åˆ†å‘æŒ¥å…¶åŠŸèƒ½ï¼Œä½ éœ€è¦ä½¿ç”¨ Java å¹¶å°† Lucene ç›´æ¥é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ‚¨å¯èƒ½éœ€è¦è·å¾—ä¿¡æ¯æ£€ç´¢å­¦ä½æ‰èƒ½äº†è§£å…¶å·¥ä½œåŸç†ï¼Œå› ä¸ºLucene éå¸¸å¤æ‚ã€‚</p><p>ä¸ºäº†è§£å†³Luceneä½¿ç”¨æ—¶çš„ç¹å¤æ€§ï¼Œäºæ˜¯Elasticsearchä¾¿åº”è¿è€Œç”Ÿã€‚å®ƒä½¿ç”¨ Java ç¼–å†™ï¼Œå†…éƒ¨é‡‡ç”¨ Lucene åšç´¢å¼•ä¸æœç´¢ï¼Œä½†æ˜¯å®ƒçš„ç›®æ ‡æ˜¯ä½¿å…¨æ–‡æ£€ç´¢å˜å¾—æ›´ç®€å•ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¯¹Lucene åšäº†ä¸€å±‚å°è£…ï¼Œå®ƒæä¾›äº†ä¸€å¥—ç®€å•ä¸€è‡´çš„ RESTful API æ¥å¸®åŠ©æˆ‘ä»¬å®ç°å­˜å‚¨å’Œæ£€ç´¢ã€‚</p><p>å½“ç„¶ï¼ŒElasticsearch ä¸ä»…ä»…æ˜¯ Luceneï¼Œå¹¶ä¸”ä¹Ÿä¸ä»…ä»…åªæ˜¯ä¸€ä¸ªå…¨æ–‡æœç´¢å¼•æ“ã€‚ å®ƒå¯ä»¥è¢«ä¸‹é¢è¿™æ ·å‡†ç¡®åœ°å½¢å®¹ï¼š</p><ul><li>ä¸€ä¸ªåˆ†å¸ƒå¼çš„å®æ—¶æ–‡æ¡£å­˜å‚¨ï¼Œæ¯ä¸ªå­—æ®µå¯ä»¥è¢«ç´¢å¼•ä¸æœç´¢ï¼›</li><li>ä¸€ä¸ªåˆ†å¸ƒå¼å®æ—¶åˆ†ææœç´¢å¼•æ“ï¼›</li><li>èƒ½èƒœä»»ä¸Šç™¾ä¸ªæœåŠ¡èŠ‚ç‚¹çš„æ‰©å±•ï¼Œå¹¶æ”¯æŒ PB çº§åˆ«çš„ç»“æ„åŒ–æˆ–è€…éç»“æ„åŒ–æ•°æ®ã€‚</li></ul><p>ç”±äºElasticsearchçš„åŠŸèƒ½å¼ºå¤§å’Œä½¿ç”¨ç®€å•ï¼Œç»´åŸºç™¾ç§‘ã€å«æŠ¥ã€Stack Overflowã€GitHubç­‰éƒ½çº·çº·é‡‡ç”¨å®ƒæ¥åšæœç´¢ã€‚ç°åœ¨ï¼ŒElasticsearchå·²æˆä¸ºå…¨æ–‡æœç´¢é¢†åŸŸçš„ä¸»æµè½¯ä»¶ä¹‹ä¸€ã€‚</p><p>ä¸‹é¢å°†ä»‹ç»Elasticsearchçš„å®‰è£…ä¸ç®€å•ä½¿ç”¨ã€‚</p><h3 id="å®‰è£…å¹¶è¿è¡ŒElasticsearch">å®‰è£…å¹¶è¿è¡ŒElasticsearch</h3><p>å®‰è£… Elasticsearch ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®‰è£…ä¸€ä¸ªè¾ƒæ–°ç‰ˆæœ¬çš„ Javaï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯ï¼Œä½ å¯ä»¥ä» <a href="http://www.java.com/"><em>www.java.com</em></a> è·å¾—å®˜æ–¹æä¾›çš„æœ€æ–°ç‰ˆæœ¬çš„Javaã€‚</p><p>ä½ å¯ä»¥ä» elastic çš„å®˜ç½‘ <a href="https://www.elastic.co/downloads/elasticsearch">elastic.co/downloads/elasticsearch</a> è·å–æœ€æ–°ç‰ˆæœ¬çš„Elasticsearchã€‚è§£å‹æ–‡æ¡£åï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ“ä½œï¼Œå³å¯åœ¨å‰å°(foregroud)å¯åŠ¨ Elasticsearchï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> elasticsearch-&lt;version&gt;<br>./bin/elasticsearch<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼ŒElasticsearchè¿è¡Œåœ¨æœ¬åœ°çš„9200ç«¯å£ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€â€œ<a href="http://localhost:9200/%E2%80%9D">http://localhost:9200/â€</a> ï¼Œå¦‚æœçœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯å°±è¯´æ˜ä½ çš„ç”µè„‘å·²æˆåŠŸå®‰è£…Elasticsearchï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;YTK8L4q&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;cluster_name&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;elasticsearch&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;cluster_uuid&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hB2CZPlvSJavhJxx85fUqQ&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;number&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;6.5.4&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;build_flavor&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;default&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;build_type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tar&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;build_hash&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;d2ef93d&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;build_date&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-12-17T21:17:40.758843Z&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;build_snapshot&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lucene_version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;7.5.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;minimum_wire_compatibility_version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5.6.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;minimum_index_compatibility_version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5.0.0&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;tagline&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;You Know, for Search&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®‰è£…çš„Elasticsearchç‰ˆæœ¬å·ä¸º6.5.4ã€‚</p><p>Kibana æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œæ—¨åœ¨ä¸ Elasticsearch åˆä½œã€‚Kibana æä¾›æœç´¢ã€æŸ¥çœ‹å’Œä¸å­˜å‚¨åœ¨ Elasticsearch ç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œäº¤äº’çš„åŠŸèƒ½ã€‚å¼€å‘è€…æˆ–è¿ç»´äººå‘˜å¯ä»¥è½»æ¾åœ°æ‰§è¡Œé«˜çº§æ•°æ®åˆ†æï¼Œå¹¶åœ¨å„ç§å›¾è¡¨ã€è¡¨æ ¼å’Œåœ°å›¾ä¸­å¯è§†åŒ–æ•°æ®ã€‚</p><p>ä½ å¯ä»¥ä» elastic çš„å®˜ç½‘ <a href="https://www.elastic.co/downloads/kibana">https://www.elastic.co/downloads/kibana</a> è·å–æœ€æ–°ç‰ˆæœ¬çš„Kibanaã€‚è§£å‹æ–‡æ¡£åï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ“ä½œï¼Œå³å¯åœ¨å‰å°(foregroud)å¯åŠ¨Kibanaï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> kibana-&lt;version&gt;<br>./bin/kabana<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼ŒKibanaè¿è¡Œåœ¨æœ¬åœ°çš„5601ç«¯å£ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€â€œ<a href="http://localhost:5601">http://localhost:5601</a>â€ï¼Œå³å¯çœ‹åˆ°ä»¥ä¸‹ç•Œé¢ï¼š</p><p><img src="/img/es1_2.png" alt="Kibanaå¯åŠ¨ç•Œé¢"></p><p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ¥äº†è§£Elasticsearchçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨Elasticsearchã€‚</p><h3 id="ElasticsearchåŸºæœ¬æ¦‚å¿µ">ElasticsearchåŸºæœ¬æ¦‚å¿µ</h3><h4 id="å…¨æ–‡æœç´¢-Full-text-Search">å…¨æ–‡æœç´¢(Full-text Search)</h4><p>å…¨æ–‡æ£€ç´¢æ˜¯æŒ‡è®¡ç®—æœºç´¢å¼•ç¨‹åºé€šè¿‡æ‰«ææ–‡ç« ä¸­çš„æ¯ä¸€ä¸ªè¯ï¼Œå¯¹æ¯ä¸€ä¸ªè¯å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼ŒæŒ‡æ˜è¯¥è¯åœ¨æ–‡ç« ä¸­å‡ºç°çš„æ¬¡æ•°å’Œä½ç½®ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢æ—¶ï¼Œæ£€ç´¢ç¨‹åºå°±æ ¹æ®äº‹å…ˆå»ºç«‹çš„ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¹¶å°†æŸ¥æ‰¾çš„ç»“æœåé¦ˆç»™ç”¨æˆ·çš„æ£€ç´¢æ–¹å¼ã€‚</p><p>åœ¨å…¨æ–‡æœç´¢çš„ä¸–ç•Œä¸­ï¼Œå­˜åœ¨ç€å‡ ä¸ªåºå¤§çš„å¸å›½ï¼Œä¹Ÿå°±æ˜¯ä¸»æµå·¥å…·ï¼Œä¸»è¦æœ‰ï¼š</p><ul><li>Apache Lucene</li><li>Elasticsearch</li><li>Solr</li><li>Ferret</li></ul><h4 id="å€’æ’ç´¢å¼•ï¼ˆInverted-Indexï¼‰">å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰</h4><p>è¯¥ç´¢å¼•è¡¨ä¸­çš„æ¯ä¸€é¡¹éƒ½åŒ…æ‹¬ä¸€ä¸ªå±æ€§å€¼å’Œå…·æœ‰è¯¥å±æ€§å€¼çš„å„è®°å½•çš„åœ°å€ã€‚ç”±äºä¸æ˜¯ç”±è®°å½•æ¥ç¡®å®šå±æ€§å€¼ï¼Œè€Œæ˜¯ç”±å±æ€§å€¼æ¥ç¡®å®šè®°å½•çš„ä½ç½®ï¼Œå› è€Œç§°ä¸ºå€’æ’ç´¢å¼•(inverted index)ã€‚Elasticsearchèƒ½å¤Ÿå®ç°å¿«é€Ÿã€é«˜æ•ˆçš„æœç´¢åŠŸèƒ½ï¼Œæ­£æ˜¯åŸºäºå€’æ’ç´¢å¼•åŸç†ã€‚</p><h4 id="èŠ‚ç‚¹-é›†ç¾¤ï¼ˆNode-Clusterï¼‰">èŠ‚ç‚¹ &amp; é›†ç¾¤ï¼ˆNode &amp; Clusterï¼‰</h4><p>Elasticsearch æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå…è®¸å¤šå°æœåŠ¡å™¨ååŒå·¥ä½œï¼Œæ¯å°æœåŠ¡å™¨å¯ä»¥è¿è¡Œå¤šä¸ªElasticsearchå®ä¾‹ã€‚å•ä¸ªElasticsearchå®ä¾‹ç§°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼Œä¸€ç»„èŠ‚ç‚¹æ„æˆä¸€ä¸ªé›†ç¾¤ï¼ˆClusterï¼‰ã€‚</p><h4 id="ç´¢å¼•ï¼ˆIndexï¼‰">ç´¢å¼•ï¼ˆIndexï¼‰</h4><p>Elasticsearch æ•°æ®ç®¡ç†çš„é¡¶å±‚å•ä½å°±å«åš Indexï¼ˆç´¢å¼•ï¼‰ï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“é‡Œçš„æ•°æ®åº“çš„æ¦‚å¿µã€‚å¦å¤–ï¼Œæ¯ä¸ªIndexçš„åå­—å¿…é¡»æ˜¯å°å†™ã€‚</p><h4 id="æ–‡æ¡£ï¼ˆDocumentï¼‰">æ–‡æ¡£ï¼ˆDocumentï¼‰</h4><p>Indexé‡Œé¢å•æ¡çš„è®°å½•ç§°ä¸º Documentï¼ˆæ–‡æ¡£ï¼‰ã€‚è®¸å¤šæ¡ Document æ„æˆäº†ä¸€ä¸ª Indexã€‚Document ä½¿ç”¨ JSON æ ¼å¼è¡¨ç¤ºã€‚åŒä¸€ä¸ª Index é‡Œé¢çš„ Documentï¼Œä¸è¦æ±‚æœ‰ç›¸åŒçš„ç»“æ„ï¼ˆschemeï¼‰ï¼Œä½†æ˜¯æœ€å¥½ä¿æŒç›¸åŒï¼Œè¿™æ ·æœ‰åˆ©äºæé«˜æœç´¢æ•ˆç‡ã€‚</p><h4 id="ç±»å‹ï¼ˆTypeï¼‰">ç±»å‹ï¼ˆTypeï¼‰</h4><p>Document å¯ä»¥åˆ†ç»„ï¼Œæ¯”å¦‚employeeè¿™ä¸ª Index é‡Œé¢ï¼Œå¯ä»¥æŒ‰éƒ¨é—¨åˆ†ç»„ï¼Œä¹Ÿå¯ä»¥æŒ‰èŒçº§åˆ†ç»„ã€‚è¿™ç§åˆ†ç»„å°±å«åš Typeï¼Œå®ƒæ˜¯è™šæ‹Ÿçš„é€»è¾‘åˆ†ç»„ï¼Œç”¨æ¥è¿‡æ»¤ Documentï¼Œç±»ä¼¼å…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®è¡¨ã€‚</p><p>ä¸åŒçš„ Type åº”è¯¥æœ‰ç›¸ä¼¼çš„ç»“æ„ï¼ˆSchemaï¼‰ï¼Œæ€§è´¨å®Œå…¨ä¸åŒçš„æ•°æ®ï¼ˆæ¯”å¦‚ products å’Œ logsï¼‰åº”è¯¥å­˜æˆä¸¤ä¸ª Indexï¼Œè€Œä¸æ˜¯ä¸€ä¸ª Index é‡Œé¢çš„ä¸¤ä¸ª Typeï¼ˆè™½ç„¶å¯ä»¥åšåˆ°ï¼‰ã€‚</p><h3 id="æ–‡æ¡£å…ƒæ•°æ®ï¼ˆDocument-metadataï¼‰">æ–‡æ¡£å…ƒæ•°æ®ï¼ˆDocument metadataï¼‰</h3><p>æ–‡æ¡£å…ƒæ•°æ®ä¸º_index, _type, _id, è¿™ä¸‰è€…å¯ä»¥å”¯ä¸€è¡¨ç¤ºä¸€ä¸ªæ–‡æ¡£ï¼Œ_indexè¡¨ç¤ºæ–‡æ¡£åœ¨å“ªå­˜æ”¾ï¼Œ_typeè¡¨ç¤ºæ–‡æ¡£çš„å¯¹è±¡ç±»åˆ«ï¼Œ_idä¸ºæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ã€‚</p><h4 id="å­—æ®µï¼ˆFieldsï¼‰">å­—æ®µï¼ˆFieldsï¼‰</h4><p>æ¯ä¸ªDocumentéƒ½ç±»ä¼¼ä¸€ä¸ªJSONç»“æ„ï¼Œå®ƒåŒ…å«äº†è®¸å¤šå­—æ®µï¼Œæ¯ä¸ªå­—æ®µéƒ½æœ‰å…¶å¯¹åº”çš„å€¼ï¼Œå¤šä¸ªå­—æ®µç»„æˆäº†ä¸€ä¸ª Documentï¼Œå¯ä»¥ç±»æ¯”å…³ç³»å‹æ•°æ®åº“æ•°æ®è¡¨ä¸­çš„å­—æ®µã€‚</p><p>åœ¨ Elasticsearch ä¸­ï¼Œæ–‡æ¡£ï¼ˆDocumentï¼‰å½’å±äºä¸€ç§ç±»å‹ï¼ˆTypeï¼‰ï¼Œè€Œè¿™äº›ç±»å‹å­˜åœ¨äºç´¢å¼•ï¼ˆIndexï¼‰ä¸­ï¼Œä¸‹å›¾å±•ç¤ºäº†Elasticsearchä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„ç±»æ¯”ï¼š</p><p><img src="/img/es1_3.png" alt=""></p><h3 id="Elasticsearchå…¥é—¨">Elasticsearchå…¥é—¨</h3><p>Elasticsearchæä¾›äº†å¤šç§äº¤äº’ä½¿ç”¨æ–¹å¼ï¼ŒåŒ…æ‹¬Java APIå’ŒRESTful API ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»RESTful API ã€‚æ‰€æœ‰å…¶ä»–è¯­è¨€å¯ä»¥ä½¿ç”¨RESTful API é€šè¿‡ç«¯å£ <em>9200</em> å’Œ Elasticsearch è¿›è¡Œé€šä¿¡ï¼Œä½ å¯ä»¥ç”¨ä½ æœ€å–œçˆ±çš„ web å®¢æˆ·ç«¯è®¿é—® Elasticsearch ã€‚ç”šè‡³ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>curl</code> å‘½ä»¤æ¥å’Œ Elasticsearch äº¤äº’ã€‚</p><p>ä¸€ä¸ªElasticsearchè¯·æ±‚å’Œä»»ä½• HTTP è¯·æ±‚ä¸€æ ·ï¼Œéƒ½ç”±è‹¥å¹²ç›¸åŒçš„éƒ¨ä»¶ç»„æˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X&lt;VERB&gt; <span class="hljs-string">&#x27;&lt;PROTOCOL&gt;://&lt;HOST&gt;:&lt;PORT&gt;/&lt;PATH&gt;?&lt;QUERY_STRING&gt;&#x27;</span> -d <span class="hljs-string">&#x27;&lt;BODY&gt;&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿”å›çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå› ä¸ºElasticsearchä¸­çš„æ–‡æ¡£ä»¥JSONæ ¼å¼å‚¨å­˜ã€‚å…¶ä¸­ï¼Œè¢« <code>&lt; &gt;</code> æ ‡è®°çš„éƒ¨ä»¶ï¼š</p><table><thead><tr><th>éƒ¨ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>VERB</td><td>é€‚å½“çš„ HTTP <em>æ–¹æ³•</em> æˆ– <em>è°“è¯</em> : <code>GET</code>ã€ <code>POST</code>ã€ <code>PUT</code>ã€ <code>HEAD</code> æˆ–è€… <code>DELETE</code>ã€‚</td></tr><tr><td>PROTOCOL</td><td><code>http</code> æˆ–è€… <code>https</code>ï¼ˆå¦‚æœä½ åœ¨ Elasticsearch å‰é¢æœ‰ä¸€ä¸ª <code>https</code> ä»£ç†ï¼‰</td></tr><tr><td>HOST</td><td>Elasticsearch é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹çš„ä¸»æœºåï¼Œæˆ–è€…ç”¨ <code>localhost</code> ä»£è¡¨æœ¬åœ°æœºå™¨ä¸Šçš„èŠ‚ç‚¹ã€‚</td></tr><tr><td>PORT</td><td>è¿è¡Œ Elasticsearch HTTP æœåŠ¡çš„ç«¯å£å·ï¼Œé»˜è®¤æ˜¯ <code>9200</code> ã€‚</td></tr><tr><td>PATH</td><td>API çš„ç»ˆç«¯è·¯å¾„ï¼ˆä¾‹å¦‚ <code>_count</code> å°†è¿”å›é›†ç¾¤ä¸­æ–‡æ¡£æ•°é‡ï¼‰ã€‚Path å¯èƒ½åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œä¾‹å¦‚ï¼š<code>_cluster/stats</code> å’Œ <code>_nodes/stats/jvm</code> ã€‚</td></tr><tr><td>QUERY_STRING</td><td>ä»»æ„å¯é€‰çš„æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•° (ä¾‹å¦‚ <code>?pretty</code> å°†æ ¼å¼åŒ–åœ°è¾“å‡º JSON è¿”å›å€¼ï¼Œä½¿å…¶æ›´å®¹æ˜“é˜…è¯»)</td></tr><tr><td>BODY</td><td>ä¸€ä¸ª JSON æ ¼å¼çš„è¯·æ±‚ä½“ (å¦‚æœè¯·æ±‚éœ€è¦çš„è¯)</td></tr></tbody></table><p>å¯¹äºHTTPæ–¹æ³•ï¼Œå®ƒä»¬çš„å…·ä½“ä½œç”¨ä¸ºï¼š</p><table><thead><tr><th>HTTPæ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>GET</td><td>è·å–è¯·æ±‚å¯¹è±¡çš„å½“å‰çŠ¶æ€</td></tr><tr><td>POST</td><td>æ”¹å˜å¯¹è±¡çš„å½“å‰çŠ¶æ€</td></tr><tr><td>PUT</td><td>åˆ›å»ºä¸€ä¸ªå¯¹è±¡</td></tr><tr><td>DELETE</td><td>é”€æ¯å¯¹è±¡</td></tr><tr><td>HEAD</td><td>è¯·æ±‚è·å–å¯¹è±¡çš„åŸºç¡€ä¿¡æ¯</td></tr></tbody></table><p>æˆ‘ä»¬ä»¥ä¸‹é¢çš„æ•°æ®ä¸ºä¾‹ï¼Œæ¥å±•ç¤ºElasticsearchçš„ç”¨æ³•ã€‚</p><p><img src="/img/es1_4.png" alt=""></p><p>ä»¥ä¸‹å…¨éƒ¨çš„æ“ä½œéƒ½åœ¨Kibanaä¸­å®Œæˆï¼Œåˆ›å»ºçš„indexä¸ºconference, typeä¸ºevent .</p><h5 id="æ’å…¥æ•°æ®">æ’å…¥æ•°æ®</h5><p>é¦–å…ˆåˆ›å»ºindexä¸ºconference, åˆ›å»ºtypeä¸ºevent, æ’å…¥idä¸º1çš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œåªéœ€è¿è¡Œä¸‹é¢å‘½ä»¤å°±è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /conference/event/1<br>&#123;<br>  <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;Dave&quot;</span>,<br>  <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Elasticsearch at Rangespan and Exonar&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;Representatives from Rangespan and Exonar will come and discuss how they use Elasticsearch&quot;</span>,<br>  <span class="hljs-string">&quot;attendees&quot;</span>: [<span class="hljs-string">&quot;Dave&quot;</span>, <span class="hljs-string">&quot;Andrew&quot;</span>, <span class="hljs-string">&quot;David&quot;</span>, <span class="hljs-string">&quot;Clint&quot;</span>],<br>  <span class="hljs-string">&quot;date&quot;</span>: <span class="hljs-string">&quot;2013-06-24T18:30&quot;</span>,<br>  <span class="hljs-string">&quot;reviews&quot;</span>: 3<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œè·¯å¾„/conference/event/1è¡¨ç¤ºæ–‡æ¡£çš„indexä¸ºconference, typeä¸ºevent, idä¸º1. ç±»ä¼¼äºä¸Šé¢çš„æ“ä½œï¼Œä¾æ¬¡æ’å…¥å‰©ä½™çš„4æ¡æ•°æ®ï¼Œå®Œæˆæ’å…¥åï¼ŒæŸ¥çœ‹æ•°æ®å¦‚ä¸‹ï¼š</p><p><img src="/img/es1_5.png" alt="æ’å…¥æ•°æ®"></p><h5 id="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</h5><p>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦åˆ é™¤conferenceä¸­eventé‡Œé¢idä¸º5çš„æ•°æ®ï¼Œåªéœ€è¿è¡Œä¸‹é¢å‘½ä»¤å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE /conference/event/5<br></code></pre></td></tr></table></figure><p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;conference&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;event&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;result&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deleted&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_shards&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;total&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;successful&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;failed&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_seq_no&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_primary_term&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>è¡¨ç¤ºè¯¥æ–‡æ¡£å·²æˆåŠŸåˆ é™¤ã€‚å¦‚æœæƒ³åˆ é™¤æ•´ä¸ªeventç±»å‹ï¼Œå¯è¾“å…¥å‘½ä»¤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE /conference/event<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³åˆ é™¤æ•´ä¸ªconferenceç´¢å¼•ï¼Œå¯è¾“å…¥å‘½ä»¤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE /conference<br></code></pre></td></tr></table></figure><h5 id="ä¿®æ”¹æ•°æ®">ä¿®æ”¹æ•°æ®</h5><p>ä¿®æ”¹æ•°æ®çš„å‘½ä»¤ä¸ºPOST, æ¯”å¦‚æˆ‘ä»¬æƒ³è¦å°†conferenceä¸­eventé‡Œé¢idä¸º4çš„æ–‡æ¡£çš„ä½œè€…æ”¹ä¸ºBobï¼Œé‚£ä¹ˆéœ€è¦è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /conference/event/4/_update<br>&#123;<br>  <span class="hljs-string">&quot;doc&quot;</span>: &#123;<span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;Bob&quot;</span>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿”å›çš„ä¿¡æ¯å¦‚ä¸‹ï¼šï¼ˆè¡¨ç¤ºä¿®æ”¹æ•°æ®æˆåŠŸï¼‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;conference&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;event&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;result&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;updated&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_shards&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;total&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;successful&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;failed&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_seq_no&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_primary_term&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¿®æ”¹åçš„æ•°æ®å¦‚ä¸‹ï¼š</p><p><img src="/img/es1_6.png" alt="ä¿®æ”¹æ•°æ®"></p><h5 id="æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®</h5><p>æŸ¥è¯¢æ•°æ®çš„å‘½ä»¤ä¸ºGETï¼ŒæŸ¥è¯¢å‘½ä»¤ä¹Ÿæ˜¯Elasticsearchæœ€ä¸ºé‡è¦çš„åŠŸèƒ½ä¹‹ä¸€ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³æŸ¥è¯¢conferenceä¸­eventé‡Œé¢idä¸º1çš„æ•°æ®ï¼Œè¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /conference/event/1<br></code></pre></td></tr></table></figure><p>è¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;conference&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;event&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;found&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_source&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;host&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Dave&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;title&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Elasticsearch at Rangespan and Exonar&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Representatives from Rangespan and Exonar will come and discuss how they use Elasticsearch&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;attendees&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;Dave&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;Andrew&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;David&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;Clint&quot;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;date&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2013-06-24T18:30&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;reviews&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨_source å±æ€§ä¸­ï¼Œå†…å®¹æ˜¯åŸå§‹çš„ JSON æ–‡æ¡£ï¼Œè¿˜åŒ…å«æœ‰å…¶å®ƒå±æ€§ï¼Œæ¯”å¦‚_index, _type, _id, _foundç­‰ã€‚</p><p>å¦‚æœæƒ³è¦æœç´¢conferenceä¸­eventé‡Œé¢æ‰€æœ‰çš„æ–‡æ¡£ï¼Œè¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /conference/event/_search<br></code></pre></td></tr></table></figure><p>è¿”å›ç»“æœåŒ…æ‹¬äº†æ‰€æœ‰å››ä¸ªæ–‡æ¡£ï¼Œæ”¾åœ¨æ•°ç»„ hits ä¸­ã€‚</p><p>å½“ç„¶ï¼ŒElasticsearch æä¾›æ›´åŠ ä¸°å¯Œçµæ´»çš„æŸ¥è¯¢è¯­è¨€å«åš <em>æŸ¥è¯¢è¡¨è¾¾å¼</em> ï¼Œ å®ƒæ”¯æŒæ„å»ºæ›´åŠ å¤æ‚å’Œå¥å£®çš„æŸ¥è¯¢ã€‚åˆ©ç”¨<em>æŸ¥è¯¢è¡¨è¾¾å¼</em>ï¼Œæˆ‘ä»¬å¯ä»¥æ£€ç´¢å‡ºconferenceä¸­eventé‡Œé¢æ‰€æœ‰hostä¸ºBobçš„æ–‡æ¡£ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /conference/event/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;host&quot;</span> : <span class="hljs-string">&quot;Bob&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿”å›çš„ç»“æœåªåŒ…æ‹¬äº†ä¸€ä¸ªæ–‡æ¡£ï¼Œæ”¾åœ¨æ•°ç»„ hits ä¸­ã€‚</p><p>æ¥ç€ï¼Œè®©æˆ‘ä»¬å°è¯•ç¨å¾®é«˜çº§ç‚¹å„¿çš„å…¨æ–‡æœç´¢â€”â€”ä¸€é¡¹ä¼ ç»Ÿæ•°æ®åº“ç¡®å®å¾ˆéš¾æå®šçš„ä»»åŠ¡ã€‚æœç´¢ä¸‹æ‰€æœ‰descriptionä¸­å«æœ‰&quot;use Elasticsearch&quot;çš„eventï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /conference/event/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;description&quot;</span> : <span class="hljs-string">&quot;use Elasticsearch&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿”å›çš„ç»“æœï¼ˆéƒ¨åˆ†ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br> ...<br>  <span class="hljs-attr">&quot;hits&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;total&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;max_score&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0.65109104</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;hits&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        ...<br>        <span class="hljs-attr">&quot;_score&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0.65109104</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;_source&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;host&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Dave Nolan&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;title&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;real-time Elasticsearch&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;description&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;We will discuss using Elasticsearch to index data in real time&quot;</span><span class="hljs-punctuation">,</span><br>          ...<br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        ...<br>        <span class="hljs-attr">&quot;_score&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0.5753642</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;_source&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;host&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Dave&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;title&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Elasticsearch at Rangespan and Exonar&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;description&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Representatives from Rangespan and Exonar will come and discuss how they use Elasticsearch&quot;</span><span class="hljs-punctuation">,</span><br>          ...<br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><p>è¿”å›çš„ç»“æœåŒ…å«äº†ä¸¤ä¸ªæ–‡æ¡£ï¼Œæ”¾åœ¨æ•°ç»„ hits ä¸­ã€‚è®©æˆ‘ä»¬å¯¹è¿™ä¸ªç»“æœåšä¸€äº›åˆ†æï¼Œç¬¬ä¸€ä¸ªæ–‡æ¡£çš„descriptioné‡Œé¢å«æœ‰â€œusing Elasticsearchâ€ï¼Œè¿™ä¸ªèƒ½åŒ¹é…â€œuse Elasticsearchâ€æ˜¯å› ä¸ºElasticsearchå«æœ‰å†…ç½®çš„è¯å¹²æå–ç®—æ³•ï¼Œä¹‹åä¸¤ä¸ªæ–‡æ¡£æŒ‰_scoreè¿›è¡Œæ’åºï¼Œ_scoreå­—æ®µè¡¨ç¤ºæ–‡æ¡£çš„ç›¸ä¼¼åº¦ï¼ˆé»˜è®¤çš„ç›¸ä¼¼åº¦ç®—æ³•ä¸ºBM25ï¼‰ã€‚</p><p>å¦‚æœæƒ³æœç´¢ä¸‹æ‰€æœ‰descriptionä¸­ä¸¥æ ¼å«æœ‰&quot;use Elasticsearch&quot;è¿™ä¸ªçŸ­è¯­çš„eventï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /conference/event/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match_phrase&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;description&quot;</span> : <span class="hljs-string">&quot;use Elasticsearch&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™è¿”å›çš„ç»“æœåªæœ‰ä¸€ä¸ªæ–‡æ¡£ï¼Œå°±æ˜¯ä¸Šé¢è¾“å‡ºçš„ç¬¬äºŒä¸ªæ–‡æ¡£ã€‚</p><p>å½“ç„¶ï¼ŒElasticsearchè¿˜æ”¯æŒæ›´å¤šçš„æœç´¢åŠŸèƒ½ï¼Œæ¯”å¦‚è¿‡æ»¤å™¨ï¼Œé«˜äº®æœç´¢ï¼Œç»“æ„åŒ–æœç´¢ç­‰ï¼Œå¸Œæœ›æ¥ä¸‹æ¥èƒ½æœ‰æ›´å¤šçš„æ—¶é—´å’Œç»å†æ¥ä»‹ç»~</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>åç»­æœ‰æœºä¼šå†ä»‹ç»å¦‚ä½•åˆ©ç”¨Pythonæ¥æ“ä½œElasticsearch~</p><p>æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»~</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼š NLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Elasticsearch</tag>
      
      <tag>Kibana</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åäºŒï¼‰HuggingFaceä¸­çš„Datasetsä½¿ç”¨</title>
    <link href="/2023/07/24/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%BA%8C%EF%BC%89HuggingFace%E4%B8%AD%E7%9A%84Datasets%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/07/24/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%BA%8C%EF%BC%89HuggingFace%E4%B8%AD%E7%9A%84Datasets%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>Datasets</code>åº“æ˜¯<code>HuggingFace</code>ç”Ÿæ€ç³»ç»Ÿä¸­ä¸€ä¸ªé‡è¦çš„æ•°æ®é›†åº“ï¼Œå¯ç”¨äºè½»æ¾åœ°è®¿é—®å’Œå…±äº«æ•°æ®é›†ï¼Œè¿™äº›æ•°æ®é›†æ˜¯å…³äºéŸ³é¢‘ã€è®¡ç®—æœºè§†è§‰ã€ä»¥åŠè‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸã€‚<code>Datasets</code>åº“å¯ä»¥é€šè¿‡ä¸€è¡Œæ¥åŠ è½½ä¸€ä¸ªæ•°æ®é›†ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ <code>Hugging Face</code>å¼ºå¤§çš„æ•°æ®å¤„ç†æ–¹æ³•æ¥å¿«é€Ÿå‡†å¤‡å¥½ä½ çš„æ•°æ®é›†ã€‚åœ¨ <code>Apache Arrow</code>æ ¼å¼çš„æ”¯æŒä¸‹ï¼Œé€šè¿‡ <code>zero-copy read</code>æ¥å¤„ç†å¤§å‹æ•°æ®é›†ï¼Œè€Œæ²¡æœ‰ä»»ä½•å†…å­˜é™åˆ¶ï¼Œä»è€Œå®ç°æœ€ä½³é€Ÿåº¦å’Œæ•ˆç‡ã€‚</p><p>å½“éœ€è¦å¾®è°ƒæ¨¡å‹çš„æ—¶å€™ï¼Œéœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ol type="1"><li>æ•°æ®é›†åŠ è½½ï¼šä¸‹è½½ã€åŠ è½½æ•°æ®é›†</li><li>æ•°æ®é›†é¢„å¤„ç†ï¼šä½¿ç”¨Dataset.map() é¢„å¤„ç†æ•°æ®</li><li>æ•°æ®é›†è¯„ä¼°æŒ‡æ ‡ï¼šåŠ è½½å’Œè®¡ç®—æŒ‡æ ‡</li></ol><p>å¯ä»¥åœ¨HuggingFaceå®˜ç½‘æ¥æœå…±äº«ç´¢æ•°æ®é›†ï¼š<ahref="https://huggingface.co/datasets"class="uri">https://huggingface.co/datasets</a>ã€‚æœ¬æ–‡ä¸­ä½¿ç”¨çš„ä¸»è¦æ•°æ®é›†ä¸º<code>squad</code>æ•°æ®é›†ï¼Œå…¶åœ¨HuggingFaceç½‘ç«™ä¸Šçš„æ•°æ®å‰å‡ è¡Œå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp62_1.png" alt="squadæ•°æ®é›†å‰å‡ è¡Œ" /><figcaption aria-hidden="true">squadæ•°æ®é›†å‰å‡ è¡Œ</figcaption></figure><h3 id="åŠ è½½æ•°æ®">åŠ è½½æ•°æ®</h3><ul><li>åŠ è½½Datasetæ•°æ®é›†</li></ul><p>Datasetæ•°æ®é›†å¯ä»¥æ˜¯HuggingFaceDatasetsç½‘ç«™ä¸Šçš„æ•°æ®é›†æˆ–è€…æ˜¯æœ¬åœ°è·¯å¾„å¯¹åº”çš„æ•°æ®é›†ï¼Œä¹Ÿå¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªæ•°æ®é›†ã€‚</p><p>ä»¥ä¸‹æ˜¯åŠ è½½è‹±è¯­é˜…è¯»ç†è§£æ•°æ®é›†<code>squad</code>ï¼Œ è¯¥æ•°æ®é›†çš„ç½‘å€ä¸ºï¼š<ahref="https://huggingface.co/datasets/squad"class="uri">https://huggingface.co/datasets/squad</a>ï¼Œä¹Ÿæ˜¯æœ¬æ–‡ä¸­ä½¿ç”¨çš„ä¸»è¦æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datasets<br><br><span class="hljs-comment"># åŠ è½½å•ä¸ªæ•°æ®é›†</span><br>raw_datasets = datasets.load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><span class="hljs-comment"># åŠ è½½å¤šä¸ªæ•°æ®é›†</span><br>raw_datasets = datasets.load_dataset(<span class="hljs-string">&#x27;glue&#x27;</span>, <span class="hljs-string">&#x27;mrpc&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>ä»æ–‡ä»¶ä¸­åŠ è½½æ•°æ®</li></ul><p>æ”¯æŒcsv, tsv, txt, json, jsonlç­‰æ ¼å¼çš„æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>data_files = &#123;<span class="hljs-string">&quot;train&quot;</span>: <span class="hljs-string">&quot;./data/sougou_mini/train.csv&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;./data/sougou_mini/test.csv&quot;</span>&#125;<br>drug_dataset = load_dataset(<span class="hljs-string">&quot;csv&quot;</span>, data_files=data_files, delimiter=<span class="hljs-string">&quot;,&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>ä»Dataframeä¸­åŠ è½½æ•°æ®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> Dataset <br><br>my_dict = &#123;<span class="hljs-string">&quot;a&quot;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-string">&quot;b&quot;</span>: [<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>]&#125; <br>dataset1 = Dataset.from_dict(my_dict) <br> <br>df = pd.DataFrame(my_dict) <br>dataset2 = Dataset.from_pandas(df)<br></code></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ•°æ®">æŸ¥çœ‹æ•°æ®</h3><ul><li>æ•°æ®ç»“æ„</li></ul><p>æ•°æ®ç»“æ„åŒ…æ‹¬ï¼š</p><ol type="1"><li>æ•°æ®é›†çš„åˆ’åˆ†ï¼štrainï¼Œvalidï¼Œtestæ•°æ®é›†</li><li>æ•°æ®é›†çš„æ•°é‡</li><li>æ•°æ®é›†çš„feature</li></ol><p><code>squad</code>æ•°æ®çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">DatasetDict(<span class="hljs-punctuation">&#123;</span><br>    train<span class="hljs-punctuation">:</span> Dataset(<span class="hljs-punctuation">&#123;</span><br>        features<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>&#x27;id&#x27;<span class="hljs-punctuation">,</span> &#x27;title&#x27;<span class="hljs-punctuation">,</span> &#x27;context&#x27;<span class="hljs-punctuation">,</span> &#x27;question&#x27;<span class="hljs-punctuation">,</span> &#x27;answers&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        num_rows<span class="hljs-punctuation">:</span> <span class="hljs-number">87599</span><br>    <span class="hljs-punctuation">&#125;</span>)<br>    validation<span class="hljs-punctuation">:</span> Dataset(<span class="hljs-punctuation">&#123;</span><br>        features<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>&#x27;id&#x27;<span class="hljs-punctuation">,</span> &#x27;title&#x27;<span class="hljs-punctuation">,</span> &#x27;context&#x27;<span class="hljs-punctuation">,</span> &#x27;question&#x27;<span class="hljs-punctuation">,</span> &#x27;answers&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        num_rows<span class="hljs-punctuation">:</span> <span class="hljs-number">10570</span><br>    <span class="hljs-punctuation">&#125;</span>)<br><span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®åˆ‡åˆ†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datasets<br><br>raw_dataset = datasets.load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><br><span class="hljs-comment"># è·å–æŸä¸ªåˆ’åˆ†æ•°æ®é›†ï¼Œæ¯”å¦‚train</span><br>train_dataset = raw_dataset[<span class="hljs-string">&#x27;train&#x27;</span>]<br><span class="hljs-comment"># è·å–å‰10æ¡æ•°æ®</span><br>head_dataset = train_dataset.select(<span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))<br><span class="hljs-comment"># è·å–éšæœº10æ¡æ•°æ®</span><br>shuffle_dataset = train_dataset.shuffle(seed=<span class="hljs-number">42</span>).select(<span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))<br><span class="hljs-comment"># æ•°æ®åˆ‡ç‰‡</span><br>slice_dataset = train_dataset[<span class="hljs-number">10</span>:<span class="hljs-number">20</span>]<br></code></pre></td></tr></table></figure><h3 id="æ›´å¤šç‰¹æ€§">æ›´å¤šç‰¹æ€§</h3><ul><li>æ•°æ®æ‰“ä¹±ï¼ˆshuffleï¼‰</li></ul><p>shuffleçš„åŠŸèƒ½æ˜¯æ‰“ä¹±datasetsä¸­çš„æ•°æ®ï¼Œå…¶ä¸­seedæ˜¯è®¾ç½®æ‰“ä¹±çš„å‚æ•°ï¼Œå¦‚æœè®¾ç½®æ‰“ä¹±çš„seedæ˜¯ç›¸åŒçš„ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå®Œå…¨ç›¸åŒçš„æ‰“ä¹±ç»“æœï¼Œè¿™æ ·ç”¨ç›¸åŒçš„æ‰“ä¹±ç»“æœæ‰èƒ½é‡å¤çš„è¿›è¡Œæ¨¡å‹è¯•éªŒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datasets<br><br>raw_dataset = datasets.load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><span class="hljs-comment"># æ‰“ä¹±æ•°æ®é›†</span><br>shuffle_dataset = train_dataset.shuffle(seed=<span class="hljs-number">42</span>)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®æµï¼ˆstreamï¼‰</li></ul><p>streamçš„åŠŸèƒ½æ˜¯å°†æ•°æ®é›†è¿›è¡Œæµå¼åŒ–ï¼Œå¯ä»¥ä¸ç”¨åœ¨ä¸‹è½½æ•´ä¸ªæ•°æ®é›†çš„æƒ…å†µä¸‹ä½¿ç”¨è¯¥æ•°æ®é›†ã€‚è¿™åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼š</p><ol type="1"><li>ä½ ä¸æƒ³ç­‰å¾…æ•´ä¸ªåºå¤§çš„æ•°æ®é›†ä¸‹è½½å®Œæ¯•</li><li>æ•°æ®é›†å¤§å°è¶…è¿‡äº†ä½ è®¡ç®—æœºçš„å¯ç”¨ç¡¬ç›˜ç©ºé—´</li><li>ä½ æƒ³å¿«é€Ÿæ¢ç´¢æ•°æ®é›†çš„å°‘æ•°æ ·æœ¬</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>dataset = load_dataset(<span class="hljs-string">&#x27;oscar-corpus/OSCAR-2201&#x27;</span>, <span class="hljs-string">&#x27;en&#x27;</span>, split=<span class="hljs-string">&#x27;train&#x27;</span>, streaming=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(<span class="hljs-built_in">iter</span>(dataset)))<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®åˆ—é‡å‘½åï¼ˆrename columnsï¼‰</li></ul><p>æ•°æ®é›†æ”¯æŒå¯¹åˆ—é‡å‘½åã€‚ä¸‹é¢çš„ä»£ç å°†<code>squad</code>æ•°æ®é›†ä¸­çš„contextåˆ—é‡å‘½åä¸ºtextï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br>squad = squad.rename_column(<span class="hljs-string">&#x27;context&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®ä¸¢å¼ƒåˆ—ï¼ˆdrop columnsï¼‰</li></ul><p>æ•°æ®é›†æ”¯æŒå¯¹åˆ—è¿›è¡Œä¸¢å¼ƒï¼Œåœ¨åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—æ—¶ï¼Œå‘<code>remove_columns()</code>å‡½æ•°æä¾›è¦åˆ é™¤çš„åˆ—åã€‚å•ä¸ªåˆ—åˆ é™¤ä¼ å…¥åˆ—åï¼Œå¤šä¸ªåˆ—åˆ é™¤ä¼ å…¥åˆ—åçš„åˆ—è¡¨ã€‚ä¸‹é¢çš„ä»£ç å°†<code>squad</code>æ•°æ®é›†ä¸­çš„idåˆ—ä¸¢å¼ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><span class="hljs-comment"># åˆ é™¤ä¸€ä¸ªåˆ—</span><br>squad = squad.remove_columns(<span class="hljs-string">&#x27;id&#x27;</span>)<br><span class="hljs-comment"># åˆ é™¤å¤šä¸ªåˆ—</span><br>squad = squad.remove_columns([<span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>])<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®æ–°å¢åˆ—ï¼ˆadd new columnsï¼‰</li></ul><p>æ•°æ®é›†æ”¯æŒæ–°å¢åˆ—ã€‚ä¸‹é¢çš„ä»£ç åœ¨<code>squad</code>æ•°æ®é›†ä¸Šæ–°å¢ä¸€åˆ—testï¼Œå†…å®¹å…¨ä¸ºå­—ç¬¦ä¸²111ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><span class="hljs-comment"># æ–°å¢åˆ—</span><br>new_train_squad = squad[<span class="hljs-string">&#x27;train&#x27;</span>].add_column(<span class="hljs-string">&quot;test&quot;</span>, [<span class="hljs-string">&#x27;111&#x27;</span>] * squad[<span class="hljs-string">&#x27;train&#x27;</span>].num_rows)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®ç±»å‹è½¬æ¢ï¼ˆcastï¼‰</li></ul><p><code>cast()</code>å‡½æ•°å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—çš„ç‰¹å¾ç±»å‹è¿›è¡Œè½¬æ¢ã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä½ çš„æ–°ç‰¹å¾ä½œä¸ºå…¶å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><span class="hljs-comment"># æ–°å¢åˆ—</span><br>new_train_squad = squad[<span class="hljs-string">&#x27;train&#x27;</span>].add_column(<span class="hljs-string">&quot;test&quot;</span>, [<span class="hljs-string">&#x27;111&#x27;</span>] * squad[<span class="hljs-string">&#x27;train&#x27;</span>].num_rows)<br><span class="hljs-built_in">print</span>(new_train_squad.features)<br><span class="hljs-comment"># è½¬æ¢teståˆ—çš„æ•°æ®ç±»å‹</span><br>new_features = new_train_squad.features.copy()<br>new_features[<span class="hljs-string">&quot;test&quot;</span>] = Value(<span class="hljs-string">&quot;int64&quot;</span>)<br>new_train_squad = new_train_squad.cast(new_features)<br><span class="hljs-comment"># è¾“å‡ºè½¬æ¢åçš„æ•°æ®ç±»å‹</span><br><span class="hljs-built_in">print</span>(new_train_squad.features)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®å±•å¹³ï¼ˆflattenï¼‰</li></ul><p>é’ˆå¯¹åµŒå¥—ç»“æ„çš„æ•°æ®ç±»å‹ï¼Œå¯ä½¿ç”¨<code>flatten()</code>å‡½æ•°å°†å­å­—æ®µæå–åˆ°å®ƒä»¬è‡ªå·±çš„ç‹¬ç«‹åˆ—ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br>flatten_dataset = squad[<span class="hljs-string">&#x27;train&#x27;</span>].flatten()<br><span class="hljs-built_in">print</span>(flatten_dataset)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Dataset(&#123;<br>    features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;context&#x27;</span>, <span class="hljs-string">&#x27;question&#x27;</span>, <span class="hljs-string">&#x27;answers.text&#x27;</span>, <span class="hljs-string">&#x27;answers.answer_start&#x27;</span>],<br>    num_rows: 87599<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®åˆå¹¶ï¼ˆConcatenate Multiple Datasetsï¼‰</li></ul><p>å¦‚æœç‹¬ç«‹çš„æ•°æ®é›†æœ‰ç›¸åŒçš„åˆ—ç±»å‹ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥è¢«ä¸²è”èµ·æ¥ã€‚ç”¨<code>concatenate_datasets()</code>æ¥è¿æ¥ä¸åŒçš„æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> concatenate_datasets, load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br>squad_v2 = load_dataset(<span class="hljs-string">&#x27;squad_v2&#x27;</span>)<br><span class="hljs-comment"># åˆå¹¶æ•°æ®é›†</span><br>squad_all = concatenate_datasets([squad[<span class="hljs-string">&#x27;train&#x27;</span>], squad_v2[<span class="hljs-string">&#x27;train&#x27;</span>]])<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®è¿‡æ»¤ï¼ˆfilterï¼‰</li></ul><p><code>filter()</code>å‡½æ•°æ”¯æŒå¯¹æ•°æ®é›†è¿›è¡Œè¿‡æ»¤ï¼Œä¸€èˆ¬é‡‡ç”¨lambdaå‡½æ•°å®ç°ã€‚ä¸‹é¢çš„ä»£ç å¯¹<code>squad</code>æ•°æ®é›†ä¸­çš„è®­ç»ƒé›†çš„questionå­—æ®µï¼Œè¿‡æ»¤æ‰splitåé•¿åº¦å°äºç­‰äº10çš„æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br>filter_dataset = squad[<span class="hljs-string">&#x27;train&#x27;</span>].<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x[<span class="hljs-string">&quot;question&quot;</span>].split()) &gt; <span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Dataset(&#123;<br>    features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;context&#x27;</span>, <span class="hljs-string">&#x27;question&#x27;</span>, <span class="hljs-string">&#x27;answers&#x27;</span>],<br>    num_rows: 34261<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®æ’åºï¼ˆsortï¼‰</li></ul><p>ä½¿ç”¨<code>sort()</code>å¯¹åˆ—å€¼æ ¹æ®å…¶æ•°å€¼è¿›è¡Œæ’åºã€‚ä¸‹é¢çš„ä»£ç æ˜¯å¯¹<code>squad</code>æ•°æ®é›†ä¸­çš„è®­ç»ƒé›†æŒ‰ç…§æ ‡é¢˜é•¿åº¦è¿›è¡Œæ’åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><span class="hljs-comment"># æ–°å¢åˆ—, title_length, æ ‡é¢˜é•¿åº¦</span><br>new_train_squad = squad[<span class="hljs-string">&#x27;train&#x27;</span>].add_column(<span class="hljs-string">&quot;title_length&quot;</span>, [<span class="hljs-built_in">len</span>(_) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> squad[<span class="hljs-string">&#x27;train&#x27;</span>][<span class="hljs-string">&#x27;title&#x27;</span>]])<br><span class="hljs-comment"># æŒ‰ç…§title_lengthæ’åº</span><br>new_train_squad = new_train_squad.sort(<span class="hljs-string">&quot;title_length&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®æ ¼å¼ï¼ˆset_formatï¼‰</li></ul><p><code>set_format()</code>å‡½æ•°æ”¹å˜äº†ä¸€ä¸ªåˆ—çš„æ ¼å¼ï¼Œä½¿ä¹‹ä¸ä¸€äº›å¸¸è§çš„æ•°æ®æ ¼å¼å…¼å®¹ã€‚åœ¨ç±»å‹å‚æ•°ä¸­æŒ‡å®šä½ æƒ³è¦çš„è¾“å‡ºå’Œä½ æƒ³è¦æ ¼å¼åŒ–çš„åˆ—ã€‚æ ¼å¼åŒ–æ˜¯å³æ—¶åº”ç”¨çš„ã€‚æ”¯æŒçš„æ•°æ®æ ¼å¼æœ‰ï¼šNone,numpy, torch, tensorflow, pandas, arrow,å¦‚æœé€‰æ‹©Noneï¼Œå°±ä¼šè¿”å›pythonå¯¹è±¡ã€‚</p><p>ä¸‹é¢çš„ä»£ç å°†æ–°å¢æ ‡é¢˜é•¿åº¦åˆ—ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºnumpyæ ¼å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><br>squad = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><span class="hljs-comment"># æ–°å¢åˆ—, title_length, æ ‡é¢˜é•¿åº¦</span><br>new_train_squad = squad[<span class="hljs-string">&#x27;train&#x27;</span>].add_column(<span class="hljs-string">&quot;title_length&quot;</span>, [<span class="hljs-built_in">len</span>(_) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> squad[<span class="hljs-string">&#x27;train&#x27;</span>][<span class="hljs-string">&#x27;title&#x27;</span>]])<br><span class="hljs-comment"># è½¬æ¢ä¸ºnumpyæ”¯æŒçš„æ•°æ®æ ¼å¼</span><br>new_train_squad.set_format(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;numpy&quot;</span>, columns=[<span class="hljs-string">&quot;title_length&quot;</span>])<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®æŒ‡æ ‡ï¼ˆload metricsï¼‰</li></ul><p><a href="https://huggingface.co/metrics">HuggingFaceHub</a>ä¸Šæä¾›äº†ä¸€ç³»åˆ—çš„è¯„ä¼°æŒ‡æ ‡ï¼ˆmetricsï¼‰ï¼Œå‰20ä¸ªæŒ‡æ ‡å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> list_metrics<br>metrics_list = list_metrics()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;, &#x27;</span>.join(metric <span class="hljs-keyword">for</span> metric <span class="hljs-keyword">in</span> metrics_list[:<span class="hljs-number">20</span>]))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">accuracy, bertscore, bleu, bleurt, brier_score, cer, character, charcut_mt, chrf, code_eval, comet, competition_math, coval, cuad, exact_match, f1, frugalscore, glue, google_bleu, indic_glue<br></code></pre></td></tr></table></figure><p>ä»Hubä¸­åŠ è½½ä¸€ä¸ªæŒ‡æ ‡ï¼Œä½¿ç”¨ <ahref="https://huggingface.co/docs/datasets/v1.0.1/package_reference/loading_methods.html#datasets.load_metric"title="datasets.load_metric"><code>datasets.load_metric()</code></a>å‘½ä»¤ï¼Œæ¯”å¦‚åŠ è½½<code>squad</code>æ•°æ®é›†çš„æŒ‡æ ‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_metric<br>metric = load_metric(<span class="hljs-string">&#x27;squad&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">Metric(name: <span class="hljs-string">&quot;squad&quot;</span>, features: &#123;<span class="hljs-string">&#x27;predictions&#x27;</span>: &#123;<span class="hljs-string">&#x27;id&#x27;</span>: Value(dtype=<span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-built_in">id</span>=None), <span class="hljs-string">&#x27;prediction_text&#x27;</span>: Value(dtype=<span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-built_in">id</span>=None)&#125;, <span class="hljs-string">&#x27;references&#x27;</span>: &#123;<span class="hljs-string">&#x27;id&#x27;</span>: Value(dtype=<span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-built_in">id</span>=None), <span class="hljs-string">&#x27;answers&#x27;</span>: Sequence(feature=&#123;<span class="hljs-string">&#x27;text&#x27;</span>: Value(dtype=<span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-built_in">id</span>=None), <span class="hljs-string">&#x27;answer_start&#x27;</span>: Value(dtype=<span class="hljs-string">&#x27;int32&#x27;</span>, <span class="hljs-built_in">id</span>=None)&#125;, length=-1, <span class="hljs-built_in">id</span>=None)&#125;&#125;, usage: <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">Computes SQuAD scores (F1 and EM).</span><br><span class="hljs-string">Args:</span><br><span class="hljs-string">    predictions: List of question-answers dictionaries with the following key-values:</span><br><span class="hljs-string">        - &#x27;id&#x27;: id of the question-answer pair as given in the references (see below)</span><br><span class="hljs-string">        - &#x27;prediction_text&#x27;: the text of the answer</span><br><span class="hljs-string">    references: List of question-answers dictionaries with the following key-values:</span><br><span class="hljs-string">        - &#x27;id&#x27;: id of the question-answer pair (see above),</span><br><span class="hljs-string">        - &#x27;answers&#x27;: a Dict in the SQuAD dataset format</span><br><span class="hljs-string">            &#123;</span><br><span class="hljs-string">                &#x27;text&#x27;: list of possible texts for the answer, as a list of strings</span><br><span class="hljs-string">                &#x27;answer_start&#x27;: list of start positions for the answer, as a list of ints</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">            Note that answer_start values are not taken into account to compute the metric.</span><br><span class="hljs-string">Returns:</span><br><span class="hljs-string">    &#x27;exact_match&#x27;: Exact match (the normalized answer exactly match the gold answer)</span><br><span class="hljs-string">    &#x27;f1&#x27;: The F-score of predicted tokens versus the gold answer</span><br><span class="hljs-string">Examples:</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &gt;&gt;&gt; predictions = [&#123;&#x27;prediction_text&#x27;: &#x27;1976&#x27;, &#x27;id&#x27;: &#x27;56e10a3be3433e1400422b22&#x27;&#125;]</span><br><span class="hljs-string">    &gt;&gt;&gt; references = [&#123;&#x27;answers&#x27;: &#123;&#x27;answer_start&#x27;: [97], &#x27;text&#x27;: [&#x27;1976&#x27;]&#125;, &#x27;id&#x27;: &#x27;56e10a3be3433e1400422b22&#x27;&#125;]</span><br><span class="hljs-string">    &gt;&gt;&gt; squad_metric = datasets.load_metric(&quot;</span>squad<span class="hljs-string">&quot;)</span><br><span class="hljs-string">    &gt;&gt;&gt; results = squad_metric.compute(predictions=predictions, references=references)</span><br><span class="hljs-string">    &gt;&gt;&gt; print(results)</span><br><span class="hljs-string">    &#123;&#x27;exact_match&#x27;: 100.0, &#x27;f1&#x27;: 100.0&#125;</span><br><span class="hljs-string">&quot;</span><span class="hljs-string">&quot;&quot;</span>, stored examples: 0)<br></code></pre></td></tr></table></figure><p>load_metricè¿˜æ”¯æŒåˆ†å¸ƒå¼è®¡ç®—ï¼Œæœ¬æ–‡ä¸å†è¯¦ç»†è®²è¿°ã€‚</p><p>load_metricç°åœ¨å·²ç»æ˜¯è€ç‰ˆæœ¬äº†ï¼Œæ–°ç‰ˆæœ¬å°†ç”¨<code>evaluate</code>æ¨¡å—ä»£æ›¿ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://github.com/huggingface/evaluate"class="uri">https://github.com/huggingface/evaluate</a> ã€‚</p><ul><li>æ•°æ®æ˜ å°„ï¼ˆmapï¼‰</li></ul><p>mapå°±æ˜¯æ˜ å°„ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼ŒDatasetä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šè¢«å½“ä½œè¿™ä¸ªå‡½æ•°çš„è¾“å…¥ï¼Œå¹¶å°†å‡½æ•°è¿”å›å€¼ä½œä¸ºæ–°çš„Datasetã€‚å¸¸è§çš„mapå‡½æ•°çš„åº”ç”¨æ˜¯å¯¹æ–‡æœ¬è¿›è¡Œtokenizeï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer<br><br>squad_dataset = load_dataset(<span class="hljs-string">&#x27;squad&#x27;</span>)<br><br>checkpoint = <span class="hljs-string">&#x27;bert-base-cased&#x27;</span><br>tokenizer = AutoTokenizer.from_pretrained(checkpoint)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize_function</span>(<span class="hljs-params">sample</span>):<br>    <span class="hljs-keyword">return</span> tokenizer(sample[<span class="hljs-string">&#x27;context&#x27;</span>], truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">256</span>)<br><br>tokenized_dataset = squad_dataset.<span class="hljs-built_in">map</span>(tokenize_function, batched=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">DatasetDict(&#123;<br>    train: Dataset(&#123;<br>        features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;context&#x27;</span>, <span class="hljs-string">&#x27;question&#x27;</span>, <span class="hljs-string">&#x27;answers&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;token_type_ids&#x27;</span>, <span class="hljs-string">&#x27;attention_mask&#x27;</span>],<br>        num_rows: 87599<br>    &#125;)<br>    validation: Dataset(&#123;<br>        features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;context&#x27;</span>, <span class="hljs-string">&#x27;question&#x27;</span>, <span class="hljs-string">&#x27;answers&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;token_type_ids&#x27;</span>, <span class="hljs-string">&#x27;attention_mask&#x27;</span>],<br>        num_rows: 10570<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®ä¿å­˜/åŠ è½½ï¼ˆsave to disk/ load from diskï¼‰</li></ul><p>ä½¿ç”¨<code>save_to_disk()</code>æ¥ä¿å­˜æ•°æ®é›†ï¼Œæ–¹ä¾¿åœ¨ä»¥åé‡æ–°ä½¿ç”¨å®ƒ,ä½¿ç”¨<code>load_from_disk()</code>å‡½æ•°é‡æ–°åŠ è½½æ•°æ®é›†ã€‚æˆ‘ä»¬å°†ä¸Šé¢mapåçš„tokenized_datasetæ•°æ®é›†è¿›è¡Œä¿å­˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">tokenized_dataset.save_to_disk(<span class="hljs-string">&quot;squad_tokenized&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¿å­˜åçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">squad_tokenized/<br>â”œâ”€â”€ dataset_dict.json<br>â”œâ”€â”€ train<br>â”‚   â”œâ”€â”€ data-00000-of-00001.arrow<br>â”‚   â”œâ”€â”€ dataset_info.json<br>â”‚   â””â”€â”€ state.json<br>â””â”€â”€ validation<br>    â”œâ”€â”€ data-00000-of-00001.arrow<br>    â”œâ”€â”€ dataset_info.json<br>    â””â”€â”€ state.json<br></code></pre></td></tr></table></figure><p>åŠ è½½æ•°æ®çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_from_disk<br>reloaded_dataset = load_from_disk(<span class="hljs-string">&quot;squad_tokenized&quot;</span>) <br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡å¯ä½œä¸ºdatasetåº“çš„å…¥é—¨ï¼Œè¯¦ç»†ä»‹ç»äº†æ•°æ®é›†çš„å„ç§æ“ä½œï¼Œè¿™æ ·æ–¹ä¾¿åç»­è¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>Datasets: <ahref="https://www.huaxiaozhuan.com/%E5%B7%A5%E5%85%B7/huggingface_transformer/chapters/2_datasets.html"class="uri">https://www.huaxiaozhuan.com/%E5%B7%A5%E5%85%B7/huggingface_transformer/chapters/2_datasets.html</a></li><li>Huggingfaceè¯¦ç»†å…¥é—¨ä»‹ç»ä¹‹datasetåº“ï¼š<ahref="https://zhuanlan.zhihu.com/p/554678463"class="uri">https://zhuanlan.zhihu.com/p/554678463</a></li><li>Stream: <a href="https://huggingface.co/docs/datasets/stream"class="uri">https://huggingface.co/docs/datasets/stream</a></li><li>HuggingFaceæ•™ç¨‹ DatasetsåŸºæœ¬æ“ä½œ: Process: <ahref="https://zhuanlan.zhihu.com/p/557032513"class="uri">https://zhuanlan.zhihu.com/p/557032513</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>HuggingFace</tag>
      
      <tag>Datasets</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šä½ ä¸€å®šæƒ³çŸ¥é“çš„æ—¥æœ¬æ–‡å­¦ç®€å²ã€‹æ‘˜æŠ„</title>
    <link href="/2023/07/23/%E3%80%8A%E4%BD%A0%E4%B8%80%E5%AE%9A%E6%83%B3%E7%9F%A5%E9%81%93%E7%9A%84%E6%97%A5%E6%9C%AC%E6%96%87%E5%AD%A6%E7%AE%80%E5%8F%B2%E3%80%8B%E6%91%98%E6%8A%84/"/>
    <url>/2023/07/23/%E3%80%8A%E4%BD%A0%E4%B8%80%E5%AE%9A%E6%83%B3%E7%9F%A5%E9%81%93%E7%9A%84%E6%97%A5%E6%9C%AC%E6%96%87%E5%AD%A6%E7%AE%80%E5%8F%B2%E3%80%8B%E6%91%98%E6%8A%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šä½ ä¸€å®šæƒ³çŸ¥é“çš„æ—¥æœ¬æ–‡å­¦ç®€å²ã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šä½ ä¸€å®šæƒ³çŸ¥é“çš„æ—¥æœ¬æ–‡å­¦ç®€å²ã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šå¤§è‹±åšç‰©é¦†æ—¥è®°ï¼šå¤–äºŒç§ã€‹æ‘˜æŠ„</title>
    <link href="/2023/07/23/%E3%80%8A%E5%A4%A7%E8%8B%B1%E5%8D%9A%E7%89%A9%E9%A6%86%E6%97%A5%E8%AE%B0%EF%BC%9A%E5%A4%96%E4%BA%8C%E7%A7%8D%E3%80%8B%E6%91%98%E8%A6%81/"/>
    <url>/2023/07/23/%E3%80%8A%E5%A4%A7%E8%8B%B1%E5%8D%9A%E7%89%A9%E9%A6%86%E6%97%A5%E8%AE%B0%EF%BC%9A%E5%A4%96%E4%BA%8C%E7%A7%8D%E3%80%8B%E6%91%98%E8%A6%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šå¤§è‹±åšç‰©é¦†æ—¥è®°ï¼šå¤–äºŒç§ã€‹æ‘˜è¦.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šå¤§è‹±åšç‰©é¦†æ—¥è®°ï¼šå¤–äºŒç§ã€‹æ‘˜è¦.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šå°æ¹¾æˆ˜åä¸ƒåå¹´ã€‹æ‘˜æŠ„</title>
    <link href="/2023/07/23/%E3%80%8A%E5%8F%B0%E6%B9%BE%E6%88%98%E5%90%8E%E4%B8%83%E5%8D%81%E5%B9%B4%E3%80%8B%E6%91%98%E6%8A%84/"/>
    <url>/2023/07/23/%E3%80%8A%E5%8F%B0%E6%B9%BE%E6%88%98%E5%90%8E%E4%B8%83%E5%8D%81%E5%B9%B4%E3%80%8B%E6%91%98%E6%8A%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šå°æ¹¾æˆ˜åä¸ƒåå¹´ã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šå°æ¹¾æˆ˜åä¸ƒåå¹´ã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šä¸­å…±å…šå²çé—»å½•ã€‹æ‘˜æŠ„</title>
    <link href="/2023/07/23/%E3%80%8A%E4%B8%AD%E5%85%B1%E5%85%9A%E5%8F%B2%E7%8F%8D%E9%97%BB%E5%BD%95%E3%80%8B%E6%91%98%E6%8A%84/"/>
    <url>/2023/07/23/%E3%80%8A%E4%B8%AD%E5%85%B1%E5%85%9A%E5%8F%B2%E7%8F%8D%E9%97%BB%E5%BD%95%E3%80%8B%E6%91%98%E6%8A%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šä¸­å…±å…šå²çé—»å½•ã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šä¸­å…±å…šå²çé—»å½•ã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šå¤§å­¦ä½•ä¸ºã€‹æ‘˜æŠ„</title>
    <link href="/2023/07/23/%E5%A4%A7%E5%AD%A6%E4%BD%95%E4%B8%BA/"/>
    <url>/2023/07/23/%E5%A4%A7%E5%AD%A6%E4%BD%95%E4%B8%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šå¤§å­¦ä½•ä¸ºã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šå¤§å­¦ä½•ä¸ºã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åä¸€ï¼‰ä½¿ç”¨Baichuan-13B-Chatæ¨¡å‹æ„å»ºæ™ºèƒ½æ–‡æ¡£é—®ç­”åŠ©æ‰‹</title>
    <link href="/2023/07/23/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%80%EF%BC%89%E4%BD%BF%E7%94%A8Baichuan-13B-Chat%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%99%BA%E8%83%BD%E6%96%87%E6%A1%A3%E9%97%AE%E7%AD%94%E5%8A%A9%E6%89%8B/"/>
    <url>/2023/07/23/NLP%EF%BC%88%E5%85%AD%E5%8D%81%E4%B8%80%EF%BC%89%E4%BD%BF%E7%94%A8Baichuan-13B-Chat%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%99%BA%E8%83%BD%E6%96%87%E6%A1%A3%E9%97%AE%E7%AD%94%E5%8A%A9%E6%89%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/21/NLP%EF%BC%88%E5%85%AD%E5%8D%81%EF%BC%89Baichuan-13B-Chat%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/">NLPï¼ˆå…­åï¼‰Baichuan-13B-Chatæ¨¡å‹ä½¿ç”¨ä½“éªŒ</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Baichuan-13B-Chatæ¨¡å‹åŠå…¶åœ¨å‘é‡åµŒå…¥å’Œæ–‡æ¡£é˜…è¯»ä¸Šçš„åˆæ­¥å°è¯•ã€‚</p><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Baichuan-13B-Chatæ¨¡å‹æ¥æ„å»ºæ™ºèƒ½æ–‡æ¡£é—®ç­”åŠ©æ‰‹ã€‚</p><h3 id="æ–‡æ¡£é—®ç­”æµç¨‹">æ–‡æ¡£é—®ç­”æµç¨‹</h3><p>æ™ºèƒ½æ–‡æ¡£é—®ç­”åŠ©æ‰‹çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp60_5.jpeg" alt="æ–‡æ¡£é—®ç­”æµç¨‹å›¾" /><figcaption aria-hidden="true">æ–‡æ¡£é—®ç­”æµç¨‹å›¾</figcaption></figure><ul><li><p>æ–‡æ¡£åŠ è½½ï¼ˆDocumentLoadingï¼‰:åŠ è½½æ–‡æ¡£ï¼Œæ–‡æ¡£æ ¼å¼ä¸ºURLï¼ŒPDFï¼ŒDatabaseã€‚æœ¬é¡¹ç›®æš‚æ—¶å…ˆæ”¯æŒtxtæ–‡ä»¶ï¼Œåç»­å°†æ”¯æŒæ›´å¤šæ–‡ä»¶æ ¼å¼ï¼›</p></li><li><p>æ–‡æ¡£åˆ’åˆ†ï¼ˆSplittingï¼‰ï¼šå°†æ–‡æ¡£æŒ‰ç…§ç‰¹å®šæ ¼å¼è¿›è¡Œåˆ’åˆ†ï¼Œå½¢æˆæ–‡æ¡£ç‰‡æ®µã€‚æœ¬é¡¹ç›®é‡‡ç”¨çš„æ–‡æ¡£åˆ’åˆ†æ–¹å¼ä¸ºLangChainä¸­çš„RecursiveCharacterTextSplitterï¼Œå‚è€ƒç½‘å€ä¸ºï¼š<ahref="https://python.langchain.com/docs/modules/data_connection/document_transformers/text_splitters/recursive_text_splitter">https://python.langchain.com/docs/modules/data_connection/document_transformers/text_splitters/recursive_text_splitter</a>ã€‚</p></li><li><p>æ–‡æ¡£å­˜å‚¨ï¼ˆStorageï¼‰:å°†åˆ’åˆ†åçš„æ–‡æ¡£è¿›è¡Œå‘é‡åµŒå…¥ï¼Œå†æ’å…¥è‡³å‘é‡æ•°æ®åº“ã€‚æœ¬é¡¹ç›®é‡‡ç”¨çš„å‚¨å­˜æ–¹å¼ä¸ºElasticSearchåŠå‘é‡æ•°æ®åº“Milvusã€‚</p></li><li><p>æ–‡æ¡£å¬å›ï¼šå¯¹äºè¾“å…¥queryï¼Œä»æ–‡æ¡£å­˜å‚¨ä¸­å¬å›ç›¸å…³æ–‡æ¡£ç‰‡æ®µã€‚æœ¬é¡¹ç›®é‡‡ç”¨çš„å¬å›æ–¹å¼ä¸ºElasticSearchä¸­çš„å†…ç½®BM25ç›¸ä¼¼åº¦ç®—æ³•åŠMilvusä¸­çš„å‘é‡è·ç¦»ã€‚</p></li><li><p>é—®ç­”è¾“å‡ºï¼šå¯¹äºå¬å›æ–‡æ¡£å’Œè¾“å…¥queryï¼Œæ„å»ºåˆé€‚çš„Promptï¼Œåˆ©ç”¨å¤§æ¨¡å‹ï¼ˆLLMï¼‰è¾“å‡ºæœ€ç»ˆç­”æ¡ˆã€‚</p><p>ä¸‹é¢è®²ä»‹ç»ç»†èŠ‚ã€‚æœ¬é¡¹ç›®å·²åœ¨Githubä¸Šå¼€æºï¼Œé¡¹ç›®ç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/document_qa_with_llm">https://github.com/percent4/document_qa_with_llm</a>ã€‚</p></li></ul><h3 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h3><p>æœ¬é¡¹ç›®å¼€å‘çš„Webæ¡†æ¶ä¸ºFlaskï¼ŒAPIæ¥å£ä¸¤ä¸ªï¼šæ–‡ä»¶ä¸Šä¼ æ¥å£å’Œæ–‡æ¡£é—®ç­”æ¥å£ã€‚æ–‡ä»¶ä¸Šä¼ æ¥å£å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp61_1.png" alt="æ–‡ä»¶ä¸Šä¼ æ¥å£" /><figcaption aria-hidden="true">æ–‡ä»¶ä¸Šä¼ æ¥å£</figcaption></figure><p>æ–‡æ¡£å¬å›é‡‡ç”¨ElasticSearchå’ŒMilvusç›¸ç»“åˆçš„æ–¹å¼ï¼Œè®¾ç½®ElasticSearchå’ŒMilvuså¬å›æœ€ç›¸ä¼¼æ–‡æœ¬æ•°é‡ä¸º2ã€‚</p><p>ElasticSearchä¸­åˆ›å»ºçš„indexä¸ºdocsï¼Œmappingç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;docs&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;mappings&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;properties&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;cont_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;integer&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;content&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;analyzer&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;source&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­sourceä»£è¡¨ä¸Šä¼ æ–‡æ¡£åç§°ï¼Œcont_idä¸ºæ–‡æœ¬ç‰‡æ®µç¼–å·ï¼Œcontentä¸ºæ–‡æœ¬ç‰‡æ®µã€‚<code>content</code>å­—æ®µé‡‡ç”¨çš„analyzerä¸º<code>ik_smart</code>ï¼Œè¯¥analyzerå¯è¾ƒå¥½åœ°å¯¹ä¸­æ–‡è¿›è¡Œåˆ†è¯ã€‚</p><p>Milvusåˆ›å»ºçš„collectionä¸ºdocs_qaï¼Œschemaå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp61_2.png" alt="Milvusä¸­docs_qaé›†åˆçš„schema" /><figcaption aria-hidden="true">Milvusä¸­docs_qaé›†åˆçš„schema</figcaption></figure><p><code>embeddings</code>å­—æ®µä¸ºBaichuan-13B-Chatæ¨¡å‹çš„æ–‡æœ¬å‘é‡åµŒå…¥ï¼Œå‘é‡ç»´åº¦ä¸º512ï¼ŒèŒƒæ•°ä¸º1ï¼ˆå³å•ä½å‘é‡ï¼‰ï¼Œæœç´¢è·ç¦»åº¦é‡é‡‡ç”¨<code>IP</code>ï¼Œå³ä¸¤ä¸ªå‘é‡çš„å†…ç§¯ã€‚</p><p>å¤§æ¨¡å‹é‡‡ç”¨Baichuan-13B-Chatï¼Œä¸»è¦ç”¨äºæ–‡æœ¬ç‰‡æ®µçš„å‘é‡åµŒå…¥å’Œæ–‡æ¡£é—®ç­”ã€‚å…³äºBaichuan-13B-Chatæ¨¡å‹çš„éƒ¨ç½²å’Œä½¿ç”¨ï¼Œå¯å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/21/NLP%EF%BC%88%E5%85%AD%E5%8D%81%EF%BC%89Baichuan-13B-Chat%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/">NLPï¼ˆå…­åï¼‰Baichuan-13B-Chatæ¨¡å‹ä½¿ç”¨ä½“éªŒ</a>ã€‚</p><h3 id="æ–‡æ¡£é—®ç­”">æ–‡æ¡£é—®ç­”</h3><p>æœ¬æ–‡ä½¿ç”¨çš„æ–‡æ¡£ä¸º<code>ã€Šå°ç¥ã€‹è€—èµ„30äº¿ï¼Œç¬¬ä¸€éƒ¨ä¸Šæ˜ ç¬¬æ¬¡æ—¥ï¼ŒåŒ—äº¬æ–‡åŒ–è·Œåœ</code>ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://m.jrj.com.cn/madapter/stock/2023/07/22141537710254.shtml">https://m.jrj.com.cn/madapter/stock/2023/07/22141537710254.shtml</a>ï¼Œå°†å…¶æ–‡æœ¬å†…å®¹ä¿å­˜ä¸ºtxtæ–‡ä»¶ï¼Œå¹¶é€šè¿‡æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼Œå°†æ•°æ®å†…å®¹æ’å…¥è‡³ESå’ŒMilvusã€‚</p><p>æˆ‘ä»¬çš„é—®é¢˜ï¼ˆè¾“å…¥queryï¼‰ä¸ºï¼š<code>å°ç¥ç¬¬ä¸€éƒ¨ä»€ä¹ˆæ—¶å€™ä¸Šæ˜ çš„ï¼Ÿ</code>ï¼Œå¯¹å…¶è¿›è¡Œå‘é‡åµŒå…¥ï¼Œåœ¨ESå’ŒMilvusä¸­å¬å›çš„ç›¸ä¼¼æ–‡æœ¬ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ã€Šå°ç¥ã€‹è€—èµ„30äº¿ï¼Œç¬¬ä¸€éƒ¨ä¸Šæ˜ ç¬¬æ¬¡æ—¥ï¼ŒåŒ—äº¬æ–‡åŒ–è·Œåœçƒ­ç‚¹å¿«æŠ¥ 2023-07-22 14:15:04ã€Šå°ç¥ç¬¬ä¸€éƒ¨ã€‹åˆšåˆšä¸Šæ˜ ï¼ŒåŒ—äº¬æ–‡åŒ–è‚¡ä»·å´å‡ºç°ä¸‹è·Œã€‚7æœˆ21æ—¥ï¼ŒAè‚¡å½±è§†ä¼ åª’æ¿å—éœ‡è¡ä¸‹æŒ«ï¼ŒåŒ—äº¬æ–‡åŒ–æ”¶äºè·Œåœï¼ŒæŠ¥7.56å…ƒï¼Œæ€»å¸‚å€¼54.12äº¿å…ƒï¼Œæ¿å—å†…ä¸ªè‚¡æ…ˆæ–‡ä¼ åª’ã€è£ä¿¡æ–‡åŒ–ã€ä¸­å›½å‡ºç‰ˆã€ä¸Šæµ·ç”µå½±ç­‰è·Ÿè·Œã€‚å€¼å¾—å…³æ³¨çš„æ˜¯ï¼Œã€Šå°ç¥ç¬¬ä¸€éƒ¨ã€‹7æœˆ20æ—¥æ‰æ­£å¼ä¸Šæ˜ ï¼ŒåŒ—äº¬æ–‡åŒ–ä¸ºè¯¥å½±ç‰‡çš„å‡ºå“æ–¹ã€‚<br>è½åœ°è¯¯å·®åªæœ‰1å…¬é‡Œï¼Œ3æ¡é£èˆ¹å®ç°äº†ç¬¬ä¸€é˜¶æ®µçš„å…¨éƒ¨ä»»åŠ¡ã€‚<br>åŒ—äº¬æ–‡åŒ–æ›¾æˆåŠŸæŠ•èµ„ã€Šæˆ‘ä¸æ˜¯è¯ç¥ã€‹ã€Šæˆ˜ç‹¼ã€‹ã€Šæµæµªåœ°çƒã€‹ã€Šä½ å¥½ï¼Œæç„•è‹±ã€‹ç­‰å¤šéƒ¨çˆ†æ¬¾å½±ç‰‡ã€‚æ­¤å‰ã€Šå°ç¥ç¬¬ä¸€éƒ¨ã€‹å®£å¸ƒå®šæ¡£ï¼ŒåŒ—äº¬æ–‡åŒ–æ›¾è¿æ¥3è¿æ¿ã€‚<br></code></pre></td></tr></table></figure><p>å¤§æ¨¡å‹æ–‡æ¡£é—®ç­”çš„Promptä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;system&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªå‡ºè‰²çš„æ–‡æ¡£é—®ç­”åŠ©æ‰‹ï¼Œå›ç­”è¦åˆç†ã€ç®€æ´ï¼Œå›å¤è¯­è¨€é‡‡ç”¨ä¸­æ–‡ã€‚è‹¥é—®é¢˜ä¸æ–‡æœ¬ç‰‡æ®µç›¸å…³ï¼Œè¯·æ ¹æ®ç»™å®šçš„æ–‡æœ¬ç‰‡æ®µå’Œé—®é¢˜ï¼Œç­”æ¡ˆä»¥\&quot;æ ¹æ®æ–‡æ¡£çŸ¥è¯†\&quot;å¼€å¤´è‹¥é—®é¢˜ä¸æ–‡æœ¬ç‰‡æ®µç›¸å…³æ€§è¾ƒå°ï¼Œåˆ™ä½¿ç”¨å¤–éƒ¨çŸ¥è¯†å›ç­”é—®é¢˜ï¼Œç­”æ¡ˆä»¥\&quot;æ ¹æ®å¤–éƒ¨çŸ¥è¯†\&quot;å¼€å¤´ã€‚&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½¿ç”¨ä¸‹é¢çš„æ–‡æœ¬ç‰‡æ®µåˆ—è¡¨ï¼Œå›ç­”é—®é¢˜ï¼šå°ç¥ç¬¬ä¸€éƒ¨ä»€ä¹ˆæ—¶å€™ä¸Šæ˜ çš„ï¼Ÿ\n\næ–‡æœ¬ç‰‡æ®µ1: ã€Šå°ç¥ã€‹è€—èµ„30äº¿ï¼Œç¬¬ä¸€éƒ¨ä¸Šæ˜ ç¬¬æ¬¡æ—¥ï¼ŒåŒ—äº¬æ–‡åŒ–è·Œåœçƒ­ç‚¹å¿«æŠ¥ 2023-07-22 14:15:04ã€Šå°ç¥ç¬¬ä¸€éƒ¨ã€‹åˆšåˆšä¸Šæ˜ ï¼ŒåŒ—äº¬æ–‡åŒ–è‚¡ä»·å´å‡ºç°ä¸‹è·Œã€‚7æœˆ21æ—¥ï¼ŒAè‚¡å½±è§†ä¼ åª’æ¿å—éœ‡è¡ä¸‹æŒ«ï¼ŒåŒ—äº¬æ–‡åŒ–æ”¶äºè·Œåœï¼ŒæŠ¥7.56å…ƒï¼Œæ€»å¸‚å€¼54.12äº¿å…ƒï¼Œæ¿å—å†…ä¸ªè‚¡æ…ˆæ–‡ä¼ åª’ã€è£ä¿¡æ–‡åŒ–ã€ä¸­å›½å‡ºç‰ˆã€ä¸Šæµ·ç”µå½±ç­‰è·Ÿè·Œã€‚å€¼å¾—å…³æ³¨çš„æ˜¯ï¼Œã€Šå°ç¥ç¬¬ä¸€éƒ¨ã€‹7æœˆ20æ—¥æ‰æ­£å¼ä¸Šæ˜ ï¼ŒåŒ—äº¬æ–‡åŒ–ä¸ºè¯¥å½±ç‰‡çš„å‡ºå“æ–¹ã€‚\næ–‡æœ¬ç‰‡æ®µ2: è½åœ°è¯¯å·®åªæœ‰1å…¬é‡Œï¼Œ3æ¡é£èˆ¹å®ç°äº†ç¬¬ä¸€é˜¶æ®µçš„å…¨éƒ¨ä»»åŠ¡ã€‚\næ–‡æœ¬ç‰‡æ®µ3: åŒ—äº¬æ–‡åŒ–æ›¾æˆåŠŸæŠ•èµ„ã€Šæˆ‘ä¸æ˜¯è¯ç¥ã€‹ã€Šæˆ˜ç‹¼ã€‹ã€Šæµæµªåœ°çƒã€‹ã€Šä½ å¥½ï¼Œæç„•è‹±ã€‹ç­‰å¤šéƒ¨çˆ†æ¬¾å½±ç‰‡ã€‚æ­¤å‰ã€Šå°ç¥ç¬¬ä¸€éƒ¨ã€‹å®£å¸ƒå®šæ¡£ï¼ŒåŒ—äº¬æ–‡åŒ–æ›¾è¿æ¥3è¿æ¿ã€‚\n&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç­”æ¡ˆä¸ºï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">æ ¹æ®æ–‡æ¡£çŸ¥è¯†ï¼Œã€Šå°ç¥ç¬¬ä¸€éƒ¨ã€‹äº<span class="hljs-number">2023å¹´7æœˆ20</span>æ—¥ä¸Šæ˜ ã€‚<br></code></pre></td></tr></table></figure><p>æ›´å¤šæµ‹è¯•å†…å®¹å¯å‚è€ƒæœ¬é¡¹ç›®çš„Githubç½‘å€ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®çš„Githubç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/document_qa_with_llm">https://github.com/percent4/document_qa_with_llm</a>ï¼Œåç»­å°†æŒç»­ä¼˜åŒ–è¿™ä¸ªé¡¹ç›®ï¼Œæå‡æ–‡æ¡£é—®ç­”çš„æ–¹ä¾¿æ€§å’Œæ™ºèƒ½æ€§ã€‚</p><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Baichuan-13B-Chatæ¨¡å‹æ¥æ„å»ºæ™ºèƒ½æ–‡æ¡£é—®ç­”åŠ©æ‰‹ï¼Œå¸Œæœ›èƒ½ç»™è¯»è€…ä»¬ä¸€äº›å¯å‘ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>Baichuan-13B-Chat</tag>
      
      <tag>ElasticSearch</tag>
      
      <tag>Milvus</tag>
      
      <tag>æ–‡æ¡£é—®ç­”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå…­åï¼‰Baichuan-13B-Chatæ¨¡å‹ä½¿ç”¨ä½“éªŒ</title>
    <link href="/2023/07/21/NLP%EF%BC%88%E5%85%AD%E5%8D%81%EF%BC%89Baichuan-13B-Chat%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/"/>
    <url>/2023/07/21/NLP%EF%BC%88%E5%85%AD%E5%8D%81%EF%BC%89Baichuan-13B-Chat%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>2023å¹´7æœˆ11æ—¥ï¼Œç™¾å·æ™ºèƒ½æ­£å¼å‘å¸ƒå‚æ•°é‡130äº¿çš„é€šç”¨å¤§è¯­è¨€æ¨¡å‹Baichuan-13B-Baseã€å¯¹è¯æ¨¡å‹Baichuan-13B-ChatåŠå…¶INT4/INT8ä¸¤ä¸ªé‡åŒ–ç‰ˆæœ¬ã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»å¤§æ¨¡å‹BaiChuan-13B-Chatçš„ä½¿ç”¨ä½“éªŒï¼Œå…¶HuggingFaceç½‘å€ä¸ºï¼š<ahref="https://huggingface.co/baichuan-inc/Baichuan-13B-Chat">https://huggingface.co/baichuan-inc/Baichuan-13B-Chat</a>ã€‚</p><p>BaiChuan-13B-Chatæ¨¡å‹é‡‡ç”¨<code>FastChat</code>å·¥å…·éƒ¨ç½²ï¼Œéƒ¨ç½²æ–¹å¼ä¸Baichuan-7Bæ¨¡å‹ç›¸åŒï¼Œå…³äºéƒ¨ç½²çš„è¯¦ç»†æ­¥éª¤ï¼Œå¯å‚è€ƒæ–‡ç« ï¼š<ahref="https://percent4.github.io/2023/07/11/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8FastChat%E9%83%A8%E7%BD%B2%E7%99%BE%E5%B7%9D%E5%A4%A7%E6%A8%A1%E5%9E%8B/">NLPï¼ˆäº”åä¹ï¼‰ä½¿ç”¨FastChatéƒ¨ç½²ç™¾å·å¤§æ¨¡å‹</a>ã€‚</p><h3 id="ä½¿ç”¨åˆä½“éªŒ">ä½¿ç”¨åˆä½“éªŒ</h3><p>GPT3.5æˆ–è€…GPT4æ¨¡å‹åœ¨ä¸­æ–‡é—®ç­”ä¸Šå¶å°”ä¼šå‡ºç°â€œå¹»è§‰â€é—®é¢˜ï¼Œæ¯”å¦‚ä¸€äº›å¸¸è¯†æ€§çš„ä¸­æ–‡é—®é¢˜ï¼Œåœ¨è¿™æ–¹é¢ï¼ŒBaichuan-13B-Chatæ¨¡å‹çš„è¡¨ç°è¾ƒå¥½ã€‚</p><p>æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li><p>é²è¿…å’Œå‘¨æ ‘äººæ˜¯åŒä¸€ä¸ªäººå—ï¼Œç®€è¦å›ç­”ï¼Ÿ</p></li><li><p>ä¸­å›½ç¬¬ä¸‰å¤§å²›æ˜¯å“ªä¸ªï¼Ÿ</p></li><li><p>æ‹‰æ™®æ‹‰æ–¯è·å¾—è¿‡è¯ºè´å°”å¥–å—ï¼Ÿ</p><p>è¿™æ˜¯GPT3.5çš„å›ç­”ï¼š</p></li></ul><figure><img src="/img/nlp60_1.png" alt="GPT3.5çš„å›å¤" /><figcaption aria-hidden="true">GPT3.5çš„å›å¤</figcaption></figure><p>è¿™æ˜¯GPT4çš„å›å¤ï¼š</p><figure><img src="/img/nlp60_2.png" alt="GPT4çš„å›å¤" /><figcaption aria-hidden="true">GPT4çš„å›å¤</figcaption></figure><p>è¿™æ˜¯Baichuan-13B-Chatæ¨¡å‹çš„å›å¤ï¼š</p><figure><img src="/img/nlp60_3.png" alt="Baichuan-13B-Chatæ¨¡å‹çš„å›å¤" /><figcaption aria-hidden="true">Baichuan-13B-Chatæ¨¡å‹çš„å›å¤</figcaption></figure><h3 id="å‘é‡åµŒå…¥embedding">å‘é‡åµŒå…¥ï¼ˆEmbeddingï¼‰</h3><p>å½“æˆ‘ä»¬å®ŒæˆBaichuan-13B-Chatæ¨¡å‹çš„éƒ¨ç½²åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼OpenAIçš„è°ƒç”¨æ–¹å¼æ¥è°ƒç”¨è¯¥æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯å…¶åœ¨å‘é‡åµŒå…¥æ–¹é¢çš„è¡¨ç°ã€‚</p><p>æˆ‘ä»¬é€‰æ‹©äº”ä¸ªåˆå§‹æ–‡æœ¬ï¼š</p><ul><li>å”¯å¿ƒä¸»ä¹‰çš„å¯¹ç«‹é¢æ˜¯ä»€ä¹ˆ</li><li>ä½ å¥½</li><li>ä¸Šæµ·çš„äººå£æ˜¯å¤šå°‘ï¼Ÿ</li><li>åŒ—äº¬çš„æ—…æ¸¸æ™¯ç‚¹æœ‰å“ªäº›ï¼Ÿ</li><li>ä¸­å›½çš„ç¬¬ä¸€é«˜æ¥¼</li></ul><p>é¦–å…ˆä½¿ç”¨æ¨¡å‹å¯¹ä»¥ä¸Šæ–‡æœ¬è¿›è¡Œå‘é‡åµŒå…¥ï¼ˆEmbeddingï¼‰ï¼Œå‘é‡ç»´åº¦ä¸º512ç»´ï¼ŒèŒƒæ•°ä¸º1ï¼ˆå³å·²ç»è¿›è¡Œè§„èŒƒåŒ–ï¼‰ã€‚å†ä½¿ç”¨æ–°çš„æ–‡æœ¬è¿›è¡Œå‘é‡åµŒå…¥ï¼Œé€šè¿‡å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦è·å¾—äº”ä¸ªæ–‡æœ¬ä¸­çš„æœ€ç›¸ä¼¼æ–‡æœ¬ã€‚å®ç°Pythonå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_text_embedding</span>(<span class="hljs-params">text</span>):<br><span class="hljs-comment"># Baichuan-13B-Chat Embedding</span><br>    url = <span class="hljs-string">&quot;http://localhost:8000/v1/embeddings&quot;</span><br>    headers = &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>&#125;<br>    payload = json.dumps(&#123;<br>        <span class="hljs-string">&quot;model&quot;</span>: <span class="hljs-string">&quot;Baichuan-13B-Chat&quot;</span>,<br>        <span class="hljs-string">&quot;input&quot;</span>: text<br>    &#125;)<br>    response = requests.request(<span class="hljs-string">&quot;POST&quot;</span>, url, headers=headers, data=payload)<br>    <span class="hljs-keyword">return</span> response.json()[<span class="hljs-string">&quot;data&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;embedding&#x27;</span>]<br><br><br>contents = [<span class="hljs-string">&quot;å”¯å¿ƒä¸»ä¹‰çš„å¯¹ç«‹é¢æ˜¯ä»€ä¹ˆ&quot;</span>,<br>            <span class="hljs-string">&quot;ä½ å¥½&quot;</span>,<br>            <span class="hljs-string">&quot;ä¸Šæµ·çš„äººå£æ˜¯å¤šå°‘ï¼Ÿ&quot;</span>,<br>            <span class="hljs-string">&quot;åŒ—äº¬çš„æ—…æ¸¸æ™¯ç‚¹æœ‰å“ªäº›ï¼Ÿ&quot;</span>,<br>            <span class="hljs-string">&quot;ä¸­å›½çš„ç¬¬ä¸€é«˜æ¥¼&quot;</span>]<br><br>embeddings = [get_text_embedding(content) <span class="hljs-keyword">for</span> content <span class="hljs-keyword">in</span> contents]<br><br>new_text = <span class="hljs-string">&#x27;è‹å·çš„æ—…æ¸¸æ™¯ç‚¹æœ‰å“ªäº›ï¼Ÿ&#x27;</span><br>new_embedding = get_text_embedding(new_text)<br><br>cosine_sim_list = []<br><span class="hljs-keyword">for</span> embedding <span class="hljs-keyword">in</span> embeddings:<br>    cosine_sim_list.append(np.dot(np.array(new_embedding), np.array(embedding)))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;è¾“å…¥ï¼š<span class="hljs-subst">&#123;new_text&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;æœ€ç›¸ä¼¼æ–‡æœ¬ï¼š<span class="hljs-subst">&#123;contents[cosine_sim_list.index(<span class="hljs-built_in">max</span>(cosine_sim_list))]&#125;</span>&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>è¾“å…¥ï¼šè‹å·çš„æ—…æ¸¸æ™¯ç‚¹æœ‰å“ªäº›ï¼Ÿ æœ€ç›¸ä¼¼æ–‡æœ¬ï¼šåŒ—äº¬çš„æ—…æ¸¸æ™¯ç‚¹æœ‰å“ªäº›ï¼Ÿ</p></blockquote><blockquote><p>è¾“å…¥ï¼šæŸæ‹‰å›¾çš„å“²å­¦æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ æœ€ç›¸ä¼¼æ–‡æœ¬ï¼šå”¯å¿ƒä¸»ä¹‰çš„å¯¹ç«‹é¢æ˜¯ä»€ä¹ˆ</p></blockquote><blockquote><p>è¾“å…¥ï¼šåŒ—äº¬çš„äººå£ æœ€ç›¸ä¼¼æ–‡æœ¬ï¼šä¸Šæµ·çš„äººå£æ˜¯å¤šå°‘ï¼Ÿ</p></blockquote><h3 id="æ–‡æ¡£é˜…è¯»">æ–‡æ¡£é˜…è¯»</h3><p>åœ¨å‘é‡åµŒå…¥çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨LangChainå·¥å…·ï¼Œå°†æ–‡æ¡£è¿›è¡Œåˆ‡åˆ†ï¼ˆsplitï¼‰ï¼Œä¹‹åè½¬åŒ–ä¸ºå‘é‡ï¼ˆEmbeddingï¼‰ï¼Œå­˜å…¥å‘é‡æ•°æ®åº“ï¼ˆå¦‚Milvusï¼‰ï¼Œè¿™æ ·å®Œæˆæ–‡æ¡£çš„å‚¨å­˜ã€‚</p><p>å¯¹äºç”¨æˆ·çš„æ–°é—®é¢˜ï¼Œä½¿ç”¨æ–‡æœ¬ç›¸ä¼¼åº¦è¿›è¡Œå‘é‡æ•°æ®åº“æŸ¥è¯¢ï¼Œæ‰¾åˆ°æœ€æ¥è¿‘çš„Kæ¡æ–‡æœ¬ï¼Œä½¿ç”¨è¿™Kæ¡æ–‡æœ¬å’Œæ–°é—®é¢˜ï¼Œè¿›è¡Œæ–‡æ¡£é—®ç­”ï¼Œç±»ä¼¼äºBERTæ—¶ä»£çš„é˜…è¯»ç†è§£ï¼ˆMRCï¼‰ã€‚</p><p>æˆ‘ä»¬ä»¥<code>ä¸­å›½è½½äººç™»æœˆå·¥ç¨‹</code>ç™¾åº¦ç™¾ç§‘ä¸­çš„æ–‡æœ¬ä¸ºä¾‹ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E8%BD%BD%E4%BA%BA%E7%99%BB%E6%9C%88%E5%B7%A5%E7%A8%8B/7147309">https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E8%BD%BD%E4%BA%BA%E7%99%BB%E6%9C%88%E5%B7%A5%E7%A8%8B/7147309</a>ï¼Œå°†å…¶å‚¨å­˜ä¸ºtxtæ–‡ä»¶ã€‚</p><figure><img src="/img/nlp60_4.png" alt="ä¸­å›½è½½äººç™»æœˆå·¥ç¨‹ç™¾åº¦ç™¾ç§‘" /><figcaption aria-hidden="true">ä¸­å›½è½½äººç™»æœˆå·¥ç¨‹ç™¾åº¦ç™¾ç§‘</figcaption></figure><p>ä»¥æ­¤ä¸ºä¾‹è¿›è¡Œæ–‡æ¡£é—®ç­”ï¼Œæµç¨‹å›¾å‚è€ƒå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp60_5.jpeg" alt="LangChainä¸­çš„æ–‡æ¡£é—®ç­”æµç¨‹" /><figcaption aria-hidden="true">LangChainä¸­çš„æ–‡æ¡£é—®ç­”æµç¨‹</figcaption></figure><p>å®ç°Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> langchain.document_loaders <span class="hljs-keyword">import</span> TextLoader<br><span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter<br><span class="hljs-keyword">from</span> pymilvus <span class="hljs-keyword">import</span> (<br>    connections,<br>    utility,<br>    FieldSchema,<br>    CollectionSchema,<br>    DataType,<br>    Collection,<br>)<br><br><span class="hljs-comment"># æŒ‡å®šè¦ä½¿ç”¨çš„æ–‡æ¡£åŠ è½½å™¨</span><br>documents = TextLoader(<span class="hljs-string">&#x27;dengyue.txt&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>).load()<br><span class="hljs-comment"># æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ–‡æ¡£æ‹†åˆ†æˆå—ã€‚</span><br>text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="hljs-number">250</span>, chunk_overlap=<span class="hljs-number">0</span>)<br>texts = text_splitter.split_documents(documents)<br><br><br><span class="hljs-comment"># è·å–æ–‡æœ¬çš„å‘é‡åµŒå…¥ï¼Œä½¿ç”¨Baichuan-13B-Chatæ¨¡å‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_text_embedding</span>(<span class="hljs-params">req_text</span>):<br>    url = <span class="hljs-string">&quot;http://localhost:8000/v1/embeddings&quot;</span><br>    headers = &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>&#125;<br>    payload = json.dumps(&#123;<span class="hljs-string">&quot;model&quot;</span>: <span class="hljs-string">&quot;Baichuan-13B-Chat&quot;</span>, <span class="hljs-string">&quot;input&quot;</span>: req_text&#125;)<br>    new_req = requests.request(<span class="hljs-string">&quot;POST&quot;</span>, url, headers=headers, data=payload)<br>    <span class="hljs-keyword">return</span> new_req.json()[<span class="hljs-string">&#x27;data&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;embedding&#x27;</span>]<br><br><span class="hljs-comment"># ä½¿ç”¨Baichuan-13B-Chatæ¨¡å‹è·å–æ–‡æ¡£é—®ç­”çš„ç­”æ¡ˆ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_doc_qa</span>(<span class="hljs-params">qa_template</span>):<br>    url = <span class="hljs-string">&quot;http://localhost:8000/v1/chat/completions&quot;</span><br>    payload = json.dumps(&#123;<br>        <span class="hljs-string">&quot;model&quot;</span>: <span class="hljs-string">&quot;Baichuan-13B-Chat&quot;</span>,<br>        <span class="hljs-string">&quot;messages&quot;</span>: [<br>            &#123;<br>                <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>                <span class="hljs-string">&quot;content&quot;</span>: qa_chain_prompt<br>            &#125;<br>        ]<br>    &#125;)<br>    headers = &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>&#125;<br>    response = requests.request(<span class="hljs-string">&quot;POST&quot;</span>, url, headers=headers, data=payload)<br>    <span class="hljs-keyword">return</span> response.json()[<span class="hljs-string">&#x27;choices&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;message&#x27;</span>][<span class="hljs-string">&#x27;content&#x27;</span>]<br><br><br><span class="hljs-comment"># è¿æ¥Milvus</span><br>connections.connect(<span class="hljs-string">&quot;default&quot;</span>, host=<span class="hljs-string">&quot;localhost&quot;</span>, port=<span class="hljs-string">&quot;19530&quot;</span>)<br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªcollection</span><br>fields = [<br>    FieldSchema(name=<span class="hljs-string">&quot;pk&quot;</span>, dtype=DataType.INT64, is_primary=<span class="hljs-literal">True</span>, auto_id=<span class="hljs-literal">False</span>),<br>    FieldSchema(name=<span class="hljs-string">&quot;source&quot;</span>, dtype=DataType.VARCHAR, max_length=<span class="hljs-number">100</span>),<br>    FieldSchema(name=<span class="hljs-string">&quot;text&quot;</span>, dtype=DataType.VARCHAR, max_length=<span class="hljs-number">1000</span>),<br>    FieldSchema(name=<span class="hljs-string">&quot;embeddings&quot;</span>, dtype=DataType.FLOAT_VECTOR, dim=<span class="hljs-number">5120</span>)<br>]<br>schema = CollectionSchema(fields, <span class="hljs-string">&quot;vector db for docs qa&quot;</span>)<br>hello_milvus = Collection(<span class="hljs-string">&quot;docs_qa&quot;</span>, schema)<br><br><span class="hljs-comment"># æ•°æ®æ’å…¥</span><br>_ids = []<br>sources = []<br>contents = []<br>embeddings = []<br><span class="hljs-keyword">for</span> i, text <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(texts):<br>    source = text.metadata[<span class="hljs-string">&#x27;source&#x27;</span>]<br>    <span class="hljs-built_in">print</span>(i+<span class="hljs-number">1</span>, source)<br>    content = text.page_content<br>    embedding = get_text_embedding(content)<br>    _ids.append(i+<span class="hljs-number">1</span>)<br>    sources.append(source)<br>    contents.append(content)<br>    embeddings.append(embedding)<br><br>insert_result = hello_milvus.insert([_ids, sources, contents, embeddings])<br><span class="hljs-comment"># After final entity is inserted, it is best to call flush to have no growing segments left in memory</span><br>hello_milvus.flush()<br><br><span class="hljs-comment"># åœ¨entitieså­—æ®µåˆ›å»ºç´¢å¼•</span><br>index = &#123;<br>    <span class="hljs-string">&quot;index_type&quot;</span>: <span class="hljs-string">&quot;IVF_FLAT&quot;</span>,<br>    <span class="hljs-string">&quot;metric_type&quot;</span>: <span class="hljs-string">&quot;IP&quot;</span>,<br>    <span class="hljs-string">&quot;params&quot;</span>: &#123;<span class="hljs-string">&quot;nlist&quot;</span>: <span class="hljs-number">128</span>&#125;,<br>&#125;<br>hello_milvus.create_index(<span class="hljs-string">&quot;embeddings&quot;</span>, index)<br><br><span class="hljs-comment"># å°†collectionåŠ è½½è‡³å†…å­˜</span><br>hello_milvus.load()<br><br><span class="hljs-comment"># è¾“å…¥é—®é¢˜ï¼Œè¿›è¡Œæ–‡æ¡£é—®ç­”</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    query = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¾“å…¥é—®é¢˜ï¼š&#x27;</span>)<br>    vectors_to_search = [get_text_embedding(query)]<br>    <span class="hljs-comment"># é€šè¿‡åµŒå…¥å‘é‡ç›¸ä¼¼åº¦è·å–ç›¸ä¼¼æ–‡æœ¬ï¼Œæ•°é‡ä¸º3ä¸ª</span><br>    search_params = &#123;<br>        <span class="hljs-string">&quot;metric_type&quot;</span>: <span class="hljs-string">&quot;IP&quot;</span>,<br>        <span class="hljs-string">&quot;params&quot;</span>: &#123;<span class="hljs-string">&quot;nprobe&quot;</span>: <span class="hljs-number">10</span>&#125;,<br>    &#125;<br>    result = hello_milvus.search(vectors_to_search, <span class="hljs-string">&quot;embeddings&quot;</span>, search_params, limit=<span class="hljs-number">3</span>, output_fields=[<span class="hljs-string">&quot;text&quot;</span>])<br>    context = <span class="hljs-string">&#x27;&#x27;</span>.join([_.entity.get(<span class="hljs-string">&#x27;text&#x27;</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> result[<span class="hljs-number">0</span>]])<br><br>    <span class="hljs-comment"># å»ºç«‹prompt</span><br>    qa_chain_prompt = <span class="hljs-string">f&quot;&quot;&quot;ä½¿ç”¨ä»¥ä¸‹æ–‡æœ¬æ¥å›ç­”æœ€åçš„é—®é¢˜ã€‚</span><br><span class="hljs-string">    å¦‚æœä½ ä¸çŸ¥é“ç­”æ¡ˆï¼Œå°±è¯´ä½ ä¸çŸ¥é“ï¼Œä¸è¦è¯•å›¾ç¼–é€ ç­”æ¡ˆï¼Œå°½å¯èƒ½ä¿æŒç­”æ¡ˆç®€æ´ã€‚ </span><br><span class="hljs-string">    æ–‡æœ¬: <span class="hljs-subst">&#123;context&#125;</span></span><br><span class="hljs-string">    é—®é¢˜: <span class="hljs-subst">&#123;query&#125;</span></span><br><span class="hljs-string">    ç­”æ¡ˆ:&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># print(qa_chain_prompt)</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;é—®é¢˜ï¼š<span class="hljs-subst">&#123;query&#125;</span>&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;å›ç­”ï¼š<span class="hljs-subst">&#123;get_doc_qa(qa_chain_prompt)&#125;</span>&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>é—®é¢˜ï¼šç¾å›½ä»€ä¹ˆæ—¶å€™ç™»ä¸Šæœˆçƒï¼Ÿå›ç­”ï¼šç¾å›½åœ¨20ä¸–çºª60å¹´ä»£å’Œ70å¹´ä»£é€šè¿‡â€œé˜¿æ³¢ç½—â€è®¡åˆ’æˆåŠŸç™»ä¸Šæœˆçƒã€‚</p></blockquote><blockquote><p>é—®é¢˜ï¼šä¸­å›½é¢„è®¡åœ¨ä»€ä¹ˆç™»ä¸Šæœˆçƒï¼Ÿå›ç­”ï¼šä¸­å›½é¢„è®¡åœ¨2025å¹´å®ç°èˆªå¤©å‘˜ç™»æœˆã€‚ç›®å‰ï¼Œå…³äºä¸­å›½è½½äººç™»æœˆå·¥ç¨‹è®¡åˆ’çš„æ—¶é—´ï¼Œå›½å†…æœ‰ä¸‰ç§è¯´æ³•ï¼š2020å¹´ã€2025å¹´å’Œ2030å¹´ã€‚ä¸è¿‡ï¼Œè¿™äº›æ—¶é—´è¡¨éƒ½æ˜¯ä¸“å®¶çš„è§‚ç‚¹å’Œé¢„æµ‹ï¼Œå›½å®¶å°šæœªå…¬å¸ƒä¸€ä¸ªæ˜ç¡®çš„æ—¶é—´è¡¨ã€‚</p></blockquote><blockquote><p>é—®é¢˜ï¼šå«¦å¨¥äºŒå·ã€å«¦å¨¥ä¸‰å·çš„æ€»æŒ‡æŒ¥æ˜¯è°ï¼Ÿå›ç­”ï¼šå«¦å¨¥äºŒå·ã€å«¦å¨¥ä¸‰å·çš„æ€»æŒ‡æŒ¥æ˜¯å¶åŸ¹å»ºã€‚</p></blockquote><blockquote><p>é—®é¢˜ï¼šç¥èˆŸåå…­å·è½½äººé£è¡Œä»»åŠ¡æ–°é—»å‘å¸ƒä¼šåœ¨å“ªé‡Œä¸¾è¡Œï¼Ÿå›ç­”ï¼šç¥èˆŸåå…­å·è½½äººé£è¡Œä»»åŠ¡æ–°é—»å‘å¸ƒä¼šåœ¨é…’æ³‰å«æ˜Ÿå‘å°„ä¸­å¿ƒä¸¾è¡Œã€‚</p></blockquote><p>å½“ç„¶ï¼Œä¸Šè¿°çš„æ–‡æ¡£é—®ç­”æ–¹æ¡ˆå¹¶ä¸æ˜¯å¾ˆå®Œå–„ï¼Œä»…ä»…ä½¿ç”¨å‘é‡åµŒå…¥æœ‰æ—¶æ— æ³•å¬å›ç›¸ä¼¼æ–‡æœ¬ï¼Œè¿™æ ·å°±ä¼šé€ æˆå›ç­”é”™è¯¯ã€‚</p><p>åç»­ç¬”è€…å°†è€ƒè™‘ES +å‘é‡åŠ å…¥çš„ç»“åˆæ–¹å¼è¿›è¡Œå¬å›ï¼ŒåŒæ—¶æ”¯æŒæ›´å¤šç±»å‹çš„æ–‡æœ¬ï¼Œä¸ä»…é™äºtxtæ–‡ä»¶ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Baichuan-13B-Chatæ¨¡å‹ä½¿ç”¨ä½“éªŒï¼ŒåŒ…æ‹¬å…¶ä¸GPTç³»åˆ—æ¨¡å‹åœ¨ä¸­æ–‡å¸¸è¯†æ€§é—®é¢˜ä¸Šçš„æµ‹è¯•ï¼Œä»¥åŠå‘é‡åµŒå…¥ã€æ–‡æ¡£é—®ç­”ç­‰ã€‚</p><p>ç¬”è€…ä½¿ç”¨ä¸‹æ¥çš„åˆæ­¥æ„Ÿå—æ˜¯ï¼ŒBaichuan-13B-Chatæ¨¡å‹çš„é—®ç­”æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ï¼</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>Baichuan-13B-Chat</tag>
      
      <tag>Milvus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šä¸€ä¸ªä¸­å›½è®°è€…çœ‹äºŒæˆ˜ã€‹æ‘˜æŠ„</title>
    <link href="/2023/07/11/%E3%80%8A%E4%B8%80%E4%B8%AA%E4%B8%AD%E5%9B%BD%E8%AE%B0%E8%80%85%E7%9C%8B%E4%BA%8C%E6%88%98%E3%80%8B%E6%91%98%E6%8A%84/"/>
    <url>/2023/07/11/%E3%80%8A%E4%B8%80%E4%B8%AA%E4%B8%AD%E5%9B%BD%E8%AE%B0%E8%80%85%E7%9C%8B%E4%BA%8C%E6%88%98%E3%80%8B%E6%91%98%E6%8A%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="/pdfjs/web/viewer.html?file=/pdf/ã€Šä¸€ä¸ªä¸­å›½è®°è€…çœ‹äºŒæˆ˜ã€‹æ‘˜æŠ„.pdf">PDFå…¨å±æµè§ˆï¼ˆPDF View in FullScreenï¼‰</a></p><iframe src='/pdfjs/web/viewer.html?file=/pdf/ã€Šä¸€ä¸ªä¸­å›½è®°è€…çœ‹äºŒæˆ˜ã€‹æ‘˜æŠ„.pdf' width="100%" height="800px"></iframe>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±æ‘˜æŠ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¹¦ç±æ‘˜æŠ„</tag>
      
      <tag>äºŒæˆ˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åä¹ï¼‰ä½¿ç”¨FastChatéƒ¨ç½²ç™¾å·å¤§æ¨¡å‹</title>
    <link href="/2023/07/11/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8FastChat%E9%83%A8%E7%BD%B2%E7%99%BE%E5%B7%9D%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    <url>/2023/07/11/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8FastChat%E9%83%A8%E7%BD%B2%E7%99%BE%E5%B7%9D%E5%A4%A7%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨FastChatæ¥éƒ¨ç½²å›½äº§å¤§æ¨¡å‹â€”â€”ç™¾å·æ¨¡å‹ã€‚</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸¤ä¸ªæ¦‚å¿µâ€”â€”<code>ç™¾å·æ¨¡å‹</code>å’Œ<code>FastChat</code>.</p><h3 id="ç™¾å·æ¨¡å‹">ç™¾å·æ¨¡å‹</h3><p>2023å¹´6æœˆ15æ—¥ï¼Œè¢«ç§°ä¸ºã€Œä¸­å›½ ChatGPT æ¢¦ä¹‹é˜Ÿã€çš„ç™¾å·æ™ºèƒ½å…¬å¸ï¼Œæ¨å‡ºäº† 70äº¿å‚æ•°é‡çš„ä¸­è‹±æ–‡é¢„è®­ç»ƒå¤§æ¨¡å‹â€”â€”<code>baichuan-7B</code>ã€‚</p><p><code>baichuan-7B</code>æ˜¯ç”±ç™¾å·æ™ºèƒ½å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„å¤§è§„æ¨¡é¢„è®­ç»ƒæ¨¡å‹ã€‚åŸºäºTransformerç»“æ„ï¼Œåœ¨å¤§çº¦1.2ä¸‡äº¿tokensä¸Šè®­ç»ƒçš„70äº¿å‚æ•°æ¨¡å‹ï¼Œæ”¯æŒä¸­è‹±åŒè¯­ï¼Œä¸Šä¸‹æ–‡çª—å£é•¿åº¦ä¸º4096ã€‚åœ¨æ ‡å‡†çš„ä¸­æ–‡å’Œè‹±æ–‡æƒå¨benchmarkï¼ˆC-EVAL/MMLUï¼‰ä¸Šå‡å–å¾—åŒå°ºå¯¸æœ€å¥½çš„æ•ˆæœã€‚</p><p>åœ¨æ„å»ºé¢„è®­ç»ƒè¯­æ–™åº“æ–¹é¢ï¼Œç™¾å·æ™ºèƒ½ä»¥é«˜è´¨é‡ä¸­æ–‡è¯­æ–™ä¸ºåŸºç¡€ï¼ŒåŒæ—¶èåˆäº†ä¼˜è´¨çš„è‹±æ–‡æ•°æ®ã€‚ç›¸è¾ƒäºå…¶ä»–åŒå‚æ•°è§„æ¨¡çš„å¼€æºä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹ï¼Œæ•°æ®é‡æé«˜äº†è¶…è¿‡50%ã€‚</p><ul><li>åœ¨æ•°æ®è´¨é‡æ–¹é¢ï¼Œé€šè¿‡è´¨é‡æ¨¡å‹å¯¹æ•°æ®è¿›è¡Œæ‰“åˆ†ï¼Œå¯¹åŸå§‹æ•°æ®é›†è¿›è¡Œç¯‡ç« çº§å’Œå¥å­çº§çš„ç²¾ç¡®ç­›é€‰</li><li>åœ¨å†…å®¹å¤šæ ·æ€§æ–¹é¢ï¼Œåˆ©ç”¨è‡ªç ”è¶…å¤§è§„æ¨¡å±€éƒ¨æ•æ„Ÿå“ˆå¸Œèšç±»ç³»ç»Ÿå’Œè¯­ä¹‰èšç±»ç³»ç»Ÿï¼Œå¯¹æ•°æ®è¿›è¡Œäº†å¤šå±‚æ¬¡å¤šç²’åº¦çš„èšç±»</li><li>æœ€ç»ˆæ„å»ºäº†åŒ…å« 1.2 ä¸‡äº¿ token çš„å…¼é¡¾è´¨é‡å’Œå¤šæ ·æ€§çš„é¢„è®­ç»ƒæ•°æ®ã€‚</li></ul><p>ä¸åŒäºLLaMAå®Œå…¨ç¦æ­¢å•†ä¸šä½¿ç”¨ï¼Œ<code>baichuan-7B</code>ä»£ç ä½¿ç”¨æ›´å®½æ¾çš„å¼€æºåè®®â€”â€”Apache-2.0åè®®ï¼Œå…è®¸ç”¨äºå•†ä¸šç›®çš„</p><h3 id="fastchat">FastChat</h3><p><code>FastChat</code>æ˜¯ç”¨äºå¯¹è¯æœºå™¨äººæ¨¡å‹è®­ç»ƒã€éƒ¨ç½²ã€è¯„ä¼°çš„å¼€æ”¾å¹³å°ï¼Œå…¶æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š</p><ul><li>æ¨¡å‹æƒé‡ï¼Œè®­ç»ƒä»£ç ï¼Œè¯„ä¼°ä»£ç å¯ç”¨äºSOTAæ¨¡å‹ï¼ˆæ¯”å¦‚Vicunaï¼ŒFastChat-T5ï¼‰</li><li>åˆ†å¸ƒå¼å¤šæ¨¡å‹éƒ¨ç½²ç³»ç»Ÿï¼Œè‡ªå¸¦Web UIå’ŒOpenAIå…¼å®¹çš„RESTful APIs</li></ul><p><code>FastChat</code>é›†æˆäº†Vicunaã€Koalaã€alpacaã€LLaMAç­‰å¼€æºæ¨¡å‹ï¼Œå…¶ä¸­Vicunaå·ç§°èƒ½å¤Ÿè¾¾åˆ°GPT-4çš„90%çš„è´¨é‡ï¼Œæ˜¯å¼€æºçš„chatGPTæ¨¡å‹ä¸­å¯¹ç­”æ•ˆæœæ¯”è¾ƒå¥½çš„ã€‚</p><p><code>FastChat</code>çš„è®¿é—®åœ°å€æ˜¯ï¼š<ahref="https://link.zhihu.com/?target=https%3A//chat.lmsys.org/">https://chat.lmsys.org/</a>, <code>FastChat</code>çš„å®‰è£…æ–¹å¼ä¸ºï¼š<code>pip3 install fschat</code>.</p><h3 id="cliéƒ¨ç½²">CLIéƒ¨ç½²</h3><p>åœ¨Huggingface Hubä¸Šä¸‹è½½<code>baichuan-7B</code>æ¨¡å‹ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://huggingface.co/baichuan-inc/Baichuan-7B"class="uri">https://huggingface.co/baichuan-inc/Baichuan-7B</a>,æ”¾åœ¨GPUæœºå™¨ä¸Šçš„æœ¬åœ°è·¯å¾„ã€‚</p><p>ç¬”è€…çš„GPUæœºå™¨ä¸º4 * RTX6000ï¼Œæ¯å¼ RTX6000çš„æ˜¾å­˜ä¸º80Gã€‚</p><p><code>FastChat</code>ä½¿ç”¨CLIéƒ¨ç½²ç™¾å·å¤§æ¨¡å‹çš„å‘½ä»¤ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -m fastchat.serve.cli --model-path path_of_Baichuan-7B --num-gpus 2<br></code></pre></td></tr></table></figure><p>åœ¨CLIéƒ¨ç½²æ—¶ï¼Œå¦‚é‡åˆ°ä»¥ä¸‹çš„æŠ¥é”™ï¼š<code>trust_remote_code=True</code>,å‚è€ƒissueç½‘å€ï¼š<a href="https://github.com/lm-sys/FastChat/issues/1789"class="uri">https://github.com/lm-sys/FastChat/issues/1789</a>,åˆ™åœ¨å¯¹åº”çš„Pythonè·¯å¾„ä¸‹ï¼Œå°†FastChatçš„fastchat/model/model_adapter.pyæ–‡ä»¶ä¸­çš„ä»£ç ä¸­çš„ç¬¬57è‡³61è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">tokenizer = AutoTokenizer.from_pretrained(<br>             model_path,<br>             use_fast=self.use_fast_tokenizer,<br>             revision=revision,<br>         )<br></code></pre></td></tr></table></figure><p>å’Œ69è‡³71è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">model = AutoModelForCausalLM.from_pretrained(<br>          model_path, low_cpu_mem_usage=<span class="hljs-literal">True</span>, **from_pretrained_kwargs<br>      )<br></code></pre></td></tr></table></figure><p>ä¸­æ·»åŠ ä»£ç ï¼š`<code>trust_remote_code=True</code>` ,åˆ™å¯é¡ºåˆ©éƒ¨ç½²ã€‚</p><pre><code class="hljs">éƒ¨ç½²æˆåŠŸåçš„ç•Œé¢å¦‚ä¸‹ï¼š</code></pre><figure><img src="/img/fastchat_cli.png" alt="CLIéƒ¨ç½²æˆåŠŸåçš„ç”¨æˆ·ç•Œé¢" /><figcaption aria-hidden="true">CLIéƒ¨ç½²æˆåŠŸåçš„ç”¨æˆ·ç•Œé¢</figcaption></figure><h3 id="webéƒ¨ç½²">WEBéƒ¨ç½²</h3><p><code>FastChat</code>è¿˜æ”¯æŒWEBéƒ¨ç½²ï¼Œå¯Web UIå’ŒOpenAIå…¼å®¹çš„RESTfulAPIs.</p><p>è¿™é‡Œä¸»è¦ä»‹ç»å¦‚ä½•å®ç°ä¸OpenAIå…¼å®¹çš„å…·æœ‰RESTfulAPIsçš„éƒ¨ç½²æ–¹å¼ï¼Œå‚è€ƒç½‘å€ä¸ºï¼š<ahref="https://github.com/lm-sys/FastChat/blob/main/docs/openai_api.md"class="uri">https://github.com/lm-sys/FastChat/blob/main/docs/openai_api.md</a>.</p><p>éƒ¨ç½²ä¸€å…±åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol type="1"><li><code>python3 -m fastchat.serve.controller</code></li><li><code>python3 -m fastchat.serve.model</code><em><code>worker --model-path path_of_</code></em><code>Baichuan-7B</code></li><li><code>python3 -m fastchat.serve.openai_api_server --host localhost --port 8000</code></li></ol><p>åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°<code>PydanticImportError</code>ï¼ŒåŸå› ä¸ºpydanticç‰ˆæœ¬çš„é—®é¢˜ï¼Œåªéœ€å°†pydanticç‰ˆæœ¬é™ä¸º<code>1.*</code>ç‰ˆæœ¬å³å¯ã€‚</p><p>éƒ¨ç½²æˆåŠŸåï¼Œè¯¥æœåŠ¡å¯æä¾›ä¸OpenAIé£æ ¼ç±»ä¼¼çš„RESTful APIsï¼Œå¦‚ä¸‹ï¼š</p><ul><li>æŸ¥çœ‹æ¨¡å‹</li></ul><p>curlå‘½ä»¤ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://localhost:8000/v1/models<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;list&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;baichun_7b&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;model&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1689004839</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;owned_by&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;fastchat&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;baichun_7b&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;parent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;permission&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;modelperm-UERow2kYwq5B2M8aVQkwdk&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;model_permission&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1689004839</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_create_engine&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_sampling&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_logprobs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_search_indices&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_view&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;allow_fine_tuning&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;organization&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;*&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;is_blocking&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>æ–‡æœ¬è¡¥å……ï¼ˆText Completionsï¼‰</li></ul><p>curlå‘½ä»¤ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://localhost:8000/v1/completions \<br>  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \<br>  -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    &quot;model&quot;: &quot;baichun_7b&quot;,</span><br><span class="hljs-string">    &quot;prompt&quot;: &quot;Once upon a time&quot;,</span><br><span class="hljs-string">    &quot;max_tokens&quot;: 40,</span><br><span class="hljs-string">    &quot;temperature&quot;: 0.5</span><br><span class="hljs-string">  &#125;&#x27;</span> | jq .<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cmpl-izbe3cRRiY4zAbJueBAyxZ&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text_completion&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1689004991</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;baichun_7b&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;choices&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;, you could find a variety of different types of chocolate in stores. But now, many chocolate companies are focusing on creating vegan chocolate that is not only delicious but also cruelty-free. Here are&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;logprobs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;finish_reason&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;length&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;usage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;prompt_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;total_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">43</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;completion_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">39</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>å¯¹è¯ï¼ˆChat Completionsï¼‰</li></ul><p>curlå‘½ä»¤ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://localhost:8000/v1/chat/completions \<br>  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \<br>  -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    &quot;model&quot;: &quot;baichun_7b&quot;,</span><br><span class="hljs-string">    &quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;è¯·ç”¨ä¸­æ–‡ç®€å•ä»‹ç»ä¸‰å›½æ¼”ä¹‰ï¼Ÿ&quot;&#125;]</span><br><span class="hljs-string">  &#125;&#x27;</span> | jq .<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chatcmpl-3SiRqRgbZR8v6gLnQYo9eJ&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chat.completion&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1689005219</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;baichun_7b&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;choices&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assistant&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot; ä¸‰å›½æ¼”ä¹‰æ˜¯ä¸­å›½å¤ä»£é•¿ç¯‡å°è¯´ï¼Œè®²è¿°äº†ä¸œæ±‰æœ«å¹´è‡³æ™‹æœåˆå¹´çš„å†å²æ•…äº‹ã€‚ä¸»è¦äººç‰©åŒ…æ‹¬æ›¹æ“ã€åˆ˜å¤‡ã€å­™æƒå’Œå…³ç¾½ç­‰ã€‚æ•…äº‹æƒ…èŠ‚æ›²æŠ˜å¤æ‚ï¼Œæ¶‰åŠæ”¿æ²»ã€å†›äº‹ã€æ–‡åŒ–ç­‰å¤šä¸ªæ–¹é¢ï¼Œè¢«èª‰ä¸ºä¸­å›½å¤ä»£å°è¯´çš„ç»å…¸ä¹‹ä½œã€‚ã€Šä¸‰å›½æ¼”ä¹‰ã€‹ä¸ä»…æ˜¯ä¸€éƒ¨æ–‡å­¦ä½œå“ï¼Œä¹Ÿæ˜¯ä¸­å›½æ–‡åŒ–çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¯¹ä¸­å›½å†å²å’Œæ–‡åŒ–äº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;finish_reason&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stop&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;usage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;prompt_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">533</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;total_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">629</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;completion_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">96</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>å¤šè½®å¯¹è¯</li></ul><p>curlå‘½ä»¤ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://localhost:8000/v1/chat/completions \<br>  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \<br>  -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    &quot;model&quot;: &quot;baichun_7b&quot;,</span><br><span class="hljs-string">    &quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;è¯·ç”¨ä¸­æ–‡ç®€å•ä»‹ç»è¥¿æ¸¸è®°ï¼Ÿ&quot;&#125;, &#123;&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ä¸‰å›½æ¼”ä¹‰æ˜¯ä¸­å›½å¤ä»£é•¿ç¯‡å°è¯´ï¼Œè®²è¿°äº†ä¸œæ±‰æœ«å¹´è‡³æ™‹æœåˆå¹´çš„å†å²æ•…äº‹ã€‚ä¸»è¦äººç‰©åŒ…æ‹¬æ›¹æ“ã€åˆ˜å¤‡ã€å­™æƒå’Œå…³ç¾½ç­‰ã€‚æ•…äº‹æƒ…èŠ‚æ›²æŠ˜å¤æ‚ï¼Œæ¶‰åŠæ”¿æ²»ã€å†›äº‹ã€æ–‡åŒ–ç­‰å¤šä¸ªæ–¹é¢ï¼Œè¢«èª‰ä¸ºä¸­å›½å¤ä»£å°è¯´çš„ç»å…¸ä¹‹ä½œã€‚ã€Šä¸‰å›½æ¼”ä¹‰ã€‹ä¸ä»…æ˜¯ä¸€éƒ¨æ–‡å­¦ä½œå“ï¼Œä¹Ÿæ˜¯ä¸­å›½æ–‡åŒ–çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¯¹ä¸­å›½å†å²å’Œæ–‡åŒ–äº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚&quot;&#125;, &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å®ƒçš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;&#125;]</span><br><span class="hljs-string">  &#125;&#x27;</span> | jq .<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chatcmpl-8oE57oXC862wKYyrPLnSGM&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chat.completion&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1689005374</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;baichun_7b&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;choices&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assistant&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot; ã€Šä¸‰å›½æ¼”ä¹‰ã€‹çš„ä½œè€…æ˜¯æ˜ä»£å°è¯´å®¶ç½—è´¯ä¸­ã€‚ç½—è´¯ä¸­æ˜¯æ˜ä»£æ–‡å­¦å®¶ï¼Œä»–çš„ä»£è¡¨ä½œå“è¿˜æœ‰ã€Šæ°´æµ’ä¼ ã€‹å’Œã€Šè¥¿æ¸¸è®°ã€‹ç­‰ã€‚ä»–åœ¨åˆ›ä½œã€Šä¸‰å›½æ¼”ä¹‰ã€‹æ—¶ï¼Œå‚è€ƒäº†å¤§é‡çš„å†å²èµ„æ–™å’Œä¼ è¯´ï¼Œå°†è¿™äº›å†…å®¹èåˆåœ¨ä¸€èµ·ï¼Œåˆ›é€ äº†ä¸€ä¸ªè™šæ„çš„ä¸–ç•Œï¼Œæˆä¸ºäº†ä¸­å›½æ–‡å­¦å²ä¸Šçš„ç»å…¸ä¹‹ä½œã€‚&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;finish_reason&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stop&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;usage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;prompt_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">640</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;total_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">724</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;completion_tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">84</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨Pythonä»£ç </li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> openai<br>openai.api_key = <span class="hljs-string">&quot;EMPTY&quot;</span> <span class="hljs-comment"># Not support yet</span><br>openai.api_base = <span class="hljs-string">&quot;http://localhost:8000/v1&quot;</span><br><br>model = <span class="hljs-string">&quot;baichun_7b&quot;</span><br>prompt = <span class="hljs-string">&quot;Once upon a time&quot;</span><br><br><span class="hljs-comment"># create a completion</span><br>completion = openai.Completion.create(model=model, prompt=prompt, max_tokens=<span class="hljs-number">64</span>)<br><span class="hljs-comment"># print the completion</span><br><span class="hljs-built_in">print</span>(prompt + completion.choices[<span class="hljs-number">0</span>].text)<br><br><span class="hljs-comment"># create a chat completion</span><br>completion = openai.ChatCompletion.create(<br>  model=model,<br>  messages=[&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Hello! What is your name?&quot;</span>&#125;]<br>)<br><span class="hljs-comment"># print the completion</span><br><span class="hljs-built_in">print</span>(completion.choices[<span class="hljs-number">0</span>].message.content)<br></code></pre></td></tr></table></figure><p><strong>ä»¥ä¸Šä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼Œéƒ½æ”¯æŒæµå¼è¾“å‡ºï¼Œä¸”æ¨¡å‹æ¨ç†é€Ÿåº¦è¾ƒå¿«ï¼Œç¬”è€…åœ¨ä¸Šè¿°æµ‹è¯•ä¾‹å­ä¸­çš„æ¨ç†æ—¶é—´ä¸€èˆ¬ä¸º5-7ç§’ï¼Œä¸”æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¹¶å‘é‡é«˜ã€‚</strong></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨FastChatæ¥éƒ¨ç½²å›½äº§å¤§æ¨¡å‹â€”â€”ç™¾å·æ¨¡å‹ï¼Œå¹¶æ¼”ç¤ºäº†ä¸¤ç§éƒ¨ç½²æ–¹å¼â€”â€”WEBéƒ¨ç½²å’ŒCLIéƒ¨ç½²ï¼Œä»¥åŠåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½ç»™è¯»è€…å¸¦æ¥å¯ç¤ºã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>ç™¾å·æ™ºèƒ½å‘å¸ƒ 70 äº¿å‚æ•°é‡å¼€æºä¸­è‹±æ–‡å¤§æ¨¡å‹: <ahref="https://www.geekpark.net/news/320721"class="uri">https://www.geekpark.net/news/320721</a></li><li>baichuan-inc/Baichuan-7B in Huggingface Hub: <ahref="https://huggingface.co/baichuan-inc/Baichuan-7B"class="uri">https://huggingface.co/baichuan-inc/Baichuan-7B</a></li><li>OpenAI-Compatible RESTful APIs &amp; SDK: <ahref="https://github.com/lm-sys/FastChat/blob/main/docs/openai_api.md"class="uri">https://github.com/lm-sys/FastChat/blob/main/docs/openai_api.md</a></li><li>report error while iexecuteÂ <code>python -m fastchat.serve.openai_api_server --host localhost --port 8000</code>:<a href="https://github.com/lm-sys/FastChat/issues/1641"class="uri">https://github.com/lm-sys/FastChat/issues/1641</a></li><li>FastChat in Github: <a href="https://github.com/lm-sys/FastChat"class="uri">https://github.com/lm-sys/FastChat</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>AIGC</tag>
      
      <tag>å¤§æ¨¡å‹</tag>
      
      <tag>ç™¾å·æ¨¡å‹</tag>
      
      <tag>FastChat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åå…«ï¼‰LangChainä½¿ç”¨Google Search Agent</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E5%85%AB%EF%BC%89LangChain%E4%BD%BF%E7%94%A8Google-Search-Agent/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E5%85%AB%EF%BC%89LangChain%E4%BD%BF%E7%94%A8Google-Search-Agent/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="å¤§æ¨¡å‹å­˜åœ¨çš„é—®é¢˜">å¤§æ¨¡å‹å­˜åœ¨çš„é—®é¢˜</h3><p>å¤§æ¨¡å‹åœ¨ç»™äººå¸¦æ¥çœ¼å‰ä¸€äº®çš„è¡¨ç°ï¼Œæ·±æ·±åœ°éœ‡æ’¼å„è¡Œå„ä¸šäººä»¬çš„åŒæ—¶ï¼Œå…¶æœ¬èº«ä¹Ÿå­˜åœ¨ç€ä¸å°‘é—®é¢˜ã€‚</p><p>ä»¥OpenAIçš„ChatGPTæ¨¡å‹ä¸ºä¾‹ï¼Œå…¶å­˜åœ¨çš„é—®é¢˜æœ‰ï¼š</p><ol type="1"><li>äº‹å®é”™è¯¯ï¼Œå®¹æ˜“ä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ï¼Œé€ æˆå¹»è§‰é—®é¢˜ã€‚ <imgsrc="/img/nlp58_1.png"alt="ä¸ªå›­ã€ç˜¦è¥¿æ¹–é‡å¤ï¼Œå¹³æ±Ÿè·¯å¤è¡—æ˜¯è‹å·çš„æ™¯ç‚¹ï¼Œå›ç­”é”™è¯¯" /></li><li>é€»è¾‘æ¨ç†èƒ½åŠ›å¼±ï¼Œç¼ºä¹åƒäººç±»ä¸€æ ·çš„åˆ¤æ–­èƒ½åŠ› <img src="/img/nlp58_2.png"alt="å¤§æ¨¡å‹ä¸ä¼šåšæŒè‡ªå·±æ­£ç¡®çš„ç­”æ¡ˆï¼Œé€»è¾‘æ¨ç†èƒ½åŠ›å¼±" /></li><li>ä¸–ç•ŒçŸ¥è¯†çš„å±€é™æ€§ä¸æ—¶é™æ€§ï¼Œå¯¹ä¸“ä¸šé¢†åŸŸçŸ¥è¯†ã€ç§äººçŸ¥è¯†å’Œå®æ—¶ä¿¡æ¯ï¼Œæ— æ³•å›ç­”<img src="/img/nlp58_3.png"alt="OpenAIçš„ChatGPTæ¨¡å‹çš„çŸ¥è¯†åº“æˆªæ­¢è‡³2021å¹´9æœˆï¼Œæ— æ³•å›ç­”è¿™ä¹‹åçš„ä¿¡æ¯" /></li></ol><h3 id="langchainä¸­çš„agent">LangChainä¸­çš„Agent</h3><p>Agentï¼ˆä»£ç†ï¼‰æ˜¯LangChainä¸­çš„é«˜çº§åŠŸèƒ½ï¼Œå¯æ’ä»¶åŒ–åœ°å¯¹æ¨¡å‹å›ç­”è¿›è¡Œä¿®æ”¹æˆ–è¡¥å……ï¼Œå¼¥è¡¥æ¨¡å‹å­˜åœ¨çš„ä¸è¶³ï¼Œç›¸å½“äºæ¨¡å‹çš„æ’ä»¶ã€‚å…¶ä¸­ï¼ŒGoogleSearchä»£ç†å…è®¸æˆ‘ä»¬ä½¿ç”¨è°·æ­Œæœç´¢ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨Google Cloud credential console (<ahref="https://console.cloud.google.com/apis/credentials">https://console.cloud.google.com/apis/credentials</a>)ä¸­è·å–GOOGLE_API_KEYï¼Œåœ¨ProgrammableSearch Enginge (<ahref="https://programmablesearchengine.google.com/controlpanel/create">https://programmablesearchengine.google.com/controlpanel/create</a>)ä¸­è·å–GOOGLE_CSE_IDï¼Œæ¥ç€å®‰è£…<code>pip install google-api-python-client</code>ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚å…·ä½“çš„è®¾ç½®è¿‡ç¨‹ä¸åœ¨æ­¤è®²è¿°ï¼Œè¯»è€…å¯è‡ªè¡Œè®¾ç½®ã€‚</p><p>ä¸‹é¢å°†ä»‹ç»å¦‚ä½•åœ¨LangChainä¸­ä½¿ç”¨Google SearchAgentï¼ŒPythonç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br>os.environ[<span class="hljs-string">&quot;GOOGLE_CSE_ID&quot;</span>] = <span class="hljs-string">&quot;xxx&quot;</span><br>os.environ[<span class="hljs-string">&quot;GOOGLE_API_KEY&quot;</span>] = <span class="hljs-string">&quot;xxx&quot;</span><br><br><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> Tool<br><span class="hljs-keyword">from</span> langchain.utilities <span class="hljs-keyword">import</span> GoogleSearchAPIWrapper<br><br>search = GoogleSearchAPIWrapper()<br><br><br><span class="hljs-comment"># return first five search results</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">top3_results</span>(<span class="hljs-params">query</span>):<br>    <span class="hljs-keyword">return</span> search.results(query, <span class="hljs-number">3</span>)<br><br><br>tool = Tool(<br>    name=<span class="hljs-string">&quot;Google Search&quot;</span>,<br>    description=<span class="hljs-string">&quot;Search Google for recent results.&quot;</span>,<br>    func=top3_results,<br>)<br><br><span class="hljs-built_in">print</span>(tool.run(<span class="hljs-string">&quot;2022å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–è·å¾—è€…?&quot;</span>))<br></code></pre></td></tr></table></figure><p>è°·æ­Œæœç´¢ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>[{'title': 'ä¸‰åç§‘å­¦å®¶åˆ†äº«2022å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–-æ–°åç½‘', 'link':'http://www.news.cn/2022-10/04/c_1129050882.htm', 'snippet': 'Oct 4,2022 ...æ–°åç¤¾æ–¯å¾·å“¥å°”æ‘©10æœˆ4æ—¥ç”µï¼ˆè®°è€…å’Œè‹—ä»˜ä¸€é¸£ï¼‰ç‘å…¸çš‡å®¶ç§‘å­¦é™¢4æ—¥å®£å¸ƒï¼Œå°†2022å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–æˆäºˆæ³•å›½ç§‘å­¦å®¶é˜¿å…°Â·é˜¿æ–¯ä½©ã€ç¾å›½ç§‘å­¦å®¶çº¦ç¿°Â·å…‹åŠ³æ³½å’Œ...'},{'title': '2022å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–ä¸ºä½•é¢ç»™äº†è¿™ä¸‰ä½ï¼Ÿ -ä¸­æ–°ç½‘', 'link':'https://www.chinanews.com.cn/cj/2022/10-05/9867029.shtml', 'snippet':'Oct 5, 2022 ...åŒ—äº¬æ—¶é—´10æœˆ4æ—¥ä¸‹åˆï¼Œç‘å…¸çš‡å®¶ç§‘å­¦é™¢å®£å¸ƒï¼Œå°†2022å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–é¢ç»™æ³•å›½ç§‘å­¦å®¶é˜¿å…°Â·é˜¿æ–¯ä½©(AlainAspect)ã€ç¾å›½ç§‘å­¦å®¶çº¦ç¿°Â·å…‹åŠ³æ³½(John F.'}, {'title':'è§£è¯»2022å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–ï¼šä¸ºç¬¬äºŒæ¬¡é‡å­é©å‘½å¥ å®šåŸºç¡€--ç»æµÂ·ç§‘æŠ€ ...','link': 'http://finance.people.com.cn/n1/2022/1010/c1004-32542107.html','snippet': 'Oct 10, 2022 ...ç‘å…¸çš‡å®¶ç§‘å­¦é™¢4æ—¥å®£å¸ƒï¼Œå°†2022å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–æˆäºˆæ³•å›½ç§‘å­¦å®¶é˜¿å…°Â·é˜¿æ–¯ä½©ã€ç¾å›½ç§‘å­¦å®¶çº¦ç¿°Â·å…‹åŠ³æ³½å’Œå¥¥åœ°åˆ©ç§‘å­¦å®¶å®‰ä¸œÂ·è”¡æ—æ ¼ï¼Œä»¥è¡¨å½°ä»–ä»¬åœ¨â€œçº ç¼ å…‰å­...'}]</p></blockquote><h3 id="ä½¿ç”¨google-search-agentæ”¹å–„å¤§æ¨¡å‹">ä½¿ç”¨Google SearchAgentæ”¹å–„å¤§æ¨¡å‹</h3><p>å€ŸåŠ©Google SearchAgentï¼Œé’ˆå¯¹å¤§æ¨¡å‹å›ç­”ä¸äº†å®æ—¶ä¿¡æ¯æˆ–è¶…è¿‡è®­ç»ƒé¢„æ–™åº“çŸ¥è¯†çš„é—®é¢˜ï¼Œæˆ‘ä»¬èƒ½å¾ˆå¥½åœ°æ”¹å–„è¿™ä¸€é—®é¢˜ã€‚è¿™ä¹Ÿæ˜¯å¦‚ä½•ä½¿ç”¨å¤–éƒ¨çŸ¥è¯†æ¥æ”¹å–„å¤§æ¨¡å‹è¡¨ç°çš„ä¸€ç§åŠæ³•ã€‚</p><p>ä»¥ä¸‹æ˜¯ç¤ºä¾‹Pythonä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> ZeroShotAgent, Tool, AgentExecutor<br><span class="hljs-keyword">from</span> langchain.memory <span class="hljs-keyword">import</span> ConversationBufferMemory<br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> OpenAI, LLMChain<br><span class="hljs-keyword">from</span> langchain.utilities <span class="hljs-keyword">import</span> GoogleSearchAPIWrapper<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> initialize_agent<br><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> AgentType<br><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> load_tools<br><br>os.environ[<span class="hljs-string">&quot;GOOGLE_CSE_ID&quot;</span>] = <span class="hljs-string">&quot;xxx&quot;</span><br>os.environ[<span class="hljs-string">&quot;GOOGLE_API_KEY&quot;</span>] = <span class="hljs-string">&quot;xxx&quot;</span><br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;sk-xxx&#x27;</span><br><br>llm = OpenAI(model_name=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>, temperature=<span class="hljs-number">0</span>)<br>tools = load_tools([<span class="hljs-string">&quot;google-search&quot;</span>], llm=llm)<br><br>agent = initialize_agent(tools, llm, agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION, verbose=<span class="hljs-literal">True</span>)<br><br><span class="hljs-built_in">print</span>(agent.run(<span class="hljs-string">&quot;ç°åœ¨ä¸Šæµ·çš„åœ°é“é‡Œç¨‹æœ‰å¤šå°‘ï¼Ÿ&quot;</span>))<br></code></pre></td></tr></table></figure><p>å¯¹äºâ€œç°åœ¨ä¸Šæµ·çš„åœ°é“é‡Œç¨‹æœ‰å¤šå°‘ï¼Ÿâ€è¿™ä¸ªé—®é¢˜ï¼ŒLangChainçš„å›å¤é“¾åŠæœ€ç»ˆç­”æ¡ˆå¦‚ä¸‹ï¼š</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">&gt; Entering <span class="hljs-built_in">new</span>  chain...<br>I<span class="hljs-comment">&#x27;m not sure about the current length of the Shanghai subway system.</span><br><span class="hljs-symbol">Action:</span> google_search<br>Action Input: <span class="hljs-string">&quot;current length of Shanghai subway system&quot;</span><br><span class="hljs-symbol">Observation:</span> <span class="hljs-keyword">With</span> a total length <span class="hljs-keyword">of</span> <span class="hljs-number">169</span> km it <span class="hljs-built_in">is</span> the world<span class="hljs-comment">&#x27;s 2nd largest fully automated metro system, after the Singapore MRT. Most lines currently use 6 car sets, with the ... Dec 29, 2021 ... Beijing&#x27;s epic subway system added 53 kilometers of new track in 2021, ... addition of Line 14, the total length of the Shanghai Metro now ... This article lists the openings of lines, line segments, stations and fare schemes of the ... The first section opened in 1993, and the system currently has 802 ... Apr 15, 2010</span><br><span class="hljs-symbol">Thought:</span>Based <span class="hljs-keyword">on</span> the search results, the current length <span class="hljs-keyword">of</span> the Shanghai subway system <span class="hljs-built_in">is</span> <span class="hljs-number">831</span> kilometers (<span class="hljs-number">516.4</span> miles).<br>Final Answer: The current length <span class="hljs-keyword">of</span> the Shanghai subway system <span class="hljs-built_in">is</span> <span class="hljs-number">831</span> kilometers.<br><br>&gt; Finished chain.<br>The current length <span class="hljs-keyword">of</span> the Shanghai subway system <span class="hljs-built_in">is</span> <span class="hljs-number">831</span> kilometers.<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹å‡ ä¸ªä¾‹å­ï¼š</p><blockquote><p>é—®é¢˜ï¼š2022å¹´çš„è¯ºè´å°”ç‰©ç†å­¦å®¶è·å¾—è€…æ˜¯è°ï¼Ÿ å›ç­”ï¼šThe 2022 Nobel Prizein Physics was awarded to Alain Aspect, John F. Clauser, and AntonZeilinger.</p></blockquote><blockquote><p>é—®é¢˜ï¼š2022å¹´çš„ä¸Šæµ·å¸‚å¸‚é•¿æ˜¯è°ï¼Ÿ å›ç­”ï¼š2022å¹´çš„ä¸Šæµ·å¸‚å¸‚é•¿æ˜¯é¾šæ­£ã€‚</p></blockquote><blockquote><p>é—®é¢˜ï¼š2023å¹´è‹è¿ªæ›¼æ¯åœ¨å“ªé‡Œä¸¾è¡Œï¼Œè·èƒœè€…æ˜¯è°ï¼Ÿ å›ç­”ï¼šThe 2023 SudirmanCup was held in Suzhou, China, and the winner was China.</p></blockquote><blockquote><p>é—®é¢˜ï¼šä»Šå¹´çš„ç«¯åˆèŠ‚æ˜¯å“ªå‡ å¤©ï¼Ÿ å›ç­”ï¼šThis year's Dragon Boat Festivalwill be on June 22nd, 2023.</p></blockquote><p>æœ‰äº†Google SearchAgentï¼ŒChatGPTèƒ½å¾ˆå¥½åœ°å›å¤ä¸Šè¿°é—®é¢˜ï¼Œè§£å†³äº†å®æ—¶ä¿¡æ¯æ— æ³•å›ç­”çš„é—®é¢˜ï¼Œé¿å…äº†ä¸–ç•ŒçŸ¥è¯†çš„å±€é™æ€§å’Œæ—¶æ•ˆæ€§ã€‚è€Œæ²¡æœ‰GoogleSearchAgentï¼Œå¯¹äºä¸Šè¿°é—®é¢˜ï¼ŒåŸºæœ¬æ— æ³•å›ç­”ï¼Œå°±ç®—èƒ½å›ç­”ï¼Œä¹Ÿæ˜¯2021å¹´9æœˆä¹‹å‰çš„æ–‡æœ¬ä¿¡æ¯äº†ã€‚</p><p>ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼ŒLangChainä½¿ç”¨Google SearchAgentï¼Œç»™å‡ºçš„é—®é¢˜ç­”å¤ï¼Œå¾€å¾€éƒ½æ˜¯è‹±è¯­ã€‚è€Œæˆ‘ä»¬æƒ³å¾—åˆ°ä¸­æ–‡ç­”æ¡ˆçš„è¯ï¼Œè¿˜éœ€è¦å†æƒ³ä¸€ç‚¹åŠæ³•ï¼Œä½†å›å¤çš„å†…å®¹æ˜¯ä»¤äººæ»¡æ„çš„ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨LangChainä¸­ä½¿ç”¨Google SearchAgentï¼Œæ¥æ”¹å–„å¤§æ¨¡å‹å­˜åœ¨çš„ä¸è¶³ä¹‹å¤„ã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>Google Searchï¼š<ahref="https://python.langchain.com/docs/modules/agents/tools/integrations/google_search">https://python.langchain.com/docs/modules/agents/tools/integrations/google_search</a></li><li>Googleæœç´¢åŒ…è£…å™¨ï¼š<ahref="https://www.langchain.asia/ecosystem/google_search">https://www.langchain.asia/ecosystem/google_search</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>LangChain</tag>
      
      <tag>AIGC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åä¸ƒï¼‰LangChainçš„ç»“æ„åŒ–è¾“å‡º</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B8%83%EF%BC%89LangChain%E7%9A%84%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B8%83%EF%BC%89LangChain%E7%9A%84%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨ä½¿ç”¨å¤§æ¨¡å‹çš„æ—¶å€™ï¼Œå°½ç®¡æˆ‘ä»¬çš„promptå·²ç»è¦æ±‚å¤§æ¨¡å‹ç»™å‡ºå›ºå®šçš„è¾“å‡ºæ ¼å¼ï¼Œæ¯”å¦‚JSONï¼Œä½†å¾ˆå¤šæ—¶å€™ï¼Œå¤§æ¨¡å‹è¿˜æ˜¯ä¼šè¾“å‡ºé¢å¤–çš„ä¿¡æ¯ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨å¯¹è¾“å‡ºä¿¡æ¯è¿›è¡Œç»“æ„åŒ–çš„æ—¶å€™äº§ç”Ÿå›°éš¾ã€‚LangChainå·¥å…·å¯ä»¥å¾ˆå¥½åœ°å°†è¾“å‡ºä¿¡æ¯è¿›è¡Œç»“æ„åŒ–ã€‚</p><p>å…³äºLangChainçš„ç»“æ„åŒ–è¾“å‡ºï¼Œå¯å‚è€ƒç½‘å€ï¼š<ahref="https://python.langchain.com/docs/modules/model_io/output_parsers/">https://python.langchain.com/docs/modules/model_io/output_parsers/</a>ï¼Œè¿™å…¶ä¸­ï¼Œæˆ‘ä»¬è¾ƒä¸ºå…³æ³¨çš„æ˜¯<code>Structured output parser</code>ï¼Œé€šè¿‡å®šä¹‰<code>StructuredOutputParser</code>æ¥ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">response_schemas = [<br>    ResponseSchema(name=<span class="hljs-string">&quot;answer&quot;</span>, description=<span class="hljs-string">&quot;answer to the user&#x27;s question&quot;</span>),<br>    ResponseSchema(name=<span class="hljs-string">&quot;source&quot;</span>, description=<span class="hljs-string">&quot;source used to answer the user&#x27;s question, should be a website.&quot;</span>)<br>]<br>output_parser = StructuredOutputParser.from_response_schemas(response_schemas)<br></code></pre></td></tr></table></figure><h3 id="ä¸€ä¸ªä¾‹å­">ä¸€ä¸ªä¾‹å­</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ç»“æ„åŒ–è¾“å‡ºçš„promptçš„å†™æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.output_parsers <span class="hljs-keyword">import</span> StructuredOutputParser, ResponseSchema<br><span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> PromptTemplate<br><br><span class="hljs-comment"># å‘Šè¯‰ä»–æˆ‘ä»¬ç”Ÿæˆçš„å†…å®¹éœ€è¦å“ªäº›å­—æ®µï¼Œæ¯ä¸ªå­—æ®µç±»å‹å¼å•¥</span><br>response_schemas = [<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;string&quot;</span>, name=<span class="hljs-string">&quot;bad_string&quot;</span>, description=<span class="hljs-string">&quot;This a poorly formatted user input string&quot;</span>),<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;string&quot;</span>, name=<span class="hljs-string">&quot;good_string&quot;</span>, description=<span class="hljs-string">&quot;This is your response, a reformatted response&quot;</span>)<br>]<br><br><span class="hljs-comment"># åˆå§‹åŒ–è§£æå™¨</span><br>output_parser = StructuredOutputParser.from_response_schemas(response_schemas)<br><br><span class="hljs-comment"># ç”Ÿæˆçš„æ ¼å¼æç¤ºç¬¦</span><br>format_instructions = output_parser.get_format_instructions()<br><span class="hljs-built_in">print</span>(format_instructions)<br><br><span class="hljs-comment"># åŠ å…¥è‡³templateä¸­</span><br>template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">You will be given a poorly formatted string from a user.</span><br><span class="hljs-string">Reformat it and make sure all the words are spelled correctly</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#123;format_instructions&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">% USER INPUT:</span><br><span class="hljs-string">&#123;user_input&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">YOUR RESPONSE:</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># å°†æˆ‘ä»¬çš„æ ¼å¼æè¿°åµŒå…¥åˆ°promptä¸­å»ï¼Œå‘Šè¯‰llmæˆ‘ä»¬éœ€è¦ä»–è¾“å‡ºä»€ä¹ˆæ ·æ ¼å¼çš„å†…å®¹</span><br>prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;user_input&quot;</span>],<br>    partial_variables=&#123;<span class="hljs-string">&quot;format_instructions&quot;</span>: format_instructions&#125;,<br>    template=template<br>)<br><br>promptValue = prompt.<span class="hljs-built_in">format</span>(user_input=<span class="hljs-string">&quot;welcom to califonya!&quot;</span>)<br><span class="hljs-built_in">print</span>(promptValue)<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œç»“æ„åŒ–è¾“å‡ºçš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">The output should be a markdown code snippet formatted <span class="hljs-keyword">in</span> the following schema, including the leading and trailing <span class="hljs-string">&quot;```json&quot;</span> and <span class="hljs-string">&quot;```&quot;</span>:<br><br>\```json<br>&#123;<br><span class="hljs-string">&quot;bad_string&quot;</span>: string  // This a poorly formatted user input string<br><span class="hljs-string">&quot;good_string&quot;</span>: string  // This is your response, a reformatted response<br>&#125;<br>\```<br></code></pre></td></tr></table></figure><p>promptçš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">You will be given a poorly formatted string from a user.<br>Reformat it and make sure all the words are spelled correctly<br><br>The output should be a markdown code snippet formatted <span class="hljs-keyword">in</span> the following schema, including the leading and trailing <span class="hljs-string">&quot;```json&quot;</span> and <span class="hljs-string">&quot;```&quot;</span>:<br><br>\```json<br>&#123;<br><span class="hljs-string">&quot;bad_string&quot;</span>: string  // This a poorly formatted user input string<br><span class="hljs-string">&quot;good_string&quot;</span>: string  // This is your response, a reformatted response<br>&#125;<br>\```<br><br>% USER INPUT:<br>welcom to califonya!<br><br>YOUR RESPONSE:<br></code></pre></td></tr></table></figure><p>å°†ä¸Šè¿°å†…å®¹ä½¿ç”¨LLMè¿›è¡Œå›å¤ï¼Œç¤ºä¾‹Pyhonä»£ç å¦‚ä¸‹ï¼ˆæ¥ä¸Šè¿°ä»£ç ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><br><span class="hljs-comment"># set api key</span><br><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;sk-xxx&#x27;</span><br><br>llm = OpenAI(model_name=<span class="hljs-string">&quot;text-davinci-003&quot;</span>)<br><br>llm_output = llm(promptValue)<br><span class="hljs-built_in">print</span>(llm_output)<br><br><span class="hljs-comment"># ä½¿ç”¨è§£æå™¨è¿›è¡Œè§£æç”Ÿæˆçš„å†…å®¹</span><br><span class="hljs-built_in">print</span>(output_parser.parse(llm_output))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">```json<br>&#123;<br><span class="hljs-string">&quot;bad_string&quot;</span>: <span class="hljs-string">&quot;welcom to califonya!&quot;</span>,<br><span class="hljs-string">&quot;good_string&quot;</span>: <span class="hljs-string">&quot;Welcome to California!&quot;</span><br>&#125;<br>\```<br>&#123;<span class="hljs-string">&#x27;bad_string&#x27;</span>: <span class="hljs-string">&#x27;welcom to califonya!&#x27;</span>, <span class="hljs-string">&#x27;good_string&#x27;</span>: <span class="hljs-string">&#x27;Welcome to California!&#x27;</span>&#125;<br></code></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤§æ¨¡å‹çš„è¾“å‡ºç»“æœæ­£æ˜¯æˆ‘ä»¬æ‰€è¦æ±‚çš„JSONæ ¼å¼ï¼Œä¸”å­—æ®µå’Œæ•°æ®ç±»å‹ã€è¾“å‡ºç»“æœä»˜å‡ºé¢„æœŸã€‚</p><h3 id="ç»“æ„åŒ–æŠ½å–">ç»“æ„åŒ–æŠ½å–</h3><p>æœ‰äº†ä¸Šè¿°çš„ç»“æ„åŒ–è¾“å‡ºï¼Œæˆ‘ä»¬å°è¯•å¯¹æ–‡æœ¬è¿›è¡Œç»“æ„åŒ–æŠ½å–ï¼Œå¹¶ä½¿å¾—æŠ½å–ç»“æœæŒ‰JSONæ ¼å¼è¾“å‡ºã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.output_parsers <span class="hljs-keyword">import</span> StructuredOutputParser, ResponseSchema<br><span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> PromptTemplate<br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><br><span class="hljs-comment"># set api key</span><br><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;sk-xxx&#x27;</span><br><br>llm = OpenAI(model_name=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>)<br><br><span class="hljs-comment"># å‘Šè¯‰ä»–æˆ‘ä»¬ç”Ÿæˆçš„å†…å®¹éœ€è¦å“ªäº›å­—æ®µï¼Œæ¯ä¸ªå­—æ®µç±»å‹å¼å•¥</span><br>response_schemas = [<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;number&quot;</span>, name=<span class="hljs-string">&quot;number&quot;</span>, description=<span class="hljs-string">&quot;æ–‡æœ¬ä¸­çš„æ•°å­—&quot;</span>),<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;string&quot;</span>, name=<span class="hljs-string">&quot;people&quot;</span>, description=<span class="hljs-string">&quot;æ–‡æœ¬ä¸­çš„äººç‰©&quot;</span>),<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;string&quot;</span>, name=<span class="hljs-string">&quot;place&quot;</span>, description=<span class="hljs-string">&quot;æ–‡æœ¬ä¸­çš„åœ°ç‚¹&quot;</span>),<br>]<br><br><span class="hljs-comment"># åˆå§‹åŒ–è§£æå™¨</span><br>output_parser = StructuredOutputParser.from_response_schemas(response_schemas)<br><br><span class="hljs-comment"># ç”Ÿæˆçš„æ ¼å¼æç¤ºç¬¦</span><br>format_instructions = output_parser.get_format_instructions()<br><span class="hljs-built_in">print</span>(format_instructions)<br><br>template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">ç»™å®šä¸‹é¢çš„æ–‡æœ¬ï¼Œæ‰¾å‡ºç‰¹å®šçš„ç»“æ„åŒ–ä¿¡æ¯ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#123;format_instructions&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">% USER INPUT:</span><br><span class="hljs-string">&#123;user_input&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">YOUR RESPONSE:</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># prompt</span><br>prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;user_input&quot;</span>],<br>    partial_variables=&#123;<span class="hljs-string">&quot;format_instructions&quot;</span>: format_instructions&#125;,<br>    template=template<br>)<br><br>promptValue = prompt.<span class="hljs-built_in">format</span>(user_input=<span class="hljs-string">&quot;å¼ æ™“æ˜ä»Šå¤©åœ¨é¦™æ¸¯åäº†2è¶Ÿåœ°é“ã€‚&quot;</span>)<br><span class="hljs-built_in">print</span>(promptValue)<br>llm_output = llm(promptValue)<br><span class="hljs-built_in">print</span>(llm_output)<br><br><span class="hljs-comment"># ä½¿ç”¨è§£æå™¨è¿›è¡Œè§£æç”Ÿæˆçš„å†…å®¹</span><br><span class="hljs-built_in">print</span>(output_parser.parse(llm_output))<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦æ±‚ä»è¾“å…¥æ–‡æœ¬ä¸­æŠ½å–å‡ºnumberã€peopleã€placeå­—æ®µï¼Œæ•°æ®ç±»å‹åˆ†åˆ«ä¸ºnumberã€stringã€stringï¼ŒæŠ½å–è¦æ±‚ä¸ºæ–‡æœ¬ä¸­çš„æ•°å­—ã€äººç‰©ã€åœ°ç‚¹ã€‚æ³¨æ„ï¼ŒResponseSchemaä¸­çš„æ•°æ®ç±»å‹ï¼ˆtypeï¼‰ä¸JSONæ•°æ®ç±»å‹ä¸€è‡´ã€‚</p><p>å¯¹ä¸¤ä¸ªæ ·ä¾‹æ–‡æœ¬è¿›è¡ŒæŠ½å–ï¼ŒæŠ½å–ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>è¾“å…¥ï¼šå¼ æ™“æ˜ä»Šå¤©åœ¨é¦™æ¸¯åäº†2è¶Ÿåœ°é“ã€‚ æŠ½å–ç»“æœï¼š{'number': 2, 'people':'å¼ æ™“æ˜', 'place': 'é¦™æ¸¯'}</p></blockquote><blockquote><p>è¾“å…¥ï¼šæ˜¨å¤©Bç«™14å‘¨å¹´çš„åˆ†äº«ä¼šä¸Šï¼ŒBç«™CEOé™ˆç¿å¯¹è¿™ä¸ªæŒ‡æ ‡åšäº†å®˜æ–¹çš„å®šä¹‰ï¼Œç”¨æˆ·è§‚çœ‹è§†é¢‘æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ’­æ”¾åˆ†é’Ÿæ•°ã€‚æŠ½å–ç»“æœï¼š{'number': 14, 'people': 'é™ˆç¿', 'place': 'Bç«™'}</p></blockquote><p>æŠ½å–çš„ç»“æœå¤§å¤šç¬¦åˆé¢„æœŸï¼Œé™¤äº†ç¬¬äºŒå¥ä¸­å°†Bç«™è¯†åˆ«ä¸ºåœ°ç‚¹ï¼Œä¸å¤ªåˆç†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å†™çš„promptè¿‡äºç®€å•ï¼Œè¯»è€…å¯ä»¥å°è¯•æ›´å¤šæ›´å¥½çš„promptçš„æè¿°æ–¹å¼ï¼Œè¿™æ ·ä¹Ÿè®¸èƒ½æå‡æŠ½å–çš„æ•ˆæœã€‚</p><h3 id="ç»“æ„åŒ–æŠ½å–è¿›é˜¶">ç»“æ„åŒ–æŠ½å–è¿›é˜¶</h3><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºï¼Œæ¥å®ç°NLPä¸­çš„å¸¸è§ä»»åŠ¡ï¼š<code>å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰</code>ï¼Œæˆ‘ä»¬éœ€è¦ä»æ–‡æœ¬ä¸­æŠ½å–å‡ºå…¶ä¸­çš„æ—¶é—´ã€äººç‰©ã€åœ°ç‚¹ã€ç»„ç»‡æœºæ„ç­‰ï¼Œå¹¶ä»¥JSONæ ¼å¼è¾“å‡ºï¼Œæ¯ä¸ªå­—æ®µéƒ½ä»¥åˆ—è¡¨å½¢å¼å‘ˆç°ã€‚</p><p>å®ç°çš„Pythonä»£ç å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.output_parsers <span class="hljs-keyword">import</span> StructuredOutputParser, ResponseSchema<br><span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> PromptTemplate<br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><br><span class="hljs-comment"># set api key</span><br><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;sk-xxx&#x27;</span><br><br>llm = OpenAI(model_name=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>)<br><br><span class="hljs-comment"># å‘Šè¯‰ä»–æˆ‘ä»¬ç”Ÿæˆçš„å†…å®¹éœ€è¦å“ªäº›å­—æ®µï¼Œæ¯ä¸ªå­—æ®µç±»å‹å¼å•¥</span><br>response_schemas = [<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;array&quot;</span>, name=<span class="hljs-string">&quot;time&quot;</span>, description=<span class="hljs-string">&quot;æ–‡æœ¬ä¸­çš„æ—¥æœŸæ—¶é—´åˆ—è¡¨&quot;</span>),<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;array&quot;</span>, name=<span class="hljs-string">&quot;people&quot;</span>, description=<span class="hljs-string">&quot;æ–‡æœ¬ä¸­çš„äººç‰©åˆ—è¡¨&quot;</span>),<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;array&quot;</span>, name=<span class="hljs-string">&quot;place&quot;</span>, description=<span class="hljs-string">&quot;æ–‡æœ¬ä¸­çš„åœ°ç‚¹åˆ—è¡¨&quot;</span>),<br>    ResponseSchema(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;array&quot;</span>, name=<span class="hljs-string">&quot;org&quot;</span>, description=<span class="hljs-string">&quot;æ–‡æœ¬ä¸­çš„ç»„ç»‡æœºæ„åˆ—è¡¨&quot;</span>),<br>]<br><br><span class="hljs-comment"># åˆå§‹åŒ–è§£æå™¨</span><br>output_parser = StructuredOutputParser.from_response_schemas(response_schemas)<br><br><span class="hljs-comment"># ç”Ÿæˆçš„æ ¼å¼æç¤ºç¬¦</span><br>format_instructions = output_parser.get_format_instructions()<br><span class="hljs-built_in">print</span>(format_instructions)<br><br>template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">ç»™å®šä¸‹é¢çš„æ–‡æœ¬ï¼Œæ‰¾å‡ºç‰¹å®šçš„å®ä½“ä¿¡æ¯ï¼Œå¹¶ä»¥ç»“æ„åŒ–æ•°æ®æ ¼å¼è¿”å›ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#123;format_instructions&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">% USER INPUT:</span><br><span class="hljs-string">&#123;user_input&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">YOUR RESPONSE:</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># prompt</span><br>prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;user_input&quot;</span>],<br>    partial_variables=&#123;<span class="hljs-string">&quot;format_instructions&quot;</span>: format_instructions&#125;,<br>    template=template<br>)<br><br>promptValue = prompt.<span class="hljs-built_in">format</span>(user_input=<span class="hljs-string">&quot;6æœˆ26æ—¥ï¼Œå¹¿æ±½é›†å›¢åœ¨ç§‘æŠ€æ—¥ä¸Šé¦–æ¬¡å…¬å¼€å±•ç¤ºé£è¡Œæ±½è½¦é¡¹ç›®ï¼Œé£è¡Œæ±½è½¦GOVEå®Œæˆå…¨çƒé¦–é£ã€‚å¹¿æ±½ç ”ç©¶é™¢é™¢é•¿å´åšè¡¨ç¤ºï¼ŒGOVEå¯ä»¥å‚ç›´èµ·é™ï¼Œå¹¶æ­è½½åŒå¤‡ä»½å¤šæ—‹ç¿¼é£è¡Œç³»ç»Ÿï¼Œä¿éšœé£è¡Œå®‰å…¨ã€‚&quot;</span>)<br><span class="hljs-built_in">print</span>(promptValue)<br>llm_output = llm(promptValue)<br><span class="hljs-built_in">print</span>(llm_output)<br><br><span class="hljs-comment"># ä½¿ç”¨è§£æå™¨è¿›è¡Œè§£æç”Ÿæˆçš„å†…å®¹</span><br><span class="hljs-built_in">print</span>(output_parser.parse(llm_output))<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ä¸‰ä¸ªç¤ºä¾‹æ–‡æœ¬ä¸­è¿›è¡Œå®éªŒï¼Œçœ‹çœ‹å¤§æ¨¡å‹åœ¨NERæ–¹é¢çš„è¡¨ç°ï¼š</p><blockquote><p>è¾“å…¥ï¼š6æœˆ26æ—¥å‘¨ä¸€ï¼Œä¹Œå…‹å…°æ€»ç»Ÿæ³½è¿æ–¯åŸºè§†å¯Ÿäº†ä¹Œå…‹å…°å†›é˜Ÿä¸œçº¿å¸ä»¤éƒ¨æ€»éƒ¨ï¼Œè€Œå°±åœ¨å‡ å°æ—¶å‰ï¼Œä¿„ç½—æ–¯å®£å¸ƒæ§åˆ¶è¯¥å›½ä¸œéƒ¨é¡¿æ¶…èŒ¨å…‹ä»¥å—çš„åˆ©å¤«è¯ºæ³¢å°”ã€‚æŠ½å–ç»“æœï¼š{'time': ['6æœˆ26æ—¥å‘¨ä¸€'], 'people': ['æ³½è¿æ–¯åŸº'], 'place':['ä¹Œå…‹å…°å†›é˜Ÿä¸œçº¿å¸ä»¤éƒ¨æ€»éƒ¨', 'é¡¿æ¶…èŒ¨å…‹', 'åˆ©å¤«è¯ºæ³¢å°”'], 'org':['ä¹Œå…‹å…°æ€»ç»Ÿ', 'ä¿„ç½—æ–¯']}</p></blockquote><blockquote><p>è¾“å…¥ï¼šæ—¥å‰ï¼Œé©¬è‡ªè¾¾æ‰¾æ¥æ¢å®¶è¾‰ä»£è¨€æ±½è½¦ï¼Œå¼•å‘äº†ä¸šå†…çš„çƒ­è®®ã€‚ç›¸ä¿¡å¾ˆå¤šäººå¯¹äºé©¬è‡ªè¾¾çš„å“ç‰Œè®¤çŸ¥æ¥è‡ªæ¢å®¶è¾‰çš„é‚£éƒ¨ç”µå½±ã€‚æŠ½å–ç»“æœï¼š{'time': [], 'people': ['æ¢å®¶è¾‰'], 'place': [], 'org':['é©¬è‡ªè¾¾']}</p></blockquote><blockquote><p>è¾“å…¥ï¼š6æœˆ26æ—¥ï¼Œå¹¿æ±½é›†å›¢åœ¨ç§‘æŠ€æ—¥ä¸Šé¦–æ¬¡å…¬å¼€å±•ç¤ºé£è¡Œæ±½è½¦é¡¹ç›®ï¼Œé£è¡Œæ±½è½¦GOVEå®Œæˆå…¨çƒé¦–é£ã€‚å¹¿æ±½ç ”ç©¶é™¢é™¢é•¿å´åšè¡¨ç¤ºï¼ŒGOVEå¯ä»¥å‚ç›´èµ·é™ï¼Œå¹¶æ­è½½åŒå¤‡ä»½å¤šæ—‹ç¿¼é£è¡Œç³»ç»Ÿï¼Œä¿éšœé£è¡Œå®‰å…¨ã€‚æŠ½å–ç»“æœï¼š{'time': ['6æœˆ26æ—¥'], 'people': ['å´åš'], 'place': [], 'org':['å¹¿æ±½é›†å›¢', 'å¹¿æ±½ç ”ç©¶é™¢']}</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç»è¿‡ç®€å•çš„promptå’Œç»“æ„åŒ–è¾“å‡ºåï¼Œå¤§æ¨¡å‹çš„æŠ½å–ç»“æœå¤§è‡´ä¸Šä»¤äººæ»¡æ„ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†LangChainçš„ç»“æ„åŒ–è¾“å‡ºï¼Œè¿™åœ¨æˆ‘ä»¬éœ€è¦å¯¹æ¨¡å‹è¾“å‡ºç»“æœè¿›è¡Œç»“æ„åŒ–è§£ææ—¶è¾ƒä¸ºæœ‰ç”¨ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ¥ä½ç»“æ„åŒ–è¾“å‡ºå®Œæˆä¸€äº›å¸¸è§çš„NLPçš„ä»»åŠ¡ï¼Œå¦‚NERç­‰ã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>LangChain ä¸­æ–‡å…¥é—¨æ•™ç¨‹: <ahref="https://liaokong.gitbook.io/llm-kai-fa-jiao-cheng/">https://liaokong.gitbook.io/llm-kai-fa-jiao-cheng/</a></li><li>Structured output parser: <ahref="https://python.langchain.com/docs/modules/model_io/output_parsers/structured">https://python.langchain.com/docs/modules/model_io/output_parsers/structured</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>LangChain</tag>
      
      <tag>AIGC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åå…­ï¼‰LangChainå…¥é—¨</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E5%85%AD%EF%BC%89LangChain%E5%85%A5%E9%97%A8/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E5%85%AD%EF%BC%89LangChain%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="langchainç®€ä»‹">LangChainç®€ä»‹</h3><h4 id="èƒŒæ™¯">èƒŒæ™¯</h4><p>ç”±äºChatGPTçš„å‘è¡Œï¼Œå¤§æ¨¡å‹ï¼ˆLarge Language Model,LLMï¼‰å·²ç»å˜å¾—éå¸¸æµè¡Œäº†ã€‚ä¹Ÿè®¸ä½ å¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„èµ„é‡‘å’Œè®¡ç®—èµ„æºä»å¤´å¼€å§‹è®­ç»ƒå¤§æ¨¡å‹ï¼Œä½†ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨å¤§æ¨¡å‹æ¥åšä¸€äº›æ¯”è¾ƒé…·çš„äº‹æƒ…ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä¸ªäººåŠ©ç†ï¼šèƒ½åŸºäºä½ çš„æ•°æ®ä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œäº’åŠ¨äº¤æµ</li><li>å¯¹è¯æœºå™¨äººï¼šé€‚åˆä½ ä¸ªäººä½¿ç”¨åå¥½çš„å¯¹è¯æœºå™¨äºº</li><li>åˆ†ææ€»ç»“ï¼šå¯¹æ–‡æ¡£æˆ–ä»£ç è¿›è¡Œåˆ†æå’Œæ€»ç»“</li></ul><p>é€šè¿‡å„å¼å„æ ·çš„APIå’Œæç¤ºå·¥ç¨‹ï¼ˆPromptEngineeringï¼‰ï¼Œå¤§æ¨¡å‹æ­£åœ¨æ”¹å˜æˆ‘ä»¬åˆ›å»ºåŸºäºAIå¼€å‘çš„äº§å“çš„æ–¹å¼ã€‚è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆåœ¨LLMèƒŒæ™¯ä¸‹ï¼Œç°åœ¨åˆ°å¤„éƒ½åœ¨å‡ºç°æ–°çš„å¼€å‘è€…å·¥å…·ï¼Œè¿™å°±æœ‰äº†ä¸€ä¸ªæ–°çš„ä¸“ä¸šæœ¯è¯­ï¼šLLMOpsï¼ˆç±»ä¼¼çš„ä¸“ä¸šæœ¯è¯­ä¸ºDevOpsï¼‰ã€‚</p><p>å…¶ä¸­çš„ä¸€ä¸ªæ–°å·¥å…·å°±æ˜¯LangChainã€‚</p><h4 id="langchainä»‹ç»">LangChainä»‹ç»</h4><p>LangChainæ˜¯ä¸€ä¸ªåŸºäºè¯­è¨€æ¨¡å‹çš„åº”ç”¨å¼€å‘æ¡†æ¶ã€‚å®ƒåœ¨æå‡åº”ç”¨æ–¹é¢çš„ä½œç”¨ä¸ºï¼š</p><ul><li>æ•°æ®æ„ŸçŸ¥ï¼šå¯ä»¥ä½¿ç”¨å…¶å®ƒæ•°æ®èµ„æºæ¥è¿æ¥ä¸€ä¸ªè¯­è¨€æ¨¡å‹</li><li>ä»£ç†å¼çš„ï¼šå…è®¸ä¸€ä¸ªè¯­è¨€æ¨¡å‹ä¸å®ƒçš„ç¯å¢ƒè¿›è¡Œäº’åŠ¨</li></ul><p>LangChainçš„ä¸»è¦é“å…·ä¸ºï¼š</p><ol type="1"><li>åˆ†æ”¯ï¼ˆComponentsï¼‰ï¼šå¯¹å¦‚ä½•ä½¿ç”¨è¯­è¨€æ¨¡å‹æ¥è¿›è¡Œå·¥ä½œçš„æ‘˜è¦ï¼Œæ¯ä¸ªæ‘˜è¦éƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œæ“ä½œçš„é›†åˆã€‚åˆ†æ”¯æ˜¯æ¨¡å—åŒ–çš„ï¼Œå®¹æ˜“ä½¿ç”¨çš„ï¼Œä¸ç®¡ä½ æ˜¯å¦åœ¨ä½¿ç”¨LangChainæ¡†æ¶çš„å‰©ä½™éƒ¨åˆ†ã€‚</li><li>ç°æˆçš„é“¾ï¼ˆChainsï¼‰ï¼šç”¨äºå®Œæˆç‰¹å®šæ›´é«˜é˜¶ä»»åŠ¡çš„åˆ†æ”¯çš„ç»“æ„åŒ–ç»„è£…</li></ol><p>ç°æˆçš„é“¾ä½¿å¾—å®ƒå®¹æ˜“ä¸Šæ‰‹ã€‚å¯¹äºæ›´å¤æ‚çš„åº”ç”¨å’Œç»†è‡´çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œåˆ†æ”¯ä½¿å¾—å®ƒå®¹æ˜“å»é€‚åº”ç°æœ‰çš„é“¾æˆ–åˆ›å»ºæ–°çš„é“¾ã€‚</p><h4 id="langchainèƒ½åšä»€ä¹ˆ">LangChainèƒ½åšä»€ä¹ˆ</h4><p>LangChainæä¾›äº†å…­ä¸ªä¸»è¦æ¨¡å—çš„æ”¯æŒï¼Œè¿™äº›æ¨¡å—æŒ‰ç…§é€æ¸å¢åŠ çš„å¤æ‚æ€§æ’åˆ—å¦‚ä¸‹ï¼š</p><ul><li><ahref="https://www.langchain.asia/modules/models">æ¨¡å‹ï¼ˆmodelsï¼‰</a> :LangChain æ”¯æŒçš„å„ç§æ¨¡å‹ç±»å‹å’Œæ¨¡å‹é›†æˆã€‚</li><li><ahref="https://www.langchain.asia/modules/prompts">æç¤ºï¼ˆpromptsï¼‰</a> :åŒ…æ‹¬æç¤ºç®¡ç†ã€æç¤ºä¼˜åŒ–å’Œæç¤ºåºåˆ—åŒ–ã€‚</li><li><ahref="https://www.langchain.asia/modules/memory">å†…å­˜ï¼ˆmemoryï¼‰</a> :å†…å­˜æ˜¯åœ¨é“¾/ä»£ç†è°ƒç”¨ä¹‹é—´ä¿æŒçŠ¶æ€çš„æ¦‚å¿µã€‚LangChainæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„å†…å­˜æ¥å£ã€ä¸€ç»„å†…å­˜å®ç°åŠä½¿ç”¨å†…å­˜çš„é“¾/ä»£ç†ç¤ºä¾‹ã€‚</li><li><ahref="https://www.langchain.asia/modules/indexes">ç´¢å¼•ï¼ˆindexesï¼‰</a> :ä¸æ‚¨è‡ªå·±çš„æ–‡æœ¬æ•°æ®ç»“åˆä½¿ç”¨æ—¶ï¼Œè¯­è¨€æ¨¡å‹å¾€å¾€æ›´åŠ å¼ºå¤§â€”â€”æ­¤æ¨¡å—æ¶µç›–äº†æ‰§è¡Œæ­¤æ“ä½œçš„æœ€ä½³å®è·µã€‚</li><li><a href="https://www.langchain.asia/modules/chains">é“¾ï¼ˆchainsï¼‰</a>: é“¾ä¸ä»…ä»…æ˜¯å•ä¸ª LLM è°ƒç”¨ï¼Œè¿˜åŒ…æ‹¬ä¸€ç³»åˆ—è°ƒç”¨ï¼ˆæ— è®ºæ˜¯è°ƒç”¨ LLMè¿˜æ˜¯ä¸åŒçš„ä½¿ç”¨å·¥å…·ï¼‰ã€‚LangChainæä¾›äº†ä¸€ç§æ ‡å‡†çš„é“¾æ¥å£ã€è®¸å¤šä¸å…¶å®ƒå·¥å…·çš„é›†æˆã€‚LangChainæä¾›äº†ç”¨äºå¸¸è§åº”ç”¨ç¨‹åºçš„ç«¯åˆ°ç«¯çš„é“¾è°ƒç”¨ã€‚</li><li><ahref="https://www.langchain.asia/modules/agents">ä»£ç†ï¼ˆagentsï¼‰</a> :ä»£ç†æ¶‰åŠ LLMåšå‡ºè¡ŒåŠ¨å†³ç­–ã€æ‰§è¡Œè¯¥è¡ŒåŠ¨ã€æŸ¥çœ‹ä¸€ä¸ªè§‚å¯Ÿç»“æœï¼Œå¹¶é‡å¤è¯¥è¿‡ç¨‹ç›´åˆ°å®Œæˆã€‚LangChainæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„ä»£ç†æ¥å£ï¼Œä¸€ç³»åˆ—å¯ä¾›é€‰æ‹©çš„ä»£ç†ï¼Œä»¥åŠç«¯åˆ°ç«¯ä»£ç†çš„ç¤ºä¾‹ã€‚</li></ul><h3 id="langchainå¿«é€Ÿå…¥é—¨">LangChainå¿«é€Ÿå…¥é—¨</h3><p>LangChainæ˜¯ä¸€ä¸ªç”±<a href="https://twitter.com/hwchase17">HarrisonChase</a>å¼€æºçš„é¡¹ç›®ï¼ŒGithubè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://github.com/hwchase17/langchain">https://github.com/hwchase17/langchain</a>.</p><p>LangChainæä¾›äº†å¯¹åº”çš„Pythonç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œåœ¨å®‰è£…å‰ï¼Œéœ€ç¡®ä¿ä½ çš„Pythonç‰ˆæœ¬å¤§äºç­‰äº3.8.1ï¼Œå°äº4.0ï¼Œå®‰è£…æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install langchain<br></code></pre></td></tr></table></figure><p>æœ¬æ–‡ä½¿ç”¨çš„langchainçš„ç‰ˆæœ¬ä¸º0.0.201ã€‚åœ¨å¼€å§‹ä»‹ç»LangChainçš„ä½¿ç”¨å‰ï¼Œä½ è¿˜éœ€è¦æœ‰ç›¸å…³å¤§æ¨¡å‹çš„APIkeyï¼Œæ¯”å¦‚OpenAI keyç­‰ã€‚</p><h4 id="æ¨¡å‹æ”¯æŒ">æ¨¡å‹æ”¯æŒ</h4><p>LangChainæä¾›äº†ä¸€ç³»åˆ—å¤§æ¨¡å‹çš„æ”¯æŒï¼Œä½†é¦–å…ˆä½ éœ€è¦è¿™äº›å¤§æ¨¡å‹çš„APIkeyã€‚LangChainæ”¯æŒçš„å¤§æ¨¡å‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/nlp56_1.png" /></p><ul><li>Proprietarymodelsï¼ˆç§æœ‰æ¨¡å‹ï¼‰ï¼šç”±æ‹¥æœ‰å¤§å‹ä¸“ä¸šå›¢é˜Ÿå’Œå¤§é¢AIé¢„ç®—çš„å…¬å¸ç ”å‘çš„é—­æºæ¨¡å‹ï¼Œå®ƒä»¬é€šå¸¸ä¼šæ¯”å¼€æºæ¨¡å‹æ›´å¤§ï¼Œä¸”è¡¨ç°æ›´å¥½ï¼Œä½†APIè°ƒç”¨è¾ƒä¸ºæ˜‚è´µã€‚ç§æœ‰æ¨¡å‹çš„æä¾›å•†æœ‰OpenAI,co:here, AI21 Labs, Anthropicç­‰ã€‚</li><li>Open-sourceLLMSï¼ˆå¼€æºæ¨¡å‹ï¼‰ï¼šæ¯”ç§æœ‰æ¨¡å‹å°ºå¯¸æ›´å°ï¼Œèƒ½åŠ›è¾ƒå·®ï¼Œä½†å®ƒä»¬æ¯”ç§æœ‰æ¨¡å‹æ›´èŠ‚çœèŠ±è´¹ã€‚å¼€æºæ¨¡å‹çš„ä»£è¡¨æœ‰BLOOM,LLaMA, Flan-T5, GPT-Jç­‰ã€‚è®¸å¤šå¼€æºæ¨¡å‹å·²ç”±HuggingFaceæä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚</li><li>Model Hubï¼ˆæ¨¡å‹ä»“åº“ï¼‰ï¼šæ¨¡å‹å‚¨å­˜çš„ä»“åº“ï¼Œæ¯”å¦‚Hugging Faceç­‰ã€‚</li></ul><p>ä¸‹é¢ä¸ºlangchainåŠ è½½ä¸åŒæ¨¡å‹çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Proprietary LLM from e.g. OpenAI</span><br><span class="hljs-comment"># pip install openai</span><br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br>llm = OpenAI(model_name=<span class="hljs-string">&quot;text-davinci-003&quot;</span>)<br><br><span class="hljs-comment"># Alternatively, open-source LLM hosted on Hugging Face</span><br><span class="hljs-comment"># pip install huggingface_hub</span><br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> HuggingFaceHub<br>llm = HuggingFaceHub(repo_id=<span class="hljs-string">&quot;google/flan-t5-xl&quot;</span>)<br></code></pre></td></tr></table></figure><p>æœ¬æ–‡ä¸»è¦åŸºäºOpenAIè¿›è¡Œæ¼”ç¤ºï¼Œå› æ­¤ï¼Œå¦‚æœä½ æœ‰OpenAIkeyï¼Œä½ å°†ä¼šæœ‰æ›´å¥½çš„ä½¿ç”¨langchainçš„ä½“éªŒã€‚</p><h4 id="promptç®¡ç†">Promptç®¡ç†</h4><p>å¤§æ¨¡å‹çš„è¡¨ç°å–å†³äºPromptï¼ˆæç¤ºï¼‰ï¼Œä¸€ä¸ªå¥½çš„Promptå¯ä»¥ä½¿å¤§æ¨¡å‹çš„è¡¨ç°è‰¯å¥½ï¼Œåä¹‹ï¼Œå¤§æ¨¡å‹çš„è¡¨ç°å¯èƒ½ä¼šä¸å¦‚äººæ„ã€‚</p><p>langchainæä¾›äº†<code>PromptTemplates</code>,å¸®åŠ©ä½ æ›´å¥½åœ°ä¸ºä¸åŒçš„åˆ†æ”¯åˆ›å»ºåˆç†çš„Promptã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Promptï¼ˆé›¶æ ·æœ¬é—®é¢˜Promptæ¨¡æ¿ï¼‰ï¼ŒPythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> PromptTemplate<br><br>template = <span class="hljs-string">&quot;What is a good name for a company that makes &#123;product&#125;?&quot;</span><br><br>prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;product&quot;</span>],<br>    template=template,<br>)<br><br><span class="hljs-built_in">print</span>(prompt.<span class="hljs-built_in">format</span>(product=<span class="hljs-string">&quot;colorful socks&quot;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">What is a good name <span class="hljs-keyword">for</span> a company that makes colorful socks?<br></code></pre></td></tr></table></figure><p>åŒæ ·åœ°ï¼Œlangchainè¿˜æä¾›äº†few-shotï¼ˆå°‘æ ·æœ¬ï¼‰æ–‡æœ¬çš„Promptæ¨¡æ¿ï¼ŒPythonç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> PromptTemplate, FewShotPromptTemplate<br><br>examples = [<br>    &#123;<span class="hljs-string">&quot;word&quot;</span>: <span class="hljs-string">&quot;happy&quot;</span>, <span class="hljs-string">&quot;antonym&quot;</span>: <span class="hljs-string">&quot;sad&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;word&quot;</span>: <span class="hljs-string">&quot;tall&quot;</span>, <span class="hljs-string">&quot;antonym&quot;</span>: <span class="hljs-string">&quot;short&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;word&quot;</span>: <span class="hljs-string">&quot;fat&quot;</span>, <span class="hljs-string">&quot;antonym&quot;</span>: <span class="hljs-string">&quot;thin&quot;</span>&#125;,<br>]<br><br>example_template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">-&gt; Word: &#123;word&#125;</span><br><span class="hljs-string">-&gt; Antonym: &#123;antonym&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>example_prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;word&quot;</span>, <span class="hljs-string">&quot;antonym&quot;</span>],<br>    template=example_template,<br>)<br><br>few_shot_prompt = FewShotPromptTemplate(<br>    examples=examples,<br>    example_prompt=example_prompt,<br>    prefix=<span class="hljs-string">&quot;Give the antonym of every input&quot;</span>,<br>    suffix=<span class="hljs-string">&quot;\n-&gt;Word: &#123;input&#125;\n-&gt;Antonym:&quot;</span>,<br>    input_variables=[<span class="hljs-string">&quot;input&quot;</span>],<br>    example_separator=<span class="hljs-string">&quot;\n&quot;</span>,<br>)<br><br><span class="hljs-built_in">print</span>(few_shot_prompt.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">input</span>=<span class="hljs-string">&quot;big&quot;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Give the antonym of every input<br><br>-&gt; Word: happy<br>-&gt; Antonym: sad<br><br><br>-&gt; Word: tall<br>-&gt; Antonym: short<br><br><br>-&gt; Word: fat<br>-&gt; Antonym: thin<br><br><br>-&gt;Word: big<br>-&gt;Antonym:<br></code></pre></td></tr></table></figure><h4 id="é“¾chains">é“¾ï¼ˆChainsï¼‰</h4><p>langchainä¸­çš„é“¾æè¿°äº†å°†å¤§æ¨¡å‹ä¸å…¶å®ƒåˆ†æ”¯ç»„åˆèµ·æ¥åˆ›å»ºä¸€ä¸ªåº”ç”¨çš„è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼ŒLLMChainå…è®¸æˆ‘ä»¬å¯¹åˆ›å»ºçš„Promptä½¿ç”¨å¤§æ¨¡å‹ï¼ŒPythonç¤ºä¾‹ä»£ç ï¼ˆéœ€å®‰è£…openaiæ¨¡å—ï¼Œä½¿ç”¨<code>pip install openai</code>ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> LLMChain<br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> PromptTemplate<br><br><span class="hljs-comment"># set api key</span><br><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;sk-xxx&#x27;</span><br><br><span class="hljs-comment"># install openai and choose model</span><br>llm = OpenAI(model_name=<span class="hljs-string">&#x27;gpt-3.5-turbo&#x27;</span>)<br><br><span class="hljs-comment"># make prompt</span><br>template = <span class="hljs-string">&quot;What is a good name for a company that makes &#123;product&#125;?&quot;</span><br><br>prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;product&quot;</span>],<br>    template=template,<br>)<br><br><span class="hljs-comment"># chain</span><br>chain = LLMChain(llm=llm, prompt=prompt)<br><br><span class="hljs-comment"># Run the chain only specifying the input variable.</span><br><span class="hljs-built_in">print</span>(chain.run(<span class="hljs-string">&quot;colorful socks&quot;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Rainbow Socks Co.<br></code></pre></td></tr></table></figure><p>å¯¹å°‘æ ·æœ¬æç¤ºï¼ŒPythonç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> LLMChain<br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> PromptTemplate, FewShotPromptTemplate<br><br><span class="hljs-comment"># set api key</span><br><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;sk-xxx&#x27;</span><br><br><span class="hljs-comment"># install openai and choose model</span><br>llm = OpenAI(model_name=<span class="hljs-string">&#x27;gpt-3.5-turbo&#x27;</span>)<br><br><span class="hljs-comment"># make few-shot prompt</span><br>examples = [<br>    &#123;<span class="hljs-string">&quot;word&quot;</span>: <span class="hljs-string">&quot;happy&quot;</span>, <span class="hljs-string">&quot;antonym&quot;</span>: <span class="hljs-string">&quot;sad&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;word&quot;</span>: <span class="hljs-string">&quot;tall&quot;</span>, <span class="hljs-string">&quot;antonym&quot;</span>: <span class="hljs-string">&quot;short&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;word&quot;</span>: <span class="hljs-string">&quot;fat&quot;</span>, <span class="hljs-string">&quot;antonym&quot;</span>: <span class="hljs-string">&quot;thin&quot;</span>&#125;,<br>]<br><br>example_template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">-&gt; Word: &#123;word&#125;</span><br><span class="hljs-string">-&gt; Antonym: &#123;antonym&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>example_prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;word&quot;</span>, <span class="hljs-string">&quot;antonym&quot;</span>],<br>    template=example_template,<br>)<br><br>few_shot_prompt = FewShotPromptTemplate(<br>    examples=examples,<br>    example_prompt=example_prompt,<br>    prefix=<span class="hljs-string">&quot;Give the antonym of every input&quot;</span>,<br>    suffix=<span class="hljs-string">&quot;\n-&gt;Word: &#123;input&#125;\n-&gt;Antonym:&quot;</span>,<br>    input_variables=[<span class="hljs-string">&quot;input&quot;</span>],<br>    example_separator=<span class="hljs-string">&quot;\n&quot;</span>,<br>)<br><br><span class="hljs-comment"># chain</span><br>chain = LLMChain(llm=llm, prompt=few_shot_prompt)<br><br><span class="hljs-comment"># Run the chain only specifying the input variable.</span><br><span class="hljs-built_in">print</span>(chain.run(<span class="hljs-string">&quot;big&quot;</span>))<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">small<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ä¹‹å‰çš„LLMçš„è¾“å‡ºä½œä¸ºå½“å‰LLMçš„è¾“å…¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>SimpleSequentialChain</code>ï¼Œç¤ºä¾‹Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> PromptTemplate<br><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> LLMChain, SimpleSequentialChain<br><br><span class="hljs-comment"># set api key</span><br><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;sk-xxx&#x27;</span><br><br><span class="hljs-comment"># install openai and choose model</span><br>llm = OpenAI(model_name=<span class="hljs-string">&#x27;gpt-3.5-turbo&#x27;</span>)<br><br><span class="hljs-comment"># Define the first chain as in the previous code example</span><br>template = <span class="hljs-string">&quot;What is a good name for a company that makes &#123;product&#125;?&quot;</span><br><br>prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;product&quot;</span>],<br>    template=template,<br>)<br><br>chain = LLMChain(llm=llm, prompt=prompt)<br><br><span class="hljs-comment"># Create a second chain with a prompt template and an LLM</span><br>second_prompt = PromptTemplate(<br>    input_variables=[<span class="hljs-string">&quot;company_name&quot;</span>],<br>    template=<span class="hljs-string">&quot;Write a catchphrase for the following company: &#123;company_name&#125;&quot;</span>,<br>)<br><br>chain_two = LLMChain(llm=llm, prompt=second_prompt)<br><br><span class="hljs-comment"># Combine the first and the second chain</span><br>overall_chain = SimpleSequentialChain(chains=[chain, chain_two], verbose=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># Run the chain specifying only the input variable for the first chain.</span><br>catchphrase = overall_chain.run(<span class="hljs-string">&quot;colorful socks&quot;</span>)<br><span class="hljs-built_in">print</span>(catchphrase)<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; Entering new  chain...<br>Rainbow Sox Co.<br><span class="hljs-string">&quot;Step up your sock game with Rainbow Sox Co.&quot;</span><br><br>&gt; Finished chain.<br><span class="hljs-string">&quot;Step up your sock game with Rainbow Sox Co.&quot;</span><br></code></pre></td></tr></table></figure><h3 id="langchainé«˜é˜¶ä½¿ç”¨">LangChainé«˜é˜¶ä½¿ç”¨</h3><p>langchainè¿˜æ”¯æŒæ›´å¤šæœ‰è¶£çš„é«˜é˜¶ä½¿ç”¨ï¼ˆé€šè¿‡æ’ä»¶å®ç°ï¼‰ï¼Œæ¯”å¦‚æ–‡æ¡£é—®ç­”ï¼Œå¤©æ°”æŸ¥è¯¢ï¼Œæ•°å­¦è®¡ç®—ï¼ŒåŸºäºWikaPediaçš„é—®ç­”ç­‰ç­‰ï¼Œè¯¦ç»†çš„åº”ç”¨ä»‹ç»çš„è®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://python.langchain.com/docs/modules/agents/tools">https://python.langchain.com/docs/modules/agents/tools</a>ã€‚æœ¬æ–‡å°†ä»‹ç»æ–‡æ¡£é—®ç­”ï¼Œå¤©æ°”æŸ¥è¯¢ï¼Œæ•°å­¦è®¡ç®—è¿™ä¸‰ä¸ªæ’ä»¶åº”ç”¨ã€‚</p><h4 id="æ–‡æ¡£é—®ç­”">æ–‡æ¡£é—®ç­”</h4><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒChatGPTçš„çŸ¥è¯†åº“æˆªè‡³2021å¹´9æœˆï¼Œå› æ­¤ï¼ŒChatGPTæ— æ³•å›ç­”è¿™ä»¥åçš„é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬è¯¢é—®ChatGPTâ€œ2022å¹´çš„è¯ºè´å°”æ–‡å­¦å¥–è·å¾—è€…æ˜¯è°ï¼Ÿâ€ï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/nlp56_2.png" /></p><p>langchainçš„æ–‡æ¡£é˜…è¯»å…è®¸æˆ‘ä»¬å°†å¤§æ¨¡å‹ä¸å¤–éƒ¨æ–‡æ¡£ç»“åˆèµ·æ¥ï¼Œå¯¹æ–‡æ¡£å†…å®¹è¿›è¡Œå›ç­”ã€‚æˆ‘ä»¬åœ¨ç½‘ä¸Šå¯»æ‰¾æœ‰å…³äº2022å¹´çš„è¯ºè´å°”æ–‡å­¦å¥–è·å¾—è€…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç½‘å€ï¼š<ahref="https://www.theguardian.com/books/2022/oct/06/annie-ernaux-wins-the-2022-nobel-prize-in-literature">https://www.theguardian.com/books/2022/oct/06/annie-ernaux-wins-the-2022-nobel-prize-in-literature</a>, ä¿å­˜ä¸ºAnnie Ernaux.txtï¼Œä½œä¸ºChatGPTçš„å¤–éƒ¨è¾“å…¥æ–‡æ¡£ã€‚</p><p>langchainä½¿ç”¨æ–‡æ¡£åŠ è½½å™¨å°†æ•°æ®åŠ è½½ä¸ºDocument.ä¸€ä¸ªDocumentæ˜¯ä¸€ç³»åˆ—æ–‡æœ¬ç‰‡æ®µå’Œç›¸å…³çš„å…ƒæ•°æ®ã€‚åŠ è½½æ–‡ä»¶åæœ‰ä¸‰ä¸ªä¸»è¦æ­¥éª¤:</p><ol type="1"><li>å°†æ–‡æ¡£åˆ†å‰²æˆå—</li><li>ä¸ºæ¯ä¸ªæ–‡æ¡£åˆ›å»ºåµŒå…¥å‘é‡</li><li>åœ¨å‘é‡åº“ä¸­å­˜å‚¨æ–‡æ¡£å’ŒåµŒå…¥å‘é‡</li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLangChain ä½¿ç”¨ Chromaä½œä¸ºå‘é‡å­˜å‚¨æ¥ç´¢å¼•å’Œæœç´¢åµŒå…¥ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å…ˆå®‰è£…chromadbï¼Œå‘½ä»¤ä¸ºï¼š`pipinstall chromadb`. </p><p>åŸºäºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¤–éƒ¨æ–‡æ¡£è¿›è¡Œé—®ç­”ï¼ŒPythonç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> langchain.document_loaders <span class="hljs-keyword">import</span> TextLoader<br><span class="hljs-keyword">from</span> langchain.indexes <span class="hljs-keyword">import</span> VectorstoreIndexCreator<br><br><span class="hljs-comment"># set api key</span><br><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;sk-xxx&#x27;</span><br><br><span class="hljs-comment"># install openai and choose model</span><br>llm = OpenAI(model_name=<span class="hljs-string">&#x27;gpt-3.5-turbo&#x27;</span>)<br><br><span class="hljs-comment"># prompt with no answer</span><br>prompt = <span class="hljs-string">&quot;Who is the winner of 2022 Noble Prize in literature?&quot;</span><br>completion = llm(prompt)<br><span class="hljs-built_in">print</span>(completion)<br><br><span class="hljs-comment"># load other source data</span><br>loader = TextLoader(<span class="hljs-string">&#x27;Annie Ernaux.txt&#x27;</span>)<br>index = VectorstoreIndexCreator().from_loaders([loader])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;index the document.&#x27;</span>)<br><br><span class="hljs-comment"># prompt with answer</span><br>query = <span class="hljs-string">&quot;Who is the winner of 2022 Noble Prize in literature?&quot;</span><br><span class="hljs-built_in">print</span>(index.query_with_sources(query))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">As an AI language model, I <span class="hljs-keyword">do</span> not have the ability to predict future events or outcomes such as the winner of the 2022 Nobel Prize <span class="hljs-keyword">in</span> Literature. Only the Nobel Committee can make such announcements.<br>index the document.<br>&#123;<span class="hljs-string">&#x27;question&#x27;</span>: <span class="hljs-string">&#x27;Who is the winner of 2022 Noble Prize in literature?&#x27;</span>, <span class="hljs-string">&#x27;answer&#x27;</span>: <span class="hljs-string">&#x27; Annie Ernaux is the winner of the 2022 Nobel Prize in Literature.\n&#x27;</span>, <span class="hljs-string">&#x27;sources&#x27;</span>: <span class="hljs-string">&#x27;Annie Ernaux.txt&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸå§‹çš„ChatGPTå¯¹äºé—®é¢˜â€œWho is the winner of 2022 Noble Prizeinliterature?â€æ— æ³•ç»™å‡ºå‡†ç¡®ç­”æ¡ˆï¼Œè€ŒåŠ å…¥äº†å¤–éƒ¨æ•°æ®åï¼Œå†ä½¿ç”¨æ–‡æ¡£é—®ç­”ï¼Œå¯ä»¥å‡†ç¡®åœ°å›ç­”å‡ºè¯¥é—®é¢˜ã€‚</p><h4 id="å¤©æ°”æŸ¥è¯¢">å¤©æ°”æŸ¥è¯¢</h4><p>ChatGPTæ— æ³•æŸ¥è¯¢å®æ—¶ä¿¡æ¯ï¼Œæ¯”å¦‚å¤©æ°”ã€è‚¡ç¥¨ä¿¡æ¯ç­‰ï¼Œä»¥ä¸‹ä¸ºChatGPTå›ç­”â€œä¸Šæµ·ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿâ€çš„ç¤ºä¾‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/nlp56_3.png" /></p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä»£ç†ï¼ˆAgentsï¼‰å·¥å…·<code>OpenWeatherMap API</code>æ¥è·å–å¤©æ°”ä¿¡æ¯ã€‚OpenWeatherMapå¯ä»¥è·å–å…¨ä¸–ç•Œå„åœ°çš„å¤©æ°”ä¿¡æ¯ï¼Œä½†é¦–å…ˆä½ éœ€è¦åœ¨å®ƒçš„å®˜ç½‘ä¸Šæ³¨å†Œå¹¶è·å–<code>OPENWEATHERMAP_API_KEY</code>ã€‚ä»¥ä¸‹ä¸ºä½¿ç”¨ä»£ç†å·¥å…·<code>OpenWeatherMap API</code>æ¥å›ç­”å¤©æ°”çš„Pythonç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> load_tools, initialize_agent, AgentType<br><span class="hljs-keyword">from</span> langchain.utilities <span class="hljs-keyword">import</span> OpenWeatherMapAPIWrapper<br><span class="hljs-keyword">import</span> os<br><br>os.environ[<span class="hljs-string">&quot;OPENWEATHERMAP_API_KEY&quot;</span>] = <span class="hljs-string">&quot;xxx&quot;</span><br>os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="hljs-string">&quot;sk-xxx&quot;</span><br><br><span class="hljs-comment"># direct get weather info</span><br>weather = OpenWeatherMapAPIWrapper()<br>weather_data = weather.run(<span class="hljs-string">&quot;shanghai&quot;</span>)<br><span class="hljs-built_in">print</span>(weather_data)<br><br><span class="hljs-comment"># use LLM to do NLU</span><br>llm = OpenAI(temperature=<span class="hljs-number">0</span>)<br>tools = load_tools([<span class="hljs-string">&quot;openweathermap-api&quot;</span>], llm)<br><br>agent_chain = initialize_agent(<br>    tools=tools,<br>    llm=llm,<br>    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,<br>    verbose=<span class="hljs-literal">True</span><br>)<br><br><span class="hljs-comment"># get weather info by natural language</span><br><span class="hljs-built_in">print</span>(agent_chain.run(<span class="hljs-string">&quot;ä»Šå¤©ä¸Šæµ·å¤©æ°”å¦‚ä½•ï¼Ÿ&quot;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">In shanghai, the current weather is as follows:<br>Detailed status: light rain<br>Wind speed: 5 m/s, direction: 300Â°<br>Humidity: 77%<br>Temperature: <br>  - Current: 28.6Â°C<br>  - High: 29.92Â°C<br>  - Low: 27.71Â°C<br>  - Feels like: 33.09Â°C<br>Rain: &#123;<span class="hljs-string">&#x27;1h&#x27;</span>: 0.69&#125;<br>Heat index: None<br>Cloud cover: 75%<br><br><br>&gt; Entering new  chain...<br> æˆ‘éœ€è¦æŸ¥è¯¢ä¸Šæµ·çš„å¤©æ°”ä¿¡æ¯ã€‚<br>Action: OpenWeatherMap<br>Action Input: Shanghai,CN<br>Observation: In Shanghai,CN, the current weather is as follows:<br>Detailed status: light rain<br>Wind speed: 5 m/s, direction: 300Â°<br>Humidity: 77%<br>Temperature: <br>  - Current: 28.6Â°C<br>  - High: 29.92Â°C<br>  - Low: 27.71Â°C<br>  - Feels like: 33.09Â°C<br>Rain: &#123;<span class="hljs-string">&#x27;1h&#x27;</span>: 0.65&#125;<br>Heat index: None<br>Cloud cover: 75%<br>Thought: æ ¹æ®ä¸Šæµ·çš„å¤©æ°”ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥å¾—å‡ºç»“è®ºã€‚<br>Final Answer: ä»Šå¤©ä¸Šæµ·æœ‰è½»åº¦é™é›¨ï¼Œé£é€Ÿä¸º5ç±³/ç§’ï¼Œæ¹¿åº¦ä¸º77ï¼…ï¼Œæ¸©åº¦ä¸º28.6Â°Cï¼Œæœ€é«˜æ¸©åº¦ä¸º29.92Â°Cï¼Œæœ€ä½æ¸©åº¦ä¸º27.71Â°Cï¼Œä½“æ„Ÿæ¸©åº¦ä¸º33.09Â°Cï¼Œé™é›¨é‡ä¸º0.65æ¯«ç±³ï¼Œäº‘é‡ä¸º75ï¼…ã€‚<br><br>&gt; Finished chain.<br>ä»Šå¤©ä¸Šæµ·æœ‰è½»åº¦é™é›¨ï¼Œé£é€Ÿä¸º5ç±³/ç§’ï¼Œæ¹¿åº¦ä¸º77ï¼…ï¼Œæ¸©åº¦ä¸º28.6Â°Cï¼Œæœ€é«˜æ¸©åº¦ä¸º29.92Â°Cï¼Œæœ€ä½æ¸©åº¦ä¸º27.71Â°Cï¼Œä½“æ„Ÿæ¸©åº¦ä¸º33.09Â°Cï¼Œé™é›¨é‡ä¸º0.65æ¯«ç±³ï¼Œäº‘é‡ä¸º75ï¼…ã€‚<br></code></pre></td></tr></table></figure><h4 id="æ•°å­¦è®¡ç®—">æ•°å­¦è®¡ç®—</h4><p>langchainæä¾›äº†ä»£ç†å·¥å…·<code>Wolfram Alpha</code>æ¥æ›´å¥½åœ°è¿›è¡Œæ•°å­¦è®¡ç®—ï¼Œé¦–å…ˆä½ éœ€è¦åœ¨WolframAlphaå®˜ç½‘ä¸Šæ³¨å†Œå¹¶è·å–WOLFRAM_ALPHA_APPIDï¼Œç„¶åå®‰è£…wolframalphaæ¨¡å—ï¼Œå‘½ä»¤ä¸ºï¼š<code>pip install wolframalpha</code>.ç¤ºä¾‹Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> ssl<br>ssl._create_default_https_context = ssl._create_unverified_context<br><br>os.environ[<span class="hljs-string">&quot;WOLFRAM_ALPHA_APPID&quot;</span>] = <span class="hljs-string">&quot;xxx&quot;</span><br><br><span class="hljs-keyword">from</span> langchain.utilities.wolfram_alpha <span class="hljs-keyword">import</span> WolframAlphaAPIWrapper<br><br>wolfram = WolframAlphaAPIWrapper()<br><br><span class="hljs-comment"># ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹</span><br><span class="hljs-built_in">print</span>(wolfram.run(<span class="hljs-string">&quot;What is 2x+5 = -3x+7?&quot;</span>))<br><br><span class="hljs-comment"># ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹</span><br><span class="hljs-built_in">print</span>(wolfram.run(<span class="hljs-string">&quot;What is x^2-5x+4=0?&quot;</span>))<br><br><span class="hljs-comment"># å¤šé¡¹å¼å±•å¼€</span><br><span class="hljs-built_in">print</span>(wolfram.run(<span class="hljs-string">&quot;Expand (x+y)^3?&quot;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Assumption: 2 x + 5 = -3 x + 7 <br>Answer: x = 2/5<br>Assumption: x^2 - 5 x + 4 = 0 <br>Answer: x = 1<br>Assumption: <span class="hljs-built_in">expand</span> | (x + y)^3 <br>Answer: x^3 + 3 x^2 y + 3 x y^2 + y^3<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†LangChainï¼Œä»¥åŠLangChainçš„æ¨¡å‹æ”¯æŒã€Promptç®¡ç†ã€é“¾ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šä»‹ç»äº†ä¸‰ä¸ªæœ‰è¶£çš„å·¥å…·ä½¿ç”¨ã€‚</p><p>åç»­ç¬”è€…å°†ä¼šè¿›ä¸€æ­¥ä»‹ç»LangChainçš„ä½¿ç”¨ï¼Œæ¬¢è¿å¤§å®¶çš„å…³æ³¨~</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>Getting Started with LangChain: A Beginnerâ€™s Guide to BuildingLLM-Powered Applications: <ahref="https://towardsdatascience.com/getting-started-with-langchain-a-beginners-guide-to-building-llm-powered-applications-95fc8898732c">https://towardsdatascience.com/getting-started-with-langchain-a-beginners-guide-to-building-llm-powered-applications-95fc8898732c</a></li><li>LangChain Document in Python: <ahref="https://python.langchain.com/docs/get_started/introduction.html">https://python.langchain.com/docs/get_started/introduction.html</a></li><li>LangChain Agents: <ahref="https://python.langchain.com/docs/modules/agents/">https://python.langchain.com/docs/modules/agents/</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>LangChain</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åäº”ï¼‰tiktokençš„ä½¿ç”¨</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%BA%94%EF%BC%89tiktoken%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%BA%94%EF%BC%89tiktoken%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>tiktoken</code>æ˜¯OpenAIäºè¿‘æœŸå¼€æºçš„Pythonç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œè¯¥æ¨¡å—ä¸»è¦å®ç°äº†tokenizerçš„BPEï¼ˆBytepairencodingï¼‰ç®—æ³•ï¼Œå¹¶å¯¹è¿è¡Œæ€§èƒ½åšäº†æå¤§çš„ä¼˜åŒ–ã€‚æœ¬æ–‡å°†ä»‹ç»tiktokenæ¨¡å—çš„ä½¿ç”¨ã€‚</p><h3 id="tiktokenç®€ä»‹">tiktokenç®€ä»‹</h3><p><code>BPE(Byte pair encoding)</code>ç®—æ³•æ˜¯NLPä¸­å¸¸è§çš„tokenizeræ–¹å¼ï¼Œå…³äºå…¶ä»‹ç»å’Œå®ç°åŸç†ï¼Œè¯»è€…å¯å‚è€ƒ<ahref="https://zhuanlan.zhihu.com/p/86965595">æ·±å…¥ç†è§£NLPSubwordç®—æ³•ï¼šBPEã€WordPieceã€ULM</a>ã€‚</p><p><code>tiktoken</code>å·²å¼€æºè‡³Githubï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://github.com/openai/tiktoken">https://github.com/openai/tiktoken</a>ï¼Œtiktokenä¼šæ¯”å…¶å®ƒå¼€æºçš„tokenizeråº“è¿è¡Œå¿«3-6å€ï¼Œä»¥ä¸‹æ˜¯å®ƒä¸huggingfaceçš„tokenizeråº“çš„æ€§èƒ½æ¯”è¾ƒï¼š</p><figure><img src="/img/nlp55_1.png"alt="ä¸åŒçº¿ç¨‹æ•°ä¸‹tiktokenä¸hugging faceçš„æ€§èƒ½æ¯”è¾ƒ" /><figcaption aria-hidden="true">ä¸åŒçº¿ç¨‹æ•°ä¸‹tiktokenä¸huggingfaceçš„æ€§èƒ½æ¯”è¾ƒ</figcaption></figure><p>ä»¥ä¸Šç»“æœæ˜¯ä½¿ç”¨GPT-2tokenizeråœ¨1Gæ–‡æœ¬ä¸Šè¿›è¡Œçš„æ€§èƒ½æµ‹è¯•ï¼Œä½¿ç”¨çš„<code>GPT2TokenizerFast</code>æ¥æºäº<code>tokenizers==0.13.2</code>,<code>transformers==4.24.0</code> , <code>tiktoken==0.2.0</code>ã€‚</p><h3 id="ç®€å•ä½¿ç”¨">ç®€å•ä½¿ç”¨</h3><p><code>tiktoken</code>çš„Encodingsï¼ˆç¼–ç æ–¹å¼ï¼‰ç”¨äºå±•ç¤ºæ–‡æœ¬æ˜¯å¦‚ä½•è¢«è½¬åŒ–ä¸ºtokençš„ã€‚ä¸åŒçš„æ¨¡å‹ä½¿ç”¨ä¸åŒç±»å‹çš„ç¼–ç æ–¹å¼ã€‚<code>tiktoken</code>æ”¯æŒå¦‚ä¸‹ä¸‰ç§OpenAIæ¨¡å‹çš„ç¼–ç æ–¹å¼ï¼š</p><table><thead><tr class="header"><th>ç¼–ç æ–¹å¼</th><th>OpenAIæ¨¡å‹</th></tr></thead><tbody><tr class="odd"><td>cl100k_base</td><td>gpt-4, gpt-3.5-turbo, text-embedding-ada-002</td></tr><tr class="even"><td>p50k_base</td><td>Codexæ¨¡å‹ï¼Œå¦‚ text-davinci-002, text-davinci-003</td></tr><tr class="odd"><td>r50k_base (æˆ–gpt2)</td><td>GPT-3æ¨¡å‹ï¼Œå¦‚davinci</td></tr></tbody></table><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç æ¥è·å–æ¨¡å‹çš„ç¼–ç æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> tiktoken<br><br><span class="hljs-comment"># get encoding name</span><br><span class="hljs-built_in">print</span>(tiktoken.encoding_for_model(<span class="hljs-string">&#x27;gpt-3.5-turbo&#x27;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">&lt;Encoding &#x27;cl100k_base&#x27;&gt;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>p50k_base</code>ä¸<code>r50k_base</code>åŸºæœ¬ç±»ä¼¼ï¼Œåœ¨éä»£ç åº”ç”¨ä¸­ï¼Œå®ƒä»¬é€šå¸¸ä¼šç»™å‡ºç›¸åŒçš„tokenã€‚</p><p><code>cl100k_base</code>ä¸­çš„100kä»£ç è¯¥ç¼–ç æ–¹å¼ä¸­çš„è¯æ±‡è¡¨æ•°é‡å¤§çº¦ä¸º100kï¼Œè¯æ±‡è¡¨æ–‡ä»¶ä¸ºcl100k_base_vocab.jsonï¼Œä¸‹è½½ç½‘å€ä¸ºï¼š<ahref="https://raw.githubusercontent.com/weikang-wang/ChatGPT-Vocabulary/main/cl100k_base_vocab.json">https://raw.githubusercontent.com/weikang-wang/ChatGPT-Vocabulary/main/cl100k_base_vocab.json</a>ï¼Œè¯æ±‡æ•°é‡ä¸º100256ï¼Œå¦‚æ­¤åºå¤§çš„è¯æ±‡æ•°é‡ä½¿å¾—OpenAIæ¨¡å‹åœ¨å¤šç§è¯­è¨€ä¸Šéƒ½æœ‰ä¸ä¿—çš„è¡¨ç°ã€‚</p><h3 id="ç¼–ç ä¸è§£ç ">ç¼–ç ä¸è§£ç </h3><p>ç¼–ç ï¼ˆencodeï¼‰æ˜¯æŒ‡å°†æ–‡æœ¬æ˜ å°„ä¸ºtokençš„æ•°å­—åˆ—è¡¨ï¼Œè§£ç ï¼ˆdecodeï¼‰æ˜¯æŒ‡å°†tokençš„æ•°å­—åˆ—è¡¨è½¬åŒ–ä¸ºæ–‡æœ¬ã€‚å‚çœ‹ä»¥ä¸‹çš„Pythonä»£ç å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> tiktoken<br><br><span class="hljs-comment"># simple test</span><br>enc = tiktoken.get_encoding(<span class="hljs-string">&quot;cl100k_base&quot;</span>)<br><span class="hljs-built_in">print</span>(enc.encode(<span class="hljs-string">&quot;hello world&quot;</span>) == [<span class="hljs-number">15339</span>, <span class="hljs-number">1917</span>])<br><span class="hljs-built_in">print</span>(enc.decode([<span class="hljs-number">15339</span>, <span class="hljs-number">1917</span>]) == <span class="hljs-string">&quot;hello world&quot;</span>)<br><span class="hljs-built_in">print</span>(enc.encode(<span class="hljs-string">&quot;hello &lt;|endoftext|&gt;&quot;</span>, allowed_special=<span class="hljs-string">&quot;all&quot;</span>) == [<span class="hljs-number">15339</span>, <span class="hljs-number">220</span>, <span class="hljs-number">100257</span>])<br><br><span class="hljs-comment"># encode</span><br>tokens = enc.encode(<span class="hljs-string">&quot;tiktoken is great!&quot;</span>)<br><span class="hljs-built_in">print</span>(tokens)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(tokens))<br><br><span class="hljs-comment"># decode</span><br><span class="hljs-built_in">print</span>(enc.decode([<span class="hljs-number">83</span>, <span class="hljs-number">1609</span>, <span class="hljs-number">5963</span>, <span class="hljs-number">374</span>, <span class="hljs-number">2294</span>, <span class="hljs-number">0</span>]))<br><br><span class="hljs-comment"># chinese encode</span><br>tokens = enc.encode(<span class="hljs-string">&quot;å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>)<br><span class="hljs-built_in">print</span>(tokens)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(tokens))<br><br><span class="hljs-comment"># chinese decode</span><br><span class="hljs-built_in">print</span>(enc.decode([<span class="hljs-number">27384</span>, <span class="hljs-number">54872</span>, <span class="hljs-number">25287</span>, <span class="hljs-number">21043</span>, <span class="hljs-number">6271</span>, <span class="hljs-number">222</span>, <span class="hljs-number">82696</span>, <span class="hljs-number">11571</span>]))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-literal">True</span><br><span class="hljs-literal">True</span><br><span class="hljs-literal">True</span><br>[<span class="hljs-number">83</span>, <span class="hljs-number">1609</span>, <span class="hljs-number">5963</span>, <span class="hljs-number">374</span>, <span class="hljs-number">2294</span>, <span class="hljs-number">0</span>]<br><span class="hljs-number">6</span><br><span class="hljs-string">tiktoken</span> <span class="hljs-string">is</span> <span class="hljs-string">great!</span><br>[<span class="hljs-number">27384</span>, <span class="hljs-number">54872</span>, <span class="hljs-number">25287</span>, <span class="hljs-number">21043</span>, <span class="hljs-number">6271</span>, <span class="hljs-number">222</span>, <span class="hljs-number">82696</span>, <span class="hljs-number">11571</span>]<br><span class="hljs-number">8</span><br><span class="hljs-string">å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ</span><br></code></pre></td></tr></table></figure><h3 id="è®¡ç®—tokenæ•°é‡">è®¡ç®—tokenæ•°é‡</h3><p>OpenAIæ¨¡å‹ä¸­tokenæ•°é‡è¾ƒä¸ºå…³é”®ï¼Œæ¯•ç«Ÿï¼ŒOpenAIæ¥å£è°ƒç”¨çš„æ”¶è´¹æ–¹å¼æ˜¯æŒ‰ç…§tokenæ•°é‡æ¥çš„ã€‚å…³äºOpenAIæ¥å£è°ƒç”¨çš„æ”¶è´¹æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒç½‘ç«™ï¼š<ahref="https://openai.com/pricing">https://openai.com/pricing</a>ã€‚</p><p>ä¸‹é¢æ˜¯ç”¨<code>tiktoken</code>æ¥è®¡ç®—tokenæ•°é‡çš„Pythonä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> tiktoken<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">num_tokens_from_string</span>(<span class="hljs-params">string: <span class="hljs-built_in">str</span>, encoding_name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-comment"># Returns the number of tokens in a text string.</span><br>    encoding = tiktoken.get_encoding(encoding_name)<br>    num_tokens = <span class="hljs-built_in">len</span>(encoding.encode(string))<br>    <span class="hljs-keyword">return</span> num_tokens<br><br><br><span class="hljs-built_in">print</span>(num_tokens_from_string(<span class="hljs-string">&#x27;tiktoken is great!&#x27;</span>, <span class="hljs-string">&#x27;cl100k_base&#x27;</span>))<br><span class="hljs-built_in">print</span>(num_tokens_from_string(<span class="hljs-string">&#x27;å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ&#x27;</span>, <span class="hljs-string">&#x27;cl100k_base&#x27;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">6<br>8<br></code></pre></td></tr></table></figure><p>åœ¨huggingfaceç½‘ç«™ä¸Šï¼Œå·²ç»æœ‰äººå®ç°äº†tiktokençš„tokenæ•°é‡è®¡ç®—ï¼Œè®¿é—®ç½‘ç«™ä¸ºï¼š<ahref="https://huggingface.co/spaces/JacobLinCool/tiktoken-calculator">https://huggingface.co/spaces/JacobLinCool/tiktoken-calculator</a>ï¼Œé¡µé¢å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp55_2.png" alt="tiktokençš„tokenæ•°é‡è®¡ç®—" /><figcaption aria-hidden="true">tiktokençš„tokenæ•°é‡è®¡ç®—</figcaption></figure><p>åœ¨å¯¹è¯è¡¥å…¨ï¼ˆchatcompletionï¼‰åœºæ™¯ä¸­è®¡ç®—tokenæ•°é‡ï¼Œä»¥æ¨¡å‹<code>gpt-3.5-turbo</code>ä¸ºä¾‹ï¼Œå®ç°Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> tiktoken<br><span class="hljs-keyword">import</span> openai<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">num_tokens_from_messages</span>(<span class="hljs-params">messages</span>):<br>    <span class="hljs-comment"># Returns the number of tokens used by a list of messages.</span><br>    encoding = tiktoken.encoding_for_model(<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>)<br>    tokens_per_message = <span class="hljs-number">4</span>  <span class="hljs-comment"># every message follows &lt;|start|&gt;&#123;role/name&#125;\n&#123;content&#125;&lt;|end|&gt;\n</span><br>    tokens_per_name = -<span class="hljs-number">1</span>  <span class="hljs-comment"># if there&#x27;s a name, the role is omitted</span><br>    num_tokens = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> messages:<br>        num_tokens += tokens_per_message<br>        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> message.items():<br>            num_tokens += <span class="hljs-built_in">len</span>(encoding.encode(value))<br>            <span class="hljs-keyword">if</span> key == <span class="hljs-string">&quot;name&quot;</span>:<br>                num_tokens += tokens_per_name<br>    num_tokens += <span class="hljs-number">3</span>  <span class="hljs-comment"># every reply is primed with &lt;|start|&gt;assistant&lt;|message|&gt;</span><br>    <span class="hljs-keyword">return</span> num_tokens<br><br>example_messages = [<br>    &#123;<br>        <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>,<br>        <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;You are a helpful, pattern-following assistant that translates corporate jargon into plain English.&quot;</span>,<br>    &#125;,<br>    &#123;<br>        <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>,<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;example_user&quot;</span>,<br>        <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;New synergies will help drive top-line growth.&quot;</span>,<br>    &#125;,<br>    &#123;<br>        <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>,<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;example_assistant&quot;</span>,<br>        <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Things working well together will increase revenue.&quot;</span>,<br>    &#125;,<br>    &#123;<br>        <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>,<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;example_user&quot;</span>,<br>        <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Let&#x27;s circle back when we have more bandwidth to touch base on opportunities for increased leverage.&quot;</span>,<br>    &#125;,<br>    &#123;<br>        <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>,<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;example_assistant&quot;</span>,<br>        <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Let&#x27;s talk later when we&#x27;re less busy about how to do better.&quot;</span>,<br>    &#125;,<br>    &#123;<br>        <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>        <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;This late pivot means we don&#x27;t have time to boil the ocean for the client deliverable.&quot;</span>,<br>    &#125;,<br>]<br><br><br><span class="hljs-comment"># example token count from the function defined above</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;num_tokens_from_messages(example_messages)&#125;</span> prompt tokens counted by num_tokens_from_messages().&quot;</span>)<br><span class="hljs-comment"># example token count from the OpenAI API</span><br>openai.api_key = <span class="hljs-string">&quot;&quot;</span><br>response = openai.ChatCompletion.create(<br>    model=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>,<br>    messages=example_messages,<br>    temperature=<span class="hljs-number">0</span>,<br>    max_tokens=<span class="hljs-number">1</span><br>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;response[<span class="hljs-string">&quot;usage&quot;</span>][<span class="hljs-string">&quot;prompt_tokens&quot;</span>]&#125;</span> prompt tokens counted by the OpenAI API.&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">127 </span>prompt tokens counted by num_tokens_from_messages().<br><span class="hljs-symbol">127 </span>prompt tokens counted by the OpenAI API.<br></code></pre></td></tr></table></figure><p>å¯è§ï¼Œåœ¨<code>num_tokens_from_messages</code>ä¸­ï¼Œå¯¹äºè¾“å…¥messagesä¸­çš„æ¯æ¡messageï¼Œtokenæ•°é‡å…ˆåŠ ä¸Š4ï¼Œç„¶åå¯¹å­—å…¸ä¸­çš„valueå€¼è¿›è¡Œtokenæ•°é‡ç»Ÿè®¡ï¼Œå¦‚æœæ­¤æ—¶å¯¹åº”çš„keyä¸ºnameï¼Œåˆ™tokenæ•°é‡å‡1ï¼Œå› ä¸ºè¦å¿½ç•¥roleå­—æ®µçš„tokenæ•°é‡ã€‚åœ¨æ¨¡å‹<code>gpt-3.5-turbo</code>ä¸­ï¼Œ<code>num_tokens_from_messages</code>å‡½æ•°ä¸OpenAIå¯¹è¯è¡¥å…¨ä¸­çš„tokenæ•°é‡è®¡ç®—æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†<code>tiktoken</code>æ¨¡å‹å’Œå®ƒçš„ç®€å•ä½¿ç”¨ï¼Œä»¥åŠtokenæ•°é‡è®¡ç®—æ–¹å¼ã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>æ·±å…¥ç†è§£NLP Subwordç®—æ³•ï¼šBPEã€WordPieceã€ULM: <ahref="https://zhuanlan.zhihu.com/p/86965595">https://zhuanlan.zhihu.com/p/86965595</a></li><li>tiktokençš„Githubç½‘å€ï¼š<ahref="https://github.com/openai/tiktoken">https://github.com/openai/tiktoken</a></li><li>tiktoken-calculator: <ahref="https://huggingface.co/spaces/JacobLinCool/tiktoken-calculator">https://huggingface.co/spaces/JacobLinCool/tiktoken-calculator</a></li><li>How_to_count_tokens_with_tiktoken.ipynb: <ahref="https://github.com/openai/openai-cookbook/blob/main/examples/How_to_count_tokens_with_tiktoken.ipynb">https://github.com/openai/openai-cookbook/blob/main/examples/How_to_count_tokens_with_tiktoken.ipynb</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>tiktoken</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åå››ï¼‰åœ¨Kerasä¸­ä½¿ç”¨è‹±æ–‡Robertaæ¨¡å‹å®ç°æ–‡æœ¬åˆ†ç±»</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E5%9B%9B%EF%BC%89%E5%9C%A8Keras%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%8B%B1%E6%96%87Roberta%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E5%9B%9B%EF%BC%89%E5%9C%A8Keras%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%8B%B1%E6%96%87Roberta%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è‹±æ–‡Robertaæ¨¡å‹æ˜¯2019å¹´Facebookåœ¨è®ºæ–‡<ahref="https://arxiv.org/pdf/1907.11692.pdf">RoBERTa: A RobustlyOptimized BERT PretrainingApproach</a>ä¸­æ–°æå‡ºçš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå…¶ç›®çš„æ˜¯æ”¹è¿›BERTæ¨¡å‹å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œå½“æ—¶ä¹Ÿåˆ·æ–°äº†ä¸€ä¼—NLPä»»åŠ¡çš„æ¦œå•ï¼Œè¾¾åˆ°SOTAæ•ˆæœï¼Œå…¶æ¨¡å‹å’Œä»£ç å·²å¼€æºï¼Œæ”¾åœ¨Githubä¸­çš„<code>fairseq</code>é¡¹ç›®ä¸­ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œè‹±æ–‡Robertaæ¨¡å‹ä½¿ç”¨Torchæ¡†æ¶è®­ç»ƒçš„ï¼Œå› æ­¤ï¼Œå…¶torchç‰ˆæœ¬æ¨¡å‹æœ€ä¸ºå¸¸è§ã€‚</p><p>å½“ç„¶ï¼Œtorchæ¨¡å‹ä¹Ÿæ˜¯å¯ä»¥è½¬åŒ–ä¸ºtensorflowæ¨¡å‹çš„ã€‚æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•å°†åŸå§‹torchç‰ˆæœ¬çš„è‹±æ–‡Robertaæ¨¡å‹è½¬åŒ–ä¸ºtensorflowç‰ˆæœ¬æ¨¡å‹ï¼Œå¹¶ä¸”Kerasä¸­ä½¿ç”¨tensorflowç‰ˆæœ¬æ¨¡å‹å®ç°è‹±è¯­æ–‡æœ¬åˆ†ç±»ã€‚</p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="/img/nlp54_1.png" alt="é¡¹ç›®ç»“æ„å›¾" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„å›¾</figcaption></figure><h3 id="æ¨¡å‹è½¬åŒ–">æ¨¡å‹è½¬åŒ–</h3><p>æœ¬é¡¹ç›®é¦–å…ˆä¼šå°†åŸå§‹torchç‰ˆæœ¬çš„è‹±æ–‡Robertaæ¨¡å‹è½¬åŒ–ä¸ºtensorflowç‰ˆæœ¬æ¨¡å‹ï¼Œè¯¥éƒ¨åˆ†ä»£ç ä¸»è¦å‚è€ƒGithubé¡¹ç›®<ahref="https://github.com/midori1/keras_roberta">keras_roberta</a>ã€‚</p><p>é¦–å…ˆéœ€ä¸‹è½½Facebookå‘å¸ƒåœ¨<code>fairseq</code>é¡¹ç›®ä¸­çš„robertabaseæ¨¡å‹ï¼Œå…¶è®¿é—®ç½‘å€ä¸º: <ahref="https://github.com/pytorch/fairseq/blob/main/examples/roberta/README.md">https://github.com/pytorch/fairseq/blob/main/examples/roberta/README.md</a>ã€‚</p><figure><img src="/img/nlp54_2.png" alt="Robertaæ¨¡å‹" /><figcaption aria-hidden="true">Robertaæ¨¡å‹</figcaption></figure><p>è¿è¡Œ<code>convert_roberta_to_tf.py</code>è„šæœ¬ï¼Œå°†torchæ¨¡å‹è½¬åŒ–ä¸ºtensorflowæ¨¡å‹ã€‚å…·ä½“ä»£ç ä¸åœ¨æ­¤ç»™å‡ºï¼Œå¯ä»¥å‚è€ƒæ–‡ç« åç»­ç»™å‡ºçš„Githubé¡¹ç›®åœ°å€ã€‚</p><p>åœ¨æ¨¡å‹çš„tokenizeræ–¹é¢ï¼Œå°†RobertaTokenizeræ”¹ä¸ºGPT2Tokenizerï¼Œå› ä¸ºRobertaTokenizeræ˜¯ç»§æ‰¿è‡ªGPT2Tokenizerçš„ï¼Œä¸¤è€…ç›¸ä¼¼æ€§å¾ˆé«˜ã€‚æµ‹è¯•åŸå§‹torchæ¨¡å‹å’Œtensorflowæ¨¡å‹çš„è¡¨ç°ï¼Œä»£ç å¦‚ä¸‹ï¼ˆtf_roberta_demo.pyï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> keras_roberta.roberta <span class="hljs-keyword">import</span> build_bert_model<br><span class="hljs-keyword">from</span> keras_roberta.tokenizer <span class="hljs-keyword">import</span> RobertaTokenizer<br><span class="hljs-keyword">from</span> fairseq.models.roberta <span class="hljs-keyword">import</span> RobertaModel <span class="hljs-keyword">as</span> FairseqRobertaModel<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> argparse<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    roberta_path = <span class="hljs-string">&#x27;roberta-base&#x27;</span><br>    tf_roberta_path = <span class="hljs-string">&#x27;tf_roberta_base&#x27;</span><br>    tf_ckpt_name = <span class="hljs-string">&#x27;tf_roberta_base.ckpt&#x27;</span><br>    vocab_path = <span class="hljs-string">&#x27;keras_roberta&#x27;</span><br><br>    config_path = os.path.join(tf_roberta_path, <span class="hljs-string">&#x27;bert_config.json&#x27;</span>)<br>    checkpoint_path = os.path.join(tf_roberta_path, tf_ckpt_name)<br>    <span class="hljs-keyword">if</span> os.path.splitext(checkpoint_path)[-<span class="hljs-number">1</span>] != <span class="hljs-string">&#x27;.ckpt&#x27;</span>:<br>        checkpoint_path += <span class="hljs-string">&#x27;.ckpt&#x27;</span><br><br>    gpt_bpe_vocab = os.path.join(vocab_path, <span class="hljs-string">&#x27;encoder.json&#x27;</span>)<br>    gpt_bpe_merge = os.path.join(vocab_path, <span class="hljs-string">&#x27;vocab.bpe&#x27;</span>)<br>    roberta_dict = os.path.join(roberta_path, <span class="hljs-string">&#x27;dict.txt&#x27;</span>)<br><br>    tokenizer = RobertaTokenizer(gpt_bpe_vocab, gpt_bpe_merge, roberta_dict)<br>    model = build_bert_model(config_path, checkpoint_path, roberta=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># å»ºç«‹æ¨¡å‹ï¼ŒåŠ è½½æƒé‡</span><br><br>    <span class="hljs-comment"># ç¼–ç æµ‹è¯•</span><br>    text1 = <span class="hljs-string">&quot;hello, world!&quot;</span><br>    text2 = <span class="hljs-string">&quot;This is Roberta!&quot;</span><br>    sep = [tokenizer.sep_token]<br>    cls = [tokenizer.cls_token]<br>    <span class="hljs-comment"># 1. å…ˆç”¨&#x27;bpe_tokenize&#x27;å°†æ–‡æœ¬è½¬æ¢æˆbpe tokens</span><br>    tokens1 = cls + tokenizer.bpe_tokenize(text1) + sep<br>    tokens2 = sep + tokenizer.bpe_tokenize(text2) + sep<br>    <span class="hljs-comment"># 2. æœ€åè½¬æ¢æˆid</span><br>    token_ids1 = tokenizer.convert_tokens_to_ids(tokens1)<br>    token_ids2 = tokenizer.convert_tokens_to_ids(tokens2)<br>    token_ids = token_ids1 + token_ids2<br>    segment_ids = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(token_ids1) + [<span class="hljs-number">1</span>] * <span class="hljs-built_in">len</span>(token_ids2)<br>    <span class="hljs-built_in">print</span>(token_ids)<br>    <span class="hljs-built_in">print</span>(segment_ids)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n ===== tf model predicting =====\n&#x27;</span>)<br>    our_output = model.predict([np.array([token_ids]), np.array([segment_ids])])<br>    <span class="hljs-built_in">print</span>(our_output)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n ===== torch model predicting =====\n&#x27;</span>)<br>    roberta = FairseqRobertaModel.from_pretrained(roberta_path)<br>    roberta.<span class="hljs-built_in">eval</span>()  <span class="hljs-comment"># disable dropout</span><br><br>    input_ids = roberta.encode(text1, text2).unsqueeze(<span class="hljs-number">0</span>)  <span class="hljs-comment"># batch of size 1</span><br>    <span class="hljs-built_in">print</span>(input_ids)<br>    their_output = roberta.model(input_ids, features_only=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span>(their_output)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs subunit">[0, 42891, 6, 232, 328, 2, 2, 713, 16, 1738, 102, 328, 2]<br>[0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1]<br><br> ===== tf model predicting =====<br>[[[<span class="hljs-string">-0</span>.01123665  0.05132651 <span class="hljs-string">-0</span>.02170264 ... <span class="hljs-string">-0</span>.03562857 <span class="hljs-string">-0</span>.02836962<br>   <span class="hljs-string">-0</span>.00519008]<br>  [ 0.04382067  0.07045364 <span class="hljs-string">-0</span>.00431021 ... <span class="hljs-string">-0</span>.04662359 <span class="hljs-string">-0</span>.10770167<br>    0.1121687 ]<br>  [ 0.06198474  0.05240346  0.11088232 ... <span class="hljs-string">-0</span>.08883709 <span class="hljs-string">-0</span>.02932207<br>   <span class="hljs-string">-0</span>.12898633]<br>  ...<br>  [<span class="hljs-string">-0</span>.00229368  0.045834    0.00811818 ... <span class="hljs-string">-0</span>.11751424 <span class="hljs-string">-0</span>.06718166<br>    0.04085271]<br>  [<span class="hljs-string">-0</span>.08509324 <span class="hljs-string">-0</span>.27506304 <span class="hljs-string">-0</span>.02425355 ... <span class="hljs-string">-0</span>.24215901 <span class="hljs-string">-0</span>.15481825<br>    0.17167582]<br>  [<span class="hljs-string">-0</span>.05180666  0.06384835 <span class="hljs-string">-0</span>.05997407 ... <span class="hljs-string">-0</span>.09398533 <span class="hljs-string">-0</span>.05159672<br>   <span class="hljs-string">-0</span>.03988626]]]<br><br> ===== torch model predicting =====<br>tensor([[    0, 42891,     6,   232,   328,     2,     2,   713,    16,  1738,<br>           102,   328,     2]])<br>tensor([[[<span class="hljs-string">-0</span>.0525,  0.0818, <span class="hljs-string">-0</span>.0170,  ..., <span class="hljs-string">-0</span>.0546, <span class="hljs-string">-0</span>.0569, <span class="hljs-string">-0</span>.0099],<br>         [<span class="hljs-string">-0</span>.0765, <span class="hljs-string">-0</span>.0568, <span class="hljs-string">-0</span>.1400,  ..., <span class="hljs-string">-0</span>.2612, <span class="hljs-string">-0</span>.0455,  0.2975],<br>         [<span class="hljs-string">-0</span>.0142,  0.1184,  0.0530,  ..., <span class="hljs-string">-0</span>.0844,  0.0199,  0.1340],<br>         ...,<br>         [<span class="hljs-string">-0</span>.0019,  0.1263, <span class="hljs-string">-0</span>.0787,  ..., <span class="hljs-string">-0</span>.3986, <span class="hljs-string">-0</span>.0626,  0.1870],<br>         [ 0.0127, <span class="hljs-string">-0</span>.2116,  0.0696,  ..., <span class="hljs-string">-0</span>.1622, <span class="hljs-string">-0</span>.1265,  0.0986],<br>         [<span class="hljs-string">-0</span>.0473,  0.0748, <span class="hljs-string">-0</span>.0419,  ..., <span class="hljs-string">-0</span>.0892, <span class="hljs-string">-0</span>.0595, <span class="hljs-string">-0</span>.0281]]],<br>       grad_fn=&lt;TransposeBackward0&gt;)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤è€…åœ¨tokenizeæ—¶çš„token_idsæ˜¯ä¸€è‡´çš„ã€‚</p><h3 id="è‹±è¯­æ–‡æœ¬åˆ†ç±»">è‹±è¯­æ–‡æœ¬åˆ†ç±»</h3><p>æ¥ç€æˆ‘ä»¬éœ€è¦çœ‹ä¸‹è½¬åŒ–ä¸ºçš„tensorflowç‰ˆæœ¬çš„Robertaæ¨¡å‹åœ¨è‹±è¯­æ–‡æœ¬åˆ†ç±»æ•°æ®é›†ä¸Šçš„æ•ˆæœäº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯GLUEæ•°æ®é›†ä¸­çš„<code>SST-2</code>ã€‚<code>SST-2</code>(TheStanford SentimentTreebankï¼Œæ–¯å¦ç¦æƒ…æ„Ÿæ ‘åº“)ï¼Œå•å¥å­åˆ†ç±»ä»»åŠ¡ï¼ŒåŒ…å«ç”µå½±è¯„è®ºä¸­çš„å¥å­å’Œå®ƒä»¬æƒ…æ„Ÿçš„äººç±»æ³¨é‡Šã€‚è¿™é¡¹ä»»åŠ¡æ˜¯ç»™å®šå¥å­çš„æƒ…æ„Ÿï¼Œç±»åˆ«åˆ†ä¸ºä¸¤ç±»æ­£é¢æƒ…æ„Ÿï¼ˆpositiveï¼Œæ ·æœ¬æ ‡ç­¾å¯¹åº”ä¸º1ï¼‰å’Œè´Ÿé¢æƒ…æ„Ÿï¼ˆnegativeï¼Œæ ·æœ¬æ ‡ç­¾å¯¹åº”ä¸º0ï¼‰ï¼Œå¹¶ä¸”åªç”¨å¥å­çº§åˆ«çš„æ ‡ç­¾ã€‚ä¹Ÿå°±æ˜¯ï¼Œæœ¬ä»»åŠ¡ä¹Ÿæ˜¯ä¸€ä¸ªäºŒåˆ†ç±»ä»»åŠ¡ï¼Œé’ˆå¯¹å¥å­çº§åˆ«ï¼Œåˆ†ä¸ºæ­£é¢å’Œè´Ÿé¢æƒ…æ„Ÿã€‚å…³äºè¯¥æ•°æ®é›†çš„å…·ä½“ä»‹ç»å¯å‚è€ƒç½‘å€ï¼š<ahref="https://nlp.stanford.edu/sentiment/index.html">https://nlp.stanford.edu/sentiment/index.html</a>ã€‚</p><p><code>SST-2</code>æ•°æ®é›†ä¸­è®­ç»ƒé›†æ ·æœ¬æ•°é‡ä¸º67349ï¼ŒéªŒè¯é›†æ ·æœ¬æ•°é‡ä¸º872ï¼Œæµ‹è¯•é›†æ ·æœ¬æ•°é‡ä¸º1820ï¼Œæ•°æ®å­˜å‚¨æ ¼å¼ä¸ºtsvï¼Œè¯»å–æ•°æ®çš„ä»£ç å¦‚ä¸‹:ï¼ˆutils/load_data.pyï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_model_data</span>(<span class="hljs-params">file_path</span>):<br>    data = []<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        lines = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br>    <span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(lines):<br>        <span class="hljs-keyword">if</span> i:<br>            items = line.split(<span class="hljs-string">&#x27;\t&#x27;</span>)<br>            label = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(items[<span class="hljs-number">1</span>]) <span class="hljs-keyword">else</span> [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>            data.append([label, items[<span class="hljs-number">0</span>]])<br>    <span class="hljs-keyword">return</span> data<br></code></pre></td></tr></table></figure><p>åœ¨tokenizeréƒ¨åˆ†ï¼Œæˆ‘ä»¬é‡‡ç”¨GTP2Tokenizerï¼Œè¯¥éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼ˆutils/roberta_tokenizer.pyï¼‰:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># roberta tokenizer function for text pair</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenizer_encode</span>(<span class="hljs-params">tokenizer, text, max_seq_length</span>):<br>    sep = [tokenizer.sep_token]<br>    cls = [tokenizer.cls_token]<br>    <span class="hljs-comment"># 1. å…ˆç”¨&#x27;bpe_tokenize&#x27;å°†æ–‡æœ¬è½¬æ¢æˆbpe tokens</span><br>    tokens1 = cls + tokenizer.bpe_tokenize(text) + sep<br>    <span class="hljs-comment"># 2. æœ€åè½¬æ¢æˆid</span><br>    token_ids = tokenizer.convert_tokens_to_ids(tokens1)<br>    segment_ids = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(token_ids)<br>    pad_length = max_seq_length - <span class="hljs-built_in">len</span>(token_ids)<br>    <span class="hljs-keyword">if</span> pad_length &gt;= <span class="hljs-number">0</span>:<br>        token_ids += [<span class="hljs-number">0</span>] * pad_length<br>        segment_ids += [<span class="hljs-number">0</span>] * pad_length<br>    <span class="hljs-keyword">else</span>:<br>        token_ids = token_ids[:max_seq_length]<br>        segment_ids = segment_ids[:max_seq_length]<br><br>    <span class="hljs-keyword">return</span> token_ids, segment_ids<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ¨¡å‹å¦‚ä¸‹ï¼ˆmodel_train.pyï¼‰:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ„å»ºæ¨¡å‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_cls_model</span>():<br>    <span class="hljs-comment"># Roberta model</span><br>    roberta_model = build_bert_model(CONFIG_FILE_PATH, CHECKPOINT_FILE_PATH, roberta=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># å»ºç«‹æ¨¡å‹ï¼ŒåŠ è½½æƒé‡</span><br><br>    <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> roberta_model.layers:<br>        layer.trainable = <span class="hljs-literal">True</span><br><br>    cls_layer = Lambda(<span class="hljs-keyword">lambda</span> x: x[:, <span class="hljs-number">0</span>])(roberta_model.output)    <span class="hljs-comment"># å–å‡º[CLS]å¯¹åº”çš„å‘é‡ç”¨æ¥åšåˆ†ç±»</span><br>    p = Dense(<span class="hljs-number">2</span>, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>)(cls_layer)     <span class="hljs-comment"># å¤šåˆ†ç±»</span><br><br>    model = Model(roberta_model.<span class="hljs-built_in">input</span>, p)<br>    model.<span class="hljs-built_in">compile</span>(<br>        loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>,<br>        optimizer=Adam(<span class="hljs-number">1e-5</span>),   <span class="hljs-comment"># ç”¨è¶³å¤Ÿå°çš„å­¦ä¹ ç‡</span><br>        metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>]<br>    )<br><br>    <span class="hljs-keyword">return</span> model<br></code></pre></td></tr></table></figure><p>æ¨¡å‹å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ¨¡å‹å‚æ•°é…ç½®</span><br>EPOCH = <span class="hljs-number">10</span>              <span class="hljs-comment"># è®­ç»ƒè½®æ¬¡</span><br>BATCH_SIZE = <span class="hljs-number">64</span>         <span class="hljs-comment"># æ‰¹æ¬¡æ•°é‡</span><br>MAX_SEQ_LENGTH = <span class="hljs-number">80</span>     <span class="hljs-comment"># æœ€å¤§é•¿åº¦</span><br></code></pre></td></tr></table></figure><p>æ¨¡å‹è®­ç»ƒå®Œåï¼Œåœ¨éªŒè¯æ•°æ®é›†ä¸Šçš„å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰ä¸º0.9415ï¼ŒF1å€¼ä¸º0.9415ï¼Œå–å¾—äº†ä¸é”™æ•ˆæœã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æˆ‘ä»¬å¯¹æ–°æ ·æœ¬è¿›è¡Œæ¨¡å‹é¢„æµ‹ï¼ˆmodel_predict.pyï¼‰ï¼Œé¢„æµ‹ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>Awesome movie for everyone to watch. Animation was flawless. label:1, prob: 0.9999607</p></blockquote><blockquote><p>I almost balled my eyes out 5 times. Almost. Beautiful movie, veryinspiring. label: 1, prob: 0.9999519</p></blockquote><blockquote><p>Not even worth it. It's a movie that's too stupid for adults, and toocrappy for everyone. Skip if you're not 13, or even if you are. label:0, prob: 0.9999864</p></blockquote><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•å°†åŸå§‹torchç‰ˆæœ¬çš„è‹±æ–‡Robertaæ¨¡å‹è½¬åŒ–ä¸ºtensorflowç‰ˆæœ¬æ¨¡å‹ï¼Œå¹¶ä¸”Kerasä¸­ä½¿ç”¨tensorflowç‰ˆæœ¬æ¨¡å‹å®ç°è‹±è¯­æ–‡æœ¬åˆ†ç±»ã€‚</p><p>æœ¬é¡¹ç›®ä»£ç å·²æ”¾è‡³Githubï¼Œç½‘å€ä¸º:<ahref="https://github.com/percent4/keras_roberta_text_classificaiton">https://github.com/percent4/keras_roberta_text_classificaiton</a>ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿å¤§å®¶äº¤æµ~</p><h3 id="å‚è€ƒç½‘å€">å‚è€ƒç½‘å€</h3><ol type="1"><li><code>fairseq</code>: https://github.com/pytorch/fairseq</li><li><code>GLUE tasks</code>: https://gluebenchmark.com/tasks</li><li><code>SST-2</code>:https://nlp.stanford.edu/sentiment/index.html</li><li><code>keras_roberta</code>:https://github.com/midori1/keras_roberta</li><li><code>Roberta paper</code>:https://arxiv.org/pdf/1907.11692.pdf</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
      <tag>Roberta</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åä¸‰ï¼‰æŠ½å–å¼è¯ä¹‰æ¶ˆæ­§ï¼ˆWSDï¼‰</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B8%89%EF%BC%89%E6%8A%BD%E5%8F%96%E5%BC%8F%E8%AF%8D%E4%B9%89%E6%B6%88%E6%AD%A7%EF%BC%88WSD%EF%BC%89/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B8%89%EF%BC%89%E6%8A%BD%E5%8F%96%E5%BC%8F%E8%AF%8D%E4%B9%89%E6%B6%88%E6%AD%A7%EF%BC%88WSD%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B9%9D%EF%BC%89%E8%AF%8D%E4%B9%89%E6%B6%88%E5%B2%90%EF%BC%88WSD%EF%BC%89%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%AE%9E%E7%8E%B0/">NLPå…¥é—¨ï¼ˆä¹ï¼‰è¯ä¹‰æ¶ˆå²ï¼ˆWSDï¼‰çš„ç®€ä»‹ä¸å®ç°</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†è¯ä¹‰æ¶ˆæ­§çš„å«ä¹‰ä»¥åŠå¦‚ä½•ä½¿ç”¨ç®€å•çš„ç®—æ³•æ¥å®ç°è¯ä¹‰æ¶ˆæ­§ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œç¬”è€…å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨æŠ½å–å¼NLPæ¨¡å‹æ¥å®ç°è¯ä¹‰æ¶ˆæ­§ï¼ˆWSDï¼‰ï¼Œæ¨¡å‹çµæ„Ÿæ¥æºäºè®ºæ–‡<ahref="https://www.researchgate.net/publication/359392427_ExtEnD_Extractive_Entity_Disambiguation">ExtEnD:Extractive Entity Disambiguation</a>ã€‚</p><p>æ‰€è°“è¯ä¹‰æ¶ˆå²ï¼ŒæŒ‡çš„æ˜¯åœ¨ç‰¹å®šçš„è¯­å¢ƒä¸­ï¼Œè¯†åˆ«å‡ºæŸä¸ªæ­§ä¹‰è¯çš„æ­£ç¡®å«ä¹‰ï¼Œå³é€šå¸¸æ‰€è¯´çš„ä¸€è¯å¤šä¹‰ã€‚æ¯”å¦‚ï¼Œ<strong>è‹¹æœ</strong>ä¸€è¯åœ¨å¥å­<code>æˆ‘ä»Šå¤©åƒäº†ä¸€ä¸ªè‹¹æœ</code>å’Œå¥å­<code>è‹¹æœæ‰‹æœºå¥½ç”¨å—ï¼Ÿ</code>ä¸­çš„å«ä¹‰æ˜¯ä¸åŒçš„ï¼Œè¯ä¹‰æ¶ˆæ­§éœ€è¦å¯¹åŒä¸€è¯è¯­åˆ¤æ–­å…¶åœ¨ç‰¹å®šè¯­å¢ƒä¸‹çš„å«ä¹‰ã€‚è¯ä¹‰æ¶ˆæ­§ä¸å®ä½“é“¾æ¥æœ‰åˆ†åˆ«åˆæœ‰è”ç³»ï¼Œåé¢å°†ä¼šä»‹ç»ã€‚</p><p>åœ¨é€šå¸¸çš„NLPæ¨¡å‹ä¸­ï¼Œå¸¸å¸¸ä¼šæŠŠè¯ä¹‰æ¶ˆæ­§ä»»åŠ¡å½“åšæ–‡æœ¬åˆ†ç±»å»å®Œæˆï¼Œå–å¾—äº†ä¸é”™çš„æ•ˆæœã€‚ä½†è®ºæ–‡<ahref="https://www.researchgate.net/publication/359392427_ExtEnD_Extractive_Entity_Disambiguation">ExtEnD:Extractive EntityDisambiguation</a>æå‡ºäº†ä¸€ç§æ–°çš„èŒƒå¼ï¼Œå®ƒé€šè¿‡æŠ½å–å¼NLPæ¨¡å‹ï¼ˆå³é˜…è¯»ç†è§£æ¨¡å‹ï¼‰æ¥å®Œæˆè¯ä¹‰æ¶ˆæ­§ï¼Œä¹Ÿå–å¾—äº†ä¸é”™çš„æ•ˆæœã€‚</p><h3 id="è¯ä¹‰æ¶ˆæ­§ä¸å®ä½“é“¾æ¥">è¯ä¹‰æ¶ˆæ­§ä¸å®ä½“é“¾æ¥</h3><p>åº”å½“è¯´ï¼Œ<code>è¯ä¹‰æ¶ˆæ­§</code>å±äº<code>å®ä½“é“¾æ¥</code>ä¸­çš„ä¸€éƒ¨åˆ†ã€‚åœ¨å®ä½“é“¾æ¥ï¼ˆEntityLinkingï¼‰ä»»åŠ¡ä¸­ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>å®ä½“è¯†åˆ«</li><li>å€™é€‰è¯ç”Ÿæˆ</li><li>å€™é€‰è¯åŒ¹é…</li></ul><p>åœ¨è¯ä¹‰æ¶ˆæ­§ä¸­ï¼ŒåŒä¸€è¯è¯­çš„ä¸åŒä¹‰é¡¹ä¼šä½œä¸ºå€™é€‰è¯ç”Ÿæˆï¼Œåœ¨ç¬¬ä¸‰é˜¶æ®µçš„å€™é€‰è¯åŒ¹é…æ‰¾åˆ°æœ€æ¥è¿‘çš„é‚£ä¸ªä¹‰é¡¹ã€‚æˆ‘ä»¬ä»¥å®ä½“<code>æœ¬è‰çº²ç›®</code>ä¸ºä¾‹ï¼Œå…¶åœ¨ç™¾åº¦ç™¾ç§‘ä¸­å…±æœ‰15ä¸ªä¹‰é¡¹ï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp53_1.png" alt="ç™¾åº¦ç™¾ç§‘ä¸­çš„æœ¬è‰çº²ç›®ä¹‰é¡¹" /><figcaption aria-hidden="true">ç™¾åº¦ç™¾ç§‘ä¸­çš„æœ¬è‰çº²ç›®ä¹‰é¡¹</figcaption></figure><p>åœ¨ç‰¹å®šçš„å¥å­ä¸­ï¼Œæœ¬è‰çº²ç›®çš„å…·ä½“å«ä¹‰æ˜¯å¯ä»¥ç¡®å®šçš„ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure><img src="/img/nlp53_2.png" alt="å®ä½“é“¾æ¥ä¾‹å­" /><figcaption aria-hidden="true">å®ä½“é“¾æ¥ä¾‹å­</figcaption></figure><p>åœ¨ä¸Šè¿°å¥å­ä¸­ï¼Œ<code>æœ¬è‰çº²ç›®</code>çš„æ­£ç¡®ä¹‰é¡¹åº”è¯¥æ˜¯ä¸­åŒ»å…¸ç±ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„å®ä½“é“¾æ¥ä»»åŠ¡ï¼Œä¹Ÿå¯å½“ä½œè¯ä¹‰æ¶ˆæ­§ä»»åŠ¡ã€‚</p><p>ä¸ªäººè§‚ç‚¹æ˜¯ï¼Œå®ä½“é“¾æ¥ä¸€èˆ¬æ˜¯å°†<code>å®ä½“</code>é“¾æ¥è‡³å›¾è°±ä¸­çš„æ­£ç¡®å®ä½“ï¼Œè€Œè¯ä¹‰æ¶ˆæ­§ç¨å¾®æœ‰ç‚¹åŒºåˆ«ï¼Œç»å¤§å¤šæ•°è¯è¯­æ˜¯å›¾è°±ä¸­çš„å®ä½“ï¼Œä½†ä¹Ÿæœ‰å°‘éƒ¨åˆ†ä»…ä»…æ˜¯è¯è¯­ï¼Œè€Œä¸æ˜¯å®ä½“ï¼Œæ¯”å¦‚æ±‰è¯­è¯è¯­æ¸…é£ã€æŒ‡é’ˆç­‰ã€‚å› æ­¤ï¼Œè¯ä¹‰æ¶ˆæ­§å¯ä»¥é€šè¿‡å®ä½“é“¾æ¥å¾ˆå¥½åœ°å®ç°ï¼Œä½†æœ¬æ–‡ä»…è®¨è®ºå¦‚ä½•é€šè¿‡æŠ½å–å¼NLPæ¨¡å‹ï¼ˆæ–°çš„èŒƒå¼ï¼‰æ¥å®ç°è¯ä¹‰æ¶ˆæ­§ï¼Œä»¥æœŸè¯¥æ¨¡å‹èƒ½åœ¨æ–°çš„æ•°æ®ä¸Šæœ‰è¾ƒå¥½çš„è¡¨ç°ã€‚</p><h3 id="æ•°æ®ä»‹ç»">æ•°æ®ä»‹ç»</h3><p>æˆªæ­¢ä»Šæ—¥ï¼Œç¬”è€…é€šè¿‡å‡æœŸæ—¶é—´ï¼Œå…±æ„å»ºäº†26ä¸ªè¯è¯­ï¼Œ327ä¸ªä¹‰é¡¹ï¼Œ2889æ¡æ ‡æ³¨æ ·æœ¬ã€‚ç»å¤§å¤šæ•°æ ·æœ¬å‡æ¥è‡ªäºç™¾åº¦ç™¾ç§‘ã€‚æ¯ä¸ªæ ·æœ¬å‡ä¼šç»™å‡ºæ–‡æœ¬ã€mentionï¼ˆå¾…æ¶ˆæ­§è¯è¯­ï¼‰ã€æ­£ç¡®ä¹‰é¡¹ä»¥åŠurlï¼ˆæ­£ç¡®ä¹‰é¡¹å¯¹åº”ç½‘å€ï¼‰ï¼Œæ¯”å¦‚ï¼š</p><table><thead><tr class="header"><th>æ–‡æœ¬</th><th>mention</th><th>æ­£ç¡®ä¹‰é¡¹</th><th>url</th></tr></thead><tbody><tr class="odd"><td>è¯åœ£ææ—¶çå’Œä»–çš„ã€Šæœ¬è‰çº²ç›®ã€‹</td><td>æœ¬è‰çº²ç›®</td><td>ä¸­åŒ»å…¸ç±</td><td>https://baike.baidu.com/item/æœ¬è‰çº²ç›®/15342</td></tr></tbody></table><p>å°†æ ‡æ³¨æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ¯”ä¾‹ä¸º8:2ï¼Œè®­ç»ƒé›†å…±æœ‰ä¸ª2233æ ·æœ¬ï¼Œæµ‹è¯•é›†å…±æœ‰656ä¸ªæ ·æœ¬ã€‚</p><p>æ¨¡å‹è¾“å…¥å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp53_3.png" alt="æ¨¡å‹è¾“å…¥" /><figcaption aria-hidden="true">æ¨¡å‹è¾“å…¥</figcaption></figure><p>æ–‡æœ¬ä¸­çš„mentionéœ€è¦ç”¨ç‰¹æ®Šç¬¦å·æ ‡è¯†å‡ºæ¥ï¼Œæ¯”å¦‚ç”¨<code>&lt;e&gt;</code>å’Œ<code>&lt;/e&gt;</code>æ ‡è¯†ï¼Œå€™é€‰é›†é›†åˆç»„åˆè¾“å…¥ä¸ºä¸‹ä¸€å¥ï¼Œå°†<code>&lt;/ec&gt;</code>æ ‡è¯†æ·»åŠ è‡³æ¯ä¸ªä¹‰é¡¹çš„ç»“å°¾ã€‚</p><h3 id="æ¨¡å‹">æ¨¡å‹</h3><p>ä¸€èˆ¬ä½¿ç”¨<code>æ–‡æœ¬å¤šåˆ†ç±»</code>æˆ–è€…<code>æ–‡æœ¬å¤šæ ‡ç­¾æ–‡æœ¬</code>è¿™ä¸ªæ¨¡å‹èŒƒå¼æ¥è¿›è¡Œæ­£ç¡®ä¹‰é¡¹åŒ¹é…ã€‚æœ¬æ–‡å€Ÿé‰´<code>Sapienza NLP Group, Sapienza University of Rome</code>åœ¨ACL2022è®ºæ–‡<ahref="https://www.researchgate.net/publication/359392427_ExtEnD_Extractive_Entity_Disambiguation">ã€ŠExtEnD:Extractive EntityDisambiguationã€‹</a>ä¸­ç»™å‡ºçš„æŠ½å–å¼æ¨¡å‹ï¼Œä½¿ç”¨è¾ƒä¸ºç®€å•çš„é˜…è¯»ç†è§£æ¨¡å‹ï¼ˆMRCï¼‰æ¥å®ç°ã€‚æ¨¡å‹ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="/img/nlp53_4.png" alt="æŠ½å–å¼è¯ä¹‰æ¶ˆæ­§æ¨¡å‹" /><figcaption aria-hidden="true">æŠ½å–å¼è¯ä¹‰æ¶ˆæ­§æ¨¡å‹</figcaption></figure><p>å¯¹æ ‡æ³¨æ•°æ®è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œæ–‡æœ¬æœ€å¤§é•¿åº¦ä¸º500ï¼Œbatchsizeå–16ï¼Œè®­ç»ƒ12è½®æ¬¡ï¼Œå­¦ä¹ ç‡å–0.00001ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„<code>Exact Match</code>ä¸º0.9029ã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><h4 id="åœ¨åŸæœ‰è¯è¯­ä¹‰é¡¹ä¸Šçš„é¢„æµ‹ç»“æœ">1. åœ¨åŸæœ‰è¯è¯­ä¹‰é¡¹ä¸Šçš„é¢„æµ‹ç»“æœ</h4><p>æˆ‘ä»¬å¯¹æ ‡æ³¨è¿‡çš„è¯è¯­<code>è‹¹æœ</code>è¿›è¡Œé¢„æµ‹ï¼Œå…¶ç™¾åº¦ç™¾ç§‘ä¹‰é¡¹ä¸ºï¼š</p><p><img src="/img/nlp53_5.png" /></p><p>éšä¾¿é€‰å–ä¸¤ä¸ªç½‘ä¸Šçš„å¥å­è¿›è¡Œæ¶ˆæ­§ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>æ–‡æœ¬ï¼šã€è‹¹æœçš„åšæ³•å¤§å…¨_è‹¹æœæ€ä¹ˆåšå¥½åƒ_èœè°±å¤§å…¨ã€‘_ä¸‹å¨æˆ¿æ­£ç¡®ä¹‰é¡¹ï¼šè”·è–‡ç§‘è‹¹æœå±æ¤ç‰©</p></blockquote><blockquote><p>è‹¹æœ2022è´¢å¹´Q2ä¸šç»©:æ‰‹æœºä¸šåŠ¡å¢é•¿äº®çœ¼ è½¬å‹åˆè§æˆæ•ˆ-è‚¡ç¥¨...æ­£ç¡®ä¹‰é¡¹ï¼šè‹¹æœäº§å“å…¬å¸</p></blockquote><h4 id="åœ¨æ–°è¯è¯­ä¹‰é¡¹ä¸Šçš„é¢„æµ‹ç»“æœ">2. åœ¨æ–°è¯è¯­ä¹‰é¡¹ä¸Šçš„é¢„æµ‹ç»“æœ</h4><p>æˆ‘ä»¬å¯¹æœªæ ‡æ³¨è¿‡çš„è¯è¯­<code>å—äº¬</code>è¿›è¡Œé¢„æµ‹ï¼Œå…¶ç™¾åº¦ç™¾ç§‘ä¹‰é¡¹ä¸ºï¼š</p><p><img src="/img/nlp53_6.png" /></p><p>éšä¾¿é€‰å–ä¸¤ä¸ªç½‘ä¸Šçš„å¥å­è¿›è¡Œæ¶ˆæ­§ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>æ–‡æœ¬ï¼šå—äº¬çš„é¥®é£Ÿä»¥é‡‘é™µèœè‘—åï¼Œé‡‘é™µèœæ˜¯æŒ‡ä»¥å—äº¬ä¸ºä¸­å¿ƒï¼Œä¸€ç›´å»¶ä¼¸åˆ°æ±Ÿè¥¿ä¹æ±Ÿçš„èœç³»ï¼Œæ˜¯è‹èœçš„å››å¤§ä»£è¡¨èœä¹‹ä¸€ã€‚æ­£ç¡®ä¹‰é¡¹ï¼šæ±Ÿè‹çœè¾–åœ°çº§å¸‚ã€çœä¼š</p></blockquote><blockquote><p>æ–‡æœ¬ï¼šå½±ç‰‡åˆ¶ç‰‡äººè±æ˜‚è¥¿æ–¯æ˜¯åœ¨2004å¹´èŒå‘æ‹æ‘„çºªå½•ç‰‡ã€Šå—äº¬ã€‹çš„å¿µå¤´çš„ã€‚æ­£ç¡®ä¹‰é¡¹ï¼šç¾å›½2007å¹´é›¨æœÂ·é˜¿å§†æ–¯ç‰¹æœ—ä¸»æ¼”çš„ç”µå½±</p></blockquote><p>æˆ‘ä»¬å¯¹æœªæ ‡æ³¨è¿‡çš„è¯è¯­<code>å¹³å‡¡çš„ä¸–ç•Œ</code>è¿›è¡Œé¢„æµ‹ï¼Œå…¶ç™¾åº¦ç™¾ç§‘ä¹‰é¡¹ä¸ºï¼š</p><p><img src="/img/nlp53_7.png" /></p><p>éšä¾¿é€‰å–ä¸¤ä¸ªç½‘ä¸Šçš„å¥å­è¿›è¡Œæ¶ˆæ­§ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>æ–‡æœ¬ï¼šã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹:æ°¸æ’çš„é­…åŠ›--æ–‡å²--ä¸­å›½ä½œå®¶ç½‘æ­£ç¡®ä¹‰é¡¹ï¼šè·¯é¥è‘—é•¿ç¯‡å°è¯´</p></blockquote><blockquote><p>æ–‡æœ¬ï¼šã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹çš„ä¸»æ¼”æ˜¯è°æ­£ç¡®ä¹‰é¡¹ï¼š2015å¹´ç‹é›·ã€ä½Ÿä¸½å¨…ã€è¢å¼˜ä¸»æ¼”ç”µè§†å‰§</p></blockquote><p>æˆ‘ä»¬å¯¹æœªæ ‡æ³¨è¿‡çš„è¯è¯­<code>ç¢§è¡€å‰‘</code>è¿›è¡Œé¢„æµ‹ï¼Œå…¶ç™¾åº¦ç™¾ç§‘ä¹‰é¡¹ä¸ºï¼š</p><p><img src="/img/nlp53_8.png" /></p><p>éšä¾¿é€‰å–ä¸¤ä¸ªç½‘ä¸Šçš„å¥å­è¿›è¡Œæ¶ˆæ­§ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>æ–‡æœ¬ï¼šã€Šç¢§è¡€å‰‘ã€‹æ˜¯å½“ä»£ä½œå®¶é‡‘åº¸å…ˆç”Ÿçš„é•¿ç¯‡æ­¦ä¾ å°è¯´ã€‚å¤§å®¶éƒ½çŸ¥é“é‡‘åº¸è€å…ˆç”Ÿçš„è‘—åå°è¯´éƒ½è¢«ç¿»æ‹æˆäº†ç”µè§†å‰§ï¼Œã€Šç¢§è¡€å‰‘ã€‹ä¹Ÿä¸ä¾‹å¤–ã€‚æ­£ç¡®ä¹‰é¡¹ï¼šé‡‘åº¸åˆ›ä½œé•¿ç¯‡å°è¯´</p></blockquote><blockquote><p>æ–‡æœ¬ï¼š2000å¹´ç‰ˆã€Šç¢§è¡€å‰‘ã€‹æ˜¯ç”±ææ·»èƒœç›‘åˆ¶ï¼Œæ—å®¶æ ‹ã€ä½˜è¯—æ›¼ã€æ±Ÿåé¢†è¡”ä¸»æ¼”çš„å¤è£…æ­¦ä¾ ç”µè§†å‰§ã€‚æ•…äº‹è¿˜åŸåº¦å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œè¿™éƒ¨å‰§ä¸­æˆ‘çœŸçš„å¾ˆå–œæ¬¢ä½˜è¯—æ›¼æ‰®æ¼”çš„é˜¿ä¹å•Šï¼æ­£ç¡®ä¹‰é¡¹ï¼š2000å¹´é¦™æ¸¯TVBç‰ˆæ—å®¶æ ‹ä¸»æ¼”ç”µè§†å‰§</p></blockquote><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®å·²ç»å¼€æºè‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/WSD_With_Text_Extraction">https://github.com/percent4/WSD_With_Text_Extraction</a>ã€‚</p><p>å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿äº¤æµ~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>è¯ä¹‰æ¶ˆæ­§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åäºŒï¼‰åœ¨BERTæ¨¡å‹ä¸­æ·»åŠ è‡ªå·±çš„è¯æ±‡</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%BA%8C%EF%BC%89%E5%9C%A8BERT%E6%A8%A1%E5%9E%8B%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E8%AF%8D%E6%B1%87/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%BA%8C%EF%BC%89%E5%9C%A8BERT%E6%A8%A1%E5%9E%8B%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E8%AF%8D%E6%B1%87/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä¸è®ºæ˜¯Tensorflowç‰ˆæœ¬æˆ–è€…PyTorchç‰ˆæœ¬çš„NLPé¢„è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨æ¨¡å‹æ–‡ä»¶ä¸­çœ‹åˆ°<code>vocab.txt</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯è¯¥é¢„è®­ç»ƒæ¨¡å‹çš„è¯æ±‡è¡¨ã€‚é€šå¸¸ï¼Œæ¨¡å‹æœ¬èº«éƒ½ä¼šè‡ªå¸¦è¯æ±‡è¡¨æ–‡ä»¶ï¼Œè¿™æ˜¯åœ¨æ¨¡å‹é¢„è®­ç»ƒçš„æ—¶å€™è®­ç»ƒå¾—åˆ°çš„è¯æ±‡è¡¨ï¼Œå…·æœ‰ä»£è¡¨æ€§ï¼Œä¸€èˆ¬ä¸å¯éšæ„æ›´æ”¹ã€‚åŒæ—¶<code>vocab.txt</code>æ–‡ä»¶ä¸­ä¹Ÿä¿ç•™äº†ä¸€å®šæ•°é‡çš„æœªä½¿ç”¨ï¼ˆunuserdï¼‰è¯æ±‡ï¼Œç”¨äºæ·»åŠ æ–°è¯ã€‚</p><figure><img src="/img/nlp52_1.png" alt="BERTä¸­æ–‡ç‰ˆé¢„è®­ç»ƒæ¨¡å‹" /><figcaption aria-hidden="true">BERTä¸­æ–‡ç‰ˆé¢„è®­ç»ƒæ¨¡å‹</figcaption></figure><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨BERTæ¨¡å‹ä¸­æ·»åŠ è‡ªå·±çš„è¯æ±‡ï¼Œå…¶å®ƒé¢„è®­ç»ƒæ¨¡å‹åŸç†ç›¸åŒã€‚</p><p>æˆ‘ä»¬å°†é€šè¿‡ä¸‰ä¸ªå¸¸è§çš„æ¨¡å—æ¥ä»‹ç»ï¼Œåˆ†åˆ«æ˜¯<code>keras-bert</code>ï¼Œ<code>transformers</code>,<code>tokenizer</code>ã€‚å…¶ä¸­<code>keras-bert</code>æ˜¯Kerasæ¡†æ¶å®ç°çš„æ¨¡å—ï¼Œ<code>transformers</code>ä¸»è¦æ˜¯PyTorchå®ç°çš„æ¨¡å—ï¼Œä¹Ÿå¯ç”¨äºTensorFlow2.0ç‰ˆæœ¬ä»¥ä¸Šï¼Œ<code>tokenizer</code>æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºåˆ‡åˆ†è¯ï¼ˆtokenizeï¼‰çš„æ¨¡å—ã€‚</p><p>é€šå¸¸ï¼Œå¾€é¢„è®­ç»ƒæ¨¡å‹ä¸­æ·»åŠ æ–°è¯æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>ç›´æ¥åœ¨è¯æ±‡è¡¨vocab.txtä¸­æ›¿æ¢[unused]</li><li>é€šè¿‡é‡æ„è¯æ±‡çŸ©é˜µæ¥å¢åŠ æ–°è¯</li></ul><h3 id="keras-bert">keras-bert</h3><p>åœ¨<code>keras-bert</code>æ¨¡å—ä¸­ï¼Œé¦–å…ˆè§‚å¯Ÿä¸æ·»åŠ æ–°è¯æ—¶çš„åˆ‡åˆ†è¯ç»“æœã€‚æˆ‘ä»¬ä»¥ç‰¹æ®Šæ ‡è¯†<code>jjj</code>ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> Tokenizer<br><br><span class="hljs-comment"># åŠ è½½è¯å…¸</span><br>dict_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/vocab.txt&#x27;</span><br>token_dict = &#123;&#125;<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(dict_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> reader:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> reader:<br>        token = line.strip()<br>        token_dict[token] = <span class="hljs-built_in">len</span>(token_dict)<br><br>tokenizer = Tokenizer(token_dict)<br>text = <span class="hljs-string">&#x27;jjjä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚&#x27;</span><br>tokens = tokenizer.tokenize(text)<br><span class="hljs-built_in">print</span>(tokens)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[&#x27;[<span class="hljs-name">CLS</span>]&#x27;, <span class="hljs-symbol">&#x27;jj</span>&#x27;, &#x27;##j&#x27;, <span class="hljs-symbol">&#x27;ä»Š</span>&#x27;, <span class="hljs-symbol">&#x27;å¤©</span>&#x27;, <span class="hljs-symbol">&#x27;å¤©</span>&#x27;, <span class="hljs-symbol">&#x27;æ°”</span>&#x27;, <span class="hljs-symbol">&#x27;å¾ˆ</span>&#x27;, <span class="hljs-symbol">&#x27;å¥½</span>&#x27;, <span class="hljs-symbol">&#x27;ã€‚</span>&#x27;, &#x27;[<span class="hljs-name">SEP</span>]&#x27;]<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç›´æ¥æŒ‰ç…§åŸæœ‰æ¨¡å‹è¯æ±‡è¡¨ï¼Œåˆ™ä¸ä¼šå°†ç‰¹æ®Šæ ‡è¯†<code>jjj</code>ä½œä¸ºæ•´ä½“åˆ‡åˆ†ï¼Œè€Œæ˜¯æŒ‰ç…§ç°æœ‰åˆ‡åˆ†é€»è¾‘è¿›è¡Œåˆ‡åˆ†ã€‚</p><p>æˆ‘ä»¬å°†æ¨¡å‹è¯æ±‡è¡¨æ–‡ä»¶ä¸­çš„<code>[unused1]</code>æ›¿æ¢æˆ<code>jjj</code>ï¼Œåˆ™åˆ‡åˆ†ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[&#x27;[<span class="hljs-name">CLS</span>]&#x27;, <span class="hljs-symbol">&#x27;jjj</span>&#x27;, <span class="hljs-symbol">&#x27;ä»Š</span>&#x27;, <span class="hljs-symbol">&#x27;å¤©</span>&#x27;, <span class="hljs-symbol">&#x27;å¤©</span>&#x27;, <span class="hljs-symbol">&#x27;æ°”</span>&#x27;, <span class="hljs-symbol">&#x27;å¾ˆ</span>&#x27;, <span class="hljs-symbol">&#x27;å¥½</span>&#x27;, <span class="hljs-symbol">&#x27;ã€‚</span>&#x27;, &#x27;[<span class="hljs-name">SEP</span>]&#x27;]<br></code></pre></td></tr></table></figure><p>æˆ–è€…ä¸ä¿®æ”¹<code>vocab.txt</code>ï¼Œåœ¨ä¸Šè¿°ä»£ç ä¸­å°†token_dictä¸­å°†key<code>[unused1]</code>æ›¿æ¢æˆ<code>jjj</code>ï¼Œæ¯”å¦‚ï¼š<code>token_dict['jjj'] = token_dict.pop('[unused1]')</code>ã€‚</p><p><code>bert4keras</code>æ¨¡å—æ·»åŠ æ–°è¯åŒç†ã€‚</p><h3 id="transformers">transformers</h3><p><code>transformers</code>æ¨¡å—æ·»åŠ æ–°è¯ä¹Ÿæ˜¯ä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼Œåœ¨è¯æ±‡è¡¨vocab.txtä¸­æ›¿æ¢[unused]è¿™ç§æ–¹å¼ä¸å†èµ˜è¿°ï¼Œä»‹ç»å¦‚ä½•é€šè¿‡é‡æ„è¯æ±‡çŸ©é˜µæ¥å¢åŠ æ–°è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BertTokenizer<br><br>tokenizer = BertTokenizer(<span class="hljs-string">&quot;./bert-base-chinese/vocab.txt&quot;</span>)<br>text = <span class="hljs-string">&#x27;jjjä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚&#x27;</span><br>tokens = tokenizer.tokenize(text)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æœªæ·»åŠ æ–°è¯å‰:&#x27;</span>, tokens)<br>tokenizer.add_tokens(<span class="hljs-string">&#x27;jjj&#x27;</span>)<br>tokens = tokenizer.tokenize(text)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ·»åŠ æ–°è¯å:&#x27;</span>, tokens)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less">æœªæ·»åŠ æ–°è¯å‰: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;jj&#x27;</span>, <span class="hljs-string">&#x27;##j&#x27;</span>, <span class="hljs-string">&#x27;ä»Š&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;æ°”&#x27;</span>, <span class="hljs-string">&#x27;å¾ˆ&#x27;</span>, <span class="hljs-string">&#x27;å¥½&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>]</span><br>æ·»åŠ æ–°è¯å: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;jjj&#x27;</span>, <span class="hljs-string">&#x27;ä»Š&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;æ°”&#x27;</span>, <span class="hljs-string">&#x27;å¾ˆ&#x27;</span>, <span class="hljs-string">&#x27;å¥½&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>]</span><br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠ è½½çš„æ¨¡å‹éœ€è¦ç•¥ä½œè°ƒæ•´ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">model.resize<span class="hljs-constructor">_token_embeddings(<span class="hljs-params">len</span>(<span class="hljs-params">tokenizer</span>)</span>)<br></code></pre></td></tr></table></figure><h3 id="tokenizer">tokenizer</h3><p><code>tokenizer</code>æ¨¡å—æ·»åŠ æ–°è¯ä¹Ÿæ˜¯ä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼Œåœ¨è¯æ±‡è¡¨vocab.txtä¸­æ›¿æ¢[unused]è¿™ç§æ–¹å¼ä¸å†èµ˜è¿°ï¼Œä»‹ç»å¦‚ä½•é€šè¿‡é‡æ„è¯æ±‡çŸ©é˜µæ¥å¢åŠ æ–°è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> tokenizers <span class="hljs-keyword">import</span> BertWordPieceTokenizer<br>tokenizer = BertWordPieceTokenizer(<span class="hljs-string">&quot;./bert-base-chinese/vocab.txt&quot;</span>, lowercase=<span class="hljs-literal">True</span>)<br><br>context = <span class="hljs-string">&#x27;ä»Šå¤©jjjå¤©æ°”å¾ˆå¥½ã€‚&#x27;</span><br>tokenized_context = tokenizer.encode(context)<br><span class="hljs-built_in">print</span>(tokenized_context.ids)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(tokenized_context.ids))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æœªæ·»åŠ æ–°è¯å‰:&quot;</span>, [tokenizer.id_to_token(_) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tokenized_context.ids])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯æ±‡è¡¨å¤§å°:&quot;</span>, tokenizer.get_vocab_size())<br>tokenizer.add_special_tokens([<span class="hljs-string">&#x27;jjj&#x27;</span>])<br>tokenized_context = tokenizer.encode(context)<br><span class="hljs-built_in">print</span>(tokenized_context.ids)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(tokenized_context.ids))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ·»åŠ æ–°è¯å:&quot;</span>, [tokenizer.id_to_token(_) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tokenized_context.ids])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯æ±‡è¡¨å¤§å°:&quot;</span>, tokenizer.get_vocab_size())<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-attr">[101, 791, 1921, 11095, 8334, 1921, 3698, 2523, 1962, 511, 102]</span><br><span class="hljs-number">11</span><br>æœªæ·»åŠ æ–°è¯å‰: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;[CLS]&#x27;</span>, <span class="hljs-string">&#x27;ä»Š&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;jj&#x27;</span>, <span class="hljs-string">&#x27;##j&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;æ°”&#x27;</span>, <span class="hljs-string">&#x27;å¾ˆ&#x27;</span>, <span class="hljs-string">&#x27;å¥½&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>, <span class="hljs-string">&#x27;[SEP]&#x27;</span>]</span><br>è¯æ±‡è¡¨å¤§å°: <span class="hljs-number">21128</span><br><span class="hljs-selector-attr">[101, 791, 1921, 21128, 1921, 3698, 2523, 1962, 511, 102]</span><br><span class="hljs-number">10</span><br>æ·»åŠ æ–°è¯å: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;[CLS]&#x27;</span>, <span class="hljs-string">&#x27;ä»Š&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;jjj&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;æ°”&#x27;</span>, <span class="hljs-string">&#x27;å¾ˆ&#x27;</span>, <span class="hljs-string">&#x27;å¥½&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>, <span class="hljs-string">&#x27;[SEP]&#x27;</span>]</span><br>è¯æ±‡è¡¨å¤§å°: <span class="hljs-number">21129</span><br></code></pre></td></tr></table></figure><h3 id="é—®é¢˜æ¢è®¨">é—®é¢˜æ¢è®¨</h3><p>ä¸Šè¿°æ–¹å¼å¯¹äºä¸€èˆ¬çš„æ–°è¯ï¼Œå‡å¯èµ·æ•ˆã€‚ä½†å¯¹äºå¦ä¸€ç±»ç‰¹æ®Šçš„æ–°è¯ï¼Œæ¯”å¦‚<code>&lt;e&gt;</code>,<code>&lt;/e&gt;</code>ç­‰ï¼Œéœ€è¦å¦åŠ åˆ†æï¼Œæˆ‘ä»¬ä»¥<code>tokenizer</code>æ¨¡å—è¿›è¡Œåˆ†æï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> tokenizers <span class="hljs-keyword">import</span> BertWordPieceTokenizer<br>tokenizer = BertWordPieceTokenizer(<span class="hljs-string">&quot;./bert-base-chinese/vocab.txt&quot;</span>, lowercase=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># tokenizer.add_special_tokens([&#x27;&lt;e&gt;&#x27;, &#x27;&lt;/e&gt;&#x27;, &#x27;&lt;/ec&gt;&#x27;])</span><br><br>context = <span class="hljs-string">&#x27;&lt;e&gt;è‹¹æœ&lt;/e&gt;æ ‘å°½æ—©ç–è•¾ï¼Œèƒ½èŠ‚çœè¥å…»ï¼Œåˆ©äºåå¤§æœï¼Œä¿ƒæœé«˜æ¡©ã€‚&#x27;</span><br>tokenized_context = tokenizer.encode(context)<br><span class="hljs-built_in">print</span>(tokenized_context.ids)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(tokenized_context.ids))<br><span class="hljs-built_in">print</span>([tokenizer.id_to_token(_) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tokenized_context.ids])<br><span class="hljs-built_in">print</span>(tokenizer.get_vocab_size())<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨è¯æ±‡è¡¨vocab.txtä¸­æ›¿æ¢[unused]ï¼Œä½†ä¸ä¼šèµ·æ•ˆï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-name">101</span>, <span class="hljs-number">133</span>, <span class="hljs-number">147</span>, <span class="hljs-number">135</span>, <span class="hljs-number">5741</span>, <span class="hljs-number">3362</span>, <span class="hljs-number">133</span>, <span class="hljs-number">120</span>, <span class="hljs-number">147</span>, <span class="hljs-number">135</span>, <span class="hljs-number">3409</span>, <span class="hljs-number">2226</span>, <span class="hljs-number">3193</span>, <span class="hljs-number">4541</span>, <span class="hljs-number">5945</span>, <span class="hljs-number">8024</span>, <span class="hljs-number">5543</span>, <span class="hljs-number">5688</span>, <span class="hljs-number">4689</span>, <span class="hljs-number">5852</span>, <span class="hljs-number">1075</span>, <span class="hljs-number">8024</span>, <span class="hljs-number">1164</span>, <span class="hljs-number">754</span>, <span class="hljs-number">1777</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">3362</span>, <span class="hljs-number">8024</span>, <span class="hljs-number">914</span>, <span class="hljs-number">3362</span>, <span class="hljs-number">7770</span>, <span class="hljs-number">3445</span>, <span class="hljs-number">511</span>, <span class="hljs-number">102</span>]<br><span class="hljs-number">34</span><br>[&#x27;[<span class="hljs-name">CLS</span>]&#x27;, <span class="hljs-symbol">&#x27;&lt;</span>&#x27;, <span class="hljs-symbol">&#x27;e</span>&#x27;, <span class="hljs-symbol">&#x27;&gt;</span>&#x27;, <span class="hljs-symbol">&#x27;è‹¹</span>&#x27;, <span class="hljs-symbol">&#x27;æœ</span>&#x27;, <span class="hljs-symbol">&#x27;&lt;</span>&#x27;, <span class="hljs-symbol">&#x27;/</span>&#x27;, <span class="hljs-symbol">&#x27;e</span>&#x27;, <span class="hljs-symbol">&#x27;&gt;</span>&#x27;, <span class="hljs-symbol">&#x27;æ ‘</span>&#x27;, <span class="hljs-symbol">&#x27;å°½</span>&#x27;, <span class="hljs-symbol">&#x27;æ—©</span>&#x27;, <span class="hljs-symbol">&#x27;ç–</span>&#x27;, <span class="hljs-symbol">&#x27;è•¾</span>&#x27;, <span class="hljs-symbol">&#x27;ï¼Œ</span>&#x27;, <span class="hljs-symbol">&#x27;èƒ½</span>&#x27;, <span class="hljs-symbol">&#x27;èŠ‚</span>&#x27;, <span class="hljs-symbol">&#x27;çœ</span>&#x27;, <span class="hljs-symbol">&#x27;è¥</span>&#x27;, <span class="hljs-symbol">&#x27;å…»</span>&#x27;, <span class="hljs-symbol">&#x27;ï¼Œ</span>&#x27;, <span class="hljs-symbol">&#x27;åˆ©</span>&#x27;, <span class="hljs-symbol">&#x27;äº</span>&#x27;, <span class="hljs-symbol">&#x27;å</span>&#x27;, <span class="hljs-symbol">&#x27;å¤§</span>&#x27;, <span class="hljs-symbol">&#x27;æœ</span>&#x27;, <span class="hljs-symbol">&#x27;ï¼Œ</span>&#x27;, <span class="hljs-symbol">&#x27;ä¿ƒ</span>&#x27;, <span class="hljs-symbol">&#x27;æœ</span>&#x27;, <span class="hljs-symbol">&#x27;é«˜</span>&#x27;, <span class="hljs-symbol">&#x27;æ¡©</span>&#x27;, <span class="hljs-symbol">&#x27;ã€‚</span>&#x27;, &#x27;[<span class="hljs-name">SEP</span>]&#x27;]<br><span class="hljs-number">21128</span><br></code></pre></td></tr></table></figure><p>ä½†<code>add_special_tokens</code>ä¼šèµ·æ•ˆï¼ŒåŸå› ä¸º<code>&lt;</code>,<code>e</code>,<code>&gt;</code>å’Œ<code>&lt;e&gt;</code>å‡å­˜åœ¨äº<code>vocab.txt</code>ï¼Œä½†å‰ä¸‰è€…çš„ä¼˜å…ˆçº§é«˜äº<code>&lt;e&gt;</code>ï¼Œè€Œ<code>add_special_tokens</code>ä¼šèµ·æ•ˆï¼Œå´ä¼šä½¿å¾—è¯æ±‡è¡¨å¤§å°å¢å¤§ï¼Œä»è€Œéœ€å¦å¤–è°ƒæ•´æ¨¡å‹sizeã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœåŒæ—¶åœ¨è¯æ±‡è¡¨vocab.txtä¸­æ›¿æ¢[unused]ï¼ŒåŒæ—¶<code>add_special_tokens</code>ï¼Œåˆ™æ–°å¢è¯ä¼šèµ·æ•ˆï¼ŒåŒæ—¶è¯æ±‡è¡¨å¤§å°ä¸å˜ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨BERTæ¨¡å‹ä¸­æ·»åŠ è‡ªå·±çš„è¯æ±‡ï¼Œå…¶å®ƒé¢„è®­ç»ƒæ¨¡å‹åŸç†ç›¸åŒã€‚åŒæ—¶ï¼Œ<code>tokenizer</code>ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„åˆ‡åˆ†è¯çš„æ¨¡å—ï¼Œå»ºè®®è¯»è€…æœ‰ç©ºå¯ä»¥å°è¯•~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>BERT</tag>
      
      <tag>NLP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åä¸€ï¼‰ä½¿ç”¨PyTorchè®­ç»ƒå¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»æ¨¡å‹</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B8%80%EF%BC%89%E4%BD%BF%E7%94%A8PyTorch%E8%AE%AD%E7%BB%83%E5%A4%9A%E6%A0%87%E7%AD%BE%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%E4%B8%80%EF%BC%89%E4%BD%BF%E7%94%A8PyTorch%E8%AE%AD%E7%BB%83%E5%A4%9A%E6%A0%87%E7%AD%BE%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨PyTorchè®­ç»ƒå¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»æ¨¡å‹ã€‚</p><p>æ‰€è°“å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»ï¼ŒæŒ‡çš„æ˜¯æ–‡æœ¬å¯èƒ½ä¼šå±äºå¤šä¸ªç±»åˆ«ï¼Œè€Œä¸æ˜¯å•ä¸ªç±»åˆ«ã€‚ä¸æ–‡æœ¬å¤šåˆ†ç±»çš„åŒºåˆ«åœ¨äºï¼Œæ–‡æœ¬å¤šåˆ†ç±»æ¨¡å‹å¾€å¾€æœ‰å¤šä¸ªç±»åˆ«ï¼Œä½†æ–‡æœ¬è‡³å±äºå…¶ä¸­ä¸€ä¸ªç±»åˆ«ï¼›è€Œå¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»ä¹Ÿä¼šæœ‰å¤šä¸ªç±»åˆ«ï¼Œä½†æ–‡æœ¬ä¼šå±äºå…¶ä¸­å¤šä¸ªç±»åˆ«ã€‚</p><h3 id="æ•°æ®é›†">æ•°æ®é›†</h3><p>æœ¬æ–‡æ¼”ç¤ºçš„æ•°æ®é›†ä¸ºè‹±è¯­è®ºæ–‡æ•°æ®é›†ï¼Œå‚è€ƒç½‘å€ä¸ºï¼š<ahref="https://datahack.analyticsvidhya.com/contest/janatahack-independence-day-2020-ml-hackathon">https://datahack.analyticsvidhya.com/contest/janatahack-independence-day-2020-ml-hackathon</a>ï¼Œæ•°æ®ä¸‹è½½éœ€ç¿»å¢™ï¼Œè¯»è€…ä¹Ÿå¯å‚çœ‹åç»­ç»™å‡ºçš„é¡¹ç›®Githubã€‚è¯¥è®ºæ–‡æ•°æ®é›†å®é™…ä¸Šæ˜¯æ¯”èµ›æ•°æ®ï¼Œä¾›é€‰æ‰‹å°è¯•æ¨¡å‹ã€‚æœ¬æ–‡æ‰€é‡‡ç”¨çš„æ•°æ®é›†ä¸ºè‹±è¯­ï¼Œè‡³äºä¸­æ–‡ï¼Œå…¶åŸç†æ˜¯ä¸€è‡´çš„ï¼Œç¨å¾®åšè°ƒæ•´å³å¯ã€‚</p><p>è¯¥æ•°æ®é›†ç»™å‡ºè®ºæ–‡çš„æ ‡é¢˜ï¼ˆTITLEï¼‰å’Œæ‘˜è¦ï¼ˆABSTRACTï¼‰ï¼Œæ¥é¢„æµ‹è®ºæ–‡å±äºå“ªä¸ªä¸»é¢˜ã€‚è¯¥æ•°æ®é›†å…±æœ‰20972ä¸ªè®­ç»ƒæ ·æœ¬ï¼Œæœ‰å…­ä¸ªä¸»é¢˜ï¼Œåˆ†åˆ«ä¸ºï¼šComputerScience, Physics, Mathematics, Statistics, Quantitative Biology,Quantitative Financeã€‚åœ¨æ­¤ç»™å‡ºä¸€ä¸ªæ ·ä¾‹æ•°æ®ï¼š</p><blockquote><p>TITLE : Many-Body Localization: Stability and Instability ABSTRACT:Rare regions with weak disorder (Griffiths regions) have the potentialto spoil localization. We describe a non-perturbative construction oflocal integrals of motion (LIOMs) for a weakly interacting spin chain inone dimension, under a physically reasonable assumption on thestatistics of eigenvalues. We discuss ideas about the situation inhigher dimensions, where one can no longer ensure that interactionsinvolving the Griffiths regions are much smaller than the typicalenergy-level spacing for such regions. We argue that ergodicity isrestored in dimension d &gt; 1, although equilibration should beextremely slow, similar to the dynamics of glasses. TOPICS: Physics,Mathematics</p></blockquote><h3 id="æ¨¡å‹ç»“æ„">æ¨¡å‹ç»“æ„</h3><p>æœ¬æ–‡ç»™å‡ºçš„å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»æ¨¡å‹ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼ˆBERTï¼‰ï¼Œä¸‹æ¸¸ç½‘ç»œç»“æ„è¾ƒä¸ºç®€å•ï¼Œç®—æ˜¯æ¯”è¾ƒä¸­åº¸ä½†ç®€å•å¥½ç”¨çš„æ¨¡å‹æ–¹æ¡ˆï¼Œæ¨¡å‹ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp51_1.png" alt="å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»ç»“æ„å›¾" /><figcaption aria-hidden="true">å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»ç»“æ„å›¾</figcaption></figure><p>è¯¥æ¨¡å‹ä½¿ç”¨PyTorchçš„transformersæ¨¡å—æ¥å®ç°ï¼Œä»£ç å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ¨¡å‹ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BERTClass</span>(torch.nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(BERTClass, self).__init__()<br>        self.l1 = transformers.BertModel.from_pretrained(MODEL_NAME_OR_PATH)<br>        self.l2 = torch.nn.Dropout(<span class="hljs-number">0.2</span>)<br>        self.l3 = torch.nn.Linear(HIDDEN_LAYER_SIZE, <span class="hljs-number">6</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, ids, mask, token_type_ids</span>):<br>        _, output_1 = self.l1(ids, attention_mask=mask, token_type_ids=token_type_ids)<br>        output_2 = self.l2(output_1)<br>        output = self.l3(output_2)<br>        <span class="hljs-keyword">return</span> output<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æŸå¤±å‡½æ•°ä¸º<code>torch.nn.BCEWithLogitsLoss</code>ï¼Œå› è€Œä¸éœ€è¦åœ¨outputå±‚ååŠ ä¸Šsigmoidæ¿€æ´»å‡½æ•°ã€‚</p><p>æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå°†è®­ç»ƒæ•°æ®éšæœºåˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œä¸¤éƒ¨åˆ†æ¯”ä¾‹ä¸º8:2ï¼ŒåŒæ—¶æ¨¡å‹å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ¨¡å‹å‚æ•°</span><br>MAX_LEN = <span class="hljs-number">128</span><span class="hljs-comment"># æ–‡æœ¬æœ€å¤§é•¿åº¦</span><br>TRAIN_BATCH_SIZE = <span class="hljs-number">32</span><span class="hljs-comment"># è®­ç»ƒæ‰¹æ¬¡æ•°é‡</span><br>VALID_BATCH_SIZE = <span class="hljs-number">32</span><span class="hljs-comment"># æµ‹è¯•æ‰¹æ¬¡æ•°é‡</span><br>EPOCHS = <span class="hljs-number">10</span><span class="hljs-comment"># è®­ç»ƒè½®æ•°</span><br>LEARNING_RATE = <span class="hljs-number">1e-05</span><span class="hljs-comment"># å­¦ä¹ ç‡</span><br><span class="hljs-comment"># æ¨¡å‹</span><br>MODEL_NAME_OR_PATH = <span class="hljs-string">&#x27;./bert-base-uncased&#x27;</span><span class="hljs-comment"># é¢„è®­ç»ƒæ¨¡å‹</span><br>HIDDEN_LAYER_SIZE = <span class="hljs-number">768</span><span class="hljs-comment"># éšè—å±‚ç»´æ•°</span><br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹æ•ˆæœ">æ¨¡å‹æ•ˆæœ</h3><p>ç¬”è€…åˆ†åˆ«å°è¯•ä½¿ç”¨<code>bert-base-uncased</code>å’Œ<code>bert-large-uncased</code>è®­ç»ƒæ¨¡å‹ï¼Œå¹¶åœ¨æµ‹è¯•æ•°æ®ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œåœ¨æ¯”èµ›å®˜ç½‘ä¸Šè¿›è¡Œæäº¤ï¼Œç»“æœå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹</th><th>max length</th><th>batch size</th><th>private score</th><th>rank</th></tr></thead><tbody><tr class="odd"><td>bert-base-uncased</td><td>128</td><td>32</td><td>0.8320</td><td>107</td></tr><tr class="even"><td>bert-large-uncased</td><td>128</td><td>16</td><td>0.8355</td><td>79</td></tr></tbody></table><p>çœ‹è¿‡ä¸€ä¸ªrankä¸º17çš„æ–¹æ¡ˆï¼Œå…¶é‡‡ç”¨çš„æ˜¯å¤šä¸ªé¢„è®­ç»ƒæ¨¡å‹è®­ç»ƒåçš„é›†æˆï¼Œåæ¥ç½‘ç»œä¸ç¬”è€…ä¸€è‡´ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼Œå…¶Githubç½‘å€ä¸º:<ahref="https://github.com/percent4/pytorch_english_mltc">https://github.com/percent4/pytorch_english_mltc</a>ã€‚åç»­å°†å°è¯•è¯¥æ¨¡å‹åœ¨ä¸­æ–‡å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»æ•°æ®é›†ä¸Šçš„æ•ˆæœï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»~</p><h3 id="å‚è€ƒç½‘å€">å‚è€ƒç½‘å€</h3><ol type="1"><li>https://jovian.ai/kyawkhaung/1-titles-only-for-medium</li><li>https://datahack.analyticsvidhya.com/contest/janatahack-independence-day-2020-ml-hackathon</li><li>Fine-tuned BERT Model for Multi-Label Tweets Classification:https://trec.nist.gov/pubs/trec28/papers/DICE_UPB.IS.pdf</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>å¤šæ ‡ç­¾åˆ†ç±»</tag>
      
      <tag>PyTorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäº”åï¼‰åˆ«åå‘ç°æ¨¡å‹çš„åˆæ¬¡å°è¯•</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%EF%BC%89%E5%88%AB%E5%90%8D%E5%8F%91%E7%8E%B0%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%88%9D%E6%AC%A1%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%BA%94%E5%8D%81%EF%BC%89%E5%88%AB%E5%90%8D%E5%8F%91%E7%8E%B0%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%88%9D%E6%AC%A1%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="å¼•è¨€">å¼•è¨€</h3><p>åˆ«åå³åŒä¹‰è¯ã€è¿‘ä¹‰è¯ï¼Œæ˜¯åŒä¸€äº‹ç‰©çš„ä¸åŒç§°å‘¼ã€‚åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¸¸å¸¸ç”¨åˆ°åˆ«åï¼Œæ¯”å¦‚åœŸè±†çš„åˆ«åä¸ºé©¬é“ƒè–¯ï¼ŒKFCçš„åˆ«åä¸ºè‚¯å¾·åŸºã€‚åœ¨ä¸Šæ–‡<ahref="https://blog.csdn.net/jclian91/article/details/121524964">å…³äºçŸ¥è¯†å›¾è°±ä¸Šä¸‹çº§æ¦‚å¿µå»ºè®¾çš„ä¸€ç‚¹æƒ³æ³•</a>ä¸­æåŠäº†ä¸Šä¸‹çº§æ¦‚å¿µçš„æè¿°åŠæ„ä¹‰ï¼Œæœ¬æ–‡å°†å°è¯•ç€ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹å»ºç«‹åŒä¹‰å…³ç³»æ¨¡å‹ã€‚</p><p>æ¯”å¦‚åœ¨ä¸‹é¢çš„æ–‡æœ¬ä¸­ï¼š</p><blockquote><p>å¡å®šæ²Ÿï¼šåˆåå˜å®šæ²Ÿï¼Œä½äºè¥¿è—318å›½é“æ‹‰è¨è‡³æ—èŠæ®µè·å…«ä¸€é•‡24å…¬é‡Œå¤„ï¼Œæµ·æ‹”2980ç±³ï¼Œåœ°å¤„é›…é²è—å¸ƒæ±Ÿæ”¯æµå°¼æ´‹æ²³ç•”</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å‘ç°åˆ«åä¸ºï¼š<code>(å¡å®šæ²Ÿ, åˆ«å, å˜å®šæ²Ÿ)</code>ã€‚æœ¬æ–‡ä½¿ç”¨æ·±åº¦å­¦ä¹ æ–¹æ³•å»å‘ç°éç»“æ„åŒ–æ–‡æœ¬ä¸­çš„åˆ«åä¸ç®€ç§°ï¼ˆæˆ–ç§°ç¼©ç•¥è¯­ï¼‰ï¼Œå³ä½¿ç”¨<code>å…³ç³»æŠ½å–æ¨¡å‹</code>ä½œä¸ºåˆ«åå‘ç°çš„æ¨¡å‹ã€‚æœ¬æ–‡çš„æœ€å¤§ä»·å€¼åœ¨äºæä¾›é«˜è´¨é‡çš„åˆ«åã€ç®€ç§°çš„<code>æ ‡æ³¨è¯­æ–™</code>ï¼Œä»¥åŠç¬”è€…å¯¹äº<code>åˆ«åå‘ç°æ¨¡å‹</code>çš„ä¸€æ¬¡å°è¯•ã€‚</p><p>åˆ«åï¼ˆæˆ–åŒä¹‰å…³ç³»ï¼‰çŸ¥è¯†å›¾è°±æ„å»ºä¸­æ˜¯å¿…ä¸å¯å°‘çš„ä¸€ç¯ï¼Œæ˜¯æ‰©å……æœ¬ä½“åç§°çš„é‡è¦æ‰‹æ®µã€‚åˆ«åå‘ç°çš„æ„ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>æ˜¯å¯¹å®ä½“æœ¬èº«æ›´å¥½çš„ç†è§£ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸å¸¸å¬è¯´çš„<code>é˜¿é‡Œå·´å·´</code>ï¼Œå…¶å…¨åä¸º<code>é˜¿é‡Œå·´å·´ç½‘ç»œæŠ€æœ¯æœ‰é™å…¬å¸</code>ï¼Œå€ŸåŠ©åˆ«åå¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€å®¶ç§‘æŠ€å…¬å¸</li><li>æ˜¯æ„å»ºçŸ¥è¯†å›¾è°±çš„é‡è¦ä¸€ç¯ï¼Œå¯¹æœ¬ä½“çš„åç§°è¿›ä¸€æ­¥æ‰©å……</li><li>å¯¹æœç´¢ä½“éªŒçš„æå‡ï¼Œæ¯”å¦‚ç”¨æˆ·æœç´¢<code>é©¬é“ƒè–¯</code>ï¼Œç³»ç»Ÿå€ŸåŠ©åŒä¹‰å…³ç³»æ‰¾åˆ°å…¶åˆ«åï¼š<code>åœŸè±†</code>ï¼Œåˆ™å¯æ‰©å……ç”¨æˆ·çš„æœç´¢ä¸º<code>é©¬é“ƒè–¯ åœŸè±†</code>ï¼›ç”¨æˆ·æœç´¢<code>ç å³°</code>ï¼Œç³»ç»Ÿå€ŸåŠ©åŒä¹‰å…³ç³»æ‰¾åˆ°å…¶å…¨åï¼š<code>ç ç©†æœ—ç›å³°</code>ï¼Œåˆ™å¯æ‰©å……ç”¨æˆ·çš„æœç´¢ä¸º<code>ç å³° ç ç©†æœ—ç›å³°</code>ï¼Œè¿™æ— ç–‘èƒ½æå‡ç”¨æˆ·æœç´¢ä½“éªŒï¼Œæå‡æœç´¢æ•ˆæœã€‚</li></ul><h3 id="è¯­æ–™æ„å»º">è¯­æ–™æ„å»º</h3><p>æœ¬æ–‡æœ€å¤§çš„è´¡çŒ®åœ¨äºæä¾›äººå·¥æ ‡æ³¨çš„é«˜è´¨é‡åˆ«åè¯­æ–™ã€‚</p><p>æˆ‘ä»¬çš„è¯­æ–™æ¥è‡ªäº<code>CCF2019å¹´å…³ç³»æŠ½å–æ¯”èµ›æ•°æ®</code>åŠ<code>é˜…è¯»ç†è§£æ•°æ®WebQA &amp; SougouQA</code>ï¼Œå€ŸåŠ©ç¨‹åºå¤„ç†ï¼ˆå…³é”®è¯ï¼‰åŠäººå·¥æ ‡æ³¨æ•´ç†ï¼Œç›®å‰å…±è·å–æœ‰æ•ˆæ ‡æ³¨è¯­æ–™å…±4425æ¡ï¼Œå…·ä½“è¯´æ˜å¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ–‡ä»¶åç§°</th><th>æ•°æ®æ¥æº</th><th>æ ‡æ³¨æ ·æœ¬æ•°é‡</th></tr></thead><tbody><tr class="odd"><td>data/ccf2019_corpus.json</td><td>CCF2019å¹´å…³ç³»æŠ½å–æ¯”èµ›æ•°æ®</td><td>3369</td></tr><tr class="even"><td>data/sougouqa_webqa_corpus.json</td><td>é˜…è¯»ç†è§£æ•°æ®ï¼ˆWebQA &amp; SougouQAï¼‰</td><td>1056</td></tr></tbody></table><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æœ¬æ–‡é‡‡ç”¨æ–‡ç« <ahref="https://www.kexue.fm/archives/7161">ç”¨bert4kerasåšä¸‰å…ƒç»„æŠ½å–</a>ä¸­ç»™å‡ºçš„å…³ç³»æŠ½å–æ¨¡å‹è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œå…¶ä¸­è®­ç»ƒé›†æ•°æ®:æµ‹è¯•é›†æ•°æ®=8:2ã€‚</p><p>æ¨¡å‹çš„å‚æ•°è®¾ç½®ä¸ºmaxlen=200, batch_size=16, epoch=20,ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ä¸º<code>å“ˆå·¥å¤§çš„ä¸­æ–‡Robertaæ¨¡å‹: chinese-RoBERTa-wwm-ext</code>ï¼Œåœ¨GoogleColabå¹³å°ä¸Šè¿›è¡Œæ¨¡å‹è®­ç»ƒ, åœ¨æµ‹è¯•é›†ä¸Šçš„æœ€å¥½F1å€¼ä¸º88.97%ã€‚</p><h3 id="åˆ«åå‘ç°">åˆ«åå‘ç°</h3><p>æ¨¡å‹è®­ç»ƒå¥½ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥æ¨¡å‹å¯¹å…¶å®ƒéç»“æ„åŒ–æ–‡æœ¬è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å†™å…¥è‡³Neo4jä¸­è¿›è¡Œè§‚å¯Ÿã€‚ä»¥ä¸‹å°†ç»™å‡ºå‡ ä¸ªæŠ½å–ä¾‹å­ï¼š</p><blockquote><p>æ¨æ¡ƒ,åˆåé˜³æ¡ƒã€ç¾Šæ¡ƒã€äº”æ£±å­,å­¦åâ€œäº”æ•›å­â€,åˆå› æ¨ªåˆ‡é¢å¦‚äº”è§’æ˜Ÿ,æ•…å›½å¤–åˆç§°ä¹‹ä¸ºâ€œæ˜Ÿæ¢¨â€ã€‚æ¨æ¡ƒåŸäº§åœ°,ä¼ ç»Ÿè®¤ä¸ºäº§æ–¼ä¸œå—äºšçš„é©¬æ¥è¥¿äºšç­‰åœ°ã€‚æˆ‘å›½æ–¼æ±‰æœå°±æœ‰æ ½åŸ¹è®°è½½,ä»Šæˆ‘å›½ç¦å»ºã€å¹¿ä¸œã€å¹¿è¥¿ã€äº‘å—ç­‰åœ°;äºšæ´²ä¸œå—äºšã€å°åº¦;ç¾æ´²å·´è¥¿ç­‰çƒ­å¸¦åœ°åŒºå‡æ™®éæ ½åŸ¹ã€‚...</p></blockquote><p>é¢„æµ‹ç»“æœ:</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[(<span class="hljs-string">&quot;æ¨æ¡ƒ&quot;</span>, <span class="hljs-string">&quot;åˆ«å&quot;</span>, <span class="hljs-string">&quot;é˜³æ¡ƒ&quot;</span>), (<span class="hljs-string">&quot;æ¨æ¡ƒ&quot;</span>, <span class="hljs-string">&quot;åˆ«å&quot;</span>, <span class="hljs-string">&quot;ç¾Šæ¡ƒ&quot;</span>), (<span class="hljs-string">&quot;æ¨æ¡ƒ&quot;</span>, <span class="hljs-string">&quot;åˆ«å&quot;</span>, <span class="hljs-string">&quot;äº”æ£±å­&quot;</span>), (<span class="hljs-string">&quot;æ¨æ¡ƒ&quot;</span>, <span class="hljs-string">&quot;åˆ«å&quot;</span>, <span class="hljs-string">&quot;äº”æ•›å­&quot;</span>), (<span class="hljs-string">&quot;æ¨æ¡ƒ&quot;</span>, <span class="hljs-string">&quot;åˆ«å&quot;</span>, <span class="hljs-string">&quot;æ˜Ÿæ¢¨&quot;</span>)]<br></code></pre></td></tr></table></figure><p><img src="/img/nlp50_1.png" /></p><blockquote><p>è‹±å‰åˆ©æµ·å³¡éš§é“(thechanneltunnel)åˆç§°è‹±æ³•æµ·åº•éš§é“æˆ–æ¬§æ´²éš§é“(eurotunnel)ï¼Œæ˜¯ä¸€æ¡æŠŠè‹±å›½è‹±ä¼¦ä¸‰å²›è¿æ¥å¾€æ¬§æ´²æ³•å›½çš„é“è·¯éš§é“ï¼Œäº1994å¹´5æœˆ6æ—¥å¼€é€šã€‚</p></blockquote><p>é¢„æµ‹ç»“æœ:</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[(<span class="hljs-string">&quot;è‹±å‰åˆ©æµ·å³¡éš§é“&quot;</span>, <span class="hljs-string">&quot;åˆ«å&quot;</span>, <span class="hljs-string">&quot;è‹±æ³•æµ·åº•éš§é“&quot;</span>), (<span class="hljs-string">&quot;è‹±å‰åˆ©æµ·å³¡éš§é“&quot;</span>, <span class="hljs-string">&quot;åˆ«å&quot;</span>, <span class="hljs-string">&quot;æ¬§æ´²éš§é“&quot;</span>)]<br></code></pre></td></tr></table></figure><p><img src="/img/nlp50_2.png" /></p><blockquote><p>ä¸­ç§‘å¤§æ˜¯ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦çš„ç®€ç§°ï¼Œä½äºå®‰å¾½çœåˆè‚¥å¸‚ã€‚</p></blockquote><p>é¢„æµ‹ç»“æœï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[(<span class="hljs-symbol">&#x27;ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦</span>&#x27;, <span class="hljs-symbol">&#x27;ç®€ç§°</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸­ç§‘å¤§</span>&#x27;)]<br></code></pre></td></tr></table></figure><p><img src="/img/nlp50_3.png" /></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>è¯­æ–™ç»´æŠ¤è´¹æ—¶è´¹åŠ›ï¼Œå› æ­¤å¯èƒ½ä¼šå­˜åœ¨ä¸€å®šé”™è¯¯ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œè¯·åŠæ—¶æŒ‡å‡ºã€‚å¦å¤–ï¼Œè¯­æ–™å¹¶æ²¡æœ‰å¾ˆå…¨ï¼Œåç»­éœ€æŒç»­æŠ•å…¥è¿›è¡Œç»´æŠ¤ã€‚</p><p>æœ¬æ–‡ç»™å‡ºäº†ä¸€ç§<code>åˆ«åå‘ç°æ¨¡å‹</code>çš„æ€è·¯ï¼Œå¸Œæœ›åç»­å…³äºè¿™æ–¹é¢çš„èµ„æ–™å’Œç ”ç©¶ä¼šè¶Šæ¥è¶Šå¤šï¼Œæ„Ÿè°¢é˜…è¯»~</p><p>æœ¬æ–‡é¡¹ç›®å·²å¼€æºï¼Œå…¶Githubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/alias_find_system">https://github.com/percent4/alias_find_system</a>ï¼Œæ¬¢è¿å¤§å®¶å‚è€ƒ~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>åˆ«åå‘ç°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åä¹ï¼‰ä½¿ç”¨kenlmè¿›è¡Œæ–‡æœ¬çº é”™</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8kenlm%E8%BF%9B%E8%A1%8C%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8kenlm%E8%BF%9B%E8%A1%8C%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨kenlmå·¥å…·è¿›è¡Œæ–‡æœ¬çº é”™ã€‚</p><p>kenlmæ˜¯ç”¨C++ç¼–å†™çš„è¯­è¨€æ¨¡å‹å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿ã€å¿«é€Ÿåœ°è®¡ç®—n-gramã€‚kenlmå·¥å…·çš„é¦–é¡µç½‘å€ä¸ºï¼š<ahref="https://kheafield.com/code/kenlm/">https://kheafield.com/code/kenlm/</a>ï¼Œè¯¥å·¥å…·çš„Githubç½‘å€ä¸ºï¼š<ahref="https://github.com/kpu/kenlm">https://github.com/kpu/kenlm</a>ã€‚</p><p>å…³äºkenlmçš„å®‰è£…ï¼Œæœ¬æ–‡ä¸å†è¯¦ç»†ä»‹ç»ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šè¿™æ–¹é¢çš„ä»‹ç»ã€‚å®‰è£…å®Œkenlmå·¥å…·åŒ…åï¼Œå…¶æ–‡ä»¶å¤¹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">BUILDING<br>CMakeLists.txt<br>COPYING<br>COPYING.3<br>COPYING.LESSER.3<br>Doxyfile<br>GIT_REVISION<br>LICENSE<br>MANIFEST.<span class="hljs-keyword">in</span><br>README.md<br>build<br>clean_query_only.sh<br>cmake<br>compile_query_only.sh<br>include<br>lm<br>python<br>setup.py<br>util<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æˆ‘ä»¬è®­ç»ƒçš„è¯­æ–™ä¸º<code>people2014_words.txt</code>ï¼Œæ¥è‡ªç™¾åº¦ç½‘ç›˜ï¼Œè®¿é—®ç½‘å€ä¸º<ahref="https://pan.baidu.com/s/1971a5XLQsIpL0zL0zxuK2A#list/path=/">https://pan.baidu.com/s/1971a5XLQsIpL0zL0zxuK2A#list/path=%2F</a>ã€‚æˆ‘ä»¬éœ€è¦å°†åŸæ¥å·²ç»åˆ†è¯å¥½çš„æ–‡ä»¶ï¼ˆ<code>people2014_words.txt</code>ï¼‰æ”¹æˆå•ä¸ªå­—çš„æ–‡ä»¶ï¼ˆ<code>people2014_chars.txt</code>ï¼‰ï¼Œå³æ¯ä¸ªå­—ç”¨ç©ºæ ¼éš”å¼€ï¼Œpythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;people2014_words.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;people2014_chars.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> g:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> content:<br>        g.write(<span class="hljs-string">&quot; &quot;</span>.join(<span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;&quot;</span>.join(line.split())))+<span class="hljs-string">&quot;\n&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ”¹å†™åçš„æ–‡ä»¶å‰ä¸¤è¡Œå¦‚ä¸‹ï¼š</p><blockquote><p>1 . æ‰‹ æŒ‡ é•¿ åº¦ ä¸€ é¡¹ 2 0 0 8 å¹´ åœ¨ æœŸ åˆŠ ä¸Š å‘ è¡¨ çš„ è°ƒ æŸ¥ å‘ ç° é£ŸæŒ‡ æ¯” æ—  å æŒ‡ çŸ­ çš„ å¥³ æ€§ å¯ èƒ½ æœ‰ æ¯” å…¶ ä»– å¥³ æ€§ é«˜ ä¸¤ å€ çš„ å¯ èƒ½ æ€§æ‚£ ä¸Š åœ¨ è† ç›– å¤„ çš„ å…³ èŠ‚ ç‚ ã€‚ ç ” ç©¶ äºº å‘˜ è¿˜ å®£ ç§° ï¼Œ æœ‰ è¿™ äº› æ˜ æ˜¾ç”· æ€§ ç‰¹ å¾ çš„ å¥³ æ€§ æ›´ åŠ  å®¹ æ˜“ é›Œ æ¿€ ç´  æ¿€ ç´  åˆ† æ³Œ æ°´ å¹³ ä½ ï¼Œ è¿™ å¯èƒ½ ä¼š å¯¹ å…³ èŠ‚ ç‚ çš„ äº§ ç”Ÿ æœ‰ æ å¤§ çš„ å½± å“ ã€‚ é¢„ é˜² æª æ–½ ï¼š åŠ  å¼º é”»ç‚¼ è† ç›– å‘¨ å›´ çš„ è‚Œ è‚‰ ã€‚ åœ¨ ä½  å ç€ çš„ æ—¶ å€™ ï¼Œ æŠŠ ä¸¤ è…¿ ä¼¸ ç›´ å¹¶ å¹³è¡Œ äº åœ° é¢ ï¼Œ åš å æ¬¡ æ¯ æ¬¡ åš æŒ 5 â€” 1 0 ç§’ ã€‚</p></blockquote><p>æˆ‘ä»¬å°†è¯¥æ–‡ä»¶æ”¾åœ¨build/resultç›®å½•ä¸‹ã€‚</p><p>åˆ‡æ¢è‡³buildæ–‡ä»¶å¤¹æ‰€åœ¨ç›®å½•ï¼Œæ¨¡å‹è¿è¡Œçš„è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./bin/lmplz -o 3 --verbose_header --text ./result/people2014_chars.txt --arpa ./result/people2014corpus_chars.arps -S 4G<br></code></pre></td></tr></table></figure><p>è¿è¡Œå‚æ•°è§£é‡Šï¼š</p><ul><li>-oè¡¨ç¤ºn-gramä¸­nçš„æ•°é‡ï¼Œä¸€èˆ¬å–3è¶³å¤Ÿäº†ï¼Œä¹Ÿå¯ä»¥å–5ï¼›</li><li>-verbose_header:åœ¨ç”Ÿæˆçš„æ–‡ä»¶å¤´ä½ç½®åŠ ä¸Šç»Ÿè®¡ä¿¡æ¯ï¼›</li><li>--textè¡¨ç¤ºè¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ï¼›--arpaè¡¨ç¤ºè¾“å‡ºçš„æ¨¡å‹å‚æ•°æ–‡ä»¶ï¼›</li><li>-Sè¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿå†…å­˜å¤§å°ï¼Œ<code>æ³¨æ„ï¼šéœ€è¦è®¾ç½®åˆé€‚çš„å†…å­˜å¤§å°ï¼Œä¸ç„¶å¯èƒ½ä¼šè¿è¡Œå¤±è´¥</code></li></ul><p>è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">=== 1/5 Counting and sorting n-grams ===<br>Reading ~/work/kenlm/build/result/people2014_chars.txt<br>----5---10---15---20---25---30---35---40---45---50---55---60---65---70---75---80---85---90---95--100<br>****************************************************************************************************<br>Unigram tokens 36092956 types 6914<br>=== 2/5 Calculating and sorting adjusted counts ===<br>Chain sizes: 1:82968 2:1493872896 3:2801011712<br>Statistics:<br>1 6914 D1=0.53084 D2=1.03394 D3+=1.4564<br>2 1159283 D1=0.625083 D2=1.08043 D3+=1.49998<br>3 6643214 D1=0.589546 D2=1.13123 D3+=1.52492<br>Memory estimate <span class="hljs-keyword">for</span> binary LM:<br><span class="hljs-built_in">type</span>     MB<br>probing 140 assuming -p 1.5<br>probing 147 assuming -r models -p 1.5<br>trie     48 without quantization<br>trie     23 assuming -q 8 -b 8 quantization <br>trie     46 assuming -a 22 array pointer compression<br>trie     22 assuming -a 22 -q 8 -b 8 array pointer compression and quantization<br>=== 3/5 Calculating and sorting initial probabilities ===<br>Chain sizes: 1:82968 2:18548528 3:132864280<br>----5---10---15---20---25---30---35---40---45---50---55---60---65---70---75---80---85---90---95--100<br><span class="hljs-comment">####################################################################################################</span><br>=== 4/5 Calculating and writing order-interpolated probabilities ===<br>Chain sizes: 1:82968 2:18548528 3:132864280<br>----5---10---15---20---25---30---35---40---45---50---55---60---65---70---75---80---85---90---95--100<br><span class="hljs-comment">####################################################################################################</span><br>=== 5/5 Writing ARPA model ===<br>----5---10---15---20---25---30---35---40---45---50---55---60---65---70---75---80---85---90---95--100<br>****************************************************************************************************<br>Name:lmplz      VmPeak:4358320 kB       VmRSS:24136 kB  RSSMax:1112940 kB       user:13.5094    sys:2.38785     CPU:15.8973     real:15.2563<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®Œåä¼šç”Ÿæˆarpsæ ¼å¼çš„æ¨¡å‹æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œå¦‚ä¸‹å‘½ä»¤å°†æ¨¡å‹æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./bin/build_binary ./result/people2014corpus_chars.arps ./result/people2014corpus_chars.klm<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®Œè¯¥å‘½ä»¤åï¼Œå°±ä¼šç”Ÿæˆklmæ ¼å¼çš„æ¨¡å‹æ–‡ä»¶ï¼Œæ¨¡å‹æ–‡ä»¶ä½“ç§¯å¤§å¤§å‡å°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„çš„è®­ç»ƒå¥½åçš„æ¨¡å‹æ–‡ä»¶ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å·²å®Œæˆäº†ä½¿ç”¨kenlmè®­ç»ƒn-gramæ¨¡å‹ã€‚</p><h3 id="æ–‡æœ¬çº é”™">æ–‡æœ¬çº é”™</h3><p><code>pycorrector</code>æ¨¡å—æ”¯æŒä½¿ç”¨è‡ªå·±è®­ç»ƒå¥½çš„kenlmæ¨¡å‹è¿›è¡Œçº é”™ï¼Œå‚è€ƒç½‘å€ï¼š<ahref="https://github.com/shibing624/pycorrector">https://github.com/shibing624/pycorrector</a>ã€‚</p><p>æ¼”ç¤ºçš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pycorrector <span class="hljs-keyword">import</span> Corrector<br><br><span class="hljs-comment"># åŠ è½½è®­ç»ƒå¥½çš„kenlmæ¨¡å‹</span><br>lm_path = <span class="hljs-string">&quot;~/work/kenlm/build/result/people2014corpus_chars.klm&quot;</span><br>model = Corrector(language_model_path=lm_path)<br><br><span class="hljs-comment"># æ–‡æœ¬çº é”™</span><br>corrected_sent, detail = model.correct(<span class="hljs-string">&#x27;çœŸéº»çƒ¦ä½ äº†ã€‚å¸Œæœ›ä½ ä»¬å¥½å¥½çš„è·³æ— &#x27;</span>)<br><span class="hljs-built_in">print</span>(corrected_sent)<br><span class="hljs-built_in">print</span>(detail)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹pycorrectorä¸­ç»™å‡ºçš„5ä¸ªæ ·ä¾‹å¥å­è¿›è¡Œçº é”™ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">åŸå¥ï¼šçœŸéº»çƒ¦ä½ äº†ã€‚å¸Œæœ›ä½ ä»¬å¥½å¥½çš„è·³æ— <br>çº é”™åï¼šçœŸéº»çƒ¦ä½ äº†ã€‚å¸Œæœ›ä½ ä»¬å¥½å¥½çš„è·³èˆ<br>çº é”™ç»†èŠ‚ï¼š<span class="hljs-selector-attr">[(<span class="hljs-string">&#x27;æ— &#x27;</span>, <span class="hljs-string">&#x27;èˆ&#x27;</span>, 14, 15)]</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">åŸå¥ï¼šå°‘å…ˆé˜Ÿå‘˜å› è¯¥ä¸ºè€äººè®©å<br>çº é”™åï¼šå°‘å…ˆé˜Ÿå‘˜åº”è¯¥ä¸ºè€äººè®©å<br>çº é”™ç»†èŠ‚ï¼š<span class="hljs-selector-attr">[(<span class="hljs-string">&#x27;å› è¯¥&#x27;</span>, <span class="hljs-string">&#x27;åº”è¯¥&#x27;</span>, 4, 6)]</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">åŸå¥ï¼šæœºä¸ƒå­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½é¢†é‡æœ€èƒ½ä½“ç°æ™ºèƒ½çš„ä¸€ä¸ªåˆ†çŸ¥<br>çº é”™åï¼šæœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½é¢†åŸŸæœ€èƒ½ä½“ç°æ™ºèƒ½çš„ä¸€ä¸ªåˆ†çŸ¥<br>çº é”™ç»†èŠ‚ï¼š<span class="hljs-selector-attr">[(<span class="hljs-string">&#x27;æœºä¸ƒ&#x27;</span>, <span class="hljs-string">&#x27;æœºå™¨&#x27;</span>, 0, 2), (<span class="hljs-string">&#x27;é¢†é‡&#x27;</span>, <span class="hljs-string">&#x27;é¢†åŸŸ&#x27;</span>, 9, 11)]</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">åŸå¥ï¼šä¸€åªå°é±¼èˆ¹æµ®åœ¨å¹³å‡€çš„æ²³é¢ä¸Š<br>çº é”™åï¼šä¸€åªå°é±¼èˆ¹å¤«åœ¨å¹³é™çš„æ²³é¢ä¸Š<br>çº é”™ç»†èŠ‚ï¼š<span class="hljs-selector-attr">[(<span class="hljs-string">&#x27;èˆ¹æµ®&#x27;</span>, <span class="hljs-string">&#x27;èˆ¹å¤«&#x27;</span>, 4, 6), (<span class="hljs-string">&#x27;å¹³å‡€&#x27;</span>, <span class="hljs-string">&#x27;å¹³é™&#x27;</span>, 7, 9)]</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">åŸå¥ï¼šæˆ‘çš„å®¶ä¹¡æ˜¯æœ‰æ˜çš„æ¸”ç±³ä¹‹ä¹¡<br>çº é”™åï¼šæˆ‘çš„å®¶ä¹¡æ˜¯æœ‰åçš„é±¼ç±³ä¹‹ä¹¡<br>çº é”™ç»†èŠ‚ï¼š<span class="hljs-selector-attr">[(<span class="hljs-string">&#x27;æœ‰æ˜&#x27;</span>, <span class="hljs-string">&#x27;æœ‰å&#x27;</span>, 5, 7), (<span class="hljs-string">&#x27;æ¸”ç±³&#x27;</span>, <span class="hljs-string">&#x27;é±¼ç±³&#x27;</span>, 8, 10)]</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè®­ç»ƒå¥½çš„kenlmæ¨¡å‹å¯¹äºå¸¸è§çš„æ–‡æœ¬é”™è¯¯å…·æœ‰ä¸€å®šçš„çº é”™èƒ½åŠ›ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›æ²¡æœ‰çº æ­£è¿‡æ¥ã€‚</p><p>å› ä¸ºä½¿ç”¨çš„æ˜¯n-gramæ¨¡å‹ï¼Œæ‰€ä»¥æ–‡æœ¬çº é”™çš„æ•ˆæœä¾èµ–äºè¯­æ–™çš„è´¨é‡åŠè¯­æ–™å¤§å°ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨kenlmå·¥å…·è¿›è¡Œæ–‡æœ¬çº é”™ã€‚ä¹‹æ‰€ä»¥å†™è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯å› ä¸ºç½‘ä¸Šäººäº‘äº¦äº‘ï¼Œå¾ˆå¤šæ–‡ç« éƒ½è®²åˆ°ä½¿ç”¨kenlmè®­ç»ƒn-gramæ¨¡å‹æ—¶å¿…é¡»ä½¿ç”¨åˆ†è¯åçš„æ–‡ä»¶ï¼Œä½†æ ¹æ®ç¬”è€…è‡ªèº«çš„å®è·µï¼Œå‘ç°åˆ†è¯åçš„æ–‡ä»¶å¹¶æ²¡æœ‰çº é”™èƒ½åŠ›ï¼Œåè€Œæ˜¯å•ä¸ªå­—çš„æ–‡ä»¶è¿›è¡Œè®­ç»ƒæœ‰ä¸€å®šçš„çº é”™èƒ½åŠ›ã€‚å¸Œæœ›å¤§å®¶ä¸è¦è¿·ä¿¡ç½‘ä¸Šçš„æ‰€è°“åšå®¢ï¼Œè¿˜æ˜¯è¦è‡ªå·±äº²èº«å®è·µä¸‹~</p><p>n-gramæ¨¡å‹æ˜¯æ–‡æœ¬çº é”™ä¸­çš„ç»Ÿè®¡è¯­è¨€æ¨¡å‹ï¼Œå±äºè¾ƒä¸ºç®€å•çš„çº é”™æ–¹æ³•ï¼Œä½†æœ‰ä¸€å®šçš„ä½¿ç”¨ä»·å€¼ï¼Œåç»­ç¬”è€…å°†ä¼šä¸ºå¤§å®¶ä»‹ç»æ›´å¤šçš„æ–‡æœ¬çº é”™ç›¸å…³å†…å®¹ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨~</p><p>2021å¹´7æœˆ26æ—¥äºä¸Šæµ·æµ¦ä¸œï¼Œæ­¤æ—¥ä¸Šæµ·å°é£è‚†è™~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æ–‡æœ¬çº é”™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åå…«ï¼‰æ–‡æœ¬çº é”™ä¹‹è·å–å½¢è¿‘å­—</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E5%85%AB%EF%BC%89%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99%E4%B9%8B%E8%8E%B7%E5%8F%96%E5%BD%A2%E8%BF%91%E5%AD%97/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E5%85%AB%EF%BC%89%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99%E4%B9%8B%E8%8E%B7%E5%8F%96%E5%BD%A2%E8%BF%91%E5%AD%97/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ç®€ä»‹">ç®€ä»‹</h3><p>ç¬”è€…æœ€è¿‘åœ¨ä»äº‹æ–‡æœ¬çº é”™çš„ç›¸å…³å·¥ä½œï¼Œé¢‡æœ‰æ”¶è·ï¼Œå› æ­¤è®°å½•äºæ­¤ã€‚</p><p>æ–‡æœ¬çº é”™å¾ˆå¤§ä¸€éƒ¨åˆ†å·¥ä½œåœ¨äºçº æ­£åŒéŸ³å­—ã€å½¢è¿‘å­—ï¼Œæ‰€è°“å½¢è¿‘å­—ï¼Œæ˜¯æŒ‡å­—å½¢ç›¸è¿‘çš„æ±‰å­—ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•è·å–å½¢è¿‘å­—ã€‚</p><p>è·å–å½¢è¿‘å­—çš„ç®—æ³•å¦‚ä¸‹ï¼š</p><ol type="1"><li>è·å–æ±‰å­—åº“ï¼Œå°†æ‰€æœ‰æ±‰å­—è½¬åŒ–ä¸ºé»‘ç™½å›¾ç‰‡ï¼›</li><li>è·å–æ¯ä¸ªæ±‰å­—çš„å‘é‡è¡¨ç¤ºï¼ˆå³å°†å›¾ç‰‡è½¬åŒ–ä¸ºå‘é‡ï¼‰ï¼›</li><li>è®¡ç®—ä¸¤ä¸ªæ±‰å­—çš„å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå¾—åˆ°å®ƒä»¬çš„å­—å½¢ç›¸ä¼¼åº¦ã€‚</li></ol><p>ä¸‹é¢å°†è¯¦ç»†æ¼”ç¤ºå¦‚ä½•è·å–å½¢è¿‘å­—ã€‚</p><h3 id="è·å–å½¢è¿‘å­—">è·å–å½¢è¿‘å­—</h3><p>æˆ‘ä»¬ä»ç½‘ä¸Šå¾—åˆ°3500ä¸ªæ±‰å­—çš„txtæ–‡ä»¶ï¼ˆ<code>all_3500_chars.txt</code>ï¼‰ï¼Œé€šè¿‡pygameå°†æ±‰å­—è½¬åŒ–ä¸º100*100çš„é»‘ç™½å›¾ç‰‡ï¼ŒPythonç¨‹åºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> pygame<br><br>pygame.init()<br><span class="hljs-comment"># è·å–3500ä¸ªæ±‰å­—</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;all_3500_chars.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    chars = f.read().strip()<br><br><span class="hljs-comment"># é€šè¿‡pygameå°†æ±‰å­—è½¬åŒ–ä¸ºé»‘ç™½å›¾ç‰‡</span><br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> chars:<br>    font = pygame.font.Font(<span class="hljs-string">&quot;C://Windows/Fonts/simkai.ttf&quot;</span>, <span class="hljs-number">100</span>)<br>    rtext = font.render(char, <span class="hljs-literal">True</span>, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))<br>    pygame.image.save(rtext, <span class="hljs-string">&quot;&#123;&#125;.png&quot;</span>.<span class="hljs-built_in">format</span>(char))<br></code></pre></td></tr></table></figure><p>å‰10ä¸ªæ±‰å­—ä¸º<code>ä¸€ä¹™äºŒåä¸å‚ä¸ƒåœäººå…¥</code>,å…¶å¯¹åº”çš„é»‘ç™½å›¾ç‰‡å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp48_1.png" alt="å‰10ä¸ªæ±‰å­—å›¾ç‰‡" /><figcaption aria-hidden="true">å‰10ä¸ªæ±‰å­—å›¾ç‰‡</figcaption></figure><p>æ¥ç€æˆ‘ä»¬è·å–æ¯ä¸ªæ±‰å­—çš„å‘é‡è¡¨ç¤ºï¼Œå¹¶å°†è¿™ä¸¤ä¸ªå‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦ä½œä¸ºå¯¹åº”æ±‰å­—çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼ŒPythonç¨‹åºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># get_similiar_char.py</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_img_2_list</span>(<span class="hljs-params">img_path</span>):<br>    <span class="hljs-comment"># è¯»å–å›¾ç‰‡</span><br>    img = cv2.imdecode(np.fromfile(img_path, dtype=np.uint8), -<span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># æŠŠå›¾ç‰‡è½¬æ¢ä¸ºç°åº¦æ¨¡å¼</span><br>    img = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY).reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> [_[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> img.tolist()]<br><br><br><span class="hljs-comment"># è·å–æ‰€æœ‰æ±‰å­—çš„å‘é‡è¡¨ç¤ºï¼Œä»¥dictå‚¨å­˜</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_char_vectors</span>():<br>    image_paths = [_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> os.listdir(<span class="hljs-string">&quot;.&quot;</span>) <span class="hljs-keyword">if</span> _.endswith(<span class="hljs-string">&quot;png&quot;</span>)]<br>    img_vector_dict = &#123;&#125;<br>    <span class="hljs-keyword">for</span> image_path <span class="hljs-keyword">in</span> image_paths:<br>        img_vector_dict[image_path[<span class="hljs-number">0</span>]] = read_img_2_list(img_path=image_path)<br><br>    <span class="hljs-keyword">return</span> img_vector_dict<br><br><br><span class="hljs-comment"># è®¡ç®—ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cosine_similarity</span>(<span class="hljs-params">vector1, vector2</span>):<br>    dot_product = <span class="hljs-number">0.0</span><br>    normA = <span class="hljs-number">0.0</span><br>    normB = <span class="hljs-number">0.0</span><br>    <span class="hljs-keyword">for</span> a, b <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(vector1, vector2):<br>        dot_product += a * b<br>        normA += a ** <span class="hljs-number">2</span><br>        normB += b ** <span class="hljs-number">2</span><br>    <span class="hljs-keyword">if</span> normA == <span class="hljs-number">0.0</span> <span class="hljs-keyword">or</span> normB == <span class="hljs-number">0.0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> dot_product / ((normA**<span class="hljs-number">0.5</span>)*(normB**<span class="hljs-number">0.5</span>))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    img_vector_dict = get_all_char_vectors()<br><br>    <span class="hljs-comment"># è·å–æœ€æ¥è¿‘çš„æ±‰å­—</span><br>    similarity_dict = &#123;&#125;<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        match_char = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¾“å…¥æ±‰å­—: &quot;</span>)<br>        match_vector = img_vector_dict[match_char]<br>        <span class="hljs-keyword">for</span> char, vector <span class="hljs-keyword">in</span> img_vector_dict.items():<br>            cosine_similar = cosine_similarity(match_vector, vector)<br>            similarity_dict[char] = cosine_similar<br>        <span class="hljs-comment"># æŒ‰ç›¸ä¼¼åº¦æ’åºï¼Œå–å‰10ä¸ª</span><br>        sorted_similarity = <span class="hljs-built_in">sorted</span>(similarity_dict.items(), key=itemgetter(<span class="hljs-number">1</span>), reverse=<span class="hljs-literal">True</span>)<br>        <span class="hljs-built_in">print</span>([(char, <span class="hljs-built_in">round</span>(similarity, <span class="hljs-number">4</span>))<span class="hljs-keyword">for</span> char, similarity <span class="hljs-keyword">in</span> sorted_similarity[:<span class="hljs-number">10</span>]])<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°è¯•ç€è¾“å…¥<code>å›½ã€å¡«ã€åš</code>è¿™ä¸‰ä¸ªå­—ï¼Œå¾—åˆ°çš„ç›¸è¿‘å­—å½¢çš„æ±‰å­—å¦‚ä¸‹ï¼š</p><blockquote><p>è¾“å…¥æ±‰å­—: å›½ [('å›½', 1.0), ('å›º', 0.9493), ('å›¢', 0.9432), ('å›°',0.9405), ('å› ', 0.9369), ('å›´', 0.9357), ('é—¨', 0.9334), ('å›­', 0.9326),('åŒ', 0.929), ('åœ†', 0.9261)] è¾“å…¥æ±‰å­—: å¡« [('å¡«', 1.0), ('æ…',0.9522), ('å', 0.9238), ('åŸ¹', 0.9149), ('å', 0.9133), ('å—', 0.9101),('å¸', 0.9092), ('é•‡', 0.9077), ('åŸ ', 0.9074), ('äº†', 0.9044)]è¾“å…¥æ±‰å­—: åš [('åš', 1.0), ('å‚…', 0.9306), ('å', 0.9115), ('æ',0.907), ('æƒ°', 0.9046), ('è†Š', 0.9029), ('æ„•', 0.9019), ('ä¾¯', 0.8999),('æ‚´', 0.8997), ('æ€œ', 0.8989)]</p></blockquote><h3 id="opencvè¯»å–æ–‡ä»¶åä¸ºæ±‰å­—çš„å›¾ç‰‡">opencvè¯»å–æ–‡ä»¶åä¸ºæ±‰å­—çš„å›¾ç‰‡</h3><p>åœ¨ä½¿ç”¨opencvè¯»ç‰©æ–‡ä»¶åä¸ºæ±‰å­—çš„å›¾ç‰‡æ—¶ï¼Œè¯»å–çš„å›¾ç‰‡å†…å®¹ä¸ºNoneï¼Œæˆ‘ä»¬ä»¥<code>ä¸€.png</code>ä¸ºä¾‹ï¼Œæ¼”ç¤ºç¨‹åºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> cv2<br><br>image_path = <span class="hljs-string">&quot;ä¸€.png&quot;</span><br>img = cv2.imread(image_path, <span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(img, <span class="hljs-built_in">type</span>(img))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸º<code>None &lt;class 'NoneType'&gt;</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œopencvåœ¨è¯»å–å¸¦æ±‰å­—çš„æ–‡ä»¶è·¯å¾„æ—¶ä¼šæŠ¥é”™ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>image_path = <span class="hljs-string">&quot;ä¸€.png&quot;</span><br>img = cv2.imdecode(np.fromfile(image_path, dtype=np.uint8), -<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(img.shape, <span class="hljs-built_in">type</span>(img))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸º<code>(100, 100, 3) &lt;class 'numpy.ndarray'&gt;</code>ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡é€šè¿‡å°†æ±‰å­—è½¬åŒ–ä¸ºå›¾ç‰‡ï¼Œè·å–å›¾ç‰‡çš„å‘é‡è¡¨ç¤ºæ¥è¡¨å¾æ±‰å­—ï¼Œåœ¨è·å–å½¢è¿‘å­—æ–¹é¢æœ‰ç€ä¸é”™çš„æ•ˆæœã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´å¤æ‚çš„å›¾ç‰‡ç›¸ä¼¼åº¦ç®—æ³•æ¥å¢å¼ºè·å¾—æ›´å¥½çš„å½¢è¿‘å­—èƒ½åŠ›ã€‚</p><p>ä¹Ÿæœ‰ä¸å°‘ç ”ç©¶è€…ï¼Œé€šè¿‡å››è§’ç ã€éŸ³å½¢ç ç­‰ç®—æ³•æ¥è·å–å½¢è¿‘å­—ï¼Œå–å¾—äº†ä¸é”™çš„æ•ˆæœã€‚æœ¬æ–‡æƒ³æ³•æœ´ç´ ï¼Œå®¹æ˜“ç”¨ç¨‹åºå®ç°ï¼Œä¸”æ•ˆæœä¹Ÿè¾ƒä¸ºä¸é”™ã€‚</p><p>åé¢å°†ç»§ç»­è®°å½•ç¬”è€…åœ¨æ–‡æœ¬çº é”™æ–¹é¢çš„å°è¯•ï¼Œæ¬¢è¿å¤§å®¶ç»§ç»­é˜…è¯»~</p><p>2021å¹´6æœˆ29æ—¥äºä¸Šæµ·æµ¦ä¸œï¼Œæ­¤æ—¥ä¸Šæµ·æš‘æ°”é€¼äºº~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æ–‡æœ¬çº é”™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åä¸ƒï¼‰å¸¸è§çš„æŸå¤±å‡½æ•°</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%B8%83%EF%BC%89%E5%B8%B8%E8%A7%81%E7%9A%84%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%B8%83%EF%BC%89%E5%B8%B8%E8%A7%81%E7%9A%84%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ç»™å‡ºNLPä»»åŠ¡ä¸­ä¸€äº›å¸¸è§çš„æŸå¤±å‡½æ•°ï¼ˆLossFunctionï¼‰ï¼Œå¹¶ä½¿ç”¨Kerasã€PyTorchç»™å‡ºå…·ä½“ä¾‹å­ã€‚</p><p>åœ¨è®²è§£å…·ä½“çš„æŸå¤±å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦äº†è§£ä¸‹ä»€ä¹ˆæ˜¯æŸå¤±å‡½æ•°ã€‚æ‰€è°“æŸå¤±å‡½æ•°ï¼ŒæŒ‡çš„æ˜¯è¡¡é‡<code>æ¨¡å‹é¢„æµ‹å€¼y</code>ä¸<code>çœŸå®æ ‡ç­¾Y</code>ä¹‹é—´çš„å·®è·çš„å‡½æ•°ã€‚æœ¬æ–‡å°†ä»‹ç»çš„æŸå¤±å‡½æ•°å¦‚ä¸‹ï¼š</p><ul><li><p>Mean Squared Errorï¼ˆå‡æ–¹å·®æŸå¤±å‡½æ•°ï¼‰</p></li><li><p>Mean Absolute Errorï¼ˆç»å¯¹å€¼æŸå¤±å‡½æ•°ï¼‰</p></li><li><p>Binary Cross Entropyï¼ˆäºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°ï¼‰</p></li><li><p>Categorical Cross Entropyï¼ˆå¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼‰</p></li><li><p>Sparse Categorical CrossEntropyï¼ˆç¨€ç–å¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼‰</p></li><li><p>Hingle Lossï¼ˆåˆé¡µæŸå¤±å‡½æ•°ï¼‰</p></li><li><p>......</p><p>ä»¥ä¸‹å°†åˆ†åˆ«ä»‹ç»ä¸Šè¿°æŸå¤±å‡½æ•°ï¼Œå¹¶ä»‹ç»Keraså’ŒPyTorchä¸­çš„ä¾‹å­ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ†åˆ«å¯¼å…¥Kerasæ‰€éœ€æ¨¡å—å’ŒPyTorchæ‰€éœ€æ¨¡å—ã€‚Kerasæ‰€éœ€æ¨¡å—å¦‚ä¸‹ï¼š</p></li><li><figure><img src="/img/nlp47_1.png" alt="å¯¼å…¥Kerasç›¸å…³æ¨¡å—" /><figcaption aria-hidden="true">å¯¼å…¥Kerasç›¸å…³æ¨¡å—</figcaption></figure></li></ul><p>PyTorchæ‰€éœ€æ¨¡å—å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_2.png" alt="PyTorchæ‰€éœ€æ¨¡å—" /><figcaption aria-hidden="true">PyTorchæ‰€éœ€æ¨¡å—</figcaption></figure><p>ä»å¯¼å…¥æ¨¡å—æ¥çœ‹ï¼ŒPyTorchæ›´åŠ ç®€æ´ï¼Œåœ¨åé¢çš„éƒ¨åˆ†ä¸­æˆ‘ä»¬å°†æŒç»­æ¯”è¾ƒè¿™ä¸¤ç§æ¡†æ¶çš„å·®å¼‚ã€‚</p><h3 id="mean-squared-error">Mean Squared Error</h3><p>Mean SquaredErrorï¼ˆMSEï¼‰ä¸ºå‡æ–¹å·®æŸå¤±å‡½æ•°ï¼Œä¸€èˆ¬ç”¨äºå›å½’é—®é¢˜ã€‚æˆ‘ä»¬ç”¨<spanclass="math inline">\(\widetilde{y}_{i}\)</span>è¡¨ç¤ºæ ·æœ¬é¢„æµ‹å€¼åºåˆ—<spanclass="math inline">\(\{\widetilde{y}_{1},\widetilde{y}_{2},...,\widetilde{y}_{n}\}\)</span>ä¸­çš„ç¬¬iä¸ªå…ƒç´ ï¼Œç”¨<spanclass="math inline">\(y_{i}\)</span>è¡¨ç¤ºæ ·æœ¬çœŸå®å€¼åºåˆ—<spanclass="math inline">\(\{y_{1},y_{2},...,y_{n}\}\)</span>ä¸­çš„ç¬¬iä¸ªå…ƒç´ ï¼Œåˆ™å‡æ–¹å·®æŸå¤±å‡½æ•°MSEçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p><spanclass="math display">\[MSE=\frac{1}{n}\sum_{i=1}^n(\widetilde{y}_{i}-y_{i})^{2}\]</span></p><p>Keraså®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_3.png" alt="Keras MSE" /><figcaption aria-hidden="true">Keras MSE</figcaption></figure><p>PyTorchå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_4.png" alt="PyTorch MSE" /><figcaption aria-hidden="true">PyTorch MSE</figcaption></figure><h3 id="mean-absolute-error">Mean Absolute Error</h3><p>Mean AbsoluteErrorï¼ˆMAEï¼‰ä¸ºç»å¯¹å€¼æŸå¤±å‡½æ•°ï¼Œä¸€èˆ¬ç”¨äºå›å½’é—®é¢˜ã€‚æˆ‘ä»¬ç”¨<spanclass="math inline">\(\widetilde{y}_{i}\)</span>è¡¨ç¤ºæ ·æœ¬é¢„æµ‹å€¼åºåˆ—<spanclass="math inline">\(\{\widetilde{y}_{1},\widetilde{y}_{2},...,\widetilde{y}_{n}\}\)</span>ä¸­çš„ç¬¬iä¸ªå…ƒç´ ï¼Œç”¨<spanclass="math inline">\(y_{i}\)</span>è¡¨ç¤ºæ ·æœ¬çœŸå®å€¼åºåˆ—<spanclass="math inline">\(\{y_{1},y_{2},...,y_{n}\}\)</span>ä¸­çš„ç¬¬iä¸ªå…ƒç´ ï¼Œåˆ™ç»å¯¹å€¼æŸå¤±å‡½æ•°MAEçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p><spanclass="math display">\[MAE=\frac{1}{n}\sum_{i=1}^n|\widetilde{y}_{i}-y_{i}|\]</span></p><p>Keraså®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_5.png" alt="Keras MAE" /><figcaption aria-hidden="true">Keras MAE</figcaption></figure><p>PyTorchå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_6.png" alt="PyTorch MAE" /><figcaption aria-hidden="true">PyTorch MAE</figcaption></figure><p>æ³¨æ„ï¼Œåœ¨PyTorchä¸­L1Lossä¸­çš„L1è¡¨ç¤ºä¸ºL1èŒƒæ•°ï¼Œå³é€šå¸¸æ‰€è¯´çš„ç»å¯¹å€¼ï¼Œç»å¯¹å€¼å‡½æ•°<spanclass="math inline">\(|x|\)</span>å¤„å¤„è¿ç»­ï¼Œä½†åœ¨x=0å¤„ä¸å¯å¯¼ã€‚</p><h3 id="binary-cross-entropy">Binary Cross Entropy</h3><p>Binary CrossEntropyï¼ˆBCEï¼‰ä¸ºäºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œä¸€èˆ¬ç”¨äºäºŒåˆ†ç±»é—®é¢˜ã€‚æˆ‘ä»¬ç”¨Yè¡¨ç¤ºæ ·æœ¬çœŸå®æ ‡ç­¾åºåˆ—ï¼ˆæ¯ä¸ªå€¼ä¸º0æˆ–è€…1ï¼‰ï¼Œç”¨<spanclass="math inline">\(\bar{Y}\)</span>è¡¨ç¤ºæ ·æœ¬é¢„æµ‹æ ‡ç­¾åºåˆ—ï¼ˆæ¯ä¸ªå€¼ä¸º0-1ä¹‹é—´çš„å€¼ï¼‰ï¼Œåˆ™BCEè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p><span class="math display">\[BCE=Y \cdot (-log(\bar{Y}))+(1-Y) \cdot(-log(1-\bar{Y}))\]</span></p><p>æˆ‘ä»¬ä¸åœ¨è®²è§£å…·ä½“çš„è®¡ç®—å…¬å¼ï¼Œå¦‚éœ€å…·ä½“çš„è®¡ç®—æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://blog.csdn.net/jclian91/article/details/81224125">Sklearnä¸­äºŒåˆ†ç±»é—®é¢˜çš„äº¤å‰ç†µè®¡ç®—</a>ã€‚</p><p>Keraså®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_7.png" alt="Keras BCE" /><figcaption aria-hidden="true">Keras BCE</figcaption></figure><p>PyTorchå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_8.png" alt="PyTorch BCE" /><figcaption aria-hidden="true">PyTorch BCE</figcaption></figure><p>ä»ä¸Šé¢çš„ç»“æœä¸­å¯ä»¥çœ‹åˆ°Keraså’ŒPyTorchåœ¨å®ç°BCEæŸå¤±å‡½æ•°çš„å·®å¼‚ï¼Œç»™å®šæ ·æœ¬ï¼ŒKerasç»™å‡ºäº†æ¯ä¸ªæ ·æœ¬çš„BCEï¼Œè€ŒPyTorchç»™å‡ºäº†æ‰€æœ‰æ ·æœ¬BCEçš„å¹³å‡å€¼ã€‚æ›´å¤§çš„å·®å¼‚ä½“ç°åœ¨<code>å¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°</code>ã€‚</p><h3 id="categorical-cross-entropy">Categorical Cross Entropy</h3><p>Categorical CrossEntropyï¼ˆCCEï¼‰ä¸ºå¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œæ˜¯BCEï¼ˆäºŒåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼‰æ‰©å……è‡³å¤šåˆ†ç±»æƒ…å½¢æ—¶çš„æŸå¤±å‡½æ•°ã€‚å¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°çš„æ•°å­¦å…¬å¼å¦‚ä¸‹ï¼š</p><p><spanclass="math display">\[CCE=-\frac{1}{N}\sum_{i=1}^{N}\sum_{c=1}^{C}1_{y_{i}\inC_{c}}log(p_{model}[y_{i}\in C_{c}])\]</span></p><p>å…¶ä¸­Nä¸ºæ ·æœ¬æ•°ï¼ŒCä¸ºç±»åˆ«æ•°ï¼Œ<span class="math inline">\(1_{y_{i}\inC_{c}}\)</span>è¡¨ç¤ºç¬¬iä¸ªæ ·æœ¬å±äºç¬¬cä¸ªç±»åˆ«çš„å€¼ï¼ˆ0æˆ–1ï¼‰ï¼Œ<spanclass="math inline">\(p_{model}[y_{i}\inC_{c}]\)</span>è¡¨ç¤ºæ¨¡å‹é¢„æµ‹çš„ç¬¬iä¸ªæ ·æœ¬å±äºç¬¬cä¸ªç±»åˆ«çš„æ¦‚ç‡å€¼ï¼ˆ0-1ä¹‹é—´ï¼‰ã€‚å¦‚éœ€æŸ¥çœ‹å…·ä½“çš„è®¡ç®—æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://blog.csdn.net/jclian91/article/details/81233277">å¤šåˆ†ç±»é—®é¢˜çš„äº¤å‰ç†µè®¡ç®—</a>ã€‚</p><p>Keraså®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_9.png" alt="Keras CCE" /><figcaption aria-hidden="true">Keras CCE</figcaption></figure><p>PyTorchä¸­çš„CCEé‡‡ç”¨ç¨€ç–å¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°å®ç°ï¼Œå› æ­¤ç›´æ¥æŸ¥çœ‹ç¨€ç–å¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°éƒ¨åˆ†å³å¯ã€‚</p><h3 id="sparse-categorical-cross-entropy">Sparse Categorical CrossEntropy</h3><p>Sparse Categorical CrossEntropyï¼ˆç¨€ç–å¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼ŒSCCEï¼‰åŸç†ä¸Šå’Œå¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼ˆCCEï¼‰ä¸€è‡´ï¼Œå±äºå¤šåˆ†ç±»é—®é¢˜çš„æŸå¤±å‡½æ•°ï¼Œä¸åŒä¹‹å¤„åœ¨äºå¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ä¸­çš„çœŸå®æ ·æœ¬å€¼ç”¨one-hotå‘é‡æ¥è¡¨ç¤ºï¼Œå…¶ä¸‹æ ‡iä¸º1ï¼Œå…¶ä½™ä¸º0ï¼Œè¡¨ç¤ºå±äºç¬¬iä¸ªç±»åˆ«ï¼›è€Œç¨€ç–å¤šåˆ†ç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ä¸­çœŸå®æ ·æœ¬ç›´æ¥ç”¨æ•°å­—iè¡¨ç¤ºï¼Œè¡¨ç¤ºå±äºç¬¬iä¸ªç±»åˆ«ã€‚</p><p>Keraså®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_10.png" alt="Keras SCCE" /><figcaption aria-hidden="true">Keras SCCE</figcaption></figure><p>ä¾‹å­ä¸­ä¸€å…±å››ä¸ªæ ·æœ¬ï¼Œå®ƒä»¬çš„çœŸå®æ ·æœ¬æ ‡ç­¾ä¸º[2,2,0,1]ï¼Œä¸æ˜¯one-hotå‘é‡ã€‚</p><p>PyTorchä¸­çš„SCCEå®ç°ä»£ç ä¸ä¸Šè¿°æ•°å­¦å…¬å¼ä¸å¤ªä¸€è‡´ï¼Œæœ‰äº›å¾®æ”¹åŠ¨ã€‚æˆ‘ä»¬å…ˆçœ‹ä¾‹å­å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_11.png" alt="PyTorch SCCE" /><figcaption aria-hidden="true">PyTorch SCCE</figcaption></figure><p>è¿™æ˜æ˜¾ä¸Keraså®ç°ä»£ç æ˜¯ä¸ä¸€è‡´çš„ã€‚è¦è§£é‡Šè¿™ç§å·®åˆ«ï¼Œæˆ‘ä»¬å°±è¦è¯¦ç»†äº†è§£PyTorchæ˜¯å¦‚ä½•å®ç°CCEæŸå¤±å‡½æ•°çš„ã€‚</p><p>ç®€å•æ¥è¯´ï¼ŒPyTorchä¸­çš„è¾“å…¥ä¸­çš„æ ·æœ¬é¢„æµ‹ï¼Œä¸æ˜¯softmaxå‡½æ•°ä½œç”¨åçš„é¢„æµ‹æ¦‚ç‡ï¼Œè€Œæ˜¯softmaxå‡½æ•°ä½œç”¨å‰çš„å€¼ã€‚å¯¹è¯¥å€¼åˆ†åˆ«ç”¨softmaxå‡½æ•°ã€logå‡½æ•°ã€NLLLoss()å‡½æ•°ä½œç”¨å°±æ˜¯PyTorchè®¡ç®—SCCEçš„æ–¹å¼ã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œy_pred_tmpæ˜¯softmaxå‡½æ•°ä½œç”¨å‰çš„å€¼ï¼Œæ˜¯PyTorchè®¡ç®—SCCEçš„é¢„æµ‹æ ·æœ¬çš„è¾“å…¥ï¼Œy_predæ˜¯softmaxå‡½æ•°ä½œç”¨åçš„å€¼ï¼Œæ˜¯sklearnæ¨¡å—ã€Kerasè®¡ç®—SCCEçš„é¢„æµ‹æ ·æœ¬çš„è¾“å…¥ã€‚å¯¹y_pred_tmpã€y_trueä½¿ç”¨softmaxå‡½æ•°ã€logå‡½æ•°æ‰€å¾—åˆ°çš„ç»“æœï¼Œä¸y_predã€y_trueä½¿ç”¨sklearnæ¨¡å—ã€Kerasè®¡ç®—SCCEçš„ç»“æœä¸€è‡´ï¼Œè€Œå¯¹è¯¥ç»“ç®—ç»“æœå†ä½œç”¨NLLLoss()ï¼Œå°±æ˜¯PyTorchè®¡ç®—SCCEçš„æ–¹å¼ã€‚</p><p>ä¹Ÿè®¸ä¸Šé¢çš„è§£é‡Šè¿˜æœ‰ç‚¹æ¨¡ç³Šï¼Œæˆ‘ä»¬å€ŸåŠ©çŸ¥ä¹ä¸Šåˆ«äººç»™å‡ºçš„ä¸€ä¸ªä¾‹å­ä¹Ÿè®¸èƒ½æ›´å¥½åœ°ç†è§£PyTorchè®¡ç®—SCCEçš„æ–¹å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br>x_input = torch.randn(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)   <span class="hljs-comment"># éšæœºç”Ÿæˆè¾“å…¥</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x_input:\n&#x27;</span>, x_input)<br>y_target = torch.tensor([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>])    <span class="hljs-comment"># è®¾ç½®è¾“å‡ºå…·ä½“å€¼ print(&#x27;y_target\n&#x27;,y_target)</span><br><br><span class="hljs-comment"># è®¡ç®—è¾“å…¥softmaxï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°æ¯ä¸€è¡ŒåŠ åˆ°ä¸€èµ·ç»“æœéƒ½æ˜¯1</span><br>softmax_func = nn.Softmax(dim=<span class="hljs-number">1</span>)<br>soft_output = softmax_func(x_input)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;soft_output:\n&#x27;</span>, soft_output)<br><br><span class="hljs-comment"># åœ¨softmaxçš„åŸºç¡€ä¸Šå–log</span><br>log_output = torch.log(soft_output)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;log_output:\n&#x27;</span>, log_output)<br><br><span class="hljs-comment"># å¯¹æ¯”softmaxä¸logçš„ç»“åˆä¸nn.LogSoftmaxloss(è´Ÿå¯¹æ•°ä¼¼ç„¶æŸå¤±)çš„è¾“å‡ºç»“æœï¼Œå‘ç°ä¸¤è€…æ˜¯ä¸€è‡´çš„ã€‚</span><br>logsoftmax_func = nn.LogSoftmax(dim=<span class="hljs-number">1</span>)<br>logsoftmax_output = logsoftmax_func(x_input)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;logsoftmax_output:\n&#x27;</span>, logsoftmax_output)<br><br><span class="hljs-comment"># pytorchä¸­å…³äºNLLLossçš„é»˜è®¤å‚æ•°é…ç½®ä¸ºï¼šreducetion=Trueã€size_average=True</span><br>nllloss_func = nn.NLLLoss()<br>nlloss_output = nllloss_func(logsoftmax_output, y_target)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;nlloss_output:\n&#x27;</span>, nlloss_output)<br><br><span class="hljs-comment"># ç›´æ¥ä½¿ç”¨pytorchä¸­çš„loss_func=nn.CrossEntropyLoss()çœ‹ä¸ç»è¿‡NLLLossçš„è®¡ç®—æ˜¯ä¸æ˜¯ä¸€æ ·</span><br>crossentropyloss = nn.CrossEntropyLoss()<br>crossentropyloss_output = crossentropyloss(x_input, y_target)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;crossentropyloss_output:\n&#x27;</span>, crossentropyloss_output)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs subunit">x_input:<br> tensor([[ 0.1286,  1.1363,  0.5676],<br>        [ 1.0740, <span class="hljs-string">-0</span>.7359, <span class="hljs-string">-0</span>.6731],<br>        [ 0.7915, <span class="hljs-string">-0</span>.8525, <span class="hljs-string">-1</span>.2906]])<br>soft_output:<br> tensor([[0.1890, 0.5178, 0.2932],<br>        [0.7474, 0.1223, 0.1303],<br>        [0.7588, 0.1466, 0.0946]])<br>log_output:<br> tensor([[<span class="hljs-string">-1</span>.6659, <span class="hljs-string">-0</span>.6582, <span class="hljs-string">-1</span>.2269],<br>        [<span class="hljs-string">-0</span>.2911, <span class="hljs-string">-2</span>.1011, <span class="hljs-string">-2</span>.0382],<br>        [<span class="hljs-string">-0</span>.2760, <span class="hljs-string">-1</span>.9200, <span class="hljs-string">-2</span>.3581]])<br>logsoftmax_output:<br> tensor([[<span class="hljs-string">-1</span>.6659, <span class="hljs-string">-0</span>.6582, <span class="hljs-string">-1</span>.2269],<br>        [<span class="hljs-string">-0</span>.2911, <span class="hljs-string">-2</span>.1011, <span class="hljs-string">-2</span>.0382],<br>        [<span class="hljs-string">-0</span>.2760, <span class="hljs-string">-1</span>.9200, <span class="hljs-string">-2</span>.3581]])<br>nlloss_output:<br> tensor(0.9908)<br>crossentropyloss_output:<br> tensor(0.9908)<br></code></pre></td></tr></table></figure><h3 id="hingle-loss">Hingle Loss</h3><p>HingleLossä¸ºåˆé¡µæŸå¤±å‡½æ•°ï¼Œå¸¸ç”¨äºåˆ†ç±»é—®é¢˜ã€‚åˆé¡µæŸå¤±å‡½æ•°ä¸ä»…è¦åˆ†ç±»æ­£ç¡®ï¼Œè€Œä¸”ç¡®ä¿¡åº¦è¶³å¤Ÿé«˜æ—¶æŸå¤±æ‰æ˜¯0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆé¡µæŸå¤±å‡½æ•°å¯¹å­¦ä¹ æœ‰æ›´é«˜çš„è¦æ±‚ã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ä¸ºSVMï¼Œå…¶æ•°å­¦å…¬å¼å¦‚ä¸‹ï¼š</p><p><span class="math display">\[Hingle Loss=max(0, 1-y \cdot\widetilde{y})\]</span></p><p>å…¶ä¸­<span class="math inline">\(y\)</span>ä¸ºçœŸå®æ ‡ç­¾ï¼Œ<spanclass="math inline">\(\widetilde{y}\)</span>ä¸ºé¢„æµ‹æ ‡ç­¾ã€‚</p><p>Keraså®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_12.png" alt="Keras Hingle Loss" /><figcaption aria-hidden="true">Keras Hingle Loss</figcaption></figure><p>PyTorchä¸­æ²¡æœ‰ä¸“é—¨çš„HingleLosså®ç°å‡½æ•°ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°è‡ªå·±å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp47_13.png" alt="PyTorch Hingle Loss" /><figcaption aria-hidden="true">PyTorch Hingle Loss</figcaption></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†NLPä»»åŠ¡ä¸­ä¸€äº›å¸¸è§çš„æŸå¤±å‡½æ•°ï¼ˆLossFunctionï¼‰ï¼Œå¹¶ä½¿ç”¨Kerasã€PyTorchç»™å‡ºå…·ä½“ä¾‹å­ã€‚</p><p>æœ¬æ–‡ä»£ç å·²ä¸Šä¼ è‡³Githubï¼Œåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/deep_learning_miscellaneous/tree/master/loss_function">https://github.com/percent4/deep_learning_miscellaneous/tree/master/loss_function</a>ã€‚</p><p>2021å¹´4æœˆ24æ—¥äºä¸Šæµ·æµ¦ä¸œï¼Œæ­¤æ—¥æƒ é£å’Œç•…~</p><h3 id="å‚è€ƒç½‘å€">å‚è€ƒç½‘å€</h3><ol type="1"><li>How To Build Custom Loss Functions In Keras For Any UseCaseï¼šhttps://cnvrg.io/keras-custom-loss-functions/</li><li>Pytorchå¸¸ç”¨çš„äº¤å‰ç†µæŸå¤±å‡½æ•°CrossEntropyLoss()è¯¦è§£ï¼šhttps://zhuanlan.zhihu.com/p/98785902</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æŸå¤±å‡½æ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åå…­ï¼‰å¯¹æŠ—è®­ç»ƒçš„ä¸€æ¬¡å°è¯•</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E5%85%AD%EF%BC%89%E5%AF%B9%E6%8A%97%E8%AE%AD%E7%BB%83%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E5%85%AD%EF%BC%89%E5%AF%B9%E6%8A%97%E8%AE%AD%E7%BB%83%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åˆæ¬¡å¬è¯´å¯¹æŠ—è®­ç»ƒæ˜¯åœ¨ä¸€æ¬¡å®ä½“è¯†åˆ«æ¯”èµ›çš„èµ›ååˆ†äº«ä¸­ï¼Œå½“æ—¶çš„ä¸€äº›æ¦‚å¿µï¼Œæ¯”å¦‚FocalLossã€å¯¹æŠ—è®­ç»ƒã€æ¨¡å‹èåˆã€æ•°æ®å¢å¼ºç­‰éƒ½è®©æˆ‘æ„Ÿåˆ°æ–°å¥‡ï¼Œä¹‹åç¬”è€…è‡ªå·±ä¹Ÿåšäº†å¾ˆå¤šè¿™æ–¹é¢çš„å°è¯•ã€‚æœ¬æ–‡å°†åˆ†äº«ç¬”è€…å¯¹äºå¯¹æŠ—è®­ç»ƒï¼ˆFGMï¼‰çš„ä¸€æ¬¡å°è¯•ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯å¯¹æŠ—è®­ç»ƒ">ä»€ä¹ˆæ˜¯å¯¹æŠ—è®­ç»ƒï¼Ÿ</h3><p>æåˆ°â€œå¯¹æŠ—â€ï¼Œç›¸ä¿¡å¤§å¤šæ•°äººçš„ç¬¬ä¸€ååº”éƒ½æ˜¯CVä¸­çš„å¯¹æŠ—ç”Ÿæˆç½‘ç»œ(GAN)ï¼Œæ®Šä¸çŸ¥ï¼Œå…¶å®å¯¹æŠ—ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ç§é˜²å¾¡æœºåˆ¶ï¼Œå¹¶ä¸”ç»è¿‡ç®€å•çš„ä¿®æ”¹ï¼Œä¾¿èƒ½ç”¨åœ¨NLPä»»åŠ¡ä¸Šï¼Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚GANä¹‹çˆ¶IanGoodfellowåœ¨15å¹´çš„ICLRè®ºæ–‡ã€ŠExplaining and Harnessing AdversarialExamplesã€‹ä¸­ç¬¬ä¸€æ¬¡æå‡ºäº†å¯¹æŠ—è®­ç»ƒè¿™ä¸ªæ¦‚å¿µï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯åœ¨åŸå§‹è¾“å…¥æ ·æœ¬<code>x</code>ä¸ŠåŠ ä¸€ä¸ªæ‰°åŠ¨<code>radv</code>ï¼Œå¾—åˆ°å¯¹æŠ—æ ·æœ¬åï¼Œç”¨å…¶è¿›è¡Œè®­ç»ƒã€‚è¿™åœ¨CVé¢†åŸŸæ¯”è¾ƒå¥½ç†è§£ï¼Œéƒ¨åˆ†å›¾ç‰‡æœ¬èº«å°±æ˜¯è‡ªå¸¦å™ªå£°çš„ï¼Œæ¯”å¦‚æ‰‹æŠ–ã€å…‰çº¿ä¸ä½³ç­‰ï¼Œè¿™å°±æ˜¯å¤©ç„¶çš„å¯¹æŠ—æ ·æœ¬ï¼Œå®ƒä»¬åœ¨æ¨¡å‹è®­ç»ƒçš„æ—¶å€™å°±æ˜¯è´Ÿæ ·æœ¬ï¼Œè¿™äº›æ ·æœ¬çš„åŠ å…¥èƒ½æå‡æ¨¡å‹çš„é²æ£’æ€§ã€‚æ¯”å¦‚ä¸‹é¢çš„ç»å…¸ä¾‹å­ï¼š</p><figure><img src="/img/nlp46_1.png" alt="å¯¹æŠ—è®­ç»ƒçš„ç»å…¸ä¾‹å­" /><figcaption aria-hidden="true">å¯¹æŠ—è®­ç»ƒçš„ç»å…¸ä¾‹å­</figcaption></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€å¼ ç½®ä¿¡åº¦ä¸º55.7%çš„pandaå›¾ç‰‡åœ¨åŠ å…¥äº†å¾ˆå°çš„éšæœºæ‰°åŠ¨åï¼Œæ¨¡å‹ç«Ÿç„¶è¯†åˆ«ä¸ºäº†gibbonã€‚</p><p>å¯¹æŠ—è®­ç»ƒçš„ä¸€èˆ¬åŸç†å¯ä»¥ç”¨ä¸‹é¢çš„æœ€å¤§æœ€å°åŒ–å…¬å¼æ¥ä½“ç°ï¼š</p><figure><img src="/img/nlp46_2.png" alt="æœ€å¤§æœ€å°åŒ–å…¬å¼" /><figcaption aria-hidden="true">æœ€å¤§æœ€å°åŒ–å…¬å¼</figcaption></figure><p>å…¶ä¸­Dä»£è¡¨è®­ç»ƒé›†ï¼Œxä»£è¡¨è¾“å…¥ï¼Œyä»£è¡¨æ ‡ç­¾ï¼ŒÎ¸æ˜¯æ¨¡å‹å‚æ•°ï¼ŒL(x,y;Î¸)æ˜¯å•ä¸ªæ ·æœ¬çš„lossï¼ŒÎ”xæ˜¯å¯¹æŠ—æ‰°åŠ¨ï¼ŒÎ©æ˜¯æ‰°åŠ¨ç©ºé—´ã€‚Î©æ˜¯æ‰°åŠ¨ç©ºé—´ï¼ŒÎ”xæ˜¯å¯¹æŠ—æ‰°åŠ¨ï¼Œä¸€èˆ¬æ‰°åŠ¨ç©ºé—´éƒ½æ¯”è¾ƒå°ï¼Œé¿å…å¯¹åŸæ¥æ ·æœ¬çš„ç ´åã€‚åœ¨è®­ç»ƒé›†åˆDï¼Œé€‰æ‹©åˆé€‚çš„å¯¹æŠ—æ‰°åŠ¨æ¥ä½¿å¾—å½“ä¸ªæ ·æœ¬çš„lossè¾¾åˆ°æœ€å¤§ï¼ŒåŒæ—¶ï¼Œå¤–å±‚ï¼ˆ<code>E(x,y)</code>ï¼‰å°±æ˜¯å¯¹ç¥ç»ç½‘ç»œçš„æ¨¡å‹å‚æ•°Î¸è¿›è¡Œä¼˜åŒ–ï¼Œä½¿å…¶æœ€å°åŒ–ã€‚è¿™é¢‡æœ‰ä¸€ç‚¹æ”»ä¸å®ˆçš„å‘³é“ï¼Œæœ‰äº†éšæœºæ‰°åŠ¨çš„åŠ å…¥ï¼Œæ ·æœ¬çš„lossè¦å°½å¯èƒ½å¤§ï¼Œè€Œè®­ç»ƒçš„æ¨¡å‹lossè¦å°½å¯èƒ½å°ï¼Œä»è€Œä½¿å¾—æ¨¡å‹æœ‰äº†æ›´å¼ºçš„é²æ£’æ€§ï¼Œé¿å…æ ·æœ¬çš„å°æ‰°åŠ¨å°±é€ æˆæ¨¡å‹æ¨ç†çš„ç»“æœåå·®ã€‚</p><h3 id="fgm">FGM</h3><p>FGMï¼ˆFast Gradient Methodï¼‰æ˜¯å¯¹æŠ—å­¦ä¹ çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå¯ä»¥ä¸FGSMï¼ˆFastGradient SignMethodï¼‰ä¸€èµ·è°ˆè®ºã€‚å¯¹äºéšæœºæ‰°åŠ¨Î”xï¼ŒFGMä¸FGSMçš„å®ç°å…¬å¼å¦‚ä¸‹ï¼š</p><p><span class="math display">\[FGSM: \Delta{x}=\epsilon\cdot Sign(g) \\FGM: \Delta{x}=\epsilon\cdot (g/||g||_{2}) \\å…¶ä¸­Signä¸ºæ•°å­¦å‡½æ•°ï¼Œ||g||_{2}ä¸ºgçš„L_{2}èŒƒæ•°ï¼Œg=\nabla_{x}L(x;y;\theta).\]</span></p><p>ä»ä¸Šé¢çš„å…¬å¼ä¸Šå¯ä»¥çœ‹å‡ºï¼Œå…¶å¢å¤§æ ·æœ¬lossçš„åŠæ³•æ˜¯ä½¿å¾—æ ·æœ¬xåœ¨æ¢¯åº¦æ–¹å‘å˜å¤§ã€‚</p><p>CVé¢†åŸŸä¸­ï¼Œä¸Šé¢çš„FGMå…¬å¼æ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œå› ä¸ºå›¾ç‰‡çš„å‘é‡è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ˜¯è¿ç»­çš„å®æ•°ï¼Œè€Œåœ¨NLPä¸­ï¼Œä¸€èˆ¬å­—æˆ–è¯çš„è¡¨ç¤ºä¸ºOne-hotå‘é‡ï¼Œä¸å¥½ç›´æ¥è¿›è¡Œæ ·æœ¬æ‰°åŠ¨ã€‚ä¸€ç§ç®€å•çš„æƒ³æ³•æ˜¯åœ¨wordEmbeddingå‘é‡çš„æ—¶å€™è¿›è¡Œæ‰°åŠ¨ã€‚Embeddingå±‚çš„è¾“å‡ºæ˜¯ç›´æ¥å–è‡ªäºEmbeddingå‚æ•°çŸ©é˜µçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹Embeddingå‚æ•°çŸ©é˜µè¿›è¡Œæ‰°åŠ¨ã€‚è¿™æ ·å¾—åˆ°çš„å¯¹æŠ—æ ·æœ¬çš„å¤šæ ·æ€§ä¼šå°‘ä¸€äº›ï¼ˆå› ä¸ºä¸åŒæ ·æœ¬çš„åŒä¸€ä¸ªtokenå…±ç”¨äº†ç›¸åŒçš„æ‰°åŠ¨ï¼‰ï¼Œä½†ä»ç„¶èƒ½èµ·åˆ°æ­£åˆ™åŒ–çš„ä½œç”¨ï¼Œè€Œä¸”è¿™æ ·å®ç°èµ·æ¥å®¹æ˜“å¾—å¤šã€‚</p><p>æˆ‘ä»¬ä¸å¿…è‡ªå·±åŠ¨æ‰‹å»å®ç°ä¸Šè¿°çš„FGMï¼Œè‹å»ºæ—åœ¨bert4keraså·¥å…·ä¸­å·²ç»å®ç°äº†FGMçš„è„šæœ¬ï¼Œå¯ä»¥å‚è€ƒï¼š<ahref="https://github.com/bojone/keras_adversarial_training">https://github.com/bojone/keras_adversarial_training</a>ï¼Œè¿™æ˜¯Kerasæ¡†æ¶ä¸‹çš„å®ç°ã€‚è€Œç“¦ç‰¹å…°è’‚æ–¯åœ¨åšå®¢<ahref="https://fyubang.com/2019/10/15/adversarial-train/">ã€ç‚¼ä¸¹æŠ€å·§ã€‘åŠŸå®ˆé“ï¼šNLPä¸­çš„å¯¹æŠ—è®­ç»ƒ+PyTorchå®ç°</a>ä¸­ç»™å‡ºäº†Torchæ¡†æ¶ä¸‹çš„FGMå®ç°ã€‚ä¸¤è€…ä½¿ç”¨èµ·æ¥éƒ½éå¸¸æ–¹ä¾¿ã€‚</p><p>ä¸‹é¢å°†ä»‹ç»ç¬”è€…ä½¿ç”¨FGMåœ¨keras-bertæ¨¡å—ä¸­çš„å®éªŒã€‚</p><h3 id="å®éªŒç»“æœ">å®éªŒç»“æœ</h3><p>ç¬”è€…ä½¿ç”¨keras-bertæ¨¡å—å®ç°äº†å‘½åå®ä½“è¯†åˆ«ã€æ–‡æœ¬å¤šåˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡ï¼Œå¦‚ä¸‹ï¼š</p><ul><li><p><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a></p></li><li><p><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åäº”ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡</a></p></li><li><p><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå…­ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡</a></p><p>æˆ‘ä»¬å°†å¯¹æ¯”åœ¨åŒæ ·çš„æ¨¡å‹å‚æ•°ä¸‹ï¼Œç›¸åŒæ•°æ®é›†åœ¨ä½¿ç”¨FGMå‰åçš„æ¨¡å‹è¯„ä¼°æŒ‡æ ‡çš„å¯¹æ¯”ï¼š</p></li><li><p>äººæ°‘æ—¥æŠ¥å®ä½“è¯†åˆ«ä»»åŠ¡ï¼ˆè¯„ä¼°æŒ‡æ ‡ä¸ºmicro avg f1-scoreï¼‰</p></li></ul><table><thead><tr class="header"><th>-</th><th>è®­ç»ƒ1</th><th>è®­ç»ƒ2</th><th>è®­ç»ƒ3</th><th>avg</th></tr></thead><tbody><tr class="odd"><td>ä½¿ç”¨FGMå‰</td><td>0.9276</td><td>0.9217</td><td>0.9252</td><td>0.9248</td></tr><tr class="even"><td>ä½¿ç”¨FGMå</td><td>0.9287</td><td>0.9273</td><td>0.9294</td><td>0.9285</td></tr></tbody></table><ul><li>æ—¶é—´è¯†åˆ«ä»»åŠ¡ï¼ˆè¯„ä¼°æŒ‡æ ‡ä¸ºmicro avg f1-scoreï¼‰</li></ul><table><thead><tr class="header"><th>-</th><th>è®­ç»ƒ1</th><th>è®­ç»ƒ2</th><th>è®­ç»ƒ3</th><th>avg</th></tr></thead><tbody><tr class="odd"><td>ä½¿ç”¨FGMå‰</td><td>0.8926</td><td>0.8934</td><td>0.8820</td><td>0.8893</td></tr><tr class="even"><td>ä½¿ç”¨FGMå</td><td>0.9037</td><td>0.8798</td><td>0.8911</td><td>0.8915</td></tr></tbody></table><ul><li>æœç‹—æ•°æ®é›†æ–‡æœ¬å¤šåˆ†ç±»æ¨¡å‹ï¼ˆè¯„ä¼°æŒ‡æ ‡ä¸ºmicro avg f1-scoreï¼‰</li></ul><table><thead><tr class="header"><th>-</th><th>è®­ç»ƒ1</th><th>è®­ç»ƒ2</th><th>è®­ç»ƒ3</th><th>avg</th></tr></thead><tbody><tr class="odd"><td>ä½¿ç”¨FGMå‰</td><td>0.9778</td><td>0.9697</td><td>0.9657</td><td>0.9711</td></tr><tr class="even"><td>ä½¿ç”¨FGMå</td><td>0.9778</td><td>0.9838</td><td>0.9838</td><td>0.9818</td></tr></tbody></table><ul><li>THUCNewsæ•°æ®é›†æ–‡æœ¬å¤šåˆ†ç±»æ¨¡å‹ï¼ˆè¯„ä¼°æŒ‡æ ‡ä¸ºmicro avg f1-scoreï¼‰</li></ul><table><thead><tr class="header"><th>-</th><th>è®­ç»ƒ1</th><th>è®­ç»ƒ2</th><th>è®­ç»ƒ3</th><th>avg</th></tr></thead><tbody><tr class="odd"><td>ä½¿ç”¨FGMå‰</td><td>0.9524</td><td>0.9621</td><td>0.9685</td><td>0.961</td></tr><tr class="even"><td>ä½¿ç”¨FGMå</td><td>0.9689</td><td>0.9723</td><td>0.9712</td><td>0.9708</td></tr></tbody></table><ul><li>äº‹ä»¶ç±»å‹æ–‡æœ¬å¤šæ ‡ç­¾æ¨¡å‹ï¼ˆè¯„ä¼°æŒ‡æ ‡ä¸ºaccuracyï¼‰</li></ul><table><thead><tr class="header"><th>-</th><th>è®­ç»ƒ1</th><th>è®­ç»ƒ2</th><th>è®­ç»ƒ3</th><th>avg</th></tr></thead><tbody><tr class="odd"><td>ä½¿ç”¨FGMå‰</td><td>0.8985</td><td>-</td><td>-</td><td>-</td></tr><tr class="even"><td>ä½¿ç”¨FGMå</td><td>0.9159</td><td>0.9192</td><td>0.9186</td><td>0.9179</td></tr></tbody></table><p>ä»¥ä¸Šå¯¹æ¯”ç»“æœå·²ç»ä¸Šä¼ è‡³Githubï¼Œç½‘å€å¦‚ä¸‹ï¼š</p><ul><li><p>å‘½åå®ä½“è¯†åˆ«ï¼š<ahref="https://github.com/percent4/keras_bert_sequence_labeling">https://github.com/percent4/keras_bert_sequence_labeling</a></p></li><li><p>æ–‡æœ¬å¤šåˆ†ç±»ï¼š<ahref="https://github.com/percent4/keras_bert_text_classification">https://github.com/percent4/keras_bert_text_classification</a></p></li><li><p>æ–‡æœ¬å¤šæ ‡ç­¾æ–‡æœ¬ï¼š<ahref="https://github.com/percent4/keras_bert_multi_label_cls">https://github.com/percent4/keras_bert_multi_label_cls</a></p><p>æ€»ç»“ç»éªŒä¸ºï¼š</p></li></ul><ol type="1"><li>å¯¹æŠ—è®­ç»ƒFGMåœ¨å¾ˆå¤šNLPä»»åŠ¡ä¸­å¯ä»¥æœ‰æ•ˆæå‡æ¨¡å‹æ•ˆæœï¼Œä½†ä»£ä»·æ˜¯è®­ç»ƒæ—¶é—´å˜é•¿ï¼Œä¸€èˆ¬æ˜¯åŸæ¥çš„1.5~2å€ã€‚</li><li>FGMä¸€èˆ¬åœ¨å°æ ·æœ¬æ•°æ®é›†ä¸Šçš„æå‡æ•ˆæœè¾ƒä¸ºæ˜æ˜¾ã€‚</li><li>FGMå¹¶ä¸ä¸€å®šæ€»æ˜¯èƒ½æå‡æ¨¡å‹æ•ˆæœï¼Œæ¯”å¦‚ç¬”è€…ä½¿ç”¨R-BERTåœ¨äººç‰©å…³ç³»åˆ†ç±»æ•°æ®é›†ä¸Šï¼Œä½¿ç”¨FGMçš„æ•ˆæœåè€Œå˜å·®äº†ã€‚</li></ol><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¯¹æŠ—è®­ç»ƒçš„æ¦‚å¿µï¼Œä»¥åŠFGMå®ç°æ–¹å¼å’Œå®ƒåœ¨ä¸åŒNLPä»»åŠ¡ä¸Šçš„æ¨¡å‹æ•ˆæœå¯¹æ¯”ã€‚</p><p>æœ€è¿‘ç¬”è€…åœ¨ä½¿ç”¨keras bertå®ç°å¤šé¡¹é€‰æ‹©é˜…è¯»ç†è§£ä»»åŠ¡ï¼Œä½†kerasbertæ¯”è¾ƒåƒæ˜¾å­˜ï¼Œè€Œä¸”æ¨¡å‹ç»“æ„å†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦ä¸”æ•ˆæœæœ‰ç‚¹å„¿å‡ºå…¥ã€‚è€Œç”¨PyTorchå®ç°çš„transformersæ¨¡å—ï¼Œä½¿ç”¨æ–¹ä¾¿è€Œä¸”æ•ˆæœä¹Ÿå¥½ï¼Œä¸å¾—ä¸è¯´ï¼ŒTorchçœŸé¦™ï¼è¿™å¹¶ä¸æ˜¯è¯´Kerasä¸è¡Œï¼Œè€Œæ˜¯Torchç¡®å®ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚è¿™åªæ˜¯æˆ‘ç°åœ¨çš„ä½“ä¼šï¼Œä¸å¿…è¿‡äºè¾ƒçœŸã€‚</p><p>æ„Ÿè°¢å¤§å®¶é˜…è¯»~</p><p>2021å¹´4æœˆ14æ—¥æ·±å¤œäºä¸Šæµ·æµ¦ä¸œï¼Œæ­¤æ—¥ä¸Šæµ·å¤©è‰²é˜´æ²‰~</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>å¯¹æŠ—è®­ç»ƒæµ…è°ˆï¼šæ„ä¹‰ã€æ–¹æ³•å’Œæ€è€ƒï¼ˆé™„Keraså®ç°ï¼‰: <ahref="https://spaces.ac.cn/archives/7234">https://spaces.ac.cn/archives/7234</a></li><li>ã€ç‚¼ä¸¹æŠ€å·§ã€‘åŠŸå®ˆé“ï¼šNLPä¸­çš„å¯¹æŠ—è®­ç»ƒ + PyTorchå®ç°: <ahref="https://fyubang.com/2019/10/15/adversarial-train/">https://fyubang.com/2019/10/15/adversarial-train/</a></li><li>è®ºæ–‡é˜…è¯»ï¼šå¯¹æŠ—è®­ç»ƒï¼ˆadversarial trainingï¼‰: <ahref="https://zhuanlan.zhihu.com/p/104040055">https://zhuanlan.zhihu.com/p/104040055</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>å¯¹æŠ—è®­ç»ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åäº”ï¼‰R-BERTåœ¨äººç‰©å…³ç³»åˆ†ç±»ä¸Šçš„å°è¯•åŠKerasä»£ç å¤ç°</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%94%EF%BC%89R-BERT%E5%9C%A8%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E4%B8%8A%E7%9A%84%E5%B0%9D%E8%AF%95%E5%8F%8AKeras%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%8E%B0/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%94%EF%BC%89R-BERT%E5%9C%A8%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E4%B8%8A%E7%9A%84%E5%B0%9D%E8%AF%95%E5%8F%8AKeras%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä»‹ç»å…³ç³»åˆ†ç±»æ¨¡å‹<code>R-BERT</code>å’Œè¯¥æ¨¡å‹åœ¨äººç‰©å…³ç³»æ•°æ®é›†ä¸Šçš„è¡¨ç°ï¼Œä»¥åŠè¯¥æ¨¡å‹çš„Kerasä»£ç å¤ç°ã€‚</p><h3 id="å…³ç³»åˆ†ç±»ä»»åŠ¡">å…³ç³»åˆ†ç±»ä»»åŠ¡</h3><p>å…³ç³»åˆ†ç±»å±äºNLPä»»åŠ¡ä¸­çš„æ–‡æœ¬åˆ†ç±»ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œå…³ç³»åˆ†ç±»æä¾›äº†æ–‡æœ¬å’Œå®ä½“ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><blockquote><p>äº²æˆš1837å¹´6æœˆ20æ—¥ï¼Œ<e1>å¨å»‰å››ä¸–</e1>è¾ä¸–ï¼Œä»–çš„ä¾„å¥³<e2>ç»´å¤šåˆ©äºš</e2>å³ä½ã€‚</p></blockquote><p>å…¶ä¸­ä¸¤ä¸ªå®ä½“åœ¨æ–‡æœ¬ä¸­ç”¨<e1></e1>å’Œ<e2></e2>åŒ…å›´ç€ï¼Œäººç‰©å…³ç³»ä¸ºäº²æˆšã€‚</p><p>åœ¨å…³ç³»åˆ†ç±»ä¸­ï¼Œæˆ‘ä»¬è¦æ³¨é‡æ–‡æœ¬ç‰¹å¾ï¼Œæ›´è¦ç•™æ„å®ä½“ç‰¹å¾ã€‚å¸¸è§çš„è‹±æ–‡å…³ç³»åˆ†ç±»çš„æ•°æ®é›†ä¸º<ahref="https://www.aclweb.org/anthology/S18-1117.pdf">SemEval 2010 Task8</a>ã€New York Times Corpusã€WikiData dataset for Sentential RelationExtractionã€NYT29ã€NYT24ç­‰ï¼Œä¸­æ–‡çš„å…³ç³»åˆ†ç±»æ•°æ®é›†æ¯”è¾ƒå°‘ï¼Œè€Œä¸”è´¨é‡ä¸é«˜ã€‚</p><p>å…³äºSemEval 2010 Task8æ•°æ®é›†çš„å®ç°æ¨¡å‹åŠæ•ˆæœï¼Œå¯ä»¥å‚è€ƒï¼šhttp://nlpprogress.com/english/relationship_extraction.html,å…¶ä¸­å¸¸è§çš„å®ç°æ¨¡å‹å¦‚ä¸‹ï¼š</p><ul><li><p>Machince Learning: SVM, Word2Vec ...</p></li><li><p>Dependency Models: BRCNN, DRNN ...</p></li><li><p>CNN-based Models: Multi-Attention CNN, Attention CNN, PCNN+ATT...</p></li><li><p>BERT-based Models: R-BERT, Matching-the-Blanks ...</p><p>æœ¬æ–‡å°†ä»‹ç»<code>R-BERT</code>æ¨¡å‹ã€‚</p></li></ul><h3 id="æ¨¡å‹ä»‹ç»">æ¨¡å‹ä»‹ç»</h3><p><code>R-BERT</code>æ¨¡å‹æ˜¯Alibaba Group (U.S.)Incçš„ä¸¤ä½ç ”ç©¶è€…åœ¨2019å¹´5æœˆçš„è®ºæ–‡<ahref="https://arxiv.org/pdf/1905.08284.pdf">Enriching Pre-trainedLanguage Model with Entity Information for RelationClassification</a>ï¼Œè¯¥æ¨¡å‹åœ¨SemEval 2010 Task8æ•°æ®é›†ä¸Šçš„F1å€¼ä¸º89.25%ï¼Œåªæ¯”ç°æœ‰çš„SOTAæ¨¡å‹ä½äº†0.25%ã€‚</p><p><code>R-BERT</code>å¾ˆå¥½åœ°èåˆäº†æ–‡æœ¬ç‰¹å¾ä»¥åŠä¸¤ä¸ªå®ä½“åœ¨æ–‡æœ¬ä¸­çš„ç‰¹å¾ï¼Œç®€å•æ¥è¯´ï¼Œè¯¥æ¨¡å‹ä¸»è¦æ˜¯BERTæ¨¡å‹ä¸­çš„ä¸‰ä¸ªå‘é‡çš„èåˆï¼š</p><ul><li><p>[CLS]å¯¹åº”çš„å‘é‡</p></li><li><p>å®ä½“1çš„å¹³å‡å‘é‡</p></li><li><p>å®ä½“2çš„å¹³å‡å‘é‡</p><p>ä¸‹é¢å°†è¯¦ç»†è®²è§£<code>R-BERT</code>çš„å…·ä½“æ¨¡å‹ç»“æ„ã€‚</p></li></ul><h3 id="æ¨¡å‹ç»“æ„">æ¨¡å‹ç»“æ„</h3><p><code>R-BERT</code>çš„å…·ä½“æ¨¡å‹ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp45_1.png" alt="R-BERTæ¨¡å‹ç»“æ„å›¾" /><figcaption aria-hidden="true">R-BERTæ¨¡å‹ç»“æ„å›¾</figcaption></figure><p>ä¸€å›¾èƒœåƒè¨€ã€‚ä»ä¸Šè¿°çš„æ¨¡å‹ç»“æ„å›¾ä¸­ï¼Œæˆ‘ä»¬å°†æ¨¡å‹ç»“æ„åˆ†è§£æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol type="1"><li>å°†æ–‡æœ¬æ¥å…¥BERTæ¨¡å‹ï¼Œè·å–[CLS]tokençš„å¯¹åº”å‘é‡ã€å®ä½“1çš„åœ¨BERTè¾“å‡ºå±‚ä¸­çš„å¹³å‡å‘é‡ã€å®ä½“2çš„åœ¨BERTè¾“å‡ºå±‚ä¸­çš„å¹³å‡å‘é‡ï¼›</li><li>å°†ä¸Šè¿°ä¸‰ä¸ªå‘é‡åˆ†åˆ«æ¥Drouputå±‚ã€Tanhæ¿€æ´»å±‚ä»¥åŠå…¨è¿æ¥å±‚ï¼›</li><li>å†å°†æ­¥éª¤2è¾“å‡ºçš„ä¸‰ä¸ªå‘é‡è¿›è¡Œæ‹¼æ¥ï¼ˆconcatenateï¼‰ï¼›</li><li>æœ€åæ¥Dropoutå±‚å’Œå…¨è¿æ¥å±‚ï¼Œç”¨Softmaxä½œä¸ºå¤šåˆ†ç±»çš„æ¿€æ´»å‡½æ•°ã€‚</li></ol><p>æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥æ–‡æœ¬ä¸­æ²¡æœ‰[SEP]è¿™ä¸ªtokenã€‚</p><p>è®ºæ–‡ä¸­å¹¶æ²¡æœ‰ç»™å‡ºæ›´å¤šçš„å®ç°ç»†èŠ‚ï¼Œéœ€è¦æ·±å…¥åˆ°ä»£ç ä¸­å»æŸ¥çœ‹ã€‚ç½‘ä¸Šå·²ç»æœ‰äººç»™å‡ºäº†Torchæ¡†æ¶çš„å®ç°<code>R-BERT</code>çš„ä»£ç ï¼Œå‚è€ƒç½‘å€ä¸ºï¼šhttps://github.com/monologg/R-BERTã€‚</p><h3 id="torchå®ç°">Torchå®ç°</h3><p>Torchæ¡†æ¶çš„å®ç°<code>R-BERT</code>çš„ä»£ç ï¼ˆæ¨¡å‹éƒ¨åˆ†ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BertModel, BertPreTrainedModel<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FCLayer</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, input_dim, output_dim, dropout_rate=<span class="hljs-number">0.0</span>, use_activation=<span class="hljs-literal">True</span></span>):<br>        <span class="hljs-built_in">super</span>(FCLayer, self).__init__()<br>        self.use_activation = use_activation<br>        self.dropout = nn.Dropout(dropout_rate)<br>        self.linear = nn.Linear(input_dim, output_dim)<br>        self.tanh = nn.Tanh()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.dropout(x)<br>        <span class="hljs-keyword">if</span> self.use_activation:<br>            x = self.tanh(x)<br>        <span class="hljs-keyword">return</span> self.linear(x)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RBERT</span>(<span class="hljs-title class_ inherited__">BertPreTrainedModel</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config, args</span>):<br>        <span class="hljs-built_in">super</span>(RBERT, self).__init__(config)<br>        self.bert = BertModel(config=config)  <span class="hljs-comment"># Load pretrained bert</span><br><br>        self.num_labels = config.num_labels<br><br>        self.cls_fc_layer = FCLayer(config.hidden_size, config.hidden_size, args.dropout_rate)<br>        self.entity_fc_layer = FCLayer(config.hidden_size, config.hidden_size, args.dropout_rate)<br>        self.label_classifier = FCLayer(<br>            config.hidden_size * <span class="hljs-number">3</span>,<br>            config.num_labels,<br>            args.dropout_rate,<br>            use_activation=<span class="hljs-literal">False</span>,<br>        )<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">entity_average</span>(<span class="hljs-params">hidden_output, e_mask</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Average the entity hidden state vectors (H_i ~ H_j)</span><br><span class="hljs-string">        :param hidden_output: [batch_size, j-i+1, dim]</span><br><span class="hljs-string">        :param e_mask: [batch_size, max_seq_len]</span><br><span class="hljs-string">                e.g. e_mask[0] == [0, 0, 0, 1, 1, 1, 0, 0, ... 0]</span><br><span class="hljs-string">        :return: [batch_size, dim]</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        e_mask_unsqueeze = e_mask.unsqueeze(<span class="hljs-number">1</span>)  <span class="hljs-comment"># [b, 1, j-i+1]</span><br>        length_tensor = (e_mask != <span class="hljs-number">0</span>).<span class="hljs-built_in">sum</span>(dim=<span class="hljs-number">1</span>).unsqueeze(<span class="hljs-number">1</span>)  <span class="hljs-comment"># [batch_size, 1]</span><br><br>        <span class="hljs-comment"># [b, 1, j-i+1] * [b, j-i+1, dim] = [b, 1, dim] -&gt; [b, dim]</span><br>        sum_vector = torch.bmm(e_mask_unsqueeze.<span class="hljs-built_in">float</span>(), hidden_output).squeeze(<span class="hljs-number">1</span>)<br>        avg_vector = sum_vector.<span class="hljs-built_in">float</span>() / length_tensor.<span class="hljs-built_in">float</span>()  <span class="hljs-comment"># broadcasting</span><br>        <span class="hljs-keyword">return</span> avg_vector<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, input_ids, attention_mask, token_type_ids, labels, e1_mask, e2_mask</span>):<br>        outputs = self.bert(<br>            input_ids, attention_mask=attention_mask, token_type_ids=token_type_ids<br>        )  <span class="hljs-comment"># sequence_output, pooled_output, (hidden_states), (attentions)</span><br>        sequence_output = outputs[<span class="hljs-number">0</span>]<br>        pooled_output = outputs[<span class="hljs-number">1</span>]  <span class="hljs-comment"># [CLS]</span><br><br>        <span class="hljs-comment"># Average</span><br>        e1_h = self.entity_average(sequence_output, e1_mask)<br>        e2_h = self.entity_average(sequence_output, e2_mask)<br><br>        <span class="hljs-comment"># Dropout -&gt; tanh -&gt; fc_layer (Share FC layer for e1 and e2)</span><br>        pooled_output = self.cls_fc_layer(pooled_output)<br>        e1_h = self.entity_fc_layer(e1_h)<br>        e2_h = self.entity_fc_layer(e2_h)<br><br>        <span class="hljs-comment"># Concat -&gt; fc_layer</span><br>        concat_h = torch.cat([pooled_output, e1_h, e2_h], dim=-<span class="hljs-number">1</span>)<br>        logits = self.label_classifier(concat_h)<br><br>        outputs = (logits,) + outputs[<span class="hljs-number">2</span>:]  <span class="hljs-comment"># add hidden states and attention if they are here</span><br><br>        <span class="hljs-comment"># Softmax</span><br>        <span class="hljs-keyword">if</span> labels <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">if</span> self.num_labels == <span class="hljs-number">1</span>:<br>                loss_fct = nn.MSELoss()<br>                loss = loss_fct(logits.view(-<span class="hljs-number">1</span>), labels.view(-<span class="hljs-number">1</span>))<br>            <span class="hljs-keyword">else</span>:<br>                loss_fct = nn.CrossEntropyLoss()<br>                loss = loss_fct(logits.view(-<span class="hljs-number">1</span>, self.num_labels), labels.view(-<span class="hljs-number">1</span>))<br><br>            outputs = (loss,) + outputs<br><br>        <span class="hljs-keyword">return</span> outputs<br></code></pre></td></tr></table></figure><p>è¯¥é¡¹ç›®æ˜¯åœ¨SemEval 2010 Task8æ•°æ®é›†å®ç°çš„ï¼Œç¬”è€…å°†å…¶åœ¨è‡ªå·±çš„äººç‰©å…³ç³»åˆ†ç±»æ•°æ®é›†ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæœ€ç»ˆåœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-attr"># Model: chinese-roberta-wwm-ext, weighted avgage F1</span> = <span class="hljs-number">85.35</span><span class="hljs-meta">%</span><br><span class="hljs-attr"># Model: chinese-roberta-wwm-ext-large, weighted avgage F1</span> = <span class="hljs-number">87.22</span><span class="hljs-meta">%</span><br></code></pre></td></tr></table></figure><p>Model: chinese-roberta-wwm-ext-large, è¯¦ç»†çš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs crystal">                precision    recall  f1-score   support<br><br>     unknown      <span class="hljs-number">0.8756</span>    <span class="hljs-number">0.8421</span>    <span class="hljs-number">0.8585</span>       <span class="hljs-number">209</span><br>         ä¸Šä¸‹çº§    <span class="hljs-number">0.7297</span>    <span class="hljs-number">0.8710</span>    <span class="hljs-number">0.7941</span>        <span class="hljs-number">31</span><br>          äº²æˆš     <span class="hljs-number">0.8421</span>    <span class="hljs-number">0.6667</span>    <span class="hljs-number">0.7442</span>        <span class="hljs-number">24</span><br>        å…„å¼Ÿå§å¦¹    <span class="hljs-number">0.8333</span>    <span class="hljs-number">0.8824</span>    <span class="hljs-number">0.8571</span>        <span class="hljs-number">34</span><br>          åˆä½œ     <span class="hljs-number">0.9074</span>    <span class="hljs-number">0.8305</span>    <span class="hljs-number">0.8673</span>        <span class="hljs-number">59</span><br>          åŒäºº     <span class="hljs-number">0.9744</span>    <span class="hljs-number">0.9744</span>    <span class="hljs-number">0.9744</span>        <span class="hljs-number">39</span><br>          åŒå­¦     <span class="hljs-number">0.9130</span>    <span class="hljs-number">0.8750</span>    <span class="hljs-number">0.8936</span>        <span class="hljs-number">24</span><br>          åŒé—¨     <span class="hljs-number">0.9630</span>    <span class="hljs-number">1.0000</span>    <span class="hljs-number">0.9811</span>        <span class="hljs-number">26</span><br>          å¤«å¦»     <span class="hljs-number">0.8372</span>    <span class="hljs-number">0.9114</span>    <span class="hljs-number">0.8727</span>        <span class="hljs-number">79</span><br>          å¥½å‹     <span class="hljs-number">0.8438</span>    <span class="hljs-number">0.9000</span>    <span class="hljs-number">0.8710</span>        <span class="hljs-number">30</span><br>          å¸ˆç”Ÿ     <span class="hljs-number">0.8378</span>    <span class="hljs-number">0.8378</span>    <span class="hljs-number">0.8378</span>        <span class="hljs-number">37</span><br>          æƒ…ä¾£     <span class="hljs-number">0.8125</span>    <span class="hljs-number">0.8387</span>    <span class="hljs-number">0.8254</span>        <span class="hljs-number">31</span><br>          çˆ¶æ¯     <span class="hljs-number">0.8931</span>    <span class="hljs-number">0.9141</span>    <span class="hljs-number">0.9035</span>       <span class="hljs-number">128</span><br>          ç¥–å­™     <span class="hljs-number">0.9545</span>    <span class="hljs-number">0.8400</span>    <span class="hljs-number">0.8936</span>        <span class="hljs-number">25</span><br><br>    accuracy                         <span class="hljs-number">0.8724</span>       <span class="hljs-number">776</span><br>   <span class="hljs-function"><span class="hljs-keyword">macro</span> <span class="hljs-title">avg</span></span>     <span class="hljs-number">0.8727</span>    <span class="hljs-number">0.8703</span>    <span class="hljs-number">0.8696</span>       <span class="hljs-number">776</span><br>weighted avg     <span class="hljs-number">0.8743</span>    <span class="hljs-number">0.8724</span>    <span class="hljs-number">0.8722</span>       <span class="hljs-number">776</span><br></code></pre></td></tr></table></figure><p><code>R-BERT</code>æ¨¡å‹åœ¨äººç‰©å…³ç³»æ•°æ®é›†ä¸Šçš„Githubé¡¹ç›®ä¸º<ahref="https://github.com/percent4/R-BERT_for_people_relation_extraction">R-BERT_for_people_relation_extraction</a>ã€‚ä¸‹é¢å°†ä»‹ç»<code>R-BERT</code>æ¨¡å‹çš„Kerasæ¡†æ¶å¤ç°ã€‚</p><h3 id="keraså¤ç°">Keraså¤ç°</h3><p><code>R-BERT</code>æ¨¡å‹çš„Kerasæ¡†æ¶å¤ç°ï¼ˆæ¨¡å‹éƒ¨åˆ†ï¼‰çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># main architecture of R-BERT</span><br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> plot_model<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Input, Lambda, Dense, Dropout, concatenate, Dot<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> load_trained_model_from_checkpoint<br><br><br><span class="hljs-comment"># model structure of R-BERT</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RBERT</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config_path, checkpoint_path, maxlen, num_labels</span>):<br>        self.config_path = config_path<br>        self.checkpoint_path = checkpoint_path<br>        self.maxlen = maxlen<br>        self.num_labels = num_labels<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_model</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># BERT model</span><br>        bert_model = load_trained_model_from_checkpoint(self.config_path, self.checkpoint_path, seq_len=<span class="hljs-literal">None</span>)<br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> bert_model.layers:<br>            layer.trainable = <span class="hljs-literal">True</span><br>        x1_in = Input(shape=(self.maxlen,))<br>        x2_in = Input(shape=(self.maxlen,))<br>        bert_layer = bert_model([x1_in, x2_in])<br><br>        <span class="hljs-comment"># get three vectors</span><br>        cls_layer = Lambda(<span class="hljs-keyword">lambda</span> x: x[:, <span class="hljs-number">0</span>])(bert_layer)    <span class="hljs-comment"># å–å‡º[CLS]å¯¹åº”çš„å‘é‡</span><br>        e1_mask = Input(shape=(self.maxlen,))<br>        e2_mask = Input(shape=(self.maxlen,))<br>        e1_layer = self.entity_average(bert_layer, e1_mask)  <span class="hljs-comment"># å–å‡ºå®ä½“1å¯¹åº”çš„å‘é‡</span><br>        e2_layer = self.entity_average(bert_layer, e2_mask)  <span class="hljs-comment"># å–å‡ºå®ä½“2å¯¹åº”çš„å‘é‡</span><br><br>        <span class="hljs-comment"># dropout -&gt; linear -&gt; concatenate</span><br>        output_dim = cls_layer.shape[-<span class="hljs-number">1</span>].value<br>        cls_fc_layer = self.crate_fc_layer(cls_layer, output_dim, dropout_rate=<span class="hljs-number">0.1</span>)<br>        e1_fc_layer = self.crate_fc_layer(e1_layer, output_dim, dropout_rate=<span class="hljs-number">0.1</span>)<br>        e2_fc_layer = self.crate_fc_layer(e2_layer, output_dim, dropout_rate=<span class="hljs-number">0.1</span>)<br>        concat_layer = concatenate([cls_fc_layer, e1_fc_layer, e2_fc_layer], axis=-<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># FC layer for classification</span><br>        output = Dense(self.num_labels, activation=<span class="hljs-string">&quot;softmax&quot;</span>)(concat_layer)<br>        model = Model([x1_in, x2_in, e1_mask, e2_mask], output)<br>        model.summary()<br>        <span class="hljs-keyword">return</span> model<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">crate_fc_layer</span>(<span class="hljs-params">input_layer, output_dim, dropout_rate=<span class="hljs-number">0.0</span>, activation_func=<span class="hljs-string">&quot;tanh&quot;</span></span>):<br>        dropout_layer = Dropout(rate=dropout_rate)(input_layer)<br>        linear_layer = Dense(output_dim, activation=activation_func)(dropout_layer)<br>        <span class="hljs-keyword">return</span> linear_layer<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">entity_average</span>(<span class="hljs-params">hidden_output, e_mask</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Average the entity hidden state vectors (H_i ~ H_j)</span><br><span class="hljs-string">        :param hidden_output: BERT hidden output</span><br><span class="hljs-string">        :param e_mask:</span><br><span class="hljs-string">                e.g. e_mask[0] == [0, 0, 0, 1, 1, 1, 0, 0, ... 0]/num_of_ones</span><br><span class="hljs-string">        :return: entity average layer</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        avg_layer = Dot(axes=<span class="hljs-number">1</span>)([e_mask, hidden_output])<br>        <span class="hljs-keyword">return</span> avg_layer<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p><code>R-BERT</code>æ¨¡å‹å†æ¬¡è§è¯äº†BERTç­‰é¢„è®­ç»ƒæ¨¡å‹çš„å¼ºå¤§ã€‚è¯¥æ¨¡å‹çš„å®ç°æ€è·¯æ¯”è¾ƒç®€å•ï¼Œä¹Ÿå–å¾—äº†å¾ˆä¸é”™çš„æ•ˆæœï¼Œæ˜¯å…³ç³»åˆ†ç±»ä»»åŠ¡çš„ä¸€å¤§çªç ´ã€‚</p><p>å½“ç„¶å¯¹ç¬”è€…æ¥è¯´ï¼Œä¹Ÿæœ‰ç§é‡è¦çš„æ„ä¹‰ï¼šç¬¬ä¸€æ¬¡è‡ªå·±å¤ç°äº†è®ºæ–‡ä»£ç ï¼Œè™½ç„¶æœ‰Torchä»£ç å¯ä»¥å‚è€ƒã€‚</p><p>æœ¬æ–‡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»~</p><p>2021å¹´4æœˆ1æ—¥äºä¸Šæµ·æ¨æµ¦ï¼Œæ­¤æ—¥å¤§é›¾è¿·åŸ~</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ul><li>NLP-progress Relation Extraction:http://nlpprogress.com/english/relationship_extraction.html</li><li>Huggingface Transformers:https://github.com/huggingface/transformers</li><li>https://github.com/wang-h/bert-relation-classification</li><li>R-BERT: https://github.com/monologg/R-BERT</li><li>Enriching Pre-trained Language Model with Entity Information forRelation Classification: https://arxiv.org/pdf/1905.08284.pdf</li><li>Chinese-BERT-wwm: https://github.com/ymcui/Chinese-BERT-wwm</li></ul>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>BERT</tag>
      
      <tag>NLP</tag>
      
      <tag>å…³ç³»åˆ†ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åå››ï¼‰ä½¿ç”¨keras-bertåŠ è½½BERTæ¨¡å‹çš„ä¸¤ç§æ–¹æ³•</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%8A%A0%E8%BD%BDBERT%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%8A%A0%E8%BD%BDBERT%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>keras-bert</code>æ˜¯Kerasæ¡†æ¶åŠ è½½BERTæ¨¡å‹çš„Pythonç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œç¬”è€…ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨<code>keras-bret</code>æ¥å®ç°ä¸åŒçš„NLPä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š</p><ul><li><p><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a></p></li><li><p><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åäº”ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡</a></p></li><li><p><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå…­ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡</a></p></li><li><p><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B8%83%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E8%8B%B1%E8%AF%AD%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åä¸ƒï¼‰ä½¿ç”¨keras-bertå®ç°è‹±è¯­åºåˆ—æ ‡æ³¨ä»»åŠ¡</a></p></li><li><p><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%AE%8C%E5%BD%A2%E5%A1%AB%E7%A9%BA%E5%8F%8A%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99%E5%8A%9F%E8%83%BD/">NLPï¼ˆä¸‰åä¹ï¼‰ä½¿ç”¨keras-bertå®ç°å®Œå½¢å¡«ç©ºåŠç®€å•çš„æ–‡æœ¬çº é”™åŠŸèƒ½</a></p></li><li><p><ahref="https://blog.csdn.net/jclian91/article/details/115219543">NLPï¼ˆå››åäºŒï¼‰äººç‰©å…³ç³»åˆ†ç±»çš„å†æ¬¡å°è¯•</a></p><p>æœ¬æ–‡å°†ä»‹ç»ä¸¤ç§ä½¿ç”¨<code>keras-bert</code>åŠ è½½BERTæ¨¡å‹çš„æ–¹æ³•ã€‚ä½¿ç”¨çš„Pythonç¯å¢ƒå¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">python==3.7.0<br>tensorflow==1.14.0<br>Keras==2.2.4<br>keras-bert==0.83.0<br></code></pre></td></tr></table></figure><p>åŠ è½½çš„æ¨¡å‹ä¸ºGoogleå®˜æ–¹å‘å¸ƒçš„BERTä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹ã€‚åˆ›å»ºçš„æ¨¡å‹ä¸º<code>BERT+Bi-LSTM+CRF</code>ï¼Œå…¶ä¸­å¯¹BERTè¿›è¡Œå¾®è°ƒã€‚</p><h3 id="æ–¹æ³•1">æ–¹æ³•1</h3><p>æ–¹æ³•1çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> plot_model<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> load_trained_model_from_checkpoint<br><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><br><br><span class="hljs-comment"># åˆ›å»ºBERT-BiLSTM-CRFæ¨¡å‹</span><br>model_path = <span class="hljs-string">&quot;./chinese_L-12_H-768_A-12/&quot;</span><br>bert = load_trained_model_from_checkpoint(<br>    model_path + <span class="hljs-string">&quot;bert_config.json&quot;</span>,<br>    model_path + <span class="hljs-string">&quot;bert_model.ckpt&quot;</span>,<br>    seq_len=<span class="hljs-number">128</span><br>)<br><span class="hljs-comment"># make bert layer trainable</span><br><span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> bert.layers:<br>    layer.trainable = <span class="hljs-literal">True</span><br><br>x1 = Input(shape=(<span class="hljs-literal">None</span>,))<br>x2 = Input(shape=(<span class="hljs-literal">None</span>,))<br>bert_out = bert([x1, x2])<br>lstm_out = Bidirectional(LSTM(<span class="hljs-number">64</span>,<br>                              return_sequences=<span class="hljs-literal">True</span>,<br>                              dropout=<span class="hljs-number">0.2</span>,<br>                              recurrent_dropout=<span class="hljs-number">0.2</span>))(bert_out)<br>crf_out = CRF(<span class="hljs-number">8</span>, sparse_target=<span class="hljs-literal">True</span>)(lstm_out)<br>model = Model([x1, x2], crf_out)<br>model.summary()<br>plot_model(model, to_file=<span class="hljs-string">&quot;model.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„æ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br><span class="hljs-section">Layer (type)                    Output Shape         Param #     Connected to                     </span><br><span class="hljs-section">==================================================================================================</span><br>input<span class="hljs-emphasis">_1 (InputLayer)            (None, None)         0                                            </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span>_<br>input<span class="hljs-emphasis">_2 (InputLayer)            (None, None)         0                                            </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span>_<br>model<span class="hljs-emphasis">_2 (Model)                 multiple             101382144   input_</span>1[<span class="hljs-string">0</span>][<span class="hljs-symbol">0</span>]                    <br><span class="hljs-code">                                                                 input_2[0][0]                    </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">bidirectional_1 (Bidirectional) (None, None, 128)    426496      model_2[1][0]                    </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">crf_1 (CRF)                     (None, None, 8)      1112        bidirectional_1[0][0]            </span><br><span class="hljs-code">==================================================================================================</span><br><span class="hljs-code">Total params: 101,809,752</span><br><span class="hljs-code">Trainable params: 101,809,752</span><br><span class="hljs-code">Non-trainable params: 0</span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br></code></pre></td></tr></table></figure><figure><img src="/img/nlp44_1.png" alt="æ¨¡å‹ç»“æ„ç¤ºæ„å›¾" /><figcaption aria-hidden="true">æ¨¡å‹ç»“æ„ç¤ºæ„å›¾</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–¹æ³•åŠ è½½BERTï¼Œä¼šæŠŠBERTæ¨¡å‹æ•´ä½“å½“åšä¸€ä¸ªè¾“å‡ºå½¢çŠ¶ä¸ºmultipleçš„å±‚ï¼Œæˆ‘ä»¬æ— æ³•å¾—çŸ¥BERTæ¨¡å‹çš„å…·ä½“å±‚ä¿¡æ¯ï¼Œå¥½å¤„æ˜¯æˆ‘ä»¬çš„æ¨¡å‹ç»“æ„ä¼šæ˜¾å¾—æ¯”è¾ƒç®€å•ï¼ˆç•¥å»äº†BERTçš„ç»†èŠ‚ï¼‰ã€‚</p><h3 id="æ–¹æ³•2">æ–¹æ³•2</h3><p>æ–¹æ³•2åŠ è½½BERTæ¨¡å‹çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> plot_model<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> load_trained_model_from_checkpoint<br><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><br><br><span class="hljs-comment"># åˆ›å»ºBERT-BiLSTM-CRFæ¨¡å‹</span><br>model_path = <span class="hljs-string">&quot;./chinese_L-12_H-768_A-12/&quot;</span><br>bert = load_trained_model_from_checkpoint(<br>    model_path + <span class="hljs-string">&quot;bert_config.json&quot;</span>,<br>    model_path + <span class="hljs-string">&quot;bert_model.ckpt&quot;</span>,<br>    seq_len=<span class="hljs-number">128</span><br>)<br><span class="hljs-comment"># make bert layer trainable</span><br><span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> bert.layers:<br>    layer.trainable = <span class="hljs-literal">True</span><br><br>lstm_out = Bidirectional(LSTM(<span class="hljs-number">64</span>,<br>                              return_sequences=<span class="hljs-literal">True</span>,<br>                              dropout=<span class="hljs-number">0.2</span>,<br>                              recurrent_dropout=<span class="hljs-number">0.2</span>))(bert.output)<br>crf_out = CRF(<span class="hljs-number">8</span>, sparse_target=<span class="hljs-literal">True</span>)(lstm_out)<br>model = Model(bert.<span class="hljs-built_in">input</span>, crf_out)<br>model.summary()<br>plot_model(model, to_file=<span class="hljs-string">&quot;model.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„æ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Layer (type)                    Output Shape         Param #     Connected to                     </span><br><span class="hljs-quote">==================================================================================================</span><br><span class="hljs-quote">Input-Token (InputLayer)        (None, 128)          0                                            </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Input-Segment (InputLayer)      (None, 128)          0                                            <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Embedding-Token (TokenEmbedding [(None, 128, 768), ( 16226304    Input-Token[0][0]                </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Embedding-Segment (Embedding)   (None, 128, 768)     1536        Input-Segment[0][0]              <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Embedding-Token-Segment (Add)   (None, 128, 768)     0           Embedding-Token[0][0]            </span><br><span class="hljs-quote">                                                                 Embedding-Segment[0][0]          </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Embedding-Position (PositionEmb (None, 128, 768)     98304       Embedding-Token-Segment[0][0]    <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Embedding-Dropout (Dropout)     (None, 128, 768)     0           Embedding-Position[0][0]         </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Embedding-Norm (LayerNormalizat (None, 128, 768)     1536        Embedding-Dropout[0][0]          <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-1-MultiHeadSelfAttentio (None, 128, 768)     2362368     Embedding-Norm[0][0]             </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-1-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-1-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-1-MultiHeadSelfAttentio (None, 128, 768)     0           Embedding-Norm[0][0]             </span><br><span class="hljs-quote">                                                                 Encoder-1-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-1-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-1-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-1-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-1-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-1-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-1-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-1-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-1-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-1-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-1-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-1-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-2-MultiHeadSelfAttentio (None, 128, 768)     2362368     Encoder-1-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-2-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-2-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-2-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-1-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-2-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-2-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-2-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-2-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-2-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-2-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-2-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-2-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-2-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-2-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-2-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-2-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-3-MultiHeadSelfAttentio (None, 128, 768)     2362368     Encoder-2-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-3-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-3-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-3-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-2-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-3-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-3-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-3-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-3-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-3-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-3-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-3-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-3-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-3-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-3-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-3-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-3-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-4-MultiHeadSelfAttentio (None, 128, 768)     2362368     Encoder-3-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-4-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-4-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-4-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-3-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-4-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-4-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-4-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-4-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-4-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-4-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-4-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-4-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-4-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-4-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-4-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-4-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-5-MultiHeadSelfAttentio (None, 128, 768)     2362368     Encoder-4-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-5-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-5-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-5-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-4-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-5-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-5-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-5-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-5-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-5-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-5-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-5-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-5-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-5-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-5-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-5-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-5-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-6-MultiHeadSelfAttentio (None, 128, 768)     2362368     Encoder-5-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-6-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-6-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-6-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-5-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-6-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-6-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-6-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-6-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-6-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-6-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-6-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-6-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-6-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-6-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-6-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-6-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-7-MultiHeadSelfAttentio (None, 128, 768)     2362368     Encoder-6-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-7-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-7-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-7-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-6-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-7-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-7-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-7-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-7-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-7-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-7-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-7-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-7-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-7-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-7-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-7-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-7-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-8-MultiHeadSelfAttentio (None, 128, 768)     2362368     Encoder-7-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-8-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-8-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-8-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-7-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-8-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-8-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-8-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-8-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-8-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-8-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-8-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-8-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-8-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-8-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-8-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-8-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-9-MultiHeadSelfAttentio (None, 128, 768)     2362368     Encoder-8-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-9-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-9-MultiHeadSelfAttention[<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-9-MultiHeadSelfAttentio (None, 128, 768)     0           Encoder-8-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-9-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-9-MultiHeadSelfAttentio (None, 128, 768)     1536        Encoder-9-MultiHeadSelfAttention-<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-9-FeedForward (FeedForw (None, 128, 768)     4722432     Encoder-9-MultiHeadSelfAttention-</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-9-FeedForward-Dropout ( (None, 128, 768)     0           Encoder-9-FeedForward[0][0]      <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-9-FeedForward-Add (Add) (None, 128, 768)     0           Encoder-9-MultiHeadSelfAttention-</span><br><span class="hljs-quote">                                                                 Encoder-9-FeedForward-Dropout[0][</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-9-FeedForward-Norm (Lay (None, 128, 768)     1536        Encoder-9-FeedForward-Add[0][0]  <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-10-MultiHeadSelfAttenti (None, 128, 768)     2362368     Encoder-9-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-10-MultiHeadSelfAttenti (None, 128, 768)     0           Encoder-10-MultiHeadSelfAttention<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-10-MultiHeadSelfAttenti (None, 128, 768)     0           Encoder-9-FeedForward-Norm[0][0] </span><br><span class="hljs-quote">                                                                 Encoder-10-MultiHeadSelfAttention</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-10-MultiHeadSelfAttenti (None, 128, 768)     1536        Encoder-10-MultiHeadSelfAttention<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-10-FeedForward (FeedFor (None, 128, 768)     4722432     Encoder-10-MultiHeadSelfAttention</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-10-FeedForward-Dropout  (None, 128, 768)     0           Encoder-10-FeedForward[0][0]     <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-10-FeedForward-Add (Add (None, 128, 768)     0           Encoder-10-MultiHeadSelfAttention</span><br><span class="hljs-quote">                                                                 Encoder-10-FeedForward-Dropout[0]</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-10-FeedForward-Norm (La (None, 128, 768)     1536        Encoder-10-FeedForward-Add[0][0] <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-11-MultiHeadSelfAttenti (None, 128, 768)     2362368     Encoder-10-FeedForward-Norm[0][0]</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-11-MultiHeadSelfAttenti (None, 128, 768)     0           Encoder-11-MultiHeadSelfAttention<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-11-MultiHeadSelfAttenti (None, 128, 768)     0           Encoder-10-FeedForward-Norm[0][0]</span><br><span class="hljs-quote">                                                                 Encoder-11-MultiHeadSelfAttention</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-11-MultiHeadSelfAttenti (None, 128, 768)     1536        Encoder-11-MultiHeadSelfAttention<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-11-FeedForward (FeedFor (None, 128, 768)     4722432     Encoder-11-MultiHeadSelfAttention</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-11-FeedForward-Dropout  (None, 128, 768)     0           Encoder-11-FeedForward[0][0]     <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-11-FeedForward-Add (Add (None, 128, 768)     0           Encoder-11-MultiHeadSelfAttention</span><br><span class="hljs-quote">                                                                 Encoder-11-FeedForward-Dropout[0]</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-11-FeedForward-Norm (La (None, 128, 768)     1536        Encoder-11-FeedForward-Add[0][0] <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-12-MultiHeadSelfAttenti (None, 128, 768)     2362368     Encoder-11-FeedForward-Norm[0][0]</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-12-MultiHeadSelfAttenti (None, 128, 768)     0           Encoder-12-MultiHeadSelfAttention<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-12-MultiHeadSelfAttenti (None, 128, 768)     0           Encoder-11-FeedForward-Norm[0][0]</span><br><span class="hljs-quote">                                                                 Encoder-12-MultiHeadSelfAttention</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-12-MultiHeadSelfAttenti (None, 128, 768)     1536        Encoder-12-MultiHeadSelfAttention<br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-12-FeedForward (FeedFor (None, 128, 768)     4722432     Encoder-12-MultiHeadSelfAttention</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-12-FeedForward-Dropout  (None, 128, 768)     0           Encoder-12-FeedForward[0][0]     <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">Encoder-12-FeedForward-Add (Add (None, 128, 768)     0           Encoder-12-MultiHeadSelfAttention</span><br><span class="hljs-quote">                                                                 Encoder-12-FeedForward-Dropout[0]</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>Encoder-12-FeedForward-Norm (La (None, 128, 768)     1536        Encoder-12-FeedForward-Add[0][0] <br><span class="hljs-quote">__________________________________________________________________________________________________</span><br><span class="hljs-quote">bidirectional_1 (Bidirectional) (None, 128, 128)     426496      Encoder-12-FeedForward-Norm[0][0]</span><br><span class="hljs-quote">__________________________________________________________________________________________________</span><br>crf<span class="hljs-emphasis">_1 (CRF)                     (None, 128, 8)       1112        bidirectional_1[0][0]            </span><br><span class="hljs-emphasis">==================================================================================================</span><br><span class="hljs-emphasis">Total params: 101,809,752</span><br><span class="hljs-emphasis">Trainable params: 101,809,752</span><br><span class="hljs-emphasis">Non-trainable params: 0</span><br><span class="hljs-emphasis">__________________________________________________________________________________________________</span><br></code></pre></td></tr></table></figure><figure><img src="/img/nlp44_2.png" alt="æ¨¡å‹ç»“æ„ç¤ºæ„å›¾" /><figcaption aria-hidden="true">æ¨¡å‹ç»“æ„ç¤ºæ„å›¾</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–¹æ³•åŠ è½½BERTæ¨¡å‹ï¼Œå¯ä»¥å®Œæ•´åœ°çœ‹åˆ°BERTå…·ä½“å±‚ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æŠŠBERTæ¨¡å‹å½“æˆä¸€ä¸ªå±‚æ¥çœ‹ï¼Œæ›´åƒæ˜¯BERTfinetuneçš„æ„Ÿè§‰ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡è¾ƒä¸ºç®€å•ï¼Œä»‹ç»äº†ä¸¤ç§ä½¿ç”¨<code>keras-bert</code>åŠ è½½BERTæ¨¡å‹çš„æ–¹æ³•ã€‚ä¹‹æ‰€ä»¥ç¬”è€…åœ¨æ­¤ä»‹ç»è¿™äº›åŠ è½½æ–¹æ³•ï¼Œæ˜¯ä¸ºäº†åç»­æ–¹ä¾¿ä½¿ç”¨å¯¹æŠ—è®­ç»ƒFGMæ¥å¢åŠ æ¨¡å‹æ•ˆæœï¼ŒFGMå¯¹æŠ—è®­ç»ƒéœ€è¦æˆ‘ä»¬å¯¹Embeddingå±‚åšæ‰°åŠ¨ã€‚</p><p>æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»~</p><p>2021å¹´3æœˆ31æ—¥äºä¸Šæµ·æµ¦ä¸œ~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>BERT</tag>
      
      <tag>NLP</tag>
      
      <tag>keras-bert</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åä¸‰ï¼‰æ¨¡å‹è°ƒå‚æŠ€å·§ä¹‹Warmup and Decay</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%B8%89%EF%BC%89%E6%A8%A1%E5%9E%8B%E8%B0%83%E5%8F%82%E6%8A%80%E5%B7%A7%E4%B9%8BWarmup-and-Decay/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%B8%89%EF%BC%89%E6%A8%A1%E5%9E%8B%E8%B0%83%E5%8F%82%E6%8A%80%E5%B7%A7%E4%B9%8BWarmup-and-Decay/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Warmup and Decayæ˜¯æ·±åº¦å­¦ä¹ ä¸­æ¨¡å‹è°ƒå‚çš„å¸¸ç”¨trickã€‚æœ¬æ–‡å°†ç®€å•ä»‹ç»Warmupand Decayä»¥åŠå¦‚ä½•åœ¨keras_bertä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯warmup-and-decay">ä»€ä¹ˆæ˜¯warmup and decayï¼Ÿ</h3><p>Warmup and Decayæ˜¯æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¸€ç§å­¦ä¹ ç‡ï¼ˆlearningrateï¼‰çš„è°ƒæ•´ç­–ç•¥ã€‚</p><p>Warmupæ˜¯åœ¨ResNetè®ºæ–‡ä¸­æåˆ°çš„ä¸€ç§å­¦ä¹ ç‡é¢„çƒ­çš„æ–¹æ³•ï¼Œå®ƒåœ¨è®­ç»ƒå¼€å§‹çš„æ—¶å€™å…ˆé€‰æ‹©ä½¿ç”¨ä¸€ä¸ªè¾ƒå°çš„å­¦ä¹ ç‡ï¼Œè®­ç»ƒäº†ä¸€äº›epochesæˆ–è€…steps(æ¯”å¦‚4ä¸ªepoches,10000steps),å†ä¿®æ”¹ä¸ºé¢„å…ˆè®¾ç½®çš„å­¦ä¹ æ¥è¿›è¡Œè®­ç»ƒã€‚</p><p>åŒç†ï¼ŒDecayæ˜¯å­¦ä¹ ç‡è¡°å‡æ–¹æ³•ï¼Œå®ƒæŒ‡å®šåœ¨è®­ç»ƒåˆ°ä¸€å®šepochesæˆ–è€…stepsåï¼ŒæŒ‰ç…§çº¿æ€§æˆ–è€…ä½™å¼¦å‡½æ•°ç­‰æ–¹å¼ï¼Œå°†å­¦ä¹ ç‡é™ä½è‡³æŒ‡å®šå€¼ã€‚ä¸€èˆ¬ï¼Œä½¿ç”¨Warmupand Decayï¼Œå­¦ä¹ ç‡ä¼šéµå¾ªä»å°åˆ°å¤§ï¼Œå†å‡å°çš„è§„å¾‹ã€‚</p><p>ç”±äºåˆšå¼€å§‹è®­ç»ƒæ—¶,æ¨¡å‹çš„æƒé‡(weights)æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶è‹¥é€‰æ‹©ä¸€ä¸ªè¾ƒå¤§çš„å­¦ä¹ ç‡,å¯èƒ½å¸¦æ¥æ¨¡å‹çš„ä¸ç¨³å®š(æŒ¯è¡)ï¼Œé€‰æ‹©Warmupé¢„çƒ­å­¦ä¹ ç‡çš„æ–¹å¼ï¼Œå¯ä»¥ä½¿å¾—å¼€å§‹è®­ç»ƒçš„å‡ ä¸ªepochesæˆ–è€…ä¸€äº›stepså†…å­¦ä¹ ç‡è¾ƒå°,åœ¨é¢„çƒ­çš„å°å­¦ä¹ ç‡ä¸‹ï¼Œæ¨¡å‹å¯ä»¥æ…¢æ…¢è¶‹äºç¨³å®šï¼Œç­‰æ¨¡å‹ç›¸å¯¹ç¨³å®šåå†é€‰æ‹©é¢„å…ˆè®¾ç½®çš„å­¦ä¹ ç‡è¿›è¡Œè®­ç»ƒ,ä½¿å¾—æ¨¡å‹æ”¶æ•›é€Ÿåº¦å˜å¾—æ›´å¿«ï¼Œæ¨¡å‹æ•ˆæœæ›´ä½³ã€‚è€Œå½“æ¨¡å‹è®­åˆ°ä¸€å®šé˜¶æ®µåï¼ˆæ¯”å¦‚10ä¸ªepochï¼‰ï¼Œæ¨¡å‹çš„åˆ†å¸ƒå°±å·²ç»æ¯”è¾ƒå›ºå®šäº†ï¼Œæˆ–è€…è¯´èƒ½å­¦åˆ°çš„æ–°ä¸œè¥¿å°±æ¯”è¾ƒå°‘äº†ã€‚å¦‚æœè¿˜æ²¿ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡ï¼Œå°±ä¼šç ´åè¿™ç§ç¨³å®šæ€§ï¼Œç”¨æˆ‘ä»¬é€šå¸¸çš„è¯è¯´ï¼Œå°±æ˜¯å·²ç»æ¥è¿‘æŸå¤±å‡½æ•°çš„å±€éƒ¨æœ€ä¼˜å€¼ç‚¹äº†ï¼Œä¸ºäº†é è¿‘è¿™ä¸ªå±€éƒ¨æœ€ä¼˜å€¼ç‚¹ï¼Œæˆ‘ä»¬å°±è¦æ…¢æ…¢æ¥ã€‚</p><h3id="å¦‚ä½•åœ¨keras_bertä¸­ä½¿ç”¨warmup-and-decay">å¦‚ä½•åœ¨keras_bertä¸­ä½¿ç”¨Warmupand Decayï¼Ÿ</h3><p>åœ¨keras_bertä¸­ï¼Œæä¾›äº†ä¼˜åŒ–å™¨AdamWarmupç±»ï¼Œå…¶å‚æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdamWarmup</span>(keras.optimizers.Optimizer):<br>    <span class="hljs-string">&quot;&quot;&quot;Adam optimizer with warmup.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Default parameters follow those provided in the original paper.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    # Arguments</span><br><span class="hljs-string">        decay_steps: Learning rate will decay linearly to zero in decay steps.</span><br><span class="hljs-string">        warmup_steps: Learning rate will increase linearly to lr in first warmup steps.</span><br><span class="hljs-string">        learning_rate: float &gt;= 0. Learning rate.</span><br><span class="hljs-string">        beta_1: float, 0 &lt; beta &lt; 1. Generally close to 1.</span><br><span class="hljs-string">        beta_2: float, 0 &lt; beta &lt; 1. Generally close to 1.</span><br><span class="hljs-string">        epsilon: float &gt;= 0. Fuzz factor. If `None`, defaults to `K.epsilon()`.</span><br><span class="hljs-string">        weight_decay: float &gt;= 0. Weight decay.</span><br><span class="hljs-string">        weight_decay_pattern: A list of strings. The substring of weight names to be decayed.</span><br><span class="hljs-string">                              All weights will be decayed if it is None.</span><br><span class="hljs-string">        amsgrad: boolean. Whether to apply the AMSGrad variant of this</span><br><span class="hljs-string">            algorithm from the paper &quot;On the Convergence of Adam and</span><br><span class="hljs-string">            Beyond&quot;.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, decay_steps, warmup_steps, min_lr=<span class="hljs-number">0.0</span>,</span><br><span class="hljs-params">                 learning_rate=<span class="hljs-number">0.001</span>, beta_1=<span class="hljs-number">0.9</span>, beta_2=<span class="hljs-number">0.999</span>,</span><br><span class="hljs-params">                 epsilon=<span class="hljs-literal">None</span>, weight_decay=<span class="hljs-number">0.</span>, weight_decay_pattern=<span class="hljs-literal">None</span>,</span><br><span class="hljs-params">                 amsgrad=<span class="hljs-literal">False</span>, **kwargs</span>):<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®š<code>decay_steps</code>ï¼Œ<code>warmup_steps</code>ï¼Œ<code>learning_rate</code>ï¼Œ<code>min_lr</code>ï¼Œå…¶å«ä¹‰ä¸ºæ¨¡å‹åœ¨è®­ç»ƒ<code>warmup_steps</code>åï¼Œå°†å­¦ä¹ ç‡é€æ¸å¢åŠ è‡³<code>learning_rate</code>ï¼Œåœ¨è®­ç»ƒ<code>decay_steps</code>åï¼Œå°†å­¦ä¹ ç‡é€æ¸çº¿æ€§åœ°é™ä½è‡³<code>min_lr</code>ã€‚</p><p>ä»¥ä¸‹ä¸ºWarmupé¢„çƒ­å­¦ä¹ ç‡ä»¥åŠå­¦ä¹ ç‡é¢„çƒ­å®Œæˆåè¡°å‡(sin or expdecay)çš„æ›²çº¿å›¾ï¼š</p><figure><img src="/img/nlp43_1.png" alt="å­¦ä¹ ç‡Warmup and Decayç¤ºæ„å›¾" /><figcaption aria-hidden="true">å­¦ä¹ ç‡Warmup and Decayç¤ºæ„å›¾</figcaption></figure><p>åœ¨keras_bertçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œç»™å‡ºäº†ä½¿ç”¨Warmup andDecayçš„ä»£ç ä¾‹å­ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> AdamWarmup, calc_train_steps<br><br>train_x = np.random.standard_normal((<span class="hljs-number">1024</span>, <span class="hljs-number">100</span>))<br><br>total_steps, warmup_steps = calc_train_steps(<br>    num_example=train_x.shape[<span class="hljs-number">0</span>],<br>    batch_size=<span class="hljs-number">32</span>,<br>    epochs=<span class="hljs-number">10</span>,<br>    warmup_proportion=<span class="hljs-number">0.1</span>,<br>)<br><br>optimizer = AdamWarmup(total_steps, warmup_steps, lr=<span class="hljs-number">1e-3</span>, min_lr=<span class="hljs-number">1e-5</span>)<br></code></pre></td></tr></table></figure><h3 id="warmup-and-decayå®æˆ˜">Warmup and Decayå®æˆ˜</h3><p>ç¬”è€…åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a>ä¸­ï¼Œåœ¨ä½¿ç”¨keras-bertè®­ç»ƒåºåˆ—æ ‡æ³¨æ¨¡å‹æ—¶ï¼Œå­¦ä¹ ç‡è°ƒæ•´ç­–ç•¥ä½¿ç”¨äº†<code>ReduceLROnPlateau</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">reduce_lr = ReduceLROnPlateau(monitor=<span class="hljs-string">&#x27;val_loss&#x27;</span>, min_delta=<span class="hljs-number">0.0004</span>, patience=<span class="hljs-number">2</span>, factor=<span class="hljs-number">0.1</span>, min_lr=<span class="hljs-number">1e-6</span>,<br>                                  mode=<span class="hljs-string">&#x27;auto&#x27;</span>,<br>                                  verbose=<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>åœ¨ä¸‰ä¸ªæ•°æ®é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><ul><li><p>äººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†ï¼šmicro avg F1=0.9182</p></li><li><p>æ—¶é—´è¯†åˆ«æ•°æ®é›†ï¼šmicro avg F1=0.8587</p></li><li><p>CLUENERç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†ï¼šmicro avg F1=0.7603</p><p>æˆ‘ä»¬å°†å­¦ä¹ ç‡è°ƒæ•´ç­–ç•¥ä¿®æ”¹ä¸ºWarmup andDecayï¼ˆæ¨¡å‹å…¶ä»–å‚æ•°ä¸å˜ï¼Œæ•°æ®é›†ä¸å˜ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># add warmup</span><br>    total_steps, warmup_steps = calc_train_steps(<br>        num_example=<span class="hljs-built_in">len</span>(input_train),<br>        batch_size=BATCH_SIZE,<br>        epochs=EPOCH,<br>        warmup_proportion=<span class="hljs-number">0.2</span>,<br>    )<br>    optimizer = AdamWarmup(total_steps, warmup_steps, lr=<span class="hljs-number">1e-4</span>, min_lr=<span class="hljs-number">1e-7</span>)<br>    model = BertBilstmCRF(max_seq_length=MAX_SEQ_LEN, lstm_dim=<span class="hljs-number">64</span>).create_model()<br>    model.<span class="hljs-built_in">compile</span>(<br>        optimizer=optimizer,<br>        loss=crf_loss,<br>        metrics=[crf_accuracy]<br>    )<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¯¥trickï¼Œåœ¨ä¸‰ä¸ªæ•°æ®é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><ul><li>äººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†</li></ul><table><thead><tr class="header"><th>å­¦ä¹ ç‡è°ƒæ•´</th><th>é¢„æµ‹1</th><th>é¢„æµ‹2</th><th>é¢„æµ‹3</th><th>avg</th></tr></thead><tbody><tr class="odd"><td>Warmup</td><td>0.9276</td><td>0.9217</td><td>0.9252</td><td>0.9248</td></tr></tbody></table><ul><li>æ—¶é—´è¯†åˆ«æ•°æ®é›†</li></ul><table><thead><tr class="header"><th>å­¦ä¹ ç‡è°ƒæ•´</th><th>é¢„æµ‹1</th><th>é¢„æµ‹2</th><th>é¢„æµ‹3</th><th>avg</th></tr></thead><tbody><tr class="odd"><td>Warmup</td><td>0.8926</td><td>0.8934</td><td>0.8820</td><td>0.8893</td></tr></tbody></table><ul><li>CLUENERç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†</li></ul><table><thead><tr class="header"><th>å­¦ä¹ ç‡è°ƒæ•´</th><th>é¢„æµ‹1</th><th>é¢„æµ‹2</th><th>é¢„æµ‹3</th><th>avg</th></tr></thead><tbody><tr class="odd"><td>Warmup</td><td>0.7612</td><td>0.7629</td><td>0.7607</td><td>0.7616</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨äº†Warmup andDecayï¼Œæ¨¡å‹åœ¨ä¸åŒçš„æ•°æ®é›†ä¸Šå‡æœ‰ä¸åŒç¨‹åº¦çš„æ•ˆæœæå‡ã€‚</p><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼Œä»£ç åœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/keras_bert_sequence_labeling">https://github.com/percent4/keras_bert_sequence_labeling</a>ã€‚</p><p>æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»~</p><p>2021å¹´3æœˆ27æ—¥äºä¸Šæµ·æµ¦ä¸œ~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>Warmup and Decay</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åäºŒï¼‰äººç‰©å…³ç³»åˆ†ç±»çš„å†æ¬¡å°è¯•</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E7%9A%84%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%88%86%E7%B1%BB%E7%9A%84%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä¸¤å‘¨å‰çš„å‘¨æœ«ï¼Œç¬”è€…å†³å®šå¯¹äººç‰©å…³ç³»åˆ†ç±»è¿›è¡Œå†æ¬¡å°è¯•ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´æ˜¯å†æ¬¡å°è¯•å‘¢ï¼Ÿå› ä¸ºç¬”è€…ä¹‹å‰å·²ç»å†™è¿‡ä¸€ç¯‡æ–‡ç« <ahref="https://blog.csdn.net/jclian91/article/details/104380371">NLPï¼ˆäºŒåä¸€ï¼‰äººç‰©å…³ç³»æŠ½å–çš„ä¸€æ¬¡å®æˆ˜</a>ï¼Œå½“æ—¶çš„æ ‡æ³¨æ•°æ®å¤§çº¦2900æ¡ï¼Œä½¿ç”¨çš„æ¨¡å‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸ºBERT+Bi-GRU+Attention+FCç»“æ„ï¼Œå…¶ä¸­BERTç”¨ä½œç‰¹å¾æå–ï¼Œè¯¥æ¨¡å‹åœ¨åŸæœ‰æ•°æ®é›†ä¸Šçš„F1ä¸º79%ã€‚</p><p>ç»è¿‡ç¬”è€…ä¸€å¹´æ–­æ–­ç»­ç»­çš„åŠªåŠ›ï¼Œç°åœ¨çš„æ ‡æ³¨æ ·æœ¬å·²ç»è¾¾åˆ°3900å¤šæ¡ã€‚é‰´äºç¬”è€…å·²åšè¿‡BERTå¾®è°ƒç›¸å…³å·¥ä½œï¼Œå½“ç„¶å¸Œæœ›åœ¨æ­¤æ•°æ®é›†ä¸Šè¿›è¡Œå†æ¬¡å°è¯•ã€‚</p><p>ç°æœ‰çš„äººç‰©å…³ç³»æ•°æ®é›†å¤§çº¦3900å¤šæ¡ï¼Œåˆ†å¸ƒå¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp42_1.png" alt="äººç‰©å…³ç³»åˆ†å¸ƒå›¾" /><figcaption aria-hidden="true">äººç‰©å…³ç³»åˆ†å¸ƒå›¾</figcaption></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬åªä½¿ç”¨BERTåˆ†ç±»æ¨¡å‹ï¼Œå¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ ¼å¼æ”¹é€ ï¼Œè¿›è¡Œç®€å•åœ°å°è¯•ã€‚</p><p>æˆ‘ä»¬ä»¥æ ·æœ¬<code>äº²æˆš  1837å¹´6æœˆ20æ—¥ï¼Œå¨å»‰å››ä¸–è¾ä¸–ï¼Œä»–çš„ä¾„å¥³ç»´å¤šåˆ©äºšå³ä½ã€‚</code>ä¸ºä¾‹ï¼Œå…¶ä¸­<code>äº²æˆš</code>ä¸ºäººç‰©å…³ç³»ï¼Œ<code>å¨å»‰å››ä¸–</code>ä¸ºå®ä½“1ï¼Œ<code>ç»´å¤šåˆ©äºš</code>ä¸ºå®ä½“2ï¼Œæ¥æ¼”ç¤ºè¾“å…¥çš„æ–‡æœ¬æ ¼å¼ã€‚ä¸‹é¢çš„éƒ¨åˆ†æˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨<code>chinese-RoBERTa-wwm-ext</code>ä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹ï¼Œæ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ¯”ä¾‹ä¸º8:2ã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98/">NLPï¼ˆäºŒåä¸€ï¼‰äººç‰©å…³ç³»æŠ½å–çš„ä¸€æ¬¡å®æˆ˜</a>ä¸€æ ·ï¼Œåœ¨æ–‡æœ¬ä¸­å°†å®ä½“1æ›¿æ¢ä¸ºåŒæ ·æ•°é‡çš„<code>#</code>ï¼Œå®ä½“2æ›¿æ¢ä¸ºåŒæ ·æ•°é‡çš„<code>#</code>ï¼Œå†å°†å®ä½“1ã€å®ä½“2ã€æ–‡æœ¬ç”¨<code>$</code>è¿æ¥ï¼Œè¾“å…¥æ ¼å¼ä¸ºï¼š<code>å¨å»‰å››ä¸–$ç»´å¤šåˆ©äºš$1837å¹´6æœˆ20æ—¥ï¼Œ####è¾ä¸–ï¼Œä»–çš„ä¾„å¥³####å³ä½ã€‚</code>ã€‚ä½¿ç”¨BERT+Bi-GRU+Attention+FCæ¨¡å‹ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹åç§°</th><th>è®­ç»ƒ1</th><th>è®­ç»ƒ2</th><th>è®­ç»ƒ3</th><th>è®­ç»ƒ4</th><th>è®­ç»ƒ5</th><th>Avg</th></tr></thead><tbody><tr class="odd"><td>BiGRU+Attention</td><td>0.7726</td><td>0.7974</td><td>0.7935</td><td>0.7908</td><td>0.7941</td><td>0.7897</td></tr></tbody></table><p>ç¬¬äºŒç§æ–¹æ³•ï¼Œè¾“å…¥æ ¼å¼ä¸ç¬¬ä¸€ç§æ–¹æ³•ä¸€è‡´ã€‚ä½¿ç”¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åäº”ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡</a>ä¸­çš„å¤šåˆ†ç±»æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹åç§°</th><th>è®­ç»ƒ1</th><th>è®­ç»ƒ2</th><th>è®­ç»ƒ3</th><th>è®­ç»ƒ4</th><th>è®­ç»ƒ5</th><th>Avg</th></tr></thead><tbody><tr class="odd"><td>Bert_cls</td><td>0.8246</td><td>0.8110</td><td>0.8282</td><td>0.8448</td><td>0.8218</td><td>0.8260</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰äº†é¢„è®­ç»ƒæ¨¡å‹çš„å¸®åŠ©ï¼Œæ¨¡å‹æ•ˆæœæœ‰äº†æ˜¾è‘—æå‡ï¼ŒF1å€¼å¹³å‡é«˜äº†3.6%ã€‚</p><p>ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œåœ¨æ–‡æœ¬ä¸­å°†å®ä½“ç”¨<code>#</code>åŒ…å›´ï¼Œè¾“å…¥æ ¼å¼ä¸ºï¼š<code>1837å¹´6æœˆ20æ—¥ï¼Œ#å¨å»‰å››ä¸–#è¾ä¸–ï¼Œä»–çš„ä¾„å¥³#ç»´å¤šåˆ©äºš#å³ä½ã€‚</code>ä½¿ç”¨BERT_clsæ¨¡å‹ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹åç§°</th><th>è®­ç»ƒ1</th><th>è®­ç»ƒ2</th><th>è®­ç»ƒ3</th><th>è®­ç»ƒ4</th><th>è®­ç»ƒ5</th><th>Avg</th></tr></thead><tbody><tr class="odd"><td>Bert_cls2ï¼ˆå®ä½“ç”¨#å›´ç»•ï¼‰</td><td>0.8175</td><td>0.8259</td><td>0.8275</td><td>0.8335</td><td>0.8299</td><td>0.8269</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥è¾“å…¥æ ¼å¼ä¸ç¬¬äºŒç§æ–¹æ³•ç›¸æ¯”ï¼Œåœ¨æ¨¡å‹æ•ˆæœä¸Šå¹¶æ²¡æœ‰å¤ªå¤§çš„æå‡ã€‚</p><p>ä¹Ÿè®¸ï¼Œæ˜¯æ—¶å€™å°è¯•æ–°çš„æ¨¡å‹äº†ã€‚</p><p>ä¸Šå‘¨ä¸€æ™šä¸Šï¼Œç¬”è€…æ— æ„ä¸­çœ‹åˆ°ä¸€ç¯‡è®ºæ–‡ï¼Œåç§°ä¸º<ahref="https://arxiv.org/pdf/1905.08284.pdf">Enriching Pre-trainedLanguage Model with Entity Information for RelationClassification</a>ï¼Œé¡¾åæ€ä¹‰ä¸ºä½¿ç”¨å®ä½“ä¿¡æ¯å°†é¢„è®­ç»ƒæ¨¡å‹ç”¨äºå…³ç³»åˆ†ç±»ï¼ˆRCï¼‰ã€‚å…¶æ¨¡å‹ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp42_1.png" alt="R-BERTæ¨¡å‹ç»“æ„å›¾" /><figcaption aria-hidden="true">R-BERTæ¨¡å‹ç»“æ„å›¾</figcaption></figure><p>è¯¥æ¨¡å‹è¢«ç§°ä¸º<code>R-BERT</code>ï¼Œæ¨¡å‹ç»“æ„åœ¨æ­¤ä¸å¤šä»‹ç»ï¼Œåé¢æœ‰æœºä¼šå†ä»‹ç»ã€‚åœ¨Githubä¸Šæœ‰<code>R-BERT</code>æ¨¡å‹çš„Torchæ¡†æ¶å®ç°æ–¹å¼ï¼Œåœ¨<code>Semeval 2010 Task 8 Dataset</code>å–å¾—äº†ä¸é”™çš„æ•ˆæœã€‚</p><p>ç¬”è€…å°†<code>R-BERT</code>ç”¨äºäººç‰©å…³ç³»åˆ†ç±»æ•°æ®é›†ä¸­ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Model</span>: chinese-roberta-wwm-ext, weighted avgage F1 = <span class="hljs-number">85</span>.<span class="hljs-number">35</span>%<br></code></pre></td></tr></table></figure><p>è¯¥é¡¹ç›®ç¬”è€…å·²ä¸Šä¼ è‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/R-BERT_for_people_relation_extraction">https://github.com/percent4/R-BERT_for_people_relation_extraction</a>ã€‚</p><p>æœ¬å‘¨ï¼Œç¬”è€…ä¸‹å®šå†³å¿ƒä½¿ç”¨Keraså®ç°<code>R-BERT</code>ã€‚ç¬¬ä¸€å¤©ï¼Œæ— æœã€‚ç¬¬äºŒå¤©ï¼Œå®ç°å…³é”®Keraså±‚çš„çªç ´ï¼Œè¿›è¡Œç®€å•æ¨¡å‹è®­ç»ƒï¼Œå‘ç°ç¦»Torchç‰ˆæœ¬çš„ç»“æœå°šæœ‰ä¸€å®šå·®è·ã€‚ç¬¬ä¸‰å¤©ï¼Œå¯¹ç…§Torchç‰ˆæœ¬ï¼Œä¸æ–­è°ƒæ•´æ¨¡å‹ï¼ŒåŠ å…¥Warmupæœºåˆ¶ï¼Œå‘ç°ç»ˆäºå–å¾—äº†ä¸Torchç‰ˆæœ¬ä¸€æ ·çš„æ•ˆæœã€‚åœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-comment"># Model: chinese-RoBERTa-wwm-ext, weighted avgage F1 = 85.27%</span><br>              precision    recall  f1-score   support<br><br>     unknown     <span class="hljs-number">0.7930</span>    <span class="hljs-number">0.8612</span>    <span class="hljs-number">0.8257</span>       <span class="hljs-number">209</span><br>         ä¸Šä¸‹çº§     <span class="hljs-number">0.7188</span>    <span class="hljs-number">0.7419</span>    <span class="hljs-number">0.7302</span>        <span class="hljs-number">31</span><br>          äº²æˆš     <span class="hljs-number">0.8824</span>    <span class="hljs-number">0.6250</span>    <span class="hljs-number">0.7317</span>        <span class="hljs-number">24</span><br>        å…„å¼Ÿå§å¦¹     <span class="hljs-number">0.8378</span>    <span class="hljs-number">0.9118</span>    <span class="hljs-number">0.8732</span>        <span class="hljs-number">34</span><br>          åˆä½œ     <span class="hljs-number">0.8600</span>    <span class="hljs-number">0.7288</span>    <span class="hljs-number">0.7890</span>        <span class="hljs-number">59</span><br>          åŒäºº     <span class="hljs-number">1.0000</span>    <span class="hljs-number">0.9487</span>    <span class="hljs-number">0.9737</span>        <span class="hljs-number">39</span><br>          åŒå­¦     <span class="hljs-number">0.8800</span>    <span class="hljs-number">0.9167</span>    <span class="hljs-number">0.8980</span>        <span class="hljs-number">24</span><br>          åŒé—¨     <span class="hljs-number">0.9615</span>    <span class="hljs-number">0.9615</span>    <span class="hljs-number">0.9615</span>        <span class="hljs-number">26</span><br>          å¤«å¦»     <span class="hljs-number">0.8333</span>    <span class="hljs-number">0.8861</span>    <span class="hljs-number">0.8589</span>        <span class="hljs-number">79</span><br>          å¥½å‹     <span class="hljs-number">0.8065</span>    <span class="hljs-number">0.8333</span>    <span class="hljs-number">0.8197</span>        <span class="hljs-number">30</span><br>          å¸ˆç”Ÿ     <span class="hljs-number">0.8857</span>    <span class="hljs-number">0.8378</span>    <span class="hljs-number">0.8611</span>        <span class="hljs-number">37</span><br>          æƒ…ä¾£     <span class="hljs-number">0.9231</span>    <span class="hljs-number">0.7742</span>    <span class="hljs-number">0.8421</span>        <span class="hljs-number">31</span><br>          çˆ¶æ¯     <span class="hljs-number">0.9062</span>    <span class="hljs-number">0.9062</span>    <span class="hljs-number">0.9062</span>       <span class="hljs-number">128</span><br>          ç¥–å­™     <span class="hljs-number">0.9524</span>    <span class="hljs-number">0.8000</span>    <span class="hljs-number">0.8696</span>        <span class="hljs-number">25</span><br><br>    accuracy                         <span class="hljs-number">0.8531</span>       <span class="hljs-number">776</span><br>   <span class="hljs-function"><span class="hljs-keyword">macro</span> <span class="hljs-title">avg</span></span>     <span class="hljs-number">0.8743</span>    <span class="hljs-number">0.8381</span>    <span class="hljs-number">0.8529</span>       <span class="hljs-number">776</span><br>weighted avg     <span class="hljs-number">0.8566</span>    <span class="hljs-number">0.8531</span>    <span class="hljs-number">0.8527</span>       <span class="hljs-number">776</span><br></code></pre></td></tr></table></figure><p>è¯¥é¡¹ç›®å·²ä¸Šä¼ è‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/Keras_R_BERT">https://github.com/percent4/Keras_R_BERT</a>ã€‚åé¢æœ‰æœºä¼šç¬”è€…å†è¯¦ç»†ä»‹ç»ã€‚</p><p>è‡³æ­¤ï¼Œç¬”è€…ä¸ä»…ç”¨Keraså®ç°äº†R-BERTï¼Œå¹¶ä¸”æ¯”æœ€åˆçš„BERT+Bi-GRU+Attention+FCæ¨¡å‹ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„F1å€¼æå‡äº†6.3%ã€‚</p><p>å®ç°æ¨¡å‹çš„è¿‡ç¨‹æ˜¯ç—›è‹¦çš„ï¼Œç¬”è€…ä¸€åº¦æƒ³æ”¾å¼ƒï¼Œä½†å½“æ¨¡å‹æˆåŠŸå¤ç°åï¼Œé‚£ç§å¿«ä¹ï¼Œæ˜¯ç®€å•æ¯ç‡¥çš„å·¥ä½œä¸­çš„ä¸€æŠ¹ç»šä¸½çš„é˜³å…‰ï¼è¿™ä¹Ÿæ˜¯ç¬”è€…ç¬¬ä¸€æ¬¡å¤ç°æ¨¡å‹ï¼Œè™½ç„¶åªæ˜¯æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸åŒï¼Œä½†å¯¹æˆ‘æ¥è¯´æ˜¯æå…¶é‡è¦çš„ä¸€æ­¥ï¼</p><p>æœ€è¿‘åˆå‘ç°ä¸€ä¸ªå¾ˆä¸é”™çš„å…³ç³»åˆ†ç±»çš„æ¨¡å‹ï¼š<code>Mul-BERT</code>ï¼Œä½†ç”±äºè¯¥æ¨¡å‹çš„è®ºæ–‡å¹¶æœªå…¬å¸ƒï¼ŒGithubä¹Ÿæ²¡æœ‰å…¬å¼€æºç ï¼Œç¬”è€…åªå¥½æŒ‰è‡ªå·±çš„ç†è§£ï¼Œç®€å•åœ°å®ç°äº†è¿‘ä¼¼<code>Mul-BERT</code>æ¨¡å‹ï¼Œå·²ä¸Šä¼ è‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/Keras_quasi_Mul_BERT">https://github.com/percent4/Keras_quasi_Mul_BERT</a>ã€‚ç­‰è®ºæ–‡å‡ºæ¥åï¼Œå†ç”¨Keraså»å¤ç°<code>Mul-BERT</code>æ¨¡å‹ã€‚</p><p>æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»~</p><p>2021å¹´3æœˆ25æ—¥äºä¸Šæµ·æµ¦ä¸œï¼Œæ­¤æ—¥é˜³å…‰æ˜åªš~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>å…³ç³»åˆ†ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åä¸€ï¼‰ä½¿ç”¨HuggingFaceç¿»è¯‘æ¨¡å‹çš„ä¸€æ¬¡å°è¯•</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%B8%80%EF%BC%89%E4%BD%BF%E7%94%A8HuggingFace%E7%BF%BB%E8%AF%91%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%E4%B8%80%EF%BC%89%E4%BD%BF%E7%94%A8HuggingFace%E7%BF%BB%E8%AF%91%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†å¦‚ä½•å¦‚ä½•ä½¿ç”¨HuggingFaceä¸­çš„ç¿»è¯‘æ¨¡å‹ã€‚</p><p>HuggingFaceæ˜¯NLPé¢†åŸŸä¸­å“å½“å½“çš„å›¢ä½“ï¼Œå®ƒåœ¨é¢„è®­ç»ƒæ¨¡å‹æ–¹é¢ä½œå‡ºäº†å¾ˆå¤šæ¥è§¦çš„å·¥ä½œï¼Œå¹¶å¼€æºäº†è®¸å¤šé¢„è®­ç»ƒæ¨¡å‹å’Œå·²ç»é’ˆå¯¹å…·ä½“æŸä¸ªNLPäººç‰©è®­ç»ƒå¥½çš„ç›´æ¥å¯ä»¥ä½¿ç”¨çš„æ¨¡å‹ã€‚æœ¬æ–‡å°†ä½¿ç”¨HuggingFaceæä¾›çš„å¯ç›´æ¥ä½¿ç”¨çš„ç¿»è¯‘æ¨¡å‹ã€‚</p><p>HuggingFaceçš„ç¿»è¯‘æ¨¡å‹å¯å‚è€ƒç½‘å€ï¼š<ahref="https://huggingface.co/models?pipeline_tag=translation">https://huggingface.co/models?pipeline_tag=translation</a>ï¼Œè¯¥éƒ¨åˆ†æ¨¡å‹ä¸­çš„ç»å¤§éƒ¨åˆ†æ˜¯ç”±Helsinki-NLPï¼ˆLanguage Technology ResearchGroup at the University of Helsinkiï¼‰æœºæ„å¼€æºï¼Œæ¨¡å‹æ•°é‡ä¸º1333ä¸ªã€‚</p><h3 id="æ¨¡å‹ä½¿ç”¨">æ¨¡å‹ä½¿ç”¨</h3><p>ç¬”è€…å°†åœ¨PyTorchæ¡†æ¶ä¸‹ä½¿ç”¨HuggingFaceçš„<code>ä¸­è¯‘è‹±æ¨¡å‹</code>å’Œ<code>è‹±è¯‘ä¸­æ¨¡å‹</code>ã€‚å…¶ä¸­<code>ä¸­è¯‘è‹±æ¨¡å‹</code>çš„æ¨¡å‹åç§°ä¸ºï¼šopus-mt-zh-enï¼Œä¸‹è½½ç½‘å€ä¸ºï¼š<ahref="https://huggingface.co/Helsinki-NLP/opus-mt-zh-en/tree/main">https://huggingface.co/Helsinki-NLP/opus-mt-zh-en/tree/main</a>ï¼›<code>è‹±è¯‘ä¸­æ¨¡å‹</code>çš„æ¨¡å‹åç§°ä¸ºopus-mt-en-zhï¼Œä¸‹è½½ç½‘å€ä¸ºï¼š<ahref="https://huggingface.co/Helsinki-NLP/opus-mt-en-zh/tree/main">https://huggingface.co/Helsinki-NLP/opus-mt-en-zh/tree/main</a>ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆå°è¯•<code>ä¸­è¯‘è‹±æ¨¡å‹</code>ï¼Œå³æŠŠä¸­æ–‡ç¿»è¯‘æˆè‹±è¯­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForSeq2SeqLM<br><br>tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;./opus-mt-zh-en&quot;</span>)<br><br>model = AutoModelForSeq2SeqLM.from_pretrained(<span class="hljs-string">&quot;./opus-mt-zh-en&quot;</span>)<br><br>text = <span class="hljs-string">&quot;ä»æ—¶é—´ä¸Šçœ‹ï¼Œä¸­å›½ç©ºé—´ç«™çš„å»ºé€ æ¯”å›½é™…ç©ºé—´ç«™æ™š20å¤šå¹´ã€‚&quot;</span><br><span class="hljs-comment"># Tokenize the text</span><br>batch = tokenizer.prepare_seq2seq_batch(src_texts=[text])<br><br><span class="hljs-comment"># Make sure that the tokenized text does not exceed the maximum</span><br><span class="hljs-comment"># allowed size of 512</span><br>batch[<span class="hljs-string">&quot;input_ids&quot;</span>] = batch[<span class="hljs-string">&quot;input_ids&quot;</span>][:, :<span class="hljs-number">512</span>]<br>batch[<span class="hljs-string">&quot;attention_mask&quot;</span>] = batch[<span class="hljs-string">&quot;attention_mask&quot;</span>][:, :<span class="hljs-number">512</span>]<br><br><span class="hljs-comment"># Perform the translation and decode the output</span><br>translation = model.generate(**batch)<br>result = tokenizer.batch_decode(translation, skip_special_tokens=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>ç¿»è¯‘ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk">[<span class="hljs-comment">&quot;In terms of time, the Chinese space station was built more than 20 years later than the International Space Station.&quot;</span>]<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å…ˆå°è¯•<code>è‹±è¯‘ä¸­æ¨¡å‹</code>ï¼Œå³æŠŠè‹±æ–‡ç¿»è¯‘æˆæ±‰è¯­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForSeq2SeqLM<br><br>tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;./opus-mt-en-zh&quot;</span>)<br><br>model = AutoModelForSeq2SeqLM.from_pretrained(<span class="hljs-string">&quot;./opus-mt-en-zh&quot;</span>)<br><br>text = <span class="hljs-string">&quot;In terms of time, the Chinese space station was built more than 20 years later than the International Space Station.&quot;</span><br><span class="hljs-comment"># Tokenize the text</span><br>batch = tokenizer.prepare_seq2seq_batch(src_texts=[text])<br><br><span class="hljs-comment"># Make sure that the tokenized text does not exceed the maximum</span><br><span class="hljs-comment"># allowed size of 512</span><br>batch[<span class="hljs-string">&quot;input_ids&quot;</span>] = batch[<span class="hljs-string">&quot;input_ids&quot;</span>][:, :<span class="hljs-number">512</span>]<br>batch[<span class="hljs-string">&quot;attention_mask&quot;</span>] = batch[<span class="hljs-string">&quot;attention_mask&quot;</span>][:, :<span class="hljs-number">512</span>]<br><br><span class="hljs-comment"># Perform the translation and decode the output</span><br>translation = model.generate(**batch)<br>result = tokenizer.batch_decode(translation, skip_special_tokens=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>ç¿»è¯‘ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;å°±æ—¶é—´è€Œè¨€</span>,ä¸­å›½ç©ºé—´ç«™çš„å»ºé€ æ¯”å›½é™…ç©ºé—´ç«™æ™šäº†20å¤šå¹´ã€‚&#x27;]<br></code></pre></td></tr></table></figure><p>æœ‰äº†HuggingFaceçš„transformersæ¨¡å—ï¼Œæˆ‘ä»¬ä½¿ç”¨èµ·è¿™äº›æ¨¡å‹ç›¸å½“æ–¹ä¾¿ï¼ŒåŒæ—¶ä¹Ÿæœ‰å¾ˆä¸é”™çš„ç¿»è¯‘æ•ˆæœã€‚</p><h3 id="æ¨¡å‹è§£é‡Š">æ¨¡å‹è§£é‡Š</h3><p>æ¥ç€æˆ‘ä»¬å†æ¥è§¦ä¸€æ¬¾å·¥å…·ï¼Œåç§°ä¸º<code>shap</code>ã€‚<code>shap</code>æ˜¯Pythonå¼€å‘çš„ä¸€ä¸ªæ¨¡å‹è§£é‡ŠåŒ…ï¼Œå¯ä»¥ä»»ä½•æœºå™¨å­¦ä¹ æ¨¡å‹çš„è¾“å‡ºã€‚å…¶åç§°æ¥æºäºSHapleyAdditiveexPlanationï¼Œåœ¨åˆä½œåšå¼ˆè®ºçš„å¯å‘ä¸‹SHAPæ„å»ºä¸€ä¸ªåŠ æ€§çš„è§£é‡Šæ¨¡å‹ï¼Œæ‰€æœ‰çš„ç‰¹å¾éƒ½è§†ä¸ºâ€œè´¡çŒ®è€…â€ã€‚å¯¹äºæ¯ä¸ªé¢„æµ‹æ ·æœ¬ï¼Œæ¨¡å‹éƒ½äº§ç”Ÿä¸€ä¸ªé¢„æµ‹å€¼ï¼ŒSHAPvalueå°±æ˜¯è¯¥æ ·æœ¬ä¸­æ¯ä¸ªç‰¹å¾æ‰€åˆ†é…åˆ°çš„æ•°å€¼ã€‚</p><p>æˆ‘ä»¬å°è¯•ç€ä½¿ç”¨<code>shap</code>æ¨¡å—æ¥å¯¹ç¿»è¯‘æ¨¡å‹è¿›è¡Œè§£é‡Šï¼Œå¯ä»¥çœ‹åˆ°<code>shap</code>å¯è§†åŒ–æ•ˆæœéå¸¸æ£’çš„è§£é‡Šç•Œé¢ï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp41_1.png" alt="ä¸­è¯‘è‹±æ¨¡å‹ä»£ç " /><figcaption aria-hidden="true">ä¸­è¯‘è‹±æ¨¡å‹ä»£ç </figcaption></figure><p>é»˜è®¤è¾“å‡ºç»“æœä¸ºç¿»è¯‘ç»“æœï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp41_2.png" alt="é»˜è®¤è¾“å‡ºç»“æœ" /><figcaption aria-hidden="true">é»˜è®¤è¾“å‡ºç»“æœ</figcaption></figure><p>æ¨¡å‹è§£é‡Šçš„çƒ­åŠ›å›¾æ•ˆæœå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp41_3.png" alt="æ¨¡å‹è§£é‡Šçš„çƒ­åŠ›å›¾æ•ˆæœ" /><figcaption aria-hidden="true">æ¨¡å‹è§£é‡Šçš„çƒ­åŠ›å›¾æ•ˆæœ</figcaption></figure><p>ä»çƒ­åŠ›å›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç©ºé—´ç«™è¿™ä¸ªè¯è¯­è¢«ç¿»è¯‘æˆspace stationã€‚</p><p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>è‹±è¯‘ä¸­æ¨¡å‹</code>çš„çƒ­åŠ›å›¾è§£é‡Šæ•ˆæœï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp41_4.png" alt="è‹±è¯‘ä¸­æ¨¡å‹çš„çƒ­åŠ›å›¾è§£é‡Šæ•ˆæœ" /><figcaptionaria-hidden="true"><code>è‹±è¯‘ä¸­æ¨¡å‹</code>çš„çƒ­åŠ›å›¾è§£é‡Šæ•ˆæœ</figcaption></figure><p>æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»~</p><p>2021å¹´3æœˆ10æ—¥äºä¸Šæµ·æµ¦ä¸œ~</p><h3 id="å‚è€ƒç½‘å€">å‚è€ƒç½‘å€</h3><ol type="1"><li>HuggingFace translation model: <ahref="https://huggingface.co/models?filter=zh&amp;pipeline_tag=translation">https://huggingface.co/models?filter=zh&amp;pipeline_tag=translation</a></li><li>Text to Text Explanation: Machine Translation Example: <ahref="https://shap.readthedocs.io/en/latest/example_notebooks/text_examples/translation/Machine%20Translation%20Explanation%20Demo.html">https://shap.readthedocs.io/en/latest/example_notebooks/text_examples/translation/Machine%20Translation%20Explanation%20Demo.html</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æœºå™¨ç¿»è¯‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆå››åï¼‰åˆ©ç”¨seqevalæ¨¡å—è·å–åºåˆ—å®ä½“è¯†åˆ«ç»“æœ</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8seqeval%E6%A8%A1%E5%9D%97%E8%8E%B7%E5%8F%96%E5%BA%8F%E5%88%97%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%E7%BB%93%E6%9E%9C/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E5%9B%9B%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8seqeval%E6%A8%A1%E5%9D%97%E8%8E%B7%E5%8F%96%E5%BA%8F%E5%88%97%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%E7%BB%93%E6%9E%9C/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%89%EF%BC%89%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E7%AE%97%E6%B3%95%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9D%97seqeval%E7%9A%84%E4%BD%BF%E7%94%A8/">NLPï¼ˆäºŒåä¸‰ï¼‰åºåˆ—æ ‡æ³¨ç®—æ³•è¯„ä¼°æ¨¡å—seqevalçš„ä½¿ç”¨</a>ä¸­ï¼Œç¬”è€…é¦–æ¬¡ä»‹ç»äº†<code>seqeval</code>æ¨¡å—ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾ˆå¥½åœ°å®Œæˆåºåˆ—æ ‡æ³¨ç®—æ³•çš„æ¨¡å‹æ•ˆæœè¯„ä¼°ï¼Œå¹¶ä¸”èƒ½åœ¨Kerasæ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥ã€‚</p><p>å…¶å®ï¼Œåœ¨<code>seqeval</code>æ¨¡å—ä¸­è¿˜æœ‰ä¸€ä¸ª<code>get_entities</code>å‡½æ•°ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬è¿…é€Ÿåœ°ä»ä¸€ä¸ªæ ‡æ³¨åºåˆ—ä¸­è·å–å®Œæ•´å®ä½“ï¼Œæ”¯æŒå¸¸è§„çš„BIOã€BMESOç­‰æ ‡æ³¨æ–¹å¼ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸‹è¯¥å‡½æ•°çš„æºä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_entities</span>(<span class="hljs-params">seq, suffix=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Gets entities from sequence.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        seq (list): sequence of labels.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        list: list of (chunk_type, chunk_start, chunk_end).</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Example:</span><br><span class="hljs-string">        &gt;&gt;&gt; from seqeval.metrics.sequence_labeling import get_entities</span><br><span class="hljs-string">        &gt;&gt;&gt; seq = [&#x27;B-PER&#x27;, &#x27;I-PER&#x27;, &#x27;O&#x27;, &#x27;B-LOC&#x27;]</span><br><span class="hljs-string">        &gt;&gt;&gt; get_entities(seq)</span><br><span class="hljs-string">        [(&#x27;PER&#x27;, 0, 1), (&#x27;LOC&#x27;, 3, 3)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># for nested list</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(<span class="hljs-built_in">isinstance</span>(s, <span class="hljs-built_in">list</span>) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> seq):<br>        seq = [item <span class="hljs-keyword">for</span> sublist <span class="hljs-keyword">in</span> seq <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> sublist + [<span class="hljs-string">&#x27;O&#x27;</span>]]<br><br>    prev_tag = <span class="hljs-string">&#x27;O&#x27;</span><br>    prev_type = <span class="hljs-string">&#x27;&#x27;</span><br>    begin_offset = <span class="hljs-number">0</span><br>    chunks = []<br>    <span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(seq + [<span class="hljs-string">&#x27;O&#x27;</span>]):<br>        <span class="hljs-keyword">if</span> suffix:<br>            tag = chunk[-<span class="hljs-number">1</span>]<br>            type_ = chunk.split(<span class="hljs-string">&#x27;-&#x27;</span>)[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">else</span>:<br>            tag = chunk[<span class="hljs-number">0</span>]<br>            type_ = chunk.split(<span class="hljs-string">&#x27;-&#x27;</span>)[-<span class="hljs-number">1</span>]<br><br>        <span class="hljs-keyword">if</span> end_of_chunk(prev_tag, tag, prev_type, type_):<br>            chunks.append((prev_type, begin_offset, i-<span class="hljs-number">1</span>))<br>        <span class="hljs-keyword">if</span> start_of_chunk(prev_tag, tag, prev_type, type_):<br>            begin_offset = i<br>        prev_tag = tag<br>        prev_type = type_<br><br>    <span class="hljs-keyword">return</span> chunks<br></code></pre></td></tr></table></figure><p>è¯¥å‡½æ•°çš„è¾“å…¥ä¸ºæ ‡æ³¨åºåˆ—ï¼Œè¾“å‡ºç»“æœä¸ºå®ä½“åˆ—è¡¨ï¼ŒåŒ…å«å®ä½“ç±»å‹ã€å®ä½“å¼€å§‹ä¸‹æ ‡å’Œç»“æŸä¸‹æ ‡ã€‚</p><p>æˆ‘ä»¬ä»¥æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89pyltp%E7%9A%84%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/">NLPå…¥é—¨ï¼ˆå…­ï¼‰pyltpçš„ä»‹ç»ä¸ä½¿ç”¨</a>ä¸­çš„å‘½åå®ä½“è¯†åˆ«ç¨‹åºä¸ºä¾‹ï¼ŒåŒæ—¶é‡‡ç”¨è‡ªå·±æå–æ ‡æ³¨åºåˆ—ä¸­çš„å®ä½“è¯†åˆ«ä¿¡æ¯å’Œä½¿ç”¨seqevalæ¨¡å—æå–æ ‡æ³¨åºåˆ—ä¸­çš„å®ä½“è¯†åˆ«ä¿¡æ¯ä¸¤ç§æ–¹å¼ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Segmentor, Postagger<br><br><span class="hljs-comment"># åˆ†è¯</span><br>cws_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;ltp_v3.4/cws.model&#x27;</span>)  <span class="hljs-comment"># åˆ†è¯æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`cws.model`</span><br>lexicon_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;ltp_v3.4/lexicon.txt&#x27;</span>)  <span class="hljs-comment"># å‚æ•°lexiconæ˜¯è‡ªå®šä¹‰è¯å…¸çš„æ–‡ä»¶è·¯å¾„</span><br><br>segmentor = Segmentor()<br>segmentor.load_with_lexicon(cws_model_path, lexicon_path)<br><br>sent = <span class="hljs-string">&quot;æ®éŸ©è”ç¤¾12æœˆ28æ—¥åæ˜ ï¼Œç¾å›½é˜²éƒ¨å‘è¨€äººæ°å¤«Â·è«è±å°”27æ—¥è¡¨ç¤ºï¼Œç¾å›½é˜²éƒ¨é•¿ç›–èŒ¨å°†äº2011å¹´1æœˆ14æ—¥è®¿é—®éŸ©å›½ã€‚&quot;</span><br><span class="hljs-comment"># sent = &quot;è®°è€…4æ—¥ä»ä¸­å›½èˆªç©ºå·¥ä¸šé›†å›¢æœ‰é™å…¬å¸è·æ‚‰ï¼ŒAG600é¡¹ç›®ç ”åˆ¶åŠ é€Ÿæ¨è¿›ï¼Œ001æ¶æœºåœ¨æˆåŠŸå®Œæˆé™†ä¸Šã€æ°´ä¸Šã€æµ·ä¸Šé¦–é£ä¹‹åï¼Œäº3æœˆ4æ—¥åœ¨æ¹–åŒ—è†é—¨æ¼³æ²³æœºåœºå®Œæˆç­ç«ä»»åŠ¡ç³»ç»Ÿé¦–æ¬¡ç§‘ç ”è¯•é£ï¼Œé£æœºçŠ¶æ€è‰¯å¥½ã€‚&quot;</span><br><span class="hljs-comment"># sent = &quot;å¤§ä¸´é“è·¯é€šè½¦å½“å¤©ï¼Œ81å²çš„ä½¤æ—è€äººç”°å­¦æ˜ä¸“ç¨‹èµ¶åˆ°ä¸´æ²§ç«™ï¼Œè§‚çœ‹åˆ—è½¦å‘è½¦ã€‚â€œæˆ‘æœ€å¤§çš„æ¢¦æƒ³ï¼Œå°±æ˜¯æœ‰ä¸€å¤©ç«è½¦èƒ½å¼€è¿›é˜¿ä½¤å±±ã€‚ä»Šå¤©ï¼Œæˆ‘çš„æ¢¦æƒ³ç»ˆäºå®ç°äº†ï¼â€&quot;</span><br>words = segmentor.segment(sent)  <span class="hljs-comment"># åˆ†è¯</span><br><br><span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br>pos_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;ltp_v3.4/pos.model&#x27;</span>)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`pos.model`</span><br><br>postagger = Postagger()  <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>postagger.load(pos_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>postags = postagger.postag(words)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br><br><br>ner_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;ltp_v3.4/ner.model&#x27;</span>)   <span class="hljs-comment"># å‘½åå®ä½“è¯†åˆ«æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`pos.model`</span><br><br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> NamedEntityRecognizer<br>recognizer = NamedEntityRecognizer() <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>recognizer.load(ner_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>netags = <span class="hljs-built_in">list</span>(recognizer.recognize(words, postags))  <span class="hljs-comment"># å‘½åå®ä½“è¯†åˆ«</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(words))<br><span class="hljs-built_in">print</span>(netags)<br><br><span class="hljs-comment"># ç”¨è‡ªå·±çš„æ–¹æ³•æå–è¯†åˆ«ç»“æœä¸­çš„äººåï¼Œåœ°åï¼Œç»„ç»‡æœºæ„å</span><br>persons, places, orgs = <span class="hljs-built_in">set</span>(), <span class="hljs-built_in">set</span>(), <span class="hljs-built_in">set</span>()<br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> tag, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(netags, words):<br>    j = i<br>    <span class="hljs-comment"># äººå</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nh&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;S&#x27;</span>):<br>            persons.add(word)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;B&#x27;</span>):<br>            union_person = word<br>            <span class="hljs-keyword">while</span> netags[j] != <span class="hljs-string">&#x27;E-Nh&#x27;</span>:<br>                j += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(words):<br>                    union_person += words[j]<br>            persons.add(union_person)<br>    <span class="hljs-comment"># åœ°å</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Ns&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;S&#x27;</span>):<br>            places.add(word)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;B&#x27;</span>):<br>            union_place = word<br>            <span class="hljs-keyword">while</span> netags[j] != <span class="hljs-string">&#x27;E-Ns&#x27;</span>:<br>                j += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(words):<br>                    union_place += words[j]<br>            places.add(union_place)<br>    <span class="hljs-comment"># æœºæ„å</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Ni&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;S&#x27;</span>):<br>            orgs.add(word)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;B&#x27;</span>):<br>            union_org = word<br>            <span class="hljs-keyword">while</span> netags[j] != <span class="hljs-string">&#x27;E-Ni&#x27;</span>:<br>                j += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(words):<br>                    union_org += words[j]<br>            orgs.add(union_org)<br><br>    i += <span class="hljs-number">1</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;äººåï¼š&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>.join(persons))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;åœ°åï¼š&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>.join(places))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»„ç»‡æœºæ„ï¼š&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>.join(orgs))<br><br><span class="hljs-comment"># ç”¨seqevalæå–è¯†åˆ«ç»“æœä¸­çš„äººåï¼Œåœ°åï¼Œç»„ç»‡æœºæ„å</span><br><span class="hljs-keyword">from</span> seqeval.metrics.sequence_labeling <span class="hljs-keyword">import</span> get_entities<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br>seq_result = get_entities(netags)<br>words = <span class="hljs-built_in">list</span>(words)<br>ner_result_dict = defaultdict(<span class="hljs-built_in">list</span>)<br><span class="hljs-keyword">for</span> seq_res <span class="hljs-keyword">in</span> seq_result:<br>    ner_result_dict[seq_res[<span class="hljs-number">0</span>]].append(<span class="hljs-string">&quot;&quot;</span>.join(words[seq_res[<span class="hljs-number">1</span>]:seq_res[<span class="hljs-number">2</span>]+<span class="hljs-number">1</span>]))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;äººåï¼š&#x27;</span>, ner_result_dict[<span class="hljs-string">&quot;Nh&quot;</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;åœ°åï¼š&#x27;</span>, ner_result_dict[<span class="hljs-string">&quot;Ns&quot;</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»„ç»‡æœºæ„ï¼š&#x27;</span>, ner_result_dict[<span class="hljs-string">&quot;Ni&quot;</span>])<br><br><span class="hljs-comment"># é‡Šæ”¾æ¨¡å‹</span><br>segmentor.release()<br>postagger.release()<br>recognizer.release()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;æ®&#x27;</span>, <span class="hljs-string">&#x27;éŸ©è”ç¤¾&#x27;</span>, <span class="hljs-string">&#x27;12æœˆ&#x27;</span>, <span class="hljs-string">&#x27;28æ—¥&#x27;</span>, <span class="hljs-string">&#x27;åæ˜ &#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;ç¾&#x27;</span>, <span class="hljs-string">&#x27;å›½é˜²éƒ¨&#x27;</span>, <span class="hljs-string">&#x27;å‘è¨€äºº&#x27;</span>, <span class="hljs-string">&#x27;æ°å¤«Â·è«è±å°”&#x27;</span>, <span class="hljs-string">&#x27;27æ—¥&#x27;</span>, <span class="hljs-string">&#x27;è¡¨ç¤º&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;ç¾&#x27;</span>, <span class="hljs-string">&#x27;å›½é˜²éƒ¨é•¿&#x27;</span>, <span class="hljs-string">&#x27;ç›–èŒ¨&#x27;</span>, <span class="hljs-string">&#x27;å°†&#x27;</span>, <span class="hljs-string">&#x27;äº&#x27;</span>, <span class="hljs-string">&#x27;2011å¹´&#x27;</span>, <span class="hljs-string">&#x27;1æœˆ&#x27;</span>, <span class="hljs-string">&#x27;14æ—¥&#x27;</span>, <span class="hljs-string">&#x27;è®¿é—®&#x27;</span>, <span class="hljs-string">&#x27;éŸ©å›½&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>]</span><br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Ni&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-Ni&#x27;</span>, <span class="hljs-string">&#x27;E-Ni&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Nh&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Ns&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Nh&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Ns&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>äººåï¼š ç›–èŒ¨ï¼Œæ°å¤«Â·è«è±å°”<br>åœ°åï¼š éŸ©å›½ï¼Œç¾<br>ç»„ç»‡æœºæ„ï¼š ç¾å›½é˜²éƒ¨ï¼ŒéŸ©è”ç¤¾<br>äººåï¼š <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;æ°å¤«Â·è«è±å°”&#x27;</span>, <span class="hljs-string">&#x27;ç›–èŒ¨&#x27;</span>]</span><br>åœ°åï¼š <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;ç¾&#x27;</span>, <span class="hljs-string">&#x27;éŸ©å›½&#x27;</span>]</span><br>ç»„ç»‡æœºæ„ï¼š <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;éŸ©è”ç¤¾&#x27;</span>, <span class="hljs-string">&#x27;ç¾å›½é˜²éƒ¨&#x27;</span>]</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å°è¯•ä¸¤ä¸ªå¥å­ï¼Œè¯†åˆ«ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;è®°è€…&#x27;</span>, <span class="hljs-string">&#x27;4æ—¥&#x27;</span>, <span class="hljs-string">&#x27;ä»&#x27;</span>, <span class="hljs-string">&#x27;ä¸­å›½&#x27;</span>, <span class="hljs-string">&#x27;èˆªç©º&#x27;</span>, <span class="hljs-string">&#x27;å·¥ä¸š&#x27;</span>, <span class="hljs-string">&#x27;é›†å›¢&#x27;</span>, <span class="hljs-string">&#x27;æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-string">&#x27;è·æ‚‰&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;AG600&#x27;</span>, <span class="hljs-string">&#x27;é¡¹ç›®&#x27;</span>, <span class="hljs-string">&#x27;ç ”åˆ¶&#x27;</span>, <span class="hljs-string">&#x27;åŠ é€Ÿ&#x27;</span>, <span class="hljs-string">&#x27;æ¨è¿›&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;001æ¶æœº&#x27;</span>, <span class="hljs-string">&#x27;åœ¨&#x27;</span>, <span class="hljs-string">&#x27;æˆåŠŸ&#x27;</span>, <span class="hljs-string">&#x27;å®Œæˆ&#x27;</span>, <span class="hljs-string">&#x27;é™†ä¸Š&#x27;</span>, <span class="hljs-string">&#x27;ã€&#x27;</span>, <span class="hljs-string">&#x27;æ°´ä¸Š&#x27;</span>, <span class="hljs-string">&#x27;ã€&#x27;</span>, <span class="hljs-string">&#x27;æµ·ä¸Š&#x27;</span>, <span class="hljs-string">&#x27;é¦–&#x27;</span>, <span class="hljs-string">&#x27;é£&#x27;</span>, <span class="hljs-string">&#x27;ä¹‹å&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;äº&#x27;</span>, <span class="hljs-string">&#x27;3æœˆ&#x27;</span>, <span class="hljs-string">&#x27;4æ—¥&#x27;</span>, <span class="hljs-string">&#x27;åœ¨&#x27;</span>, <span class="hljs-string">&#x27;æ¹–åŒ—&#x27;</span>, <span class="hljs-string">&#x27;è†é—¨&#x27;</span>, <span class="hljs-string">&#x27;æ¼³æ²³&#x27;</span>, <span class="hljs-string">&#x27;æœºåœº&#x27;</span>, <span class="hljs-string">&#x27;å®Œæˆ&#x27;</span>, <span class="hljs-string">&#x27;ç­ç«&#x27;</span>, <span class="hljs-string">&#x27;ä»»åŠ¡&#x27;</span>, <span class="hljs-string">&#x27;ç³»ç»Ÿ&#x27;</span>, <span class="hljs-string">&#x27;é¦–&#x27;</span>, <span class="hljs-string">&#x27;æ¬¡&#x27;</span>, <span class="hljs-string">&#x27;ç§‘ç ”&#x27;</span>, <span class="hljs-string">&#x27;è¯•é£&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;é£æœº&#x27;</span>, <span class="hljs-string">&#x27;çŠ¶æ€&#x27;</span>, <span class="hljs-string">&#x27;è‰¯å¥½&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>]</span><br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-Ni&#x27;</span>, <span class="hljs-string">&#x27;I-Ni&#x27;</span>, <span class="hljs-string">&#x27;I-Ni&#x27;</span>, <span class="hljs-string">&#x27;I-Ni&#x27;</span>, <span class="hljs-string">&#x27;E-Ni&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-Ns&#x27;</span>, <span class="hljs-string">&#x27;I-Ns&#x27;</span>, <span class="hljs-string">&#x27;I-Ns&#x27;</span>, <span class="hljs-string">&#x27;E-Ns&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>äººåï¼š <br>åœ°åï¼š æ¹–åŒ—è†é—¨æ¼³æ²³æœºåœº<br>ç»„ç»‡æœºæ„ï¼š ä¸­å›½èˆªç©ºå·¥ä¸šé›†å›¢æœ‰é™å…¬å¸<br>äººåï¼š <span class="hljs-selector-attr">[]</span><br>åœ°åï¼š <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;æ¹–åŒ—è†é—¨æ¼³æ²³æœºåœº&#x27;</span>]</span><br>ç»„ç»‡æœºæ„ï¼š <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;ä¸­å›½èˆªç©ºå·¥ä¸šé›†å›¢æœ‰é™å…¬å¸&#x27;</span>]</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;å¤§ä¸´é“è·¯&#x27;</span>, <span class="hljs-string">&#x27;é€šè½¦&#x27;</span>, <span class="hljs-string">&#x27;å½“å¤©&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;81&#x27;</span>, <span class="hljs-string">&#x27;å²&#x27;</span>, <span class="hljs-string">&#x27;çš„&#x27;</span>, <span class="hljs-string">&#x27;ä½¤æ—&#x27;</span>, <span class="hljs-string">&#x27;è€äºº&#x27;</span>, <span class="hljs-string">&#x27;ç”°å­¦æ˜&#x27;</span>, <span class="hljs-string">&#x27;ä¸“ç¨‹&#x27;</span>, <span class="hljs-string">&#x27;èµ¶åˆ°&#x27;</span>, <span class="hljs-string">&#x27;ä¸´æ²§ç«™&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;è§‚çœ‹&#x27;</span>, <span class="hljs-string">&#x27;åˆ—è½¦&#x27;</span>, <span class="hljs-string">&#x27;å‘è½¦&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>, <span class="hljs-string">&#x27;â€œ&#x27;</span>, <span class="hljs-string">&#x27;æˆ‘&#x27;</span>, <span class="hljs-string">&#x27;æœ€&#x27;</span>, <span class="hljs-string">&#x27;å¤§&#x27;</span>, <span class="hljs-string">&#x27;çš„&#x27;</span>, <span class="hljs-string">&#x27;æ¢¦æƒ³&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;å°±&#x27;</span>, <span class="hljs-string">&#x27;æ˜¯&#x27;</span>, <span class="hljs-string">&#x27;æœ‰&#x27;</span>, <span class="hljs-string">&#x27;ä¸€&#x27;</span>, <span class="hljs-string">&#x27;å¤©&#x27;</span>, <span class="hljs-string">&#x27;ç«è½¦&#x27;</span>, <span class="hljs-string">&#x27;èƒ½&#x27;</span>, <span class="hljs-string">&#x27;å¼€è¿›&#x27;</span>, <span class="hljs-string">&#x27;é˜¿ä½¤å±±&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>, <span class="hljs-string">&#x27;ä»Šå¤©&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;æˆ‘&#x27;</span>, <span class="hljs-string">&#x27;çš„&#x27;</span>, <span class="hljs-string">&#x27;æ¢¦æƒ³&#x27;</span>, <span class="hljs-string">&#x27;ç»ˆäº&#x27;</span>, <span class="hljs-string">&#x27;å®ç°&#x27;</span>, <span class="hljs-string">&#x27;äº†&#x27;</span>, <span class="hljs-string">&#x27;ï¼&#x27;</span>, <span class="hljs-string">&#x27;â€&#x27;</span>]</span><br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Nh&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Ns&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>äººåï¼š ç”°å­¦æ˜<br>åœ°åï¼š é˜¿ä½¤å±±<br>ç»„ç»‡æœºæ„ï¼š <br>äººåï¼š <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;ç”°å­¦æ˜&#x27;</span>]</span><br>åœ°åï¼š <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;é˜¿ä½¤å±±&#x27;</span>]</span><br>ç»„ç»‡æœºæ„ï¼š <span class="hljs-selector-attr">[]</span><br></code></pre></td></tr></table></figure><p>ä»ä¸Šæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p><ul><li><p>ä½¿ç”¨seqevalçš„å®ç°æ–¹å¼ä¸è‡ªå·±çš„å®ç°æ–¹å¼æ•ˆæœä¸€è‡´ï¼›</p></li><li><p>seqevalçš„å®ç°æ–¹å¼æ›´åŠ ç®€æ´é«˜æ•ˆï¼Œä»ä»£ç ä¸Šçœ‹ï¼Œseqevalåªéœ€3-4è¡Œä»£ç ï¼Œè€Œè‡ªå·±å®ç°éœ€20-30è¡Œä»£ç ã€‚</p><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨seqevalæ¨¡å—å¿«é€Ÿåœ°ä»æ ‡æ³¨åºåˆ—ä¸­æå–å®ä½“è¯†åˆ«ç»“æœï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨åšå‘½åå®ä½“è¯†åˆ«ä»»åŠ¡æ—¶ç»å¸¸ä¼šç¢°åˆ°çš„é—®é¢˜ï¼Œä½¿ç”¨seqevalèƒ½å¤Ÿæå‡æˆ‘ä»¬çš„å·¥ä½œæ•ˆæœï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ä¼˜é›…ã€‚</p><p>æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»~</p><p>2021å¹´3æœˆ5æ—¥äºä¸Šæµ·æ¨æµ¦</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åä¹ï¼‰ä½¿ç”¨keras-bertå®ç°å®Œå½¢å¡«ç©ºåŠç®€å•çš„æ–‡æœ¬çº é”™åŠŸèƒ½</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%AE%8C%E5%BD%A2%E5%A1%AB%E7%A9%BA%E5%8F%8A%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99%E5%8A%9F%E8%83%BD/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B9%9D%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%AE%8C%E5%BD%A2%E5%A1%AB%E7%A9%BA%E5%8F%8A%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99%E5%8A%9F%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨ä¹‹å‰çš„ç³»åˆ—æ–‡ç« ä¸­ï¼Œç¬”è€…ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨keras-bertæ¥è°ƒç”¨BERTæ¨¡å‹ï¼Œå®ç°æ–‡æœ¬å¤šåˆ†ç±»ï¼Œæ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»¥åŠåºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼Œæ–‡ç« å¦‚ä¸‹ï¼š</p><ul><li><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a></li><li></li><li><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åäº”ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡</a></li><li></li><li><ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå…­ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡</a></li></ul><p>åœ¨æœ¬æ–‡ä¸­ï¼Œç¬”è€…å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨keras-bertæ¥è°ƒç”¨BERTæ¨¡å‹ä½¿ç”¨å®Œå½¢å¡«ç©ºåŠç®€å•çš„æ–‡æœ¬çº é”™åŠŸèƒ½ã€‚</p><h3 id="å®Œå½¢å¡«ç©º">å®Œå½¢å¡«ç©º</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸‹ä»€ä¹ˆæ˜¯å®Œå½¢å¡«ç©ºã€‚æ‰€è°“å®Œå½¢å¡«ç©ºï¼ŒæŒ‡çš„æ˜¯å°†å¥å­ä¸­ç¼ºå¤±çš„å•è¯ï¼ˆæˆ–å­—ï¼‰è¡¥å……æˆæ­£ç¡®çš„å•è¯ï¼ˆæˆ–å­—ï¼‰ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure><img src="/img/nlp39_1.png" alt="å®Œå½¢å¡«ç©ºçš„ä¾‹å­" /><figcaption aria-hidden="true">å®Œå½¢å¡«ç©ºçš„ä¾‹å­</figcaption></figure><p>åœ¨ä¸Šå›¾ä¸­ï¼Œç¬¬ä¸€è¡Œæ˜¯åŸå§‹å¥å­ï¼Œç¬¬äºŒè¡Œæ˜¯éœ€è¦å®Œå½¢å¡«ç©ºçš„å¥å­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æŠŠé—µè¡ŒåŒºçš„è¡Œå­—ç¼ºå¤±æ‰ï¼Œå³MASKæ‰ï¼Œç¬¬ä¸‰è¡Œä¸ºè¡¥å……çš„æ±‰å­—ï¼šè¡Œã€‚</p><p>åœ¨BERTæ¨¡å‹ä¸­ï¼Œå®ƒçš„ä»»åŠ¡æ˜¯ç”±ä¸¤ä¸ªè‡ªç›‘ç£ä»»åŠ¡ç»„æˆï¼Œå³MLMå’ŒNSPã€‚æˆ‘ä»¬éœ€è¦äº†è§£ä¸‹MLMã€‚</p><p>MLMçš„å…¨ç§°æ˜¯Masked LanguageModelï¼Œæ‰€è°“MLMæ˜¯æŒ‡åœ¨è®­ç»ƒçš„æ—¶å€™éšå³ä»è¾“å…¥é¢„æ–™ä¸Šmaskæ‰ä¸€äº›å•è¯ï¼Œç„¶åé€šè¿‡çš„ä¸Šä¸‹æ–‡é¢„æµ‹è¯¥å•è¯ï¼Œè¯¥ä»»åŠ¡éå¸¸åƒæˆ‘ä»¬åœ¨ä¸­å­¦æ—¶æœŸç»å¸¸åšçš„å®Œå½¢å¡«ç©ºã€‚</p><p>åœ¨BERTçš„å®éªŒä¸­ï¼Œ15%çš„WordPieceTokenä¼šè¢«éšæœºMaskæ‰ã€‚åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œä¸€ä¸ªå¥å­ä¼šè¢«å¤šæ¬¡å–‚åˆ°æ¨¡å‹ä¸­ç”¨äºå‚æ•°å­¦ä¹ ï¼Œä½†æ˜¯Googleå¹¶æ²¡æœ‰åœ¨æ¯æ¬¡éƒ½maskæ‰è¿™äº›å•è¯ï¼Œè€Œæ˜¯åœ¨ç¡®å®šè¦Maskæ‰çš„å•è¯ä¹‹åï¼Œ80%çš„æ—¶å€™ä¼šç›´æ¥æ›¿æ¢ä¸º[Mask]ï¼Œ10%çš„æ—¶å€™å°†å…¶æ›¿æ¢ä¸ºå…¶å®ƒä»»æ„å•è¯ï¼Œ10%çš„æ—¶å€™ä¼šä¿ç•™åŸå§‹Tokenã€‚</p><p>åŸºäºBERTæ¨¡å‹çš„è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å°è¯•ç€åˆ©ç”¨keras-bertæ¥è°ƒç”¨å®ƒè§£å†³å®Œå½¢å¡«ç©ºé—®é¢˜ã€‚å®ç°å®Œå½¢å¡«ç©ºçš„ä»£ç ï¼ˆ<code>cloze_predict.py</code>ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> Tokenizer<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> load_trained_model_from_checkpoint<br><br><span class="hljs-comment"># åŠ è½½è¯å…¸</span><br>dict_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/vocab.txt&#x27;</span><br>token_dict = &#123;&#125;<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(dict_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> reader:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> reader:<br>        token = line.strip()<br>        token_dict[token] = <span class="hljs-built_in">len</span>(token_dict)<br><br>id_token_dict = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> token_dict.items()&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OurTokenizer</span>(<span class="hljs-title class_ inherited__">Tokenizer</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_tokenize</span>(<span class="hljs-params">self, text</span>):<br>        R = []<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text:<br>            <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> self._token_dict:<br>                R.append(c)<br>            <span class="hljs-keyword">else</span>:<br>                R.append(<span class="hljs-string">&#x27;[UNK]&#x27;</span>)<br>        <span class="hljs-keyword">return</span> R<br><br><br>tokenizer = OurTokenizer(token_dict)<br><br><span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>model_path = <span class="hljs-string">&quot;./chinese_L-12_H-768_A-12/&quot;</span><br>bert_model = load_trained_model_from_checkpoint(<br>    model_path + <span class="hljs-string">&quot;bert_config.json&quot;</span>,<br>    model_path + <span class="hljs-string">&quot;bert_model.ckpt&quot;</span>,<br>    training=<span class="hljs-literal">True</span><br>)<br><span class="hljs-comment"># bert_model.summary()</span><br><br><br><span class="hljs-comment"># å®Œå½¢å¡«ç©ºï¼Œé¢„æµ‹MASKçš„å­—ç¬¦</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_mask_character</span>(<span class="hljs-params">start_string, mask_num, end_string</span>):<br>    string = <span class="hljs-built_in">list</span>(start_string) + [<span class="hljs-string">&#x27;MASK&#x27;</span>] * mask_num + <span class="hljs-built_in">list</span>(end_string)<br>    token_ids, segment_ids = tokenizer.encode(string, max_len=<span class="hljs-number">512</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(mask_num):<br>        token_ids[<span class="hljs-built_in">len</span>(start_string)+i+<span class="hljs-number">1</span>] = tokenizer._token_dict[<span class="hljs-string">&#x27;[MASK]&#x27;</span>]<br><br>    <span class="hljs-comment"># mask</span><br>    masks = [<span class="hljs-number">0</span>] * <span class="hljs-number">512</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(mask_num):<br>        masks[<span class="hljs-built_in">len</span>(start_string)+i+<span class="hljs-number">1</span>] = <span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹è¢«maskæ‰çš„éƒ¨åˆ†</span><br>    predicts = bert_model.predict([np.array([token_ids]), np.array([segment_ids]), np.array([masks])])[<span class="hljs-number">0</span>]<br>    pred_indice = predicts[<span class="hljs-number">0</span>][<span class="hljs-built_in">len</span>(start_string)+<span class="hljs-number">1</span>:<span class="hljs-built_in">len</span>(start_string)+mask_num+<span class="hljs-number">1</span>].argmax(axis=<span class="hljs-number">1</span>).tolist()<br>    <span class="hljs-keyword">return</span> [id_token_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> pred_indice]<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># åŸå¥1ï¼š ç™½äº‘å±±ï¼Œä½äºå¹¿ä¸œçœå¹¿å·å¸‚ç™½äº‘åŒºï¼Œä¸ºå—ç²¤åå±±ä¹‹ä¸€ï¼Œè‡ªå¤å°±æœ‰â€œç¾ŠåŸç¬¬ä¸€ç§€â€ä¹‹ç§°ã€‚</span><br>    start_str1 = <span class="hljs-string">&quot;ç™½äº‘å±±ï¼Œä½äº&quot;</span><br>    end_str1 = <span class="hljs-string">&quot;å¹¿å·å¸‚ç™½äº‘åŒºï¼Œä¸ºå—ç²¤åå±±ä¹‹ä¸€ï¼Œè‡ªå¤å°±æœ‰â€œç¾ŠåŸç¬¬ä¸€ç§€â€ä¹‹ç§°ã€‚&quot;</span><br>    pred_chars = get_mask_character(start_str1, <span class="hljs-number">3</span>, end_str1)<br>    <span class="hljs-built_in">print</span>(pred_chars)<br><br>    <span class="hljs-comment"># åŸå¥2ï¼šé¦–å…ˆï¼Œä»å¸‚å€¼çœ‹ï¼Œè…¾è®¯å’Œé˜¿é‡Œå¸‚å€¼å·²ç»æœ‰2500äº¿ï¼Œè€Œç™¾åº¦æ‰500å¤šäº¿ï¼Œæ˜¯BATä½“é‡ä¸­æœ€å°çš„ä¸€å®¶å…¬å¸ã€‚</span><br>    start_str2 = <span class="hljs-string">&quot;é¦–å…ˆï¼Œä»&quot;</span><br>    end_str2 = <span class="hljs-string">&quot;çœ‹ï¼Œè…¾è®¯å’Œé˜¿é‡Œå¸‚å€¼å·²ç»æœ‰2500äº¿ï¼Œè€Œç™¾åº¦æ‰500å¤šäº¿ï¼Œæ˜¯BATä½“é‡ä¸­æœ€å°çš„ä¸€å®¶å…¬å¸ã€‚&quot;</span><br>    pred_chars = get_mask_character(start_str2, <span class="hljs-number">2</span>, end_str2)<br>    <span class="hljs-built_in">print</span>(pred_chars)<br><br>    <span class="hljs-comment"># åŸå¥3ï¼šç‰¹æ–¯æ‹‰CEOåŸƒéš†Â·é©¬æ–¯å…‹çš„ä¸ªäººå‡€èµ„äº§å‡è‡³1850äº¿ç¾å…ƒï¼Œè¶…è¶Šäºšé©¬é€ŠCEOè´ç´¢æ–¯è£ç™»å…¨çƒç¬¬ä¸€å¤§å¯Œè±ªã€‚</span><br>    start_str3 = <span class="hljs-string">&quot;ç‰¹æ–¯æ‹‰CEOåŸƒéš†Â·é©¬æ–¯å…‹çš„ä¸ªäººå‡€èµ„äº§å‡è‡³1850äº¿ç¾å…ƒï¼Œè¶…è¶Šäºšé©¬é€ŠCEOè´ç´¢æ–¯è£ç™»&quot;</span><br>    end_str3 = <span class="hljs-string">&quot;ç¬¬ä¸€å¤§å¯Œè±ªã€‚&quot;</span><br>    pred_chars = get_mask_character(start_str3, <span class="hljs-number">2</span>, end_str3)<br>    <span class="hljs-built_in">print</span>(pred_chars)<br><br>    <span class="hljs-comment"># åŸå¥4ï¼šæˆ‘åœ¨ä¸Šæµ·é—µè¡ŒåŒºå·¥ä½œã€‚</span><br>    start_str4 = <span class="hljs-string">&quot;æˆ‘åœ¨ä¸Šæµ·é—µ&quot;</span><br>    end_str4 = <span class="hljs-string">&quot;åŒºå·¥ä½œã€‚&quot;</span><br>    pred_chars = get_mask_character(start_str4, <span class="hljs-number">1</span>, end_str4)<br>    <span class="hljs-built_in">print</span>(pred_chars)<br></code></pre></td></tr></table></figure><p>æ³¨æ„keras-bertæ¥è°ƒç”¨BERTæ—¶ï¼Œå¦‚æœéœ€è¦å¼€å¯MLMå’ŒNSPä»»åŠ¡æ—¶ï¼Œéœ€è¦å°†trainingè®¾ç½®ä¸ºTrueï¼Œç„¶åå†è°ƒç”¨MLMæ¨¡å‹å¯¹æ–‡æœ¬ä¸­MASKæ‰çš„éƒ¨åˆ†è¿›è¡Œé¢„æµ‹ã€‚è¿è¡Œè„šæœ¬çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;å¹¿</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸œ</span>&#x27;, <span class="hljs-symbol">&#x27;çœ</span>&#x27;]<br>[<span class="hljs-symbol">&#x27;å¸‚</span>&#x27;, <span class="hljs-symbol">&#x27;å€¼</span>&#x27;]<br>[<span class="hljs-symbol">&#x27;å…¨</span>&#x27;, <span class="hljs-symbol">&#x27;çƒ</span>&#x27;]<br>[<span class="hljs-symbol">&#x27;è¡Œ</span>&#x27;]<br></code></pre></td></tr></table></figure><h3 id="ç®€å•çš„æ–‡æœ¬çº é”™åŠŸèƒ½">ç®€å•çš„æ–‡æœ¬çº é”™åŠŸèƒ½</h3><p>åŸºäºä¸Šè¿°çš„å®Œå½¢å¡«ç©ºï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®Œæˆç®€å•çš„æ–‡æœ¬çº é”™åŠŸèƒ½ï¼Œå‰ææ˜¯æˆ‘ä»¬å·²ç»çŸ¥é“æ–‡æœ¬çš„å“ªä¸ªå­—æ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”è¿›è¡Œä¸€å¯¹ä¸€çº é”™ï¼Œå³æŠŠè¿™ä¸ªå­—çº æ­£ä¸ºæ­£ç¡®çš„å­—ï¼Œå¹¶ä¸ä¼šå°†å…¶å»æ‰æˆ–è€…æ·»åŠ å…¶å®ƒå­—ã€‚æˆ‘ä»¬çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼šåœ¨çŸ¥é“æ–‡æœ¬ä¸­çš„å“ªä¸ªå­—æ˜¯é”™è¯¯çš„ä¹‹åï¼Œå°†å…¶MASKæ‰ï¼Œè½¬åŒ–ä¸ºå®Œå½¢å¡«ç©ºä»»åŠ¡ï¼Œä»è€Œé¢„æµ‹å‡ºMASKæ‰çš„å­—ä½œä¸ºçº æ­£åçš„å­—ã€‚</p><p>å®ç°ç®€å•çš„æ–‡æœ¬çº é”™åŠŸèƒ½çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># è¯¥è„šæœ¬ä½¿ç”¨BERTçš„maskæŠ€æœ¯è¿›è¡Œæ–‡æœ¬çº é”™</span><br><span class="hljs-keyword">from</span> cloze_predict <span class="hljs-keyword">import</span> get_mask_character<br><br>sentence = <span class="hljs-string">&quot;æˆ‘è¦å»åŸƒåŠé‡‘å­å¡”ç©ã€‚&quot;</span>  <span class="hljs-comment"># é‡‘å­å¡”ä¸­çš„å­ä¸ºé”™åˆ«å­—</span><br>sentence = <span class="hljs-string">&quot;ç™½äº‘å±±ï¼Œä½äºå¹¿ä¸œçœå¹¿å·å¸‚ç™½äº‘åŒºï¼Œä¸ºå—ç²¤åå±±ä¹‹ä¸€ï¼Œè‡ªå¤å°±æœ‰â€œç¾ŠåŸç¬¬ä¸€ç§€â€åªç§°ã€‚&quot;</span>  <span class="hljs-comment"># åªç§°ä¸­çš„åªä¸ºé”™åˆ«å­—</span><br>sentence = <span class="hljs-string">&quot;è¯·æŠŠè¿™ä¸ªå¿«é€’é€åˆ°ä¸Šæµ·å¸‚é—µèˆªåŒºã€‚&quot;</span>  <span class="hljs-comment"># é—µèˆªåŒºä¸­çš„èˆªä¸ºé”™åˆ«å­—</span><br>sentence = <span class="hljs-string">&quot;å°‘å…ˆé˜Ÿå‘˜å› è¯¥ä¸ºè€äººè®©å&quot;</span>  <span class="hljs-comment"># å› è¯¥ä¸­çš„å› ä¸ºé”™åˆ«å­—</span><br>sentence = <span class="hljs-string">&quot;éšç„¶ä»Šå¤©å¾ˆçƒ­&quot;</span>  <span class="hljs-comment"># éšç„¶ä¸­çš„éšä¸ºé”™åˆ«å­—</span><br>sentence = <span class="hljs-string">&quot;æˆ‘ç”Ÿç—…äº†,å’³æ•°äº†å¥½å‡ å¤©&quot;</span>  <span class="hljs-comment"># å’³æ•°ä¸­çš„æ•°ä¸ºé”™åˆ«å­—</span><br>sentence = <span class="hljs-string">&quot;ä¸€ç¾¤ç½—å¨çº³çŠ¬å®å®æ‰“æ¶ï¼Œåœºé¢æ„Ÿå¿ã€‚&quot;</span>  <span class="hljs-comment"># æ„Ÿå¿ä¸­çš„å¿ä¸ºé”™åˆ«å­—</span><br>wrong_char_index = sentence.index(<span class="hljs-string">&quot;å¿&quot;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(sentence)):<br>    <span class="hljs-keyword">if</span> i == wrong_char_index:<br>        start_string = sentence[:i]<br>        end_string = sentence[i+<span class="hljs-number">1</span>:]<br>        pred_char = get_mask_character(start_string, <span class="hljs-number">1</span>, end_string)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;wrong char: &#123;&#125;, correct char: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(sentence[i], pred_char[<span class="hljs-number">0</span>]))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">wrong <span class="hljs-type">char</span>: å¿, correct <span class="hljs-type">char</span>: äºº<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–‡æœ¬çº é”™æ–¹å¼åˆ©ç”¨äº†BERTçš„MLMæ¨¡å‹æ¥å®ç°çš„ï¼Œæœ‰ä¸€å®šçš„æ•ˆæœï¼Œä½†ä¸èƒ½ä½œä¸ºæ–‡æœ¬çº é”™çš„å®Œç¾å®ç°æ–¹å¼ï¼Œåªæ˜¯ä½œä¸ºæ–‡æœ¬çº é”™çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå®é™…ä¸Šï¼Œç°å®ä¸­çš„æ–‡æœ¬çº é”™æ˜¯ç”±å¤šç§æ¨¡å‹ç»„æˆçš„å¤æ‚ç­–ç•¥å®ç°çš„ï¼Œè¿˜å¾—è€ƒè™‘æ•ˆæœå’Œè¿è¡Œæ•ˆç‡ç­‰å› ç´ ã€‚å¦å¤–ï¼ŒçœŸæ­£çš„æ–‡æœ¬çº é”™è¿˜åº”å½“èƒ½æŒ‡å‡ºæ–‡æœ¬ä¸­å“ªä¸ªå­—é”™äº†å¹¶å¯¹å…¶çº é”™ï¼Œæœ¬æ–‡åªè€ƒè™‘äº†åä¸€æ­¥ï¼Œè€Œæ²¡æœ‰æŒ‡å‡ºæ–‡æœ¬ä¸­å“ªä¸ªå­—é”™äº†ï¼Œåªèƒ½ç®—æ–‡æœ¬çº é”™çš„ä¸€æ¬¡å°è¯•ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ç»™å‡ºçš„è„šæœ¬å·²ä¸Šä¼ è‡³Githubï¼Œç½‘å€ä¸ºï¼šhttps://github.com/percent4/keras_bert_clozeï¼Œä¸Šé¢æœ‰æ›´å¤šçš„ä¾‹å­ï¼Œæ¬¢è¿å¤§å®¶å‚è€ƒ~</p><p>æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»~</p><p>2021.1.24äºä¸Šæµ·æµ¦ä¸œ</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>keras-bert</tag>
      
      <tag>å®Œå½¢å¡«ç©º</tag>
      
      <tag>æ–‡æœ¬çº é”™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åå…«ï¼‰ä½¿ç”¨keras-bertè°ƒç”¨ALBERTæ¨¡å‹å®ç°æ–‡æœ¬åˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ã€åºåˆ—æ ‡æ³¨ä»»åŠ¡</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E8%B0%83%E7%94%A8ALBERT%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E3%80%81%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E3%80%81%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E8%B0%83%E7%94%A8ALBERT%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E3%80%81%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E3%80%81%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨ç³»åˆ—æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a>ã€<ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åäº”ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡</a>ã€<ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå…­ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨keras-bertæ¨¡å—æ¥è°ƒç”¨BERTç­‰æ¨¡å‹æ¥å®ç°æ–‡æœ¬åˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ã€åºåˆ—æ ‡æ³¨ä»»åŠ¡ã€‚</p><p>åœ¨ç³»åˆ—æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåäºŒï¼‰åˆ©ç”¨ALBERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</a>ã€<ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%94%EF%BC%89%E5%AE%9E%E7%8E%B0ALBERT-Bi-LSTM-CRF%E6%A8%A1%E5%9E%8B/">NLPï¼ˆäºŒåäº”ï¼‰å®ç°ALBERT+Bi-LSTM+CRFæ¨¡å‹</a>ã€<ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%85%AB%EF%BC%89%E5%A4%9A%E6%A0%87%E7%AD%BE%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåå…«ï¼‰å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»</a>ä¸­ï¼Œç¬”è€…å°†ALBERTæ¨¡å‹ä½œä¸ºç‰¹å¾å‘é‡æå–å·¥å…·ï¼Œå®ç°äº†æ–‡æœ¬åˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ã€åºåˆ—æ ‡æ³¨ä»»åŠ¡ã€‚</p><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨keras-bertè°ƒç”¨ALBERTæ¨¡å‹å®ç°æ–‡æœ¬åˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ã€åºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼Œå…¶æ¨¡å‹æ•ˆæœæ¯”å•çº¯å°†ALBERTæ¨¡å‹ä½œä¸ºç‰¹å¾å‘é‡æå–å·¥å…·çš„æ•ˆæœè‚¯å®šæ¥å¾—å¥½ã€‚</p><p>ä½¿ç”¨keras-bertè°ƒç”¨ALBERTæ¨¡å‹å®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡çš„Githubé¡¹ç›®ç½‘å€ï¼š<ahref="https://github.com/percent4/keras_albert_text_classification">https://github.com/percent4/keras_albert_text_classification</a>ã€‚</p><p>ä½¿ç”¨keras-bertè°ƒç”¨ALBERTæ¨¡å‹å®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡çš„Githubé¡¹ç›®ç½‘å€ï¼š<ahref="https://github.com/percent4/keras_albert_multi_label_cls">https://github.com/percent4/keras_albert_multi_label_cls</a>ã€‚</p><p>ä½¿ç”¨keras-bertè°ƒç”¨ALBERTæ¨¡å‹å®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡çš„Githubé¡¹ç›®ç½‘å€ï¼š<ahref="https://github.com/percent4/keras_albert_sequence_labeling">https://github.com/percent4/keras_albert_sequence_labeling</a>ã€‚</p><h3id="å¦‚ä½•ä½¿ç”¨keras-bertè°ƒç”¨albertæ¨¡å‹">å¦‚ä½•ä½¿ç”¨keras-bertè°ƒç”¨ALBERTæ¨¡å‹</h3><p>keras-bertæ¨¡å—çš„è®¾è®¡ä¹‹åˆæ˜¯ä¸ºäº†æ”¯æŒBERTç³»åˆ—æ¨¡å‹ï¼Œå®ƒå¹¶ä¸æ”¯æŒALBERTæ¨¡å‹ã€‚ä½†åœ¨å¼€æºä¸–ç•ŒGithubä¸­æœ‰ä¸ªé¡¹ç›®åä¸º<code>keras_albert_model</code>ï¼Œå…¶ç½‘å€ä¸ºï¼š<ahref="https://github.com/TinkerMob/keras_albert_model">https://github.com/TinkerMob/keras_albert_model</a>ï¼Œåˆ©ç”¨è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°è®©keras-bertæ”¯æŒALBERTæ¨¡å‹ã€‚</p><p>ä¸‹è½½è¯¥é¡¹ç›®ä¸­çš„albert.pyè„šæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ç¤ºä¾‹ä»£ç æ¥è°ƒç”¨ALBERT-tinyæ¨¡å‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> albert <span class="hljs-keyword">import</span> load_brightmart_albert_zh_checkpoint<br><br>model = load_brightmart_albert_zh_checkpoint(<span class="hljs-string">&#x27;albert_xlarge_zh_183k&#x27;</span>, training=<span class="hljs-literal">False</span>)<br>model.summary()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„albert-tinyæ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br><span class="hljs-section">Layer (type)                    Output Shape         Param #     Connected to                     </span><br><span class="hljs-section">==================================================================================================</span><br>Input-Token (InputLayer)        (None, 512)          0                                            <br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br>Input-Segment (InputLayer)      (None, 512)          0                                            <br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br>Embed-Token (AdaptiveEmbedding) [<span class="hljs-string">(None, 512, 312), ( 2744320     Input-Token[0</span>][<span class="hljs-symbol">0</span>]                <br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br>Embed-Segment (Embedding)       (None, 512, 312)     624         Input-Segment[<span class="hljs-string">0</span>][<span class="hljs-symbol">0</span>]              <br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br>Embed-Token-Segment (Add)       (None, 512, 312)     0           Embed-Token[<span class="hljs-string">0</span>][<span class="hljs-symbol">0</span>]                <br><span class="hljs-code">                                                                 Embed-Segment[0][0]              </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Embedding-Position (PositionEmb (None, 512, 312)     159744      Embed-Token-Segment[0][0]        </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Embedding-Norm (LayerNormalizat (None, 512, 312)     624         Embedding-Position[0][0]         </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Attention (MultiHeadAttention)  (None, 512, 312)     390624      Embedding-Norm[0][0]             </span><br><span class="hljs-code">                                                                 Feed-Forward-Normal[0][0]        </span><br><span class="hljs-code">                                                                 Feed-Forward-Normal[1][0]        </span><br><span class="hljs-code">                                                                 Feed-Forward-Normal[2][0]        </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Attention-Add-1 (Add)           (None, 512, 312)     0           Embedding-Norm[0][0]             </span><br><span class="hljs-code">                                                                 Attention[0][0]                  </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Attention-Normal (LayerNormaliz (None, 512, 312)     624         Attention-Add-1[0][0]            </span><br><span class="hljs-code">                                                                 Attention-Add-2[0][0]            </span><br><span class="hljs-code">                                                                 Attention-Add-3[0][0]            </span><br><span class="hljs-code">                                                                 Attention-Add-4[0][0]            </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Feed-Forward (FeedForward)      (None, 512, 312)     780312      Attention-Normal[0][0]           </span><br><span class="hljs-code">                                                                 Attention-Normal[1][0]           </span><br><span class="hljs-code">                                                                 Attention-Normal[2][0]           </span><br><span class="hljs-code">                                                                 Attention-Normal[3][0]           </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Feed-Forward-Add-1 (Add)        (None, 512, 312)     0           Attention-Normal[0][0]           </span><br><span class="hljs-code">                                                                 Feed-Forward[0][0]               </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Feed-Forward-Normal (LayerNorma (None, 512, 312)     624         Feed-Forward-Add-1[0][0]         </span><br><span class="hljs-code">                                                                 Feed-Forward-Add-2[0][0]         </span><br><span class="hljs-code">                                                                 Feed-Forward-Add-3[0][0]         </span><br><span class="hljs-code">                                                                 Feed-Forward-Add-4[0][0]         </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Attention-Add-2 (Add)           (None, 512, 312)     0           Feed-Forward-Normal[0][0]        </span><br><span class="hljs-code">                                                                 Attention[1][0]                  </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Feed-Forward-Add-2 (Add)        (None, 512, 312)     0           Attention-Normal[1][0]           </span><br><span class="hljs-code">                                                                 Feed-Forward[1][0]               </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Attention-Add-3 (Add)           (None, 512, 312)     0           Feed-Forward-Normal[1][0]        </span><br><span class="hljs-code">                                                                 Attention[2][0]                  </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Feed-Forward-Add-3 (Add)        (None, 512, 312)     0           Attention-Normal[2][0]           </span><br><span class="hljs-code">                                                                 Feed-Forward[2][0]               </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Attention-Add-4 (Add)           (None, 512, 312)     0           Feed-Forward-Normal[2][0]        </span><br><span class="hljs-code">                                                                 Attention[3][0]                  </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">Feed-Forward-Add-4 (Add)        (None, 512, 312)     0           Attention-Normal[3][0]           </span><br><span class="hljs-code">                                                                 Feed-Forward[3][0]               </span><br><span class="hljs-code">==================================================================================================</span><br><span class="hljs-code">Total params: 4,077,496</span><br><span class="hljs-code">Trainable params: 0</span><br><span class="hljs-code">Non-trainable params: 4,077,496</span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br></code></pre></td></tr></table></figure><p>æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨keras-bertæ¨¡å—ä¸­è½»æ¾æ„‰å¿«åœ°è°ƒç”¨ALBERTæ¨¡å‹äº†ã€‚ä»¥ä¸‹ä¸ºkeras-bertè°ƒç”¨ALBERTæ¨¡å‹ï¼Œå®ç°æ–‡æœ¬å¤šåˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»¥åŠåºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼Œå…¶ä»£ç ä¸ä¹‹å‰çš„keras-bertè°ƒç”¨BERTæ¨¡å‹çš„ä»£ç å¤§ä½“ä¸€è‡´ï¼Œåªä¸è¿‡åœ¨åŠ è½½é¢„è®­ç»ƒæ¨¡å‹çš„æ—¶å€™éœ€è¦<code>keras_albert_model</code>é¡¹ç›®çš„å¸®åŠ©ã€‚</p><p>ä»¥ä¸‹å°†ä¸å†ç»™å‡ºå…·ä½“çš„é¡¹ç›®ä»£ç ï¼Œè€Œåªæ˜¯ç»™å‡ºkeras-bertåœ¨è°ƒç”¨ALBERTæ¨¡å‹æ—¶ï¼Œåœ¨ä¸åŒNLPä»»åŠ¡çš„è¡¨ç°ï¼Œå³æ¨¡å‹è¯„ä¼°æ•ˆæœã€‚</p><h3 id="æ–‡æœ¬å¤šåˆ†ç±»">æ–‡æœ¬å¤šåˆ†ç±»</h3><p>ä½¿ç”¨Keraså’ŒALBERTå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡ï¼Œå…¶ä¸­å¯¹ALBERTè¿›è¡Œå¾®è°ƒã€‚æ•°æ®é›†ä¸ºsougouå°åˆ†ç±»æ•°æ®é›†ã€‚æ¨¡å‹å‚æ•°ä¸ºbatch_size= 8, maxlen = 300, epoch=3ã€‚</p><ul><li>albert-tinyçš„æ¨¡å‹è¯„ä¼°ç»“æœ</li></ul><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs crystal">                precision   recall    f1-score   support<br><br>          ä½“è‚²     <span class="hljs-number">0.9700</span>    <span class="hljs-number">0.9798</span>    <span class="hljs-number">0.9749</span>        <span class="hljs-number">99</span><br>          å¥åº·     <span class="hljs-number">0.9278</span>    <span class="hljs-number">0.9091</span>    <span class="hljs-number">0.9184</span>        <span class="hljs-number">99</span><br>          å†›äº‹     <span class="hljs-number">0.9899</span>    <span class="hljs-number">0.9899</span>    <span class="hljs-number">0.9899</span>        <span class="hljs-number">99</span><br>          æ•™è‚²     <span class="hljs-number">0.8585</span>    <span class="hljs-number">0.9192</span>    <span class="hljs-number">0.8878</span>        <span class="hljs-number">99</span><br>          æ±½è½¦     <span class="hljs-number">1.0000</span>    <span class="hljs-number">0.9394</span>    <span class="hljs-number">0.9688</span>        <span class="hljs-number">99</span><br><br>    accuracy                         <span class="hljs-number">0.9475</span>       <span class="hljs-number">495</span><br>   <span class="hljs-function"><span class="hljs-keyword">macro</span> <span class="hljs-title">avg</span></span>     <span class="hljs-number">0.9492</span>    <span class="hljs-number">0.9475</span>    <span class="hljs-number">0.9479</span>       <span class="hljs-number">495</span><br>weighted avg     <span class="hljs-number">0.9492</span>    <span class="hljs-number">0.9475</span>    <span class="hljs-number">0.9479</span>       <span class="hljs-number">495</span><br></code></pre></td></tr></table></figure><ul><li>albert_base_zh_additional_36k_stepsçš„æ¨¡å‹è¯„ä¼°ç»“æœ</li></ul><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs crystal">              precision    recall  f1-score   support<br><br>          ä½“è‚²     <span class="hljs-number">0.9802</span>    <span class="hljs-number">1.0000</span>    <span class="hljs-number">0.9900</span>        <span class="hljs-number">99</span><br>          å¥åº·     <span class="hljs-number">0.9684</span>    <span class="hljs-number">0.9293</span>    <span class="hljs-number">0.9485</span>        <span class="hljs-number">99</span><br>          å†›äº‹     <span class="hljs-number">1.0000</span>    <span class="hljs-number">0.9899</span>    <span class="hljs-number">0.9949</span>        <span class="hljs-number">99</span><br>          æ•™è‚²     <span class="hljs-number">0.8739</span>    <span class="hljs-number">0.9798</span>    <span class="hljs-number">0.9238</span>        <span class="hljs-number">99</span><br>          æ±½è½¦     <span class="hljs-number">1.0000</span>    <span class="hljs-number">0.9091</span>    <span class="hljs-number">0.9524</span>        <span class="hljs-number">99</span><br><br>    accuracy                         <span class="hljs-number">0.9616</span>       <span class="hljs-number">495</span><br>   <span class="hljs-function"><span class="hljs-keyword">macro</span> <span class="hljs-title">avg</span></span>     <span class="hljs-number">0.9645</span>    <span class="hljs-number">0.9616</span>    <span class="hljs-number">0.9619</span>       <span class="hljs-number">495</span><br>weighted avg     <span class="hljs-number">0.9645</span>    <span class="hljs-number">0.9616</span>    <span class="hljs-number">0.9619</span>       <span class="hljs-number">495</span><br></code></pre></td></tr></table></figure><ul><li>lbert_xlarge_zh_183kçš„æ¨¡å‹è¯„ä¼°ç»“æœ</li></ul><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs crystal">              precision    recall  f1-score   support<br><br>          ä½“è‚²     <span class="hljs-number">0.9898</span>    <span class="hljs-number">0.9798</span>    <span class="hljs-number">0.9848</span>        <span class="hljs-number">99</span><br>          å¥åº·     <span class="hljs-number">0.9412</span>    <span class="hljs-number">0.9697</span>    <span class="hljs-number">0.9552</span>        <span class="hljs-number">99</span><br>          å†›äº‹     <span class="hljs-number">0.9706</span>    <span class="hljs-number">1.0000</span>    <span class="hljs-number">0.9851</span>        <span class="hljs-number">99</span><br>          æ•™è‚²     <span class="hljs-number">0.9300</span>    <span class="hljs-number">0.9394</span>    <span class="hljs-number">0.9347</span>        <span class="hljs-number">99</span><br>          æ±½è½¦     <span class="hljs-number">0.9892</span>    <span class="hljs-number">0.9293</span>    <span class="hljs-number">0.9583</span>        <span class="hljs-number">99</span><br><br>    accuracy                         <span class="hljs-number">0.9636</span>       <span class="hljs-number">495</span><br>   <span class="hljs-function"><span class="hljs-keyword">macro</span> <span class="hljs-title">avg</span></span>     <span class="hljs-number">0.9642</span>    <span class="hljs-number">0.9636</span>    <span class="hljs-number">0.9636</span>       <span class="hljs-number">495</span><br>weighted avg     <span class="hljs-number">0.9642</span>    <span class="hljs-number">0.9636</span>    <span class="hljs-number">0.9636</span>       <span class="hljs-number">495</span><br></code></pre></td></tr></table></figure><h3 id="æ–‡æœ¬å¤šæ ‡ç­¾">æ–‡æœ¬å¤šæ ‡ç­¾</h3><p>ä½¿ç”¨é‡‡ç”¨Keraså’ŒALBERTå®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡,å…¶ä¸­å¯¹ALBERTè¿›è¡Œå¾®è°ƒã€‚ä»¥2020è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›ï¼šäº‹ä»¶æŠ½å–ä»»åŠ¡ä¸­çš„æ•°æ®ä½œä¸ºå¤šåˆ†ç±»æ ‡ç­¾çš„æ ·ä¾‹æ•°æ®ï¼Œå€ŸåŠ©å¤šæ ‡ç­¾åˆ†ç±»æ¨¡å‹æ¥è§£å†³ã€‚æ¨¡å‹å‚æ•°ä¸ºbatch_size= 16, maxlen = 256, epoch=10ã€‚</p><ul><li>albert-tinyçš„æ¨¡å‹è¯„ä¼°ç»“æœ</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache">   <span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9488</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8606</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9025</span>      <span class="hljs-number">1657</span><br>   <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9446</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8084</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8589</span>      <span class="hljs-number">1657</span><br><span class="hljs-attribute">weighted</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9460</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8606</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8955</span>      <span class="hljs-number">1657</span><br> <span class="hljs-attribute">samples</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8932</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8795</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8799</span>      <span class="hljs-number">1657</span><br><br><span class="hljs-attribute">accuracy</span>:  <span class="hljs-number">0</span>.<span class="hljs-number">828437917222964</span><br><span class="hljs-attribute">hamming</span> loss:  <span class="hljs-number">0</span>.<span class="hljs-number">0031631919482386773</span><br></code></pre></td></tr></table></figure><ul><li>albert_base_zh_additional_36k_stepsçš„æ¨¡å‹è¯„ä¼°ç»“æœ</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache">   <span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9471</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9294</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9382</span>      <span class="hljs-number">1657</span><br>   <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9416</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9105</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9208</span>      <span class="hljs-number">1657</span><br><span class="hljs-attribute">weighted</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9477</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9294</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9362</span>      <span class="hljs-number">1657</span><br> <span class="hljs-attribute">samples</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9436</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9431</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9379</span>      <span class="hljs-number">1657</span><br><br><span class="hljs-attribute">accuracy</span>:  <span class="hljs-number">0</span>.<span class="hljs-number">8931909212283045</span><br><span class="hljs-attribute">hamming</span> loss:  <span class="hljs-number">0</span>.<span class="hljs-number">0020848310567936736</span><br></code></pre></td></tr></table></figure><h3 id="åºåˆ—æ ‡æ³¨">åºåˆ—æ ‡æ³¨</h3><p>ä½¿ç”¨æœ¬é¡¹ç›®é‡‡ç”¨Keraså’ŒALBERTå®ç°åºåˆ—æ ‡æ³¨ï¼Œå…¶ä¸­å¯¹ALBERTè¿›è¡Œå¾®è°ƒã€‚æ•°æ®é›†ä¸ºäººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†ã€æ—¶é—´è¯†åˆ«æ•°æ®é›†ã€CLUENERç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†ã€‚</p><ul><li>äººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†</li></ul><p>1.1 albert-tiny</p><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=128, BATCH_SIZE=32, EPOCH=10</p><p>è¿è¡Œmodel_evaluate.py,æ¨¡å‹è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache">           <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>      <span class="hljs-attribute">LOC</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8266</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8171</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8218</span>      <span class="hljs-number">3658</span><br>      <span class="hljs-attribute">ORG</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7289</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7863</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7565</span>      <span class="hljs-number">2185</span><br>      <span class="hljs-attribute">PER</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8865</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8712</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8788</span>      <span class="hljs-number">1864</span><br><br><span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8111</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8215</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8163</span>      <span class="hljs-number">7707</span><br><span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8134</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8215</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8171</span>      <span class="hljs-number">7707</span><br></code></pre></td></tr></table></figure><p>1.2 albert-base</p><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=128, BATCH_SIZE=32, EPOCH=10</p><p>è¿è¡Œmodel_evaluate.py,æ¨¡å‹è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache">           <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>      <span class="hljs-attribute">LOC</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9032</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8671</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8848</span>      <span class="hljs-number">3658</span><br>      <span class="hljs-attribute">PER</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9270</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9067</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9167</span>      <span class="hljs-number">1864</span><br>      <span class="hljs-attribute">ORG</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8445</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8549</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8497</span>      <span class="hljs-number">2185</span><br><br><span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8917</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8732</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8824</span>      <span class="hljs-number">7707</span><br><span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8923</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8732</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8826</span>      <span class="hljs-number">7707</span><br></code></pre></td></tr></table></figure><ul><li>æ—¶é—´è¯†åˆ«æ•°æ®é›†</li></ul><p>2.1 albert-tiny</p><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=256, BATCH_SIZE=8, EPOCH=10</p><p>è¿è¡Œmodel_evaluate.py,æ¨¡å‹è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache">           <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>     <span class="hljs-attribute">TIME</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7924</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8481</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8193</span>       <span class="hljs-number">441</span><br><br><span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">7924</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8481</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8193</span>       <span class="hljs-number">441</span><br><span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">7924</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8481</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8193</span>       <span class="hljs-number">441</span><br></code></pre></td></tr></table></figure><p>2.2 albert-base</p><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=256, BATCH_SIZE=8, EPOCH=10</p><p>è¿è¡Œmodel_evaluate.py,æ¨¡å‹è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache">           <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>     <span class="hljs-attribute">TIME</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8136</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8413</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8272</span>       <span class="hljs-number">441</span><br><br><span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8136</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8413</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8272</span>       <span class="hljs-number">441</span><br><span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8136</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8413</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8272</span>       <span class="hljs-number">441</span><br></code></pre></td></tr></table></figure><ul><li>CLUENERç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†</li></ul><p>3.1 albert-tiny</p><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=128, BATCH_SIZE=32, EPOCH=10</p><p>è¿è¡Œmodel_evaluate.py,æ¨¡å‹è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache">              <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>     <span class="hljs-attribute">company</span>     <span class="hljs-number">0</span>.<span class="hljs-number">5745</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6639</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6160</span>       <span class="hljs-number">366</span><br><span class="hljs-attribute">organization</span>     <span class="hljs-number">0</span>.<span class="hljs-number">5677</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6337</span>    <span class="hljs-number">0</span>.<span class="hljs-number">5989</span>       <span class="hljs-number">344</span><br>        <span class="hljs-attribute">game</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6616</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7561</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7057</span>       <span class="hljs-number">287</span><br>    <span class="hljs-attribute">position</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6478</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7012</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6734</span>       <span class="hljs-number">425</span><br>  <span class="hljs-attribute">government</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6237</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7336</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6742</span>       <span class="hljs-number">244</span><br>        <span class="hljs-attribute">name</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6520</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7894</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7141</span>       <span class="hljs-number">451</span><br>       <span class="hljs-attribute">movie</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6164</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6533</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6343</span>       <span class="hljs-number">150</span><br>       <span class="hljs-attribute">scene</span>     <span class="hljs-number">0</span>.<span class="hljs-number">5166</span>    <span class="hljs-number">0</span>.<span class="hljs-number">5477</span>    <span class="hljs-number">0</span>.<span class="hljs-number">5317</span>       <span class="hljs-number">199</span><br>        <span class="hljs-attribute">book</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6140</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6908</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6502</span>       <span class="hljs-number">152</span><br>     <span class="hljs-attribute">address</span>     <span class="hljs-number">0</span>.<span class="hljs-number">4071</span>    <span class="hljs-number">0</span>.<span class="hljs-number">4698</span>    <span class="hljs-number">0</span>.<span class="hljs-number">4362</span>       <span class="hljs-number">364</span><br><br>   <span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">5884</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6687</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6260</span>      <span class="hljs-number">2982</span><br>   <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">5881</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6687</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6255</span>      <span class="hljs-number">2982</span><br></code></pre></td></tr></table></figure><p>3.2 albert-base</p><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=128, BATCH_SIZE=32, EPOCH=10</p><p>è¿è¡Œmodel_evaluate.py,æ¨¡å‹è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache">              <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>        <span class="hljs-attribute">name</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8419</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8381</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8400</span>       <span class="hljs-number">451</span><br>     <span class="hljs-attribute">company</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7161</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7650</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7398</span>       <span class="hljs-number">366</span><br>    <span class="hljs-attribute">position</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7205</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7459</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7329</span>       <span class="hljs-number">425</span><br>     <span class="hljs-attribute">address</span>     <span class="hljs-number">0</span>.<span class="hljs-number">5473</span>    <span class="hljs-number">0</span>.<span class="hljs-number">5879</span>    <span class="hljs-number">0</span>.<span class="hljs-number">5669</span>       <span class="hljs-number">364</span><br>        <span class="hljs-attribute">game</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7033</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8258</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7596</span>       <span class="hljs-number">287</span><br>        <span class="hljs-attribute">book</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7931</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7566</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7744</span>       <span class="hljs-number">152</span><br>       <span class="hljs-attribute">scene</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6243</span>    <span class="hljs-number">0</span>.<span class="hljs-number">5930</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6082</span>       <span class="hljs-number">199</span><br><span class="hljs-attribute">organization</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6711</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7297</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6992</span>       <span class="hljs-number">344</span><br>       <span class="hljs-attribute">movie</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7051</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7333</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7190</span>       <span class="hljs-number">150</span><br>  <span class="hljs-attribute">government</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7567</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8156</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7850</span>       <span class="hljs-number">244</span><br><br>   <span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">7078</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7441</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7255</span>      <span class="hljs-number">2982</span><br>   <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">7093</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7441</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7257</span>      <span class="hljs-number">2982</span><br></code></pre></td></tr></table></figure><h3id="ä¸åŒç‰ˆæœ¬albertæ¨¡å‹ä¸bertæ¨¡å‹çš„å‚æ•°å¯¹æ¯”">ä¸åŒç‰ˆæœ¬ALBERTæ¨¡å‹ä¸BERTæ¨¡å‹çš„å‚æ•°å¯¹æ¯”</h3><p>ä»¥æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡ä¸ºä¾‹ï¼Œæˆ‘ä»¬çš„æ•°æ®é›†ä¸ºsougouå°åˆ†ç±»æ•°æ®é›†ï¼Œæ–‡æœ¬æœ€å¤§é•¿åº¦ä¸º300ï¼Œä¸åŒç‰ˆæœ¬ALBERTæ¨¡å‹ä¸BERTæ¨¡å‹çš„å‚æ•°ä¸ºï¼š</p><table><thead><tr class="header"><th>model name</th><th>Total params</th><th>Trainable params</th></tr></thead><tbody><tr class="odd"><td>albert_tiny</td><td>4,079,061</td><td>4,079,061</td></tr><tr class="even"><td>albert_base_zh_additional_36k_steps</td><td>10,290,693</td><td>10,290,693</td></tr><tr class="odd"><td>albert_xlarge_zh_183k</td><td>54,391,813</td><td>54,391,813</td></tr><tr class="even"><td>chinese_L-12_H-768_A-12</td><td>101,680,901</td><td>101,680,901</td></tr></tbody></table><p>é€šè¿‡ä¸Šè¿°å¯¹æ¯”ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œå³ä½¿æ˜¯ALBERTçš„largeæ¨¡å‹ï¼Œå…¶å‚æ•°é‡ä¹Ÿæ¯”BERTçš„baseç‰ˆæœ¬æ¥çš„å°‘ï¼Œè¿™æ˜¯ç”±äºALBERTæ¨¡å‹çš„ç»“æ„å†³å®šçš„ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨keras-bertè°ƒç”¨ALBERTæ¨¡å‹å®ç°æ–‡æœ¬åˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ã€åºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼Œå…¶Githubé¡¹ç›®åœ°å€å·²ç»åœ¨æ–‡ç« å¼€å¤´ç»™å‡ºã€‚</p><p>åœ¨æ¨¡å‹è¯„ä¼°æ—¶ï¼Œä¸å°‘ä»»åŠ¡éƒ½æœªç»™å‡ºalbert_xlarge_zh_183kæ¨¡å‹çš„è¯„ä¼°ç»“æœï¼Œè¿™æ˜¯ç”±äºGPUæœºå™¨çš„æ€§èƒ½é™åˆ¶ï¼Œè€Œä¸æ˜¯ç¬”è€…ä¸æ„¿åšæˆ–å·æ‡’ï¼Œå¸Œæœ›è¯»è€…ç†è§£ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›è¯»è€…èƒ½æœ‰æœºä¼šå¼¥è¡¥è¿™ä¸ªé—æ†¾ã€‚</p><p>æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼Œä¹Ÿæ„Ÿè°¢æ‰€æœ‰ä¸ºå¼€æºé¡¹ç›®ä½œå‡ºè´¡çŒ®çš„äºº~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>keras-bert</tag>
      
      <tag>åºåˆ—æ ‡æ³¨</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
      <tag>ALBERT</tag>
      
      <tag>å¤šæ ‡ç­¾åˆ†ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flaskä¸­çš„JWTè®¤è¯</title>
    <link href="/2023/07/10/Flask%E4%B8%AD%E7%9A%84JWT%E8%AE%A4%E8%AF%81/"/>
    <url>/2023/07/10/Flask%E4%B8%AD%E7%9A%84JWT%E8%AE%A4%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>HTTPè®¤è¯æ–¹å¼ï¼š</p><ul><li>Basic</li><li>Bearer</li><li>JWTï¼ˆJSON Web Tokenï¼‰</li></ul><p>JWTçš„ç»“æ„ï¼š</p><p><img src="https://raw.githubusercontent.com/breatheco-de/content/master/src/assets/images/jwt-token-structure.png" alt=""></p><table><thead><tr><th style="text-align:left">Section name</th><th style="text-align:left">meaning</th></tr></thead><tbody><tr><td style="text-align:left">HEADER</td><td style="text-align:left">The first part stores the type of token and the encryption algorithm</td></tr><tr><td style="text-align:left">PAYLOAD</td><td style="text-align:left">The second part has the data that identifies the user: it can be its ID, user name, etc.</td></tr><tr><td style="text-align:left">SIGNATURE</td><td style="text-align:left">Digital signature, which is generated with the previous two sections, and it allows you to verify if the content has been modified.</td></tr></tbody></table><p>ç¤ºä¾‹Pythonä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @place: Pudong, Shanghai </span><br><span class="hljs-comment"># @contact: lianmingjie@shanda.com</span><br><span class="hljs-comment"># @file: jwt_test.py</span><br><span class="hljs-comment"># @time: 2023/7/4 17:29</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify, request<br><br><span class="hljs-keyword">from</span> flask_jwt_extended <span class="hljs-keyword">import</span> create_access_token<br><span class="hljs-keyword">from</span> flask_jwt_extended <span class="hljs-keyword">import</span> get_jwt_identity<br><span class="hljs-keyword">from</span> flask_jwt_extended <span class="hljs-keyword">import</span> jwt_required<br><span class="hljs-keyword">from</span> flask_jwt_extended <span class="hljs-keyword">import</span> JWTManager<br><br>app = Flask(__name__)<br><br><span class="hljs-comment"># è®¾ç½® Flask-JWT-Extended æ’ä»¶çš„ç§˜é’¥</span><br>app.config[<span class="hljs-string">&quot;JWT_SECRET_KEY&quot;</span>] = <span class="hljs-string">&quot;super-secret&quot;</span>  <span class="hljs-comment"># è®¾ç½® jwt çš„ç§˜é’¥</span><br>jwt = JWTManager(app)<br><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè·¯ç”±æ¥éªŒè¯ç™»å½•çš„ç”¨æˆ·å¹¶è¿”å›JWT</span><br><span class="hljs-comment"># create_access_token() å‡½æ•°ç”¨æ¥ç”Ÿæˆå®é™…çš„JWT token.</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    username = request.json.get(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-literal">None</span>)<br>    password = request.json.get(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-literal">None</span>)<br>    <span class="hljs-keyword">if</span> username <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;admin1&quot;</span>, <span class="hljs-string">&quot;admin2&quot;</span>, <span class="hljs-string">&quot;admin3&quot;</span>] <span class="hljs-keyword">or</span> password != <span class="hljs-string">&quot;123456&quot;</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Bad username or password&quot;</span>&#125;), <span class="hljs-number">401</span><br><br>    <span class="hljs-comment"># ä¼ å…¥èº«ä»½ä¿¡æ¯åˆ›å»º access_token</span><br>    access_token = create_access_token(identity=username)<br>    <span class="hljs-keyword">return</span> jsonify(access_token=<span class="hljs-string">&#x27;Bearer &#x27;</span> + access_token)<br><br><br><span class="hljs-comment"># ä½¿ç”¨ jwt_required ä¿æŠ¤è¯·æ±‚è§†å›¾ï¼Œå¦‚æœåœ¨è¯·æ±‚ä¸­ä¸å­˜åœ¨jwt tokenå°†æ— æ³•è®¿é—®ã€‚</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/protected&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-meta">@jwt_required()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">protected</span>():<br>    <span class="hljs-comment"># ä½¿ç”¨ get_jwt_identity è®¿é—®å½“å‰ç”¨æˆ·çš„èº«ä»½</span><br>    current_user = get_jwt_identity()<br>    <span class="hljs-keyword">return</span> jsonify(logged_in_as=current_user), <span class="hljs-number">200</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure><p>åˆ›å»ºJWTï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --location <span class="hljs-string">&#x27;http://127.0.0.1:5000/login&#x27;</span> \<br>--header <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> \<br>--data <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    &quot;username&quot;: &quot;admin3&quot;,</span><br><span class="hljs-string">    &quot;password&quot;: &quot;123456&quot;</span><br><span class="hljs-string">&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>éªŒè¯JWTï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --location <span class="hljs-string">&#x27;http://127.0.0.1:5000/protected&#x27;</span> \<br>--header <span class="hljs-string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTY4ODQ2Mzg5OCwianRpIjoiZDU1NDdjMGQtZjc2Zi00MTA3LThhNTAtYWZmN2I4NTIxMzEzIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6ImFkbWluMyIsIm5iZiI6MTY4ODQ2Mzg5OCwiZXhwIjoxNjg4NDY0Nzk4fQ.hFUJNHF9ULv_tWK31ttOhHMp_-azevG6VyJRsiUcMcM&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è‰ç¨¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flask</tag>
      
      <tag>HTTPè®¤è¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flaskè®¡æ•°å™¨</title>
    <link href="/2023/07/10/Flask%E8%AE%A1%E6%95%B0%E5%99%A8/"/>
    <url>/2023/07/10/Flask%E8%AE%A1%E6%95%B0%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è®¡æ•°å™¨å®ç°æ–¹å¼ï¼š</p><ol><li>ä½¿ç”¨session</li><li>ä½¿ç”¨å¤šçº¿ç¨‹</li><li>ä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼Œå¦‚redis</li></ol><ul><li>ä½¿ç”¨session</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify, session<br><br>app = Flask(__name__)<br>app.secret_key = <span class="hljs-string">&#x27;test&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">news</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-literal">None</span>) <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        session[<span class="hljs-string">&#x27;click&#x27;</span>] = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        session[<span class="hljs-string">&#x27;click&#x27;</span>] += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> jsonify(click=session[<span class="hljs-string">&#x27;click&#x27;</span>])<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run()<br><br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨å¤šçº¿ç¨‹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Value<br><br>app = Flask(__name__)<br>counter = Value(<span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># iè¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">news</span>():<br>    <span class="hljs-keyword">with</span> counter.get_lock():<br>        counter.value += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> jsonify(click=counter.value)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run()<br><br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨redis</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> redis<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify<br><br><br>app = Flask(__name__)<br><span class="hljs-comment"># redis connection</span><br>kv_store = redis.Redis(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">0</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">news</span>():<br>    c = kv_store.incr(<span class="hljs-string">&#x27;count&#x27;</span>)<br>    <span class="hljs-keyword">return</span> jsonify(count=c)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è‰ç¨¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åä¸ƒï¼‰ä½¿ç”¨keras-bertå®ç°è‹±è¯­åºåˆ—æ ‡æ³¨ä»»åŠ¡</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B8%83%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E8%8B%B1%E8%AF%AD%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B8%83%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E8%8B%B1%E8%AF%AD%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a>ä¸­ï¼Œæˆ‘ä»¬å·²ç»ç”¨keras-bertæ¨¡å—å®ç°äº†ä¸­æ–‡åºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼Œå…¶ä¸­å¯¹BERTè¿›è¡Œå¾®è°ƒã€‚å½“å‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é¡ºä¾¿å®ç°ä¸‹è‹±è¯­åºåˆ—æ ‡æ³¨ä»»åŠ¡ã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨keras-bertå®ç°è‹±è¯­åºåˆ—æ ‡æ³¨ä»»åŠ¡ã€‚</p><h3 id="ä¸€ä¸ªå°æµ‹è¯•">ä¸€ä¸ªå°æµ‹è¯•</h3><p>ä½¿ç”¨keras-bertå®ç°è‹±è¯­åºåˆ—æ ‡æ³¨ä»»åŠ¡çš„ä»£ç ï¼Œå¤§ä½“ä¸Šä¸æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a>ä¸­çš„ç›¸ä¼¼ï¼Œä½†è‹±è¯­åºåˆ—æ ‡æ³¨æœ‰å…¶ç‰¹æ®Šä¹‹å¤„ã€‚å…¶ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼ŒBERTä¼šå°†å¤æ‚çš„è‹±è¯­å•è¯æ‹†åˆ†æˆå¤šä¸ªç®€å•è‹±è¯­å•è¯ï¼Œè¿›è¡Œtokenize.</p><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> Tokenizer<br><br><span class="hljs-comment"># è¯»å–è¯å…¸</span><br>dict_path = <span class="hljs-string">&#x27;./uncased_L-12_H-768_A-12/vocab.txt&#x27;</span><br>token_dict = &#123;&#125;<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(dict_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> reader:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> reader:<br>        token = line.strip()<br>        token_dict[token] = <span class="hljs-built_in">len</span>(token_dict)<br><br>id_token_dict = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> token_dict.items()&#125;<br>tokenizer = Tokenizer(token_dict=token_dict)<br><br><span class="hljs-comment"># tokenize</span><br>code = tokenizer.encode(<span class="hljs-string">&quot;A man waits in the arrivals hall at Heathrow Airport in London.&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ids: &quot;</span>, code[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;type_ids: &quot;</span>, code[<span class="hljs-number">1</span>])<br>encode_text = [id_token_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> code[<span class="hljs-number">0</span>]]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;encode_text: &quot;</span>, encode_text)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs prolog">ids:  [<span class="hljs-number">101</span>, <span class="hljs-number">1037</span>, <span class="hljs-number">2158</span>, <span class="hljs-number">18074</span>, <span class="hljs-number">1999</span>, <span class="hljs-number">1996</span>, <span class="hljs-number">25470</span>, <span class="hljs-number">2534</span>, <span class="hljs-number">2012</span>, <span class="hljs-number">9895</span>, <span class="hljs-number">10524</span>, <span class="hljs-number">3199</span>, <span class="hljs-number">1999</span>, <span class="hljs-number">2414</span>, <span class="hljs-number">1012</span>, <span class="hljs-number">102</span>]<br>type_ids:  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br>encode_text:  [<span class="hljs-string">&#x27;[CLS]&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;man&#x27;</span>, <span class="hljs-string">&#x27;waits&#x27;</span>, <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;the&#x27;</span>, <span class="hljs-string">&#x27;arrivals&#x27;</span>, <span class="hljs-string">&#x27;hall&#x27;</span>, <span class="hljs-string">&#x27;at&#x27;</span>, <span class="hljs-string">&#x27;heath&#x27;</span>, <span class="hljs-string">&#x27;##row&#x27;</span>, <span class="hljs-string">&#x27;airport&#x27;</span>, <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;london&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;[SEP]&#x27;</span>]<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¥å­ä¸­å•è¯<code>Heathrow</code>è¢«æ‹†åˆ†æˆäº†ä¸¤ä¸ªtoken<code>heath</code>å’Œ<code>##row</code>ï¼Œè¿™æ˜¯BERTè‹±è¯­é¢„è®­ç»ƒæ¨¡å‹åœ¨tokenizeæ—¶çš„ç‰¹æ®Šä¹‹å¤„ã€‚</p><p>åŸºäºä¸Šè¿°åŸå› ï¼Œæˆ‘ä»¬åŸæ¥çš„æ ‡æ³¨åºåˆ—ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;a</span>&#x27;, <span class="hljs-symbol">&#x27;man</span>&#x27;, <span class="hljs-symbol">&#x27;waits</span>&#x27;, <span class="hljs-symbol">&#x27;in</span>&#x27;, <span class="hljs-symbol">&#x27;the</span>&#x27;, <span class="hljs-symbol">&#x27;arrivals</span>&#x27;, <span class="hljs-symbol">&#x27;hall</span>&#x27;, <span class="hljs-symbol">&#x27;at</span>&#x27;, <span class="hljs-symbol">&#x27;heathrow</span>&#x27;, <span class="hljs-symbol">&#x27;airport</span>&#x27;, <span class="hljs-symbol">&#x27;in</span>&#x27;, <span class="hljs-symbol">&#x27;london</span>&#x27;, <span class="hljs-symbol">&#x27;.</span>&#x27;]<br>[<span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;B-LOC</span>&#x27;, <span class="hljs-symbol">&#x27;I-LOC</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;B-LOC</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;]<br></code></pre></td></tr></table></figure><p>åœ¨è¿›å…¥è‹±è¯­åºåˆ—æ ‡æ³¨æ—¶ï¼Œåº”å½“å˜æˆå¦‚ä¸‹åºåˆ—ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[&#x27;[<span class="hljs-name">CLS</span>]&#x27;, <span class="hljs-symbol">&#x27;a</span>&#x27;, <span class="hljs-symbol">&#x27;man</span>&#x27;, <span class="hljs-symbol">&#x27;waits</span>&#x27;, <span class="hljs-symbol">&#x27;in</span>&#x27;, <span class="hljs-symbol">&#x27;the</span>&#x27;, <span class="hljs-symbol">&#x27;arrivals</span>&#x27;, <span class="hljs-symbol">&#x27;hall</span>&#x27;, <span class="hljs-symbol">&#x27;at</span>&#x27;, <span class="hljs-symbol">&#x27;heath</span>&#x27;, &#x27;##row&#x27;, <span class="hljs-symbol">&#x27;airport</span>&#x27;, <span class="hljs-symbol">&#x27;in</span>&#x27;, <span class="hljs-symbol">&#x27;london</span>&#x27;, <span class="hljs-symbol">&#x27;.</span>&#x27;, &#x27;[<span class="hljs-name">SEP</span>]&#x27;]<br>[<span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;B-LOC</span>&#x27;, <span class="hljs-symbol">&#x27;B-LOC</span>&#x27;, <span class="hljs-symbol">&#x27;I-LOC</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;B-LOC</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;]<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‹†åˆ†åçš„å¤šä¸ªç®€å•è‹±è¯­å•è¯çš„åºåˆ—æ ‡æ³¨æ ‡ç­¾å°†ä¼šè·ŸéšåŸå…ˆå¤æ‚å•è¯çš„æ ‡ç­¾ã€‚</p><h3 id="æ•°æ®é›†">æ•°æ®é›†</h3><p>æœ¬æ–‡å°†ä¼šåœ¨ä¸¤ä¸ªè‹±è¯­å‘½åå®ä½“è¯†åˆ«çš„æ•°æ®é›†ä¸Šè¿›è¡Œæµ‹è¯•ã€‚</p><ol type="1"><li><p><ahref="https://www.clips.uantwerpen.be/conll2003/ner/">Conll2003</a></p><p>conll2003.train 14987æ¡æ•°æ®å’Œconll2003.test3466æ¡æ•°æ®ï¼Œå…±4ç§æ ‡ç­¾ï¼š</p><ul class="task-list"><li><label><input type="checkbox" checked="" />LOC</label></li><li><label><input type="checkbox" checked="" />PER</label></li><li><label><input type="checkbox" checked="" />ORG</label></li><li><label><input type="checkbox" checked="" />MISC</label></li></ul></li><li><p><ahref="https://noisy-text.github.io/2017/emerging-rare-entities.html">wnut17</a></p><p>wnut17.train 3394æ¡æ•°æ®å’Œwnut17.test 1009æ¡æ•°æ®ï¼Œå…±6ç§æ ‡ç­¾ï¼š</p><ul class="task-list"><li><label><input type="checkbox" checked="" />Person</label></li><li><label><input type="checkbox" checked="" />Location (including GPE,facility)</label></li><li><label><input type="checkbox" checked="" />Corporation</label></li><li><label><input type="checkbox" checked="" />Consumer good (tangiblegoods, or well-defined services)</label></li><li><label><input type="checkbox" checked="" />Creative work (song,movie, book, and so on)</label></li><li><label><input type="checkbox" checked="" />Group (subsuming musicband, sports team, and non-corporate organisations)</label></li></ul></li></ol><h3 id="æ¨¡å‹è¯„ä¼°">æ¨¡å‹è¯„ä¼°</h3><p>è‹±è¯­åºåˆ—æ ‡æ³¨ä½¿ç”¨keras-bertè¿›è¡Œæ¨¡å‹è®­ç»ƒã€è¯„ä¼°å’Œé¢„æµ‹çš„ä»£ç ä¸æ–‡ç« <ahref="https://percent4.github.io/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/">NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</a>ä¸­çš„ç›¸ä¼¼ï¼Œæœ¬æ–‡ä¸å†è¯¦ç»†ç»™å‡ºï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒGithubçš„å®ç°ä»£ç ï¼š<ahref="https://github.com/percent4/keras_bert_english_sequence_labeling">https://github.com/percent4/keras_bert_english_sequence_labeling</a>ã€‚ æˆ‘ä»¬åˆ©ç”¨ä¸Šè¿°æ¨¡å‹ï¼Œåœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><ul><li>Conll2003</li></ul><p>æ¨¡å‹å‚æ•°ï¼šuncased_L-12_H-768_A-12, MAX_SEQ_LEN=128, BATCH_SIZE=32,EPOCH=10</p><p>è¿è¡Œmodel_evaluate.py,æ¨¡å‹è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache">           <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>      <span class="hljs-attribute">PER</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9650</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9577</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9613</span>      <span class="hljs-number">1842</span><br>      <span class="hljs-attribute">ORG</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8889</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8770</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8829</span>      <span class="hljs-number">1341</span><br>     <span class="hljs-attribute">MISC</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8156</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8395</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8274</span>       <span class="hljs-number">922</span><br>      <span class="hljs-attribute">LOC</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9286</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9271</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9278</span>      <span class="hljs-number">1837</span><br><br><span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9129</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9116</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9123</span>      <span class="hljs-number">5942</span><br><span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9134</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9116</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9125</span>      <span class="hljs-number">5942</span><br></code></pre></td></tr></table></figure><p><ahref="https://github.com/sebastianruder/NLP-progress/blob/master/english/named_entity_recognition.md">æœ€æ–°SOTAç»“æœçš„F1å€¼ä¸º94.3%.</a></p><ul><li>wnut17</li></ul><p>æ¨¡å‹å‚æ•°ï¼šuncased_L-12_H-768_A-12, MAX_SEQ_LEN=128, BATCH_SIZE=20,EPOCH=10</p><p>è¿è¡Œmodel_evaluate.py,æ¨¡å‹è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache">             <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>       <span class="hljs-attribute">work</span>     <span class="hljs-number">0</span>.<span class="hljs-number">2069</span>    <span class="hljs-number">0</span>.<span class="hljs-number">0571</span>    <span class="hljs-number">0</span>.<span class="hljs-number">0896</span>       <span class="hljs-number">105</span><br>     <span class="hljs-attribute">person</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6599</span>    <span class="hljs-number">0</span>.<span class="hljs-number">4830</span>    <span class="hljs-number">0</span>.<span class="hljs-number">5577</span>       <span class="hljs-number">470</span><br>    <span class="hljs-attribute">product</span>     <span class="hljs-number">0</span>.<span class="hljs-number">3333</span>    <span class="hljs-number">0</span>.<span class="hljs-number">0965</span>    <span class="hljs-number">0</span>.<span class="hljs-number">1497</span>       <span class="hljs-number">114</span><br>   <span class="hljs-attribute">location</span>     <span class="hljs-number">0</span>.<span class="hljs-number">5070</span>    <span class="hljs-number">0</span>.<span class="hljs-number">4865</span>    <span class="hljs-number">0</span>.<span class="hljs-number">4966</span>        <span class="hljs-number">74</span><br>      <span class="hljs-attribute">group</span>     <span class="hljs-number">0</span>.<span class="hljs-number">1500</span>    <span class="hljs-number">0</span>.<span class="hljs-number">1538</span>    <span class="hljs-number">0</span>.<span class="hljs-number">1519</span>        <span class="hljs-number">39</span><br><span class="hljs-attribute">corporation</span>     <span class="hljs-number">0</span>.<span class="hljs-number">1935</span>    <span class="hljs-number">0</span>.<span class="hljs-number">1765</span>    <span class="hljs-number">0</span>.<span class="hljs-number">1846</span>        <span class="hljs-number">34</span><br><br>  <span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">5328</span>    <span class="hljs-number">0</span>.<span class="hljs-number">3489</span>    <span class="hljs-number">0</span>.<span class="hljs-number">4217</span>       <span class="hljs-number">837</span><br>  <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">5016</span>    <span class="hljs-number">0</span>.<span class="hljs-number">3489</span>    <span class="hljs-number">0</span>.<span class="hljs-number">4033</span>       <span class="hljs-number">837</span><br></code></pre></td></tr></table></figure><h3 id="bertæ¨¡å‹æ•ˆæœå¯¹æ¯”">BERTæ¨¡å‹æ•ˆæœå¯¹æ¯”</h3><p>Googleå¯¹BERTè¿›è¡Œä¼˜åŒ–ï¼Œåˆå¼€æ”¾äº†å‡ ä¸ªå°ç‰ˆæœ¬çš„BERTè‹±è¯­é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp37_1.png" alt="BERTè‹±è¯­å„ç‰ˆæœ¬æ¨¡å‹" /><figcaption aria-hidden="true">BERTè‹±è¯­å„ç‰ˆæœ¬æ¨¡å‹</figcaption></figure><p>æˆ‘ä»¬åœ¨Conll2003æ•°æ®é›†ä¸Šï¼Œæ¨¡å‹å‚æ•°ä¸ºMAX_SEQ_LEN=128, BATCH_SIZE=32,EPOCH=10ï¼Œå¯¹æ¯”ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ¨¡å‹åç§°</th><th>P</th><th>R</th><th>F1</th></tr></thead><tbody><tr class="odd"><td>BERT-Small</td><td>0.8744</td><td>0.8859</td><td>0.8801</td></tr><tr class="even"><td>BERT-Medium</td><td>0.9052</td><td>0.9031</td><td>0.9041</td></tr><tr class="odd"><td>BERT-Base</td><td>0.9129</td><td>0.9116</td><td>0.9123</td></tr></tbody></table><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡é‡‡ç”¨keras-bertå®ç°äº†è‹±è¯­åºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼Œå…¶ä¸­å¯¹BERTè¿›è¡Œå¾®è°ƒã€‚æœ¬é¡¹ç›®å·²ç»ä¸Šä¼ è‡³Githubï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/keras_bert_english_sequence_labeling">https://github.com/percent4/keras_bert_english_sequence_labeling</a>ã€‚</p><p>åç»­å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨keras-bertåŠ è½½ALBERTæ¨¡å‹ï¼Œå¹¶å®ç°æ–‡æœ¬å¤šåˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾ä»»åŠ¡å’Œåºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼Œæ¬¢è¿å…³æ³¨~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>keras-bert</tag>
      
      <tag>åºåˆ—æ ‡æ³¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åå…­ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡ï¼Œå…¶ä¸­å¯¹BERTè¿›è¡Œ<code>å¾®è°ƒ</code>ã€‚</p><h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3><p>æœ¬é¡¹ç›®çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp36_1.png" alt="é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„</figcaption></figure><p>å…¶ä¸­ä¾èµ–çš„Pythonç¬¬ä¸‰æ–¹æ¨¡å—å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">pandas==0.23.4<br>Keras==2.3.1<br>keras_bert==0.83.0<br>numpy==1.16.4<br></code></pre></td></tr></table></figure><h3 id="æ•°æ®é›†ä»‹ç»">æ•°æ®é›†ä»‹ç»</h3><p>æœ¬æ–‡é‡‡ç”¨çš„æ•°æ®é›†ä¸æ–‡ç« <ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%85%AB%EF%BC%89%E5%A4%9A%E6%A0%87%E7%AD%BE%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåå…«ï¼‰å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»</a>ä¸­çš„ä¸€è‡´ï¼Œä»¥äº‹ä»¶æŠ½å–æ¯”èµ›çš„æ•°æ®é›†ä¸ºå‚è€ƒï¼Œå½¢æˆæ–‡æœ¬ä¸äº‹ä»¶ç±»å‹çš„å¤šæ ‡ç­¾æ•°æ®é›†ï¼Œä¸€å…±ä¸º65ç§äº‹ä»¶ç±»å‹ã€‚æ ·ä¾‹æ•°æ®ï¼ˆcsvæ ¼å¼ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">label,content<br>å¸æ³•è¡Œä¸º-èµ·è¯‰|ç»„ç»‡å…³ç³»-è£å‘˜,æœ€è¿‘ï¼Œä¸€ä½å‰ä¾¿åˆ©èœ‚å‘˜å·¥å°±å› å…¬å¸è¿è§„è£å‘˜ï¼Œå°†ä¾¿åˆ©èœ‚æ‰€åœ¨çš„å…¬å¸è™«æç§‘æŠ€ï¼ˆåŒ—äº¬ï¼‰æœ‰é™å…¬å¸å‘Šä¸Šæ³•åº­ã€‚<br>ç»„ç»‡å…³ç³»-è£å‘˜,æ€ç§‘ä¸Šæµ·å¤§è§„æ¨¡è£å‘˜äººå‡å¯è·èµ”100ä¸‡å®˜æ–¹æ¾„æ¸…äº‹å®<br>ç»„ç»‡å…³ç³»-è£å‘˜,æ—¥æœ¬å·¨å¤´é¢ä¸´å±æœºï¼Œå·²è£å‘˜1000å¤šäººï¼Œè‹¹æœä¹Ÿæ•‘ä¸äº†å®ƒï¼<br>ç»„ç»‡å…³ç³»-è£å‘˜|ç»„ç»‡å…³ç³»-è§£æ•£,åœ¨ç¡…è°·é•€é‡‘å¤±è´¥çš„é€ è½¦æ–°åŠ¿åŠ›ä»¬ï¼šè”šæ¥è£å‘˜ã€å¥‡ç‚¹è¢«å·çªƒã€æ‹œè…¾è§£æ•£<br></code></pre></td></tr></table></figure><p>åœ¨labelä¸­ï¼Œæ¯ä¸ªäº‹ä»¶ç±»å‹ç”¨|éš”å¼€ã€‚</p><p>åœ¨è¯¥æ•°æ®é›†ä¸­ï¼Œè®­ç»ƒé›†ä¸€å…±11958ä¸ªæ ·æœ¬ï¼Œæµ‹è¯•é›†ä¸€å…±1498ä¸ªæ ·æœ¬ã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æ¨¡å‹è®­ç»ƒçš„è„šæœ¬model_train.pyçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> codecs<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> load_trained_model_from_checkpoint, Tokenizer<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.optimizers <span class="hljs-keyword">import</span> Adam<br><br><span class="hljs-comment"># å»ºè®®é•¿åº¦&lt;=510</span><br>maxlen = <span class="hljs-number">256</span><br>BATCH_SIZE = <span class="hljs-number">8</span><br>config_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/bert_config.json&#x27;</span><br>checkpoint_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/bert_model.ckpt&#x27;</span><br>dict_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/vocab.txt&#x27;</span><br><br><br>token_dict = &#123;&#125;<br><span class="hljs-keyword">with</span> codecs.<span class="hljs-built_in">open</span>(dict_path, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> reader:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> reader:<br>        token = line.strip()<br>        token_dict[token] = <span class="hljs-built_in">len</span>(token_dict)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OurTokenizer</span>(<span class="hljs-title class_ inherited__">Tokenizer</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_tokenize</span>(<span class="hljs-params">self, text</span>):<br>        R = []<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text:<br>            <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> self._token_dict:<br>                R.append(c)<br>            <span class="hljs-keyword">else</span>:<br>                R.append(<span class="hljs-string">&#x27;[UNK]&#x27;</span>)   <span class="hljs-comment"># å‰©ä½™çš„å­—ç¬¦æ˜¯[UNK]</span><br>        <span class="hljs-keyword">return</span> R<br><br><br>tokenizer = OurTokenizer(token_dict)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">seq_padding</span>(<span class="hljs-params">X, padding=<span class="hljs-number">0</span></span>):<br>    L = [<span class="hljs-built_in">len</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> X]<br>    ML = <span class="hljs-built_in">max</span>(L)<br>    <span class="hljs-keyword">return</span> np.array([<br>        np.concatenate([x, [padding] * (ML - <span class="hljs-built_in">len</span>(x))]) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x) &lt; ML <span class="hljs-keyword">else</span> x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> X<br>    ])<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataGenerator</span>:<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data, batch_size=BATCH_SIZE</span>):<br>        self.data = data<br>        self.batch_size = batch_size<br>        self.steps = <span class="hljs-built_in">len</span>(self.data) // self.batch_size<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.data) % self.batch_size != <span class="hljs-number">0</span>:<br>            self.steps += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.steps<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            idxs = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.data)))<br>            np.random.shuffle(idxs)<br>            X1, X2, Y = [], [], []<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> idxs:<br>                d = self.data[i]<br>                text = d[<span class="hljs-number">0</span>][:maxlen]<br>                x1, x2 = tokenizer.encode(first=text)<br>                y = d[<span class="hljs-number">1</span>]<br>                X1.append(x1)<br>                X2.append(x2)<br>                Y.append(y)<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(X1) == self.batch_size <span class="hljs-keyword">or</span> i == idxs[-<span class="hljs-number">1</span>]:<br>                    X1 = seq_padding(X1)<br>                    X2 = seq_padding(X2)<br>                    Y = seq_padding(Y)<br>                    <span class="hljs-keyword">yield</span> [X1, X2], Y<br>                    [X1, X2, Y] = [], [], []<br><br><br><span class="hljs-comment"># æ„å»ºæ¨¡å‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_cls_model</span>(<span class="hljs-params">num_labels</span>):<br>    bert_model = load_trained_model_from_checkpoint(config_path, checkpoint_path, seq_len=<span class="hljs-literal">None</span>)<br><br>    <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> bert_model.layers:<br>        layer.trainable = <span class="hljs-literal">True</span><br><br>    x1_in = Input(shape=(<span class="hljs-literal">None</span>,))<br>    x2_in = Input(shape=(<span class="hljs-literal">None</span>,))<br><br>    x = bert_model([x1_in, x2_in])<br>    cls_layer = Lambda(<span class="hljs-keyword">lambda</span> x: x[:, <span class="hljs-number">0</span>])(x)    <span class="hljs-comment"># å–å‡º[CLS]å¯¹åº”çš„å‘é‡ç”¨æ¥åšåˆ†ç±»</span><br>    p = Dense(num_labels, activation=<span class="hljs-string">&#x27;sigmoid&#x27;</span>)(cls_layer)     <span class="hljs-comment"># å¤šåˆ†ç±»</span><br><br>    model = Model([x1_in, x2_in], p)<br>    model.<span class="hljs-built_in">compile</span>(<br>        loss=<span class="hljs-string">&#x27;binary_crossentropy&#x27;</span>,<br>        optimizer=Adam(<span class="hljs-number">1e-5</span>), <span class="hljs-comment"># ç”¨è¶³å¤Ÿå°çš„å­¦ä¹ ç‡</span><br>        metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>]<br>    )<br>    model.summary()<br><br>    <span class="hljs-keyword">return</span> model<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-comment"># æ•°æ®å¤„ç†, è¯»å–è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;begin data processing...&quot;</span>)<br>    train_df = pd.read_csv(<span class="hljs-string">&quot;data/train.csv&quot;</span>).fillna(value=<span class="hljs-string">&quot;&quot;</span>)<br>    test_df = pd.read_csv(<span class="hljs-string">&quot;data/test.csv&quot;</span>).fillna(value=<span class="hljs-string">&quot;&quot;</span>)<br><br>    select_labels = train_df[<span class="hljs-string">&quot;label&quot;</span>].unique()<br>    labels = []<br>    <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> select_labels:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;|&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> label:<br>            <span class="hljs-keyword">if</span> label <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> labels:<br>                labels.append(label)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> label.split(<span class="hljs-string">&quot;|&quot;</span>):<br>                <span class="hljs-keyword">if</span> _ <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> labels:<br>                    labels.append(_)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;label.json&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(json.dumps(<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(labels)), labels)), ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))<br><br>    train_data = []<br>    test_data = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(train_df.shape[<span class="hljs-number">0</span>]):<br>        label, content = train_df.iloc[i, :]<br>        label_id = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(labels)<br>        <span class="hljs-keyword">for</span> j, _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(labels):<br>            <span class="hljs-keyword">for</span> separate_label <span class="hljs-keyword">in</span> label.split(<span class="hljs-string">&quot;|&quot;</span>):<br>                <span class="hljs-keyword">if</span> _ == separate_label:<br>                    label_id[j] = <span class="hljs-number">1</span><br>        train_data.append((content, label_id))<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(test_df.shape[<span class="hljs-number">0</span>]):<br>        label, content = test_df.iloc[i, :]<br>        label_id = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(labels)<br>        <span class="hljs-keyword">for</span> j, _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(labels):<br>            <span class="hljs-keyword">for</span> separate_label <span class="hljs-keyword">in</span> label.split(<span class="hljs-string">&quot;|&quot;</span>):<br>                <span class="hljs-keyword">if</span> _ == separate_label:<br>                    label_id[j] = <span class="hljs-number">1</span><br>        test_data.append((content, label_id))<br><br>    <span class="hljs-comment"># print(train_data[:10])</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;finish data processing!&quot;</span>)<br><br>    <span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br>    model = create_cls_model(<span class="hljs-built_in">len</span>(labels))<br>    train_D = DataGenerator(train_data)<br>    test_D = DataGenerator(test_data)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;begin model training...&quot;</span>)<br>    model.fit_generator(<br>        train_D.__iter__(),<br>        steps_per_epoch=<span class="hljs-built_in">len</span>(train_D),<br>        epochs=<span class="hljs-number">10</span>,<br>        validation_data=test_D.__iter__(),<br>        validation_steps=<span class="hljs-built_in">len</span>(test_D)<br>    )<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;finish model training!&quot;</span>)<br><br>    <span class="hljs-comment"># æ¨¡å‹ä¿å­˜</span><br>    model.save(<span class="hljs-string">&#x27;multi-label-ee.h5&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Model saved!&quot;</span>)<br><br>    result = model.evaluate_generator(test_D.__iter__(), steps=<span class="hljs-built_in">len</span>(test_D))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¨¡å‹è¯„ä¼°ç»“æœ:&quot;</span>, result)<br></code></pre></td></tr></table></figure><p>æ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br><span class="hljs-section">Layer (type)                    Output Shape         Param #     Connected to                     </span><br><span class="hljs-section">==================================================================================================</span><br>input<span class="hljs-emphasis">_1 (InputLayer)            (None, None)         0                                            </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span>_<br>input<span class="hljs-emphasis">_2 (InputLayer)            (None, None)         0                                            </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span>_<br>model<span class="hljs-emphasis">_2 (Model)                 (None, None, 768)    101677056   input_</span>1[<span class="hljs-string">0</span>][<span class="hljs-symbol">0</span>]                    <br><span class="hljs-code">                                                                 input_2[0][0]                    </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">lambda_1 (Lambda)               (None, 768)          0           model_2[1][0]                    </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">dense_1 (Dense)                 (None, 65)           49985       lambda_1[0][0]                   </span><br><span class="hljs-code">==================================================================================================</span><br><span class="hljs-code">Total params: 101,727,041</span><br><span class="hljs-code">Trainable params: 101,727,041</span><br><span class="hljs-code">Non-trainable params: 0</span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br></code></pre></td></tr></table></figure><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¯¥æ¨¡å‹ç»“æ„ä¸æ–‡ç« <ahref="https://blog.csdn.net/jclian91/article/details/111742576">NLPï¼ˆä¸‰åäº”ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡</a>ä¸­ç»™å‡ºçš„æ–‡æœ¬å¤šåˆ†ç±»æ¨¡å‹ç»“æ„å¤§ä½“ä¸€è‡´ï¼Œä¿®æ”¹ä¹‹å¤„åœ¨äºBERTåæ¥çš„ç½‘ç»œç»“æ„ï¼Œæ‰€æ¥çš„ä¾ç„¶æ˜¯denseå±‚ï¼Œä½†æ¿€æ´»å‡½æ•°é‡‡ç”¨sigmoidå‡½æ•°ï¼ŒåŒæ—¶æŸå¤±å‡½æ•°ä¸ºbinary_crossentropyã€‚å°±å…¶æœ¬è´¨è€Œè¨€ï¼Œè¯¥æ¨¡å‹ç»“æ„æ˜¯å¯¹è¾“å‡ºçš„65ä¸ªç»“æœé‡‡ç”¨0-1åˆ†ç±»ï¼Œæ•…è€Œæ¿€æ´»å‡½æ•°é‡‡ç”¨sigmoidï¼Œè¿™å½“ç„¶æ˜¯æ–‡æœ¬å¤šåˆ†ç±»æ¨¡å‹è½¬åŒ–ä¸ºå¤šæ ‡ç­¾æ ‡ç­¾çš„æœ€ä¾¿æ·æ–¹å¼ï¼Œä½†ä¸è¶³ä¹‹å¤„åœ¨äºï¼Œè¯¥æ¨¡å‹å¹¶æœªè€ƒè™‘æ ‡ç­¾ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><h3 id="æ¨¡å‹è¯„ä¼°">æ¨¡å‹è¯„ä¼°</h3><p>æ¨¡å‹è¯„ä¼°è„šæœ¬model_evaluate.pyçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @Time : 2020/12/23 15:28</span><br><span class="hljs-comment"># @Author : Jclian91</span><br><span class="hljs-comment"># @File : model_evaluate.py</span><br><span class="hljs-comment"># @Place : Yangpu, Shanghai</span><br><span class="hljs-comment"># æ¨¡å‹è¯„ä¼°è„šæœ¬,åˆ©ç”¨hamming_lossä½œä¸ºå¤šæ ‡ç­¾åˆ†ç±»çš„è¯„ä¼°æŒ‡æ ‡ï¼Œè¯¥å€¼è¶Šå°æ¨¡å‹æ•ˆæœè¶Šå¥½</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> get_custom_objects<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> hamming_loss, classification_report<br><br><span class="hljs-keyword">from</span> model_train <span class="hljs-keyword">import</span> token_dict, OurTokenizer<br><br>maxlen = <span class="hljs-number">256</span><br><br><span class="hljs-comment"># åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹</span><br>model = load_model(<span class="hljs-string">&quot;multi-label-ee.h5&quot;</span>, custom_objects=get_custom_objects())<br>tokenizer = OurTokenizer(token_dict)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;label.json&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    label_dict = json.loads(f.read())<br><br><br><span class="hljs-comment"># å¯¹å•å¥è¯è¿›è¡Œé¢„æµ‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict_single_text</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-comment"># åˆ©ç”¨BERTè¿›è¡Œtokenize</span><br>    text = text[:maxlen]<br>    x1, x2 = tokenizer.encode(first=text)<br>    X1 = x1 + [<span class="hljs-number">0</span>] * (maxlen - <span class="hljs-built_in">len</span>(x1)) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x1) &lt; maxlen <span class="hljs-keyword">else</span> x1<br>    X2 = x2 + [<span class="hljs-number">0</span>] * (maxlen - <span class="hljs-built_in">len</span>(x2)) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x2) &lt; maxlen <span class="hljs-keyword">else</span> x2<br><br>    <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹å¹¶è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>    prediction = model.predict([[X1], [X2]])<br>    one_hot = np.where(prediction &gt; <span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">return</span> one_hot, <span class="hljs-string">&quot;|&quot;</span>.join([label_dict[<span class="hljs-built_in">str</span>(i)] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(one_hot)) <span class="hljs-keyword">if</span> one_hot[i]])<br><br><br><span class="hljs-comment"># æ¨¡å‹è¯„ä¼°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate</span>():<br>    test_df = pd.read_csv(<span class="hljs-string">&quot;data/test.csv&quot;</span>).fillna(value=<span class="hljs-string">&quot;&quot;</span>)<br>    true_y_list, pred_y_list = [], []<br>    true_label_list, pred_label_list = [], []<br>    common_cnt = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(test_df.shape[<span class="hljs-number">0</span>]):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;predict %d samples&quot;</span> % (i+<span class="hljs-number">1</span>))<br>        true_label, content = test_df.iloc[i, :]<br>        true_y = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(label_dict.keys())<br>        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> label_dict.items():<br>            <span class="hljs-keyword">if</span> value <span class="hljs-keyword">in</span> true_label:<br>                true_y[<span class="hljs-built_in">int</span>(key)] = <span class="hljs-number">1</span><br><br>        pred_y, pred_label = predict_single_text(content)<br>        <span class="hljs-keyword">if</span> true_label == pred_label:<br>            common_cnt += <span class="hljs-number">1</span><br>        true_y_list.append(true_y)<br>        pred_y_list.append(pred_y)<br>        true_label_list.append(true_label)<br>        pred_label_list.append(pred_label)<br><br>    <span class="hljs-comment"># F1å€¼</span><br>    <span class="hljs-built_in">print</span>(classification_report(true_y_list, pred_y_list, digits=<span class="hljs-number">4</span>))<br>    <span class="hljs-keyword">return</span> true_label_list, pred_label_list, hamming_loss(true_y_list, pred_y_list), common_cnt/<span class="hljs-built_in">len</span>(true_y_list)<br><br><br>true_labels, pred_labels, h_loss, accuracy = evaluate()<br>df = pd.DataFrame(&#123;<span class="hljs-string">&quot;y_true&quot;</span>: true_labels, <span class="hljs-string">&quot;y_pred&quot;</span>: pred_labels&#125;)<br>df.to_csv(<span class="hljs-string">&quot;pred_result.csv&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;accuracy: &quot;</span>, accuracy)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;hamming loss: &quot;</span>, h_loss)<br></code></pre></td></tr></table></figure><p>HammingLossä¸ºå¤šæ ‡ç­¾åˆ†ç±»æ‰€ç‰¹æœ‰çš„è¯„ä¼°æ–¹å¼ï¼Œå…¶å€¼è¶Šå°ä»£è¡¨å¤šæ ‡ç­¾åˆ†ç±»æ¨¡å‹çš„æ•ˆæœè¶Šå¥½ã€‚è¿è¡Œä¸Šè¿°æ¨¡å‹è¯„ä¼°ä»£ç ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache">   <span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9341</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9578</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9458</span>      <span class="hljs-number">1657</span><br>   <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9336</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9462</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9370</span>      <span class="hljs-number">1657</span><br><span class="hljs-attribute">weighted</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9367</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9578</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9456</span>      <span class="hljs-number">1657</span><br> <span class="hljs-attribute">samples</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9520</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9672</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9531</span>      <span class="hljs-number">1657</span><br><br><span class="hljs-attribute">accuracy</span>:  <span class="hljs-number">0</span>.<span class="hljs-number">8985313751668892</span><br><span class="hljs-attribute">hamming</span> loss:  <span class="hljs-number">0</span>.<span class="hljs-number">001869158878504673</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œç¬”è€…å¸Œæœ›ä¸ä¹‹å‰çš„æ–‡ç« <ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%85%AB%EF%BC%89%E5%A4%9A%E6%A0%87%E7%AD%BE%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåå…«ï¼‰å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»</a>ä¸­çš„æ¨¡å‹å¯¹æ¯”ä¸€ä¸‹ã€‚å½“æ—¶é‡‡ç”¨çš„æ¨¡å‹ä¸ºç”¨ALBERTæå–ç‰¹å¾å‘é‡ï¼Œå†ç”¨Bi-GRU+Attention+FCNè¿›è¡Œåˆ†ç±»ï¼Œæ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp36_2.png" alt="Bi-GRU+Attention+FCN" /><figcaption aria-hidden="true">Bi-GRU+Attention+FCN</figcaption></figure><p>å¯¹è¯¥æ¨¡å‹åŒæ ·é‡‡ç”¨ä¸Šè¿°è¯„ä¼°åŠæ³•ï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache">   <span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9424</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8292</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8822</span>      <span class="hljs-number">1657</span><br>   <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8983</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7218</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7791</span>      <span class="hljs-number">1657</span><br><span class="hljs-attribute">weighted</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9308</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8292</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8669</span>      <span class="hljs-number">1657</span><br> <span class="hljs-attribute">samples</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8675</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8496</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8517</span>      <span class="hljs-number">1657</span><br><span class="hljs-attribute">accuracy</span>:  <span class="hljs-number">0</span>.<span class="hljs-number">7983978638184246</span><br><span class="hljs-attribute">hamming</span> loss:  <span class="hljs-number">0</span>.<span class="hljs-number">0037691280681934887</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œé‡‡ç”¨BERTå¾®è°ƒçš„æ¨¡å‹ï¼Œåœ¨accuracyæ–¹é¢é«˜å‡ºäº†çº¦10%ï¼Œå„ç§F1å€¼é«˜å‡ºçº¦5%-10%ï¼ŒHammingLossä¹Ÿå°äº†å¾ˆå¤šã€‚å› æ­¤ï¼ŒBERTå¾®è°ƒçš„æ¨¡å‹æ¯”ä¹‹å‰çš„æ¨¡å‹æ•ˆæœå¥½å¾ˆå¤šã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/keras_bert_multi_label_cls">https://github.com/percent4/keras_bert_multi_label_cls</a>ã€‚</p><p>2020å¹´12æœˆ27æ—¥äºä¸Šæµ·æµ¦ä¸œ</p><h3 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h3><ol type="1"><li>NLPï¼ˆäºŒåå…«ï¼‰å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»ï¼šhttps://blog.csdn.net/jclian91/article/details/105386190</li><li>NLPï¼ˆä¸‰åäº”ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡ï¼šhttps://blog.csdn.net/jclian91/article/details/111742576</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>keras-bert</tag>
      
      <tag>å¤šæ ‡ç­¾åˆ†ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åäº”ï¼‰ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E5%A4%9A%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»ä»»åŠ¡ï¼Œå…¶ä¸­å¯¹BERTè¿›è¡Œ<code>å¾®è°ƒ</code>ã€‚</p><h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3><figure><img src="/img/nlp35_1.png" alt="keras-bertæ–‡æœ¬å¤šåˆ†ç±»é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">keras-bertæ–‡æœ¬å¤šåˆ†ç±»é¡¹ç›®ç»“æ„</figcaption></figure><p>å…¶ä¸­ä¾èµ–çš„Pythonç¬¬ä¸‰æ–¹æ¨¡å—å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">pandas==0.23.4<br>Keras==2.3.1<br>keras_bert==0.83.0<br>numpy==1.16.4<br></code></pre></td></tr></table></figure><h3 id="æ•°æ®é›†">æ•°æ®é›†</h3><p>æœ¬æ–‡é‡‡ç”¨çš„å¤šåˆ†ç±»æ•°æ®é›†ä¸ºsougouå°åˆ†ç±»æ•°æ®é›†å’ŒTHUCNewsæ•°æ®é›†ï¼Œç®€ä»‹å¦‚ä¸‹ï¼š</p><ul><li>sougouå°åˆ†ç±»æ•°æ®é›†</li></ul><p>å…±æœ‰5ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«ä¸ºä½“è‚²ã€å¥åº·ã€å†›äº‹ã€æ•™è‚²ã€æ±½è½¦ã€‚åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå…¶ä¸­è®­ç»ƒé›†æ¯ä¸ªåˆ†ç±»800æ¡æ ·æœ¬ï¼Œæµ‹è¯•é›†æ¯ä¸ªåˆ†ç±»100æ¡æ ·æœ¬ã€‚</p><ul><li>THUCNewsæ•°æ®é›†</li></ul><p>å…±æœ‰10ä¸ªåˆ†ç±»ï¼Œç±»åˆ«ä¸ºï¼šä½“è‚², è´¢ç», æˆ¿äº§, å®¶å±…, æ•™è‚², ç§‘æŠ€, æ—¶å°š, æ—¶æ”¿,æ¸¸æˆ, å¨±ä¹ã€‚æ•°æ®é›†åˆ’åˆ†ä¸ºï¼šè®­ç»ƒé›†: 5000 * 10ï¼Œæµ‹è¯•é›†: 1000 * 10ã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æ¨¡å‹è®­ç»ƒè„šæœ¬model_train.pyçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> codecs<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> load_trained_model_from_checkpoint, Tokenizer<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.optimizers <span class="hljs-keyword">import</span> Adam<br><br><span class="hljs-comment"># å»ºè®®é•¿åº¦&lt;=510</span><br>maxlen = <span class="hljs-number">300</span><br>BATCH_SIZE = <span class="hljs-number">8</span><br>config_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/bert_config.json&#x27;</span><br>checkpoint_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/bert_model.ckpt&#x27;</span><br>dict_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/vocab.txt&#x27;</span><br><br><br>token_dict = &#123;&#125;<br><span class="hljs-keyword">with</span> codecs.<span class="hljs-built_in">open</span>(dict_path, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> reader:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> reader:<br>        token = line.strip()<br>        token_dict[token] = <span class="hljs-built_in">len</span>(token_dict)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OurTokenizer</span>(<span class="hljs-title class_ inherited__">Tokenizer</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_tokenize</span>(<span class="hljs-params">self, text</span>):<br>        R = []<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text:<br>            <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> self._token_dict:<br>                R.append(c)<br>            <span class="hljs-keyword">else</span>:<br>                R.append(<span class="hljs-string">&#x27;[UNK]&#x27;</span>)   <span class="hljs-comment"># å‰©ä½™çš„å­—ç¬¦æ˜¯[UNK]</span><br>        <span class="hljs-keyword">return</span> R<br><br><br>tokenizer = OurTokenizer(token_dict)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">seq_padding</span>(<span class="hljs-params">X, padding=<span class="hljs-number">0</span></span>):<br>    L = [<span class="hljs-built_in">len</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> X]<br>    ML = <span class="hljs-built_in">max</span>(L)<br>    <span class="hljs-keyword">return</span> np.array([<br>        np.concatenate([x, [padding] * (ML - <span class="hljs-built_in">len</span>(x))]) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x) &lt; ML <span class="hljs-keyword">else</span> x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> X<br>    ])<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataGenerator</span>:<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data, batch_size=BATCH_SIZE</span>):<br>        self.data = data<br>        self.batch_size = batch_size<br>        self.steps = <span class="hljs-built_in">len</span>(self.data) // self.batch_size<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.data) % self.batch_size != <span class="hljs-number">0</span>:<br>            self.steps += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.steps<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            idxs = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.data)))<br>            np.random.shuffle(idxs)<br>            X1, X2, Y = [], [], []<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> idxs:<br>                d = self.data[i]<br>                text = d[<span class="hljs-number">0</span>][:maxlen]<br>                x1, x2 = tokenizer.encode(first=text)<br>                y = d[<span class="hljs-number">1</span>]<br>                X1.append(x1)<br>                X2.append(x2)<br>                Y.append(y)<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(X1) == self.batch_size <span class="hljs-keyword">or</span> i == idxs[-<span class="hljs-number">1</span>]:<br>                    X1 = seq_padding(X1)<br>                    X2 = seq_padding(X2)<br>                    Y = seq_padding(Y)<br>                    <span class="hljs-keyword">yield</span> [X1, X2], Y<br>                    [X1, X2, Y] = [], [], []<br><br><br><span class="hljs-comment"># æ„å»ºæ¨¡å‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_cls_model</span>(<span class="hljs-params">num_labels</span>):<br>    bert_model = load_trained_model_from_checkpoint(config_path, checkpoint_path, seq_len=<span class="hljs-literal">None</span>)<br><br>    <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> bert_model.layers:<br>        layer.trainable = <span class="hljs-literal">True</span><br><br>    x1_in = Input(shape=(<span class="hljs-literal">None</span>,))<br>    x2_in = Input(shape=(<span class="hljs-literal">None</span>,))<br><br>    x = bert_model([x1_in, x2_in])<br>    cls_layer = Lambda(<span class="hljs-keyword">lambda</span> x: x[:, <span class="hljs-number">0</span>])(x)    <span class="hljs-comment"># å–å‡º[CLS]å¯¹åº”çš„å‘é‡ç”¨æ¥åšåˆ†ç±»</span><br>    p = Dense(num_labels, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>)(cls_layer)     <span class="hljs-comment"># å¤šåˆ†ç±»</span><br><br>    model = Model([x1_in, x2_in], p)<br>    model.<span class="hljs-built_in">compile</span>(<br>        loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>,<br>        optimizer=Adam(<span class="hljs-number">1e-5</span>),   <span class="hljs-comment"># ç”¨è¶³å¤Ÿå°çš„å­¦ä¹ ç‡</span><br>        metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>]<br>    )<br>    <span class="hljs-comment"># model.summary()</span><br><br>    <span class="hljs-keyword">return</span> model<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-comment"># æ•°æ®å¤„ç†, è¯»å–è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;begin data processing...&quot;</span>)<br>    train_df = pd.read_csv(<span class="hljs-string">&quot;data/cnews/cnews_train.csv&quot;</span>).fillna(value=<span class="hljs-string">&quot;&quot;</span>)<br>    test_df = pd.read_csv(<span class="hljs-string">&quot;data/cnews/cnews_test.csv&quot;</span>).fillna(value=<span class="hljs-string">&quot;&quot;</span>)<br><br>    labels = train_df[<span class="hljs-string">&quot;label&quot;</span>].unique()<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;label.json&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(json.dumps(<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(labels)), labels)), ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))<br><br>    train_data = []<br>    test_data = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(train_df.shape[<span class="hljs-number">0</span>]):<br>        label, content = train_df.iloc[i, :]<br>        label_id = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(labels)<br>        <span class="hljs-keyword">for</span> j, _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(labels):<br>            <span class="hljs-keyword">if</span> _ == label:<br>                label_id[j] = <span class="hljs-number">1</span><br>        train_data.append((content, label_id))<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(test_df.shape[<span class="hljs-number">0</span>]):<br>        label, content = test_df.iloc[i, :]<br>        label_id = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(labels)<br>        <span class="hljs-keyword">for</span> j, _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(labels):<br>            <span class="hljs-keyword">if</span> _ == label:<br>                label_id[j] = <span class="hljs-number">1</span><br>        test_data.append((content, label_id))<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;finish data processing!&quot;</span>)<br><br>    <span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br>    model = create_cls_model(<span class="hljs-built_in">len</span>(labels))<br>    train_D = DataGenerator(train_data)<br>    test_D = DataGenerator(test_data)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;begin model training...&quot;</span>)<br>    model.fit_generator(<br>        train_D.__iter__(),<br>        steps_per_epoch=<span class="hljs-built_in">len</span>(train_D),<br>        epochs=<span class="hljs-number">3</span>,<br>        validation_data=test_D.__iter__(),<br>        validation_steps=<span class="hljs-built_in">len</span>(test_D)<br>    )<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;finish model training!&quot;</span>)<br><br>    <span class="hljs-comment"># æ¨¡å‹ä¿å­˜</span><br>    model.save(<span class="hljs-string">&#x27;cls_cnews.h5&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Model saved!&quot;</span>)<br><br>    result = model.evaluate_generator(test_D.__iter__(), steps=<span class="hljs-built_in">len</span>(test_D))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¨¡å‹è¯„ä¼°ç»“æœ:&quot;</span>, result)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­æ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br><span class="hljs-section">Layer (type)                    Output Shape         Param #     Connected to                     </span><br><span class="hljs-section">==================================================================================================</span><br>input<span class="hljs-emphasis">_1 (InputLayer)            (None, None)         0                                            </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span>_<br>input<span class="hljs-emphasis">_2 (InputLayer)            (None, None)         0                                            </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span>_<br>model<span class="hljs-emphasis">_2 (Model)                 (None, None, 768)    101677056   input_</span>1[<span class="hljs-string">0</span>][<span class="hljs-symbol">0</span>]                    <br><span class="hljs-code">                                                                 input_2[0][0]                    </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">lambda_1 (Lambda)               (None, 768)          0           model_2[1][0]                    </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">dense_1 (Dense)                 (None, 10)           7690        lambda_1[0][0]                   </span><br><span class="hljs-code">==================================================================================================</span><br><span class="hljs-code">Total params: 101,684,746</span><br><span class="hljs-code">Trainable params: 101,684,746</span><br><span class="hljs-code">Non-trainable params: 0</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å–å–å‡º[CLS]å¯¹åº”çš„å‘é‡ï¼Œåæ¥å…¨è¿æ¥å±‚ï¼Œæ¿€æ´»å‡½æ•°é‡‡ç”¨Softmaxå‡½æ•°ï¼Œå°±å®Œæˆå¤šåˆ†ç±»æ¨¡å‹çš„æ­å»ºäº†ï¼Œéå¸¸ç®€å•æ–¹ä¾¿ã€‚</p><h3 id="æ¨¡å‹è¯„ä¼°">æ¨¡å‹è¯„ä¼°</h3><p>æ¨¡å‹è¯„ä¼°è„šæœ¬model_evaluate.pyçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># æ¨¡å‹è¯„ä¼°è„šæœ¬</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> get_custom_objects<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report<br><br><span class="hljs-keyword">from</span> model_train <span class="hljs-keyword">import</span> token_dict, OurTokenizer<br><br>maxlen = <span class="hljs-number">300</span><br><br><span class="hljs-comment"># åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹</span><br>model = load_model(<span class="hljs-string">&quot;cls_cnews.h5&quot;</span>, custom_objects=get_custom_objects())<br>tokenizer = OurTokenizer(token_dict)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;label.json&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    label_dict = json.loads(f.read())<br><br><br><span class="hljs-comment"># å¯¹å•å¥è¯è¿›è¡Œé¢„æµ‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict_single_text</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-comment"># åˆ©ç”¨BERTè¿›è¡Œtokenize</span><br>    text = text[:maxlen]<br>    x1, x2 = tokenizer.encode(first=text)<br>    X1 = x1 + [<span class="hljs-number">0</span>] * (maxlen - <span class="hljs-built_in">len</span>(x1)) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x1) &lt; maxlen <span class="hljs-keyword">else</span> x1<br>    X2 = x2 + [<span class="hljs-number">0</span>] * (maxlen - <span class="hljs-built_in">len</span>(x2)) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x2) &lt; maxlen <span class="hljs-keyword">else</span> x2<br><br>    <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹å¹¶è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>    predicted = model.predict([[X1], [X2]])<br>    y = np.argmax(predicted[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">return</span> label_dict[<span class="hljs-built_in">str</span>(y)]<br><br><br><span class="hljs-comment"># æ¨¡å‹è¯„ä¼°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate</span>():<br>    test_df = pd.read_csv(<span class="hljs-string">&quot;data/cnews/cnews_test.csv&quot;</span>).fillna(value=<span class="hljs-string">&quot;&quot;</span>)<br>    true_y_list, pred_y_list = [], []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(test_df.shape[<span class="hljs-number">0</span>]):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;predict %d samples&quot;</span> % (i+<span class="hljs-number">1</span>))<br>        true_y, content = test_df.iloc[i, :]<br>        pred_y = predict_single_text(content)<br>        true_y_list.append(true_y)<br>        pred_y_list.append(pred_y)<br><br>    <span class="hljs-keyword">return</span> classification_report(true_y_list, pred_y_list, digits=<span class="hljs-number">4</span>)<br><br><br>output_data = evaluate()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;model evaluate result:\n&quot;</span>)<br><span class="hljs-built_in">print</span>(output_data)<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå¯¹ä¸¤ä¸ªæ•°æ®é›†è¿›è¡Œè¯„ä¼°ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><ul><li>sougouæ•°æ®é›†</li></ul><p>æ¨¡å‹å‚æ•°: batch_size = 8, maxlen = 256, epoch=10</p><p>è¯„ä¼°ç»“æœ:</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs crystal">                  precision    recall  f1-score   support<br><br>          ä½“è‚²     <span class="hljs-number">0.9802</span>    <span class="hljs-number">1.0000</span>    <span class="hljs-number">0.9900</span>        <span class="hljs-number">99</span><br>          å¥åº·     <span class="hljs-number">0.9495</span>    <span class="hljs-number">0.9495</span>    <span class="hljs-number">0.9495</span>        <span class="hljs-number">99</span><br>          å†›äº‹     <span class="hljs-number">1.0000</span>    <span class="hljs-number">1.0000</span>    <span class="hljs-number">1.0000</span>        <span class="hljs-number">99</span><br>          æ•™è‚²     <span class="hljs-number">0.9307</span>    <span class="hljs-number">0.9495</span>    <span class="hljs-number">0.9400</span>        <span class="hljs-number">99</span><br>          æ±½è½¦     <span class="hljs-number">0.9895</span>    <span class="hljs-number">0.9495</span>    <span class="hljs-number">0.9691</span>        <span class="hljs-number">99</span><br><br>    accuracy                         <span class="hljs-number">0.9697</span>       <span class="hljs-number">495</span><br>   <span class="hljs-function"><span class="hljs-keyword">macro</span> <span class="hljs-title">avg</span></span>     <span class="hljs-number">0.9700</span>    <span class="hljs-number">0.9697</span>    <span class="hljs-number">0.9697</span>       <span class="hljs-number">495</span><br>weighted avg     <span class="hljs-number">0.9700</span>    <span class="hljs-number">0.9697</span>    <span class="hljs-number">0.9697</span>       <span class="hljs-number">495</span><br></code></pre></td></tr></table></figure><ul><li>THUCNewsæ•°æ®é›†</li></ul><p>æ¨¡å‹å‚æ•°: batch_size = 8, maxlen = 300, epoch=3</p><p>è¯„ä¼°ç»“æœ:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml">                <span class="hljs-string">precision</span>    <span class="hljs-string">recall</span>  <span class="hljs-string">f1-score</span>   <span class="hljs-string">support</span><br><br>          <span class="hljs-string">ä½“è‚²</span>     <span class="hljs-number">0.9970</span>    <span class="hljs-number">0.9990</span>    <span class="hljs-number">0.9980</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">å¨±ä¹</span>     <span class="hljs-number">0.9890</span>    <span class="hljs-number">0.9890</span>    <span class="hljs-number">0.9890</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">å®¶å±…</span>     <span class="hljs-number">0.9949</span>    <span class="hljs-number">0.7820</span>    <span class="hljs-number">0.8757</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æˆ¿äº§</span>     <span class="hljs-number">0.8006</span>    <span class="hljs-number">0.8710</span>    <span class="hljs-number">0.8343</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æ•™è‚²</span>     <span class="hljs-number">0.9753</span>    <span class="hljs-number">0.9480</span>    <span class="hljs-number">0.9615</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æ—¶å°š</span>     <span class="hljs-number">0.9708</span>    <span class="hljs-number">0.9980</span>    <span class="hljs-number">0.9842</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æ—¶æ”¿</span>     <span class="hljs-number">0.9318</span>    <span class="hljs-number">0.9560</span>    <span class="hljs-number">0.9437</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æ¸¸æˆ</span>     <span class="hljs-number">0.9851</span>    <span class="hljs-number">0.9950</span>    <span class="hljs-number">0.9900</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">ç§‘æŠ€</span>     <span class="hljs-number">0.9689</span>    <span class="hljs-number">0.9970</span>    <span class="hljs-number">0.9828</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">è´¢ç»</span>     <span class="hljs-number">0.9377</span>    <span class="hljs-number">0.9930</span>    <span class="hljs-number">0.9645</span>      <span class="hljs-number">1000</span><br><br>    <span class="hljs-string">accuracy</span>                         <span class="hljs-number">0.9528</span>     <span class="hljs-number">10000</span><br>   <span class="hljs-string">macro</span> <span class="hljs-string">avg</span>     <span class="hljs-number">0.9551</span>    <span class="hljs-number">0.9528</span>    <span class="hljs-number">0.9524</span>     <span class="hljs-number">10000</span><br><span class="hljs-string">weighted</span> <span class="hljs-string">avg</span>     <span class="hljs-number">0.9551</span>    <span class="hljs-number">0.9528</span>    <span class="hljs-number">0.9524</span>     <span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æ¨¡å‹é¢„æµ‹è„šæœ¬model_predict.pyçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @Time : 2020/12/23 15:28</span><br><span class="hljs-comment"># @Author : Jclian91</span><br><span class="hljs-comment"># @File : model_predict.py</span><br><span class="hljs-comment"># @Place : Yangpu, Shanghai</span><br><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹è„šæœ¬</span><br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">from</span> model_train <span class="hljs-keyword">import</span> token_dict, OurTokenizer<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> get_custom_objects<br><br>maxlen = <span class="hljs-number">256</span><br><br><span class="hljs-comment"># åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹</span><br>model = load_model(<span class="hljs-string">&quot;cls_sougou.h5&quot;</span>, custom_objects=get_custom_objects())<br>tokenizer = OurTokenizer(token_dict)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;label.json&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    label_dict = json.loads(f.read())<br><br>s_time = time.time()<br><span class="hljs-comment"># é¢„æµ‹ç¤ºä¾‹è¯­å¥</span><br>text = <span class="hljs-string">&quot;è¯´åˆ°ç¡¬æ´¾è¶Šé‡SUVï¼Œä½ ä¼šæƒ³èµ·å“ªäº›è½¦å‹ï¼Ÿæ˜¯è¢«ç§°ä¸ºâ€œéœ¸é“â€çš„ä¸°ç”° æ™®æ‹‰å¤š (é…ç½® | è¯¢ä»·) ï¼Œè¿˜æ˜¯è¢«å«åšâ€œå±±çŒ«â€çš„å¸•æ°ç½—ï¼Œäº¦æˆ–è€…æ˜¯â€œæ¸£ç”·ä¸“è½¦â€å¥”é©°å¤§Gã€&quot;</span> \<br>       <span class="hljs-string">&quot;â€œæ²™æ¼ ç‹å­â€é€”ä¹ã€‚æ€»ä¹‹ï¼Œéšç€ä¸–ç•Œå„å›½è¶Šæ¥è¶Šé‡è§†å¯¹ç¯å¢ƒçš„ä¿æŠ¤ï¼Œé‚£äº›å¤§æ’é‡çš„è¶Šé‡SUVåœ¨ä¸ä¹…çš„å°†æ¥ä¹Ÿä¼šæ¸æ¸æ¶ˆå¤±åœ¨æˆ‘ä»¬çš„è§†çº¿ä¹‹ä¸­ï¼Œæ‰€ä»¥ä¸å…¶é”™è¿‡ï¼Œ&quot;</span> \<br>       <span class="hljs-string">&quot;ä¸å¦‚è¶ç€è¿˜å¹´è½»ï¼Œåœ¨æœ‰ç”Ÿä¹‹å¹´é‡Œèµ¶ç´§å»å…¥æ‰‹ä¸€å°èƒ½è®©ä½ å¿ƒä»ªçš„ç¡¬æ´¾è¶Šé‡SUVã€‚è€Œä»Šå¤©æˆ‘æƒ³è¦æ¥è·Ÿä½ ä»¬èŠçš„ï¼Œæ­£æ˜¯å…¨çƒå…¬è®¤çš„åå¤§ç¡¬æ´¾è¶Šé‡SUVï¼Œ&quot;</span> \<br>       <span class="hljs-string">&quot;è¶Šé‡è¿·ä»¬çœ‹å®Œä¹‹åä¹Ÿä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼Œåˆ°åº•å“ªæ¬¾æ‰æ˜¯ä½ çš„èœï¼Œä¸‹é¢è¯ä¸å¤šè¯´ï¼Œèµ¶ç´§å¼€å§‹å§ã€‚&quot;</span><br><br><br><span class="hljs-comment"># åˆ©ç”¨BERTè¿›è¡Œtokenize</span><br>text = text[:maxlen]<br>x1, x2 = tokenizer.encode(first=text)<br><br>X1 = x1 + [<span class="hljs-number">0</span>] * (maxlen-<span class="hljs-built_in">len</span>(x1)) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x1) &lt; maxlen <span class="hljs-keyword">else</span> x1<br>X2 = x2 + [<span class="hljs-number">0</span>] * (maxlen-<span class="hljs-built_in">len</span>(x2)) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x2) &lt; maxlen <span class="hljs-keyword">else</span> x2<br><br><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹å¹¶è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>predicted = model.predict([[X1], [X2]])<br>y = np.argmax(predicted[<span class="hljs-number">0</span>])<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŸæ–‡: %s&quot;</span> % text)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é¢„æµ‹æ ‡ç­¾: %s&quot;</span> % label_dict[<span class="hljs-built_in">str</span>(y)])<br>e_time = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cost time:&quot;</span>, e_time-s_time)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ–°çš„æ ·æœ¬ä¸Šè¿›è¡Œæ¨¡å‹é¢„æµ‹ã€‚</p><ul><li>sougouæ•°æ®é›†</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">åŸæ–‡: è¯´åˆ°ç¡¬æ´¾è¶Šé‡SUVï¼Œä½ ä¼šæƒ³èµ·å“ªäº›è½¦å‹ï¼Ÿæ˜¯è¢«ç§°ä¸ºâ€œéœ¸é“â€çš„ä¸°ç”° æ™®æ‹‰å¤š (é…ç½® | è¯¢ä»·) ï¼Œè¿˜æ˜¯è¢«å«åšâ€œå±±çŒ«â€çš„å¸•æ°ç½—ï¼Œäº¦æˆ–è€…æ˜¯â€œæ¸£ç”·ä¸“è½¦â€å¥”é©°å¤§Gã€â€œæ²™æ¼ ç‹å­â€é€”ä¹ã€‚æ€»ä¹‹ï¼Œéšç€ä¸–ç•Œå„å›½è¶Šæ¥è¶Šé‡è§†å¯¹ç¯å¢ƒçš„ä¿æŠ¤ï¼Œé‚£äº›å¤§æ’é‡çš„è¶Šé‡SUVåœ¨ä¸ä¹…çš„å°†æ¥ä¹Ÿä¼šæ¸æ¸æ¶ˆå¤±åœ¨æˆ‘ä»¬çš„è§†çº¿ä¹‹ä¸­ï¼Œæ‰€ä»¥ä¸å…¶é”™è¿‡ï¼Œä¸å¦‚è¶ç€è¿˜å¹´è½»ï¼Œåœ¨æœ‰ç”Ÿä¹‹å¹´é‡Œèµ¶ç´§å»å…¥æ‰‹ä¸€å°èƒ½è®©ä½ å¿ƒä»ªçš„ç¡¬æ´¾è¶Šé‡SUVã€‚è€Œä»Šå¤©æˆ‘æƒ³è¦æ¥è·Ÿä½ ä»¬èŠçš„ï¼Œæ­£æ˜¯å…¨çƒå…¬è®¤çš„åå¤§ç¡¬æ´¾è¶Šé‡SUVï¼Œè¶Šé‡è¿·ä»¬çœ‹å®Œä¹‹åä¹Ÿä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼Œåˆ°åº•å“ªæ¬¾æ‰æ˜¯ä½ çš„èœï¼Œä¸‹é¢è¯ä¸å¤šè¯´ï¼Œèµ¶ç´§å¼€å§‹å§ã€‚</span><br><span class="hljs-section">é¢„æµ‹æ ‡ç­¾: æ±½è½¦</span><br><br><span class="hljs-section">åŸæ–‡: ã€#ç¾30æ¶æˆ˜æœºåœ¨é˜¿æ‹‰æ–¯åŠ æµ·å²¸å¤§è±¡æ¼«æ­¥#ã€‘æ®ç¾å›½è‰¾å°”æ£®ç©ºå†›åŸºåœ°ç½‘ç«™æ¶ˆæ¯ç§°ï¼Œè¿‘æ—¥ç¾å›½ç©ºå†›30æ¶æˆ˜æ–—æœºå’Œ2æ¶ç©ºä¸­åŠ æ²¹æœºè‡ªè‰¾å°”æ£®ç©ºå†›åŸºåœ°èµ·é£ï¼Œåœ¨é˜¿æ‹‰æ–¯åŠ æµ·å²¸å®Œæˆäº†â€å¤§è±¡æ¼«æ­¥â€œå¼çš„æ¼”ä¹ ã€‚</span><br><span class="hljs-section">é¢„æµ‹æ ‡ç­¾: å†›äº‹</span><br><br><span class="hljs-section">åŸæ–‡: â€œåä¸‰äº”â€æœŸé—´ï¼Œæˆ‘å›½ä¹‰åŠ¡æ•™è‚²ä¸‰ç§‘ç»Ÿç¼–æ•™æå®ç°æ‰€æœ‰å¹´çº§å…¨è¦†ç›–ï¼›æ™®é€šé«˜ä¸­ä¸‰ç§‘ç»Ÿç¼–æ•™æå·²è¦†ç›–20ä¸ªçœä»½ï¼Œé¢„è®¡2022å¹´å‰å®ç°æ‰€æœ‰çœä»½å…¨è¦†ç›–ï¼Œ2025å¹´å®ç°æ‰€æœ‰å¹´çº§å…¨è¦†ç›–ã€‚æ˜¨æ—¥ï¼Œåœ¨æ•™è‚²éƒ¨æ–°é—»å‘å¸ƒä¼šä¸Šï¼Œæ•™è‚²éƒ¨æ•™æå±€å±€é•¿ç”°æ…§ç”Ÿé€éœ²ï¼Œä¹‰åŠ¡æ•™è‚²è¯¾ç¨‹æ–¹æ¡ˆå’Œå„å­¦ç§‘è¯¾ç¨‹æ ‡å‡†ä¿®è®¢æ˜å¹´å®Œæˆã€‚</span><br><span class="hljs-section">é¢„æµ‹æ ‡ç­¾: æ•™è‚²</span><br></code></pre></td></tr></table></figure><ul><li>THUCNewsæ•°æ®é›†</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">åŸæ–‡: åŒ—äº¬æ—¶é—´12æœˆ26æ—¥,2020-21èµ›å­£NBAåœ£è¯å¤§æˆ˜å¦‚çº¦ä¸Šæ¼”ã€‚åœ¨ä¸€åœºç„¦ç‚¹å¯¹å†³ä¸­ï¼Œæ´›æ‰çŸ¶æ¹–äººåœ¨ä¸»åœºä¸è¾¾æ‹‰æ–¯ç‹¬è¡Œä¾ é­é‡ã€‚å…¨åœºæ‰“å®Œï¼Œæ¹–äºº138-115è½»å–ç‹¬è¡Œä¾ ï¼Œæ‹¿åˆ°èµ›å­£é¦–èƒœï¼ŒåŒæ—¶ä¹Ÿé€ç»™å¯¹æ‰‹2è¿è´¥ã€‚</span><br><span class="hljs-section">é¢„æµ‹æ ‡ç­¾: ä½“è‚²</span><br><br><span class="hljs-section">åŸæ–‡: è¿‘ä¸¤å¹´æ¥ï¼Œæ‰‹æœºå±å¹•å°±å¼€å§‹ä¸æ–­å‡çº§ï¼Œé«˜åˆ·æ–°ç‡ä¹Ÿæˆä¸ºä¸€ç§è¶‹åŠ¿ï¼Œå°±ç®—æ€§èƒ½åšçš„å†å¥½ï¼Œæ‰‹æœºå±å¹•ä¸èƒ½æµç•…çœŸå®çš„å±•ç°å‡ºæ¥ï¼Œä¹Ÿä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå½±å“ä½¿ç”¨æ„Ÿå—ï¼Œæ‰€ä»¥å±å¹•å°±æ˜¯æ‰‹æœºç¡¬ä»¶çš„çª—æˆ·ï¼Œå¯ä»¥é¢„è§æœªæ¥çš„é«˜ç«¯æ‰‹æœºåœ¨å†²å‡»æ€§èƒ½çš„åŒæ—¶ï¼Œå¿…ç„¶ä¼šå¯¹æé«˜å¯¹å±å¹•çš„è¦æ±‚ã€‚</span><br><span class="hljs-section">é¢„æµ‹æ ‡ç­¾: ç§‘æŠ€</span><br><br><span class="hljs-section">åŸæ–‡: æ¾æ±Ÿä½˜å±±æ¿å—å·²å¤ªä¹…æ²¡æœ‰è±ªå®…å…¥å¸‚ï¼Œä»¤åŒºåŸŸå†…ä¸å°‘é«˜ç«¯ç½®ä¸šå®¢å¯‚å¯éš¾è€ã€‚ä¸è¿‡å¥½åœ¨ï¼Œä¸ä¹…å‰ç«çˆ†ç™»åœºçš„å›½è´¸ä½˜å±±åŸå¢…ä¸€ä¸‹å­æ»¡è¶³äº†è¿™ç±»å®¢æˆ·çš„éœ€æ±‚ã€‚  æ— è®ºæ˜¯ç¤¾åŒºè§„åˆ’ã€äº§å“æˆ·å‹ã€è£…ä¿®é…ç½®ï¼Œè¿˜æ˜¯è®¾è®¡æ‰‹æ³•ï¼Œç›¸è¾ƒäºå‘¨è¾¹åƒä¸‡çº§åˆ«å¢…ï¼Œå›½è´¸ä½˜å±±åŸå¢…ä¹Ÿæ˜¯ä¸é€å¤šè®©ï¼Œæ›´ä»¤äººæƒŠå–œçš„æ˜¯åˆ«å¢…çš„å“è´¨å´ä»…éœ€å…¬å¯“çš„ä»·æ ¼ï¼</span><br><span class="hljs-section">é¢„æµ‹æ ‡ç­¾: æˆ¿äº§</span><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼š <ahref="https://github.com/percent4/keras_bert_text_classification">https://github.com/percent4/keras_bert_text_classification</a>ã€‚</p><p>åç»­å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡ã€‚</p><p>2020å¹´12æœˆ26æ—¥äºä¸Šæµ·æµ¦ä¸œ</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>keras-bert</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åå››ï¼‰ä½¿ç”¨keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8keras-bert%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å¯¹äºä¸åŒçš„NLPä»»åŠ¡ï¼Œä½¿ç”¨BERTç­‰é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒæ— ç–‘æ˜¯ä½¿ç”¨å®ƒä»¬çš„æœ€ä½³æ–¹å¼ã€‚åœ¨ç½‘ä¸Šå·²ç»æœ‰ä¸å°‘çš„é¡¹ç›®ï¼Œæˆ–è€…ä½¿ç”¨TensorFlowï¼Œæˆ–è€…ä½¿ç”¨Kerasï¼Œæˆ–è€…ä½¿ç”¨PyTorchå¯¹BERTè¿›è¡Œå¾®è°ƒã€‚æœ¬ç³»åˆ—æ–‡ç« å°†è‡´åŠ›äºåº”ç”¨keras-bertå¯¹BERTè¿›è¡Œå¾®è°ƒï¼Œå®ŒæˆåŸºç¡€çš„NLPä»»åŠ¡ï¼Œæ¯”å¦‚æ–‡æœ¬å¤šåˆ†ç±»ã€æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ä»¥åŠåºåˆ—æ ‡æ³¨ç­‰ã€‚</p><p>keras-bertæ˜¯Pythonçš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå®ƒæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨Kerasæ¥è°ƒç”¨BERTï¼Œå€ŸåŠ©å‡ è¡Œä»£ç å°±å¯ä»¥è½»æ¾åœ°å®Œæˆæ¨¡å‹æ„å»ºï¼Œèƒ½ä¾æ®ä¸åŒçš„æ–‡æœ¬ä»»åŠ¡è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œè·å¾—ä¸é”™çš„æ•ˆæœã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•keras-bertå®ç°åºåˆ—æ ‡æ³¨ä»»åŠ¡ã€‚</p><h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3><p>æœ¬é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp34_1.png" alt="é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„</figcaption></figure><p>æ‰€ä½¿ç”¨çš„Pythonç¬¬ä¸‰æ–¹æ¨¡å—å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">keras_bert==0.83.0<br>Keras==2.2.4<br>seqeval==0.0.10<br>keras_contrib==2.0.8<br>matplotlib==3.3.1<br>numpy==1.16.4<br>Flask==1.1.2<br></code></pre></td></tr></table></figure><h3 id="ä»£ç åˆ†æ">ä»£ç åˆ†æ</h3><p>åœ¨util.pyè„šæœ¬ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„è·¯å¾„ä»¥åŠæ¨¡å‹å‚æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># æ•°æ®ç›¸å…³çš„é…ç½®</span><br>event_type = <span class="hljs-string">&quot;example&quot;</span><br><br>train_file_path = <span class="hljs-string">&quot;./data/%s.train&quot;</span> % event_type<br>test_file_path = <span class="hljs-string">&quot;./data/%s.test&quot;</span> % event_type<br><br><span class="hljs-comment"># æ¨¡å‹ç›¸å…³çš„é…ç½®</span><br>MAX_SEQ_LEN = <span class="hljs-number">128</span>   <span class="hljs-comment"># è¾“å…¥çš„æ–‡æœ¬æœ€å¤§é•¿åº¦</span><br>BATCH_SIZE = <span class="hljs-number">32</span>     <span class="hljs-comment"># æ¨¡å‹è®­ç»ƒçš„BATCH SIZE</span><br>EPOCH = <span class="hljs-number">10</span>          <span class="hljs-comment"># æ¨¡å‹è®­ç»ƒçš„è½®æ¬¡</span><br></code></pre></td></tr></table></figure><p>æ•°æ®é›†çš„æ ¼å¼ä¸ºBIOæ ‡æ³¨åºåˆ—ï¼Œæ¯ä¸ªæ ·æœ¬ç”¨ç©ºè¡Œéš”å¼€ï¼Œæ¯è¡Œä¸ºä¸€ä¸ªå­—ç¬¦åŠ æ ‡ç­¾ï¼Œexampleæ•°æ®é›†ï¼ˆ<code>äººæ°‘æ—¥æŠ¥å®ä½“è¯†åˆ«æ•°æ®é›†</code>ï¼‰æ ¼å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">æµ· O<br>é’“ O<br>æ¯” O<br>èµ› O<br>åœ° O<br>ç‚¹ O<br>åœ¨ O<br>å¦ B-LOC<br>é—¨ I-LOC<br>ä¸ O<br>é‡‘ B-LOC<br>é—¨ I-LOC<br>ä¹‹ O<br>é—´ O<br>çš„ O<br>æµ· O<br>åŸŸ O<br>ã€‚ O<br></code></pre></td></tr></table></figure><p>load_data.pyä¸ºæ•°æ®è¯»å–è„šæœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> train_file_path, event_type<br><br><br><span class="hljs-comment"># è¯»å–æ•°æ®é›†</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_data</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-comment"># è¯»å–æ•°æ®é›†</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br>    <span class="hljs-comment"># è¯»å–ç©ºè¡Œæ‰€åœ¨çš„è¡Œå·</span><br>    index = [-<span class="hljs-number">1</span>]<br>    index.extend([i <span class="hljs-keyword">for</span> i, _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(content) <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> _])<br>    index.append(<span class="hljs-built_in">len</span>(content))<br><br>    <span class="hljs-comment"># æŒ‰ç©ºè¡Œåˆ†å‰²ï¼Œè¯»å–åŸæ–‡å¥å­åŠæ ‡æ³¨åºåˆ—</span><br>    sentences, tags = [], []<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(index)-<span class="hljs-number">1</span>):<br>        sent, tag = [], []<br>        segment = content[index[j]+<span class="hljs-number">1</span>: index[j+<span class="hljs-number">1</span>]]<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> segment:<br>            sent.append(line.split()[<span class="hljs-number">0</span>])<br>            tag.append(line.split()[-<span class="hljs-number">1</span>])<br><br>        sentences.append(<span class="hljs-string">&#x27;&#x27;</span>.join(sent))<br>        tags.append(tag)<br><br>    <span class="hljs-comment"># å»é™¤ç©ºçš„å¥å­åŠæ ‡æ³¨åºåˆ—ï¼Œä¸€èˆ¬æ”¾åœ¨æœ«å°¾</span><br>    sentences = [_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> sentences <span class="hljs-keyword">if</span> _]<br>    tags = [_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tags <span class="hljs-keyword">if</span> _]<br><br>    <span class="hljs-keyword">return</span> sentences, tags<br><br><br><span class="hljs-comment"># è¯»å–è®­ç»ƒé›†æ•°æ®</span><br><span class="hljs-comment"># å°†æ ‡ç­¾è½¬æ¢æˆid</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">label2id</span>():<br><br>    _, train_tags = read_data(train_file_path)<br><br>    <span class="hljs-comment"># æ ‡ç­¾è½¬æ¢æˆidï¼Œå¹¶ä¿å­˜æˆæ–‡ä»¶</span><br>    unique_tags = []<br>    <span class="hljs-keyword">for</span> seq <span class="hljs-keyword">in</span> train_tags:<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> seq:<br>            <span class="hljs-keyword">if</span> _ <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> unique_tags <span class="hljs-keyword">and</span> _ != <span class="hljs-string">&quot;O&quot;</span>:<br>                unique_tags.append(_)<br><br>    label_id_dict = &#123;<span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-number">0</span>&#125;<br>    label_id_dict.update(<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(unique_tags, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(unique_tags)+<span class="hljs-number">1</span>))))<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s_label2id.json&quot;</span> % event_type, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> g:<br>        g.write(json.dumps(label_id_dict, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    label2id()<br><br></code></pre></td></tr></table></figure><p>ä»¥example.trainä¸ºä¾‹ï¼Œè¿è¡Œä¸Šè¿°è„šæœ¬ï¼Œä¼šç”Ÿæˆæ ‡ç­¾æ–‡ä»¶example_label2id.jsonï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;O&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;B-LOC&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;I-LOC&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;B-PER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;I-PER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;B-ORG&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;I-ORG&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>model.pyä¸ºæ¨¡å‹ç»“æ„è„šæœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras.optimizers <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> load_trained_model_from_checkpoint<br><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><span class="hljs-keyword">from</span> keras_contrib.losses <span class="hljs-keyword">import</span> crf_loss<br><span class="hljs-keyword">from</span> keras_contrib.metrics <span class="hljs-keyword">import</span> crf_accuracy<br><br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> event_type<br><br><br><span class="hljs-comment"># åˆ›å»ºBERT-BiLSTM-CRFæ¨¡å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BertBilstmCRF</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_seq_length, lstm_dim</span>):<br>        self.max_seq_length = max_seq_length<br>        self.lstmDim = lstm_dim<br>        self.label = self.load_label()<br><br>    <span class="hljs-comment"># æŠ½å–çš„æ ‡ç­¾</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_label</span>(<span class="hljs-params">self</span>):<br>        label_path = <span class="hljs-string">&quot;./&#123;&#125;_label2id.json&quot;</span>.<span class="hljs-built_in">format</span>(event_type)<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(label_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f_label:<br>            label = json.loads(f_label.read())<br><br>        <span class="hljs-keyword">return</span> label<br><br>    <span class="hljs-comment"># æ¨¡å‹</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_model</span>(<span class="hljs-params">self</span>):<br>        model_path = <span class="hljs-string">&quot;./chinese_L-12_H-768_A-12/&quot;</span><br>        bert = load_trained_model_from_checkpoint(<br>            model_path + <span class="hljs-string">&quot;bert_config.json&quot;</span>,<br>            model_path + <span class="hljs-string">&quot;bert_model.ckpt&quot;</span>,<br>            seq_len=self.max_seq_length<br>        )<br>        <span class="hljs-comment"># make bert layer trainable</span><br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> bert.layers:<br>            layer.trainable = <span class="hljs-literal">True</span><br>        x1 = Input(shape=(<span class="hljs-literal">None</span>,))<br>        x2 = Input(shape=(<span class="hljs-literal">None</span>,))<br>        bert_out = bert([x1, x2])<br>        lstm_out = Bidirectional(LSTM(self.lstmDim,<br>                                      return_sequences=<span class="hljs-literal">True</span>,<br>                                      dropout=<span class="hljs-number">0.2</span>,<br>                                      recurrent_dropout=<span class="hljs-number">0.2</span>))(bert_out)<br>        crf_out = CRF(<span class="hljs-built_in">len</span>(self.label), sparse_target=<span class="hljs-literal">True</span>)(lstm_out)<br>        model = Model([x1, x2], crf_out)<br>        model.summary()<br>        model.<span class="hljs-built_in">compile</span>(<br>            optimizer=Adam(<span class="hljs-number">1e-4</span>),<br>            loss=crf_loss,<br>            metrics=[crf_accuracy]<br>        )<br>        <span class="hljs-keyword">return</span> model<br></code></pre></td></tr></table></figure><p>æ¨¡å‹ä¸º<code>BERT+BiLSTM+CRF</code>ï¼Œå…¶ä¸­å¯¹BERTè¿›è¡Œ<code>å¾®è°ƒ</code>ï¼Œæ¨¡å‹ç»“æ„ï¼ˆä»¥exampleæ•°æ®é›†ä¸ºä¾‹ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__<br><span class="hljs-section">Layer (type)                    Output Shape         Param #     Connected to                     </span><br><span class="hljs-section">==================================================================================================</span><br>input<span class="hljs-emphasis">_3 (InputLayer)            (None, None)         0                                            </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span>_<br>input<span class="hljs-emphasis">_4 (InputLayer)            (None, None)         0                                            </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span>_<br>model<span class="hljs-emphasis">_5 (Model)                 multiple             101382144   input_</span>3[<span class="hljs-string">0</span>][<span class="hljs-symbol">0</span>]                    <br><span class="hljs-code">                                                                 input_4[0][0]                    </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">bidirectional_2 (Bidirectional) (None, None, 200)    695200      model_5[1][0]                    </span><br><span class="hljs-code">__________________________________________________________________________________________________</span><br><span class="hljs-code">crf_2 (CRF)                     (None, None, 7)      1470        bidirectional_2[0][0]            </span><br><span class="hljs-code">==================================================================================================</span><br><span class="hljs-code">Total params: 102,078,814</span><br><span class="hljs-code">Trainable params: 102,078,814</span><br><span class="hljs-code">Non-trainable params: 0</span><br></code></pre></td></tr></table></figure><h3 id="æ•°æ®é›†ä»‹ç»">æ•°æ®é›†ä»‹ç»</h3><p>æœ¬æ–‡å°†ä¼šå¯¹ä¸‰ä¸ªå®ä½“è¯†åˆ«çš„æ•°æ®é›†è¿›è¡Œæµ‹è¯•ï¼Œä»¥ä¸‹æ˜¯ä¸‰ä¸ªæ•°æ®é›†çš„ç®€å•ä»‹ç»ã€‚</p><ol type="1"><li>äººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†ï¼ˆexample.train 28046æ¡æ•°æ®å’Œexample.test4636æ¡æ•°æ®ï¼‰ï¼Œå…±3ç§æ ‡ç­¾ï¼šåœ°ç‚¹ï¼ˆLOCï¼‰, äººåï¼ˆPERï¼‰, ç»„ç»‡æœºæ„ï¼ˆORGï¼‰</li><li>æ—¶é—´è¯†åˆ«æ•°æ®é›†ï¼ˆtime.train 1700æ¡æ•°æ®å’Œtime.test300æ¡æ•°æ®ï¼‰ï¼Œå…±1ç§æ ‡ç­¾ï¼šTIME</li><li>CLUENERç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†ï¼ˆcluener.train 10748æ¡æ•°æ®å’Œcluener.test1343æ¡æ•°æ®ï¼‰ï¼Œå…±10ç§æ ‡ç­¾ï¼šåœ°å€ï¼ˆaddressï¼‰ï¼Œä¹¦åï¼ˆbookï¼‰ï¼Œå…¬å¸ï¼ˆcompanyï¼‰ï¼Œæ¸¸æˆï¼ˆgameï¼‰ï¼Œæ”¿åºœï¼ˆgovermentï¼‰ï¼Œç”µå½±ï¼ˆmovieï¼‰ï¼Œå§“åï¼ˆnameï¼‰ï¼Œç»„ç»‡æœºæ„ï¼ˆorganizationï¼‰ï¼ŒèŒä½ï¼ˆpositionï¼‰ï¼Œæ™¯ç‚¹ï¼ˆsceneï¼‰</li></ol><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æ¨¡å‹è®­ç»ƒçš„è„šæœ¬model_train.pyçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> keras.preprocessing.sequence <span class="hljs-keyword">import</span> pad_sequences<br><span class="hljs-keyword">from</span> keras.callbacks <span class="hljs-keyword">import</span> EarlyStopping<br><span class="hljs-keyword">from</span> keras.callbacks <span class="hljs-keyword">import</span> ReduceLROnPlateau<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> Tokenizer<br><br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> event_type<br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> MAX_SEQ_LEN, BATCH_SIZE, EPOCH, train_file_path, test_file_path<br><span class="hljs-keyword">from</span> load_data <span class="hljs-keyword">import</span> read_data<br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> BertBilstmCRF<br><br><br><span class="hljs-comment"># è¯»å–label2idå­—å…¸</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;&#123;&#125;_label2id.json&quot;</span>.<span class="hljs-built_in">format</span>(event_type), <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> h:<br>    label_id_dict = json.loads(h.read())<br><br>id_label_dict = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> label_id_dict.items()&#125;<br><br><br><span class="hljs-comment"># è½½å…¥æ•°æ®</span><br>config_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/bert_config.json&#x27;</span><br>checkpoint_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/bert_model.ckpt&#x27;</span><br>dict_path = <span class="hljs-string">&#x27;./chinese_L-12_H-768_A-12/vocab.txt&#x27;</span><br><br><br>token_dict = &#123;&#125;<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(dict_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> reader:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> reader:<br>        token = line.strip()<br>        token_dict[token] = <span class="hljs-built_in">len</span>(token_dict)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OurTokenizer</span>(<span class="hljs-title class_ inherited__">Tokenizer</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_tokenize</span>(<span class="hljs-params">self, text</span>):<br>        R = []<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text:<br>            <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> self._token_dict:<br>                R.append(c)<br>            <span class="hljs-keyword">else</span>:<br>                R.append(<span class="hljs-string">&#x27;[UNK]&#x27;</span>)   <span class="hljs-comment"># å‰©ä½™çš„å­—ç¬¦æ˜¯[UNK]</span><br>        <span class="hljs-keyword">return</span> R<br><br><br>tokenizer = OurTokenizer(token_dict)<br><br><br><span class="hljs-comment"># é¢„å¤„ç†è¾“å…¥æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">PreProcessInputData</span>(<span class="hljs-params">text</span>):<br>    word_labels = []<br>    seq_types = []<br>    <span class="hljs-keyword">for</span> sequence <span class="hljs-keyword">in</span> text:<br>        code = tokenizer.encode(first=sequence, max_len=MAX_SEQ_LEN)<br>        word_labels.append(code[<span class="hljs-number">0</span>])<br>        seq_types.append(code[<span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">return</span> word_labels, seq_types<br><br><br><span class="hljs-comment"># é¢„å¤„ç†ç»“æœæ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">PreProcessOutputData</span>(<span class="hljs-params">text</span>):<br>    tags = []<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> text:<br>        tag = [<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> line:<br>            tag.append(<span class="hljs-built_in">int</span>(label_id_dict[item.strip()]))<br>        tag.append(<span class="hljs-number">0</span>)<br>        tags.append(tag)<br><br>    pad_tags = pad_sequences(tags, maxlen=MAX_SEQ_LEN, padding=<span class="hljs-string">&quot;post&quot;</span>, truncating=<span class="hljs-string">&quot;post&quot;</span>)<br>    result_tags = np.expand_dims(pad_tags, <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> result_tags<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># è¯»å–è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ•°æ®</span><br>    input_train, result_train = read_data(train_file_path)<br>    input_test, result_test = read_data(test_file_path)<br>    <span class="hljs-keyword">for</span> sent, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(input_train[:<span class="hljs-number">10</span>], result_train[:<span class="hljs-number">10</span>]):<br>        <span class="hljs-built_in">print</span>(sent, tag)<br>    <span class="hljs-keyword">for</span> sent, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(input_test[:<span class="hljs-number">10</span>], result_test[:<span class="hljs-number">10</span>]):<br>        <span class="hljs-built_in">print</span>(sent, tag)<br><br>    <span class="hljs-comment"># è®­ç»ƒé›†</span><br>    input_train_labels, input_train_types = PreProcessInputData(input_train)<br>    result_train = PreProcessOutputData(result_train)<br>    <span class="hljs-comment"># æµ‹è¯•é›†</span><br>    input_test_labels, input_test_types = PreProcessInputData(input_test)<br>    result_test = PreProcessOutputData(result_test)<br>    early_stopping = EarlyStopping(monitor=<span class="hljs-string">&#x27;val_loss&#x27;</span>, min_delta=<span class="hljs-number">0.0001</span>, patience=<span class="hljs-number">3</span>, verbose=<span class="hljs-number">1</span>, mode=<span class="hljs-string">&#x27;auto&#x27;</span>)<br>    reduce_lr = ReduceLROnPlateau(monitor=<span class="hljs-string">&#x27;val_loss&#x27;</span>, min_delta=<span class="hljs-number">0.0004</span>, patience=<span class="hljs-number">2</span>, factor=<span class="hljs-number">0.1</span>, min_lr=<span class="hljs-number">1e-6</span>,<br>                                  mode=<span class="hljs-string">&#x27;auto&#x27;</span>,<br>                                  verbose=<span class="hljs-number">1</span>)<br>    model = BertBilstmCRF(max_seq_length=MAX_SEQ_LEN, lstm_dim=<span class="hljs-number">64</span>).create_model()<br>    history = model.fit(x=[input_train_labels, input_train_types],<br>                        y=result_train,<br>                        batch_size=BATCH_SIZE,<br>                        epochs=EPOCH,<br>                        validation_data=[[input_test_labels, input_test_types], result_test],<br>                        verbose=<span class="hljs-number">1</span>,<br>                        callbacks=[early_stopping, reduce_lr],<br>                        shuffle=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-comment"># ä¿å­˜æ¨¡å‹</span><br>    model.save(<span class="hljs-string">&quot;&#123;&#125;_ner.h5&quot;</span>.<span class="hljs-built_in">format</span>(event_type))<br><br>    <span class="hljs-comment"># ç»˜åˆ¶losså’Œaccå›¾åƒ</span><br>    plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>    epochs = <span class="hljs-built_in">len</span>(history.history[<span class="hljs-string">&#x27;loss&#x27;</span>])<br>    plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;loss&#x27;</span>], label=<span class="hljs-string">&#x27;loss&#x27;</span>)<br>    plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;val_loss&#x27;</span>], label=<span class="hljs-string">&#x27;val_loss&#x27;</span>)<br>    plt.legend()<br><br>    plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>    epochs = <span class="hljs-built_in">len</span>(history.history[<span class="hljs-string">&#x27;crf_accuracy&#x27;</span>])<br>    plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;crf_accuracy&#x27;</span>], label=<span class="hljs-string">&#x27;crf_accuracy&#x27;</span>)<br>    plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;val_crf_accuracy&#x27;</span>], label=<span class="hljs-string">&#x27;val_crf_accuracy&#x27;</span>)<br>    plt.legend()<br>    plt.savefig(<span class="hljs-string">&quot;%s_loss_acc.png&quot;</span> % event_type)<br></code></pre></td></tr></table></figure><p>æ¨¡å‹ä½¿ç”¨çš„é¢„è®­ç»ƒæ¨¡å‹ä¸ºBERTä¸­æ–‡é¢„è®­ç»ƒæ–‡ä»¶ï¼šchinese_L-12_H-768_A-12ã€‚</p><p>åˆ†åˆ«å¯¹ä¸Šè¿°ä¸‰ä¸ªæ•°æ®é›†è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œç»“æœæ±‡æ€»å¦‚ä¸‹ï¼š</p><h4 id="äººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†">äººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†</h4><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=128, BATCH_SIZE=32, EPOCH=10</p><figure><img src="/img/nlp34_2.png" alt="losså’Œaccå›¾" /><figcaption aria-hidden="true">losså’Œaccå›¾</figcaption></figure><h4 id="æ—¶é—´è¯†åˆ«æ•°æ®é›†">æ—¶é—´è¯†åˆ«æ•°æ®é›†</h4><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=256, BATCH_SIZE=8, EPOCH=10</p><figure><img src="/img/nlp34_3.png" alt="losså’Œaccå›¾" /><figcaption aria-hidden="true">losså’Œaccå›¾</figcaption></figure><h4 id="cluenerç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†">CLUENERç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†</h4><p>æ¨¡å‹å‚æ•°ï¼šMAX_SEQ_LEN=128, BATCH_SIZE=32, EPOCH=10</p><figure><img src="/img/nlp34_4.png" alt="losså’Œaccå›¾" /><figcaption aria-hidden="true">losså’Œaccå›¾</figcaption></figure><h3 id="æ¨¡å‹è¯„ä¼°">æ¨¡å‹è¯„ä¼°</h3><p>æ¨¡å‹è¯„ä¼°è„šæœ¬model_evaluate.pyè„šæœ¬çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># åˆ©ç”¨seqevalæ¨¡å—å¯¹åºåˆ—æ ‡æ³¨çš„ç»“æœè¿›è¡Œè¯„ä¼°</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> get_custom_objects<br><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><span class="hljs-keyword">from</span> keras_contrib.losses <span class="hljs-keyword">import</span> crf_loss<br><span class="hljs-keyword">from</span> keras_contrib.metrics <span class="hljs-keyword">import</span> crf_accuracy<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> classification_report<br><br><span class="hljs-keyword">from</span> load_data <span class="hljs-keyword">import</span> read_data<br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> event_type, test_file_path<br><span class="hljs-keyword">from</span> model_train <span class="hljs-keyword">import</span> PreProcessInputData, id_label_dict<br><br>custom_objects = get_custom_objects()<br><span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> &#123;<span class="hljs-string">&#x27;CRF&#x27;</span>: CRF, <span class="hljs-string">&#x27;crf_loss&#x27;</span>: crf_loss, <span class="hljs-string">&#x27;crf_accuracy&#x27;</span>: crf_accuracy&#125;.items():<br>    custom_objects[key] = value<br>model = load_model(<span class="hljs-string">&quot;%s_ner.h5&quot;</span> % event_type, custom_objects=custom_objects)<br><br><br><span class="hljs-comment"># å¯¹å•å¥è¯è¿›è¡Œé¢„æµ‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">predict_single_sentence</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-comment"># æµ‹è¯•å¥å­</span><br>    word_labels, seq_types = PreProcessInputData([text])<br>    <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>    predicted = model.predict([word_labels, seq_types])<br>    y = np.argmax(predicted[<span class="hljs-number">0</span>], axis=<span class="hljs-number">1</span>)<br>    predict_tag = [id_label_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> y]<br>    <span class="hljs-keyword">return</span> predict_tag[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>]<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># è¯»å–æµ‹è¯•é›†æ•°æ®</span><br>    input_test, result_test = read_data(test_file_path)<br>    <span class="hljs-keyword">for</span> sent, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(input_test[:<span class="hljs-number">10</span>], result_test[:<span class="hljs-number">10</span>]):<br>        <span class="hljs-built_in">print</span>(sent, tag)<br><br>    <span class="hljs-comment"># æµ‹è¯•é›†</span><br>    i = <span class="hljs-number">1</span><br>    true_tag_list = []<br>    pred_tag_list = []<br>    <span class="hljs-keyword">for</span> test_text, true_tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(input_test, result_test):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Predict %d samples&quot;</span> % i)<br>        pred_tag = predict_single_sentence(text=test_text)<br>        true_tag_list.append(true_tag)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(true_tag) &lt;= <span class="hljs-built_in">len</span>(pred_tag):<br>            pred_tag_list.append(pred_tag[:<span class="hljs-built_in">len</span>(true_tag)])<br>        <span class="hljs-keyword">else</span>:<br>            pred_tag_list.append(pred_tag+[<span class="hljs-string">&quot;O&quot;</span>]*(<span class="hljs-built_in">len</span>(true_tag)-<span class="hljs-built_in">len</span>(pred_tag)))<br>        i += <span class="hljs-number">1</span><br><br>    <span class="hljs-built_in">print</span>(classification_report(true_tag_list, pred_tag_list, digits=<span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure><p>åˆ†åˆ«å¯¹ä¸Šè¿°ä¸‰ä¸ªæ•°æ®é›†è¿›è¡Œæ¨¡å‹è¯„ä¼°ï¼ˆæ¨¡å‹å‚æ•°åŒä¸Šï¼‰ï¼Œç»“æœæ±‡æ€»å¦‚ä¸‹ï¼š</p><ul><li>äººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache">             <span class="hljs-attribute">precision</span>  recall    f1-score   support<br>      <span class="hljs-attribute">LOC</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9330</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8986</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9155</span>      <span class="hljs-number">3658</span><br>      <span class="hljs-attribute">ORG</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8881</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8902</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8891</span>      <span class="hljs-number">2185</span><br>      <span class="hljs-attribute">PER</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9692</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9469</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9579</span>      <span class="hljs-number">1864</span><br><br><span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9287</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9079</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9182</span>      <span class="hljs-number">7707</span><br><span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9291</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9079</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9183</span>      <span class="hljs-number">7707</span><br></code></pre></td></tr></table></figure><ul><li>æ—¶é—´è¯†åˆ«æ•°æ®é›†</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache">            <span class="hljs-attribute">precision</span>   recall  f1-score   support<br>     <span class="hljs-attribute">TIME</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8428</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8753</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8587</span>       <span class="hljs-number">441</span><br><br><span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8428</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8753</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8587</span>       <span class="hljs-number">441</span><br><span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">8428</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8753</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8587</span>       <span class="hljs-number">441</span><br></code></pre></td></tr></table></figure><ul><li>CLUENERç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs apache">                <span class="hljs-attribute">precision</span>  recall    f1-score   support<br>        <span class="hljs-attribute">name</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8476</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8758</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8615</span>       <span class="hljs-number">451</span><br>       <span class="hljs-attribute">scene</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6569</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6734</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6650</span>       <span class="hljs-number">199</span><br>    <span class="hljs-attribute">position</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7455</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7788</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7618</span>       <span class="hljs-number">425</span><br><span class="hljs-attribute">organization</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7377</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7849</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7606</span>       <span class="hljs-number">344</span><br>        <span class="hljs-attribute">game</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7423</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8432</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7896</span>       <span class="hljs-number">287</span><br>     <span class="hljs-attribute">address</span>     <span class="hljs-number">0</span>.<span class="hljs-number">6070</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6236</span>    <span class="hljs-number">0</span>.<span class="hljs-number">6152</span>       <span class="hljs-number">364</span><br>     <span class="hljs-attribute">company</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7264</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7978</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7604</span>       <span class="hljs-number">366</span><br>       <span class="hljs-attribute">movie</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7687</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7533</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7609</span>       <span class="hljs-number">150</span><br>  <span class="hljs-attribute">government</span>     <span class="hljs-number">0</span>.<span class="hljs-number">7860</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8279</span>    <span class="hljs-number">0</span>.<span class="hljs-number">8064</span>       <span class="hljs-number">244</span><br>        <span class="hljs-attribute">book</span>     <span class="hljs-number">0</span>.<span class="hljs-number">8041</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7829</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7933</span>       <span class="hljs-number">152</span><br><br>   <span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">7419</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7797</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7603</span>      <span class="hljs-number">2982</span><br>   <span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">7420</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7797</span>    <span class="hljs-number">0</span>.<span class="hljs-number">7601</span>      <span class="hljs-number">2982</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>BERT+BiLSTM+CRFï¼ˆå¯¹BERTè¿›è¡Œå¾®è°ƒï¼‰</code>çš„æ¨¡å‹æ•ˆæœæ˜¯ç›¸å½“ä¸é”™çš„ï¼Œåœ¨æŸç§ç¨‹åºä¸Šæ˜¯å¯ä»¥ä½œä¸ºbaselineçš„ã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æ¨¡å‹é¢„æµ‹è„šæœ¬model_predict.pyçš„è„šæœ¬ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> keras_bert <span class="hljs-keyword">import</span> get_custom_objects<br><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><span class="hljs-keyword">from</span> keras_contrib.losses <span class="hljs-keyword">import</span> crf_loss<br><span class="hljs-keyword">from</span> keras_contrib.metrics <span class="hljs-keyword">import</span> crf_accuracy<br><br><span class="hljs-keyword">from</span> util <span class="hljs-keyword">import</span> event_type<br><span class="hljs-keyword">from</span> model_train <span class="hljs-keyword">import</span> PreProcessInputData, id_label_dict<br><br><br><span class="hljs-comment"># å°†BIOæ ‡ç­¾è½¬åŒ–ä¸ºæ–¹ä¾¿é˜…è¯»çš„jsonæ ¼å¼</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bio_to_json</span>(<span class="hljs-params">string, tags</span>):<br>    item = &#123;<span class="hljs-string">&quot;string&quot;</span>: string, <span class="hljs-string">&quot;entities&quot;</span>: []&#125;<br>    entity_name = <span class="hljs-string">&quot;&quot;</span><br>    entity_start = <span class="hljs-number">0</span><br>    iCount = <span class="hljs-number">0</span><br>    entity_tag = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">for</span> c_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(string), <span class="hljs-built_in">len</span>(tags))):<br>        c, tag = string[c_idx], tags[c_idx]<br>        <span class="hljs-keyword">if</span> c_idx &lt; <span class="hljs-built_in">len</span>(tags)-<span class="hljs-number">1</span>:<br>            tag_next = tags[c_idx+<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">else</span>:<br>            tag_next = <span class="hljs-string">&#x27;&#x27;</span><br><br>        <span class="hljs-keyword">if</span> tag[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;B&#x27;</span>:<br>            entity_tag = tag[<span class="hljs-number">2</span>:]<br>            entity_name = c<br>            entity_start = iCount<br>            <span class="hljs-keyword">if</span> tag_next[<span class="hljs-number">2</span>:] != entity_tag:<br>                item[<span class="hljs-string">&quot;entities&quot;</span>].append(&#123;<span class="hljs-string">&quot;word&quot;</span>: c, <span class="hljs-string">&quot;start&quot;</span>: iCount, <span class="hljs-string">&quot;end&quot;</span>: iCount + <span class="hljs-number">1</span>, <span class="hljs-string">&quot;type&quot;</span>: tag[<span class="hljs-number">2</span>:]&#125;)<br>        <span class="hljs-keyword">elif</span> tag[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;I&quot;</span>:<br>            <span class="hljs-keyword">if</span> tag[<span class="hljs-number">2</span>:] != tags[c_idx-<span class="hljs-number">1</span>][<span class="hljs-number">2</span>:] <span class="hljs-keyword">or</span> tags[c_idx-<span class="hljs-number">1</span>][<span class="hljs-number">2</span>:] == <span class="hljs-string">&#x27;O&#x27;</span>:<br>                tags[c_idx] = <span class="hljs-string">&#x27;O&#x27;</span><br>                <span class="hljs-keyword">pass</span><br>            <span class="hljs-keyword">else</span>:<br>                entity_name = entity_name + c<br>                <span class="hljs-keyword">if</span> tag_next[<span class="hljs-number">2</span>:] != entity_tag:<br>                    item[<span class="hljs-string">&quot;entities&quot;</span>].append(&#123;<span class="hljs-string">&quot;word&quot;</span>: entity_name, <span class="hljs-string">&quot;start&quot;</span>: entity_start, <span class="hljs-string">&quot;end&quot;</span>: iCount + <span class="hljs-number">1</span>, <span class="hljs-string">&quot;type&quot;</span>: entity_tag&#125;)<br>                    entity_name = <span class="hljs-string">&#x27;&#x27;</span><br>        iCount += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> item<br><br><br><span class="hljs-comment"># åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹</span><br>custom_objects = get_custom_objects()<br><span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> &#123;<span class="hljs-string">&#x27;CRF&#x27;</span>: CRF, <span class="hljs-string">&#x27;crf_loss&#x27;</span>: crf_loss, <span class="hljs-string">&#x27;crf_accuracy&#x27;</span>: crf_accuracy&#125;.items():<br>    custom_objects[key] = value<br>model = load_model(<span class="hljs-string">&quot;%s_ner.h5&quot;</span> % event_type, custom_objects=custom_objects)<br><br><span class="hljs-comment"># æµ‹è¯•å¥å­</span><br>text = <span class="hljs-string">&quot;ç»è¿‡å·¥ä½œäººå‘˜ä¸¤å¤©çš„åå¤éªŒè¯ã€ä¸¥å¯†æµ‹ç®—ï¼Œè®°è€…æ˜¨å¤©ä»ä¸Šæµ·ä¸­å¿ƒå¤§å¦å¾—åˆ°ç¡®è®¤ï¼šè¢«èª‰ä¸ºä¸Šæµ·ä¸­å¿ƒå¤§å¦â€œå®šæ¥¼ç¥å™¨â€çš„é˜»å°¼å™¨ï¼Œåœ¨8æœˆ10æ—¥å‡ºç°è‡ª2016å¹´æ­£å¼å¯ç”¨ä»¥æ¥çš„æœ€å¤§æ‘†å¹…ã€‚&quot;</span><br>word_labels, seq_types = PreProcessInputData([text])<br><br><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>predicted = model.predict([word_labels, seq_types])<br>y = np.argmax(predicted[<span class="hljs-number">0</span>], axis=<span class="hljs-number">1</span>)<br>tag = [id_label_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> y]<br><br><span class="hljs-comment"># è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>result = bio_to_json(text, tag[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>])<br>pprint(result)<br></code></pre></td></tr></table></figure><p>åœ¨æ–°æ ·æœ¬ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œè¾“å‡ºçš„æ•ˆæœä¹Ÿå¾ˆä¸é”™ï¼Œç¤ºä¾‹é¢„æµ‹ç»“æœå¦‚ä¸‹ï¼š</p><ul><li>äººæ°‘æ—¥æŠ¥å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†</li></ul><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;&#x27;entities&#x27;: [&#123;&#x27;end&#x27;: <span class="hljs-number">17</span>, &#x27;start&#x27;: <span class="hljs-number">16</span>, &#x27;type&#x27;: &#x27;LOC&#x27;, &#x27;word&#x27;: &#x27;æ¬§&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">50</span>, &#x27;start&#x27;: <span class="hljs-number">48</span>, &#x27;type&#x27;: &#x27;LOC&#x27;, &#x27;word&#x27;: &#x27;è‹±å›½&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">63</span>, &#x27;start&#x27;: <span class="hljs-number">62</span>, &#x27;type&#x27;: &#x27;LOC&#x27;, &#x27;word&#x27;: &#x27;æ¬§&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">72</span>, &#x27;start&#x27;: <span class="hljs-number">69</span>, &#x27;type&#x27;: &#x27;PER&#x27;, &#x27;word&#x27;: &#x27;å¡æ¢…ä¼¦&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">78</span>, &#x27;start&#x27;: <span class="hljs-number">73</span>, &#x27;type&#x27;: &#x27;PER&#x27;, &#x27;word&#x27;: &#x27;ç‰¹é›·èÂ·æ¢…&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">86</span>, &#x27;start&#x27;: <span class="hljs-number">85</span>, &#x27;type&#x27;: &#x27;LOC&#x27;, &#x27;word&#x27;: &#x27;æ¬§&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">102</span>, &#x27;start&#x27;: <span class="hljs-number">95</span>, &#x27;type&#x27;: &#x27;PER&#x27;, &#x27;word&#x27;: &#x27;é²é‡Œæ–¯Â·çº¦ç¿°é€Š&#x27;&#125;],<br> &#x27;string&#x27;: &#x27;å½“<span class="hljs-number">2016</span>å¹´6æœˆ24æ—¥å‡Œæ™¨ï¼Œâ€œè„±æ¬§â€å…¬æŠ•çš„æœ€åä¸€å¼ é€‰ç¥¨è®¡ç®—å®Œæ¯•ï¼Œå æŠ•ç¥¨æ€»æ•°52%çš„æ”¯æŒé€‰ç¥¨æœ€ç»ˆè®©è‹±å›½å¼€å§‹äº†ä¸€æ®µé•¿è¾¾4å¹´çš„â€œè„±æ¬§â€è¿›ç¨‹ï¼Œå…¶é—´å¡æ¢…ä¼¦ã€ç‰¹é›·èÂ·æ¢…ç›¸ç»§ç¦»ä»»ï¼Œâ€œè„±æ¬§â€æœ€ç»ˆåœ¨ç¬¬ä¸‰ä½é¦–ç›¸é²é‡Œæ–¯Â·çº¦ç¿°é€Šä»»å†…å®Œæˆã€‚&#x27;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<span class="hljs-string">&#x27;entities&#x27;</span>: [&#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">6</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;ORG&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å°æ¹¾â€œç«‹æ³•é™¢&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">29</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å°&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">35</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;PER&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;è”¡è‹±æ–‡&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">66</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">64</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å°æ¹¾&#x27;</span>&#125;],<br> <span class="hljs-string">&#x27;string&#x27;</span>: <span class="hljs-string">&#x27;å°æ¹¾â€œç«‹æ³•é™¢â€â€œè±çŒªï¼ˆå«è±å…‹å¤šå·´èƒºçš„çŒªè‚‰ï¼‰â€è¡¨å†³å¤§æˆ˜è½å¹•ï¼Œå°å½“å±€é¢†å¯¼äººè”¡è‹±æ–‡24æ—¥æ™šåœ¨è„¸ä¹¦å‘æ–‡å®£ç§°ï¼Œâ€œå¼€æ”¾å¸‚åœºçš„å†³å®šï¼Œå°†ä¼šæ˜¯æœªæ¥å°æ¹¾å›½é™…ç»è´¸èµ°å‘ä¸–ç•Œçš„å…³é”®å†³å®šâ€ã€‚&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<span class="hljs-string">&#x27;entities&#x27;</span>: [&#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">9</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">7</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å°åº¦&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">14</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">12</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å—æµ·&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">27</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">25</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å°åº¦&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">28</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;è¶Šå—&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">45</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">43</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å°åº¦&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">49</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">47</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;PER&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;è«è¿ª&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">53</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">51</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å—æµ·&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">90</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">88</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOC&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å—æµ·&#x27;</span>&#125;],<br> <span class="hljs-string">&#x27;string&#x27;</span>: <span class="hljs-string">&#x27;æœ€è¿‘ä¸€æ®µæ—¶é—´ï¼Œå°åº¦æ”¿åºœåœ¨å—æµ·é—®é¢˜ä¸Šæ¥è¿å‘å£°ã€‚åœ¨è¿‘æœŸå°åº¦ã€è¶Šå—ä¸¤å›½ä¸¾è¡Œçš„çº¿ä¸Šæ€»ç†å³°ä¼šä¸Šï¼Œå°åº¦æ€»ç†è«è¿ªå£°ç§°å—æµ·è¡Œä¸ºå‡†åˆ™â€œä¸åº”æŸå®³è¯¥åœ°åŒºå…¶ä»–å›½å®¶æˆ–ç¬¬ä¸‰æ–¹çš„åˆ©ç›Šâ€ï¼Œä¸¤å›½æ€»ç†è¿˜å¼ºè°ƒäº†æ‰€è°“å—æµ·â€œèˆªè¡Œè‡ªç”±â€çš„é‡è¦æ€§ã€‚&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ—¶é—´è¯†åˆ«æ•°æ®é›†</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<span class="hljs-string">&#x27;entities&#x27;</span>: [&#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">8</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;TIME&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å»å¹´11æœˆ30æ—¥&#x27;</span>&#125;],<br> <span class="hljs-string">&#x27;string&#x27;</span>: <span class="hljs-string">&#x27;å»å¹´11æœˆ30æ—¥ï¼Œæå…ˆç”Ÿæ¥åˆ°èŒ¶åº—å­ä¸œè¡—ä¸€å®¶é“¶è¡Œå–é’±ï¼Œå‡†å¤‡è´­ä¹°å®¶å…·ã€‚è¾“å…¥å¯†ç åï¼Œ&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<span class="hljs-string">&#x27;entities&#x27;</span>: [&#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">19</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;TIME&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;ä¸Šä¸–çºª80å¹´ä»£ä¹‹å‰&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">24</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">20</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;TIME&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å»å¹´9æœˆ&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">47</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">45</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;TIME&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;3å¹´&#x27;</span>&#125;],<br> <span class="hljs-string">&#x27;string&#x27;</span>: <span class="hljs-string">&#x27;è‹åŒ—å¤§é‡å†œæ‘ä½æˆ¿å»ºäºä¸Šä¸–çºª80å¹´ä»£ä¹‹å‰ã€‚å»å¹´9æœˆï¼Œæ±Ÿè‹çœå†³å®šå…¨é¢æ”¹å–„è‹åŒ—å†œæ°‘ä½æˆ¿æ¡ä»¶ï¼Œè®¡åˆ’3å¹´å†…æ”¹å–„30ä¸‡æˆ·ï¼Œä½œä¸ºå†³èƒœå…¨é¢å»ºæˆå°åº·ç¤¾ä¼šè¡¥çŸ­æ¿çš„é‡è¦ä¸¾æªã€‚&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;&#x27;entities&#x27;: [&#123;&#x27;end&#x27;: <span class="hljs-number">8</span>, &#x27;start&#x27;: <span class="hljs-number">6</span>, &#x27;type&#x27;: &#x27;TIME&#x27;, &#x27;word&#x27;: &#x27;ä¸¤å¤©&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">23</span>, &#x27;start&#x27;: <span class="hljs-number">21</span>, &#x27;type&#x27;: &#x27;TIME&#x27;, &#x27;word&#x27;: &#x27;æ˜¨å¤©&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">61</span>, &#x27;start&#x27;: <span class="hljs-number">56</span>, &#x27;type&#x27;: &#x27;TIME&#x27;, &#x27;word&#x27;: &#x27;8æœˆ10æ—¥&#x27;&#125;,<br>              &#123;&#x27;end&#x27;: <span class="hljs-number">69</span>, &#x27;start&#x27;: <span class="hljs-number">64</span>, &#x27;type&#x27;: &#x27;TIME&#x27;, &#x27;word&#x27;: &#x27;<span class="hljs-number">2016</span>å¹´&#x27;&#125;],<br> &#x27;string&#x27;: &#x27;ç»è¿‡å·¥ä½œäººå‘˜ä¸¤å¤©çš„åå¤éªŒè¯ã€ä¸¥å¯†æµ‹ç®—ï¼Œè®°è€…æ˜¨å¤©ä»ä¸Šæµ·ä¸­å¿ƒå¤§å¦å¾—åˆ°ç¡®è®¤ï¼šè¢«èª‰ä¸ºä¸Šæµ·ä¸­å¿ƒå¤§å¦â€œå®šæ¥¼ç¥å™¨â€çš„é˜»å°¼å™¨ï¼Œåœ¨8æœˆ10æ—¥å‡ºç°è‡ª<span class="hljs-number">2016</span>å¹´æ­£å¼å¯ç”¨ä»¥æ¥çš„æœ€å¤§æ‘†å¹…ã€‚&#x27;&#125;<br></code></pre></td></tr></table></figure><ul><li>CLUENERç»†ç²’åº¦å®ä½“è¯†åˆ«æ•°æ®é›†</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<span class="hljs-string">&#x27;entities&#x27;</span>: [&#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;organization&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;å››å·æ•¦ç…Œå­¦&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">13</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">11</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;scene&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;ä¸¹æ£±&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">44</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">41</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;èƒ¡æ–‡å’Œ&#x27;</span>&#125;],<br> <span class="hljs-string">&#x27;string&#x27;</span>: <span class="hljs-string">&#x27;å››å·æ•¦ç…Œå­¦â€ã€‚è¿‘å¹´æ¥ï¼Œä¸¹æ£±å¿ç­‰åœ°ä¸€äº›ä¸çŸ¥åçš„çŸ³çªŸè¿æ¥äº†æµ·å†…å¤–çš„æ¸¸å®¢ï¼Œä»–ä»¬éšèº«æºå¸¦ç€èƒ¡æ–‡å’Œçš„è‘—ä½œã€‚&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<span class="hljs-string">&#x27;entities&#x27;</span>: [&#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">19</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">14</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;address&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;èŒ¶åº—å­ä¸œè¡—&#x27;</span>&#125;],<br> <span class="hljs-string">&#x27;string&#x27;</span>: <span class="hljs-string">&#x27;å»å¹´11æœˆ30æ—¥ï¼Œæå…ˆç”Ÿæ¥åˆ°èŒ¶åº—å­ä¸œè¡—ä¸€å®¶é“¶è¡Œå–é’±ï¼Œå‡†å¤‡è´­ä¹°å®¶å…·ã€‚è¾“å…¥å¯†ç åï¼Œ&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<span class="hljs-string">&#x27;entities&#x27;</span>: [&#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;ç½—ä¼¯èŒ¨&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;movie&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;ã€Šé€ƒè·‘æ–°å¨˜ã€‹&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">23</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">16</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;movie&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;ã€Šç†å‘å¸ˆä½ç¿°ã€‹&#x27;</span>&#125;,<br>              &#123;<span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">32</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;word&#x27;</span>: <span class="hljs-string">&#x27;äºšå½“Â·æ¡‘å¾·å‹’&#x27;</span>&#125;],<br> <span class="hljs-string">&#x27;string&#x27;</span>: <span class="hljs-string">&#x27;ç½—ä¼¯èŒ¨çš„ã€Šé€ƒè·‘æ–°å¨˜ã€‹ä¸ç›¸ä¼¯ä»²ï¼›è€Œã€Šç†å‘å¸ˆä½ç¿°ã€‹è®©è¿‘å¹´æ¥é¡ºé£é¡ºæ°´çš„äºšå½“Â·æ¡‘å¾·å‹’é¦–å°å†²è¿‡1äº¿ï¼„&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/keras_bert_sequence_labeling">https://github.com/percent4/keras_bert_sequence_labeling</a>ã€‚</p><p>åç»­å°†ä¼šç»§ç»­ä»‹ç»å¦‚ä½•ä½¿ç”¨keras-bertå®ç°æ–‡æœ¬å¤šåˆ†ç±»å’Œæ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨~</p><p>æœ€åï¼Œè¿˜æƒ³æ„Ÿè°¢ä¸€ä¸‹æ‰€æœ‰è‡´åŠ›äºå¼€æºé¡¹ç›®çš„åŒä»ä»¬ï¼Œæ„Ÿè°¢ä½ ä»¬çš„åŠªåŠ›ï¼Œæ„Ÿè°¢ä½ ä»¬çš„ä»˜å‡ºï¼Œæ„Ÿè°¢ä½ ä»¬çš„é“ºè·¯ã€‚</p><p>2020å¹´12æœˆ26æ—¥äºä¸Šæµ·æµ¦ä¸œ</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>keras-bert</tag>
      
      <tag>åºåˆ—æ ‡æ³¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åä¸‰ï¼‰åˆ©ç”¨CRFå®ç°ä¸­æ–‡åˆ†è¯</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B8%89%EF%BC%89%E5%88%A9%E7%94%A8CRF%E5%AE%9E%E7%8E%B0%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B8%89%EF%BC%89%E5%88%A9%E7%94%A8CRF%E5%AE%9E%E7%8E%B0%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šè®²è¿°å¦‚ä½•åˆ©ç”¨CRFæ¨¡å‹æ¥å®ç°ä¸­æ–‡åˆ†è¯ã€‚</p><p>æ‰€è°“ä¸­æ–‡åˆ†è¯ï¼Œå°±æ˜¯å°†è¿ç»­çš„ä¸­æ–‡æ±‰å­—åºåˆ—æŒ‰ç…§ä¸€å®šçš„è§„èŒƒé‡æ–°ç»„åˆæˆè¯åºåˆ—çš„è¿‡ç¨‹ã€‚å…³äºCRFæ¨¡å‹çš„ä»‹ç»ä»¥åŠCRFå®ç°å·¥å…·CRF++çš„ä½¿ç”¨æ–¹æ³•ï¼Œè¯»è€…å¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8CRF-%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB-NER/">NLPå…¥é—¨ï¼ˆå…«ï¼‰ä½¿ç”¨CRF++å®ç°å‘½åå®ä½“è¯†åˆ«(NER)</a>ã€‚</p><p>ä»¥ä¸‹å°†è¯¦ç»†è®²è¿°å¦‚ä½•ä½¿ç”¨CRF++æ¥å®ç°ä¸­æ–‡åˆ†è¯ã€‚</p><h3 id="è¯­æ–™é€‰æ‹©">è¯­æ–™é€‰æ‹©</h3><p>ä¸­åˆ†åˆ†è¯çš„è¯­æ–™ï¼Œè¿™é‡Œé€‰æ‹©äººæ°‘æ—¥æŠ¥åˆ†è¯è¯­æ–™å’Œå¾®è½¯ä¸­æ–‡åˆ†è¯è¯­æ–™ï¼Œè¯­æ–™çš„ä¸‹è½½æ–¹å¼å¯ä»¥å‚çœ‹æ–‡ç« æœ€åç»™å‡ºçš„Githubåœ°å€ã€‚</p><p>æˆ‘ä»¬å°†è¯­æ–™åŠ å·¥æˆCRF++æ”¯æŒçš„æ ¼å¼ï¼Œä»¥å¥å­<code>è¿ˆå‘å……æ»¡å¸Œæœ›çš„æ–°ä¸–çºªâ€”â€”ä¸€ä¹ä¹å…«å¹´æ–°å¹´è®²è¯ï¼ˆé™„å›¾ç‰‡ï¼‘å¼ ï¼‰</code>ä¸ºä¾‹ï¼Œæˆ‘ä»¬åŠ å·¥åçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">è¿ˆnB-Char<br>å‘nI-Char<br>å……nB-Char<br>æ»¡nI-Char<br>å¸ŒnB-Char<br>æœ›nI-Char<br>çš„nB-Char<br>æ–°nB-Char<br>ä¸–nB-Char<br>çºªnI-Char<br>â€”nB-Char<br>â€”nI-Char<br>ä¸€nB-Char<br>ä¹nI-Char<br>ä¹nI-Char<br>å…«nI-Char<br>å¹´nI-Char<br>æ–°nB-Char<br>å¹´nI-Char<br>è®²nB-Char<br>è¯nI-Char<br>ï¼ˆnB-Char<br>é™„nB-Char<br>å›¾nB-Char<br>ç‰‡nI-Char<br>ï¼‘nB-Char<br>å¼ nB-Char<br>ï¼‰nB-Char<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦ç¨ä½œè¯´æ˜ï¼Œå³æˆ‘ä»¬çš„æ ‡ç­¾ä½“ç³»é‡‡ç”¨æœ€ç®€å•çš„<code>BI</code>ä½“ç³»ï¼Œå°†è¯è¯­çš„å¼€å¤´ç”¨<code>B-Char</code>æ ‡ç­¾è¡¨ç¤ºï¼Œè¯è¯­çš„ä¸­é—´å’Œç»“å°¾ç”¨<code>I-Char</code>è¡¨ç¤ºã€‚</p><p>è¯­æ–™æ€»å…±çº¦10wå¤šä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†ï¼ˆtrain.txtï¼‰å’Œæµ‹è¯•é›†ï¼ˆpredict.txtï¼‰ï¼Œæ¯”ä¾‹ä¸º9:1ã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æˆ‘ä»¬å¯¹è®­ç»ƒé›†è¿›è¡Œè®­ç»ƒï¼Œè®­ç»ƒçš„CRF++çš„æ¨¡æ¿ä¸æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8CRF-%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB-NER/">NLPå…¥é—¨ï¼ˆå…«ï¼‰ä½¿ç”¨CRF++å®ç°å‘½åå®ä½“è¯†åˆ«(NER)</a>ä¸­ä¸€æ ·ã€‚è®­ç»ƒçš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crf_learn  -f 3 -c 4.0 template train.data model -t<br></code></pre></td></tr></table></figure><p>è®­ç»ƒåçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š <img src="/img/nlp33_1.png"alt="CRFæ¨¡å‹è®­ç»ƒè¿‡ç¨‹" /></p><h3 id="æ¨¡å‹è¯„ä¼°">æ¨¡å‹è¯„ä¼°</h3><p>ä¸‹é¢æˆ‘ä»¬å°†å€ŸåŠ©åºåˆ—è¯„ä¼°æ¨¡å—<code>seqeval</code>å¯¹åˆ†è¯æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›è¿›è¡Œè¯„ä¼°ã€‚</p><p>æˆ‘ä»¬å…ˆç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆæ¨¡å‹é¢„æµ‹æ–‡ä»¶ï¼ˆ<code>crf_pred.txt</code>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crf_test -m model predict.txt &gt; crf_pred.txt<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹è„šæœ¬è¿›è¡Œæ¨¡å‹è¯„ä¼°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> f1_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> precision_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> accuracy_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> recall_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> classification_report<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;crf_pred.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br>y_pred = []<br>y_true = []<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> content:<br>    <span class="hljs-keyword">if</span> line:<br>        y_pred.append(line.split(<span class="hljs-string">&quot;\t&quot;</span>)[-<span class="hljs-number">1</span>])<br>        y_true.append(line.split(<span class="hljs-string">&quot;\t&quot;</span>)[-<span class="hljs-number">2</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;accuary: &quot;</span>, accuracy_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p: &quot;</span>, precision_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;r: &quot;</span>, recall_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;f1: &quot;</span>, f1_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;classification report: &quot;</span>)<br><span class="hljs-built_in">print</span>(classification_report(y_true, y_pred))<br></code></pre></td></tr></table></figure><p>æ¨¡å‹è¯„ä¼°çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">accuary:  0.96405717503858<br>p:  0.9184067155248071<br>r:  0.9206969935013926<br>f1:  0.9195504284452864<br>classification report: <br>           precision    recall  f1-score   support<br><br>     Char       0.92      0.92      0.92    350075<br><br>micro avg       0.92      0.92      0.92    350075<br>macro avg       0.92      0.92      0.92    350075<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼ŒCharå­—æ®µçš„F1å€¼92%ï¼Œç›¸å½“ä¸é”™çš„ç»“æœã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸Šé¢è®­ç»ƒå¥½çš„CRFæ¨¡å‹ï¼Œå¯¹æ–°çš„å¥å­è¿›è¡Œé¢„æµ‹ï¼Œçœ‹çœ‹å…¶åœ¨æ–°å¥å­ä¸Šçš„åˆ†è¯èƒ½åŠ›ã€‚</p><p>æˆ‘ä»¬çš„é¢„æµ‹è„šæœ¬å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> os<br>text = <span class="hljs-string">&quot;ä¸Šæµ·é‡ç”ŸåŠ¨ç‰©å›­ç¾¤ç†Šä¼¤äººäº‹ä»¶æ•‘æ´ç”»é¢æ›å…‰&quot;</span><br><br><span class="hljs-comment"># ç”Ÿæˆå¾…é¢„æµ‹çš„æ–‡æœ¬</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;predict.data&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> g:<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> text:<br>        g.write(<span class="hljs-string">&quot;%s\tn\tB-Char\n&quot;</span> % char)<br><br><span class="hljs-comment"># åˆ©ç”¨CRFæ¨¡å‹ï¼Œè°ƒç”¨å‘½ä»¤è¡Œè¿›è¡Œé¢„æµ‹</span><br>os.system(<span class="hljs-string">&quot;crf_test -m model predict.data &gt; predict_new.txt&quot;</span>)<br><br><span class="hljs-comment"># å¤„ç†é¢„æµ‹åçš„è¿›è¡Œï¼Œå¹¶å°†å…¶åŠ å·¥æˆä¸­æ–‡åˆ†è¯åçš„ç»“æœ</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;predict_new.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br>predict_tags = []<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> content:<br>    predict_tags.append(line.split(<span class="hljs-string">&quot;\t&quot;</span>)[-<span class="hljs-number">1</span>])<br><br>words = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(predict_tags)):<br>    word = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> predict_tags[i] == <span class="hljs-string">&quot;B-Char&quot;</span>:<br>        word += text[i]<br>        j = i + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> j &lt; <span class="hljs-built_in">len</span>(text) <span class="hljs-keyword">and</span> predict_tags[j] == <span class="hljs-string">&quot;I-Char&quot;</span>:<br>            word += text[j]<br>            j += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">if</span> word:<br>        words.append(word)<br><br><span class="hljs-comment"># è¾“å‡ºé¢„æµ‹ç»“æœ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŸå¥:%s&quot;</span> % text)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åˆ†è¯ç»“æœ:%s&quot;</span> % (<span class="hljs-string">&quot;/&quot;</span>.join(words)))<br></code></pre></td></tr></table></figure></p><p>æˆ‘ä»¬ä»æ–°é—»ä¸­é€‰æ‹©10ä¸ªå¥å­ï¼Œå¯¹å…¶è¿›è¡Œåˆ†è¯ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs awk">åŸå¥:ä¸Šæµ·é‡ç”ŸåŠ¨ç‰©å›­ç¾¤ç†Šä¼¤äººäº‹ä»¶æ•‘æ´ç”»é¢æ›å…‰<br>åˆ†è¯ç»“æœ:ä¸Šæµ·<span class="hljs-regexp">/é‡ç”ŸåŠ¨ç‰©å›­/</span>ç¾¤<span class="hljs-regexp">/ç†Š/</span>ä¼¤<span class="hljs-regexp">/äºº/</span>äº‹ä»¶<span class="hljs-regexp">/æ•‘æ´/</span>ç”»é¢/æ›å…‰<br><br>åŸå¥:æµ™æ±Ÿæ­£ç­¹åˆ’ç–«è‹—æ¥ç§å·¥ä½œï¼Œå½“åœ°ç›¸å…³éƒ¨é—¨ï¼šä»ä»…é™äºç´§æ€¥æ¥ç§å°éƒ¨åˆ†äººç¾¤<br>åˆ†è¯ç»“æœ:æµ™æ±Ÿ<span class="hljs-regexp">/æ­£/</span>ç­¹åˆ’<span class="hljs-regexp">/ç–«è‹—/</span>æ¥ç§<span class="hljs-regexp">/å·¥ä½œ/</span>ï¼Œ<span class="hljs-regexp">/å½“åœ°/</span>ç›¸å…³<span class="hljs-regexp">/éƒ¨é—¨/</span>ï¼š<span class="hljs-regexp">/ä»/</span>ä»…<span class="hljs-regexp">/é™äº/</span>ç´§æ€¥<span class="hljs-regexp">/æ¥ç§/</span>å°éƒ¨åˆ†/äººç¾¤<br><br>åŸå¥:äºšé˜¿åœç«<span class="hljs-number">4</span>åˆ†é’Ÿåˆå¼€ç‚®ï¼Ÿåœ¨æ³•äºšç¾å°¼äºšäººæŠ—è®® é˜¿å¡æ‹œç–†ä½¿é¦†å‰ä¸¾æ——<br>åˆ†è¯ç»“æœ:äºšé˜¿<span class="hljs-regexp">/åœç«/</span><span class="hljs-number">4</span><span class="hljs-regexp">/åˆ†é’Ÿ/</span>åˆ<span class="hljs-regexp">/å¼€ç‚®/</span>ï¼Ÿ<span class="hljs-regexp">/åœ¨/</span>æ³•<span class="hljs-regexp">/äºšç¾å°¼äºš/</span>äºº<span class="hljs-regexp">/æŠ—è®®/</span>é˜¿å¡æ‹œç–†<span class="hljs-regexp">/ä½¿é¦†/</span>å‰/ä¸¾æ——<br><br>åŸå¥:åœŸè€³å…¶è¢«æ›ç§˜å¯†è¯•å°„ä¿„åˆ¶S400é˜²ç©ºå¯¼å¼¹ ç¾æ–¹é«˜å±‚æ”¾å‡ºç‹ è¯<br>åˆ†è¯ç»“æœ:åœŸè€³å…¶<span class="hljs-regexp">/è¢«/</span>æ›<span class="hljs-regexp">/ç§˜å¯†/</span>è¯•<span class="hljs-regexp">/å°„/</span>ä¿„<span class="hljs-regexp">/åˆ¶/</span>S<span class="hljs-regexp">/4/</span><span class="hljs-number">0</span><span class="hljs-regexp">/0/</span>é˜²ç©º<span class="hljs-regexp">/å¯¼å¼¹/</span>ç¾<span class="hljs-regexp">/æ–¹/</span>é«˜å±‚<span class="hljs-regexp">/æ”¾/</span>å‡º/ç‹ è¯<br><br>åŸå¥:å›½å®¶ç¨åŠ¡æ€»å±€ç¨½æŸ¥å±€å‰¯å±€é•¿æ—æ«æ¥å—çºªå¾‹å®¡æŸ¥å’Œç›‘å¯Ÿè°ƒæŸ¥<br>åˆ†è¯ç»“æœ:å›½å®¶ç¨åŠ¡æ€»å±€<span class="hljs-regexp">/ç¨½æŸ¥å±€/</span>å‰¯<span class="hljs-regexp">/å±€é•¿/</span>æ—<span class="hljs-regexp">/æ«/</span>æ¥å—<span class="hljs-regexp">/çºªå¾‹/</span>å®¡æŸ¥<span class="hljs-regexp">/å’Œ/</span>ç›‘å¯Ÿ/è°ƒæŸ¥<br><br>åŸå¥:ç§‘æŠ€åŠ©åŠ›äº§ä¸šå…´ æ¾œæ²§æ—§è²Œæ¢æ–°é¢œ<br>åˆ†è¯ç»“æœ:ç§‘æŠ€<span class="hljs-regexp">/åŠ©åŠ›/</span>äº§ä¸š<span class="hljs-regexp">/å…´/</span>æ¾œæ²§<span class="hljs-regexp">/æ—§è²Œ/</span>æ¢/æ–°é¢œ<br><br>åŸå¥:ç¾Šæ¯›å…šä¸è¿‡æ˜¯æµé‡<br>åˆ†è¯ç»“æœ:ç¾Šæ¯›<span class="hljs-regexp">/å…š/</span>ä¸è¿‡æ˜¯/æµé‡<br><br>åŸå¥:å¹¿è¥¿é¾™èƒœé‡‘ç§‹æ¢¯ç”°ç¾å¦‚ç”»<br>åˆ†è¯ç»“æœ:å¹¿è¥¿<span class="hljs-regexp">/é¾™/</span>èƒœ<span class="hljs-regexp">/é‡‘ç§‹/</span>æ¢¯ç”°<span class="hljs-regexp">/ç¾/</span>å¦‚/ç”»<br><br>åŸå¥:æ—©åœ¨ä¸Šæ˜ ç¬¬å››å¤©ï¼Œã€Šå§œå­ç‰™ã€‹ç´¯è®¡ç¥¨æˆ¿å°±å·²ç»é«˜è¾¾<span class="hljs-number">10.36</span>äº¿ï¼Œåæ¥å•æ—¥ç¥¨æˆ¿ä¸€è·¯ä¸‹è·Œï¼Œæœ€ä½æ—¶è·Œè‡³<span class="hljs-number">500</span>ä¸‡å·¦å³ï¼Œæ˜¯åŒæ¡£æœŸå¯¹æ‰‹ã€Šæˆ‘å’Œæˆ‘çš„å®¶ä¹¡ã€‹çš„äº”åˆ†ä¹‹ä¸€ï¼Œç”šè‡³è¿˜ä¸åŠå°æˆæœ¬ç”µå½±ã€Šä¸€ç‚¹å°±åˆ°å®¶ã€‹ï¼Œä½åˆ—å›½åº†æ¡£æ–°ç‰‡å€’æ•°ç¬¬äºŒã€‚ç”¨â€œæ–­å´–å¼ä¸‹è·Œâ€æ¥å½¢å®¹è¿™éƒ¨å›½æ¼«æ–°ä½œçš„å•æ—¥ç¥¨æˆ¿èµ°å‘æ¯«ä¸ä¸ºè¿‡ã€‚<br>åˆ†è¯ç»“æœ:æ—©<span class="hljs-regexp">/åœ¨/</span>ä¸Šæ˜ <span class="hljs-regexp">/ç¬¬å››å¤©/</span>ï¼Œ<span class="hljs-regexp">/ã€Š/</span>å§œå­ç‰™<span class="hljs-regexp">/ã€‹/</span>ç´¯è®¡<span class="hljs-regexp">/ç¥¨æˆ¿/</span>å°±<span class="hljs-regexp">/å·²ç»/</span>é«˜<span class="hljs-regexp">/è¾¾/</span><span class="hljs-number">10</span><span class="hljs-regexp">/./</span><span class="hljs-number">3</span><span class="hljs-regexp">/6äº¿/</span>ï¼Œ<span class="hljs-regexp">/åæ¥/</span>å•<span class="hljs-regexp">/æ—¥/</span>ç¥¨æˆ¿<span class="hljs-regexp">/ä¸€è·¯/</span>ä¸‹è·Œ<span class="hljs-regexp">/ï¼Œ/</span>æœ€ä½<span class="hljs-regexp">/æ—¶/</span>è·Œ<span class="hljs-regexp">/è‡³/</span><span class="hljs-number">5</span><span class="hljs-regexp">/0/</span><span class="hljs-number">0</span>ä¸‡<span class="hljs-regexp">/å·¦å³/</span>ï¼Œ<span class="hljs-regexp">/æ˜¯/</span>åŒ<span class="hljs-regexp">/æ¡£æœŸ/</span>å¯¹æ‰‹<span class="hljs-regexp">/ã€Š/</span>æˆ‘<span class="hljs-regexp">/å’Œ/</span>æˆ‘<span class="hljs-regexp">/çš„/</span>å®¶ä¹¡<span class="hljs-regexp">/ã€‹/</span>çš„<span class="hljs-regexp">/äº”åˆ†ä¹‹ä¸€/</span>ï¼Œ<span class="hljs-regexp">/ç”šè‡³/</span>è¿˜<span class="hljs-regexp">/ä¸åŠ/</span>å°<span class="hljs-regexp">/æˆæœ¬/</span>ç”µå½±<span class="hljs-regexp">/ã€Š/</span>ä¸€ç‚¹<span class="hljs-regexp">/å°±/</span>åˆ°<span class="hljs-regexp">/å®¶/</span>ã€‹<span class="hljs-regexp">/ï¼Œ/</span>ä½<span class="hljs-regexp">/åˆ—å›½åº†æ¡£/</span>æ–°<span class="hljs-regexp">/ç‰‡/</span>å€’æ•°<span class="hljs-regexp">/ç¬¬äºŒ/</span>ã€‚<span class="hljs-regexp">/ç”¨/</span>â€œ<span class="hljs-regexp">/æ–­å´–å¼/</span>ä¸‹è·Œ<span class="hljs-regexp">/â€/</span>æ¥<span class="hljs-regexp">/å½¢å®¹/</span>è¿™<span class="hljs-regexp">/éƒ¨/</span>å›½<span class="hljs-regexp">/æ¼«/</span>æ–°ä½œ<span class="hljs-regexp">/çš„/</span>å•<span class="hljs-regexp">/æ—¥/</span>ç¥¨æˆ¿<span class="hljs-regexp">/èµ°å‘/</span>æ¯«ä¸<span class="hljs-regexp">/ä¸º/</span>è¿‡/ã€‚<br><br>åŸå¥:<span class="hljs-number">15</span>æ—¥ï¼Œè˜åº„å·¥ä¸šåŒºæ–°æ—¶ä»£æ–‡æ˜å®è·µçš„â€œå¤§æœ¬è¥â€â€”â€”åè½äºé¢›ç››è·¯<span class="hljs-number">745</span>å·çš„è˜åº„å·¥ä¸šåŒºæ–°æ—¶ä»£æ–‡æ˜å®è·µåˆ†ä¸­å¿ƒæ­£å¼è½æˆã€‚<br>åˆ†è¯ç»“æœ:<span class="hljs-number">1</span><span class="hljs-regexp">/5æ—¥/</span>ï¼Œè˜åº„<span class="hljs-regexp">/å·¥ä¸šåŒº/</span>æ–°æ—¶ä»£<span class="hljs-regexp">/æ–‡æ˜/</span>å®è·µ<span class="hljs-regexp">/çš„/</span>â€œ<span class="hljs-regexp">/å¤§æœ¬è¥/</span>â€<span class="hljs-regexp">/â€”â€”/</span>åè½<span class="hljs-regexp">/äº/</span>é¢›ç››<span class="hljs-regexp">/è·¯/</span><span class="hljs-number">7</span><span class="hljs-regexp">/4/</span><span class="hljs-number">5</span>å·<span class="hljs-regexp">/çš„è˜åº„/</span>å·¥ä¸šåŒº<span class="hljs-regexp">/æ–°æ—¶ä»£/</span>æ–‡æ˜<span class="hljs-regexp">/å®è·µ/</span>åˆ†<span class="hljs-regexp">/ä¸­å¿ƒ/</span>æ­£å¼<span class="hljs-regexp">/è½æˆ/</span>ã€‚<br></code></pre></td></tr></table></figure><h3 id="æ·»åŠ ç”¨æˆ·è¯å…¸">æ·»åŠ ç”¨æˆ·è¯å…¸</h3><p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒCRFæ¨¡å‹å®ç°çš„ä¸­æ–‡åˆ†è¯æ¨¡å‹æ•ˆæœç¡®å®ä¸é”™ï¼Œä½†ä¹Ÿå­˜åœ¨ç€ä¸€äº›è¯è¯­æ²¡æœ‰è¢«åˆ‡åˆ†æ­£ç¡®çš„æƒ…å†µï¼Œæ¯”å¦‚ä¼¤äººã€S400ã€æ—æ«ã€ç¾Šæ¯›å…šã€é¾™èƒœã€å›½åº†æ¡£ã€é¢›ç››è·¯ã€745å·ç­‰è¯ã€‚</p><p>ç¬”è€…å°†ä¼šæ¨¡ä»¿ç»“å·´åˆ†è¯ç­‰æ¨¡å—ï¼Œå®ç°ç”¨æˆ·è¯å…¸åŠŸèƒ½ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„ç”¨æˆ·è¯å…¸æ–‡ä»¶ä¸º<code>user_dict.txt</code>ï¼ŒåŠ ä¸Šç”¨æˆ·è¯å…¸åçš„é¢„æµ‹è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> os<br>text = <span class="hljs-string">&quot;ä¸Šæµ·é‡ç”ŸåŠ¨ç‰©å›­ç¾¤ç†Šä¼¤äººäº‹ä»¶æ•‘æ´ç”»é¢æ›å…‰&quot;</span><br><br><span class="hljs-comment"># ç”Ÿæˆå¾…é¢„æµ‹çš„æ–‡æœ¬</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;predict.data&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> g:<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> text:<br>        g.write(<span class="hljs-string">&quot;%s\tn\tB-Char\n&quot;</span> % char)<br><br><span class="hljs-comment"># åˆ©ç”¨CRFæ¨¡å‹ï¼Œè°ƒç”¨å‘½ä»¤è¡Œè¿›è¡Œé¢„æµ‹</span><br>os.system(<span class="hljs-string">&quot;crf_test -m model predict.data &gt; predict_new.txt&quot;</span>)<br><br><span class="hljs-comment"># å¤„ç†é¢„æµ‹åçš„è¿›è¡Œï¼Œå¹¶å°†å…¶åŠ å·¥æˆä¸­æ–‡åˆ†è¯åçš„ç»“æœ</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;predict_new.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br>predict_tags = []<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> content:<br>    predict_tags.append(line.split(<span class="hljs-string">&quot;\t&quot;</span>)[-<span class="hljs-number">1</span>])<br><br><span class="hljs-comment"># é€šè¿‡ä¿®æ”¹é¢„æµ‹æ ‡ç­¾å®ç°ç”¨æˆ·è¯å…¸åŠŸèƒ½</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;user_dict.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> h:<br>    user_words = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> h.readlines()]<br><br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> user_words:<br>    t = <span class="hljs-built_in">len</span>(word)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(text)-t):<br>        <span class="hljs-keyword">if</span> text[i:i+t] == word:<br>            predict_tags[i] = <span class="hljs-string">&quot;B-Char&quot;</span><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i+<span class="hljs-number">1</span>, i+t):<br>                predict_tags[j] = <span class="hljs-string">&quot;I-Char&quot;</span><br>            <span class="hljs-keyword">if</span> i+t+<span class="hljs-number">1</span> &lt; <span class="hljs-built_in">len</span>(text):<br>                predict_tags[i+t+<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;I-Char&quot;</span><br><br><span class="hljs-comment"># å¯¹é¢„æµ‹æ ‡ç­¾è¿›è¡Œåå¤„ç†ï¼Œå¾—åˆ°ä¸­æ–‡åˆ†è¯åçš„ç»“æœ</span><br>words = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(predict_tags)):<br>    word = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> predict_tags[i] == <span class="hljs-string">&quot;B-Char&quot;</span>:<br>        word += text[i]<br>        j = i + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> j &lt; <span class="hljs-built_in">len</span>(text) <span class="hljs-keyword">and</span> predict_tags[j] == <span class="hljs-string">&quot;I-Char&quot;</span>:<br>            word += text[j]<br>            j += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">if</span> word:<br>        words.append(word)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŸå¥:%s&quot;</span> % text)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åˆ†è¯ç»“æœ:%s&quot;</span> % (<span class="hljs-string">&quot;/&quot;</span>.join(words)))<br></code></pre></td></tr></table></figure><p>æ·»åŠ ç”¨æˆ·è¯å…¸åï¼Œä¸­æ–‡åˆ†è¯çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs awk">åŸå¥:ä¸Šæµ·é‡ç”ŸåŠ¨ç‰©å›­ç¾¤ç†Šä¼¤äººäº‹ä»¶æ•‘æ´ç”»é¢æ›å…‰<br>åˆ†è¯ç»“æœ:ä¸Šæµ·<span class="hljs-regexp">/é‡ç”ŸåŠ¨ç‰©å›­/</span>ç¾¤<span class="hljs-regexp">/ç†Š/</span>ä¼¤äºº<span class="hljs-regexp">/äº‹ä»¶/</span>æ•‘æ´<span class="hljs-regexp">/ç”»é¢/</span>æ›å…‰<br><br>åŸå¥:åœŸè€³å…¶è¢«æ›ç§˜å¯†è¯•å°„ä¿„åˆ¶S400é˜²ç©ºå¯¼å¼¹ ç¾æ–¹é«˜å±‚æ”¾å‡ºç‹ è¯<br>åˆ†è¯ç»“æœ:åœŸè€³å…¶<span class="hljs-regexp">/è¢«/</span>æ›<span class="hljs-regexp">/ç§˜å¯†/</span>è¯•<span class="hljs-regexp">/å°„/</span>ä¿„<span class="hljs-regexp">/åˆ¶/</span>S400<span class="hljs-regexp">/é˜²ç©º/</span>å¯¼å¼¹<span class="hljs-regexp">/ç¾/</span>æ–¹<span class="hljs-regexp">/é«˜å±‚/</span>æ”¾<span class="hljs-regexp">/å‡º/</span>ç‹ è¯<br> <br>åŸå¥:å›½å®¶ç¨åŠ¡æ€»å±€ç¨½æŸ¥å±€å‰¯å±€é•¿æ—æ«æ¥å—çºªå¾‹å®¡æŸ¥å’Œç›‘å¯Ÿè°ƒæŸ¥<br>åˆ†è¯ç»“æœ:å›½å®¶ç¨åŠ¡æ€»å±€<span class="hljs-regexp">/ç¨½æŸ¥å±€/</span>å‰¯<span class="hljs-regexp">/å±€é•¿/</span>æ—æ«<span class="hljs-regexp">/æ¥å—/</span>çºªå¾‹<span class="hljs-regexp">/å®¡æŸ¥/</span>å’Œ<span class="hljs-regexp">/ç›‘å¯Ÿ/</span>è°ƒæŸ¥<br><br>åŸå¥:ç¾Šæ¯›å…šä¸è¿‡æ˜¯æµé‡<br>åˆ†è¯ç»“æœ:ç¾Šæ¯›å…š<span class="hljs-regexp">/ä¸è¿‡æ˜¯/</span>æµé‡<br><br>åŸå¥:å¹¿è¥¿é¾™èƒœé‡‘ç§‹æ¢¯ç”°ç¾å¦‚ç”»<br>åˆ†è¯ç»“æœ:å¹¿è¥¿<span class="hljs-regexp">/é¾™èƒœ/</span>é‡‘ç§‹<span class="hljs-regexp">/æ¢¯ç”°/</span>ç¾<span class="hljs-regexp">/å¦‚/</span>ç”»<br><br>åŸå¥:æ—©åœ¨ä¸Šæ˜ ç¬¬å››å¤©ï¼Œã€Šå§œå­ç‰™ã€‹ç´¯è®¡ç¥¨æˆ¿å°±å·²ç»é«˜è¾¾<span class="hljs-number">10.36</span>äº¿ï¼Œåæ¥å•æ—¥ç¥¨æˆ¿ä¸€è·¯ä¸‹è·Œï¼Œæœ€ä½æ—¶è·Œè‡³<span class="hljs-number">500</span>ä¸‡å·¦å³ï¼Œæ˜¯åŒæ¡£æœŸå¯¹æ‰‹ã€Šæˆ‘å’Œæˆ‘çš„å®¶ä¹¡ã€‹çš„äº”åˆ†ä¹‹ä¸€ï¼Œç”šè‡³è¿˜ä¸åŠå°æˆæœ¬ç”µå½±ã€Šä¸€ç‚¹å°±åˆ°å®¶ã€‹ï¼Œä½åˆ—å›½åº†æ¡£æ–°ç‰‡å€’æ•°ç¬¬äºŒã€‚ç”¨â€œæ–­å´–å¼ä¸‹è·Œâ€æ¥å½¢å®¹è¿™éƒ¨å›½æ¼«æ–°ä½œçš„å•æ—¥ç¥¨æˆ¿èµ°å‘æ¯«ä¸ä¸ºè¿‡ã€‚<br>åˆ†è¯ç»“æœ:æ—©<span class="hljs-regexp">/åœ¨/</span>ä¸Šæ˜ <span class="hljs-regexp">/ç¬¬å››å¤©/</span>ï¼Œ<span class="hljs-regexp">/ã€Š/</span>å§œå­ç‰™<span class="hljs-regexp">/ã€‹/</span>ç´¯è®¡<span class="hljs-regexp">/ç¥¨æˆ¿/</span>å°±<span class="hljs-regexp">/å·²ç»/</span>é«˜<span class="hljs-regexp">/è¾¾/</span><span class="hljs-number">10</span><span class="hljs-regexp">/./</span><span class="hljs-number">3</span><span class="hljs-regexp">/6äº¿/</span>ï¼Œ<span class="hljs-regexp">/åæ¥/</span>å•<span class="hljs-regexp">/æ—¥/</span>ç¥¨æˆ¿<span class="hljs-regexp">/ä¸€è·¯/</span>ä¸‹è·Œ<span class="hljs-regexp">/ï¼Œ/</span>æœ€ä½<span class="hljs-regexp">/æ—¶/</span>è·Œ<span class="hljs-regexp">/è‡³/</span><span class="hljs-number">5</span><span class="hljs-regexp">/0/</span><span class="hljs-number">0</span>ä¸‡<span class="hljs-regexp">/å·¦å³/</span>ï¼Œ<span class="hljs-regexp">/æ˜¯/</span>åŒ<span class="hljs-regexp">/æ¡£æœŸ/</span>å¯¹æ‰‹<span class="hljs-regexp">/ã€Š/</span>æˆ‘<span class="hljs-regexp">/å’Œ/</span>æˆ‘<span class="hljs-regexp">/çš„/</span>å®¶ä¹¡<span class="hljs-regexp">/ã€‹/</span>çš„<span class="hljs-regexp">/äº”åˆ†ä¹‹ä¸€/</span>ï¼Œ<span class="hljs-regexp">/ç”šè‡³/</span>è¿˜<span class="hljs-regexp">/ä¸åŠ/</span>å°<span class="hljs-regexp">/æˆæœ¬/</span>ç”µå½±<span class="hljs-regexp">/ã€Š/</span>ä¸€ç‚¹<span class="hljs-regexp">/å°±/</span>åˆ°<span class="hljs-regexp">/å®¶/</span>ã€‹<span class="hljs-regexp">/ï¼Œ/</span>ä½<span class="hljs-regexp">/åˆ—/</span>å›½åº†æ¡£<span class="hljs-regexp">/æ–°ç‰‡/</span>å€’æ•°<span class="hljs-regexp">/ç¬¬äºŒ/</span>ã€‚<span class="hljs-regexp">/ç”¨/</span>â€œ<span class="hljs-regexp">/æ–­å´–å¼/</span>ä¸‹è·Œ<span class="hljs-regexp">/â€/</span>æ¥<span class="hljs-regexp">/å½¢å®¹/</span>è¿™<span class="hljs-regexp">/éƒ¨/</span>å›½<span class="hljs-regexp">/æ¼«/</span>æ–°ä½œ<span class="hljs-regexp">/çš„/</span>å•<span class="hljs-regexp">/æ—¥/</span>ç¥¨æˆ¿<span class="hljs-regexp">/èµ°å‘/</span>æ¯«ä¸<span class="hljs-regexp">/ä¸º/</span>è¿‡/ã€‚<br> <br>åŸå¥:<span class="hljs-number">15</span>æ—¥ï¼Œè˜åº„å·¥ä¸šåŒºæ–°æ—¶ä»£æ–‡æ˜å®è·µçš„â€œå¤§æœ¬è¥â€â€”â€”åè½äºé¢›ç››è·¯<span class="hljs-number">745</span>å·çš„è˜åº„å·¥ä¸šåŒºæ–°æ—¶ä»£æ–‡æ˜å®è·µåˆ†ä¸­å¿ƒæ­£å¼è½æˆã€‚<br>åˆ†è¯ç»“æœ:<span class="hljs-number">1</span><span class="hljs-regexp">/5æ—¥/</span>ï¼Œè˜åº„<span class="hljs-regexp">/å·¥ä¸šåŒº/</span>æ–°æ—¶ä»£<span class="hljs-regexp">/æ–‡æ˜/</span>å®è·µ<span class="hljs-regexp">/çš„/</span>â€œ<span class="hljs-regexp">/å¤§æœ¬è¥/</span>â€<span class="hljs-regexp">/â€”â€”/</span>åè½<span class="hljs-regexp">/äº/</span>é¢›ç››è·¯<span class="hljs-regexp">/745å·/</span>çš„è˜åº„<span class="hljs-regexp">/å·¥ä¸šåŒº/</span>æ–°æ—¶ä»£<span class="hljs-regexp">/æ–‡æ˜/</span>å®è·µ<span class="hljs-regexp">/åˆ†/</span>ä¸­å¿ƒ<span class="hljs-regexp">/æ­£å¼/</span>è½æˆ/ã€‚<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·è¯å…¸åŠŸèƒ½ä¹Ÿå·²ç»ç”Ÿæ•ˆäº†ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ¬¡åˆ†äº«åˆ©ç”¨CRFå®ç°äº†ä¸­æ–‡åˆ†è¯è¿™ä¸ªæœ€åŸºæœ¬çš„NLPä»»åŠ¡ã€‚</p><p>æœ¬æ–‡å¯¹åº”çš„Githubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/CRF-Chinese-Word-Segment">https://github.com/percent4/CRF-Chinese-Word-Segment</a>ã€‚</p><p>æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>CRF</tag>
      
      <tag>åˆ†è¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åäºŒï¼‰åˆ©ç”¨doccanoè¿›è¡Œæ–‡æ¡£æ ‡æ³¨</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%8C%EF%BC%89%E5%88%A9%E7%94%A8doccano%E8%BF%9B%E8%A1%8C%E6%96%87%E6%A1%A3%E6%A0%87%E6%B3%A8/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%BA%8C%EF%BC%89%E5%88%A9%E7%94%A8doccano%E8%BF%9B%E8%A1%8C%E6%96%87%E6%A1%A3%E6%A0%87%E6%B3%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>doccanoæ˜¯ä¸€ä¸ªå¼€æºçš„æ–‡æœ¬æ ‡æ³¨å·¥å…·ï¼Œé€‚åˆäºæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ çš„ä½¿ç”¨è€…ï¼Œæä¾›äº†æ–‡æ¡£åˆ†ç±»ã€åºåˆ—æ ‡æ³¨å’Œsequencetosequenceä»»åŠ¡çš„æ ‡æ³¨ï¼Œæ“ä½œç®€å•ï¼Œä¸Šæ‰‹ä¹Ÿå¿«ï¼Œç•Œé¢å‹å¥½ï¼Œèƒ½å¤Ÿè®©ä½ åœ¨å‡ ä¸ªå°æ—¶å†…å»ºç«‹ä¸€ä¸ªå¯å®é™…è®­ç»ƒçš„æ•°æ®é›†ã€‚</p><p>doccanoçš„Githubè®¿é—®ç½‘å€ä¸ºï¼š<ahref="https://github.com/doccano/doccano">https://github.com/doccano/doccano</a>ã€‚</p><h3 id="å®‰è£…æ–¹å¼">å®‰è£…æ–¹å¼</h3><p>doccanoçš„å®‰è£…ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Dockerå¾ˆæ–¹ä¾¿åœ°å®Œæˆå®‰è£…ã€‚</p><p>é¦–å…ˆï¼Œå…ˆä»Githubä¸Šä¸‹è½½è¯¥é¡¹ç›®ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">clone</span> https://github.com/doccano/doccano.git<br>$ <span class="hljs-built_in">cd</span> doccano<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œä½¿ç”¨docker-composeæ¥å¯åŠ¨è¯¥é¡¹ç›®ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose -f docker-compose.prod.yml up -d<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™docker-composeä¼šå…ˆæ‹‰å–é•œåƒï¼Œç„¶ååœ¨åå°å¯åŠ¨æ•´ä¸ªç¨‹åºã€‚</p><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥<code>http://localhost:3000</code>å³å¯è®¿é—®è¯¥æœåŠ¡ï¼Œé¦–æ¬¡åˆ›å»ºé¡¹ç›®éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç ï¼Œåœ¨<code>docker-compose.yml</code>æ–‡ä»¶ä¸­å·²ç»è®¾ç½®è¿‡äº†ã€‚</p><h3 id="ä½¿ç”¨ä¸¾ä¾‹">ä½¿ç”¨ä¸¾ä¾‹</h3><p>æœ¬æ–‡å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨doccanoæ¥è¿›è¡Œåºåˆ—æ ‡æ³¨æ–¹é¢çš„äººå·¥æ ‡æ³¨ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ ‡æ³¨é¡¹ç›®ï¼Œåç§°ä¸º<code>example_tagging_platform</code>ï¼Œé¡¹ç›®ç±»å‹é€‰æ‹©<code>Sequence Labeling</code>ï¼Œå¦‚ä¸‹é¡µé¢ï¼š</p><figure><img src="/img/nlp32_1.png" alt="åˆ›å»ºæ ‡æ³¨ä»»åŠ¡" /><figcaption aria-hidden="true">åˆ›å»ºæ ‡æ³¨ä»»åŠ¡</figcaption></figure><p>å‡è®¾æˆ‘ä»¬éœ€è¦æ ‡æ³¨çš„å®ä½“æ ‡ç­¾ä¸º<code>æ—¶é—´</code>ã€<code>äººç‰©</code>ã€<code>èŒä½</code>å’Œ<code>å…¬å¸</code>ã€‚æˆ‘ä»¬å¯ä»¥å…ˆåˆ›å»ºæ ‡ç­¾ï¼Œé€‰æ‹©æ ‡ç­¾é¢œè‰²ï¼Œå¦‚ä¸‹é¡µé¢ï¼š</p><figure><img src="/img/nlp32_2.png" alt="åˆ›å»ºæ ‡ç­¾" /><figcaption aria-hidden="true">åˆ›å»ºæ ‡ç­¾</figcaption></figure><p>å…¶ä¸­çš„k,c,p,tåˆ†åˆ«æ˜¯è¿™äº›æ ‡ç­¾çš„æ ‡æ³¨å¿«æ·é”®ï¼Œæˆ‘ä»¬åœ¨çœŸå®æ ‡æ³¨çš„æ—¶å€™ï¼Œé€‰æ‹©å¥½æ ‡æ³¨æ–‡å­—åå†æŒ‰è¿™äº›å¿«æ·é”®å¯ä»¥å¿«é€Ÿå®Œæˆæ ‡æ³¨ã€‚</p><p>æ¥ç€æˆ‘ä»¬ä¸Šä¼ æ ‡æ³¨æ–‡æ¡£ã€‚å‡è®¾æˆ‘ä»¬çš„æ ‡æ³¨æ–‡æ¡£æ ¼å¼ä¸ºtxtï¼Œä¸€è¡Œå°±æ˜¯ä¸€ä¸ªæ ‡æ³¨æ ·æœ¬ï¼Œé‚£ä¹ˆåœ¨Dataseté€‰æ‹©ä¸Šä¼ æ•°æ®ï¼ˆImportDataset ï¼‰çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©PlainTextã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©å…¶å®ƒæ ¼å¼çš„ä¸Šä¼ æ–‡æ¡£ï¼Œæ¯”å¦‚Jsonï¼Œä½†éœ€è¦æŒ‰ç…§æŒ‡å®šæ ¼å¼æ¥ã€‚</p><figure><img src="/img/nlp32_3.png" alt="ä¸Šä¼ æ–‡æ¡£" /><figcaption aria-hidden="true">ä¸Šä¼ æ–‡æ¡£</figcaption></figure><p>æˆ‘ä»¬ä¸Šä¼ çš„txtæ–‡æ¡£ï¼ˆa.txtï¼‰å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">â€œæˆ‘ä»¬æ¬£å–œåœ°çœ‹åˆ°ï¼Œç§‘åˆ›æ¿å’Œé¦™æ¸¯è”äº¤æ‰€æ¨å‡ºäº†ä¸€ç³»åˆ—æ”¹é©å’Œåˆ›æ–°çš„ä¸¾æªï¼Œä¸ºæ–°ç»æµå…¬å¸èƒ½æ›´å¥½åœ°è·å¾—èµ„æœ¬å¸‚åœºæ”¯æŒåŒ…æ‹¬å›½é™…èµ„æœ¬æ”¯æŒåˆ›é€ äº†è‰¯å¥½æ¡ä»¶ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´èƒ½æœ‰æœºä¼šå‚ä¸å…¶ä¸­ã€‚â€èš‚èšé›†å›¢è‘£äº‹é•¿äº•è´¤æ ‹è¯´ã€‚<br><span class="hljs-number">7</span>æœˆ<span class="hljs-number">20</span>æ—¥ï¼Œæ”¯ä»˜å®æ¯å…¬å¸èš‚èšé›†å›¢å®£å¸ƒï¼Œå¯åŠ¨åœ¨é¦™æ¸¯è”åˆäº¤æ˜“æ‰€æœ‰é™å…¬å¸ä¸»æ¿å¯»æ±‚åŒæ­¥å‘è¡Œä¸Šå¸‚çš„è®¡åˆ’ï¼Œä»¥è¿›ä¸€æ­¥æ”¯æŒæœåŠ¡ä¸šæ•°å­—åŒ–å‡çº§åšå¤§å†…éœ€ï¼ŒåŠ å¼ºå…¨çƒåˆä½œåŠ©åŠ›å…¨çƒå¯æŒç»­å‘å±•ï¼Œä»¥åŠæ”¯æŒå…¬å¸åŠ å¤§æŠ€æœ¯ç ”å‘å’Œåˆ›æ–°ã€‚<br>è®°è€…ä»å®˜æ–¹è·æ‚‰ï¼Œå°é¹æ±½è½¦äºä»Šæ—¥å®£å¸ƒå®Œæˆäº†è¿‘<span class="hljs-number">5</span>äº¿ç¾å…ƒ(çº¦<span class="hljs-number">35</span>äº¿å…ƒäººæ°‘å¸)C+è½®èèµ„ï¼ŒæŠ•èµ„æ–¹åŒ…æ‹¬Aspexã€Coatueã€é«˜ç“´èµ„æœ¬å’Œçº¢æ‰ä¸­å›½ç­‰æŠ•èµ„æœºæ„ã€‚<br>ä½œä¸ºç™¾åº¦çš„æ€»éƒ¨ï¼Œç™¾åº¦å¤§å¦äº<span class="hljs-number">2009å¹´11æœˆ17</span>æ—¥æŠ•å…¥ä½¿ç”¨ï¼Œå°±æ‰¿è½½äº†ç™¾åº¦æ‰€æœ‰çš„è¾‰ç…Œã€‚<br></code></pre></td></tr></table></figure><p>ä¸Šä¼ åçš„ç•Œé¢å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp32_4.png" alt="ä¸Šä¼ åçš„ç•Œé¢" /><figcaption aria-hidden="true">ä¸Šä¼ åçš„ç•Œé¢</figcaption></figure><p>ç‚¹å‡»å·¦ä¸Šæ–¹çš„<code>Start Annotation</code>å³å¯å¼€å§‹æ ‡æ³¨ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp32_5.png" alt="åˆ©ç”¨doccanoè¿›è¡Œæ ‡æ³¨" /><figcaption aria-hidden="true">åˆ©ç”¨doccanoè¿›è¡Œæ ‡æ³¨</figcaption></figure><p>å½“æˆ‘ä»¬å®Œæˆéƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰æ•°æ®çš„æ ‡æ³¨æ—¶ï¼Œå¯ä»¥åœ¨<code>Statistics</code>ä¸­æŸ¥çœ‹æ ‡æ³¨æ–‡æ¡£æ•°é‡ï¼Œæ¯ä¸ªæ ‡ç­¾çš„æ ‡æ³¨æ•°é‡ä»¥åŠæ¯ä¸ªç”¨æˆ·çš„æ ‡æ³¨æ–‡æ¡£æ•°é‡ï¼Œå¦‚ä¸‹é¡µé¢ï¼š</p><figure><img src="/img/nlp32_6.png" alt="æ ‡æ³¨ç»Ÿè®¡" /><figcaption aria-hidden="true">æ ‡æ³¨ç»Ÿè®¡</figcaption></figure><p>æœ¬æ¬¡æ¼”ç¤ºåˆ°æ­¤ç»“æŸã€‚</p><p>ç¬”è€…åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œå‘ç°doccanoç¡®å®æ˜¯ä¸€ä¸ªä¸é”™çš„æ ‡æ³¨å·¥å…·ã€‚å®ƒè¿˜æœ‰å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å®ƒå¯ä»¥è®°å¿†å½“å‰çš„æ ‡æ³¨æ–‡æ¡£ï¼Œå½“ä½ é€€å‡ºé¡µé¢å†æ¬¡è®¿é—®æ—¶ï¼Œç‚¹å‡»<code>Start Annotation</code>æŒ‰é’®å³å¯ä»ä¸Šæ¬¡æ ‡æ³¨çš„æ–‡æ¡£å¼€å§‹è¿›è¡Œæ ‡æ³¨ã€‚åŒæ—¶ï¼Œå®ƒè¿˜æ”¯æŒå¤šäººååŒæ ‡æ³¨å’Œæ£€æŸ¥æœºåˆ¶ï¼Œéå¸¸å¥½ç”¨ã€‚</p><p>æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸ~</p><p>å¤§å®¶ä»¥åå¦‚æœæœ‰æ–‡æ¡£æ ‡æ³¨çš„ä»»åŠ¡ï¼Œä¸å¦¨å¯ä»¥è¯•è¯•ç”¨doccano~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>NLPå·¥å…·</tag>
      
      <tag>doccano</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åä¸€ï¼‰çŸ­è¯­çš„è¯­åºé—®é¢˜</title>
    <link href="/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B8%80%EF%BC%89%E7%9F%AD%E8%AF%AD%E7%9A%84%E8%AF%AD%E5%BA%8F%E9%97%AE%E9%A2%98/"/>
    <url>/2023/07/10/NLP%EF%BC%88%E4%B8%89%E5%8D%81%E4%B8%80%EF%BC%89%E7%9F%AD%E8%AF%AD%E7%9A%84%E8%AF%AD%E5%BA%8F%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ‰€è°“çš„çŸ­è¯­çš„è¯­åºé—®é¢˜ï¼Œå³ç»™å®šä¸€ä¸ªæ‰“ä¹±é¡ºåºçš„çŸ­è¯­ï¼Œæˆ‘ä»¬è¦æŒ‰ç…§è¯­ä¹‰ä¿¡æ¯å°†å…¶é‡æ–°ç»„åˆï¼Œæ–°çš„è¯­åºé€šé¡ºçš„çŸ­è¯­ã€‚</p><p>ä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è¯†åˆ«éªŒè¯ç ä¸­çš„æ–‡å­—çš„æ—¶å€™ï¼Œè¯†åˆ«å‡ºæ¥çš„æ–‡å­—åˆ†åˆ«ä¸ºâ€œå“²â€ï¼Œâ€œæ€â€ï¼Œâ€œå­¦â€ï¼Œâ€œæƒ³â€ï¼Œé‚£ä¹ˆé‡åˆè°ƒæ•´è¯­åºåå½¢æˆçš„çŸ­è¯­åº”è¯¥ä¸ºâ€œå“²å­¦æ€æƒ³â€ã€‚</p><p>è¿™æ ·çš„é—®é¢˜ä¹Ÿä¼šç»å¸¸å‡ºç°ï¼Œé™¤äº†éªŒè¯ç è¯†åˆ«ï¼Œè¿˜æœ‰è¯­éŸ³è¯†åˆ«ç­‰ã€‚è§£å†³è¿™ç±»çš„è¯­åºé—®é¢˜ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç”¨åˆ°ç»Ÿè®¡æ–¹é¢çš„è¯­è¨€æ¨¡å‹ï¼ˆLanguageModelï¼ŒLMï¼‰ï¼Œå¸¸è§çš„æœ‰N-gramé—®é¢˜ç­‰ã€‚</p><p>ä¸‹é¢å°†è®²è¿°n-gramé—®é¢˜çš„è§£å†³åŠæ³•ã€‚</p><h3 id="åŸç†ç¯‡">åŸç†ç¯‡</h3><p>N-gramæ¨¡å‹æ˜¯ä¸€ç§è¯­è¨€æ¨¡å‹ï¼Œè¯­è¨€æ¨¡å‹æ˜¯ä¸€ä¸ªåŸºäºæ¦‚ç‡çš„åˆ¤åˆ«æ¨¡å‹ï¼Œå®ƒçš„è¾“å…¥æ˜¯ä¸€å¥è¯ï¼ˆå•è¯çš„é¡ºåºåºåˆ—ï¼‰ï¼Œè¾“å‡ºæ˜¯è¿™å¥è¯çš„æ¦‚ç‡ï¼Œå³è¿™äº›å•è¯çš„è”åˆæ¦‚ç‡ï¼ˆjointprobabilityï¼‰ã€‚</p><p>å‡è®¾ä¸€ä¸ªå¥å­ç”±nä¸ªè¯ç»„æˆï¼š<span class="math inline">\(S=(w_{1}, w_{2},...,w_{n-1},w_{n})\)</span>ï¼Œå¦‚ä½•è¡¡é‡è¿™äº›è¯çš„è”åˆæ¦‚ç‡å‘¢ï¼Ÿæˆ‘ä»¬ä¸å¦¨å‡è®¾æ¯ä¸€ä¸ªè¯è¯­<spanclass="math inline">\(w_{i}\)</span>éƒ½ä¾èµ–äºå‰<spanclass="math inline">\(i-1\)</span>ä¸ªè¯è¯­çš„å½±å“ï¼Œåˆ™è”åˆæ¦‚ç‡å¦‚ä¸‹ï¼š</p><p><spanclass="math display">\[p(S)=p(w_{1}w_{2}...w_{n-1}w_{n})=p(w_{1})p(w_{2}|w_{1})...p(w_{n}|w_{1}w_{2}...w_{n-1})\]</span></p><p>ä¸Šè¿°çš„å‡è®¾æ˜¯åˆæƒ…åˆç†çš„ï¼Œä½†å®é™…æˆ‘ä»¬åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‘ç°å‚æ•°ç©ºé—´è¿‡å¤§å’Œæ•°æ®ç¨€ç–ç­‰é—®é¢˜ï¼Œå°¤å…¶æ˜¯<spanclass="math inline">\(i\)</span>å€¼è¶Šå¤§ï¼Œå‰<spanclass="math inline">\(i-1\)</span>ä¸ªçš„ç»„åˆæƒ…å†µè¶Šå°‘ï¼Œç”šè‡³ä¸º0ã€‚</p><p>ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦<code>é©¬å°”ç§‘å¤«å‡è®¾</code>ï¼Œå³ä¸€ä¸ªè¯çš„å‡ºç°ä»…ä¸å®ƒä¹‹å‰çš„Nä¸ªè¯æœ‰å…³ã€‚å¦‚æœä¸€ä¸ªè¯çš„å‡ºç°ä»…ä¾èµ–äºå‰ä¸€ä¸ªè¯ï¼Œé‚£ä¹ˆä¸º<code>Bi-gram</code>çš„æƒ…å½¢ï¼ˆN=2ï¼‰ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p><spanclass="math display">\[p(S)=p(w_{1}w_{2}...w_{n-1}w_{n})=p(w_{1})p(w_{2}|w_{1})...p(w_{n}|w_{n-1})\]</span></p><p>å¦‚æœä¸€ä¸ªè¯çš„å‡ºç°ä»…ä¾èµ–äºå‰ä¸¤ä¸ªè¯ï¼Œé‚£ä¹ˆä¸º<code>Tri-gram</code>çš„æƒ…å½¢ï¼ˆN=3ï¼‰ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p><spanclass="math display">\[p(S)=p(w_{1}w_{2}...w_{n-1}w_{n})=p(w_{1})p(w_{2}|w_{1})p(w_{3}|w_{2}w_{1})...p(w_{n}|w_{n-1}w_{n-2})\]</span></p><p>åœ¨å®é™…æˆ‘ä»¬è®¡ç®—ä¸Šè¿°ç­‰å¼æœ€åé¢çš„å€¼æ—¶ï¼Œå¯ä»¥ç”¨é¢‘æ•°æ¥ä»£æ›¿ï¼ˆè¿™æ˜¯æ ¹æ®æ¡ä»¶æ¦‚ç‡å¾—åˆ°çš„ï¼‰ï¼Œæ¯”å¦‚ï¼š</p><p><spanclass="math display">\[p(w_{n}|w_{n-1})=C(w_{n-1}w_{n})/C(w_{n-1})\]</span></p><p><spanclass="math display">\[p(w_{n}|w_{n-1}w_{n-2})=C(w_{n-2}w_{n-1}w_{n})/C(w_{n-2}w_{n-1})\]</span></p><p>å…¶ä¸­ï¼Œ<span class="math inline">\(C(w_{n-1}w_{n})\)</span>è¡¨ç¤º<spanclass="math inline">\(w_{n-1}w_{n}\)</span>ä¸€èµ·åœ¨æ–‡ç« ä¸­å‡ºç°çš„æ¦‚ç‡ï¼Œå…¶ä½™ç±»ä¼¼ã€‚</p><h3 id="å®æˆ˜ç¯‡">å®æˆ˜ç¯‡</h3><p>æ ¹æ®ä¸Šé¢çš„åŸç†ï¼Œæˆ‘ä»¬æ¥è§£å†³çŸ­è¯­çš„è¯­åºé—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è¯­æ–™ï¼Œè¯­æ–™å°±ç”¨äººæ°‘æ—¥æŠ¥çš„NERè¯­æ–™ï¼Œå‰å‡ è¡Œå¦‚ä¸‹ï¼š</p><blockquote><p>æµ·é’“æ¯”èµ›åœ°ç‚¹åœ¨å¦é—¨ä¸é‡‘é—¨ä¹‹é—´çš„æµ·åŸŸã€‚è¿™åº§ä¾å±±å‚æ°´çš„åšç‰©é¦†ç”±å›½å†…ä¸€æµçš„è®¾è®¡å¸ˆä¸»æŒè®¾è®¡ï¼Œæ•´ä¸ªå»ºç­‘ç¾¤ç²¾ç¾è€Œæ¢å®ã€‚åœ¨å‘è¾¾å›½å®¶ï¼Œæ€¥æ•‘ä¿é™©ååˆ†æ™®åŠï¼Œå·²æˆä¸ºç¤¾ä¼šä¿éšœä½“ç³»çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æ—¥ä¿„ä¸¤å›½å›½å†…æ”¿å±€éƒ½å……æ»¡å˜æ•°ï¼Œå°½ç®¡æ—¥ä¿„å…³ç³»ç›®å‰æ˜¯å†å²æœ€ä½³æ—¶æœŸï¼Œä½†å…¶è„†å¼±æ€§ä¸è¨€è‡ªæ˜ã€‚å…‹é©¬å°”çš„å¥³å„¿è®©å¨œä»Šå¹´è¯»äº”å¹´çº§ï¼Œå¥¹æ‰€åœ¨çš„ç­ä¸Šæœ‰30å¤šååŒå­¦ï¼Œè¯¥ç­çš„â€œå®¶å§”ä¼šâ€ç”±10åå®¶é•¿ç»„æˆã€‚</p></blockquote><p>è§£å†³çŸ­è¯­çš„è¯­åºé—®é¢˜çš„è„šæœ¬ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020/5/18 4:04 ä¸‹åˆ</span><br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> permutations<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter<br><br><span class="hljs-comment"># read corpus data in sentence format</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;corpus.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br><span class="hljs-comment"># random characters input order</span><br>string = <span class="hljs-string">&quot;å“²å­¦æ€æƒ³&quot;</span><br><span class="hljs-comment"># string = &quot;æ™¯å¾·é•‡é™¶ç“·&quot;</span><br><span class="hljs-comment"># string = &quot;çªå‡ºè´¡çŒ®&quot;</span><br><span class="hljs-comment"># string = &quot;å“ˆè¨å…‹æ–¯å¦&quot;</span><br><span class="hljs-comment"># string = &quot;ç®¡ç†å±€&quot;</span><br><span class="hljs-comment"># string = &quot;åšç‰©é¦†&quot;</span><br><span class="hljs-comment"># string = &quot;åŒ—äº¬å¤§å­¦&quot;</span><br><span class="hljs-comment"># string = &quot;æµ¦ä¸œå‘å±•é“¶è¡Œ&quot;</span><br><span class="hljs-comment"># string = &quot;ä¸–ç•Œæ¯å†³èµ›&quot;</span><br>word_list = <span class="hljs-built_in">set</span>(<span class="hljs-built_in">list</span>(string))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¨¡æ‹Ÿè¾“å…¥:&quot;</span>, word_list)<br>candidate_list = <span class="hljs-built_in">list</span>(permutations(word_list, r=<span class="hljs-built_in">len</span>(word_list)))<br><br><span class="hljs-comment"># check if a character in the corpus</span><br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> word_list:<br>    <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;&quot;</span>.join(content):<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;%sä¸åœ¨è¯­æ–™åº“ä¸­ï¼&quot;</span> % word)<br><br><span class="hljs-comment"># Language Model</span><br>word_prob_dict = &#123;&#125;<br><span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> candidate_list:<br>    candidate = <span class="hljs-built_in">list</span>(candidate)<br>    prob = <span class="hljs-string">&quot;&quot;</span>.join(content).count(candidate[<span class="hljs-number">0</span>])/<span class="hljs-built_in">len</span>(<span class="hljs-string">&quot;&quot;</span>.join(content))<br>    <span class="hljs-comment"># 2-gram</span><br>    <span class="hljs-comment"># prob = Count(W_&#123;i&#125;W_&#123;i-1&#125;)/Count(W_&#123;i-1&#125;)</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(candidate)):<br>        char_cnt = <span class="hljs-string">&quot;&quot;</span>.join(content).count(candidate[i-<span class="hljs-number">1</span>])<br>        word_cnt = <span class="hljs-string">&quot;&quot;</span>.join(content).count(<span class="hljs-string">&quot;&quot;</span>.join(candidate[i-<span class="hljs-number">1</span>:i+<span class="hljs-number">1</span>]))<br>        prob *= (word_cnt/char_cnt)<br>        <span class="hljs-keyword">if</span> prob == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">break</span><br><br>    word_prob_dict[<span class="hljs-string">&quot;&quot;</span>.join(candidate)] = prob<br><br><span class="hljs-comment"># recognize result</span><br><span class="hljs-comment"># pprint(word_prob_dict)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æœ€ç»ˆè¾“å‡ºç»“æœ:&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">sorted</span>(word_prob_dict.items(), key=itemgetter(<span class="hljs-number">1</span>), reverse=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'æ€', 'æƒ³', 'å“²', 'å­¦'} æœ€ç»ˆè¾“å‡ºç»“æœ: ('å“²å­¦æ€æƒ³',4.851640701745029e-08)</p></blockquote><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'é™¶', 'é•‡', 'å¾·', 'ç“·', 'æ™¯'} æœ€ç»ˆè¾“å‡ºç»“æœ: ('æ™¯å¾·é•‡é™¶ç“·',4.402324066467249e-12)</p></blockquote><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'è´¡', 'å‡º', 'çª', 'çŒ®'} æœ€ç»ˆè¾“å‡ºç»“æœ: ('çªå‡ºè´¡çŒ®',4.4461494672771407e-07)</p></blockquote><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'å¦', 'å…‹', 'è¨', 'æ–¯', 'å“ˆ'} æœ€ç»ˆè¾“å‡ºç»“æœ: ('å“ˆè¨å…‹æ–¯å¦',4.65260719191311e-09)</p></blockquote><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'ç†', 'å±€', 'ç®¡'} æœ€ç»ˆè¾“å‡ºç»“æœ: ('ç®¡ç†å±€',4.5911913512038205e-06)</p></blockquote><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'é¦†', 'ç‰©', 'åš'} æœ€ç»ˆè¾“å‡ºç»“æœ: ('åšç‰©é¦†',5.9318486186358995e-06)</p></blockquote><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'å¤§', 'äº¬', 'åŒ—', 'å­¦'} æœ€ç»ˆè¾“å‡ºç»“æœ: ('åŒ—äº¬å¤§å­¦',3.491890788613219e-06)</p></blockquote><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'é“¶', 'è¡Œ', 'å‘', 'ä¸œ', 'æµ¦', 'å±•'} æœ€ç»ˆè¾“å‡ºç»“æœ:('æµ¦ä¸œå‘å±•é“¶è¡Œ', 2.8403362134844498e-11)</p></blockquote><blockquote><p>æ¨¡æ‹Ÿè¾“å…¥: {'å†³', 'ä¸–', 'ç•Œ', 'æ¯', 'èµ›'} æœ€ç»ˆè¾“å‡ºç»“æœ: ('ä¸–ç•Œæ¯å†³èµ›',6.28999814981479e-07)</p></blockquote><h3 id="æ€»ç»“">æ€»ç»“</h3><p>ä¸Šé¢çš„ä»£ç åªæ˜¯ç»™å‡ºäº†å¦‚ä½•è§£å†³çŸ­è¯­çš„è¯­åºé—®é¢˜çš„ä¸€ä¸ªå®ç°æ€è·¯ï¼Œå®é™…æˆ‘ä»¬åœ¨åº”ç”¨çš„è¿‡ç¨‹ä¸­è¿˜éœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><p>è¯­æ–™å¤§å°ï¼Œæœ¬æ–‡ç¤ºä¾‹è¯­æ–™è¾ƒå°ï¼Œåªæœ‰3ä¸‡å¤šå¥è¯ï¼Œè¯­æ–™è¶Šå¤§ï¼Œè¯†åˆ«çš„æ•ˆæœä¸€èˆ¬ä¹Ÿè¶Šå¥½ï¼›</p></li><li><p>çŸ­è¯­çš„é•¿åº¦ï¼Œä¸€èˆ¬çŸ­è¯­è¶Šé•¿ï¼Œè¯†åˆ«çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼Œå¦‚ä½•ä¼˜åŒ–è¯†åˆ«ç®—æ³•ï¼Œä»è€Œä½¿å¾—è¯†åˆ«æ—¶é—´æ›´çŸ­ï¼›</p></li><li><p>å¹³æ»‘å¤„ç†ï¼Œæœ¬ä¾‹ä¸­ä¸è€ƒè™‘åˆ†æ¯ä¸º0çš„æƒ…å½¢ï¼Œå®é™…åº”ç”¨ä¸­æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘åˆ†æ¯ä¸º0çš„æƒ…å½¢ï¼Œæ­¤æ—¶éœ€è¦åšå¹³æ»‘å¤„ç†ã€‚</p><p>æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»~</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>è¯­è¨€æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆä¸‰åï¼‰åˆ©ç”¨ALBERTå’Œæœºå™¨å­¦ä¹ æ¥åšæ–‡æœ¬åˆ†ç±»</title>
    <link href="/2023/07/09/NLP%EF%BC%88%E4%B8%89%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%92%8C%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%9D%A5%E5%81%9A%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <url>/2023/07/09/NLP%EF%BC%88%E4%B8%89%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%92%8C%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%9D%A5%E5%81%9A%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡çš„çµæ„Ÿæ¥è‡ªäº<ahref="http://jalammar.github.io/a-visual-guide-to-using-bert-for-the-first-time">AVisual Guide to Using BERT for the First Time</a>ï¼Œå…¶ä½œè€…ä¸ºJayAlammarï¼Œè®¿é—®ç½‘å€ä¸ºï¼šhttp://jalammar.github.io/a-visual-guide-to-using-bert-for-the-first-timeã€‚</p><p>åœ¨æ–‡æœ¬åˆ†ç±»ä¸­ï¼Œæœ‰ä¸¤ä¸ªå¤§çš„æ€è·¯ï¼Œä¸€ä¸ªæ˜¯æœºå™¨å­¦ä¹ ï¼Œä¸»è¦æ˜¯åˆ©ç”¨n-gramç­‰ç‰¹å¾å°†æ–‡æœ¬è½¬åŒ–ä¸ºç‰¹å¾å‘é‡ï¼Œè¿™ç§æ–¹æ³•ä¾¿äºæ“ä½œå’Œç†è§£ï¼Œä½†æ˜¯å¿½ç•¥äº†æ–‡æœ¬æœ¬èº«çš„è¯­ä¹‰ä¿¡æ¯ï¼›å¦ä¸€ä¸ªæ˜¯æ·±åº¦å­¦ä¹ ï¼Œä¸»è¦æ˜¯åˆ©ç”¨word2vecä½œä¸ºç‰¹å¾æå–ï¼ŒåŠ ä¹‹CNNæˆ–RNNç­‰æ·±åº¦å­¦ä¹ æ¨¡å‹æ¥è¿›è¡Œåˆ†ç±»ï¼Œå°¤å…¶æ˜¯BERTç­‰é¢„è®­ç»ƒæ¨¡å‹å‡ºæ¥äº†ï¼Œåœ¨å°æ ·æœ¬ä¸Šåšfinetuneå³å¯å–å¾—ä¸é”™çš„æ•ˆæœï¼Œèƒ½åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæå–å‡ºæ–‡æœ¬çš„è¯­ä¹‰ä¿¡æ¯ï¼Œä½†è¿™ç§æ–¹æ³•ä¸ä¾¿äºæ“ä½œå’Œç†è§£ã€‚</p><p>ä¸€ä¸ªç®€å•çš„æƒ³æ³•ä¾¿æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹å¯¹æ–‡æœ¬åšç‰¹å¾æå–ï¼Œç„¶ååœ¨è°ƒç”¨æœºå™¨å­¦ä¹ ä¸­çš„åˆ†ç±»æ¨¡å‹æ¥è¿›è¡Œåˆ†ç±»ï¼Œè¿™æ ·åšæ€è·¯æ˜¯æ¸…æ™°çš„ï¼Œæ“ä½œè¾ƒä¸ºå¤æ‚ï¼Œä¾¿äºç†è§£ï¼ŒåŒæ—¶åˆä¸ä¼šä¸¢å¤±è®­ç»ƒæ¨¡å‹ä¸­çš„è¯­ä¹‰ä¿¡æ¯ã€‚</p><p>æœ¬æ–‡ä»¥ALBERTä½œä¸ºæ–‡æœ¬çš„ç‰¹å¾æå–ï¼Œç”¨æœºå™¨å­¦ä¹ ä¸­çš„é€»è¾‘å›å½’ï¼ˆLRï¼‰ã€æœ´ç´ è´å¶æ–¯ï¼ˆNBï¼‰ã€æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰ç­‰æ¨¡å‹æ¥è¿›è¡Œæ–‡æœ¬ã€‚æ³¨æ„ï¼Œæœ¬æ–‡ä»…ä½œä¸ºæ–‡æœ¬åˆ†ç±»æ–¹é¢çš„å°è¯•ï¼Œå…·ä½“åœ¨å®é™…çš„æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ä¸­è¿˜éœ€è¦å…·ä½“åˆ†æã€‚</p><p>æœ¬æ–‡çš„æ•°æ®æ¥æºå¯ä»¥å‚è€ƒæ–‡ç« ï¼š<ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåäºŒï¼‰åˆ©ç”¨ALBERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</a>ï¼Œä¸€å…±æ˜¯300æ¡è®­ç»ƒæ•°æ®å’Œ80æ¡æµ‹è¯•æ•°æ®ï¼Œç”¨äºåŒºåˆ†æ–‡æœ¬æ˜¯å¦æ˜¯å±äºæ”¿æ²»ä¸Šçš„å‡ºè®¿ç±»äº‹ä»¶ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ALBERTå·²ç»è®­ç»ƒå¥½çš„æ–‡ä»¶albert_tinyï¼Œå€Ÿé‰´BERTçš„è°ƒç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç»™å‡ºalbert_zhæ¨¡å—ï¼Œèƒ½å¤Ÿè®©ALBERTæå–æ–‡æœ¬çš„ç‰¹å¾ï¼Œå…·ä½“ä»£ç ä¸åœ¨è¿™é‡Œç»™å‡ºï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è®¿é—®è¯¥é¡¹ç›®çš„Githubåœ°å€ï¼š<ahref="https://github.com/percent4/ALBERT_text_classification">https://github.com/percent4/ALBERT_text_classification</a>ã€‚</p><p>æ³¨æ„ï¼Œæœ¬æ–‡ä¸­å¹¶æ²¡æœ‰ç»™å‡ºæ–‡æœ¬é¢„å¤„ç†çš„ä»£ç ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒè¯¥é¡¹ç›®çš„Githubåœ°å€ã€‚åœ¨ç‰¹å¾æå–è¿‡ç¨‹ä¸­ï¼ŒAlbert_tinyæ¨¡å‹ç»™å‡ºçš„å‘é‡ç»´åº¦ä¸º312ï¼Œæˆ‘ä»¬çš„æ¨¡å‹è®­ç»ƒä»£ç ï¼ˆml_model_train.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020/5/15 3:44 ä¸‹åˆ</span><br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LogisticRegression <span class="hljs-keyword">as</span> LR<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> confusion_matrix, accuracy_score, classification_report<br><span class="hljs-keyword">from</span> sklearn.externals <span class="hljs-keyword">import</span> joblib<br><span class="hljs-keyword">from</span> sklearn.svm <span class="hljs-keyword">import</span> SVC<br><span class="hljs-keyword">from</span> sklearn.naive_bayes <span class="hljs-keyword">import</span> GaussianNB<br><br><span class="hljs-keyword">from</span> load_data <span class="hljs-keyword">import</span> train_df, test_df<br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-comment"># è¯»å–æ–‡ä»¶å¹¶è¿›è¡Œè½¬æ¢</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;REDUCE_MEAN&quot;</span>, max_seq_len=<span class="hljs-number">200</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;begin encoding&#x27;</span>)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>train_df[<span class="hljs-string">&#x27;x&#x27;</span>] = train_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(f)<br>test_df[<span class="hljs-string">&#x27;x&#x27;</span>] = test_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(f)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end encoding&#x27;</span>)<br><br>x_train = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> train_df[<span class="hljs-string">&#x27;x&#x27;</span>]])<br>x_test = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> test_df[<span class="hljs-string">&#x27;x&#x27;</span>]])<br>y_train = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> train_df[<span class="hljs-string">&#x27;label&#x27;</span>]])<br>y_test = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> test_df[<span class="hljs-string">&#x27;label&#x27;</span>]])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x_train: &#x27;</span>, x_train.shape)<br><br><span class="hljs-comment"># Logistic Regression</span><br>lr = LR(random_state=<span class="hljs-number">123</span>)<br>lr.fit(x_train, y_train)<br><br>y_pred = lr.predict(x_test)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Logistic Regression Model&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ··æ·†çŸ©é˜µ&quot;</span>, confusion_matrix(y_true=y_test, y_pred=y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£ç¡®ç‡ï¼š&quot;</span>, accuracy_score(y_test, y_pred))<br><span class="hljs-built_in">print</span>(classification_report(y_true=y_test, y_pred=y_pred, digits=<span class="hljs-number">4</span>))<br><br><span class="hljs-comment"># ä¿å­˜æ¨¡å‹</span><br>joblib.dump(lr, <span class="hljs-string">&quot;lr.model&quot;</span>)<br><br><span class="hljs-comment"># Naive Bayes Model</span><br>gnb = GaussianNB()<br>gnb.fit(x_train, y_train)<br>y_pred = gnb.predict(x_test)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nNaive Bayes Model&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ··æ·†çŸ©é˜µ&quot;</span>, confusion_matrix(y_true=y_test, y_pred=y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£ç¡®ç‡ï¼š&quot;</span>, accuracy_score(y_test, y_pred))<br><span class="hljs-built_in">print</span>(classification_report(y_true=y_test, y_pred=y_pred, digits=<span class="hljs-number">4</span>))<br><br><span class="hljs-comment"># SVM model</span><br>svc = SVC(kernel=<span class="hljs-string">&quot;rbf&quot;</span>)<br>svc.fit(x_train, y_train)<br>y_pred = svc.predict(x_test)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nSVM Model&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ··æ·†çŸ©é˜µ&quot;</span>, confusion_matrix(y_true=y_test, y_pred=y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£ç¡®ç‡ï¼š&quot;</span>, accuracy_score(y_test, y_pred))<br><span class="hljs-built_in">print</span>(classification_report(y_true=y_test, y_pred=y_pred, digits=<span class="hljs-number">4</span>))<br><br>joblib.dump(svc, <span class="hljs-string">&quot;svc.model&quot;</span>)<br></code></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥ç®€å•çš„ç†ä¸€ä¸‹æ€è·¯ï¼Œæˆ‘ä»¬çš„è®­ç»ƒé›†åˆæµ‹è¯•é›†æ•°æ®é›†ä¸º<code>train_df</code>å’Œ<code>test_df</code>ï¼ŒåŒ…å«æ–‡æœ¬å†…å®¹å’Œæ ‡ç­¾ç­‰ï¼Œç„¶åç”¨ALBERTæå–æ–‡æœ¬ç‰¹å¾ï¼Œå†å°è¯•ç”¨é€»è¾‘å›å½’ã€æœ´ç´ è´å¶æ–¯ã€æ”¯æŒå‘é‡æœºç­‰æœºå™¨å­¦ä¹ æ¨¡å‹æ¥è¿›è¡Œåˆ†ç±»ã€‚åˆ†ç±»åçš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs lua">Logistic Regression Model<br>æ··æ·†çŸ©é˜µ <span class="hljs-string">[[33  5]</span><br><span class="hljs-string"> [ 2 40]]</span><br>æ­£ç¡®ç‡ï¼š <span class="hljs-number">0.9125</span><br>              precision    recall  f1-score   support<br><br>           <span class="hljs-number">0</span>     <span class="hljs-number">0.9429</span>    <span class="hljs-number">0.8684</span>    <span class="hljs-number">0.9041</span>        <span class="hljs-number">38</span><br>           <span class="hljs-number">1</span>     <span class="hljs-number">0.8889</span>    <span class="hljs-number">0.9524</span>    <span class="hljs-number">0.9195</span>        <span class="hljs-number">42</span><br><br>   micro avg     <span class="hljs-number">0.9125</span>    <span class="hljs-number">0.9125</span>    <span class="hljs-number">0.9125</span>        <span class="hljs-number">80</span><br>   macro avg     <span class="hljs-number">0.9159</span>    <span class="hljs-number">0.9104</span>    <span class="hljs-number">0.9118</span>        <span class="hljs-number">80</span><br>weighted avg     <span class="hljs-number">0.9145</span>    <span class="hljs-number">0.9125</span>    <span class="hljs-number">0.9122</span>        <span class="hljs-number">80</span><br><br><br>Naive Bayes Model<br>æ··æ·†çŸ©é˜µ <span class="hljs-string">[[37  1]</span><br><span class="hljs-string"> [ 1 41]]</span><br>æ­£ç¡®ç‡ï¼š <span class="hljs-number">0.975</span><br>              precision    recall  f1-score   support<br><br>           <span class="hljs-number">0</span>     <span class="hljs-number">0.9737</span>    <span class="hljs-number">0.9737</span>    <span class="hljs-number">0.9737</span>        <span class="hljs-number">38</span><br>           <span class="hljs-number">1</span>     <span class="hljs-number">0.9762</span>    <span class="hljs-number">0.9762</span>    <span class="hljs-number">0.9762</span>        <span class="hljs-number">42</span><br><br>   micro avg     <span class="hljs-number">0.9750</span>    <span class="hljs-number">0.9750</span>    <span class="hljs-number">0.9750</span>        <span class="hljs-number">80</span><br>   macro avg     <span class="hljs-number">0.9749</span>    <span class="hljs-number">0.9749</span>    <span class="hljs-number">0.9749</span>        <span class="hljs-number">80</span><br>weighted avg     <span class="hljs-number">0.9750</span>    <span class="hljs-number">0.9750</span>    <span class="hljs-number">0.9750</span>        <span class="hljs-number">80</span><br><br>SVM Model<br>æ··æ·†çŸ©é˜µ <span class="hljs-string">[[35  3]</span><br><span class="hljs-string"> [ 1 41]]</span><br>æ­£ç¡®ç‡ï¼š <span class="hljs-number">0.95</span><br>              precision    recall  f1-score   support<br><br>           <span class="hljs-number">0</span>     <span class="hljs-number">0.9722</span>    <span class="hljs-number">0.9211</span>    <span class="hljs-number">0.9459</span>        <span class="hljs-number">38</span><br>           <span class="hljs-number">1</span>     <span class="hljs-number">0.9318</span>    <span class="hljs-number">0.9762</span>    <span class="hljs-number">0.9535</span>        <span class="hljs-number">42</span><br><br>   micro avg     <span class="hljs-number">0.9500</span>    <span class="hljs-number">0.9500</span>    <span class="hljs-number">0.9500</span>        <span class="hljs-number">80</span><br>   macro avg     <span class="hljs-number">0.9520</span>    <span class="hljs-number">0.9486</span>    <span class="hljs-number">0.9497</span>        <span class="hljs-number">80</span><br>weighted avg     <span class="hljs-number">0.9510</span>    <span class="hljs-number">0.9500</span>    <span class="hljs-number">0.9499</span>        <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°ä¸‰ç§æ¨¡å‹åœ¨è¿™ä¸ªæ–‡æœ¬åˆ†ç±»çš„ä»»åŠ¡ä¸Šéƒ½å–å¾—äº†ä¸é”™çš„æ•ˆæœï¼Œæ¯”åœ¨ä¹‹å‰çš„æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåäºŒï¼‰åˆ©ç”¨ALBERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</a>ä¸­çš„ALBERTä½œä¸ºç‰¹å¾æå–ï¼ŒDNNä½œä¸ºåˆ†ç±»æ¨¡å‹çš„æ•ˆæœè¦æ›´å¥½äº›ã€‚</p><p>æœ€åï¼Œè®©æˆ‘ä»¬ç”¨ä¿å­˜çš„æ”¯æŒå‘é‡æœºæ¨¡å‹å¯¹æ–°æ–‡æœ¬è¿›è¡Œé¢„æµ‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020/5/15 4:23 ä¸‹åˆ</span><br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sklearn.externals <span class="hljs-keyword">import</span> joblib<br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-comment"># è¯»å–æ–‡ä»¶å¹¶è¿›è¡Œè½¬æ¢</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;REDUCE_MEAN&quot;</span>, max_seq_len=<span class="hljs-number">200</span>)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># predict</span><br><span class="hljs-comment"># é¢„æµ‹è¯­å¥</span><br>texts = [<span class="hljs-string">&#x27;åœ¨è®¿é—®é™åˆ¶ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ç¦ç”¨iPhoneçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬Siriã€iTunesè´­ä¹°åŠŸèƒ½ã€å®‰è£…/åˆ é™¤åº”ç”¨ç­‰ï¼Œç”šè‡³è¿˜å¯ä»¥è®©iPhoneå˜æˆä¸€å°åŠŸèƒ½æ‰‹æœºã€‚ä»¥ä¸‹æ˜¯è®¿é—®é™åˆ¶å…·ä½“å¯ä»¥å®ç°çš„ä¸€äº›åŠŸèƒ½&#x27;</span>,<br>         <span class="hljs-string">&#x27;ITä¹‹å®¶4æœˆ23æ—¥æ¶ˆæ¯ è¿‘æ—¥ï¼Œè°·æ­Œåœ¨å…¶å®˜æ–¹è®ºå›å‘å¸ƒæ¶ˆæ¯è¡¨ç¤ºï¼Œä»–ä»¬ä¸ºAndroid Autoæ·»åŠ äº†ä¸€é¡¹æ–°åŠŸèƒ½ï¼šå¯ä»¥è®¿é—®å®Œæ•´è”ç³»äººåˆ—è¡¨ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡åœ¨Autoçš„ç”µè¯æ‹¨å·ç•Œé¢ä¸­æ‰“å¼€å·¦ä¸Šè§’çš„èœå•è®¿é—®å®Œæ•´çš„è”ç³»äººåˆ—è¡¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€åŠŸèƒ½ä»…æ”¯æŒåœ¨è½¦è¾†åœæ­¢æ—¶ä½¿ç”¨ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;è¦é€šè¿‡telnet è®¿é—®è·¯ç”±å™¨ï¼Œéœ€è¦å…ˆé€šè¿‡console å£å¯¹è·¯ç”±å™¨è¿›è¡ŒåŸºæœ¬é…ç½®ï¼Œä¾‹å¦‚ï¼šIPåœ°å€ã€å¯†ç ç­‰ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ITä¹‹å®¶3æœˆ26æ—¥æ¶ˆæ¯ è¿‘æ—¥åç›—ç‰ˆçš„å›½é™…å’¨è¯¢å…¬å¸MUSOå‘å¸ƒäº†2017å¹´çš„å¹´åº¦æŠ¥å‘Šï¼Œå…¶ä¸­çš„æ•°æ®æ˜¾ç¤ºï¼Œå»å¹´ç›—ç‰ˆèµ„æºç½‘ç«™è®¿é—®é‡è¾¾åˆ°äº†3000äº¿æ¬¡ï¼Œæ¯”å‰ä¸€å¹´ï¼ˆ2016å¹´ï¼‰æé«˜äº†1.6%ã€‚ç¾å›½æ˜¯è®¿é—®ç›—ç‰ˆç«™ç‚¹æ¬¡æ•°æœ€å¤šçš„å›½å®¶ï¼Œå…±æœ‰279äº¿æ¬¡è®¿é—®ï¼›å…¶ååˆ†åˆ«æ˜¯ä¿„ç½—æ–¯ã€å°åº¦å’Œå·´è¥¿ï¼Œä¸­å›½ä½åˆ—ç¬¬18ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;åº”è‘¡è„ç‰™è®®ä¼šé‚€è¯·ï¼Œå…¨å›½äººå¤§å¸¸å§”ä¼šå‰¯å§”å‘˜é•¿å‰ç‚³è½©ç‡å›¢äº12æœˆ14æ—¥è‡³16æ—¥è®¿é—®è‘¡è„ç‰™ï¼Œä¼šè§å‰¯è®®é•¿è´¹åˆ©ä½©ã€ç¤¾ä¼šå…šå‰¯æ€»ä¹¦è®°å¡å†…ç½—ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2æœˆ26æ—¥è‡³3æœˆ2æ—¥ï¼Œåº”é¦™æ¸¯ç‰¹åŒºæ”¿åºœâ€œå†…åœ°è´µå®¾è®¿æ¸¯è®¡åˆ’â€é‚€è¯·ï¼Œçœå§”å¸¸å§”ã€å¸¸åŠ¡å‰¯çœé•¿é™ˆå‘ç¾¤èµ´æ¸¯è€ƒå¯Ÿè®¿é—®ï¼Œé‡ç‚¹å›´ç»•â€œé¦™æ¸¯æ‰€é•¿ã€æ¹–å—æ‰€éœ€â€ï¼Œä¸ç‰¹åŒºæ”¿åºœç›¸å…³éƒ¨é—¨å’Œæœºæ„æ·±å…¥äº¤æµï¼Œæ¨åŠ¨æ¹–å—ä¸é¦™æ¸¯äº¤æµåˆä½œå–å¾—æ–°è¿›å±•ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ç›®å‰Aç«™å·²ç»æ¢å¤äº†è®¿é—®ï¼Œå¯ä»¥ç›´æ¥ç™»å½•ï¼Œç½‘é¡µåŠ è½½æ­£å¸¸ï¼Œè§†é¢‘å·²ç»å¯ä»¥æ­£å¸¸æ’­æ”¾ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;éš¾æ°‘ç½²ç‰¹ä½¿å®‰å‰ä¸½å¨œÂ·æœ±è‰6æœˆ8æ—¥ç»“æŸäº†å¯¹å“¥ä¼¦æ¯”äºšå’Œå§”å†…ç‘æ‹‰è¾¹å¢ƒåœ°åŒºçš„éš¾æ°‘è¥åœ°ä¸ºæœŸä¸¤å¤©çš„è®¿é—®ï¼Œå¥¹å¯¹å“¥ä¼¦æ¯”äºšäººæ°‘å±•ç°çš„äººé“ä¸»ä¹‰å’Œå‹‡æ°”è¡¨ç¤ºèµæ‰¬ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®ã€Šå—å¾·æ„å¿—æŠ¥ã€‹æŠ¥é“ï¼Œå¾·å›½æ€»ç†é»˜å…‹å°”è®¡åˆ’æ˜å¹´1æœˆå°±å‰å¾€å®‰å¡æ‹‰ï¼Œå’ŒåœŸè€³å…¶æ€»ç»ŸåŸƒå°”å¤šå®‰è¿›è¡Œä¼šè°ˆã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;Win7ç”µè„‘æç¤ºæ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜æ€ä¹ˆåŠ?å¾ˆå¤šç”¨æˆ·åœ¨ä½¿ç”¨æ— çº¿ç½‘è¿æ¥ä¸Šç½‘æ—¶ï¼Œå‘ç°æ— çº¿ç½‘æ˜¾ç¤ºå·²è¿æ¥ï¼Œä½†æ—è¾¹å´å‡ºç°äº†ä¸€ä¸ªé»„è‰²æ„Ÿå¹å·ï¼Œæ— æ³•è¿›è¡Œç½‘ç»œæ“ä½œï¼Œé€šè¿‡è¯Šæ–­æç¤ºç”µè„‘æ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜ï¼Œä¸”å¤„äºæœªä¿®å¤çŠ¶æ€ï¼Œè¿™è¯¥æ€ä¹ˆåŠå‘¢?ä¸‹é¢å°ç¼–å°±å’Œå¤§å®¶åˆ†äº«ä¸‹Win7ç”µè„‘æç¤ºæ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2019å¹´10æœˆ13æ—¥è‡³14æ—¥ï¼Œå¤–äº¤éƒ¨å‰¯éƒ¨é•¿é©¬æœæ—­è®¿é—®æ™ºåˆ©ï¼Œä¼šè§æ™ºåˆ©å¤–é•¿é‡ŒéŸ¦æ‹‰ï¼ŒåŒæ™ºåˆ©æ€»ç»Ÿå¤–äº‹é¡¾é—®è¨æ‹‰æ–¯ä¸¾è¡Œä¼šè°ˆï¼Œå°±æ™ºåˆ©ä¸¾åŠäºšå¤ªç»åˆç»„ç»‡ï¼ˆAPECï¼‰ç¬¬äºŒåä¸ƒæ¬¡é¢†å¯¼äººéæ­£å¼ä¼šè®®ç­‰æ·±å…¥äº¤æ¢æ„è§ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æœªå¼€å‘æ‰€æœ‰å®‰å…¨ç»„ä¹‹å‰è®¿é—®ï¼ŒFTPå¯ä»¥é“¾æ¥ä¸Šï¼Œä½†æ˜¯æ‰“å¼€ä¼šå¾ˆæ…¢ï¼Œéœ€è¦1-2åˆ†é’Ÿæ‰èƒ½é“¾æ¥ä¸Š&#x27;</span>,<br>         <span class="hljs-string">&#x27;win7ç³»ç»Ÿç”µè„‘çš„ç”¨æˆ·ï¼Œåœ¨è¿æ¥WIFIç½‘ç»œç½‘ä¸Šæ—¶ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°çªç„¶ä¸Šä¸äº†ç½‘ï¼ŒæŸ¥çœ‹è¿æ¥çš„WIFIå‡ºç°â€œæœ‰é™çš„è®¿é—®æƒé™â€çš„æ–‡å­—æç¤ºã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;è”åˆå›½ç§˜ä¹¦é•¿æ½˜åŸºæ–‡ï¼˜æ—¥è®¿é—®äº†æ—¥æœ¬ç¦å²›å¿ï¼Œä¸å½“åœ°ç¾æ°‘äº¤æµå¹¶è®¿é—®äº†ä¸€æ‰€é«˜ä¸­ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ­£åœ¨ä¸­å›½è®¿é—®çš„å·´å·´å¤šæ–¯æ€»ç†æ–¯å›¾å°”ç‰¹ï¼‘ï¼•æ—¥åœ¨é™•è¥¿è¥¿å®‰å‚è§‚è®¿é—®ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®å¤–åª’æŠ¥é“,å½“åœ°æ—¶é—´10æ—¥,ç¾å›½ç™½å®«å‘å£°æ˜ç§°,ç¾å›½æ€»ç»Ÿç‰¹æœ—æ™®å°†äº2æœˆåº•è®¿é—®å°åº¦,ä¸å°åº¦æ€»ç†è«è¿ªè¿›è¡Œæˆ˜ç•¥å¯¹è¯ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2æœˆ28æ—¥ï¼Œå”å±±æ›¹å¦ƒç”¸è“è‰²æµ·æ´‹ç§‘æŠ€æœ‰é™å…¬å¸è‘£äº‹é•¿èµµåŠ›å†›ç­‰ä¸€è¡Œ5äººåˆ°é»„æµ·æ°´äº§ç ”ç©¶æ‰€äº¤æµè®¿é—®ã€‚é»„æµ·æ°´äº§ç ”ç©¶æ‰€å‰¯æ‰€é•¿è¾›ç¦è¨€åŠç›¸å…³éƒ¨é—¨è´Ÿè´£äººã€ä¸“å®¶ç­‰å‚åŠ äº†ä¼šè®®ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2018å¹´7æœˆ2æ—¥ï¼Œè«æ–¯ç§‘å­”å­æ–‡åŒ–ä¿ƒè¿›ä¼šä¼šé•¿å§œå½¦å½¬ï¼Œå¸¸åŠ¡å‰¯ä¼šé•¿é™ˆå›½å»ºï¼Œåœ¨ä¸­å›½è‘—åç•™ä¿„æ²¹ç”»å¤§å¸ˆç‰Ÿå…‹æ•™æˆçš„é™ªåŒä¸‹ï¼Œè®¿é—®äº†è«æ–¯ç§‘å›½ç«‹è‹é‡Œç§‘å¤«ç¾æœ¯å­¦é™¢ï¼Œå—åˆ°ç¬¬ä¸€å‰¯æ ¡é•¿ä¼Šæˆˆå°”Â·æˆˆå°”å·´ç§‹å…‹å…ˆç”Ÿæ¥å¾…ã€‚&#x27;</span><br>         <span class="hljs-string">&#x27;æ®å¤–åª’æŠ¥é“ï¼Œå½“åœ°æ—¶é—´26æ—¥æ™šï¼Œé˜¿å°”åŠåˆ©äºšæ€»ç»Ÿç‰¹æœ¬æŠµè¾¾æ²™ç‰¹é˜¿æ‹‰ä¼¯ï¼Œè¿›è¡Œä¸ºæœŸä¸‰å¤©çš„è®¿é—®ã€‚ä¸¤å›½é¢†å¯¼äººé¢„è®¡å°†å°±å›½å®¶é—´åˆä½œå’Œåœ°åŒºå‘å±•è¿›è¡Œç£‹å•†ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ä¸æ ‡å‡†Mozyä¸€æ ·ï¼ŒStashæ–‡ä»¶å¤¹ä¸ºç”¨æˆ·æä¾›äº†å¯¹å…¶å¤‡ä»½æ–‡ä»¶çš„åŸºäºäº‘çš„è®¿é—®ï¼Œä½†æ˜¯å®ƒä»¬è¿˜ä½¿ä»–ä»¬å¯ä»¥éšæ—¶ï¼Œè·¨å¤šä¸ªè®¾å¤‡(åŒ…æ‹¬æ‰€æœ‰è®¡ç®—æœºï¼Œæ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç”µè„‘)è®¿é—®å®ƒä»¬ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨æµè§ˆå™¨çš„ä»»ä½•äººéƒ½å¯ä»¥åŒæ—¶æŸ¥çœ‹æ–‡ä»¶(å¦‚æœéœ€è¦)ã€‚æ“ä½œç³»ç»Ÿå’Œè®¾å¤‡å“ç‰Œæ— å…³ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ç ”ç©¶è¡¨æ˜ï¼Œæ¯ä¸ªç½‘é¡µçš„å¹³å‡é¢„æœŸå¯¿å‘½ä¸º44è‡³100å¤©ã€‚å½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®å·²æ¶ˆå¤±çš„ç½‘é¡µæ—¶ï¼Œå°±ä¼šçœ‹åˆ°ã€ŒPage Not Foundã€çš„é”™è¯¯ä¿¡æ¯ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œç›¸ä¿¡å¤§å¤šæ•°äººä¹Ÿåªèƒ½ä¸äº†äº†ä¹‹ã€‚ä¸è¿‡æœ‰è´£ä»»å¿ƒçš„ç»„ç»‡â€”â€”äº’è”ç½‘æ¡£æ¡ˆé¦†ä¸ºäº†æä¾›æ›´å¯é çš„WebæœåŠ¡ï¼Œå®ƒè”æ‰‹Braveæµè§ˆå™¨ä¸“é—¨é’ˆå¯¹æ­¤ç±»ç½‘é¡µæä¾›äº†ä¸€é”®åŠ è½½å­˜æ¡£é¡µé¢çš„åŠŸèƒ½ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®å¤–åª’æŠ¥é“ï¼ŒåœŸè€³å…¶æ€»ç»Ÿåºœäºå½“åœ°æ—¶é—´2æ—¥è¡¨ç¤ºï¼ŒåœŸè€³å…¶æ€»ç»ŸåŸƒå°”å¤šå®‰è®¡åˆ’äº5æ—¥å¯¹ä¿„ç½—æ–¯è¿›è¡Œä¸ºæœŸä¸€å¤©çš„è®¿é—®ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;3æ—¥ï¼Œæ ¹æ®ä¸‰æ˜Ÿç”µå­çš„æ¶ˆæ¯ï¼Œæåœ¨é••å‰¯ä¼šé•¿è¿™å¤©è®¿é—®äº†ä½äºéŸ©å›½åº†å°šåŒ—é“é¾Ÿå°¾å¸‚çš„ä¸‰æ˜Ÿç”µå­å·¥å‚ã€‚&#x27;</span>,<br>         <span class="hljs-string">&quot;é€šè¿‡ä½ æœ¬æœºip å’Œ 2375ç«¯å£è®¿é—®æµ‹è¯•æ˜¯å¦æˆåŠŸã€‚&quot;</span>,<br>         <span class="hljs-string">&quot;æ–¹æµå„å¼—æœ—è¥¿æ–¯æ•™çš‡è®¿é—®æ³°å›½ï¼Œåœ¨æ³°å›½æ›¼è°·æœ±æ‹‰éš†åŠŸå¤§å­¦ä¸¾è¡Œä¼šè®®ï¼Œå¹¶ä¸æ³°å›½ä½›æ•™å®—æ•™é¢†è¢–è°ˆè¯ã€‚&quot;</span>]<br><br><span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts:<br>    vec = np.array([f(text)])<br>    svc = joblib.load(<span class="hljs-string">&quot;svc.model&quot;</span>)<br>    y_predict = svc.predict(vec)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¥å­: %s \n é¢„æµ‹ç±»åˆ«: %s&quot;</span> % (text, y_predict))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs less">å¥å­: åœ¨è®¿é—®é™åˆ¶ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ç¦ç”¨<span class="hljs-selector-tag">iPhone</span>çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬<span class="hljs-selector-tag">Siri</span>ã€<span class="hljs-selector-tag">iTunes</span>è´­ä¹°åŠŸèƒ½ã€å®‰è£…/åˆ é™¤åº”ç”¨ç­‰ï¼Œç”šè‡³è¿˜å¯ä»¥è®©<span class="hljs-selector-tag">iPhone</span>å˜æˆä¸€å°åŠŸèƒ½æ‰‹æœºã€‚ä»¥ä¸‹æ˜¯è®¿é—®é™åˆ¶å…·ä½“å¯ä»¥å®ç°çš„ä¸€äº›åŠŸèƒ½ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: <span class="hljs-selector-tag">IT</span>ä¹‹å®¶<span class="hljs-number">4</span>æœˆ<span class="hljs-number">23</span>æ—¥æ¶ˆæ¯ è¿‘æ—¥ï¼Œè°·æ­Œåœ¨å…¶å®˜æ–¹è®ºå›å‘å¸ƒæ¶ˆæ¯è¡¨ç¤ºï¼Œä»–ä»¬ä¸º<span class="hljs-selector-tag">Android</span> <span class="hljs-selector-tag">Auto</span>æ·»åŠ äº†ä¸€é¡¹æ–°åŠŸèƒ½ï¼šå¯ä»¥è®¿é—®å®Œæ•´è”ç³»äººåˆ—è¡¨ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡åœ¨<span class="hljs-selector-tag">Auto</span>çš„ç”µè¯æ‹¨å·ç•Œé¢ä¸­æ‰“å¼€å·¦ä¸Šè§’çš„èœå•è®¿é—®å®Œæ•´çš„è”ç³»äººåˆ—è¡¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€åŠŸèƒ½ä»…æ”¯æŒåœ¨è½¦è¾†åœæ­¢æ—¶ä½¿ç”¨ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: è¦é€šè¿‡<span class="hljs-selector-tag">telnet</span> è®¿é—®è·¯ç”±å™¨ï¼Œéœ€è¦å…ˆé€šè¿‡<span class="hljs-selector-tag">console</span> å£å¯¹è·¯ç”±å™¨è¿›è¡ŒåŸºæœ¬é…ç½®ï¼Œä¾‹å¦‚ï¼š<span class="hljs-selector-tag">IP</span>åœ°å€ã€å¯†ç ç­‰ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: <span class="hljs-selector-tag">IT</span>ä¹‹å®¶<span class="hljs-number">3</span>æœˆ<span class="hljs-number">26</span>æ—¥æ¶ˆæ¯ è¿‘æ—¥åç›—ç‰ˆçš„å›½é™…å’¨è¯¢å…¬å¸<span class="hljs-selector-tag">MUSO</span>å‘å¸ƒäº†<span class="hljs-number">2017</span>å¹´çš„å¹´åº¦æŠ¥å‘Šï¼Œå…¶ä¸­çš„æ•°æ®æ˜¾ç¤ºï¼Œå»å¹´ç›—ç‰ˆèµ„æºç½‘ç«™è®¿é—®é‡è¾¾åˆ°äº†<span class="hljs-number">3000</span>äº¿æ¬¡ï¼Œæ¯”å‰ä¸€å¹´ï¼ˆ<span class="hljs-number">2016</span>å¹´ï¼‰æé«˜äº†<span class="hljs-number">1.6%</span>ã€‚ç¾å›½æ˜¯è®¿é—®ç›—ç‰ˆç«™ç‚¹æ¬¡æ•°æœ€å¤šçš„å›½å®¶ï¼Œå…±æœ‰<span class="hljs-number">279</span>äº¿æ¬¡è®¿é—®ï¼›å…¶ååˆ†åˆ«æ˜¯ä¿„ç½—æ–¯ã€å°åº¦å’Œå·´è¥¿ï¼Œä¸­å›½ä½åˆ—ç¬¬<span class="hljs-number">18</span>ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: åº”è‘¡è„ç‰™è®®ä¼šé‚€è¯·ï¼Œå…¨å›½äººå¤§å¸¸å§”ä¼šå‰¯å§”å‘˜é•¿å‰ç‚³è½©ç‡å›¢äº<span class="hljs-number">12</span>æœˆ<span class="hljs-number">14</span>æ—¥è‡³<span class="hljs-number">16</span>æ—¥è®¿é—®è‘¡è„ç‰™ï¼Œä¼šè§å‰¯è®®é•¿è´¹åˆ©ä½©ã€ç¤¾ä¼šå…šå‰¯æ€»ä¹¦è®°å¡å†…ç½—ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: <span class="hljs-number">2</span>æœˆ<span class="hljs-number">26</span>æ—¥è‡³<span class="hljs-number">3</span>æœˆ<span class="hljs-number">2</span>æ—¥ï¼Œåº”é¦™æ¸¯ç‰¹åŒºæ”¿åºœâ€œå†…åœ°è´µå®¾è®¿æ¸¯è®¡åˆ’â€é‚€è¯·ï¼Œçœå§”å¸¸å§”ã€å¸¸åŠ¡å‰¯çœé•¿é™ˆå‘ç¾¤èµ´æ¸¯è€ƒå¯Ÿè®¿é—®ï¼Œé‡ç‚¹å›´ç»•â€œé¦™æ¸¯æ‰€é•¿ã€æ¹–å—æ‰€éœ€â€ï¼Œä¸ç‰¹åŒºæ”¿åºœç›¸å…³éƒ¨é—¨å’Œæœºæ„æ·±å…¥äº¤æµï¼Œæ¨åŠ¨æ¹–å—ä¸é¦™æ¸¯äº¤æµåˆä½œå–å¾—æ–°è¿›å±•ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: ç›®å‰<span class="hljs-selector-tag">A</span>ç«™å·²ç»æ¢å¤äº†è®¿é—®ï¼Œå¯ä»¥ç›´æ¥ç™»å½•ï¼Œç½‘é¡µåŠ è½½æ­£å¸¸ï¼Œè§†é¢‘å·²ç»å¯ä»¥æ­£å¸¸æ’­æ”¾ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: éš¾æ°‘ç½²ç‰¹ä½¿å®‰å‰ä¸½å¨œÂ·æœ±è‰<span class="hljs-number">6</span>æœˆ<span class="hljs-number">8</span>æ—¥ç»“æŸäº†å¯¹å“¥ä¼¦æ¯”äºšå’Œå§”å†…ç‘æ‹‰è¾¹å¢ƒåœ°åŒºçš„éš¾æ°‘è¥åœ°ä¸ºæœŸä¸¤å¤©çš„è®¿é—®ï¼Œå¥¹å¯¹å“¥ä¼¦æ¯”äºšäººæ°‘å±•ç°çš„äººé“ä¸»ä¹‰å’Œå‹‡æ°”è¡¨ç¤ºèµæ‰¬ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: æ®ã€Šå—å¾·æ„å¿—æŠ¥ã€‹æŠ¥é“ï¼Œå¾·å›½æ€»ç†é»˜å…‹å°”è®¡åˆ’æ˜å¹´<span class="hljs-number">1</span>æœˆå°±å‰å¾€å®‰å¡æ‹‰ï¼Œå’ŒåœŸè€³å…¶æ€»ç»ŸåŸƒå°”å¤šå®‰è¿›è¡Œä¼šè°ˆã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: <span class="hljs-selector-tag">Win7</span>ç”µè„‘æç¤ºæ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜æ€ä¹ˆåŠ?å¾ˆå¤šç”¨æˆ·åœ¨ä½¿ç”¨æ— çº¿ç½‘è¿æ¥ä¸Šç½‘æ—¶ï¼Œå‘ç°æ— çº¿ç½‘æ˜¾ç¤ºå·²è¿æ¥ï¼Œä½†æ—è¾¹å´å‡ºç°äº†ä¸€ä¸ªé»„è‰²æ„Ÿå¹å·ï¼Œæ— æ³•è¿›è¡Œç½‘ç»œæ“ä½œï¼Œé€šè¿‡è¯Šæ–­æç¤ºç”µè„‘æ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜ï¼Œä¸”å¤„äºæœªä¿®å¤çŠ¶æ€ï¼Œè¿™è¯¥æ€ä¹ˆåŠå‘¢?ä¸‹é¢å°ç¼–å°±å’Œå¤§å®¶åˆ†äº«ä¸‹<span class="hljs-selector-tag">Win7</span>ç”µè„‘æç¤ºæ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: <span class="hljs-number">2019</span>å¹´<span class="hljs-number">10</span>æœˆ<span class="hljs-number">13</span>æ—¥è‡³<span class="hljs-number">14</span>æ—¥ï¼Œå¤–äº¤éƒ¨å‰¯éƒ¨é•¿é©¬æœæ—­è®¿é—®æ™ºåˆ©ï¼Œä¼šè§æ™ºåˆ©å¤–é•¿é‡ŒéŸ¦æ‹‰ï¼ŒåŒæ™ºåˆ©æ€»ç»Ÿå¤–äº‹é¡¾é—®è¨æ‹‰æ–¯ä¸¾è¡Œä¼šè°ˆï¼Œå°±æ™ºåˆ©ä¸¾åŠäºšå¤ªç»åˆç»„ç»‡ï¼ˆ<span class="hljs-selector-tag">APEC</span>ï¼‰ç¬¬äºŒåä¸ƒæ¬¡é¢†å¯¼äººéæ­£å¼ä¼šè®®ç­‰æ·±å…¥äº¤æ¢æ„è§ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: æœªå¼€å‘æ‰€æœ‰å®‰å…¨ç»„ä¹‹å‰è®¿é—®ï¼Œ<span class="hljs-selector-tag">FTP</span>å¯ä»¥é“¾æ¥ä¸Šï¼Œä½†æ˜¯æ‰“å¼€ä¼šå¾ˆæ…¢ï¼Œéœ€è¦<span class="hljs-number">1</span><span class="hljs-selector-tag">-2</span>åˆ†é’Ÿæ‰èƒ½é“¾æ¥ä¸Š <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: <span class="hljs-selector-tag">win7</span>ç³»ç»Ÿç”µè„‘çš„ç”¨æˆ·ï¼Œåœ¨è¿æ¥<span class="hljs-selector-tag">WIFI</span>ç½‘ç»œç½‘ä¸Šæ—¶ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°çªç„¶ä¸Šä¸äº†ç½‘ï¼ŒæŸ¥çœ‹è¿æ¥çš„<span class="hljs-selector-tag">WIFI</span>å‡ºç°â€œæœ‰é™çš„è®¿é—®æƒé™â€çš„æ–‡å­—æç¤ºã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: è”åˆå›½ç§˜ä¹¦é•¿æ½˜åŸºæ–‡ï¼˜æ—¥è®¿é—®äº†æ—¥æœ¬ç¦å²›å¿ï¼Œä¸å½“åœ°ç¾æ°‘äº¤æµå¹¶è®¿é—®äº†ä¸€æ‰€é«˜ä¸­ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: æ­£åœ¨ä¸­å›½è®¿é—®çš„å·´å·´å¤šæ–¯æ€»ç†æ–¯å›¾å°”ç‰¹ï¼‘ï¼•æ—¥åœ¨é™•è¥¿è¥¿å®‰å‚è§‚è®¿é—®ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: æ®å¤–åª’æŠ¥é“,å½“åœ°æ—¶é—´<span class="hljs-number">10</span>æ—¥,ç¾å›½ç™½å®«å‘å£°æ˜ç§°,ç¾å›½æ€»ç»Ÿç‰¹æœ—æ™®å°†äº<span class="hljs-number">2</span>æœˆåº•è®¿é—®å°åº¦,ä¸å°åº¦æ€»ç†è«è¿ªè¿›è¡Œæˆ˜ç•¥å¯¹è¯ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: <span class="hljs-number">2</span>æœˆ<span class="hljs-number">28</span>æ—¥ï¼Œå”å±±æ›¹å¦ƒç”¸è“è‰²æµ·æ´‹ç§‘æŠ€æœ‰é™å…¬å¸è‘£äº‹é•¿èµµåŠ›å†›ç­‰ä¸€è¡Œ<span class="hljs-number">5</span>äººåˆ°é»„æµ·æ°´äº§ç ”ç©¶æ‰€äº¤æµè®¿é—®ã€‚é»„æµ·æ°´äº§ç ”ç©¶æ‰€å‰¯æ‰€é•¿è¾›ç¦è¨€åŠç›¸å…³éƒ¨é—¨è´Ÿè´£äººã€ä¸“å®¶ç­‰å‚åŠ äº†ä¼šè®®ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: <span class="hljs-number">2018</span>å¹´<span class="hljs-number">7</span>æœˆ<span class="hljs-number">2</span>æ—¥ï¼Œè«æ–¯ç§‘å­”å­æ–‡åŒ–ä¿ƒè¿›ä¼šä¼šé•¿å§œå½¦å½¬ï¼Œå¸¸åŠ¡å‰¯ä¼šé•¿é™ˆå›½å»ºï¼Œåœ¨ä¸­å›½è‘—åç•™ä¿„æ²¹ç”»å¤§å¸ˆç‰Ÿå…‹æ•™æˆçš„é™ªåŒä¸‹ï¼Œè®¿é—®äº†è«æ–¯ç§‘å›½ç«‹è‹é‡Œç§‘å¤«ç¾æœ¯å­¦é™¢ï¼Œå—åˆ°ç¬¬ä¸€å‰¯æ ¡é•¿ä¼Šæˆˆå°”Â·æˆˆå°”å·´ç§‹å…‹å…ˆç”Ÿæ¥å¾…ã€‚æ®å¤–åª’æŠ¥é“ï¼Œå½“åœ°æ—¶é—´<span class="hljs-number">26</span>æ—¥æ™šï¼Œé˜¿å°”åŠåˆ©äºšæ€»ç»Ÿç‰¹æœ¬æŠµè¾¾æ²™ç‰¹é˜¿æ‹‰ä¼¯ï¼Œè¿›è¡Œä¸ºæœŸä¸‰å¤©çš„è®¿é—®ã€‚ä¸¤å›½é¢†å¯¼äººé¢„è®¡å°†å°±å›½å®¶é—´åˆä½œå’Œåœ°åŒºå‘å±•è¿›è¡Œç£‹å•†ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: ä¸æ ‡å‡†<span class="hljs-selector-tag">Mozy</span>ä¸€æ ·ï¼Œ<span class="hljs-selector-tag">Stash</span>æ–‡ä»¶å¤¹ä¸ºç”¨æˆ·æä¾›äº†å¯¹å…¶å¤‡ä»½æ–‡ä»¶çš„åŸºäºäº‘çš„è®¿é—®ï¼Œä½†æ˜¯å®ƒä»¬è¿˜ä½¿ä»–ä»¬å¯ä»¥éšæ—¶ï¼Œè·¨å¤šä¸ªè®¾å¤‡(åŒ…æ‹¬æ‰€æœ‰è®¡ç®—æœºï¼Œæ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç”µè„‘)è®¿é—®å®ƒä»¬ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨æµè§ˆå™¨çš„ä»»ä½•äººéƒ½å¯ä»¥åŒæ—¶æŸ¥çœ‹æ–‡ä»¶(å¦‚æœéœ€è¦)ã€‚æ“ä½œç³»ç»Ÿå’Œè®¾å¤‡å“ç‰Œæ— å…³ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: ç ”ç©¶è¡¨æ˜ï¼Œæ¯ä¸ªç½‘é¡µçš„å¹³å‡é¢„æœŸå¯¿å‘½ä¸º<span class="hljs-number">44</span>è‡³<span class="hljs-number">100</span>å¤©ã€‚å½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®å·²æ¶ˆå¤±çš„ç½‘é¡µæ—¶ï¼Œå°±ä¼šçœ‹åˆ°ã€Œ<span class="hljs-selector-tag">Page</span> <span class="hljs-selector-tag">Not</span> <span class="hljs-selector-tag">Found</span>ã€çš„é”™è¯¯ä¿¡æ¯ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œç›¸ä¿¡å¤§å¤šæ•°äººä¹Ÿåªèƒ½ä¸äº†äº†ä¹‹ã€‚ä¸è¿‡æœ‰è´£ä»»å¿ƒçš„ç»„ç»‡â€”â€”äº’è”ç½‘æ¡£æ¡ˆé¦†ä¸ºäº†æä¾›æ›´å¯é çš„<span class="hljs-selector-tag">Web</span>æœåŠ¡ï¼Œå®ƒè”æ‰‹<span class="hljs-selector-tag">Brave</span>æµè§ˆå™¨ä¸“é—¨é’ˆå¯¹æ­¤ç±»ç½‘é¡µæä¾›äº†ä¸€é”®åŠ è½½å­˜æ¡£é¡µé¢çš„åŠŸèƒ½ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: æ®å¤–åª’æŠ¥é“ï¼ŒåœŸè€³å…¶æ€»ç»Ÿåºœäºå½“åœ°æ—¶é—´<span class="hljs-number">2</span>æ—¥è¡¨ç¤ºï¼ŒåœŸè€³å…¶æ€»ç»ŸåŸƒå°”å¤šå®‰è®¡åˆ’äº<span class="hljs-number">5</span>æ—¥å¯¹ä¿„ç½—æ–¯è¿›è¡Œä¸ºæœŸä¸€å¤©çš„è®¿é—®ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: <span class="hljs-number">3</span>æ—¥ï¼Œæ ¹æ®ä¸‰æ˜Ÿç”µå­çš„æ¶ˆæ¯ï¼Œæåœ¨é••å‰¯ä¼šé•¿è¿™å¤©è®¿é—®äº†ä½äºéŸ©å›½åº†å°šåŒ—é“é¾Ÿå°¾å¸‚çš„ä¸‰æ˜Ÿç”µå­å·¥å‚ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br>å¥å­: é€šè¿‡ä½ æœ¬æœº<span class="hljs-selector-tag">ip</span> å’Œ <span class="hljs-number">2375</span>ç«¯å£è®¿é—®æµ‹è¯•æ˜¯å¦æˆåŠŸã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0&#x27;</span>]</span><br>å¥å­: æ–¹æµå„å¼—æœ—è¥¿æ–¯æ•™çš‡è®¿é—®æ³°å›½ï¼Œåœ¨æ³°å›½æ›¼è°·æœ±æ‹‰éš†åŠŸå¤§å­¦ä¸¾è¡Œä¼šè®®ï¼Œå¹¶ä¸æ³°å›½ä½›æ•™å®—æ•™é¢†è¢–è°ˆè¯ã€‚ <br> é¢„æµ‹ç±»åˆ«: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;1&#x27;</span>]</span><br></code></pre></td></tr></table></figure><p>0è¡¨ç¤ºä¸æ˜¯æ”¿æ²»æ„ä¹‰ä¸Šçš„å‡ºè®¿ï¼Œ1ä»£è¡¨æ˜¯ã€‚æ‰€æœ‰çš„æ–°æ–‡æœ¬(æ–°æ–‡æœ¬ä¸­éƒ½å«æœ‰<code>è®¿é—®</code>è¿™ä¸ªè¯è¯­)éƒ½åˆ†ç±»æ­£ç¡®ã€‚</p><p>æœ¬æ–‡ä½œä¸ºç¬”è€…çš„ä¸€æ¬¡å°è¯•ï¼Œå› æ­¤å†™å¾—æ¯”è¾ƒç®€å•ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥ç§»æ­¥æœ¬é¡¹ç›®çš„Githubåœ°å€ï¼š<ahref="https://github.com/percent4/ALBERT_text_classification">https://github.com/percent4/ALBERT_text_classification</a>ã€‚</p><p>æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œæ•¬è¯·æ‰¹è¯„æŒ‡æ­£~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
      <tag>ALBERT</tag>
      
      <tag>æœºå™¨å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåä¹ï¼‰ä¸€æ­¥ä¸€æ­¥ï¼Œç†è§£Self-Attention</title>
    <link href="/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B9%9D%EF%BC%89%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%EF%BC%8C%E7%90%86%E8%A7%A3Self-Attention/"/>
    <url>/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B9%9D%EF%BC%89%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%EF%BC%8C%E7%90%86%E8%A7%A3Self-Attention/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹ç¿»è¯‘è‡ª<ahref="https://towardsdatascience.com/illustrated-self-attention-2d627e33b20a">IllustratedSelf-Attention, Step-by-step guide to self-attention with illustrationsand code</a>ï¼Œä»…ç”¨äºå­¦ä¹ ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸å½“ä¹‹å¤„ï¼Œæ•¬è¯·è°…è§£ï¼</p><h3id="ä»€ä¹ˆæ˜¯self-attentionè‡ªæ³¨æ„åŠ›æœºåˆ¶">ä»€ä¹ˆæ˜¯Self-Attentionï¼ˆè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼‰ï¼Ÿ</h3><p>å¦‚æœä½ åœ¨æƒ³Self-Attentionï¼ˆè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼‰æ˜¯å¦å’ŒAttentionï¼ˆæ³¨æ„åŠ›æœºåˆ¶ï¼‰ç›¸ä¼¼ï¼Œé‚£ä¹ˆç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å®ƒä»¬æœ¬è´¨ä¸Šå±äºåŒä¸€ä¸ªæ¦‚å¿µï¼Œæ‹¥æœ‰è®¸å¤šå…±åŒçš„æ•°å­¦è¿ç®—ã€‚</p><p>ä¸€ä¸ªSelf-Attentionæ¨¡å—æ‹¥æœ‰nä¸ªè¾“å…¥ï¼Œè¿”å›nä¸ªè¾“å‡ºã€‚è¿™ä¹ˆæ¨¡å—é‡Œé¢å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä»éä¸“ä¸šè§’åº¦çœ‹ï¼ŒSelf-Attentionï¼ˆè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼‰å…è®¸è¾“å…¥ä¹‹é—´äº’ç›¸ä½œç”¨ï¼ˆâ€œselfâ€éƒ¨åˆ†ï¼‰ï¼Œå¯»æ‰¾å‡ºè°æ›´åº”è¯¥å€¼å¾—æ³¨æ„ï¼ˆâ€œattentionâ€éƒ¨åˆ†ï¼‰ã€‚è¾“å‡ºçš„ç»“æœæ˜¯è¿™äº›äº’ç›¸ä½œç”¨å’Œæ³¨æ„åŠ›åˆ†æ•°çš„èšåˆã€‚</p><h3 id="ä¸€æ­¥æ­¥ç†è§£self-attention">ä¸€æ­¥æ­¥ç†è§£Self-Attention</h3><p>ç†è§£åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ol type="1"><li>å‡†å¤‡è¾“å…¥ï¼›</li><li>åˆå§‹åŒ–æƒé‡ï¼›</li><li>è·å–<code>key</code>ï¼Œ<code>query</code>å’Œ<code>value</code>ï¼›</li><li>ä¸ºç¬¬1ä¸ªè¾“å…¥è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°ï¼›</li><li>è®¡ç®—softmax;</li><li>å°†åˆ†æ•°ä¹˜ä»¥valuesï¼›</li><li>å¯¹æƒé‡åŒ–åçš„valuesæ±‚å’Œï¼Œå¾—åˆ°è¾“å‡º1ï¼›</li><li>å¯¹å…¶ä½™çš„è¾“å…¥ï¼Œé‡å¤ç¬¬4-7æ­¥ã€‚</li></ol><blockquote><p>æ³¨æ„ï¼šå®é™…ä¸Šï¼Œè¿™äº›æ•°å­¦è¿ç®—éƒ½æ˜¯å‘é‡åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„è¾“å…¥éƒ½ä¼šä¸€èµ·ç»å†è¿™äº›æ•°å­¦è¿ç®—ã€‚æˆ‘ä»¬å°†ä¼šåœ¨åé¢çš„ä»£ç éƒ¨åˆ†çœ‹åˆ°ã€‚</p></blockquote><h4 id="ç¬¬ä¸€æ­¥å‡†å¤‡è¾“å…¥">ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡è¾“å…¥</h4><figure><img src="/img/nlp29_1.png" alt="å‡†å¤‡æ•°æ®" /><figcaption aria-hidden="true">å‡†å¤‡æ•°æ®</figcaption></figure><p>åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»3ä¸ªè¾“å…¥å¼€å§‹ï¼Œæ¯ä¸ªè¾“å…¥çš„ç»´æ•°ä¸º4ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">Input</span> <span class="hljs-number">1</span>: <span class="hljs-selector-attr">[1, 0, 1, 0]</span> <br><span class="hljs-selector-tag">Input</span> <span class="hljs-number">2</span>: <span class="hljs-selector-attr">[0, 2, 0, 2]</span><br><span class="hljs-selector-tag">Input</span> <span class="hljs-number">3</span>: <span class="hljs-selector-attr">[1, 1, 1, 1]</span><br></code></pre></td></tr></table></figure><h4 id="ç¬¬äºŒæ­¥åˆå§‹åŒ–æƒé‡">ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ–æƒé‡</h4><p>æ¯ä¸ªè¾“å…¥å¿…é¡»ç”±ä¸‰ä¸ªè¡¨ç¤ºï¼ˆçœ‹ä¸‹å›¾ï¼‰ã€‚è¿™äº›è¾“å…¥è¢«ç§°ä½œ<code>key</code>ï¼ˆæ©™è‰²ï¼‰ï¼Œ<code>query</code>ï¼ˆçº¢è‰²ï¼‰<code>value</code>ï¼ˆç´«è‰²ï¼‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬æƒ³è¦çš„è¡¨ç¤ºç»´æ•°ä¸º3ã€‚å› ä¸ºæ¯ä¸ªè¾“å…¥çš„ç»´æ•°ä¸º4ï¼Œè¿™å°±æ„å‘³ç€æ¯ä¸ªæƒé‡çš„å½¢çŠ¶ä¸º4Ã—3ã€‚</p><blockquote><p>æ³¨æ„ï¼šæˆ‘ä»¬ç¨åä¼šçœ‹åˆ°<code>value</code>çš„ç»´æ•°ä¹Ÿæ˜¯outputçš„ç»´æ•°ã€‚</p></blockquote><figure><img src="/img/nlp29_2.gif"alt="ä»æ¯ä¸ªè¾“å…¥ä¸­è·å–keyï¼Œvalueï¼Œqueryçš„è¡¨ç¤º" /><figcaptionaria-hidden="true">ä»æ¯ä¸ªè¾“å…¥ä¸­è·å–keyï¼Œvalueï¼Œqueryçš„è¡¨ç¤º</figcaption></figure><p>ä¸ºäº†è·å–è¿™äº›è¡¨ç¤ºï¼Œæ¯ä¸ªè¾“å…¥ï¼ˆç»¿è‰²ï¼‰ä¼šä¹˜ä»¥ä¸€ä¸ªæƒé‡çš„é›†åˆå¾—åˆ°<code>keys</code>ï¼Œä¹˜ä»¥ä¸€ä¸ªæƒé‡çš„é›†åˆå¾—åˆ°<code>queries</code>ï¼Œä¹˜ä»¥ä¸€ä¸ªæƒé‡çš„é›†åˆå¾—åˆ°<code>values</code>ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸‰ä¸ªæƒé‡çš„é›†åˆå¦‚ä¸‹ã€‚</p><p><code>key</code>çš„æƒé‡ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7"><span class="hljs-comment">[<span class="hljs-comment">[0, 0, 1]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[1, 1, 0]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[0, 1, 0]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[1, 1, 0]</span>]</span><br></code></pre></td></tr></table></figure><p><code>query</code>çš„æƒé‡ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7"><span class="hljs-comment">[<span class="hljs-comment">[1, 0, 1]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[1, 0, 0]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[0, 0, 1]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[0, 1, 1]</span>]</span><br></code></pre></td></tr></table></figure><p><code>value</code>çš„æƒé‡ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7"><span class="hljs-comment">[<span class="hljs-comment">[0, 2, 0]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[0, 3, 0]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[1, 0, 3]</span>,</span><br><span class="hljs-comment"> <span class="hljs-comment">[1, 1, 0]</span>]</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šåœ¨ç¥ç»ç½‘ç»œè®¾ç½®ä¸­ï¼Œè¿™äº›æƒé‡é€šå¸¸éƒ½æ˜¯ä¸€äº›å°çš„æ•°å­—ï¼Œåˆ©ç”¨éšæœºåˆ†å¸ƒï¼Œæ¯”å¦‚Gaussian,Xavier and Kaimingåˆ†å¸ƒï¼Œéšæœºåˆå§‹åŒ–ã€‚åœ¨è®­ç»ƒå¼€å§‹å‰å·²ç»å®Œæˆåˆå§‹åŒ–ã€‚</p></blockquote><h3id="ç¬¬ä¸‰æ­¥è·å–keyqueryå’Œvalue">ç¬¬ä¸‰æ­¥ï¼šè·å–<code>key</code>ï¼Œ<code>query</code>å’Œ<code>value</code>ï¼›</h3><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†3ä¸ªæƒé‡çš„é›†åˆï¼Œè®©æˆ‘ä»¬æ¥ç»™æ¯ä¸ªè¾“å…¥è·å–<code>key</code>ï¼Œ<code>query</code>å’Œ<code>value</code>ã€‚</p><p>ç¬¬1ä¸ªè¾“å…¥çš„<code>key</code>è¡¨ç¤ºï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7">               <span class="hljs-comment">[0, 0, 1]</span><br><span class="hljs-comment">[1, 0, 1, 0]</span> x <span class="hljs-comment">[1, 1, 0]</span> = <span class="hljs-comment">[0, 1, 1]</span><br>               <span class="hljs-comment">[0, 1, 0]</span><br>               <span class="hljs-comment">[1, 1, 0]</span><br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ç›¸åŒçš„æƒé‡é›†åˆè·å–ç¬¬2ä¸ªè¾“å…¥çš„<code>key</code>è¡¨ç¤ºï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7">               <span class="hljs-comment">[0, 0, 1]</span><br><span class="hljs-comment">[0, 2, 0, 2]</span> x <span class="hljs-comment">[1, 1, 0]</span> = <span class="hljs-comment">[4, 4, 0]</span><br>               <span class="hljs-comment">[0, 1, 0]</span><br>               <span class="hljs-comment">[1, 1, 0]</span><br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ç›¸åŒçš„æƒé‡é›†åˆè·å–ç¬¬3ä¸ªè¾“å…¥çš„<code>key</code>è¡¨ç¤ºï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7">               <span class="hljs-comment">[0, 0, 1]</span><br><span class="hljs-comment">[1, 1, 1, 1]</span> x <span class="hljs-comment">[1, 1, 0]</span> = <span class="hljs-comment">[2, 3, 1]</span><br>               <span class="hljs-comment">[0, 1, 0]</span><br>               <span class="hljs-comment">[1, 1, 0]</span><br></code></pre></td></tr></table></figure><p>æ›´å¿«çš„æ–¹å¼æ˜¯å°†è¿™äº›è¿ç®—ç”¨å‘é‡æ¥æè¿°ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7">               <span class="hljs-comment">[0, 0, 1]</span><br><span class="hljs-comment">[1, 0, 1, 0]</span>   <span class="hljs-comment">[1, 1, 0]</span>   <span class="hljs-comment">[0, 1, 1]</span><br><span class="hljs-comment">[0, 2, 0, 2]</span> x <span class="hljs-comment">[0, 1, 0]</span> = <span class="hljs-comment">[4, 4, 0]</span><br><span class="hljs-comment">[1, 1, 1, 1]</span>   <span class="hljs-comment">[1, 1, 0]</span>   <span class="hljs-comment">[2, 3, 1]</span><br></code></pre></td></tr></table></figure><figure><img src="/img/nlp29_3.gif" alt="è·å–keyè¡¨ç¤º" /><figcaption aria-hidden="true">è·å–keyè¡¨ç¤º</figcaption></figure><p>è®©æˆ‘ä»¬ç”¨ç›¸åŒçš„æ“ä½œæ¥è·å–æ¯ä¸ªè¾“å…¥çš„<code>value</code>è¡¨ç¤ºï¼š</p><figure><img src="/img/nlp29_4.gif" alt="è·å–value" /><figcaption aria-hidden="true">è·å–value</figcaption></figure><p>æœ€åæ˜¯<code>query</code>çš„è¡¨ç¤ºï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7">               <span class="hljs-comment">[1, 0, 1]</span><br><span class="hljs-comment">[1, 0, 1, 0]</span>   <span class="hljs-comment">[1, 0, 0]</span>   <span class="hljs-comment">[1, 0, 2]</span><br><span class="hljs-comment">[0, 2, 0, 2]</span> x <span class="hljs-comment">[0, 0, 1]</span> = <span class="hljs-comment">[2, 2, 2]</span><br><span class="hljs-comment">[1, 1, 1, 1]</span>   <span class="hljs-comment">[0, 1, 1]</span>   <span class="hljs-comment">[2, 1, 3]</span><br></code></pre></td></tr></table></figure><figure><img src="/img/nlp29_5.gif" alt="è·å–query" /><figcaption aria-hidden="true">è·å–query</figcaption></figure><blockquote><p>æ³¨æ„ï¼šå®é™…ä¸Šï¼Œä¸€ä¸ªåé‡å‘é‡ä¹Ÿè®¸ä¼šåŠ åˆ°çŸ©é˜µç›¸ä¹˜åçš„ç»“æœã€‚</p></blockquote><h4id="ç¬¬å››æ­¥ä¸ºç¬¬1ä¸ªè¾“å…¥è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°">ç¬¬å››æ­¥ï¼šä¸ºç¬¬1ä¸ªè¾“å…¥è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°</h4><figure><img src="/img/nlp29_6.gif" alt="ä¸ºç¬¬1ä¸ªè¾“å…¥è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°ï¼ˆè“è‰²ï¼‰" /><figcaptionaria-hidden="true">ä¸ºç¬¬1ä¸ªè¾“å…¥è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°ï¼ˆè“è‰²ï¼‰</figcaption></figure><p>ä¸ºäº†è·å–æ³¨æ„åŠ›åˆ†æ•°ï¼Œæˆ‘ä»¬ä»è¾“å…¥1çš„<code>query</code>ï¼ˆçº¢è‰²ï¼‰å’Œæ‰€æœ‰<code>keys</code>ï¼ˆæ©™è‰²ï¼‰çš„ç‚¹ç§¯å¼€å§‹ã€‚å› ä¸ºæœ‰3ä¸ª<code>key</code>è¡¨ç¤ºï¼ˆè¿™æ˜¯ç”±äºæˆ‘ä»¬æœ‰3ä¸ªè¾“å…¥ï¼‰ï¼Œæˆ‘ä»¬å¾—åˆ°3ä¸ªæ³¨æ„åŠ›åˆ†æ•°ï¼ˆè“è‰²ï¼‰ã€‚</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7">            <span class="hljs-comment">[0, 4, 2]</span><br><span class="hljs-comment">[1, 0, 2]</span> x <span class="hljs-comment">[1, 4, 3]</span> = <span class="hljs-comment">[2, 4, 4]</span><br>            <span class="hljs-comment">[1, 0, 1]</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ°æˆ‘ä»¬åªç”¨äº†è¾“å…¥çš„<code>query</code>ã€‚åé¢æˆ‘ä»¬ä¼šä¸ºå…¶ä»–çš„<code>queries</code>é‡å¤è¿™äº›æ­¥éª¤ã€‚</p><h4 id="ç¬¬äº”æ­¥è®¡ç®—softmax">ç¬¬äº”æ­¥ï¼šè®¡ç®—softmax</h4><figure><img src="/img/nlp29_7.gif" alt="å¯¹æ³¨æ„åŠ›åˆ†æ•°è¿›è¡Œsoftmaxè¿ç®—" /><figcaption aria-hidden="true">å¯¹æ³¨æ„åŠ›åˆ†æ•°è¿›è¡Œsoftmaxè¿ç®—</figcaption></figure><p>å¯¹è¿™äº›æ³¨æ„åŠ›åˆ†æ•°è¿›è¡Œsoftmaxå‡½æ•°è¿ç®—ï¼ˆè“è‰²éƒ¨åˆ†ï¼‰ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">softmax</span>([<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>]) =<span class="hljs-meta"> [0.0, 0.5, 0.5]</span><br></code></pre></td></tr></table></figure><h4 id="ç¬¬å…­æ­¥-å°†åˆ†æ•°ä¹˜ä»¥values">ç¬¬å…­æ­¥ï¼š å°†åˆ†æ•°ä¹˜ä»¥values</h4><figure><img src="/img/nlp29_8.gif"alt="å°†valueï¼ˆç´«è‰²ï¼‰å’Œscoreï¼ˆè“è‰²ï¼‰ç›¸ä¹˜å¾—åˆ°æƒé‡åŒ–valueçš„è¡¨ç¤º" /><figcaptionaria-hidden="true">å°†valueï¼ˆç´«è‰²ï¼‰å’Œscoreï¼ˆè“è‰²ï¼‰ç›¸ä¹˜å¾—åˆ°æƒé‡åŒ–valueçš„è¡¨ç¤º</figcaption></figure><p>å°†æ¯ä¸ªè¾“å…¥ï¼ˆç»¿è‰²ï¼‰çš„softmaxä½œç”¨åçš„æ³¨æ„åŠ›åˆ†æ•°ä¹˜ä»¥å„è‡ªå¯¹åº”çš„<code>value</code>ï¼ˆç´«è‰²ï¼‰ã€‚è¿™ä¼šäº§ç”Ÿ3ä¸ªå‘é‡ï¼ˆé»„è‰²ï¼‰ã€‚åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬ç§°ä½œ<code>æƒé‡åŒ–value</code>ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>: <span class="hljs-number">0</span>.<span class="hljs-number">0</span> *<span class="hljs-meta"> [1, 2, 3] = [0.0, 0.0, 0.0]</span><br><span class="hljs-attribute">2</span>: <span class="hljs-number">0</span>.<span class="hljs-number">5</span> *<span class="hljs-meta"> [2, 8, 0] = [1.0, 4.0, 0.0]</span><br><span class="hljs-attribute">3</span>: <span class="hljs-number">0</span>.<span class="hljs-number">5</span> *<span class="hljs-meta"> [2, 6, 3] = [1.0, 3.0, 1.5]</span><br></code></pre></td></tr></table></figure><h4id="ç¬¬ä¸ƒæ­¥å¯¹æƒé‡åŒ–åçš„valuesæ±‚å’Œå¾—åˆ°è¾“å‡º1">ç¬¬ä¸ƒæ­¥ï¼šå¯¹æƒé‡åŒ–åçš„valuesæ±‚å’Œï¼Œå¾—åˆ°è¾“å‡º1</h4><figure><img src="/img/nlp29_9.gif" alt="å°†æƒé‡åvalueï¼ˆé»„è‰²ï¼‰ç›¸åŠ å¾—åˆ°è¾“å‡º1" /><figcaptionaria-hidden="true">å°†æƒé‡åvalueï¼ˆé»„è‰²ï¼‰ç›¸åŠ å¾—åˆ°è¾“å‡º1</figcaption></figure><p>å°†<code>æƒé‡åvalue</code>æŒ‰å…ƒç´ ç›¸åŠ å¾—åˆ°è¾“å‡º1ï¼š</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs excel">  [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]<br>+ [<span class="hljs-number">1.0</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">0.0</span>]<br>+ [<span class="hljs-number">1.0</span>, <span class="hljs-number">3.0</span>, <span class="hljs-number">1.5</span>]<br>-----------------<br>= [<span class="hljs-number">2.0</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">1.5</span>]<br></code></pre></td></tr></table></figure><p>äº§ç”Ÿçš„å‘é‡[2.0, 7.0,1.5]ï¼ˆæš—ç»¿è‰²ï¼‰å°±æ˜¯è¾“å‡º1ï¼Œè¿™æ˜¯åŸºäºè¾“å…¥1çš„<code>query</code>è¡¨ç¤ºä¸å…¶å®ƒçš„<code>keys</code>ï¼ŒåŒ…æ‹¬å®ƒè‡ªèº«çš„<code>key</code>äº’ç›¸ä½œç”¨çš„ç»“æœã€‚</p><h4 id="ç¬¬å…«æ­¥å¯¹è¾“å…¥23é‡å¤ç¬¬4-7æ­¥">ç¬¬å…«æ­¥ï¼šå¯¹è¾“å…¥2ã€3ï¼Œé‡å¤ç¬¬4-7æ­¥</h4><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»å®Œæˆäº†è¾“å…¥1ï¼Œæˆ‘ä»¬é‡å¤æ­¥éª¤4-7èƒ½å¾—åˆ°è¾“å‡º2å’Œ3ã€‚è¿™ä¸ªå¯ä»¥ç•™ç»™è¯»è€…è‡ªå·±å°è¯•ï¼Œç›¸ä¿¡èªæ˜çš„ä½ å¯ä»¥åšå‡ºæ¥ã€‚</p><figure><img src="/img/nlp29_10.gif" alt="é‡å¤ä¹‹å‰çš„æ­¥éª¤ï¼Œå¾—åˆ°è¾“å‡º2å’Œ3" /><figcaption aria-hidden="true">é‡å¤ä¹‹å‰çš„æ­¥éª¤ï¼Œå¾—åˆ°è¾“å‡º2å’Œ3</figcaption></figure><h3 id="ä»£ç ">ä»£ç </h3><p>è¿™é‡Œæœ‰PyTorchçš„å®ç°ä»£ç ï¼ŒPyTorchæ˜¯ä¸€ä¸ªä¸»æµçš„Pythonæ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚ä¸ºäº†èƒ½å¤Ÿå¾ˆå¥½åœ°ä½¿ç”¨ä»£ç ç‰‡æ®µä¸­çš„<code>@</code>è¿ç®—ç¬¦,<code>.T</code> and <code>None</code>æ“ä½œï¼Œè¯·ç¡®ä¿Pythonâ‰¥3.6ï¼ŒPyTorchâ‰¥1.3.1ã€‚</p><h4 id="å‡†å¤‡è¾“å…¥">1. å‡†å¤‡è¾“å…¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>x = [<br>  [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], <span class="hljs-comment"># Input 1</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>], <span class="hljs-comment"># Input 2</span><br>  [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]  <span class="hljs-comment"># Input 3</span><br> ]<br>x = torch.tensor(x, dtype=torch.float32)<br></code></pre></td></tr></table></figure><h4 id="åˆå§‹åŒ–æƒé‡">2. åˆå§‹åŒ–æƒé‡</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">w_key = [<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],<br>  [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],<br>  [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>]<br>w_query = [<br>  [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],<br>  [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]<br>]<br>w_value = [<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>],<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>],<br>  [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>],<br>  [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>]<br>w_key = torch.tensor(w_key, dtype=torch.float32)<br>w_query = torch.tensor(w_query, dtype=torch.float32)<br>w_value = torch.tensor(w_value, dtype=torch.float32)<br></code></pre></td></tr></table></figure><h4 id="è·å–keyqueryå’Œvalue">3.è·å–<code>key</code>ï¼Œ<code>query</code>å’Œ<code>value</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>keys = x @ w_key<br>querys = x @ w_query<br>values = x @ w_value<br><br><span class="hljs-built_in">print</span>(keys)<br><span class="hljs-comment"># tensor([[0., 1., 1.],</span><br><span class="hljs-comment">#         [4., 4., 0.],</span><br><span class="hljs-comment">#         [2., 3., 1.]])</span><br><br><span class="hljs-built_in">print</span>(querys)<br><span class="hljs-comment"># tensor([[1., 0., 2.],</span><br><span class="hljs-comment">#         [2., 2., 2.],</span><br><span class="hljs-comment">#         [2., 1., 3.]])</span><br><br><span class="hljs-built_in">print</span>(values)<br><span class="hljs-comment"># tensor([[1., 2., 3.],</span><br><span class="hljs-comment">#         [2., 8., 0.],</span><br><span class="hljs-comment">#         [2., 6., 3.]])</span><br></code></pre></td></tr></table></figure><h4 id="ä¸ºç¬¬1ä¸ªè¾“å…¥è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°">4. ä¸ºç¬¬1ä¸ªè¾“å…¥è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°</h4><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">attn_scores = querys @ keys.T<br><br># tensor([[ <span class="hljs-number">2.</span>,  <span class="hljs-number">4.</span>,  <span class="hljs-number">4.</span>],  # attention scores <span class="hljs-keyword">from</span> Query <span class="hljs-number">1</span><br>#         [ <span class="hljs-number">4.</span>, <span class="hljs-number">16.</span>, <span class="hljs-number">12.</span>],  # attention scores <span class="hljs-keyword">from</span> Query <span class="hljs-number">2</span><br>#         [ <span class="hljs-number">4.</span>, <span class="hljs-number">12.</span>, <span class="hljs-number">10.</span>]]) # attention scores <span class="hljs-keyword">from</span> Query <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h4 id="è®¡ç®—softmax">5. è®¡ç®—softmax</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.nn.functional <span class="hljs-keyword">import</span> softmax<br><br>attn_scores_softmax = softmax(attn_scores, dim=-<span class="hljs-number">1</span>)<br><span class="hljs-comment"># tensor([[6.3379e-02, 4.6831e-01, 4.6831e-01],</span><br><span class="hljs-comment">#         [6.0337e-06, 9.8201e-01, 1.7986e-02],</span><br><span class="hljs-comment">#         [2.9539e-04, 8.8054e-01, 1.1917e-01]])</span><br><br><span class="hljs-comment"># For readability, approximate the above as follows</span><br>attn_scores_softmax = [<br>  [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>],<br>  [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>],<br>  [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.9</span>, <span class="hljs-number">0.1</span>]<br>]<br>attn_scores_softmax = torch.tensor(attn_scores_softmax)<br></code></pre></td></tr></table></figure><h4 id="å°†åˆ†æ•°ä¹˜ä»¥values">6. å°†åˆ†æ•°ä¹˜ä»¥values</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">weighted_values = values[:,<span class="hljs-literal">None</span>] * attn_scores_softmax.T[:,:,<span class="hljs-literal">None</span>]<br><br><span class="hljs-comment"># tensor([[[0.0000, 0.0000, 0.0000],</span><br><span class="hljs-comment">#          [0.0000, 0.0000, 0.0000],</span><br><span class="hljs-comment">#          [0.0000, 0.0000, 0.0000]],</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment">#         [[1.0000, 4.0000, 0.0000],</span><br><span class="hljs-comment">#          [2.0000, 8.0000, 0.0000],</span><br><span class="hljs-comment">#          [1.8000, 7.2000, 0.0000]],</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment">#         [[1.0000, 3.0000, 1.5000],</span><br><span class="hljs-comment">#          [0.0000, 0.0000, 0.0000],</span><br><span class="hljs-comment">#          [0.2000, 0.6000, 0.3000]]])</span><br></code></pre></td></tr></table></figure><h4 id="å¯¹æƒé‡åŒ–åçš„valuesæ±‚å’Œå¾—åˆ°è¾“å‡º">7.å¯¹æƒé‡åŒ–åçš„valuesæ±‚å’Œï¼Œå¾—åˆ°è¾“å‡º</h4><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gcode">outputs = weighted_values.sum<span class="hljs-comment">(dim=0)</span><br><br><span class="hljs-attr"># tensor([[2</span><span class="hljs-number">.0000</span>, <span class="hljs-number">7.0000</span>, <span class="hljs-number">1.5000</span>],  <span class="hljs-attr"># Output 1</span><br><span class="hljs-attr">#         [2</span><span class="hljs-number">.0000</span>, <span class="hljs-number">8.0000</span>, <span class="hljs-number">0.0000</span>],  <span class="hljs-attr"># Output 2</span><br><span class="hljs-attr">#         [2</span><span class="hljs-number">.0000</span>, <span class="hljs-number">7.8000</span>, <span class="hljs-number">0.3000</span>]]) <span class="hljs-attr"># Output 3</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šPyTorchå·²ç»æä¾›äº†è¿™ä¸ªAPIï¼Œåå­—ä¸º<code>nn.MultiheadAttention</code>ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªAPIéœ€è¦ä½ æä¾›PyTorchçš„Tensorå½¢å¼çš„keyï¼Œvalueï¼Œqueryã€‚è¿˜æœ‰ï¼Œè¿™ä¸ªæ¨¡å—çš„è¾“å‡ºä¼šç»å†ä¸€ä¸ªçº¿æ€§å˜æ¢ã€‚</p></blockquote><h3 id="è‡ªå·±å®ç°">è‡ªå·±å®ç°ï¼Ÿ</h3><p>ä»¥ä¸‹æ˜¯ç¬”è€…è‡ªå·±å†™çš„éƒ¨åˆ†ã€‚</p><p>å¯¹äºä¸ç†Ÿæ‚‰PyTorchçš„è¯»è€…æ¥è¯´ï¼Œä¸Šè¿°çš„å‘é‡æ“ä½œç†è§£èµ·æ¥æœ‰ç‚¹å›°éš¾ï¼Œå› æ­¤ï¼Œç¬”è€…è‡ªå·±ç”¨ç®€å•çš„Pythonä»£ç å®ç°äº†ä¸€éä¸Šè¿°Self-Attentionçš„è¿‡ç¨‹ã€‚</p><p>å®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><br>x = [[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], <span class="hljs-comment"># Input 1</span><br>     [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>], <span class="hljs-comment"># Input 2</span><br>     [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]  <span class="hljs-comment"># Input 3</span><br>    ]<br><br>w_key = [[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],<br>        [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],<br>        [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],<br>        [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>        ]<br><br>w_query = [[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],<br>            [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>            [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],<br>            [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]<br>          ]<br><br>w_value = [[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>],<br>            [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>],<br>            [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>],<br>            [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>          ]<br><br><br><span class="hljs-comment"># vector dot of two vectors</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">vector_dot</span>(<span class="hljs-params">list1: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">int</span>], list2: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">float</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">int</span>:<br>    dot_sum = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> element_i, element_j <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(list1, list2):<br>        dot_sum += element_i * element_j<br><br>    <span class="hljs-keyword">return</span> dot_sum<br><br><br><span class="hljs-comment"># get weights matrix by x, using matrix multiplication</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weights_matrix_by_x</span>(<span class="hljs-params">x, weight_matrix</span>):<br>    x_matrix = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x)):<br>        x_row = []<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(weight_matrix[<span class="hljs-number">0</span>])):<br>            x_row.append(vector_dot(x[i], [_[j] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> weight_matrix]))<br><br>        x_matrix.append(x_row)<br><br>    <span class="hljs-keyword">return</span> x_matrix<br><br><br><span class="hljs-comment"># softmax function</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">softmax</span>(<span class="hljs-params">x: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">int</span>]:<br>    x_sum = <span class="hljs-built_in">sum</span>([math.exp(_) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> x])<br>    <span class="hljs-keyword">return</span> [math.exp(_)/x_sum <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> x]<br><br><br>x_key = get_weights_matrix_by_x(x, w_key)<br>x_value = get_weights_matrix_by_x(x, w_value)<br>x_query = get_weights_matrix_by_x(x, w_query)<br><span class="hljs-comment"># print(x_key)</span><br><span class="hljs-comment"># print(x_value)</span><br><span class="hljs-comment"># print(x_query)</span><br><br>outputs = []<br><span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> x_query:<br>    score_list = [vector_dot(query, key) <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> x_key]<br>    softmax_score_list = softmax(score_list)<br><br>    weights_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(softmax_score_list)):<br>        weights = [softmax_score_list[i] * _ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> x_value[i]]<br>        weights_list.append(weights)<br><br>    output = []<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(weights_list[<span class="hljs-number">0</span>])):<br>        output.append(<span class="hljs-built_in">sum</span>([_[j] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> weights_list]))<br><br>    outputs.append(output)<br><br>pprint(outputs)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-string">[[1.9366210616669624, 6.683105308334811, 1.5950684074995565],</span><br><span class="hljs-string"> [1.9999939663351456, 7.9639915951322156, 0.0539764053125496],</span><br><span class="hljs-string"> [1.9997046127769653, 7.759892254657784, 0.3583892946751152]]</span><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦è®²è¿°äº†å¦‚ä½•ä¸€æ­¥ä¸€æ­¥æ¥å®ç°Self-Attentionæœºåˆ¶ï¼Œå¯¹äºæƒ³è¦è‡ªå·±å®ç°ç®—æ³•çš„è¯»è€…æ¥è¯´ï¼Œå€¼å¾—ä¸€è¯»ã€‚</p><p>æœ¬æ–‡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>Self-Attention</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåå…«ï¼‰å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»</title>
    <link href="/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%85%AB%EF%BC%89%E5%A4%9A%E6%A0%87%E7%AD%BE%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <url>/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%85%AB%EF%BC%89%E5%A4%9A%E6%A0%87%E7%AD%BE%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šè®²è¿°å¦‚ä½•å®ç°å¤šæ ‡ç­¾æ–‡æœ¬åˆ†ç±»ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯å¤šæ ‡ç­¾åˆ†ç±»">ä»€ä¹ˆæ˜¯å¤šæ ‡ç­¾åˆ†ç±»ï¼Ÿ</h3><p>åœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ¥è§¦è¿‡äºŒåˆ†ç±»å’Œå¤šåˆ†ç±»é—®é¢˜äº†ã€‚æ‰€è°“äºŒï¼ˆå¤šï¼‰åˆ†ç±»é—®é¢˜ï¼ŒæŒ‡çš„æ˜¯yå€¼ä¸€å…±æœ‰ä¸¤ï¼ˆå¤šï¼‰ä¸ªç±»åˆ«ï¼Œæ¯ä¸ªæ ·æœ¬çš„yå€¼åªèƒ½å±äºå…¶ä¸­çš„ä¸€ä¸ªç±»åˆ«ã€‚å¯¹äºå¤šæ ‡ç­¾é—®é¢˜è€Œè¨€ï¼Œæ¯ä¸ªæ ·æœ¬çš„yå€¼å¯èƒ½ä¸ä»…ä»…å±äºä¸€ä¸ªç±»åˆ«ã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¹³æ—¶åœ¨ç»™æ–°é—»è´´æ ‡ç­¾çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½æŠŠä¸€ç¯‡æ–‡ç« åˆ†ä¸ºç»æµå’Œæ–‡åŒ–ä¸¤ä¸ªç±»åˆ«ã€‚å› æ­¤ï¼Œå¤šæ ‡ç­¾é—®é¢˜åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ã€‚</p><p>å¯¹äºå¤šæ ‡ç­¾é—®é¢˜ï¼Œä¸šç•Œè¿˜æ²¡æœ‰å¾ˆæˆç†Ÿçš„è§£å†³æ–¹æ³•ï¼Œä¸»è¦æ˜¯å› ä¸ºæ ‡ç­¾ä¹‹é—´å¯èƒ½ä¼šå­˜åœ¨å¤æ‚çš„ä¾èµ–å…³ç³»ï¼Œè¿™ç§ä¾èµ–å…³ç³»ç°é˜¶æ®µè¿˜æ²¡æœ‰æˆç†Ÿçš„æ¨¡å‹æ¥è§£å†³ã€‚æˆ‘ä»¬åœ¨è§£å†³å¤šæ ‡ç­¾é—®é¢˜çš„æ—¶å€™ï¼Œä¸€ç§åŠæ³•æ˜¯è®¤ä¸ºæ ‡ç­¾ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œç„¶åæŠŠè¯¥é—®é¢˜è½¬åŒ–ä¸ºæˆ‘ä»¬ç†Ÿæ‚‰çš„äºŒï¼ˆå¤šï¼‰åˆ†ç±»é—®é¢˜ã€‚</p><p>æœ¬æ–‡ä»¥ <ahref="https://aistudio.baidu.com/aistudio/competition/detail/32?isFromCcf=true">2020è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›ï¼šäº‹ä»¶æŠ½å–ä»»åŠ¡</a>ä¸­çš„æ•°æ®ä½œä¸ºå¤šåˆ†ç±»æ ‡ç­¾çš„æ ·ä¾‹æ•°æ®ï¼Œå€ŸåŠ©å¤šæ ‡ç­¾åˆ†ç±»æ¨¡å‹æ¥è§£å†³ã€‚</p><p>æ•´ä¸ªé¡¹ç›®çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="/img/nlp28_1.png" alt="é¡¹ç›®ç»“æ„å›¾" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„å›¾</figcaption></figure><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ ·ä¾‹æ•°æ®ã€‚</p><h3 id="æ•°æ®åˆ†æ">æ•°æ®åˆ†æ</h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ ·ä¾‹æ•°æ®çš„å‡ ä¸ªä¾‹å­ï¼š</p><blockquote><p>å¸æ³•è¡Œä¸º-èµ·è¯‰|ç»„ç»‡å…³ç³»-è£å‘˜æœ€è¿‘ï¼Œä¸€ä½å‰ä¾¿åˆ©èœ‚å‘˜å·¥å°±å› å…¬å¸è¿è§„è£å‘˜ï¼Œå°†ä¾¿åˆ©èœ‚æ‰€åœ¨çš„å…¬å¸è™«æç§‘æŠ€ï¼ˆåŒ—äº¬ï¼‰æœ‰é™å…¬å¸å‘Šä¸Šæ³•åº­ã€‚ç»„ç»‡å…³ç³»-è£å‘˜ æ€ç§‘ä¸Šæµ·å¤§è§„æ¨¡è£å‘˜äººå‡å¯è·èµ”100ä¸‡å®˜æ–¹æ¾„æ¸…äº‹å®ç»„ç»‡å…³ç³»-è£å‘˜ æ—¥æœ¬å·¨å¤´é¢ä¸´å±æœºï¼Œå·²è£å‘˜1000å¤šäººï¼Œè‹¹æœä¹Ÿæ•‘ä¸äº†å®ƒï¼ç»„ç»‡å…³ç³»-è£å‘˜|ç»„ç»‡å…³ç³»-è§£æ•£åœ¨ç¡…è°·é•€é‡‘å¤±è´¥çš„é€ è½¦æ–°åŠ¿åŠ›ä»¬ï¼šè”šæ¥è£å‘˜ã€å¥‡ç‚¹è¢«å·çªƒã€æ‹œè…¾è§£æ•£</p></blockquote><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒåŒæ ·çš„æè¿°æ–‡æœ¬ï¼Œæœ‰å¯èƒ½ä¼šå±äºå¤šä¸ªäº‹ä»¶ç±»å‹ã€‚æ¯”å¦‚ä¸Šé¢çš„<code>åœ¨ç¡…è°·é•€é‡‘å¤±è´¥çš„é€ è½¦æ–°åŠ¿åŠ›ä»¬ï¼šè”šæ¥è£å‘˜ã€å¥‡ç‚¹è¢«å·çªƒã€æ‹œè…¾è§£æ•£</code>ï¼Œè¯¥å¥è¯ä¸­åŒ…å«äº†<code>ç»„ç»‡å…³ç³»-è£å‘˜</code>å’Œ<code>ç»„ç»‡å…³ç³»-è§£æ•£</code>ä¸¤ä¸ªäº‹ä»¶ç±»å‹ã€‚</p><p>è¯¥æ•°æ®é›†ä¸­çš„è®­ç»ƒé›†ä¸€å…±æœ‰11958ä¸ªæ ·æœ¬ï¼Œ65ä¸ªäº‹ä»¶ç±»å‹ï¼Œæˆ‘ä»¬å¯¹è¯¥è®­ç»ƒé›†è¿›è¡Œç®€å•çš„æ•°æ®åˆ†æï¼Œæ¥çœ‹çœ‹å¤šäº‹ä»¶ç±»å‹çš„ä¸ªæ•°å’Œå æ¯”ï¼Œä»¥åŠæ¯ä¸ªäº‹ä»¶ç±»å‹çš„æ•°é‡ã€‚æ•°æ®åˆ†æçš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-04-09 21:31</span><br><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./data/multi-classification-train.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br><span class="hljs-comment"># æ¯ä¸ªäº‹ä»¶ç±»å‹çš„æ•°é‡ç»Ÿè®¡</span><br>event_type_count_dict = defaultdict(<span class="hljs-built_in">int</span>)<br><br><span class="hljs-comment"># å¤šäº‹ä»¶ç±»å‹æ•°é‡</span><br>multi_event_type_cnt = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> content:<br>    <span class="hljs-comment"># äº‹ä»¶ç±»å‹</span><br>    event_types = line.split(<span class="hljs-string">&quot; &quot;</span>, maxsplit=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br><br>    <span class="hljs-comment"># å¦‚æœ|åœ¨äº‹ä»¶ç±»å‹ä¸­ï¼Œåˆ™ä¸ºå¤šäº‹ä»¶ç±»å‹</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;|&quot;</span> <span class="hljs-keyword">in</span> event_types:<br>        multi_event_type_cnt += <span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># å¯¹åº”çš„æ¯ä¸ªäº‹ä»¶ç±»å‹æ•°é‡åŠ 1</span><br>    <span class="hljs-keyword">for</span> event_type <span class="hljs-keyword">in</span> event_types.split(<span class="hljs-string">&quot;|&quot;</span>):<br>        event_type_count_dict[event_type] += <span class="hljs-number">1</span><br><br><br><span class="hljs-comment"># è¾“å‡ºç»“æœ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¤šäº‹ä»¶ç±»å‹çš„æ ·æœ¬å…±æœ‰%dä¸ªï¼Œå æ¯”ä¸º%.4fã€‚&quot;</span> %(multi_event_type_cnt, multi_event_type_cnt/<span class="hljs-built_in">len</span>(content)))<br><br>pprint(event_type_count_dict)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">å¤šäº‹ä»¶ç±»å‹çš„æ ·æœ¬å…±æœ‰<span class="hljs-number">1121</span>ä¸ªï¼Œå æ¯”ä¸º<span class="hljs-number">0.0937</span>ã€‚<br>defaultdict(&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;int&#x27;</span>&gt;,<br>            &#123;<span class="hljs-string">&#x27;äº¤å¾€-ä¼šè§&#x27;</span>: <span class="hljs-number">98</span>,<br>             <span class="hljs-string">&#x27;äº¤å¾€-æ„Ÿè°¢&#x27;</span>: <span class="hljs-number">63</span>,<br>             <span class="hljs-string">&#x27;äº¤å¾€-æ¢ç­&#x27;</span>: <span class="hljs-number">69</span>,<br>             <span class="hljs-string">&#x27;äº¤å¾€-ç‚¹èµ&#x27;</span>: <span class="hljs-number">95</span>,<br>             <span class="hljs-string">&#x27;äº¤å¾€-é“æ­‰&#x27;</span>: <span class="hljs-number">149</span>,<br>             <span class="hljs-string">&#x27;äº§å“è¡Œä¸º-ä¸Šæ˜ &#x27;</span>: <span class="hljs-number">286</span>,<br>             <span class="hljs-string">&#x27;äº§å“è¡Œä¸º-ä¸‹æ¶&#x27;</span>: <span class="hljs-number">188</span>,<br>             <span class="hljs-string">&#x27;äº§å“è¡Œä¸º-å‘å¸ƒ&#x27;</span>: <span class="hljs-number">1196</span>,<br>             <span class="hljs-string">&#x27;äº§å“è¡Œä¸º-å¬å›&#x27;</span>: <span class="hljs-number">287</span>,<br>             <span class="hljs-string">&#x27;äº§å“è¡Œä¸º-è·å¥–&#x27;</span>: <span class="hljs-number">139</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-äº§å­/å¥³&#x27;</span>: <span class="hljs-number">106</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-å‡ºè½¨&#x27;</span>: <span class="hljs-number">32</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-åˆ†æ‰‹&#x27;</span>: <span class="hljs-number">118</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-å¤±è”&#x27;</span>: <span class="hljs-number">105</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-å©šç¤¼&#x27;</span>: <span class="hljs-number">59</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-åº†ç”Ÿ&#x27;</span>: <span class="hljs-number">133</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-æ€€å­•&#x27;</span>: <span class="hljs-number">65</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-æ­»äº¡&#x27;</span>: <span class="hljs-number">811</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-æ±‚å©š&#x27;</span>: <span class="hljs-number">76</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-ç¦»å©š&#x27;</span>: <span class="hljs-number">268</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-ç»“å©š&#x27;</span>: <span class="hljs-number">294</span>,<br>             <span class="hljs-string">&#x27;äººç”Ÿ-è®¢å©š&#x27;</span>: <span class="hljs-number">62</span>,<br>             <span class="hljs-string">&#x27;å¸æ³•è¡Œä¸º-ä¸¾æŠ¥&#x27;</span>: <span class="hljs-number">98</span>,<br>             <span class="hljs-string">&#x27;å¸æ³•è¡Œä¸º-å…¥ç‹±&#x27;</span>: <span class="hljs-number">155</span>,<br>             <span class="hljs-string">&#x27;å¸æ³•è¡Œä¸º-å¼€åº­&#x27;</span>: <span class="hljs-number">105</span>,<br>             <span class="hljs-string">&#x27;å¸æ³•è¡Œä¸º-æ‹˜æ•&#x27;</span>: <span class="hljs-number">712</span>,<br>             <span class="hljs-string">&#x27;å¸æ³•è¡Œä¸º-ç«‹æ¡ˆ&#x27;</span>: <span class="hljs-number">82</span>,<br>             <span class="hljs-string">&#x27;å¸æ³•è¡Œä¸º-çº¦è°ˆ&#x27;</span>: <span class="hljs-number">266</span>,<br>             <span class="hljs-string">&#x27;å¸æ³•è¡Œä¸º-ç½šæ¬¾&#x27;</span>: <span class="hljs-number">224</span>,<br>             <span class="hljs-string">&#x27;å¸æ³•è¡Œä¸º-èµ·è¯‰&#x27;</span>: <span class="hljs-number">174</span>,<br>             <span class="hljs-string">&#x27;ç¾å®³/æ„å¤–-åœ°éœ‡&#x27;</span>: <span class="hljs-number">119</span>,<br>             <span class="hljs-string">&#x27;ç¾å®³/æ„å¤–-å/å®å¡Œ&#x27;</span>: <span class="hljs-number">80</span>,<br>             <span class="hljs-string">&#x27;ç¾å®³/æ„å¤–-å æœº&#x27;</span>: <span class="hljs-number">104</span>,<br>             <span class="hljs-string">&#x27;ç¾å®³/æ„å¤–-æ´ªç¾&#x27;</span>: <span class="hljs-number">48</span>,<br>             <span class="hljs-string">&#x27;ç¾å®³/æ„å¤–-çˆ†ç‚¸&#x27;</span>: <span class="hljs-number">73</span>,<br>             <span class="hljs-string">&#x27;ç¾å®³/æ„å¤–-è¢­å‡»&#x27;</span>: <span class="hljs-number">117</span>,<br>             <span class="hljs-string">&#x27;ç¾å®³/æ„å¤–-èµ·ç«&#x27;</span>: <span class="hljs-number">204</span>,<br>             <span class="hljs-string">&#x27;ç¾å®³/æ„å¤–-è½¦ç¥¸&#x27;</span>: <span class="hljs-number">286</span>,<br>             <span class="hljs-string">&#x27;ç«èµ›è¡Œä¸º-å¤ºå† &#x27;</span>: <span class="hljs-number">430</span>,<br>             <span class="hljs-string">&#x27;ç«èµ›è¡Œä¸º-æ™‹çº§&#x27;</span>: <span class="hljs-number">302</span>,<br>             <span class="hljs-string">&#x27;ç«èµ›è¡Œä¸º-ç¦èµ›&#x27;</span>: <span class="hljs-number">135</span>,<br>             <span class="hljs-string">&#x27;ç«èµ›è¡Œä¸º-èƒœè´Ÿ&#x27;</span>: <span class="hljs-number">1663</span>,<br>             <span class="hljs-string">&#x27;ç«èµ›è¡Œä¸º-é€€å½¹&#x27;</span>: <span class="hljs-number">95</span>,<br>             <span class="hljs-string">&#x27;ç«èµ›è¡Œä¸º-é€€èµ›&#x27;</span>: <span class="hljs-number">141</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡å…³ç³»-åœèŒ&#x27;</span>: <span class="hljs-number">87</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡å…³ç³»-åŠ ç›Ÿ&#x27;</span>: <span class="hljs-number">335</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡å…³ç³»-è£å‘˜&#x27;</span>: <span class="hljs-number">142</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡å…³ç³»-è§£æ•£&#x27;</span>: <span class="hljs-number">81</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡å…³ç³»-è§£çº¦&#x27;</span>: <span class="hljs-number">45</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡å…³ç³»-è§£é›‡&#x27;</span>: <span class="hljs-number">93</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡å…³ç³»-è¾/ç¦»èŒ&#x27;</span>: <span class="hljs-number">580</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡å…³ç³»-é€€å‡º&#x27;</span>: <span class="hljs-number">183</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡è¡Œä¸º-å¼€å¹•&#x27;</span>: <span class="hljs-number">251</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡è¡Œä¸º-æ¸¸è¡Œ&#x27;</span>: <span class="hljs-number">73</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡è¡Œä¸º-ç½¢å·¥&#x27;</span>: <span class="hljs-number">63</span>,<br>             <span class="hljs-string">&#x27;ç»„ç»‡è¡Œä¸º-é—­å¹•&#x27;</span>: <span class="hljs-number">59</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-ä¸Šå¸‚&#x27;</span>: <span class="hljs-number">51</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-å‡ºå”®/æ”¶è´­&#x27;</span>: <span class="hljs-number">181</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-åŠ æ¯&#x27;</span>: <span class="hljs-number">24</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-æ¶¨ä»·&#x27;</span>: <span class="hljs-number">58</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-æ¶¨åœ&#x27;</span>: <span class="hljs-number">219</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-èèµ„&#x27;</span>: <span class="hljs-number">116</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-è·Œåœ&#x27;</span>: <span class="hljs-number">102</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-é™ä»·&#x27;</span>: <span class="hljs-number">78</span>,<br>             <span class="hljs-string">&#x27;è´¢ç»/äº¤æ˜“-é™æ¯&#x27;</span>: <span class="hljs-number">28</span>&#125;)<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>æˆ‘ä»¬åˆ©ç”¨sklearnæ¨¡å—ä¸­çš„MultiLabelBinarizerè¿›è¡Œå¤šæ ‡ç­¾ç¼–ç ï¼Œå¦‚æœæ–‡æœ¬æ‰€å¯¹åº”çš„äº‹ä»¶ç±»å‹å­˜åœ¨ï¼Œåˆ™å°†è¯¥ä½ç½®çš„å…ƒç´ ç½®ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚å› æ­¤ï¼Œyå€¼ä¸º65ç»´çš„å‘é‡ï¼Œå…¶ä¸­1ä¸ªæˆ–å¤šä¸ªä¸º1ï¼Œæ˜¯è¯¥æ–‡æœ¬ï¼ˆxå€¼ï¼‰å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ç±»å‹ã€‚</p><p>æˆ‘ä»¬é‡‡ç”¨ALBERTå¯¹æ–‡æœ¬è¿›è¡Œç‰¹å¾æå–ï¼Œæœ€å¤§æ–‡æœ¬é•¿åº¦ä¸º200ï¼Œé‡‡ç”¨çš„æ·±åº¦å­¦ä¹ æ¨¡å‹å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp28_2.png" alt="æ·±åº¦å­¦ä¹ æ¨¡å‹" /><figcaption aria-hidden="true">æ·±åº¦å­¦ä¹ æ¨¡å‹</figcaption></figure><p>æ¨¡å‹è®­ç»ƒçš„è„šæœ¬ï¼ˆmodel_trian.pyï¼‰çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-04-03 18:12</span><br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> MultiLabelBinarizer<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.optimizers <span class="hljs-keyword">import</span> Adam<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Input, Dense<br><span class="hljs-keyword">from</span> att <span class="hljs-keyword">import</span> Attention<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> GRU, Bidirectional<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./data/multi-classification-train.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    train_content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./data/multi-classification-test.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    test_content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br><span class="hljs-comment"># è·å–è®­ç»ƒé›†åˆã€æµ‹è¯•é›†çš„äº‹ä»¶ç±»å‹</span><br>movie_genres = []<br><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> train_content+test_content:<br>    genres = line.split(<span class="hljs-string">&quot; &quot;</span>, maxsplit=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>].split(<span class="hljs-string">&quot;|&quot;</span>)<br>    movie_genres.append(genres)<br><br><span class="hljs-comment"># åˆ©ç”¨sklearnä¸­çš„MultiLabelBinarizerè¿›è¡Œå¤šæ ‡ç­¾ç¼–ç </span><br>mlb = MultiLabelBinarizer()<br>mlb.fit(movie_genres)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸€å…±æœ‰%dç§äº‹ä»¶ç±»å‹ã€‚&quot;</span> % <span class="hljs-built_in">len</span>(mlb.classes_))<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;event_type.json&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> h:<br>    h.write(json.dumps(mlb.classes_.tolist(), ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">4</span>))<br><br><span class="hljs-comment"># å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ•°æ®è¿›è¡Œå¤šæ ‡ç­¾ç¼–ç </span><br>y_train = []<br>y_test = []<br><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> train_content:<br>    genres = line.split(<span class="hljs-string">&quot; &quot;</span>, maxsplit=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>].split(<span class="hljs-string">&quot;|&quot;</span>)<br>    y_train.append(mlb.transform([genres])[<span class="hljs-number">0</span>])<br><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> test_content:<br>    genres = line.split(<span class="hljs-string">&quot; &quot;</span>, maxsplit=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>].split(<span class="hljs-string">&quot;|&quot;</span>)<br>    y_test.append(mlb.transform([genres])[<span class="hljs-number">0</span>])<br><br>y_train = np.array(y_train)<br>y_test = np.array(y_test)<br><br><span class="hljs-built_in">print</span>(y_train.shape)<br><span class="hljs-built_in">print</span>(y_test.shape)<br><br><span class="hljs-comment"># åˆ©ç”¨ALBERTå¯¹xå€¼ï¼ˆæ–‡æœ¬ï¼‰è¿›è¡Œç¼–ç </span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;NONE&quot;</span>, max_seq_len=<span class="hljs-number">200</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;begin encoding&#x27;</span>)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br><br>x_train = []<br>x_test = []<br><br>process_bar = tqdm(train_content)<br><br><span class="hljs-keyword">for</span> ch, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(process_bar, train_content):<br>    movie_intro = line.split(<span class="hljs-string">&quot; &quot;</span>, maxsplit=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>]<br>    x_train.append(f(movie_intro))<br><br>process_bar = tqdm(test_content)<br><br><span class="hljs-keyword">for</span> ch, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(process_bar, test_content):<br>    movie_intro = line.split(<span class="hljs-string">&quot; &quot;</span>, maxsplit=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>]<br>    x_test.append(f(movie_intro))<br><br>x_train = np.array(x_train)<br>x_test = np.array(x_test)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;end encoding&quot;</span>)<br><span class="hljs-built_in">print</span>(x_train.shape)<br><br><br><span class="hljs-comment"># æ·±åº¦å­¦ä¹ æ¨¡å‹</span><br><span class="hljs-comment"># æ¨¡å‹ç»“æ„ï¼šALBERT + åŒå‘GRU + Attention + FC</span><br>inputs = Input(shape=(<span class="hljs-number">200</span>, <span class="hljs-number">312</span>, ), name=<span class="hljs-string">&quot;input&quot;</span>)<br>gru = Bidirectional(GRU(<span class="hljs-number">128</span>, dropout=<span class="hljs-number">0.2</span>, return_sequences=<span class="hljs-literal">True</span>), name=<span class="hljs-string">&quot;bi-gru&quot;</span>)(inputs)<br>attention = Attention(<span class="hljs-number">32</span>, name=<span class="hljs-string">&quot;attention&quot;</span>)(gru)<br>num_class = <span class="hljs-built_in">len</span>(mlb.classes_)<br>output = Dense(num_class, activation=<span class="hljs-string">&#x27;sigmoid&#x27;</span>, name=<span class="hljs-string">&quot;dense&quot;</span>)(attention)<br>model = Model(inputs, output)<br><br><span class="hljs-comment"># æ¨¡å‹å¯è§†åŒ–</span><br><span class="hljs-comment"># from keras.utils import plot_model</span><br><span class="hljs-comment"># plot_model(model, to_file=&#x27;multi-label-model.png&#x27;, show_shapes=True)</span><br><br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;binary_crossentropy&#x27;</span>,<br>              optimizer=Adam(),<br>              metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br>history = model.fit(x_train, y_train, validation_data=(x_test, y_test), batch_size=<span class="hljs-number">128</span>, epochs=<span class="hljs-number">10</span>)<br>model.save(<span class="hljs-string">&#x27;event_type.h5&#x27;</span>)<br><br><br><span class="hljs-comment"># è®­ç»ƒç»“æœå¯è§†åŒ–</span><br><span class="hljs-comment"># ç»˜åˆ¶losså’Œaccå›¾åƒ</span><br>plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>epochs = <span class="hljs-built_in">len</span>(history.history[<span class="hljs-string">&#x27;loss&#x27;</span>])<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;loss&#x27;</span>], label=<span class="hljs-string">&#x27;loss&#x27;</span>)<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;val_loss&#x27;</span>], label=<span class="hljs-string">&#x27;val_loss&#x27;</span>)<br>plt.legend()<br><br>plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>epochs = <span class="hljs-built_in">len</span>(history.history[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;accuracy&#x27;</span>], label=<span class="hljs-string">&#x27;acc&#x27;</span>)<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;val_accuracy&#x27;</span>], label=<span class="hljs-string">&#x27;val_acc&#x27;</span>)<br>plt.legend()<br>plt.savefig(<span class="hljs-string">&quot;loss_acc.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>è®­ç»ƒè¿‡ç¨‹è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs less">ä¸€å…±æœ‰<span class="hljs-number">65</span>ç§äº‹ä»¶ç±»å‹ã€‚<br>(<span class="hljs-number">11958</span>, <span class="hljs-number">65</span>)<br>(<span class="hljs-number">1498</span>, <span class="hljs-number">65</span>)<br><span class="hljs-selector-tag">I</span>:<span class="hljs-selector-tag">BERT_VEC</span>:<span class="hljs-selector-attr">[graph:opt:128]</span>:<span class="hljs-selector-tag">load</span> <span class="hljs-selector-tag">parameters</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">checkpoint</span>...<br><span class="hljs-selector-tag">I</span>:<span class="hljs-selector-tag">BERT_VEC</span>:<span class="hljs-selector-attr">[graph:opt:130]</span>:<span class="hljs-selector-tag">freeze</span>...<br><span class="hljs-selector-tag">I</span>:<span class="hljs-selector-tag">BERT_VEC</span>:<span class="hljs-selector-attr">[graph:opt:133]</span>:<span class="hljs-selector-tag">optimize</span>...<br><span class="hljs-selector-tag">I</span>:<span class="hljs-selector-tag">BERT_VEC</span>:<span class="hljs-selector-attr">[graph:opt:144]</span>:<span class="hljs-selector-tag">write</span> <span class="hljs-selector-tag">graph</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">tmp</span> <span class="hljs-selector-tag">file</span>: ./<span class="hljs-selector-tag">tmp_graph11</span><br><span class="hljs-number">100%</span>|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| <span class="hljs-number">11958</span>/<span class="hljs-number">11958</span> <span class="hljs-selector-attr">[02:47&lt;00:00, 71.39it/s]</span><br><span class="hljs-number">100%</span>|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| <span class="hljs-number">1498</span>/<span class="hljs-number">1498</span> <span class="hljs-selector-attr">[00:20&lt;00:00, 72.54it/s]</span><br><span class="hljs-selector-tag">end</span> <span class="hljs-selector-tag">encoding</span><br>(<span class="hljs-number">11958</span>, <span class="hljs-number">200</span>, <span class="hljs-number">312</span>)<br><span class="hljs-selector-tag">Train</span> <span class="hljs-selector-tag">on</span> <span class="hljs-number">11958</span> <span class="hljs-selector-tag">samples</span>, <span class="hljs-selector-tag">validate</span> <span class="hljs-selector-tag">on</span> <span class="hljs-number">1498</span> <span class="hljs-selector-tag">samples</span><br></code></pre></td></tr></table></figure><p>åœ¨æœ€ç»ˆçš„epochä¸Šï¼Œè®­ç»ƒé›†ä¸Šçš„acuuracyä¸º0.9966ï¼Œæµ‹è¯•é›†ä¸Šçš„acuuracyä¸º0.9964ã€‚è®­ç»ƒç»“æœçš„losså’Œaccæ›²çº¿å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp28_3.png" alt="æ¨¡å‹çš„è®­ç»ƒæ•ˆæœ" /><figcaption aria-hidden="true">æ¨¡å‹çš„è®­ç»ƒæ•ˆæœ</figcaption></figure><p>ä»ä¸Šè¿°ç»“æœçœ‹ï¼Œå¤šæ ‡ç­¾åˆ†ç±»çš„æ¨¡å‹æ•ˆæœè¿˜æ˜¯ç›¸å½“ä¸é”™çš„ã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æˆ‘ä»¬åˆ©ç”¨ä¸‹é¢çš„æ¨¡å‹é¢„æµ‹è„šæœ¬ï¼ˆmodel_predict.pyï¼‰å¯¹æ–°çš„æµ‹è¯•é›†æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œè„šæœ¬ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-04-03 21:50</span><br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><br><span class="hljs-keyword">from</span> att <span class="hljs-keyword">import</span> Attention<br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br>load_model = load_model(<span class="hljs-string">&quot;event_type.h5&quot;</span>, custom_objects=&#123;<span class="hljs-string">&quot;Attention&quot;</span>: Attention&#125;)<br><br><span class="hljs-comment"># é¢„æµ‹è¯­å¥</span><br>text = <span class="hljs-string">&quot;åŒ—äº¬æ—¶é—´6æœˆ7æ—¥ï¼Œä¸­å›½ç”·è¶³åœ¨å¹¿å·å¤©æ²³ä½“è‚²åœºä¸è²å¾‹å®¾è¿›è¡Œäº†ä¸€åœºçƒ­èº«èµ›ï¼Œæœ€ç»ˆå›½è¶³ä»¥2-0å‡»è´¥äº†å¯¹æ‰‹ï¼Œé‡Œçš®ä¹Ÿèµ¢å¾—äº†å†åº¦æ‰§æ•™å›½è¶³åçš„é¦–åœºæ¯”èµ›èƒœåˆ©ï¼&quot;</span><br>text = text.replace(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;\r&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;\t&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><br>labels = []<br><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;NONE&quot;</span>, max_seq_len=<span class="hljs-number">200</span>)<br><br><span class="hljs-comment"># å°†å¥å­è½¬æ¢æˆå‘é‡</span><br>vec = bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>x_train = np.array([vec])<br><br><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>predicted = load_model.predict(x_train)[<span class="hljs-number">0</span>]<br><br>indices = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(predicted)) <span class="hljs-keyword">if</span> predicted[i] &gt; <span class="hljs-number">0.5</span>]<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;event_type.json&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> g:<br>    movie_genres = json.loads(g.read())<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é¢„æµ‹è¯­å¥: %s&quot;</span> % text)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é¢„æµ‹äº‹ä»¶ç±»å‹: %s&quot;</span> % <span class="hljs-string">&quot;|&quot;</span>.join([movie_genres[index] <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> indices]))<br></code></pre></td></tr></table></figure><p>å…¶ä¸­çš„å‡ ä¸ªæ ·æœ¬çš„é¢„æµ‹ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>é¢„æµ‹è¯­å¥:åŒ—äº¬æ—¶é—´6æœˆ7æ—¥ï¼Œä¸­å›½ç”·è¶³åœ¨å¹¿å·å¤©æ²³ä½“è‚²åœºä¸è²å¾‹å®¾è¿›è¡Œäº†ä¸€åœºçƒ­èº«èµ›ï¼Œæœ€ç»ˆå›½è¶³ä»¥2-0å‡»è´¥äº†å¯¹æ‰‹ï¼Œé‡Œçš®ä¹Ÿèµ¢å¾—äº†å†åº¦æ‰§æ•™å›½è¶³åçš„é¦–åœºæ¯”èµ›èƒœåˆ©ï¼é¢„æµ‹äº‹ä»¶ç±»å‹: ç«èµ›è¡Œä¸º-èƒœè´Ÿ</p></blockquote><blockquote><p>é¢„æµ‹è¯­å¥: å·´è¥¿äºšé©¬å­™é›¨æ—å¤§ç«æŒç»­å¤šæ—¥ï¼Œå¼•å‘å…¨çƒå…³æ³¨ã€‚ é¢„æµ‹äº‹ä»¶ç±»å‹:ç¾å®³/æ„å¤–-èµ·ç«</p></blockquote><blockquote><p>é¢„æµ‹è¯­å¥: 19é‡ŒåŠ å¤§å¸ˆèµ›èµ„æ ¼èµ›å‰ä¸¤å¤©æˆ˜æŠ¥ä¸­å›½é€‰æ‰‹8äººæ™‹çº§6äººé­æ·˜æ±°2äººå¼ƒèµ› é¢„æµ‹äº‹ä»¶ç±»å‹: ç«èµ›è¡Œä¸º-æ™‹çº§</p></blockquote><blockquote><p>é¢„æµ‹è¯­å¥: æ—¥æœ¬ç”µè½¦å¡è½¦ç›¸æ’ï¼Œè½¦å¤´éƒ¨åˆ†è„±è½¨å¹¶å€¾æ–œï¼Œç°åœºèµ·ç«æµ“çƒŸæ»šæ»šé¢„æµ‹äº‹ä»¶ç±»å‹: ç¾å®³/æ„å¤–-è½¦ç¥¸</p></blockquote><blockquote><p>é¢„æµ‹è¯­å¥: æˆªæ­¢åˆ°11æ—¥13ï¼š30ï¼Œå› å°é£è‡´æµ™æ±Ÿ32äººæ­»äº¡ï¼Œ16äººå¤±è”ã€‚å…·ä½“å¦‚ä¸‹ï¼šæ°¸å˜‰å¿å²©å¦é•‡å±±æ—©æ‘23æ­»9å¤±è”ï¼Œä¹æ¸…6æ­»ï¼Œä¸´å®‰åŒºå²›çŸ³é•‡é“¶å‘æ‘3æ­»4å¤±è”ï¼Œä¸´æµ·å¸‚ä¸œå¡é•‡ç‹åŠ å±±æ‘3å¤±è”ã€‚é¢„æµ‹äº‹ä»¶ç±»å‹: äººç”Ÿ-å¤±è”|äººç”Ÿ-æ­»äº¡</p></blockquote><blockquote><p>é¢„æµ‹è¯­å¥: å®šä½Bç«¯åº”ç”¨ï¼ŒBeBopå‘å¸ƒQuestä¸“å±ç‰ˆæŸ”æ€§VRæ‰‹å¥— é¢„æµ‹äº‹ä»¶ç±»å‹:äº§å“è¡Œä¸º-å‘å¸ƒ</p></blockquote><blockquote><p>é¢„æµ‹è¯­å¥:8æœˆ17æ—¥ã€‚å‡Œæ™¨3ç‚¹20åˆ†å·¦å³ï¼Œæµå—æ¶ˆé˜²æ”¯é˜Ÿé¢†ç§€åŸä¸­é˜Ÿæ¥åˆ°æŒ‡æŒ¥ä¸­å¿ƒè°ƒåº¦å‘½ä»¤ï¼Œæµå—å¸‚ä¸­åŒºä¸­æµ·ç¯å®‡åŸå¾€å—æ–¹å‘å‘ç”Ÿè½¦ç¥¸ï¼Œæœ‰äººå‘˜è¢«å›°ã€‚é¢„æµ‹äº‹ä»¶ç±»å‹: ç¾å®³/æ„å¤–-è½¦ç¥¸</p></blockquote><blockquote><p>é¢„æµ‹è¯­å¥:æ³¨æ„ï¼æµå—å¯èƒ½æœ‰é›·ç”µäº‹æ•…ï½œè‹±æ‰å­¦é™¢14.9äº¿è¢«æ”¶è´­ï½œå…«é‡Œæ¡¥è”¬èœå¸‚åœºä»Šæ—¥æ‹†é™¤ï¼Œæœªæ¥å°†å»ºæ–°çš„å•†ä¸šç»¼åˆä½“é¢„æµ‹äº‹ä»¶ç±»å‹: è´¢ç»/äº¤æ˜“-å‡ºå”®/æ”¶è´­</p></blockquote><blockquote><p>é¢„æµ‹è¯­å¥:æ˜¨å¤©18ï¼š30ï¼Œé™•è¥¿å®å¼ºå¿èƒ¡å®¶åé•‡å‘å®¶æ²Ÿæ‘ä¸‰ç»„å‘ç”Ÿå±±ä½“åå¡Œï¼Œ5äººè¢«åŸ‹ã€‚å½“æ™šï¼Œ3äººè¢«æ•‘å‡ºï¼Œå…¶ä¸­1äººåœ¨åŒ»é™¢æŠ¢æ•‘æ— æ•ˆæ­»äº¡ï¼Œ2äººåœ¨é€åŒ»é€”ä¸­æ­»äº¡ã€‚ä»Šå¤©å‡Œæ™¨ï¼Œå¦å¤–2äººè¢«å‘ç°ï¼Œå·²æ— ç”Ÿå‘½è¿¹è±¡ã€‚é¢„æµ‹äº‹ä»¶ç±»å‹: äººç”Ÿ-æ­»äº¡|ç¾å®³/æ„å¤–-å/å®å¡Œ</p></blockquote><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®å·²ç»ä¸Šä¼ è‡³Githubé¡¹ç›®ï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/multi-label-classification-4-event-type">https://github.com/percent4/multi-label-classification-4-event-type</a>ã€‚</p><p>åç»­æœ‰æœºä¼šå†ç»™å¤§å®¶ä»‹ç»æ›´å¤šå¤šæ ‡ç­¾åˆ†ç±»ç›¸å…³çš„é—®é¢˜ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåä¸ƒï¼‰å¼€æ”¾é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•</title>
    <link href="/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%83%EF%BC%89%E5%BC%80%E6%94%BE%E9%A2%86%E5%9F%9F%E7%9A%84%E4%B8%89%E5%85%83%E7%BB%84%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%83%EF%BC%89%E5%BC%80%E6%94%BE%E9%A2%86%E5%9F%9F%E7%9A%84%E4%B8%89%E5%85%83%E7%BB%84%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å½“æˆ‘å†™ä¸‹è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘çš„å†…å¿ƒæ˜¯æ¿€åŠ¨çš„ï¼Œè¿™æ˜¯å› ä¸ºï¼Œè‡ªä»å»å¹´6æœˆä»½å†™äº†æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/%E5%88%A9%E7%94%A8%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E6%9E%84%E5%BB%BA%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/">åˆ©ç”¨å…³ç³»æŠ½å–æ„å»ºçŸ¥è¯†å›¾è°±çš„ä¸€æ¬¡å°è¯•</a>åï¼Œæˆ‘å°±ä¸€ç›´åœ¨è¯•å›¾å¯»æ‰¾ä¸€ç§åœ¨å¼€æ”¾é¢†åŸŸèƒ½å¤Ÿè¿›è¡Œä¸‰å…ƒç»„æŠ½å–çš„åŠæ³•ï¼Œä¹Ÿæœ‰å¾ˆå¤šè¯»è€…é—®è¿‡æˆ‘è¿™æ–¹é¢çš„é—®é¢˜ï¼Œä»Šå¤©ï¼Œç¬”è€…å°†ç»™å‡ºç­”å¤ï¼Œè™½ç„¶ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆï¼ˆç°åœ¨ä¹Ÿæ²¡æœ‰æ­£ç¡®ç­”æ¡ˆï¼‰ï¼Œä½†è‡³å°‘ï¼Œæˆ‘å†™ä¸‹äº†è‡ªå·±çš„ç­”æ¡ˆã€‚</p><p>ç¦»æˆ‘æƒ³å‡ºè¿™ä¸ªæŠ½å–ç³»ç»Ÿè™½ç„¶æ‰è¿‡å»ä¸ä¹…ï¼Œä½†æˆ‘çš„å¿ƒæƒ…ï¼Œå·²ç»ç”±å¼€å§‹çš„æ¿€åŠ¨ç‹‚å–œï¼Œè½¬åŒ–ä¸ºåæ¥çš„å¹³æ·¡ï¼Œç›´åˆ°ç°åœ¨çš„ä¸æ»¡ã€‚äº‹å®è¯æ˜ï¼Œå¼€æ”¾é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–å®åœ¨å¤ªéš¾ï¼Œä»¥ç¬”è€…ä¸ªäººçš„åŠªåŠ›å’Œæ™ºå•†ï¼Œå®åœ¨æ²¡æ³•ç»™å‡ºå®Œç¾çš„ç­”æ¡ˆï¼Œæ‰€ä»¥ï¼Œæ–‡ç« çš„é¢˜ç›®æ˜¯å°è¯•ï¼Œä»…ä»…ä½œä¸ºå°è¯•ï¼Œå¹¶ä¸èƒ½è§£å†³å¥½è¿™ä¸ªé—®é¢˜ã€‚ä½†ï¼Œæˆ‘è¿˜æ˜¯æƒ³å†™äº›ä»€ä¹ˆï¼Œå¸Œæœ›èƒ½å¤Ÿå¯¹ç¬”è€…æœ‰ä¸€ç‚¹ç‚¹å¯å‘ï¼ŒåŒæ—¶ï¼Œä¹Ÿæ˜¯å¯¹è‡ªå·±è¿‘åŠå¹´çš„æ¢å¯»åšä¸€ä¸ªæ€»ç»“ã€‚</p><p>å…³äºä¸‰å…ƒç»„æŠ½å–çš„åŸºæœ¬ä»‹ç»å’Œå¸¸ç”¨åŠæ³•ï¼Œç¬”è€…ä¹‹å‰å·²ç»åœ¨ä¸å°‘æ–‡ç« ä¸­æè¿°è¿‡ï¼Œè¿™é‡Œä¸å†è¿‡å¤šä»‹ç»ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/08/%E5%88%A9%E7%94%A8%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E6%9E%84%E5%BB%BA%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/">åˆ©ç”¨å…³ç³»æŠ½å–æ„å»ºçŸ¥è¯†å›¾è°±çš„ä¸€æ¬¡å°è¯•</a>å’Œ <ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%85%AD%EF%BC%89%E9%99%90%E5%AE%9A%E9%A2%86%E5%9F%9F%E7%9A%84%E4%B8%89%E5%85%83%E7%BB%84%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/">NLPï¼ˆäºŒåå…­ï¼‰é™å®šé¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•</a>ã€‚æœ¬æ–‡å°†ä¼šä»‹ç»ç¬”è€…åœ¨å¼€æ”¾é¢†åŸŸåšä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•ã€‚</p><p>æœ¬é¡¹ç›®å·²ç»å¼€æºè‡³Githubï¼Œæ–‡ç« æœ€åä¼šç»™å‡ºç›¸åº”çš„ç½‘å€ã€‚æœ¬é¡¹ç›®çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp27_1.png" alt="é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„</figcaption></figure><p>æœ¬é¡¹ç›®ä¸€å…±åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œä¸»è¦æ¨¡å—ä»‹ç»å¦‚ä¸‹ï¼š</p><ul><li><p>extract_example:åˆ©ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹åŸºæœ¬å°è¯´å’Œæ–°é—»è¿›è¡Œä¸‰å…ƒç»„æŠ½å–ï¼Œå½¢æˆçŸ¥è¯†å›¾è°±ä¾‹å­ï¼›</p></li><li><p>sequence_labelingï¼šè®­ç»ƒæ ‡æ³¨ï¼Œå¯¹æ ‡æ³¨çš„å®ä½“æ•°æ®è¿›è¡Œåºåˆ—æ ‡æ³¨ç®—æ³•è®­ç»ƒï¼›</p></li><li><p>spo_tagging_platformï¼šæ ‡æ³¨å¹³å°ï¼Œæ ‡æ³¨subjectï¼Œpredicateå’Œobjectä»¥åŠä¸‰å…ƒç»„æ˜¯å¦æœ‰æ•ˆï¼›</p></li><li><p>text_classificationï¼šæ–‡æœ¬åˆ†ç±»ï¼Œç”¨äºåˆ¤åˆ«æŠ½å–çš„ä¸‰å…ƒç»„æ˜¯å¦æœ‰æ•ˆã€‚</p><p>æœ¬é¡¹ç›®çš„æŠ½å–ç³»ç»Ÿæµç¨‹å›¾å¦‚ä¸‹ï¼š</p></li></ul><figure><img src="/img/nlp27_2.png" alt="æŠ½å–ç³»ç»Ÿæµç¨‹å›¾" /><figcaption aria-hidden="true">æŠ½å–ç³»ç»Ÿæµç¨‹å›¾</figcaption></figure><p>æ¥ä¸‹æ¥ç¬”è€…å°†é€ä¸€ä»‹ç»ã€‚</p><h3 id="æ ‡æ³¨å¹³å°">æ ‡æ³¨å¹³å°</h3><p>ç¬”è€…ç”¨tornadoæ­å»ºäº†ç®€æ˜“çš„æ ‡æ³¨å¹³å°ï¼Œåœ¨æ ‡æ³¨é¡µé¢ä¸­ï¼Œæ ‡æ³¨äººå‘˜éœ€è¦è¾“å…¥æ ‡æ³¨çš„å¥å­ï¼ˆå¥å­çº§åˆ«çš„æŠ½å–ï¼‰ä»¥åŠsubjectï¼Œpredicateï¼Œobjectï¼Œç‚¹å‡»â€œæ˜¾ç¤ºSPOâ€ï¼Œå°†æœ‰æ•ˆçš„ä¸‰å…ƒç»„æ ‡æ³¨ä¸º1ï¼Œæ— æ•ˆçš„ä¸‰å…ƒç»„æ ‡æ³¨ä¸º0ã€‚ä¹‹æ‰€ä»¥é‡‡å–è¿™ç§æ ‡æ³¨æ–¹æ³•ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨å¥å­ä¸­æ ‡æ³¨subjectï¼Œpredicateï¼Œobjectï¼Œè¿™äº›æ ‡æ³¨çš„å®ä½“å°±ä¼šå½¢æˆå¯èƒ½çš„ä¸‰å…ƒç»„ç»„åˆï¼Œå†åˆ©ç”¨0ï¼Œ1æ¥æ ‡æ³¨è¿™ç§ä¸‰å…ƒç»„æ˜¯å¦æœ‰æ•ˆï¼Œè¿™æ ·å°±èƒ½åšåˆ°åœ¨å¼€æ”¾é¢†åŸŸè¿›è¡Œä¸‰å…ƒç»„æŠ½å–ã€‚</p><p>ä¸€ä¸ªç®€å•çš„æ ‡æ³¨ä¾‹å­å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp27_3.png" alt="æ ‡æ³¨ä¾‹å­" /><figcaption aria-hidden="true">æ ‡æ³¨ä¾‹å­</figcaption></figure><p>å†å¯¹ä»¥ä¸Šçš„æ ‡æ³¨ç»“æœåšä¸€äº›è¯´æ˜ï¼Œæˆ‘ä»¬çš„æ ‡æ³¨æ˜¯ä»¥å¥å­ä¸ºå•ä½ï¼Œè¿›è¡Œå¥å­çº§åˆ«çš„æ ‡æ³¨ï¼Œä¸åŒè¦ç´ åœ¨æ ‡æ³¨çš„æ—¶å€™åŠ #åŒºåˆ†ï¼Œæ ‡æ³¨äº†ä¸¤ä¸ªsubjectï¼Œ1ä¸ªpredicateï¼ˆå…±ç”¨ï¼‰å’Œ2ä¸ªobjectï¼Œå…¶ä¸­predidateæ˜¯è¿™äº›subjectå’Œobjectå…¬ç”¨çš„ï¼Œæ‰€ä»¥åªéœ€è¦æ ‡æ³¨ä¸€æ¬¡ã€‚è¿™æ ·ï¼Œç‚¹å‡»â€œæ˜¾ç¤ºSPOâ€ï¼Œä¸€å…±ä¼šæ˜¾ç¤º4ä¸ªä¸‰å…ƒç»„ï¼Œsï¼Œpï¼Œoç”¨#éš”å¼€ï¼Œ0ï¼Œ1è¡¨ç¤ºæ˜¯å¦æ˜¯æœ‰æ•ˆä¸‰å…ƒç»„ï¼Œé»˜è®¤ä¸º0ã€‚</p><p>ç¬”è€…åˆ©ç”¨ç©ºä½™æ—¶é—´ï¼Œä¸€å…±æ ‡æ³¨äº†3200å¤šä¸ªæ ·æœ¬ï¼Œå¯¹äºåºåˆ—æ ‡æ³¨æ¥è¯´ï¼Œå°±æ˜¯3200å¤šä¸ªæ ·æœ¬ï¼Œå¯¹äºæ–‡æœ¬åˆ†ç±»æ¥è¯´ï¼Œå°±æ˜¯9000å¤šä¸ªæ ·æœ¬äº†ã€‚</p><h3 id="åºåˆ—æ ‡æ³¨">åºåˆ—æ ‡æ³¨</h3><p>å¯¹äºä¸Šè¿°çš„æ ‡æ³¨ä¾‹å­ï¼Œä¼šå½¢æˆå¦‚ä¸‹çš„æ ‡æ³¨åºåˆ—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç¾B-SUBJ<br>å›½I-SUBJ<br>ç–¾I-SUBJ<br>æ§I-SUBJ<br>ä¸­I-SUBJ<br>å¿ƒI-SUBJ<br>ä¸»B-PRED<br>ä»»I-PRED<br>é›·B-OBJ<br>å¾·I-OBJ<br>è²I-OBJ<br>å°”I-OBJ<br>å¾·I-OBJ<br>ï¼ˆO<br>å·¦O<br>åœˆO<br>ï¼‰O<br>å’ŒO<br>ç¾B-SUBJ<br>å›½I-SUBJ<br>å›½I-SUBJ<br>ç«‹I-SUBJ<br>å«I-SUBJ<br>ç”ŸI-SUBJ<br>ç ”I-SUBJ<br>ç©¶I-SUBJ<br>é™¢I-SUBJ<br>è¿‡I-SUBJ<br>æ•I-SUBJ<br>å’ŒI-SUBJ<br>ä¼ I-SUBJ<br>æŸ“I-SUBJ<br>ç—…I-SUBJ<br>ç ”I-SUBJ<br>ç©¶I-SUBJ<br>æ‰€I-SUBJ<br>ä¸»B-PRED<br>ä»»I-PRED<br>ç¦B-OBJ<br>è¥¿I-OBJ<br>ï¼ˆO<br>å³O<br>åœˆO<br>ï¼‰O<br></code></pre></td></tr></table></figure><p>å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ¯”ä¾‹ä¸º8ï¼š2.é‡‡ç”¨ç»å…¸çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ALBERT+Bi-LSTM+CRFè¿›è¡Œå®ä½“è¯†åˆ«ï¼Œè®¾ç½®æœ€å¤§æ–‡æœ¬é•¿åº¦ä¸º128ï¼Œè®­ç»ƒ100ä¸ªepochã€‚å…³äºè¯¥æ¨¡å‹çš„ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://blog.csdn.net/jclian91/article/details/104826655">NLPï¼ˆäºŒåäº”ï¼‰å®ç°ALBERT+Bi-LSTM+CRFæ¨¡å‹</a>ã€‚</p><p>åœ¨æµ‹è¯•é›†ä¸Šçš„è®­ç»ƒç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">accuracy</span>:  <span class="hljs-number">93</span>.<span class="hljs-number">69</span>%; precision:  <span class="hljs-number">76</span>.<span class="hljs-number">26</span>%; recall:  <span class="hljs-number">82</span>.<span class="hljs-number">33</span>%; FB1:  <span class="hljs-number">79</span>.<span class="hljs-number">18</span><br><span class="hljs-attribute">OBJ</span>: precision:  <span class="hljs-number">80</span>.<span class="hljs-number">47</span>%; recall:  <span class="hljs-number">88</span>.<span class="hljs-number">81</span>%; FB1:  <span class="hljs-number">84</span>.<span class="hljs-number">44</span>  <span class="hljs-number">927</span><br><span class="hljs-attribute">PRED</span>: precision:  <span class="hljs-number">76</span>.<span class="hljs-number">89</span>%; recall:  <span class="hljs-number">83</span>.<span class="hljs-number">69</span>%; FB1:  <span class="hljs-number">80</span>.<span class="hljs-number">14</span>  <span class="hljs-number">1021</span><br><span class="hljs-attribute">SUBJ</span>: precision:  <span class="hljs-number">71</span>.<span class="hljs-number">72</span>%; recall:  <span class="hljs-number">75</span>.<span class="hljs-number">32</span>%; FB1:  <span class="hljs-number">73</span>.<span class="hljs-number">48</span>  <span class="hljs-number">983</span><br></code></pre></td></tr></table></figure><p>åœ¨æµ‹è¯•é›†ä¸Šçš„æ€»ä½“F1å€¼æ¥è¿‘80%ã€‚</p><h3 id="æ–‡æœ¬åˆ†ç±»">æ–‡æœ¬åˆ†ç±»</h3><p>å…³äºæ–‡æœ¬åˆ†ç±»ï¼Œéœ€è¦å¤šåšä¸€äº›è¯´æ˜ã€‚</p><p>è™½ç„¶æœ¬æ–‡çš„é¢˜ç›®æ˜¯å…³äºåœ¨å¼€å‘é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„å°è¯•ï¼Œä½†å®é™…æˆ‘åœ¨æ ‡æ³¨çš„æ—¶å€™ï¼Œè¿˜æ˜¯æ›´å¤šåœ°æ ‡æ³¨äººç‰©å¤´è¡”ï¼Œäººç‰©å…³ç³»ï¼Œå…¬å¸ä¸äººçš„å…³ç³»ï¼Œå½±è§†å‰§ä¸»æ¼”ã€å¯¼æ¼”ä¿¡æ¯ç­‰ã€‚å½¢æˆçš„æœ‰æ•ˆçš„æ–‡æœ¬åˆ†ç±»çš„æ ·æœ¬ä¸º9000å¤šä¸ªï¼Œä¸€å…±æœ‰å…³ç³»1365ä¸ªï¼Œæ•°é‡æœ€å¤šçš„å‰20ä¸ªå…³ç³»å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp27_4.png" alt="æ•°é‡æœ€å¤šçš„20ä¸ªå…³ç³»" /><figcaption aria-hidden="true">æ•°é‡æœ€å¤šçš„20ä¸ªå…³ç³»</figcaption></figure><p>ä»¥ä¸Šè¿°çš„æ ‡æ³¨æ•°æ®ä¸ºä¾‹ï¼Œå½¢æˆçš„æ ‡æ³¨æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">ç¾å›½ç–¾æ§ä¸­å¿ƒ#ä¸»ä»»#é›·å¾·è²å°”å¾·#<span class="hljs-number">1</span>#ç¾å›½ç–¾æ§ä¸­å¿ƒä¸»ä»»é›·å¾·è²å°”å¾·ï¼ˆå·¦åœˆï¼‰å’Œç¾å›½å›½ç«‹å«ç”Ÿç ”ç©¶é™¢è¿‡æ•å’Œä¼ æŸ“ç—…ç ”ç©¶æ‰€ä¸»ä»»ç¦è¥¿ï¼ˆå³åœˆï¼‰<br>ç¾å›½ç–¾æ§ä¸­å¿ƒ#ä¸»ä»»#ç¦è¥¿#<span class="hljs-number">0</span>#ç¾å›½ç–¾æ§ä¸­å¿ƒä¸»ä»»é›·å¾·è²å°”å¾·ï¼ˆå·¦åœˆï¼‰å’Œç¾å›½å›½ç«‹å«ç”Ÿç ”ç©¶é™¢è¿‡æ•å’Œä¼ æŸ“ç—…ç ”ç©¶æ‰€ä¸»ä»»ç¦è¥¿ï¼ˆå³åœˆï¼‰<br>ç¾å›½å›½ç«‹å«ç”Ÿç ”ç©¶é™¢è¿‡æ•å’Œä¼ æŸ“ç—…ç ”ç©¶æ‰€#ä¸»ä»»#é›·å¾·è²å°”å¾·#<span class="hljs-number">0</span>#ç¾å›½ç–¾æ§ä¸­å¿ƒä¸»ä»»é›·å¾·è²å°”å¾·ï¼ˆå·¦åœˆï¼‰å’Œç¾å›½å›½ç«‹å«ç”Ÿç ”ç©¶é™¢è¿‡æ•å’Œä¼ æŸ“ç—…ç ”ç©¶æ‰€ä¸»ä»»ç¦è¥¿ï¼ˆå³åœˆï¼‰<br>ç¾å›½å›½ç«‹å«ç”Ÿç ”ç©¶é™¢è¿‡æ•å’Œä¼ æŸ“ç—…ç ”ç©¶æ‰€#ä¸»ä»»#ç¦è¥¿#<span class="hljs-number">1</span>#ç¾å›½ç–¾æ§ä¸­å¿ƒä¸»ä»»é›·å¾·è²å°”å¾·ï¼ˆå·¦åœˆï¼‰å’Œç¾å›½å›½ç«‹å«ç”Ÿç ”ç©¶é™¢è¿‡æ•å’Œä¼ æŸ“ç—…ç ”ç©¶æ‰€ä¸»ä»»ç¦è¥¿ï¼ˆå³åœˆï¼‰<br></code></pre></td></tr></table></figure><p>åœ¨å®é™…æ¨¡å‹è®­ç»ƒçš„æ—¶å€™ï¼Œä¼šå°†åŸæ–‡ä¸­çš„subjectç”¨S*len(subject)ä»£æ›¿ï¼Œpredicateç”¨Pï¼Œobjectç”¨Oã€‚</p><p>å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ¯”ä¾‹ä¸º8ï¼š2ã€‚é‡‡ç”¨ç»å…¸çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ALBERT+Bi-GRU+ATT+FCï¼Œè®¾ç½®æ–‡æœ¬çš„æœ€å¤§é•¿åº¦ä¸ºä¸º128ï¼Œè®­ç»ƒ30ä¸ªepochï¼Œé‡‡ç”¨earlystoppingæœºåˆ¶ï¼Œè®­ç»ƒè¿‡ç¨‹çš„losså’Œaccå›¾åƒå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp27_5.png" alt="è®­ç»ƒè¿‡ç¨‹çš„losså’Œaccå›¾åƒ" /><figcaption aria-hidden="true">è®­ç»ƒè¿‡ç¨‹çš„losså’Œaccå›¾åƒ</figcaption></figure><p>æœ€ç»ˆåœ¨æµ‹è¯•é›†ä¸Šçš„accuracyçº¦ä¸º96%ã€‚</p><h3 id="æ–°æ•°æ®è¿›è¡Œä¸‰å…ƒç»„æŠ½å–">æ–°æ•°æ®è¿›è¡Œä¸‰å…ƒç»„æŠ½å–</h3><p>ä¸Šè¿°çš„æ¨¡å‹è®­ç»ƒå®Œæ¯•åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶å°è£…æˆHTTPæœåŠ¡ã€‚å¯¹äºæ–°è¾“å…¥çš„å¥å­ï¼Œæˆ‘ä»¬å…ˆåˆ©ç”¨åºåˆ—æ ‡æ³¨æ¨¡å‹é¢„æµ‹å‡ºå…¶ä¸­çš„subjectï¼Œpredicateå’Œobjectï¼Œç»„åˆæˆä¸‰å…ƒç»„ä¸å¥å­çš„æ‹¼æ¥ï¼Œè¾“å…¥åˆ°æ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œåˆ¤åˆ«è¯¥ä¸‰å…ƒç»„æ˜¯å¦æœ‰æ•ˆï¼Œ0ä¸ºæ— æ•ˆï¼Œ1ä¸ºæœ‰æ•ˆã€‚</p><p>ä»ç½‘ä¸Šæ‰¾å‡ ä¸ªä¾‹å­ï¼Œé¢„æµ‹çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp27_6.png" alt="ä¾‹å­1" /><figcaption aria-hidden="true">ä¾‹å­1</figcaption></figure><figure><img src="/img/nlp27_7.png" alt="ä¾‹å­2" /><figcaption aria-hidden="true">ä¾‹å­2</figcaption></figure><figure><img src="/img/nlp27_8.png" alt="ä¾‹å­3" /><figcaption aria-hidden="true">ä¾‹å­3</figcaption></figure><p><code>extract_example</code>ç›®å½•ä¸­ä¸ºæŠ½å–çš„æ•ˆæœï¼ŒåŒ…æ‹¬å‡ æœ¬å°è¯´å’Œä¸€äº›æ–°é—»ä¸Šçš„æ•ˆæœï¼Œå…³äºè¿™æ–¹é¢çš„æ¼”ç¤ºï¼Œå¯ä»¥å‚è€ƒå¦ä¸€ä¸ªé¡¹ç›®ï¼š<ahref="https://github.com/percent4/knowledge_graph_demo">https://github.com/percent4/knowledge_graph_demo</a>ã€‚ä¹Ÿå¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/09/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E6%9E%84%E5%BB%BA%E4%B8%BE%E4%BE%8B/">çŸ¥è¯†å›¾è°±æ„å»ºä¸¾ä¾‹</a>ä¸­ç»™å‡ºçš„å‡ ä¸ªçŸ¥è¯†å›¾è°±çš„å»ºæ„çš„ä¾‹å­ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡å†™çš„è¿‡ç¨‹è¾ƒä¸ºç®€å•ï¼Œä¹Ÿæ²¡æœ‰ä»£ç ï¼Œè¿™æ˜¯å› ä¸ºç¬”è€…åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­åšäº†å¤§é‡çš„é“ºå«ï¼Œä¸»è¦æ˜¯é›†ä¸­åœ¨æ¨¡å‹æ–¹é¢ã€‚å†µä¸”ï¼Œè¿™ä¸ªé¡¹ç›®æ¯”è¾ƒå¤§ï¼Œä¹Ÿä¸é€‚åˆåœ¨è¿™é‡Œè¯¦ç»†è®²è¿°ï¼Œç¬”è€…åªåœ¨è¿™é‡Œç»™å‡ºæ€è·¯å’Œå¤§æ¦‚çš„å¤„ç†æµç¨‹ï¼Œå…·ä½“çš„å®ç°ä»£ç å¯ä»¥å‚è€ƒä¸‹æ–¹çš„Githubåœ°å€ã€‚</p><p>åœ¨å®é™…çš„æŠ½å–è¿‡ç¨‹ä¸­ï¼Œä¸€äº›å¥å­ä¹Ÿå­˜åœ¨æŠ½å–å‡ºå¤§é‡æ— ç”¨çš„ä¸‰å…ƒç»„çš„æƒ…å†µï¼Œå¯¼è‡´å¬å›ç‡é«˜ï¼Œè¿™æ˜¯å› ä¸ºæœ¬é¡¹ç›®é’ˆå¯¹çš„æ˜¯å¼€æ”¾é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–ï¼Œå› æ­¤æ•ˆæœæ¯”ä¸ä¼šæœ‰æƒ³è±¡ä¸­çš„é‚£ä¹ˆå¥½ï¼Œæå‡æŠ½å–æ•ˆæœçš„åŠæ³•å¦‚ä¸‹ï¼š</p><ul><li><p>å¢åŠ æ•°æ®æ ‡æ³¨é‡ï¼Œç›®å‰åºåˆ—æ ‡æ³¨ç®—æ³•çš„æ ·æœ¬ä»…3200å¤šä¸ªï¼›</p></li><li><p>æ¨¡å‹æ–¹é¢ï¼šç°åœ¨æ˜¯pipelineå½¢å¼ï¼Œå„è‡ªçš„æ•ˆæœè¿˜è¡Œï¼Œä½†æ€»ä½“ä¸Šä¸å¦‚Jointå½¢å¼å¥½ï¼›</p></li><li><p>å¯¹äºè‡ªå·±æƒ³æŠ½çš„å…¶ä»–ä¸‰å…ƒç»„çš„æƒ…å½¢ï¼Œå»ºè®®å¢åŠ è¿™æ–¹é¢çš„æ ‡æ³¨ï¼›</p></li><li><p>æ–‡æœ¬é¢„æµ‹è€—æ—¶é•¿ï¼ˆè¯¥é—®é¢˜å·²ç»è§£å†³ï¼‰ã€‚</p><p>æœ¬é¡¹ç›®ä½œä¸ºç¬”è€…åœ¨å¼€æ”¾é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•ï¼Œåœ¨æ­¤ä¹‹å‰å…³äºè¿™æ–¹é¢çš„æ–‡ç« æˆ–è€…é¡¹ç›®è¿˜å¾ˆå°‘ï¼Œå› æ­¤å¯ä»¥è¯´æ˜¯æ¢ç´¢é˜¶æ®µã€‚</p><p>æºç å’Œæ•°æ®å·²ç»åœ¨Githubé¡¹ç›®ä¸­ç»™å‡ºï¼Œç½‘å€ä¸º <ahref="https://github.com/percent4/spo_extract_platform">https://github.com/percent4/spo_extract_platform</a>ã€‚</p><p>æœ¬äººçš„å¾®ä¿¡å…¬ä¼—å·ä¸º<code>NLPå¥‡å¹»ä¹‹æ—…</code>ï¼Œæ¬¢è¿å…³æ³¨~</p></li></ul><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>åˆ©ç”¨å…³ç³»æŠ½å–æ„å»ºçŸ¥è¯†å›¾è°±çš„ä¸€æ¬¡å°è¯•ï¼šhttps://www.cnblogs.com/jclian91/p/11107323.html</li><li>NLPï¼ˆäºŒåå…­ï¼‰é™å®šé¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•ï¼šhttps://blog.csdn.net/jclian91/article/details/104874488</li><li>NLPï¼ˆäºŒåäº”ï¼‰å®ç°ALBERT+Bi-LSTM+CRFæ¨¡å‹ï¼šhttps://blog.csdn.net/jclian91/article/details/104826655</li><li>çŸ¥è¯†å›¾è°±æ„å»ºä¸¾ä¾‹ï¼šhttps://blog.csdn.net/jclian91/article/details/104685424</li><li>NLPï¼ˆäºŒåä¸€ï¼‰äººç‰©å…³ç³»æŠ½å–çš„ä¸€æ¬¡å®æˆ˜ï¼šhttps://blog.csdn.net/jclian91/article/details/104380371</li><li>ã€ŠçŸ¥è¯†å›¾è°± æ–¹æ³•ã€å®è·µä¸åº”ç”¨ã€‹ç‹æ˜Šå¥‹ã€æ¼†æ¡‚æ—ã€é™ˆåé’§è‘—ï¼Œä¸­å›½å·¥ä¿¡å‡ºç‰ˆé›†å›¢ã€ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾å‡ºç‰ˆã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>å…³ç³»æŠ½å–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåå…­ï¼‰é™å®šé¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•</title>
    <link href="/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%85%AD%EF%BC%89%E9%99%90%E5%AE%9A%E9%A2%86%E5%9F%9F%E7%9A%84%E4%B8%89%E5%85%83%E7%BB%84%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%85%AD%EF%BC%89%E9%99%90%E5%AE%9A%E9%A2%86%E5%9F%9F%E7%9A%84%E4%B8%89%E5%85%83%E7%BB%84%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»ç¬”è€…åœ¨2019è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›çš„ä¸‰å…ƒç»„æŠ½å–æ¯”èµ›æ–¹é¢çš„ä¸€æ¬¡å°è¯•ã€‚ç”±äºè¯¥æ¯”èµ›æ—©å·²ç»“æŸï¼Œç¬”è€…å½“æ—¶ä¹Ÿæ²¡æœ‰å‚åŠ è¿™ä¸ªæ¯”èµ›ï¼Œå› æ­¤æ²¡æœ‰æµ‹è¯„æˆç»©ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½æ‹¿åˆ°è®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸è€½è¯¯æˆ‘ä»¬åœ¨è¿™æ–¹é¢åšå®éªŒã€‚</p><h3 id="æ¯”èµ›ä»‹ç»">æ¯”èµ›ä»‹ç»</h3><p>è¯¥æ¯”èµ›çš„ç½‘å€ä¸ºï¼š<ahref="http://lic2019.ccf.org.cn/kg">http://lic2019.ccf.org.cn/kg</a>ï¼Œè¯¥æ¯”èµ›ä¸»è¦æ˜¯ä»ç»™å®šçš„å¥å­ä¸­æå–ä¸‰å…ƒç»„ï¼Œç»™å®šschemaçº¦æŸé›†åˆåŠå¥å­sentï¼Œå…¶ä¸­schemaå®šä¹‰äº†å…³ç³»Pä»¥åŠå…¶å¯¹åº”çš„ä¸»ä½“Så’Œå®¢ä½“Oçš„ç±»åˆ«ï¼Œä¾‹å¦‚ï¼ˆS_TYPE:äººç‰©ï¼ŒP:å¦»å­ï¼ŒO_TYPE:äººç‰©ï¼‰ã€ï¼ˆS_TYPE:å…¬å¸ï¼ŒP:åˆ›å§‹äººï¼ŒO_TYPE:äººç‰©ï¼‰ç­‰ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¹ç„ç æ˜¯åœ¨çºµæ¨ªä¸­æ–‡ç½‘è¿è½½çš„ä¸€éƒ¨å°è¯´ï¼Œä½œè€…æ˜¯é¾™é©¬&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;spo_list&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;ä¹ç„ç &quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;è¿è½½ç½‘ç«™&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;çºµæ¨ªä¸­æ–‡ç½‘&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;ä¹ç„ç &quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;ä½œè€…&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;é¾™é©¬&quot;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>è¯¥æ¯”èµ›ä¸€å…±æä¾›äº†20å¤šä¸‡æ ‡æ³¨è´¨é‡å¾ˆé«˜çš„ä¸‰å…ƒç»„ï¼Œå…¶ä¸­17ä¸‡è®­ç»ƒé›†ï¼Œ2ä¸‡éªŒè¯é›†å’Œ2ä¸‡æµ‹è¯•é›†ï¼Œå®ä½“å…³ç³»ï¼ˆschemaï¼‰50ä¸ªã€‚</p><p>åœ¨å…·ä½“ä»‹ç»ç¬”è€…çš„æ€è·¯å’Œå®æˆ˜å‰ï¼Œå…ˆä»‹ç»ä¸‹æœ¬æ¬¡ä»»åŠ¡çš„å¤„ç†æ€è·¯ï¼š</p><figure><img src="/img/nlp26_1.png" alt="ä»»åŠ¡çš„å¤„ç†æ€è·¯" /><figcaption aria-hidden="true">ä»»åŠ¡çš„å¤„ç†æ€è·¯</figcaption></figure><p>é¦–å…ˆæ˜¯å¯¹æ‹¿åˆ°çš„æ•°æ®è¿›è¡Œæ•°æ®åˆ†æï¼ŒåŒ…æ‹¬ç»Ÿè®¡æ¯ä¸ªå¥å­çš„é•¿åº¦åŠä¸‰å…ƒç»„æ•°é‡ï¼Œæ¯ç§å…³ç³»çš„æ•°é‡åˆ†å¸ƒæƒ…å†µã€‚æ¥ç€ï¼Œå¯¹æ•°æ®å•ç‹¬èµ°åºåˆ—æ ‡æ³¨æ¨¡å‹å’Œå…³ç³»åˆ†ææ¨¡å‹ã€‚æœ€ååœ¨æå–ä¸‰å…ƒç»„çš„æ—¶å€™ï¼Œç”¨Pipelineæ¨¡å‹ï¼Œå…ˆç”¨åºåˆ—æ ‡æ³¨æ¨¡å‹é¢„æµ‹å¥å­ä¸­çš„å®ä½“ï¼Œå†å¯¹å®ä½“ï¼ˆåŠ ä¸Šå¥å­ï¼‰èµ°å…³ç³»åˆ†ç±»æ¨¡å‹ï¼Œé¢„æµ‹å®ä½“çš„å…³ç³»ï¼Œæœ€åå½¢æˆæœ‰æ•ˆçš„ä¸‰å…ƒç»„ã€‚</p><p>æ¥ä¸‹æ¥ç¬”è€…å°†é€ä¸€ä»‹ç»ï¼Œé¡¹ç›®ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp26_2.png" alt="é¡¹ç›®ç»“æ„å›¾" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„å›¾</figcaption></figure><h3 id="æ•°æ®åˆ†æ">æ•°æ®åˆ†æ</h3><p>æˆ‘ä»¬èƒ½æ‹¿åˆ°çš„åªæœ‰è®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œæ²¡æœ‰æµ‹è¯•é›†ã€‚æˆ‘ä»¬å¯¹è®­ç»ƒé›†åšæ•°æ®åˆ†æï¼Œè®­ç»ƒé›†æ•°æ®æ–‡ä»¶ä¸ºtrain_data.jsonã€‚</p><p>æ•°æ®åˆ†æä¼šç»Ÿè®¡è®­ç»ƒé›†ä¸­æ¯ä¸ªå¥å­çš„é•¿åº¦åŠä¸‰å…ƒç»„æ•°é‡ï¼Œè¿˜æœ‰å…³ç³»çš„åˆ†å¸ƒå›¾ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-12 21:52</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br>plt.figure(figsize=(<span class="hljs-number">18</span>, <span class="hljs-number">8</span>), dpi=<span class="hljs-number">100</span>)   <span class="hljs-comment"># è¾“å‡ºå›¾ç‰‡å¤§å°ä¸º1800*800</span><br><span class="hljs-comment"># Macç³»ç»Ÿè®¾ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ</span><br>plt.rcParams[<span class="hljs-string">&quot;font.family&quot;</span>] = <span class="hljs-string">&#x27;Arial Unicode MS&#x27;</span><br><br><br><span class="hljs-comment"># åŠ è½½æ•°æ®é›†</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>(<span class="hljs-params">filename</span>):<br>    D = []<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        content = f.readlines()<br><br>    content = [_.replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;\u3000&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;\xa0&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;\u2003&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> content]<br><br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> content:<br>        l = json.loads(l)<br>        D.append(&#123;<br>            <span class="hljs-string">&#x27;text&#x27;</span>: l[<span class="hljs-string">&#x27;text&#x27;</span>],<br>            <span class="hljs-string">&#x27;spo_list&#x27;</span>: [<br>                (spo[<span class="hljs-string">&#x27;subject&#x27;</span>], spo[<span class="hljs-string">&#x27;predicate&#x27;</span>], spo[<span class="hljs-string">&#x27;object&#x27;</span>])<br>                <span class="hljs-keyword">for</span> spo <span class="hljs-keyword">in</span> l[<span class="hljs-string">&#x27;spo_list&#x27;</span>]<br>            ]<br>        &#125;)<br>    <span class="hljs-keyword">return</span> D<br><br>filename = <span class="hljs-string">&#x27;../data/train_data.json&#x27;</span><br><br>D = load_data(filename=filename)<br>pprint(D)<br><br><span class="hljs-comment"># åˆ›å»ºtext, text_length, spo_numçš„DataFrame</span><br>text_list = [_[<span class="hljs-string">&quot;text&quot;</span>] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> D]<br>spo_num = [<span class="hljs-built_in">len</span>(_[<span class="hljs-string">&quot;spo_list&quot;</span>])<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> D]<br><br>df = pd.DataFrame(&#123;<span class="hljs-string">&quot;text&quot;</span>: text_list, <span class="hljs-string">&quot;spo_num&quot;</span>: spo_num&#125; )<br>df[<span class="hljs-string">&quot;text_length&quot;</span>] = df[<span class="hljs-string">&quot;text&quot;</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x))<br><span class="hljs-built_in">print</span>(df.head())<br><span class="hljs-built_in">print</span>(df.describe())<br><br><span class="hljs-comment"># ç»˜åˆ¶spo_numçš„æ¡å½¢ç»Ÿè®¡å›¾</span><br>pprint(df[<span class="hljs-string">&#x27;spo_num&#x27;</span>].value_counts())<br>label_list = <span class="hljs-built_in">list</span>(df[<span class="hljs-string">&#x27;spo_num&#x27;</span>].value_counts().index)<br>num_list = df[<span class="hljs-string">&#x27;spo_num&#x27;</span>].value_counts().tolist()<br><br><span class="hljs-comment"># åˆ©ç”¨Matplotlibæ¨¡å—ç»˜åˆ¶æ¡å½¢å›¾</span><br>x = <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(num_list))<br>rects = plt.bar(x=x, height=num_list, width=<span class="hljs-number">0.6</span>, color=<span class="hljs-string">&#x27;blue&#x27;</span>, label=<span class="hljs-string">&quot;é¢‘æ•°&quot;</span>)<br>plt.ylim(<span class="hljs-number">0</span>, <span class="hljs-number">80000</span>) <span class="hljs-comment"># yè½´èŒƒå›´</span><br>plt.ylabel(<span class="hljs-string">&quot;æ•°é‡&quot;</span>)<br>plt.xticks([index + <span class="hljs-number">0.1</span> <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> x], label_list)<br>plt.xlabel(<span class="hljs-string">&quot;ä¸‰å…ƒç»„æ•°é‡&quot;</span>)<br>plt.title(<span class="hljs-string">&quot;ä¸‰å…ƒç»„é¢‘æ•°ç»Ÿè®¡å›¾&quot;</span>)<br><br><span class="hljs-comment"># æ¡å½¢å›¾çš„æ–‡å­—è¯´æ˜</span><br><span class="hljs-keyword">for</span> rect <span class="hljs-keyword">in</span> rects:<br>    height = rect.get_height()<br>    plt.text(rect.get_x() + rect.get_width() / <span class="hljs-number">2</span>, height+<span class="hljs-number">1</span>, <span class="hljs-built_in">str</span>(height), ha=<span class="hljs-string">&quot;center&quot;</span>, va=<span class="hljs-string">&quot;bottom&quot;</span>)<br><br><span class="hljs-comment"># plt.show()</span><br>plt.savefig(<span class="hljs-string">&#x27;./spo_num_bar_chart.png&#x27;</span>)<br><br>plt.close()<br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br>plt.figure(figsize=(<span class="hljs-number">18</span>, <span class="hljs-number">8</span>), dpi=<span class="hljs-number">100</span>)   <span class="hljs-comment"># è¾“å‡ºå›¾ç‰‡å¤§å°ä¸º1800*800</span><br><span class="hljs-comment"># Macç³»ç»Ÿè®¾ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ</span><br>plt.rcParams[<span class="hljs-string">&quot;font.family&quot;</span>] = <span class="hljs-string">&#x27;Arial Unicode MS&#x27;</span><br><br><br><span class="hljs-comment"># å…³ç³»ç»Ÿè®¡å›¾</span><br>relation_dict = defaultdict(<span class="hljs-built_in">int</span>)<br><br><span class="hljs-keyword">for</span> spo_dict <span class="hljs-keyword">in</span> D:<br>    <span class="hljs-comment"># print(spo_dict[&quot;spo_list&quot;])</span><br>    <span class="hljs-keyword">for</span> spo <span class="hljs-keyword">in</span> spo_dict[<span class="hljs-string">&quot;spo_list&quot;</span>]:<br>        relation_dict[spo[<span class="hljs-number">1</span>]] += <span class="hljs-number">1</span><br><br>label_list = <span class="hljs-built_in">list</span>(relation_dict.keys())<br>num_list = <span class="hljs-built_in">list</span>(relation_dict.values())<br><br><span class="hljs-comment"># åˆ©ç”¨Matplotlibæ¨¡å—ç»˜åˆ¶æ¡å½¢å›¾</span><br>x = <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(num_list))<br>rects = plt.bar(x=x, height=num_list, width=<span class="hljs-number">0.6</span>, color=<span class="hljs-string">&#x27;blue&#x27;</span>, label=<span class="hljs-string">&quot;é¢‘æ•°&quot;</span>)<br>plt.ylim(<span class="hljs-number">0</span>, <span class="hljs-number">80000</span>) <span class="hljs-comment"># yè½´èŒƒå›´</span><br>plt.ylabel(<span class="hljs-string">&quot;æ•°é‡&quot;</span>)<br>plt.xticks([index + <span class="hljs-number">0.1</span> <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> x], label_list)<br>plt.xticks(rotation=<span class="hljs-number">45</span>) <span class="hljs-comment"># xè½´çš„æ ‡ç­¾æ—‹è½¬45åº¦</span><br>plt.xlabel(<span class="hljs-string">&quot;ä¸‰å…ƒç»„å…³ç³»&quot;</span>)<br>plt.title(<span class="hljs-string">&quot;ä¸‰å…ƒç»„å…³ç³»é¢‘æ•°ç»Ÿè®¡å›¾&quot;</span>)<br><br><span class="hljs-comment"># æ¡å½¢å›¾çš„æ–‡å­—è¯´æ˜</span><br><span class="hljs-keyword">for</span> rect <span class="hljs-keyword">in</span> rects:<br>    height = rect.get_height()<br>    plt.text(rect.get_x() + rect.get_width() / <span class="hljs-number">2</span>, height+<span class="hljs-number">1</span>, <span class="hljs-built_in">str</span>(height), ha=<span class="hljs-string">&quot;center&quot;</span>, va=<span class="hljs-string">&quot;bottom&quot;</span>)<br><br><br>plt.savefig(<span class="hljs-string">&#x27;./relation_bar_chart.png&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache">             <span class="hljs-attribute">spo_num</span>    text_length<br><span class="hljs-attribute">count</span>  <span class="hljs-number">173108</span>.<span class="hljs-number">000000</span>  <span class="hljs-number">173108</span>.<span class="hljs-number">000000</span><br><span class="hljs-attribute">mean</span>        <span class="hljs-number">2</span>.<span class="hljs-number">103993</span>      <span class="hljs-number">54</span>.<span class="hljs-number">057190</span><br><span class="hljs-attribute">std</span>         <span class="hljs-number">1</span>.<span class="hljs-number">569331</span>      <span class="hljs-number">31</span>.<span class="hljs-number">498245</span><br><span class="hljs-attribute">min</span>         <span class="hljs-number">0</span>.<span class="hljs-number">000000</span>       <span class="hljs-number">5</span>.<span class="hljs-number">000000</span><br><span class="hljs-attribute">25</span>%         <span class="hljs-number">1</span>.<span class="hljs-number">000000</span>      <span class="hljs-number">32</span>.<span class="hljs-number">000000</span><br><span class="hljs-attribute">50</span>%         <span class="hljs-number">2</span>.<span class="hljs-number">000000</span>      <span class="hljs-number">45</span>.<span class="hljs-number">000000</span><br><span class="hljs-attribute">75</span>%         <span class="hljs-number">2</span>.<span class="hljs-number">000000</span>      <span class="hljs-number">68</span>.<span class="hljs-number">000000</span><br><span class="hljs-attribute">max</span>        <span class="hljs-number">25</span>.<span class="hljs-number">000000</span>     <span class="hljs-number">300</span>.<span class="hljs-number">000000</span><br></code></pre></td></tr></table></figure><p>å¥å­çš„å¹³å‡é•¿åº¦ä¸º54ï¼Œæœ€å¤§é•¿åº¦ä¸º300ï¼›æ¯å¥è¯ä¸­çš„ä¸‰å…ƒç»„æ•°é‡çš„å¹³å‡å€¼ä¸º2.1ï¼Œæœ€å¤§å€¼ä¸º25ã€‚</p><p>æ¯å¥è¯ä¸­çš„ä¸‰å…ƒç»„æ•°é‡çš„åˆ†å¸ƒå›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp26_3.png" alt="æ¯å¥è¯ä¸­çš„ä¸‰å…ƒç»„æ•°é‡åˆ†å¸ƒå›¾" /><figcaption aria-hidden="true">æ¯å¥è¯ä¸­çš„ä¸‰å…ƒç»„æ•°é‡åˆ†å¸ƒå›¾</figcaption></figure><p>å…³ç³»æ•°é‡çš„åˆ†å¸ƒå›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp26_4.png" alt="å…³ç³»æ•°é‡åˆ†å¸ƒå›¾" /><figcaption aria-hidden="true">å…³ç³»æ•°é‡åˆ†å¸ƒå›¾</figcaption></figure><h3 id="åºåˆ—æ ‡æ³¨æ¨¡å‹">åºåˆ—æ ‡æ³¨æ¨¡å‹</h3><p>æˆ‘ä»¬å°†å¥å­ä¸­çš„ä¸»ä½“å’Œå®¢ä½“ä½œä¸ºå®ä½“ï¼Œåˆ†åˆ«æ ‡æ³¨ä¸ºSUBJå’ŒOBJï¼Œæ ‡æ³¨ä½“ç³»é‡‡ç”¨BIOã€‚ä¸€ä¸ªç®€å•çš„æ ‡æ³¨ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">å¦‚ O<br>ä½• O<br>æ¼” O<br>å¥½ O<br>è‡ª O<br>å·± O<br>çš„ O<br>è§’ O<br>è‰² O<br>ï¼Œ O<br>è¯· O<br>è¯» O<br>ã€Š O<br>æ¼” O<br>å‘˜ O<br>è‡ª O<br>æˆ‘ O<br>ä¿® O<br>å…» O<br>ã€‹ O<br>ã€Š O<br>å–œ B-SUBJ<br>å‰§ I-SUBJ<br>ä¹‹ I-SUBJ<br>ç‹ I-SUBJ<br>ã€‹ O<br>å‘¨ B-OBJ<br>æ˜Ÿ I-OBJ<br>é©° I-OBJ<br>å´› O<br>èµ· O<br>äº O<br>ç©· O<br>å›° O<br>æ½¦ O<br>å€’ O<br>ä¹‹ O<br>ä¸­ O<br>çš„ O<br>ç‹¬ O<br>é—¨ O<br>ç§˜ O<br>ç¬ˆ O<br></code></pre></td></tr></table></figure><p>åºåˆ—æ ‡æ³¨çš„æ¨¡å‹é‡‡ç”¨ALBERT+Bi-LSTM+CRFï¼Œç»“æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp26_5.png" alt="åºåˆ—æ ‡æ³¨æ¨¡å‹ç»“æ„å›¾" /><figcaption aria-hidden="true">åºåˆ—æ ‡æ³¨æ¨¡å‹ç»“æ„å›¾</figcaption></figure><p>æ¨¡å‹æ–¹é¢çš„ä»£ç ä¸å†å…·ä½“ç»™å‡ºï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%94%EF%BC%89%E5%AE%9E%E7%8E%B0ALBERT-Bi-LSTM-CRF%E6%A8%A1%E5%9E%8B/">NLPï¼ˆäºŒåäº”ï¼‰å®ç°ALBERT+Bi-LSTM+CRFæ¨¡å‹</a>ï¼Œä¹Ÿå¯ä»¥å‚è€ƒæ–‡ç« æœ€åç»™å‡ºçš„Githubé¡¹ç›®ç½‘å€ã€‚</p><p>æ¨¡å‹è®¾ç½®æ–‡æœ¬æœ€å¤§é•¿åº¦ä¸º128ï¼Œåˆ©ç”¨ALBERTåšç‰¹å¾æå–ï¼Œåœ¨è‡ªå·±çš„ç”µè„‘ä¸Šç”¨CPUè®­ç»ƒ5ä¸ªepochï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs gradle">_________________________________________________________________<br>Train on <span class="hljs-number">173109</span> samples, validate on <span class="hljs-number">21639</span> samples<br>Epoch <span class="hljs-number">1</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 422s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.4460</span> - crf_viterbi_accuracy: <span class="hljs-number">0.8710</span> - val_loss: <span class="hljs-number">0.1613</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9235</span><br>Epoch <span class="hljs-number">2</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 417s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.1170</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9496</span> - val_loss: <span class="hljs-number">0.0885</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9592</span><br>Epoch <span class="hljs-number">3</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 417s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.0758</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9602</span> - val_loss: <span class="hljs-number">0.0653</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9638</span><br>Epoch <span class="hljs-number">4</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 415s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.0586</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9645</span> - val_loss: <span class="hljs-number">0.0544</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9651</span><br>Epoch <span class="hljs-number">5</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 422s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.0488</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9663</span> - val_loss: <span class="hljs-number">0.0464</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9654</span><br>Epoch <span class="hljs-number">6</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 423s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.0399</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9677</span> - val_loss: <span class="hljs-number">0.0375</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9660</span><br>Epoch <span class="hljs-number">7</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 415s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.0293</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9687</span> - val_loss: <span class="hljs-number">0.0265</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9664</span><br>Epoch <span class="hljs-number">8</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 414s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.0174</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9695</span> - val_loss: <span class="hljs-number">0.0149</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9671</span><br>Epoch <span class="hljs-number">9</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 422s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.0049</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9703</span> - val_loss: <span class="hljs-number">0.0036</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9670</span><br>Epoch <span class="hljs-number">10</span>/<span class="hljs-number">10</span><br><span class="hljs-number">173109</span><span class="hljs-regexp">/173109 [==============================] - 429s 2ms/</span><span class="hljs-keyword">step</span> - loss: -<span class="hljs-number">0.0072</span> - crf_viterbi_accuracy: <span class="hljs-number">0.9709</span> - val_loss: -<span class="hljs-number">0.0078</span> - val_crf_viterbi_accuracy: <span class="hljs-number">0.9674</span><br>           precision    recall  f1-score   support<br><br>      OBJ     <span class="hljs-number">0.9593</span>    <span class="hljs-number">0.9026</span>    <span class="hljs-number">0.9301</span>     <span class="hljs-number">44598</span><br>     SUBJ     <span class="hljs-number">0.9670</span>    <span class="hljs-number">0.9238</span>    <span class="hljs-number">0.9449</span>     <span class="hljs-number">25521</span><br><br>micro avg     <span class="hljs-number">0.9621</span>    <span class="hljs-number">0.9104</span>    <span class="hljs-number">0.9355</span>     <span class="hljs-number">70119</span><br>macro avg     <span class="hljs-number">0.9621</span>    <span class="hljs-number">0.9104</span>    <span class="hljs-number">0.9355</span>     <span class="hljs-number">70119</span><br></code></pre></td></tr></table></figure><p>åˆ©ç”¨seqevalæ¨¡å—åšè¯„ä¼°ï¼Œåœ¨éªŒè¯é›†ä¸Šçš„F1å€¼çº¦ä¸º93.55%ã€‚</p><h3 id="å…³ç³»åˆ†ç±»æ¨¡å‹">å…³ç³»åˆ†ç±»æ¨¡å‹</h3><p>éœ€è¦å¯¹å…³ç³»åšä¸€ä¸‹è¯´æ˜ï¼Œå› ä¸ºç¬”è€…ä¼šå¯¹å¥å­ï¼ˆsentï¼‰ä¸­çš„ä¸»ä½“ï¼ˆSï¼‰å’Œå®¢ä½“ï¼ˆOï¼‰ç»„åˆèµ·æ¥ï¼ŒåŠ ä¸Šå¥å­ï¼Œå½¢æˆè®­ç»ƒæ•°æ®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å¥å­<code>å†å²è¯„ä»·ææ°æœé²œçš„åˆ›ç«‹å¹¶éå¤ªç¥–å¤§ç‹ææˆæ¡‚ä¸€äººä¹‹åŠŸï¹å…¶äº”å­æèŠ³è¿œåŠŸä¸å¯æ²¡</code>ï¼Œä¸‰å…ƒç»„ä¸º<code>[&#123;"predicate": "çˆ¶äº²", "object_type": "äººç‰©", "subject_type": "äººç‰©", "object": "ææˆæ¡‚", "subject": "æèŠ³è¿œ"&#125;, &#123;"predicate": "å›½ç±", "object_type": "å›½å®¶", "subject_type": "äººç‰©", "object": "æœé²œ", "subject": "ææˆæ¡‚"&#125;]&#125;</code>ï¼Œåœ¨è¿™å¥è¯ä¸­ä¸»ä½“æœ‰ææˆæ¡‚ï¼ŒæèŠ³è¿œï¼Œå®¢ä½“æœ‰ææˆæ¡‚å’Œæœé²œï¼Œå…³ç³»æœ‰çˆ¶äº²ï¼ˆå…³ç³»ç±»å‹ï¼š2ï¼‰å’Œå›½ç±ï¼ˆå…³ç³»ç±»å‹ï¼š22ï¼‰ã€‚æŒ‰ç…§ç¬”è€…çš„æ€è·¯ï¼Œè¿™å¥è¯åº”ç»„æˆ4ä¸ªå…³ç³»åˆ†ç±»æ ·æœ¬ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">2 </span>æèŠ³è¿œ$ææˆæ¡‚$å†å²è¯„ä»·ææ°æœé²œçš„åˆ›ç«‹å¹¶éå¤ªç¥–å¤§ç‹###ä¸€äººä¹‹åŠŸï¹å…¶äº”å­###åŠŸä¸å¯æ²¡<br><span class="hljs-symbol">0 </span>æèŠ³è¿œ$æœé²œ$å†å²è¯„ä»·ææ°##çš„åˆ›ç«‹å¹¶éå¤ªç¥–å¤§ç‹ææˆæ¡‚ä¸€äººä¹‹åŠŸï¹å…¶äº”å­###åŠŸä¸å¯æ²¡<br><span class="hljs-symbol">0 </span>ææˆæ¡‚$ææˆæ¡‚$å†å²è¯„ä»·ææ°æœé²œçš„åˆ›ç«‹å¹¶éå¤ªç¥–å¤§ç‹###ä¸€äººä¹‹åŠŸï¹å…¶äº”å­æèŠ³è¿œåŠŸä¸å¯æ²¡<br><span class="hljs-symbol">22 </span>ææˆæ¡‚$æœé²œ$å†å²è¯„ä»·ææ°##çš„åˆ›ç«‹å¹¶éå¤ªç¥–å¤§ç‹###ä¸€äººä¹‹åŠŸï¹å…¶äº”å­æèŠ³è¿œåŠŸä¸å¯æ²¡<br></code></pre></td></tr></table></figure><p>å› æ­¤ï¼Œå°±ä¼šå‡ºç°å…³ç³»0ï¼ˆè¡¨ç¤ºâ€œæœªçŸ¥â€ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æå–ä¸‰å…ƒç»„çš„æ—¶å€™å°±å¯ä»¥ç•¥è¿‡è¿™æ¡å…³ç³»ï¼Œå½¢æˆçœŸæ­£æœ‰ç”¨çš„ä¸‰å…ƒç»„ã€‚</p><p>å› æ­¤ï¼Œå…³ç³»ä¸€å…±ä¸º51ä¸ªï¼ˆåŠ ä¸ŠæœªçŸ¥å…³ç³»ï¼š0ï¼‰ã€‚å…³ç³»åˆ†ç±»æ¨¡å‹é‡‡ç”¨ALBERT+Bi-GRU+ATTï¼Œç»“æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp26_6.png" alt="å…³ç³»åˆ†ç±»æ¨¡å‹å›¾" /><figcaption aria-hidden="true">å…³ç³»åˆ†ç±»æ¨¡å‹å›¾</figcaption></figure><p>æ¨¡å‹æ–¹é¢çš„ä»£ç ä¸å†å…·ä½“ç»™å‡ºï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98/">NLPï¼ˆäºŒåä¸€ï¼‰äººç‰©å…³ç³»æŠ½å–çš„ä¸€æ¬¡å®æˆ˜</a>ï¼Œä¹Ÿå¯ä»¥å‚è€ƒæ–‡ç« æœ€åç»™å‡ºçš„Githubé¡¹ç›®ç½‘å€ã€‚</p><p>æ¨¡å‹è®¾ç½®æ–‡æœ¬æœ€å¤§é•¿åº¦ä¸º128ï¼Œåˆ©ç”¨ALBERTåšç‰¹å¾æå–ï¼Œåœ¨è‡ªå·±çš„ç”µè„‘ä¸Šç”¨CPUè®­ç»ƒ30ä¸ªepochï¼ˆå®é™…ä¸Šï¼Œç”±äºæœ‰earlystoppingæœºåˆ¶ï¼Œè®­ç»ƒä¸åˆ°30ä¸ªeopchï¼‰ï¼Œåœ¨éªŒè¯é›†ä¸Šçš„è¯„ä¼°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">Epoch</span> <span class="hljs-number">23</span><span class="hljs-string">/30</span><br><span class="hljs-number">396766</span><span class="hljs-string">/396766</span> [<span class="hljs-string">==============================</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">776s 2ms/step - loss: 0.1770 - accuracy: 0.9402 - val_loss: 0.2170 - val_accuracy:</span> <span class="hljs-number">0.9308</span><br><br><span class="hljs-attr">Epoch 00023:</span> <span class="hljs-string">val_accuracy</span> <span class="hljs-string">did</span> <span class="hljs-string">not</span> <span class="hljs-string">improve</span> <span class="hljs-string">from</span> <span class="hljs-number">0.93292</span><br><span class="hljs-number">49506</span><span class="hljs-string">/49506</span> [<span class="hljs-string">==============================</span>] <span class="hljs-bullet">-</span> <span class="hljs-string">151s</span> <span class="hljs-string">3ms/step</span><br><span class="hljs-string">åœ¨æµ‹è¯•é›†ä¸Šçš„æ•ˆæœï¼š</span> [<span class="hljs-number">0.21701653493155634</span>, <span class="hljs-number">0.930776059627533</span>]<br>    <span class="hljs-string">precision</span>    <span class="hljs-string">recall</span>  <span class="hljs-string">f1-score</span>   <span class="hljs-string">support</span><br><br>          <span class="hljs-string">æœªçŸ¥</span>       <span class="hljs-number">0.87</span>      <span class="hljs-number">0.76</span>      <span class="hljs-number">0.81</span>      <span class="hljs-number">5057</span><br>          <span class="hljs-string">ç¥–ç±</span>       <span class="hljs-number">0.92</span>      <span class="hljs-number">0.73</span>      <span class="hljs-number">0.82</span>       <span class="hljs-number">181</span><br>          <span class="hljs-string">çˆ¶äº²</span>       <span class="hljs-number">0.79</span>      <span class="hljs-number">0.88</span>      <span class="hljs-number">0.83</span>       <span class="hljs-number">609</span><br>        <span class="hljs-string">æ€»éƒ¨åœ°ç‚¹</span>       <span class="hljs-number">0.95</span>      <span class="hljs-number">0.95</span>      <span class="hljs-number">0.95</span>       <span class="hljs-number">310</span><br>         <span class="hljs-string">å‡ºç”Ÿåœ°</span>       <span class="hljs-number">0.94</span>      <span class="hljs-number">0.95</span>      <span class="hljs-number">0.94</span>      <span class="hljs-number">2330</span><br>           <span class="hljs-string">ç›®</span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1271</span><br>          <span class="hljs-string">é¢ç§¯</span>       <span class="hljs-number">0.90</span>      <span class="hljs-number">0.92</span>      <span class="hljs-number">0.91</span>        <span class="hljs-number">79</span><br>          <span class="hljs-string">ç®€ç§°</span>       <span class="hljs-number">0.97</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">0.98</span>       <span class="hljs-number">138</span><br>        <span class="hljs-string">ä¸Šæ˜ æ—¶é—´</span>       <span class="hljs-number">0.94</span>      <span class="hljs-number">0.98</span>      <span class="hljs-number">0.96</span>       <span class="hljs-number">463</span><br>          <span class="hljs-string">å¦»å­</span>       <span class="hljs-number">0.91</span>      <span class="hljs-number">0.83</span>      <span class="hljs-number">0.87</span>       <span class="hljs-number">680</span><br>        <span class="hljs-string">æ‰€å±ä¸“è¾‘</span>       <span class="hljs-number">0.97</span>      <span class="hljs-number">0.97</span>      <span class="hljs-number">0.97</span>      <span class="hljs-number">1282</span><br>        <span class="hljs-string">æ³¨å†Œèµ„æœ¬</span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>        <span class="hljs-number">63</span><br>          <span class="hljs-string">é¦–éƒ½</span>       <span class="hljs-number">0.92</span>      <span class="hljs-number">0.96</span>      <span class="hljs-number">0.94</span>        <span class="hljs-number">47</span><br>          <span class="hljs-string">å¯¼æ¼”</span>       <span class="hljs-number">0.92</span>      <span class="hljs-number">0.94</span>      <span class="hljs-number">0.93</span>      <span class="hljs-number">2603</span><br>           <span class="hljs-string">å­—</span>       <span class="hljs-number">0.96</span>      <span class="hljs-number">0.97</span>      <span class="hljs-number">0.97</span>       <span class="hljs-number">339</span><br>          <span class="hljs-string">èº«é«˜</span>       <span class="hljs-number">0.98</span>      <span class="hljs-number">0.98</span>      <span class="hljs-number">0.98</span>       <span class="hljs-number">393</span><br>        <span class="hljs-string">å‡ºå“å…¬å¸</span>       <span class="hljs-number">0.96</span>      <span class="hljs-number">0.96</span>      <span class="hljs-number">0.96</span>       <span class="hljs-number">851</span><br>        <span class="hljs-string">ä¿®ä¸šå¹´é™</span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>         <span class="hljs-number">2</span><br>        <span class="hljs-string">å‡ºç”Ÿæ—¥æœŸ</span>       <span class="hljs-number">0.99</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">2892</span><br>         <span class="hljs-string">åˆ¶ç‰‡äºº</span>       <span class="hljs-number">0.69</span>      <span class="hljs-number">0.88</span>      <span class="hljs-number">0.77</span>       <span class="hljs-number">127</span><br>          <span class="hljs-string">æ¯äº²</span>       <span class="hljs-number">0.75</span>      <span class="hljs-number">0.88</span>      <span class="hljs-number">0.81</span>       <span class="hljs-number">425</span><br>          <span class="hljs-string">ç¼–å‰§</span>       <span class="hljs-number">0.82</span>      <span class="hljs-number">0.80</span>      <span class="hljs-number">0.81</span>       <span class="hljs-number">771</span><br>          <span class="hljs-string">å›½ç±</span>       <span class="hljs-number">0.92</span>      <span class="hljs-number">0.92</span>      <span class="hljs-number">0.92</span>      <span class="hljs-number">1621</span><br>          <span class="hljs-string">æµ·æ‹”</span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>        <span class="hljs-number">43</span><br>        <span class="hljs-string">è¿è½½ç½‘ç«™</span>       <span class="hljs-number">0.98</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">1658</span><br>          <span class="hljs-string">ä¸ˆå¤«</span>       <span class="hljs-number">0.84</span>      <span class="hljs-number">0.91</span>      <span class="hljs-number">0.87</span>       <span class="hljs-number">678</span><br>          <span class="hljs-string">æœä»£</span>       <span class="hljs-number">0.85</span>      <span class="hljs-number">0.92</span>      <span class="hljs-number">0.88</span>       <span class="hljs-number">419</span><br>          <span class="hljs-string">æ°‘æ—</span>       <span class="hljs-number">0.98</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">1434</span><br>           <span class="hljs-string">å·</span>       <span class="hljs-number">0.95</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">0.97</span>       <span class="hljs-number">197</span><br>         <span class="hljs-string">å‡ºç‰ˆç¤¾</span>       <span class="hljs-number">0.98</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">2272</span><br>         <span class="hljs-string">ä¸»æŒäºº</span>       <span class="hljs-number">0.82</span>      <span class="hljs-number">0.86</span>      <span class="hljs-number">0.84</span>       <span class="hljs-number">200</span><br>        <span class="hljs-string">ä¸“ä¸šä»£ç </span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>         <span class="hljs-number">3</span><br>          <span class="hljs-string">æ­Œæ‰‹</span>       <span class="hljs-number">0.89</span>      <span class="hljs-number">0.94</span>      <span class="hljs-number">0.91</span>      <span class="hljs-number">2857</span><br>          <span class="hljs-string">ä½œè¯</span>       <span class="hljs-number">0.85</span>      <span class="hljs-number">0.81</span>      <span class="hljs-number">0.83</span>       <span class="hljs-number">884</span><br>          <span class="hljs-string">ä¸»è§’</span>       <span class="hljs-number">0.86</span>      <span class="hljs-number">0.77</span>      <span class="hljs-number">0.81</span>        <span class="hljs-number">39</span><br>         <span class="hljs-string">è‘£äº‹é•¿</span>       <span class="hljs-number">0.81</span>      <span class="hljs-number">0.74</span>      <span class="hljs-number">0.78</span>        <span class="hljs-number">47</span><br>        <span class="hljs-string">æ¯•ä¸šé™¢æ ¡</span>       <span class="hljs-number">0.99</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">1433</span><br>        <span class="hljs-string">å åœ°é¢ç§¯</span>       <span class="hljs-number">0.89</span>      <span class="hljs-number">0.89</span>      <span class="hljs-number">0.89</span>        <span class="hljs-number">61</span><br>        <span class="hljs-string">å®˜æ–¹è¯­è¨€</span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>        <span class="hljs-number">15</span><br>        <span class="hljs-string">é‚®æ”¿ç¼–ç </span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>         <span class="hljs-number">4</span><br>        <span class="hljs-string">äººå£æ•°é‡</span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>        <span class="hljs-number">45</span><br>        <span class="hljs-string">æ‰€åœ¨åŸå¸‚</span>       <span class="hljs-number">0.90</span>      <span class="hljs-number">0.94</span>      <span class="hljs-number">0.92</span>        <span class="hljs-number">77</span><br>          <span class="hljs-string">ä½œè€…</span>       <span class="hljs-number">0.97</span>      <span class="hljs-number">0.97</span>      <span class="hljs-number">0.97</span>      <span class="hljs-number">4359</span><br>        <span class="hljs-string">æˆç«‹æ—¥æœŸ</span>       <span class="hljs-number">0.99</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">0.99</span>      <span class="hljs-number">1608</span><br>          <span class="hljs-string">ä½œæ›²</span>       <span class="hljs-number">0.78</span>      <span class="hljs-number">0.77</span>      <span class="hljs-number">0.78</span>       <span class="hljs-number">849</span><br>          <span class="hljs-string">æ°”å€™</span>       <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>      <span class="hljs-number">1.00</span>       <span class="hljs-number">103</span><br>          <span class="hljs-string">å˜‰å®¾</span>       <span class="hljs-number">0.76</span>      <span class="hljs-number">0.72</span>      <span class="hljs-number">0.74</span>       <span class="hljs-number">158</span><br>          <span class="hljs-string">ä¸»æ¼”</span>       <span class="hljs-number">0.94</span>      <span class="hljs-number">0.97</span>      <span class="hljs-number">0.95</span>      <span class="hljs-number">7383</span><br>         <span class="hljs-string">æ”¹ç¼–è‡ª</span>       <span class="hljs-number">0.95</span>      <span class="hljs-number">0.82</span>      <span class="hljs-number">0.88</span>        <span class="hljs-number">71</span><br>         <span class="hljs-string">åˆ›å§‹äºº</span>       <span class="hljs-number">0.86</span>      <span class="hljs-number">0.87</span>      <span class="hljs-number">0.86</span>        <span class="hljs-number">75</span><br><br>    <span class="hljs-string">accuracy</span>                           <span class="hljs-number">0.93</span>     <span class="hljs-number">49506</span><br>   <span class="hljs-string">macro</span> <span class="hljs-string">avg</span>       <span class="hljs-number">0.92</span>      <span class="hljs-number">0.92</span>      <span class="hljs-number">0.92</span>     <span class="hljs-number">49506</span><br><span class="hljs-string">weighted</span> <span class="hljs-string">avg</span>       <span class="hljs-number">0.93</span>      <span class="hljs-number">0.93</span>      <span class="hljs-number">0.93</span>     <span class="hljs-number">49506</span><br></code></pre></td></tr></table></figure><h3 id="ä¸‰å…ƒç»„æå–">ä¸‰å…ƒç»„æå–</h3><p>æœ€åä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æœ¬æ¬¡æ¯”èµ›çš„æœ€ç»ˆç›®æ ‡ï¼Œå°±æ˜¯ä¸‰å…ƒç»„æå–ã€‚</p><p>ä¸‰å…ƒç»„æå–é‡‡ç”¨Pipelineæ¨¡å¼ï¼Œå…ˆç”¨åºåˆ—æ ‡æ³¨æ¨¡å‹é¢„æµ‹å¥å­ä¸­çš„å®ä½“ï¼Œç„¶åå†ç”¨å…³ç³»åˆ†ç±»æ¨¡å‹åˆ¤æ–­å®ä½“å…³ç³»çš„ç±»åˆ«ï¼Œè¿‡æ»¤æ‰å…³ç³»ä¸ºæœªçŸ¥çš„æƒ…å½¢ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦æå–çš„ä¸‰å…ƒç»„äº†ã€‚</p><p>ä¸‰å…ƒç»„æå–çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-14 20:41</span><br><span class="hljs-keyword">import</span> os, re, json, traceback<br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><span class="hljs-keyword">from</span> keras_contrib.losses <span class="hljs-keyword">import</span> crf_loss<br><span class="hljs-keyword">from</span> keras_contrib.metrics <span class="hljs-keyword">import</span> crf_accuracy, crf_viterbi_accuracy<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><span class="hljs-keyword">from</span> text_classification.att <span class="hljs-keyword">import</span> Attention<br><br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-comment"># è¯»å–label2idå­—å…¸</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;../sequence_labeling/ccks2019_label2id.json&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> h:<br>    label_id_dict = json.loads(h.read())<br><br>id_label_dict = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> label_id_dict.items()&#125;<br><span class="hljs-comment"># åˆ©ç”¨ALBERTæå–æ–‡æœ¬ç‰¹å¾</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;NONE&quot;</span>, max_seq_len=<span class="hljs-number">128</span>)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># è½½å…¥NERæ¨¡å‹</span><br>custom_objects = &#123;<span class="hljs-string">&#x27;CRF&#x27;</span>: CRF, <span class="hljs-string">&#x27;crf_loss&#x27;</span>: crf_loss, <span class="hljs-string">&#x27;crf_viterbi_accuracy&#x27;</span>: crf_viterbi_accuracy&#125;<br>ner_model = load_model(<span class="hljs-string">&quot;../sequence_labeling/ccks2019_ner.h5&quot;</span>, custom_objects=custom_objects)<br><br><span class="hljs-comment"># è½½å…¥åˆ†ç±»æ¨¡å‹</span><br>best_model_path = <span class="hljs-string">&#x27;../text_classification/models/per-rel-08-0.9234.h5&#x27;</span><br>classification_model = load_model(best_model_path, custom_objects=&#123;<span class="hljs-string">&quot;Attention&quot;</span>: Attention&#125;)<br><br><span class="hljs-comment"># åˆ†ç±»ä¸idçš„å¯¹åº”å…³ç³»</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;../data/relation2id.json&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> g:<br>    relation_id_dict = json.loads(g.read())<br><br>id_relation_dict = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> relation_id_dict.items()&#125;<br><br><br><span class="hljs-comment"># ä»é¢„æµ‹çš„æ ‡ç­¾åˆ—è¡¨ä¸­è·å–å®ä½“</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_entity</span>(<span class="hljs-params">sent, tags_list</span>):<br><br>    entity_dict = defaultdict(<span class="hljs-built_in">list</span>)<br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> char, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(sent, tags_list):<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;B-&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>            entity = char<br>            j = i+<span class="hljs-number">1</span><br>            entity_type = tag.split(<span class="hljs-string">&#x27;-&#x27;</span>)[-<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">while</span> j &lt; <span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(sent), <span class="hljs-built_in">len</span>(tags_list)) <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;I-%s&#x27;</span> % entity_type <span class="hljs-keyword">in</span> tags_list[j]:<br>                entity += sent[j]<br>                j += <span class="hljs-number">1</span><br><br>            entity_dict[entity_type].append(entity)<br><br>        i += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">dict</span>(entity_dict)<br><br><span class="hljs-comment"># ä¸‰å…ƒç»„æå–ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TripleExtract</span>(<span class="hljs-title class_ inherited__">object</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, text</span>):<br>        self.text = text.replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>)    <span class="hljs-comment"># è¾“å…¥å¥å­</span><br><br>    <span class="hljs-comment"># è·å–è¾“å…¥å¥å­ä¸­çš„å®ä½“ï¼ˆå³ï¼šä¸»ä½“å’Œå®¢ä½“ï¼‰</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_entity</span>(<span class="hljs-params">self</span>):<br>        train_x = np.array([f(self. text)])<br>        y = np.argmax(ner_model.predict(train_x), axis=<span class="hljs-number">2</span>)<br>        y = [id_label_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> y[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> _]<br><br>        <span class="hljs-comment"># è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>        <span class="hljs-keyword">return</span> get_entity(self.text, y)<br><br>    <span class="hljs-comment"># å¯¹å®ä½“åšå…³ç³»åˆ¤å®š</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">relation_classify</span>(<span class="hljs-params">self</span>):<br>        entities = self.get_entity()<br>        subjects = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(entities.get(<span class="hljs-string">&quot;SUBJ&quot;</span>, [])))<br>        objs = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(entities.get(<span class="hljs-string">&quot;OBJ&quot;</span>, [])))<br><br>        spo_list = []<br><br>        <span class="hljs-keyword">for</span> subj <span class="hljs-keyword">in</span> subjects:<br>            <span class="hljs-keyword">for</span> obj <span class="hljs-keyword">in</span> objs:<br>                sample = <span class="hljs-string">&#x27;$&#x27;</span>.join([subj, obj, self.text.replace(subj, <span class="hljs-string">&#x27;#&#x27;</span>*<span class="hljs-built_in">len</span>(subj)).replace(obj, <span class="hljs-string">&quot;#&quot;</span>*<span class="hljs-built_in">len</span>(obj))])<br>                vec = bert_model.encode([sample])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>                x_train = np.array([vec])<br><br>                <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹å¹¶è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>                predicted = classification_model.predict(x_train)<br>                y = np.argmax(predicted[<span class="hljs-number">0</span>])<br><br>                relation = id_relation_dict[y]<br>                <span class="hljs-keyword">if</span> relation != <span class="hljs-string">&quot;æœªçŸ¥&quot;</span>:<br>                    spo_list.append([subj, relation, obj])<br><br>        <span class="hljs-keyword">return</span> spo_list<br><br>    <span class="hljs-comment"># æå–ä¸‰å…ƒç»„</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extractor</span>(<span class="hljs-params">self</span>):<br><br>        <span class="hljs-keyword">return</span> self.relation_classify()<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸‰å…ƒç»„æå–è„šæœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-14 20:53</span><br>import os, re, json, traceback<br><span class="hljs-keyword">from</span> pprint import pprint<br><br><span class="hljs-keyword">from</span> triple_extract.triple_extractor import TripleExtract<br><br><br>text = <span class="hljs-string">&quot;çœŸäººç‰ˆçš„ã€ŠèŠ±æœ¨å…°ã€‹ç”±æ–°è¥¿å…°å¯¼æ¼”å¦®åŸºÂ·å¡ç½—æ‰§å¯¼ï¼Œç”±åˆ˜äº¦è²ã€ç”„å­ä¸¹ã€éƒ‘ä½©ä½©ã€å·©ä¿ã€æè¿æ°ç­‰åŠ ç›Ÿï¼Œå‡ ä¹æ˜¯å…¨äºšæ´²é˜µå®¹ã€‚&quot;</span><br><br>triple_extract = TripleExtract(text)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŸæ–‡ï¼š %s&quot;</span> % text)<br>entities = triple_extract.get_entity()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å®ä½“ï¼š &quot;</span>, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27;&#x27;</span>)<br>pprint(entities)<br><br>spo_list = triple_extract.extractor()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸‰å…ƒç»„ï¼š &quot;</span>, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27;&#x27;</span>)<br>pprint(spo_list)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ç½‘ä¸Šæ‰¾å‡ æ¡æ ·æœ¬è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•çš„ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>åŸæ–‡ï¼šçœŸäººç‰ˆçš„ã€ŠèŠ±æœ¨å…°ã€‹ç”±æ–°è¥¿å…°å¯¼æ¼”å¦®åŸºÂ·å¡ç½—æ‰§å¯¼ï¼Œç”±åˆ˜äº¦è²ã€ç”„å­ä¸¹ã€éƒ‘ä½©ä½©ã€å·©ä¿ã€æè¿æ°ç­‰åŠ ç›Ÿï¼Œå‡ ä¹æ˜¯å…¨äºšæ´²é˜µå®¹ã€‚å®ä½“ï¼š {'OBJ': ['å¦®åŸºÂ·å¡ç½—', 'åˆ˜äº¦è²', 'ç”„å­ä¸¹', 'éƒ‘ä½©ä½©', 'å·©ä¿','æè¿æ°'], 'SUBJ': ['èŠ±æœ¨å…°']} ä¸‰å…ƒç»„ï¼š [['èŠ±æœ¨å…°', 'ä¸»æ¼”', 'åˆ˜äº¦è²'],['èŠ±æœ¨å…°', 'å¯¼æ¼”', 'å¦®åŸºÂ·å¡ç½—'], ['èŠ±æœ¨å…°', 'ä¸»æ¼”', 'ç”„å­ä¸¹'],['èŠ±æœ¨å…°', 'ä¸»æ¼”', 'æè¿æ°'], ['èŠ±æœ¨å…°', 'ä¸»æ¼”', 'éƒ‘ä½©ä½©'], ['èŠ±æœ¨å…°','ä¸»æ¼”', 'å·©ä¿']]</p></blockquote><blockquote><p>åŸæ–‡ï¼šã€Šå†’é™©å°ç‹å­ã€‹ä½œè€…å‘¨è‰ºæ–‡å…ˆç”Ÿï¼Œæ•™è‚²ã€æ–‡å­¦é¢†åŸŸçš„ä¸“å®¶å­¦è€…ä»¥åŠæ¥è‡ªå…¨å›½å„åœ°çš„å‡ºç‰ˆä¸šä»ä¸šè€…å‚åŠ äº†æ­¤æ¬¡æ²™é¾™ï¼Œå¹¶å›´ç»•å„¿ç«¥æ–‡å­¦åˆ›ä½œè¿™ä¸€è¯é¢˜åšäº†ç²¾å½©çš„åˆ†äº«ä¸äº¤æµã€‚å®ä½“ï¼š {'OBJ': ['å‘¨è‰ºæ–‡'], 'SUBJ': ['å†’é™©å°ç‹å­']} ä¸‰å…ƒç»„ï¼š[['å†’é™©å°ç‹å­', 'ä½œè€…', 'å‘¨è‰ºæ–‡']]</p></blockquote><blockquote><p>åŸæ–‡ï¼šå®‹åº”æ˜Ÿæ˜¯æ±Ÿè¥¿å¥‰æ–°äººï¼Œå…¬å…ƒ1587å¹´ç”Ÿï¼Œç»å†è¿‡æ˜æœè…è´¥è‡³ç­äº¡çš„æœ€åæ—¶æœŸã€‚å®ä½“ï¼š {'OBJ': ['æ±Ÿè¥¿å¥‰æ–°', '1587å¹´'], 'SUBJ': ['å®‹åº”æ˜Ÿ']} ä¸‰å…ƒç»„ï¼š[['å®‹åº”æ˜Ÿ', 'å‡ºç”Ÿåœ°', 'æ±Ÿè¥¿å¥‰æ–°'], ['å®‹åº”æ˜Ÿ', 'å‡ºç”Ÿæ—¥æœŸ', '1587å¹´']]</p></blockquote><blockquote><p>åŸæ–‡ï¼š éŸ©æ„ˆï¼Œå­—é€€ä¹‹ï¼Œæ²³é˜³ï¼ˆä»Šæ²³å—å­Ÿå¿ï¼‰äººã€‚ å®ä½“ï¼š {'OBJ': ['é€€ä¹‹','æ²³é˜³'], 'SUBJ': ['éŸ©æ„ˆ']} ä¸‰å…ƒç»„ï¼š [['éŸ©æ„ˆ', 'å‡ºç”Ÿåœ°', 'æ²³é˜³'],['éŸ©æ„ˆ', 'å­—', 'é€€ä¹‹']]</p></blockquote><blockquote><p>åŸæ–‡ï¼šå…¬å¼€èµ„æ–™æ˜¾ç¤ºï¼Œæå¼ºï¼Œç”·ï¼Œæ±‰æ—ï¼Œå‡ºç”Ÿäº1971å¹´12æœˆï¼ŒåŒ—äº¬å¸‚äººï¼ŒåŒ—äº¬å¸‚å§”å…šæ ¡åœ¨èŒç ”ç©¶ç”Ÿå­¦å†ï¼Œæ•™è‚²å­¦å­¦å£«å­¦ä½ï¼Œ1996å¹´11æœˆå…¥å…šï¼Œ1993å¹´7æœˆå‚åŠ å·¥ä½œã€‚å®ä½“ï¼š {'OBJ': ['æ±‰æ—', '1971å¹´12æœˆ', 'åŒ—äº¬å¸‚', 'åŒ—äº¬å¸‚å§”å…šæ ¡'], 'SUBJ':['æå¼º']} ä¸‰å…ƒç»„ï¼š [['æå¼º', 'æ°‘æ—', 'æ±‰æ—'], ['æå¼º', 'å‡ºç”Ÿåœ°','åŒ—äº¬å¸‚'], ['æå¼º', 'æ¯•ä¸šé™¢æ ¡', 'åŒ—äº¬å¸‚å§”å…šæ ¡'], ['æå¼º', 'å‡ºç”Ÿæ—¥æœŸ','1971å¹´12æœˆ']]</p></blockquote><blockquote><p>åŸæ–‡ï¼šæ¨ç‰§ï¼Œæœ¬åç‹é–çŒ®ï¼Œæ—©æœŸç¬”åå¶çŠï¼Œ1940å¹´ç”Ÿäºå°æ¹¾èŠ±è²ï¼Œè‘—åè¯—äººã€ä½œå®¶ã€‚å®ä½“ï¼š {'OBJ': ['1940å¹´', 'å°æ¹¾èŠ±è²'], 'SUBJ': ['æ¨ç‰§']} ä¸‰å…ƒç»„ï¼š[['æ¨ç‰§', 'å‡ºç”Ÿåœ°', 'å°æ¹¾èŠ±è²'], ['æ¨ç‰§', 'å‡ºç”Ÿæ—¥æœŸ', '1940å¹´']]</p></blockquote><blockquote><p>åŸæ–‡ï¼š æ¨å¹¿æ˜¯éš‹æ–‡å¸æ¨åšçš„ç¬¬äºŒä¸ªå„¿å­ã€‚ å®ä½“ï¼š {'OBJ': ['æ¨åš'],'SUBJ': ['æ¨å¹¿']} ä¸‰å…ƒç»„ï¼š [['æ¨å¹¿', 'çˆ¶äº²', 'æ¨åš']]</p></blockquote><blockquote><p>åŸæ–‡ï¼šæ­¤æ¬¡æƒç›Šå˜åŠ¨åï¼Œä½•é‡‘æ˜ä¸å¦»å­å®‹ç¦ã€å…¶å­ä½•æµ©ä¸å†æ‹¥æœ‰å¯¹ä¸Šå¸‚å…¬å¸çš„æ§åˆ¶æƒã€‚å®ä½“ï¼š {'OBJ': ['ä½•é‡‘æ˜'], 'SUBJ': ['å®‹ç¦', 'ä½•æµ©']} ä¸‰å…ƒç»„ï¼š [['ä½•æµ©','çˆ¶äº²', 'ä½•é‡‘æ˜'], ['å®‹ç¦', 'ä¸ˆå¤«', 'ä½•é‡‘æ˜']]</p></blockquote><blockquote><p>åŸæ–‡ï¼šçº¿ä¸Šç›´æ’­å‘å¸ƒä¼šä¸­ï¼Œè°­ç»´ç»´é¦–æ¬¡æ¼”ç»äº†æ–°æ­Œã€Šç« å­˜ä»™ã€‹ï¼Œè¿™é¦–æ­Œç”±é’±é›·ä½œæ›²ã€å°¹çº¦ä½œè¯ï¼Œå°¹çº¦ä¹Ÿåœ¨ç›´æ’­ç°åœºé€è¿‡æ‰‹æœºé•œå¤´è·Ÿç½‘å‹äº’åŠ¨èŠå¤©ã€‚å®ä½“ï¼š {'OBJ': ['è°­ç»´ç»´', 'é’±é›·', 'å°¹çº¦', 'å°¹çº¦'], 'SUBJ': ['ç« å­˜ä»™']}ä¸‰å…ƒç»„ï¼š [['ç« å­˜ä»™', 'ä½œæ›²', 'é’±é›·'], ['ç« å­˜ä»™', 'ä½œè¯', 'å°¹çº¦'],['ç« å­˜ä»™', 'æ­Œæ‰‹', 'è°­ç»´ç»´']]</p></blockquote><blockquote><p>åŸæ–‡ï¼š â€œåœŸæœ¨ä¹‹å˜â€åï¼Œé€ å°±äº†æ˜ä»£æ°å‡ºçš„æ°‘æ—è‹±é›„äºè°¦ã€‚ å®ä½“ï¼š {'OBJ':['æ˜ä»£'], 'SUBJ': ['äºè°¦']} ä¸‰å…ƒç»„ï¼š [['äºè°¦', 'æœä»£', 'æ˜ä»£']]</p></blockquote><blockquote><p>åŸæ–‡ï¼šå¦å¤–ï¼Œå“ˆå°”æ»¨å†å²åšç‰©é¦†ä¹Ÿæ˜¯å…¨å›½é¢ç§¯æœ€å°çš„å›½æœ‰åšç‰©é¦†ï¼Œè¯¥åœºé¦†é¢ç§¯åªæœ‰50å¹³æ–¹ç±³ï¼Œå¯ç§°ä¹‹â€œå¾®ç¼©åšç‰©é¦†â€ã€‚å®ä½“ï¼š {'OBJ': ['50å¹³æ–¹ç±³'], 'SUBJ': ['å“ˆå°”æ»¨å†å²åšç‰©é¦†']} ä¸‰å…ƒç»„ï¼š[['å“ˆå°”æ»¨å†å²åšç‰©é¦†', 'å åœ°é¢ç§¯', '50å¹³æ–¹ç±³']]</p></blockquote><blockquote><p>åŸæ–‡ï¼š å­™æ¨çš„å¦ˆå¦ˆå«æ¨æ˜ï¼Œå­™æ¨çš„åå­—åé¢ä¸€ä¸ªå­—ä¹Ÿæ˜¯æ¥æºäºå¥¹çš„åå­—ã€‚å®ä½“ï¼š {'OBJ': ['æ¨æ˜', 'å­™æ¨'], 'SUBJ': ['å­™æ¨']} ä¸‰å…ƒç»„ï¼š [['å­™æ¨','æ¯äº²', 'æ¨æ˜']]</p></blockquote><blockquote><p>åŸæ–‡ï¼šä¼æŸ¥æŸ¥æ˜¾ç¤ºï¼Œè¾¾é‘«ç”µå­æˆç«‹äº1998å¹´6æœˆï¼Œæ³•å®šä»£è¡¨äººå¼ é«˜åœ³ï¼Œæ³¨å†Œèµ„æœ¬772.33ä¸‡ç¾å…ƒï¼Œè‚¡ä¸œä»…æ–°åŠ å¡è¾¾é‘«æ§è‚¡æœ‰é™å…¬å¸ä¸€åã€‚å®ä½“ï¼š {'OBJ': ['1998å¹´6æœˆ'], 'SUBJ': ['è¾¾é‘«ç”µå­']} ä¸‰å…ƒç»„ï¼š[['è¾¾é‘«ç”µå­', 'æˆç«‹æ—¥æœŸ', '1998å¹´6æœˆ']]</p></blockquote><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡æ ‡é¢˜ä¸ºé™å®šé¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–çš„ä¸€æ¬¡å°è¯•ï¼Œä¹‹æ‰€ä»¥å–åä¸ºé™å®šé¢†åŸŸï¼Œæ˜¯å› ä¸ºè¯¥ä»»åŠ¡çš„å®ä½“å…³ç³»æ˜¯ç¡®å®šï¼Œä¸€å…±ä¸º50ç§å…³ç³»ã€‚</p><p>å½“ç„¶ï¼Œä¸Šè¿°æ–¹æ³•è¿˜å­˜åœ¨ç€è¯¸å¤šä¸è¶³ï¼Œå‚è€ƒè‹å»ºæ—çš„æ–‡ç« <ahref="https://spaces.ac.cn/archives/6671">åŸºäºDGCNNå’Œæ¦‚ç‡å›¾çš„è½»é‡çº§ä¿¡æ¯æŠ½å–æ¨¡å‹</a>ï¼Œæˆ‘ä»¬å‘ç°ä¸è¶³ä¹‹å¤„å¦‚ä¸‹ï¼š</p><ul><li><p>ä¸»ä½“å’Œå®¢ä½“çš„æ ‡æ³¨ç­–ç•¥æœ‰é—®é¢˜ï¼Œå› ä¸ºå¥å­ä¸­æœ‰æ—¶å€™ä¸»ä½“å’Œå®¢ä½“ä¼šé‡å åœ¨ä¸€èµ·ï¼›</p></li><li><p>æ–°å¼•å…¥äº†ä¸€ç±»å…³ç³»ï¼šæœªçŸ¥ï¼Œæ˜¯å¦æœ‰åŠæ³•é¿å…å¼•å…¥ï¼›</p></li><li><p>å…¶ä»–ï¼ˆæš‚æ—¶æœªæƒ³åˆ°ï¼‰</p><p>ä»æ¯”èµ›çš„è§’åº¦å°†ï¼Œæœ¬æ–‡çš„åŠæ³•æ•ˆæœæœªçŸ¥ï¼Œåº”è¯¥ä¼šæ¯”è”åˆæ¨¡å‹çš„æ•ˆæœå·®ä¸€äº›ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ä½œä¸ºç¬”è€…è‡ªå·±çš„æ¨¡å‹ï¼Œç®—æ³•æ˜¯ä¸€ç§å°è¯•ï¼Œä¹‹æ‰€ä»¥é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œæ˜¯å› ä¸ºç¬”è€…ä¸€å¼€å§‹æ˜¯ä»å¼€æ”¾é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–å…¥æ‰‹çš„ï¼Œè€Œè¿™ç§æ–¹æ³•æ–¹ä¾¿æ‰©å±•è‡³å¼€æ”¾é¢†åŸŸã€‚å…³äºå¼€æ”¾é¢†åŸŸçš„ä¸‰å…ƒç»„æŠ½å–ï¼Œç¬”è€…ç¨åå°±ä¼šå†™æ–‡ç« ä»‹ç»ï¼Œæ•¬è¯·æœŸå¾…ã€‚æœ¬æ–‡çš„æºä»£ç å·²ç»å…¬å¼€è‡³Githubï¼Œç½‘å€ä¸ºï¼š <ahref="https://github.com/percent4/ccks_triple_extract">https://github.com/percent4/ccks_triple_extract</a>ã€‚</p></li></ul><h3 id="å‚è€ƒç½‘å€">å‚è€ƒç½‘å€</h3><ol type="1"><li>NLPï¼ˆäºŒåäº”ï¼‰å®ç°ALBERT+Bi-LSTM+CRFæ¨¡å‹ï¼šhttps://blog.csdn.net/jclian91/article/details/104826655</li><li>NLPï¼ˆäºŒåä¸€ï¼‰äººç‰©å…³ç³»æŠ½å–çš„ä¸€æ¬¡å®æˆ˜ï¼šhttps://blog.csdn.net/jclian91/article/details/104380371</li><li>åŸºäºDGCNNå’Œæ¦‚ç‡å›¾çš„è½»é‡çº§ä¿¡æ¯æŠ½å–æ¨¡å‹ï¼šhttps://spaces.ac.cn/archives/6671</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>å…³ç³»æŠ½å–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåäº”ï¼‰å®ç°ALBERT+Bi-LSTM+CRFæ¨¡å‹</title>
    <link href="/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%94%EF%BC%89%E5%AE%9E%E7%8E%B0ALBERT-Bi-LSTM-CRF%E6%A8%A1%E5%9E%8B/"/>
    <url>/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%94%EF%BC%89%E5%AE%9E%E7%8E%B0ALBERT-Bi-LSTM-CRF%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB/">NLPï¼ˆäºŒåå››ï¼‰åˆ©ç”¨ALBERTå®ç°å‘½åå®ä½“è¯†åˆ«</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†ALBERT+Bi-LSTMæ¨¡å‹åœ¨å‘½åå®ä½“è¯†åˆ«æ–¹é¢çš„åº”ç”¨ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œç¬”è€…å°†ä»‹ç»å¦‚ä½•å®ç°ALBERT+Bi-LSTM+CRFæ¨¡å‹ï¼Œä»¥åŠåœ¨äººæ°‘æ—¥æŠ¥NERæ•°æ®é›†å’ŒCLUENERæ•°æ®é›†ä¸Šçš„è¡¨ç°ã€‚</p><p>åŠŸèƒ½é¡¹ç›®æ–¹é¢çš„ä»‹ç»é‡Œé¢ä¸å†å¤šä»‹ç»ï¼Œç¬”è€…åªä»‹ç»æ¨¡å‹è®­ç»ƒå’Œæ¨¡å‹é¢„æµ‹éƒ¨åˆ†çš„ä»£ç ã€‚é¡¹ç›®æ–¹é¢çš„ä»£ç å¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB/">NLPï¼ˆäºŒåå››ï¼‰åˆ©ç”¨ALBERTå®ç°å‘½åå®ä½“è¯†åˆ«</a>ï¼Œæ¨¡å‹ä¸ºALBERT+Bi-LSTM+CRFï¼Œç»“æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp25_1.png" alt="ALBERT+Bi-LSTM+CRFæ¨¡å‹ç»“æ„å›¾" /><figcaption aria-hidden="true">ALBERT+Bi-LSTM+CRFæ¨¡å‹ç»“æ„å›¾</figcaption></figure><p>æ¨¡å‹è®­ç»ƒçš„ä»£ç ï¼ˆalbert_model_train.pyï¼‰ä¸­æ–°å¢å¯¼å…¥keras-contribæ¨¡å—ä¸­çš„CRFå±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><span class="hljs-keyword">from</span> keras_contrib.losses <span class="hljs-keyword">import</span> crf_loss<br><span class="hljs-keyword">from</span> keras_contrib.metrics <span class="hljs-keyword">import</span> crf_accuracy, crf_viterbi_accuracy<br></code></pre></td></tr></table></figure><p>æ¨¡å‹æ–¹é¢çš„ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Build model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_model</span>(<span class="hljs-params">max_para_length, n_tags</span>):<br>    <span class="hljs-comment"># Bert Embeddings</span><br>    bert_output = Input(shape=(max_para_length, <span class="hljs-number">312</span>, ), name=<span class="hljs-string">&quot;bert_output&quot;</span>)<br>    <span class="hljs-comment"># LSTM model</span><br>    lstm = Bidirectional(LSTM(units=<span class="hljs-number">128</span>, return_sequences=<span class="hljs-literal">True</span>), name=<span class="hljs-string">&quot;bi_lstm&quot;</span>)(bert_output)<br>    drop = Dropout(<span class="hljs-number">0.1</span>, name=<span class="hljs-string">&quot;dropout&quot;</span>)(lstm)<br>    dense = TimeDistributed(Dense(n_tags, activation=<span class="hljs-string">&quot;softmax&quot;</span>), name=<span class="hljs-string">&quot;time_distributed&quot;</span>)(drop)<br>    crf = CRF(n_tags)<br>    out = crf(dense)<br>    model = Model(inputs=bert_output, outputs=out)<br>    <span class="hljs-comment"># model.compile(optimizer=&#x27;adam&#x27;, loss=&#x27;categorical_crossentropy&#x27;, metrics=[&#x27;accuracy&#x27;])</span><br>    model.<span class="hljs-built_in">compile</span>(loss=crf.loss_function, optimizer=<span class="hljs-string">&#x27;adam&#x27;</span>, metrics=[crf.accuracy])<br><br>    <span class="hljs-comment"># æ¨¡å‹ç»“æ„æ€»ç»“</span><br>    model.summary()<br>    plot_model(model, to_file=<span class="hljs-string">&quot;albert_bi_lstm.png&quot;</span>, show_shapes=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">return</span> model<br></code></pre></td></tr></table></figure></p><p>è®¾ç½®æ–‡æœ¬çš„æœ€å¤§é•¿åº¦MAX_SEQ_LEN =128ï¼Œè®­ç»ƒ10ä¸ªepochï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„F1å€¼ï¼ˆåˆ©ç”¨seqevalæ¨¡å—è¯„ä¼°ï¼‰è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache">           <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>      <span class="hljs-attribute">LOC</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9766</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9032</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9385</span>      <span class="hljs-number">3658</span><br>      <span class="hljs-attribute">ORG</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9700</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9465</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9581</span>      <span class="hljs-number">2185</span><br>      <span class="hljs-attribute">PER</span>     <span class="hljs-number">0</span>.<span class="hljs-number">9880</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9721</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9800</span>      <span class="hljs-number">1864</span><br><br><span class="hljs-attribute">micro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9775</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9321</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9543</span>      <span class="hljs-number">7707</span><br><span class="hljs-attribute">macro</span> avg     <span class="hljs-number">0</span>.<span class="hljs-number">9775</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9321</span>    <span class="hljs-number">0</span>.<span class="hljs-number">9541</span>      <span class="hljs-number">7707</span><br></code></pre></td></tr></table></figure><p>ä¹‹å‰ç”¨ALBERT+Bi-LSTMæ¨¡å‹å¾—åˆ°çš„F1å€¼ä¸º91.96%ï¼Œè€ŒALBERT+Bi-LSTM+CRFæ¨¡å‹èƒ½è¾¾åˆ°95.43%ï¼Œæå‡æ•ˆæœä¸é”™ã€‚</p><p>æ¨¡å‹é¢„æµ‹ä»£ç ï¼ˆmodel_predict.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-11 13:16</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras_contrib.layers <span class="hljs-keyword">import</span> CRF<br><span class="hljs-keyword">from</span> keras_contrib.losses <span class="hljs-keyword">import</span> crf_loss<br><span class="hljs-keyword">from</span> keras_contrib.metrics <span class="hljs-keyword">import</span> crf_accuracy, crf_viterbi_accuracy<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> MAX_SEQ_LEN, event_type<br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-comment"># è¯»å–label2idå­—å…¸</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s_label2id.json&quot;</span> % event_type, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> h:<br>    label_id_dict = json.loads(h.read())<br><br>id_label_dict = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> label_id_dict.items()&#125;<br><br><span class="hljs-comment"># åˆ©ç”¨ALBERTæå–æ–‡æœ¬ç‰¹å¾</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;NONE&quot;</span>, max_seq_len=MAX_SEQ_LEN)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># è½½å…¥æ¨¡å‹</span><br>custom_objects = &#123;<span class="hljs-string">&#x27;CRF&#x27;</span>: CRF, <span class="hljs-string">&#x27;crf_loss&#x27;</span>: crf_loss, <span class="hljs-string">&#x27;crf_viterbi_accuracy&#x27;</span>: crf_viterbi_accuracy&#125;<br>ner_model = load_model(<span class="hljs-string">&quot;%s_ner.h5&quot;</span> % event_type, custom_objects=custom_objects)<br><br><br><span class="hljs-comment"># ä»é¢„æµ‹çš„æ ‡ç­¾åˆ—è¡¨ä¸­è·å–å®ä½“</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_entity</span>(<span class="hljs-params">sent, tags_list</span>):<br><br>    entity_dict = defaultdict(<span class="hljs-built_in">list</span>)<br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> char, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(sent, tags_list):<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;B-&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>            entity = char<br>            j = i+<span class="hljs-number">1</span><br>            entity_type = tag.split(<span class="hljs-string">&#x27;-&#x27;</span>)[-<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">while</span> j &lt; <span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(sent), <span class="hljs-built_in">len</span>(tags_list)) <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;I-%s&#x27;</span> % entity_type <span class="hljs-keyword">in</span> tags_list[j]:<br>                entity += sent[j]<br>                j += <span class="hljs-number">1</span><br><br>            entity_dict[entity_type].append(entity)<br><br>        i += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">dict</span>(entity_dict)<br><br><br><span class="hljs-comment"># è¾“å…¥å¥å­ï¼Œè¿›è¡Œé¢„æµ‹</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    <span class="hljs-comment"># è¾“å…¥å¥å­</span><br>    text = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Please enter an sentence: &quot;</span>).replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-comment"># åˆ©ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹</span><br>    train_x = np.array([f(text)])<br>    y = np.argmax(ner_model.predict(train_x), axis=<span class="hljs-number">2</span>)<br>    y = [id_label_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> y[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> _]<br><br>    <span class="hljs-comment"># è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>    pprint(get_entity(text, y))<br></code></pre></td></tr></table></figure><p>åœ¨ç½‘ä¸Šæ‰¾å‡ æ¡æ–°é—»ï¼Œé¢„æµ‹ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-symbol">Please</span> enter an sentence: é©´å¦ˆå¦ˆæ—…æ¸¸ç½‘åˆ›å§‹äººæ´ªæ¸…åè¿‘æ—¥æ¥å—åª’ä½“é‡‡è®¿è°ˆåŠé©´å¦ˆå¦ˆçš„å‘å±•æ¨¡å¼æ—¶è¡¨ç¤ºï¼šç°åœ¨ï¼Œç”µå•†æœ‰ä¸¤ç§åšæ³•â€”â€”å°è€Œç¾çš„ç”µå•†è¿½æ±‚ç›ˆåˆ©ï¼Œå¤§è€Œå…¨çš„ç”µå•†é’Ÿæƒ…è§„æ¨¡ã€‚<br>&#123;<span class="hljs-string">&#x27;PER&#x27;</span>: [<span class="hljs-string">&#x27;æ´ªæ¸…å&#x27;</span>]&#125;<br><span class="hljs-symbol">Please</span> enter an sentence: <span class="hljs-symbol">EF</span>è‹±å­šæ•™è‚²é›†å›¢æ˜¯å…¨çƒæœ€å¤§çš„ç§äººè‹±è¯­æ•™è‚²æœºæ„ï¼Œä¸»è¦è‡´åŠ›äºè‹±è¯­åŸ¹è®­ã€ç•™å­¦æ—…æ¸¸ä»¥åŠè‹±è¯­æ–‡åŒ–äº¤æµç­‰æ–¹é¢ã€‚<br>&#123;<span class="hljs-string">&#x27;ORG&#x27;</span>: [<span class="hljs-string">&#x27;EFè‹±å­šæ•™è‚²é›†å›¢&#x27;</span>]&#125;<br><span class="hljs-symbol">Please</span> enter an sentence: å®‹å…ƒæ—¶æœŸèµ·ï¼Œåœ¨å°æ¹¾æ—©æœŸå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¸­åæ–‡åŒ–ä¼ ç»Ÿå·²éšç€å¤§é™†å¦æ°‘ä¼ å…¥å°æ¹¾ã€‚<br>&#123;<span class="hljs-string">&#x27;LOC&#x27;</span>: [<span class="hljs-string">&#x27;å°æ¹¾&#x27;</span>, <span class="hljs-string">&#x27;ä¸­å&#x27;</span>, <span class="hljs-string">&#x27;å°æ¹¾&#x27;</span>]&#125;<br><span class="hljs-symbol">Please</span> enter an sentence: å¸å¼•äº†ä¼—å¤šæŠ•èµ„è€…æ¥æ´¥å‘å±•ï¼Œåº·å¸ˆå‚…çº¢çƒ§ç‰›è‚‰é¢å°±æ˜¯äº<span class="hljs-number">1992</span>å¹´åœ¨å¤©æ´¥è¯ç”Ÿã€‚<br>&#123;<span class="hljs-string">&#x27;LOC&#x27;</span>: [<span class="hljs-string">&#x27;å¤©æ´¥&#x27;</span>]&#125;<br><span class="hljs-symbol">Please</span> enter an sentence: ç»è¿‡æ¿€çƒˆè§’é€ï¼Œé‚£è‹±æˆ˜é˜ŸæˆåŠŸæ™‹çº§<span class="hljs-number">16</span>å¼ºçš„å­¦å‘˜æœ‰å®åŠ›éå‡¡çš„å§šè´å¨œã€æŒšæƒ…æ„Ÿæ‰“åŠ¨è§‚ä¼—çš„æœ±å…‹ã€éŸ³ä¹åˆ›ä½œèƒ½åŠ›ååˆ†çªå‡ºçš„ä¾¯ç£Šã€‚<br>&#123;<span class="hljs-string">&#x27;PER&#x27;</span>: [<span class="hljs-string">&#x27;å§šè´å¨œ&#x27;</span>, <span class="hljs-string">&#x27;æœ±å…‹&#x27;</span>, <span class="hljs-string">&#x27;ä¾¯ç£Š&#x27;</span>]&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è¯¥æ¨¡å‹åœ¨CLUENERæ•°æ®é›†ä¸Šçš„è¡¨ç°ã€‚CLUENERæ•°æ®é›†æ˜¯åœ¨æ¸…åå¤§å­¦å¼€æºçš„æ–‡æœ¬åˆ†ç±»æ•°æ®é›†THUCTCåŸºç¡€ä¸Šï¼Œé€‰å‡ºéƒ¨åˆ†æ•°æ®è¿›è¡Œç»†ç²’åº¦å‘½åå®ä½“æ ‡æ³¨ï¼ŒåŸæ•°æ®æ¥æºäºSinaNewsRSSï¼Œå®ä½“æœ‰ï¼šåœ°å€ï¼ˆaddressï¼‰ï¼Œä¹¦åï¼ˆbookï¼‰ï¼Œå…¬å¸ï¼ˆcompanyï¼‰ï¼Œæ¸¸æˆï¼ˆgameï¼‰ï¼Œæ”¿åºœï¼ˆgovermentï¼‰ï¼Œç”µå½±ï¼ˆmovieï¼‰ï¼Œå§“åï¼ˆnameï¼‰ï¼Œç»„ç»‡æœºæ„ï¼ˆorganizationï¼‰ï¼ŒèŒä½ï¼ˆpositionï¼‰ï¼Œæ™¯ç‚¹ï¼ˆsceneï¼‰ï¼Œè¯¥æ•°æ®é›†çš„ä»‹ç»ç½‘ç«™ä¸ºï¼š<ahref="https://www.cluebenchmarks.com/introduce.html">https://www.cluebenchmarks.com/introduce.html</a>ã€‚</p><p>ä¸‹è½½æ•°æ®é›†ï¼Œç”¨è„šæœ¬å°†å…¶å¤„ç†æˆæ¨¡å‹æ”¯æŒçš„æ•°æ®æ ¼å¼ï¼Œå› ä¸ºç¼ºå°‘testæ•°æ®é›†ï¼Œæ•…æ¨¡å‹è¯„æµ‹çš„æ—¶å€™ç”¨devæ•°æ®é›†ä»£æ›¿ã€‚è®¾ç½®æ¨¡å‹çš„æ–‡æœ¬æœ€å¤§é•¿åº¦MAX_SEQ_LEN=128ï¼Œè®­ç»ƒ10ä¸ªepochï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„F1å€¼ï¼ˆåˆ©ç”¨seqevalæ¨¡å—è¯„ä¼°ï¼‰è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">sentences</span> <span class="hljs-built_in">length</span>: <span class="hljs-number">10748</span> <br><span class="hljs-keyword">last</span> <span class="hljs-keyword">sentence</span>:  è‰ºæœ¯å®¶ä¹Ÿè®¨åŒç”»å»Šçš„è€æ¿ï¼Œå†…å¿ƒæ¨ä»–ä»¬ï¼Œè¿™æ ·çš„è¯ï¼Œä½ æ˜¯åœ¨è¿™æ ·çš„çŠ¶æ€ä¸‹ï¼Œä¸¤å¹´éƒ½æ˜¯ä¸€æ¬¡æ€§åˆä½œï¼Œç”šè‡³ä¸¤å¹´ã€<br><span class="hljs-built_in">start</span> ALBERT encding<br><span class="hljs-function"><span class="hljs-keyword">end</span> <span class="hljs-title">ALBERT</span> <span class="hljs-title">encoding</span></span><br><span class="hljs-keyword">sentences</span> <span class="hljs-built_in">length</span>: <span class="hljs-number">1343</span> <br><span class="hljs-keyword">last</span> <span class="hljs-keyword">sentence</span>:  å¦å¤–æ„å¤§åˆ©çš„PlayGenerationæ‚å¿—ä¹Ÿåˆšåˆšç»™å‡ºäº†<span class="hljs-number">92</span>%çš„é«˜åˆ†ã€‚<br><span class="hljs-built_in">start</span> ALBERT encding<br><span class="hljs-function"><span class="hljs-keyword">end</span> <span class="hljs-title">ALBERT</span> <span class="hljs-title">encoding</span></span><br><span class="hljs-keyword">sentences</span> <span class="hljs-built_in">length</span>: <span class="hljs-number">1343</span> <br><span class="hljs-keyword">last</span> <span class="hljs-keyword">sentence</span>:  å¦å¤–æ„å¤§åˆ©çš„PlayGenerationæ‚å¿—ä¹Ÿåˆšåˆšç»™å‡ºäº†<span class="hljs-number">92</span>%çš„é«˜åˆ†ã€‚<br><span class="hljs-built_in">start</span> ALBERT encding<br><span class="hljs-function"><span class="hljs-keyword">end</span> <span class="hljs-title">ALBERT</span> <span class="hljs-title">encoding</span></span><br>......<br>.......<br>              precision    recall  f1-score   support<br><br>        book     <span class="hljs-number">0.9343</span>    <span class="hljs-number">0.8421</span>    <span class="hljs-number">0.8858</span>       <span class="hljs-number">152</span><br>    position     <span class="hljs-number">0.9549</span>    <span class="hljs-number">0.8965</span>    <span class="hljs-number">0.9248</span>       <span class="hljs-number">425</span><br>  government     <span class="hljs-number">0.9372</span>    <span class="hljs-number">0.9180</span>    <span class="hljs-number">0.9275</span>       <span class="hljs-number">244</span><br>        game     <span class="hljs-number">0.6968</span>    <span class="hljs-number">0.6725</span>    <span class="hljs-number">0.6844</span>       <span class="hljs-number">287</span><br>organization     <span class="hljs-number">0.8836</span>    <span class="hljs-number">0.8605</span>    <span class="hljs-number">0.8719</span>       <span class="hljs-number">344</span><br>     company     <span class="hljs-number">0.8659</span>    <span class="hljs-number">0.7760</span>    <span class="hljs-number">0.8184</span>       <span class="hljs-number">366</span><br>     address     <span class="hljs-number">0.8394</span>    <span class="hljs-number">0.8187</span>    <span class="hljs-number">0.8289</span>       <span class="hljs-number">364</span><br>       movie     <span class="hljs-number">0.9217</span>    <span class="hljs-number">0.7067</span>    <span class="hljs-number">0.8000</span>       <span class="hljs-number">150</span><br>        name     <span class="hljs-number">0.8771</span>    <span class="hljs-number">0.8071</span>    <span class="hljs-number">0.8406</span>       <span class="hljs-number">451</span><br>       scene     <span class="hljs-number">0.9939</span>    <span class="hljs-number">0.8191</span>    <span class="hljs-number">0.8981</span>       <span class="hljs-number">199</span><br><br>   micro <span class="hljs-built_in">avg</span>     <span class="hljs-number">0.8817</span>    <span class="hljs-number">0.8172</span>    <span class="hljs-number">0.8482</span>      <span class="hljs-number">2982</span><br>   macro <span class="hljs-built_in">avg</span>     <span class="hljs-number">0.8835</span>    <span class="hljs-number">0.8172</span>    <span class="hljs-number">0.8482</span>      <span class="hljs-number">2982</span><br></code></pre></td></tr></table></figure><p>åœ¨ç½‘ä¸Šæ‰¾å‡ æ¡æ–°é—»ï¼Œé¢„æµ‹ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-symbol">Please</span> enter an sentence: æ®ä¸­å±±å¤–ä¾¨å±€æ¶ˆæ¯ï¼Œè¿‘æ—¥ï¼Œç§˜é²å›½ä¼šè®®å‘˜ã€ç¥–ç±ä¸­å±±å¸‚å¼€å‘åŒºçš„ç›åˆ©äºšÂ·æ´ªå¤§å¥³å£«åœ¨ç§˜é²å›½ä¼šå¤§å¦äº²åˆ‡ä¼šè§äº†ä¸­å±±å¸‚äººæ°‘æ”¿åºœå‰¯å¸‚é•¿å†¯ç…œè£ä¸€è¡Œï¼Œå¯¹ä¸­å±±å¸‚å‹å¥½ä»£è¡¨å›¢çš„æ¥è®¿è¡¨ç¤ºçƒ­çƒˆçš„æ¬¢è¿ã€‚<br>&#123;<span class="hljs-string">&#x27;address&#x27;</span>: [<span class="hljs-string">&#x27;ä¸­å±±å¸‚å¼€å‘åŒº&#x27;</span>, <span class="hljs-string">&#x27;ç§˜é²å›½ä¼šå¤§å¦&#x27;</span>],<br> <span class="hljs-string">&#x27;government&#x27;</span>: [<span class="hljs-string">&#x27;ä¸­å±±å¤–ä¾¨å±€&#x27;</span>, <span class="hljs-string">&#x27;ç§˜é²å›½ä¼š&#x27;</span>, <span class="hljs-string">&#x27;ä¸­å±±å¸‚äººæ°‘æ”¿åºœ&#x27;</span>],<br> <span class="hljs-string">&#x27;name&#x27;</span>: [<span class="hljs-string">&#x27;ç›åˆ©äºšÂ·æ´ªå¤§&#x27;</span>, <span class="hljs-string">&#x27;å†¯ç…œè£&#x27;</span>],<br> <span class="hljs-string">&#x27;position&#x27;</span>: [<span class="hljs-string">&#x27;è®®å‘˜&#x27;</span>, <span class="hljs-string">&#x27;å‰¯å¸‚é•¿&#x27;</span>]&#125;<br> <span class="hljs-symbol">Please</span> enter an sentence: â€œéš”ç¦»ç»“æŸå›æ¥ï¼Œå‘ç°å…¬å¸ä¸è§äº†â€ï¼Œç½‘ä¸Šçš„æ®µå­ï¼ŒçœŸå‘ç”Ÿåœ¨äº†æ˜†å±±è¾¾é‘«ç”µå­æœ‰é™å…¬å¸å‘˜å·¥èº«ä¸Šã€‚<br>&#123;<span class="hljs-string">&#x27;company&#x27;</span>: [<span class="hljs-string">&#x27;æ˜†å±±è¾¾é‘«ç”µå­æœ‰é™å…¬å¸&#x27;</span>]&#125;<br><span class="hljs-symbol">Please</span> enter an sentence: ç”±é»„å­éŸ¬ã€æ˜“çƒŠåƒçºã€èƒ¡å†°å¿ã€ç‹å­è…¾ç­‰ä¸€ä¼—é’å¹´æ¼”å‘˜ä¸»æ¼”çš„çƒ­è¡€åŠ±å¿—å‰§ã€Šçƒ­è¡€åŒè¡Œã€‹æ­£åœ¨çƒ­æ’­ä¸­ã€‚<br>&#123;<span class="hljs-string">&#x27;game&#x27;</span>: [<span class="hljs-string">&#x27;ã€Šçƒ­è¡€åŒè¡Œã€‹&#x27;</span>], <span class="hljs-string">&#x27;name&#x27;</span>: [<span class="hljs-string">&#x27;é»„å­éŸ¬&#x27;</span>, <span class="hljs-string">&#x27;æ˜“çƒŠåƒçº&#x27;</span>, <span class="hljs-string">&#x27;èƒ¡å†°å¿&#x27;</span>, <span class="hljs-string">&#x27;ç‹å­è…¾&#x27;</span>], <span class="hljs-string">&#x27;position&#x27;</span>: [<span class="hljs-string">&#x27;æ¼”å‘˜&#x27;</span>]&#125;<br><span class="hljs-symbol">Please</span> enter an sentence: è¿‘æ—¥ï¼Œç”±ä½œå®¶å‡ºç‰ˆç¤¾ä¸»åŠçš„éŸ©ä½œè£ã€Šå¤©ç”Ÿæˆ‘æ‰â€”â€”æç™½ä¼ ã€‹æ–°ä¹¦å‘å¸ƒä¼šåœ¨äº¬ä¸¾è¡Œ<br>&#123;<span class="hljs-string">&#x27;book&#x27;</span>: [<span class="hljs-string">&#x27;ã€Šå¤©ç”Ÿæˆ‘æ‰â€”â€”æç™½ä¼ ã€‹&#x27;</span>], <span class="hljs-string">&#x27;name&#x27;</span>: [<span class="hljs-string">&#x27;éŸ©ä½œè£&#x27;</span>], <span class="hljs-string">&#x27;organization&#x27;</span>: [<span class="hljs-string">&#x27;ä½œå®¶å‡ºç‰ˆç¤¾&#x27;</span>]&#125;<br></code></pre></td></tr></table></figure><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼ŒGithubç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/ALBERT_NER_KERAS">https://github.com/percent4/ALBERT_NER_KERAS</a>ã€‚</p><p>æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»ï¼Œæ¬¢è¿å…³æ³¨ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼š<code>NLPå¥‡å¹»ä¹‹æ—…</code>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>ALBERT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåå››ï¼‰åˆ©ç”¨ALBERTå®ç°å‘½åå®ä½“è¯†åˆ«</title>
    <link href="/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB/"/>
    <url>/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E5%9B%9B%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•åˆ©ç”¨ALBERTæ¥å®ç°<code>å‘½åå®ä½“è¯†åˆ«</code>ã€‚å¦‚æœæœ‰å¯¹<code>å‘½åå®ä½“è¯†åˆ«</code>ä¸æ¸…æ¥šçš„è¯»è€…ï¼Œè¯·å‚è€ƒç¬”è€…çš„æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%EF%BC%88NER%EF%BC%89/">NLPå…¥é—¨ï¼ˆå››ï¼‰å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰</a>ã€‚</p><p>æœ¬æ–‡çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp24_1.png" alt="é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„</figcaption></figure><p>å…¶ä¸­ï¼Œ<code>albert_zh</code>ä¸ºALBERTæå–æ–‡æœ¬ç‰¹å¾æ¨¡å—ï¼Œè¿™æ–¹é¢çš„ä»£ç å·²ç»ç”±åˆ«äººå¼€æºï¼Œæˆ‘ä»¬åªéœ€è¦æ‹¿æ¥ä½¿ç”¨å³å¯ã€‚dataç›®å½•ä¸‹ä¸ºæˆ‘ä»¬æœ¬æ¬¡è®²è§£æ‰€éœ€è¦çš„æ•°æ®ï¼Œå›¾ä¸­åªæœ‰exampleå¼€å¤´çš„æ•°æ®é›†ï¼Œè¿™æ˜¯äººæ°‘æ—¥æŠ¥çš„æ ‡æ³¨è¯­æ–™ï¼Œå®ä½“ä¸ºäººåï¼ˆPERï¼‰ã€åœ°åï¼ˆLOCï¼‰å’Œç»„ç»‡æœºæ„åï¼ˆORGï¼‰ã€‚æ•°æ®é›†ä¸€è¡Œä¸€ä¸ªå­—ç¬¦ä»¥åŠæ ‡æ³¨ç¬¦å·ï¼Œæ ‡æ³¨ç³»ç»Ÿé‡‡ç”¨<code>BIO</code>ç³»ç»Ÿï¼Œæˆ‘ä»¬ä»¥example.trainçš„ç¬¬ä¸€å¥ä¸ºä¾‹ï¼Œæ ‡æ³¨ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">æµ· O<br>é’“ O<br>æ¯” O<br>èµ› O<br>åœ° O<br>ç‚¹ O<br>åœ¨ O<br>å¦ B-LOC<br>é—¨ I-LOC<br>ä¸ O<br>é‡‘ B-LOC<br>é—¨ I-LOC<br>ä¹‹ O<br>é—´ O<br>çš„ O<br>æµ· O<br>åŸŸ O<br>ã€‚ O<br></code></pre></td></tr></table></figure><p>åœ¨<code>utils.py</code>æ–‡ä»¶ä¸­ï¼Œé…ç½®äº†ä¸€äº›å…³äºæ–‡ä»¶è·¯å¾„å’Œæ¨¡å‹å‚æ•°æ–¹é¢çš„ä¿¡æ¯ï¼Œå…¶ä¸­è§„å®šäº†è¾“å…¥çš„æ–‡æœ¬é•¿åº¦æœ€å¤§ä¸º128ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-11 21:12</span><br><br><span class="hljs-comment"># æ•°æ®ç›¸å…³çš„é…ç½®</span><br>event_type = <span class="hljs-string">&quot;example&quot;</span><br><br>train_file_path = <span class="hljs-string">&quot;./data/%s.train&quot;</span> % event_type<br>dev_file_path = <span class="hljs-string">&quot;./data/%s.dev&quot;</span> % event_type<br>test_file_path = <span class="hljs-string">&quot;./data/%s.test&quot;</span> % event_type<br><br><span class="hljs-comment"># æ¨¡å‹ç›¸å…³çš„é…ç½®</span><br>MAX_SEQ_LEN = <span class="hljs-number">128</span>   <span class="hljs-comment"># è¾“å…¥çš„æ–‡æœ¬æœ€å¤§é•¿åº¦</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>load_data.py</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†å¤„ç†è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†æ•°æ®ï¼Œå¹¶å°†æ ‡ç­¾è½¬æ¢ä¸ºidï¼Œå½¢æˆlabel2id.jsonæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-11 10:04</span><br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> train_file_path, event_type<br><br><br><span class="hljs-comment"># è¯»å–æ•°æ®é›†</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_data</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-comment"># è¯»å–æ•°æ®é›†</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br>    <span class="hljs-comment"># æ·»åŠ åŸæ–‡å¥å­ä»¥åŠè¯¥å¥å­çš„æ ‡ç­¾</span><br><br>    <span class="hljs-comment"># è¯»å–ç©ºè¡Œæ‰€åœ¨çš„è¡Œå·</span><br>    index = [-<span class="hljs-number">1</span>]<br>    index.extend([i <span class="hljs-keyword">for</span> i, _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(content) <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> _])<br>    index.append(<span class="hljs-built_in">len</span>(content))<br><br>    <span class="hljs-comment"># æŒ‰ç©ºè¡Œåˆ†å‰²ï¼Œè¯»å–åŸæ–‡å¥å­åŠæ ‡æ³¨åºåˆ—</span><br>    sentences, tags = [], []<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(index)-<span class="hljs-number">1</span>):<br>        sent, tag = [], []<br>        segment = content[index[j]+<span class="hljs-number">1</span>: index[j+<span class="hljs-number">1</span>]]<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> segment:<br>            sent.append(line.split()[<span class="hljs-number">0</span>])<br>            tag.append(line.split()[-<span class="hljs-number">1</span>])<br><br>        sentences.append(<span class="hljs-string">&#x27;&#x27;</span>.join(sent))<br>        tags.append(tag)<br><br>    <span class="hljs-comment"># å»é™¤ç©ºçš„å¥å­åŠæ ‡æ³¨åºåˆ—ï¼Œä¸€èˆ¬æ”¾åœ¨æœ«å°¾</span><br>    sentences = [_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> sentences <span class="hljs-keyword">if</span> _]<br>    tags = [_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tags <span class="hljs-keyword">if</span> _]<br><br>    <span class="hljs-keyword">return</span> sentences, tags<br><br><br><span class="hljs-comment"># è¯»å–è®­ç»ƒé›†æ•°æ®</span><br><span class="hljs-comment"># å°†æ ‡ç­¾è½¬æ¢æˆid</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">label2id</span>():<br><br>    train_sents, train_tags = read_data(train_file_path)<br><br>    <span class="hljs-comment"># æ ‡ç­¾è½¬æ¢æˆidï¼Œå¹¶ä¿å­˜æˆæ–‡ä»¶</span><br>    unique_tags = []<br>    <span class="hljs-keyword">for</span> seq <span class="hljs-keyword">in</span> train_tags:<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> seq:<br>            <span class="hljs-keyword">if</span> _ <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> unique_tags:<br>                unique_tags.append(_)<br><br>    label_id_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(unique_tags, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(unique_tags) + <span class="hljs-number">1</span>)))<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s_label2id.json&quot;</span> % event_type, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> g:<br>        g.write(json.dumps(label_id_dict, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    label2id()<br></code></pre></td></tr></table></figure><p>è¿è¡Œä»£ç ï¼Œç”Ÿæˆçš„example_label2id.jsonæ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;O&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;B-LOC&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;I-LOC&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;B-PER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;I-PER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;B-ORG&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;I-ORG&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆè¯¥æ–‡ä»¶æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åè¾¹çš„æ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹çš„æ—¶å€™è°ƒç”¨ã€‚</p><p>æ¥ç€å°±æ˜¯æœ€é‡è¦çš„æ¨¡å‹è®­ç»ƒéƒ¨åˆ†äº†ï¼Œæ¨¡å‹çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp24_2.png" alt="æ¨¡å‹ç»“æ„å›¾" /><figcaption aria-hidden="true">æ¨¡å‹ç»“æ„å›¾</figcaption></figure><p>æˆ‘ä»¬é‡‡ç”¨ALBERTä½œä¸ºæ–‡æœ¬ç‰¹å¾æå–ï¼Œåæ¥ç»å…¸çš„åºåˆ—æ ‡æ³¨ç®—æ³•â€”â€”Bi-LSTMç®—æ³•ã€‚<code>albert_model_train.py</code>çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model, Input<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Dense, Bidirectional, Dropout, LSTM, TimeDistributed, Masking<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> to_categorical, plot_model<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> classification_report<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> event_type<br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> MAX_SEQ_LEN, train_file_path, test_file_path, dev_file_path<br><span class="hljs-keyword">from</span> load_data <span class="hljs-keyword">import</span> read_data<br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-comment"># åˆ©ç”¨ALBERTæå–æ–‡æœ¬ç‰¹å¾</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;NONE&quot;</span>, max_seq_len=MAX_SEQ_LEN)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># è¯»å–label2idå­—å…¸</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s_label2id.json&quot;</span> % event_type, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> h:<br>    label_id_dict = json.loads(h.read())<br><br>id_label_dict = &#123;v:k <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> label_id_dict.items()&#125;<br><br><br><span class="hljs-comment"># è½½å…¥æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">input_data</span>(<span class="hljs-params">file_path</span>):<br><br>    sentences, tags = read_data(file_path)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;sentences length: %s &quot;</span> % <span class="hljs-built_in">len</span>(sentences))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;last sentence: &quot;</span>, sentences[-<span class="hljs-number">1</span>])<br><br>    <span class="hljs-comment"># ALBERT ERCODING</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;start ALBERT encding&quot;</span>)<br>    x = np.array([f(sent) <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sentences])<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;end ALBERT encoding&quot;</span>)<br><br>    <span class="hljs-comment"># å¯¹yå€¼ç»Ÿä¸€é•¿åº¦ä¸ºMAX_SEQ_LEN</span><br>    new_y = []<br>    <span class="hljs-keyword">for</span> seq <span class="hljs-keyword">in</span> tags:<br>        num_tag = [label_id_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> seq]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(seq) &lt; MAX_SEQ_LEN:<br>            num_tag = num_tag + [<span class="hljs-number">0</span>] * (MAX_SEQ_LEN-<span class="hljs-built_in">len</span>(seq))<br>        <span class="hljs-keyword">else</span>:<br>            num_tag = num_tag[: MAX_SEQ_LEN]<br><br>        new_y.append(num_tag)<br><br>    <span class="hljs-comment"># å°†yä¸­çš„å…ƒç´ ç¼–ç æˆont-hot encoding</span><br>    y = np.empty(shape=(<span class="hljs-built_in">len</span>(tags), MAX_SEQ_LEN, <span class="hljs-built_in">len</span>(label_id_dict.keys())+<span class="hljs-number">1</span>))<br><br>    <span class="hljs-keyword">for</span> i, seq <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(new_y):<br>        y[i, :, :] = to_categorical(seq, num_classes=<span class="hljs-built_in">len</span>(label_id_dict.keys())+<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> x, y<br><br><br><span class="hljs-comment"># Build model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_model</span>(<span class="hljs-params">max_para_length, n_tags</span>):<br>    <span class="hljs-comment"># Bert Embeddings</span><br>    bert_output = Input(shape=(max_para_length, <span class="hljs-number">312</span>, ), name=<span class="hljs-string">&quot;bert_output&quot;</span>)<br>    <span class="hljs-comment"># LSTM model</span><br>    lstm = Bidirectional(LSTM(units=<span class="hljs-number">128</span>, return_sequences=<span class="hljs-literal">True</span>), name=<span class="hljs-string">&quot;bi_lstm&quot;</span>)(bert_output)<br>    drop = Dropout(<span class="hljs-number">0.1</span>, name=<span class="hljs-string">&quot;dropout&quot;</span>)(lstm)<br>    out = TimeDistributed(Dense(n_tags, activation=<span class="hljs-string">&quot;softmax&quot;</span>), name=<span class="hljs-string">&quot;time_distributed&quot;</span>)(drop)<br>    model = Model(inputs=bert_output, outputs=out)<br>    model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">&#x27;adam&#x27;</span>, loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br>    <span class="hljs-comment"># æ¨¡å‹ç»“æ„æ€»ç»“</span><br>    model.summary()<br>    plot_model(model, to_file=<span class="hljs-string">&quot;albert_bi_lstm.png&quot;</span>, show_shapes=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">return</span> model<br><br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>():<br><br>    <span class="hljs-comment"># è¯»å–è®­ç»ƒé›†ï¼ŒéªŒè¯é›†å’Œæµ‹è¯•é›†æ•°æ®</span><br>    train_x, train_y = input_data(train_file_path)<br>    dev_x, dev_y = input_data(dev_file_path)<br>    test_x, test_y = input_data(test_file_path)<br><br>    <span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br>    model = build_model(MAX_SEQ_LEN, <span class="hljs-built_in">len</span>(label_id_dict.keys())+<span class="hljs-number">1</span>)<br><br>    history = model.fit(train_x, train_y, validation_data=(dev_x, dev_y), batch_size=<span class="hljs-number">32</span>, epochs=<span class="hljs-number">10</span>)<br><br>    model.save(<span class="hljs-string">&quot;%s_ner.h5&quot;</span> % event_type)<br><br>    <span class="hljs-comment"># ç»˜åˆ¶losså’Œaccå›¾åƒ</span><br>    plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>    epochs = <span class="hljs-built_in">len</span>(history.history[<span class="hljs-string">&#x27;loss&#x27;</span>])<br>    plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;loss&#x27;</span>], label=<span class="hljs-string">&#x27;loss&#x27;</span>)<br>    plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;val_loss&#x27;</span>], label=<span class="hljs-string">&#x27;val_loss&#x27;</span>)<br>    plt.legend()<br><br>    plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>    epochs = <span class="hljs-built_in">len</span>(history.history[<span class="hljs-string">&#x27;acc&#x27;</span>])<br>    plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;acc&#x27;</span>], label=<span class="hljs-string">&#x27;acc&#x27;</span>)<br>    plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;val_acc&#x27;</span>], label=<span class="hljs-string">&#x27;val_acc&#x27;</span>)<br>    plt.legend()<br>    plt.savefig(<span class="hljs-string">&quot;%s_loss_acc.png&quot;</span> % event_type)<br><br>    <span class="hljs-comment"># æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°</span><br>    <span class="hljs-comment"># é¢„æµ‹æ ‡ç­¾</span><br>    y = np.argmax(model.predict(test_x), axis=<span class="hljs-number">2</span>)<br>    pred_tags = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(y.shape[<span class="hljs-number">0</span>]):<br>        pred_tags.append([id_label_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> y[i] <span class="hljs-keyword">if</span> _])<br><br>    <span class="hljs-comment"># å› ä¸ºå­˜åœ¨é¢„æµ‹çš„æ ‡ç­¾é•¿åº¦ä¸åŸæ¥çš„æ ‡æ³¨é•¿åº¦ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå› æ­¤éœ€è¦è°ƒæ•´é¢„æµ‹çš„æ ‡ç­¾</span><br>    test_sents, test_tags = read_data(test_file_path)<br>    final_tags = []<br>    <span class="hljs-keyword">for</span> test_tag, pred_tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(test_tags, pred_tags):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(test_tag) == <span class="hljs-built_in">len</span>(pred_tag):<br>            final_tags.append(pred_tag)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(test_tag) &lt; <span class="hljs-built_in">len</span>(pred_tag):<br>            final_tags.append(pred_tag[:<span class="hljs-built_in">len</span>(test_tag)])<br>        <span class="hljs-keyword">else</span>:<br>            final_tags.append(pred_tag + [<span class="hljs-string">&#x27;O&#x27;</span>] * (<span class="hljs-built_in">len</span>(test_tag) - <span class="hljs-built_in">len</span>(pred_tag)))<br><br>    <span class="hljs-comment"># åˆ©ç”¨seqevalå¯¹æµ‹è¯•é›†è¿›è¡ŒéªŒè¯</span><br>    <span class="hljs-built_in">print</span>(classification_report(test_tags, final_tags, digits=<span class="hljs-number">4</span>))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    train_model()<br></code></pre></td></tr></table></figure><p>æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼ˆéƒ¨åˆ†è¾“å‡ºçœç•¥ï¼‰ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs markdown">sentences length: 20864 <br>last sentence:  æ€æƒ³è‡ªç”±æ˜¯å¯¹è‡ªæˆ‘è€Œè¨€ï¼Œç”¨ä¸­å›½ä¼ ç»Ÿçš„è¯´æ³•æ˜¯æœ‰æ‰€ä¸ºï¼›å…¼å®¹å¹¶åŒ…æ˜¯æŒ‡å¯¹å¾…ä»–äººï¼Œè¦æœ‰æ‰€ä¸ä¸ºã€‚<br>start ALBERT encding<br>end ALBERT encoding<br>sentences length: 2318 <br>last sentence:  è‰¯æ€§è‚¿ç˜¤ã€æ¶æ€§è‚¿ç˜¤è™½ç„¶åªæ˜¯ä¸€å­—ä¹‹å·®ï¼Œä½†ä¸¤è€…æœ‰æ ¹æœ¬æ€§çš„å·®åˆ«ã€‚<br>start ALBERT encding<br>end ALBERT encoding<br>sentences length: 4636 <br>last sentence:  å› æ­¤ï¼Œæ‘æ°‘è¿›è¡Œæ°‘ä¸»é€‰ä¸¾çš„å¿ƒæ€æ˜¯åœ¨è¿™æ ·ä¸€ç§èƒŒæ™¯æ˜ è¡¬ä¸‹åŠ ä»¥è¡¨ç°çš„ï¼Œè¿™æ— ç–‘ç»™è¯¥ç‰‡å¢æ·»äº†å‡ åˆ†åšé‡çš„å†å²æ–‡åŒ–æ°›å›´ã€‚<br>start ALBERT encding<br>end ALBERT encoding<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><span class="hljs-section">Layer (type)                 Output Shape              Param #   </span><br><span class="hljs-section">=================================================================</span><br>bert<span class="hljs-emphasis">_output (InputLayer)     (None, 128, 312)          0         </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span><br>bi<span class="hljs-emphasis">_lstm (Bidirectional)      (None, 128, 256)          451584    </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span><br>dropout (Dropout)            (None, 128, 256)          0         <br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><span class="hljs-section">time<span class="hljs-emphasis">_distributed (TimeDistri (None, 128, 8)            2056      </span></span><br><span class="hljs-emphasis"><span class="hljs-section">=================================================================</span></span><br><span class="hljs-emphasis"><span class="hljs-section">Total params: 453,640</span></span><br><span class="hljs-emphasis"><span class="hljs-section">Trainable params: 453,640</span></span><br><span class="hljs-emphasis"><span class="hljs-section">Non-trainable params: 0</span></span><br><span class="hljs-emphasis"><span class="hljs-section"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span></span><br><span class="hljs-section">Train on 20864 samples, validate on 2318 samples</span><br><span class="hljs-section">......</span><br><span class="hljs-section">......</span><br><span class="hljs-section">......</span><br><span class="hljs-section">20864/20864 [==============================] - 97s 5ms/step - loss: 0.0091 - acc: 0.9969 - val<span class="hljs-emphasis">_loss: 0.0397 - val_</span>acc: 0.9900</span><br><span class="hljs-section">           precision    recall  f1-score   support</span><br><span class="hljs-section"></span><br><span class="hljs-section">      ORG     0.9001    0.9112    0.9056      2185</span><br><span class="hljs-section">      LOC     0.9383    0.8898    0.9134      3658</span><br><span class="hljs-section">      PER     0.9543    0.9415    0.9479      1864</span><br><span class="hljs-section"></span><br><span class="hljs-section">micro avg     0.9310    0.9084    0.9196      7707</span><br><span class="hljs-section">macro avg     0.9313    0.9084    0.9195      7707</span><br></code></pre></td></tr></table></figure><p>åœ¨æµ‹è¯•é›†ä¸Šçš„F1å€¼ä¸º91.96%ã€‚åŒæ—¶ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„losså’Œaccæ›²çº¿å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp24_3.png" alt="è®­ç»ƒè¿‡ç¨‹ä¸­çš„losså’Œaccæ›²çº¿å›¾" /><figcaption aria-hidden="true">è®­ç»ƒè¿‡ç¨‹ä¸­çš„losså’Œaccæ›²çº¿å›¾</figcaption></figure><p>æ¨¡å‹é¢„æµ‹éƒ¨åˆ†çš„ä»£ç ï¼ˆè„šæœ¬ä¸ºmodel_predict.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-11 13:16</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> MAX_SEQ_LEN, event_type<br><br><span class="hljs-comment"># è¯»å–label2idå­—å…¸</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s_label2id.json&quot;</span> % event_type, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> h:<br>    label_id_dict = json.loads(h.read())<br><br>id_label_dict = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> label_id_dict.items()&#125;<br><br><span class="hljs-comment"># åˆ©ç”¨ALBERTæå–æ–‡æœ¬ç‰¹å¾</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;NONE&quot;</span>, max_seq_len=MAX_SEQ_LEN)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># è½½å…¥æ¨¡å‹</span><br>ner_model = load_model(<span class="hljs-string">&quot;%s_ner.h5&quot;</span> % event_type)<br><br><br><span class="hljs-comment"># ä»é¢„æµ‹çš„æ ‡ç­¾åˆ—è¡¨ä¸­è·å–å®ä½“</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_entity</span>(<span class="hljs-params">sent, tags_list</span>):<br><br>    entity_dict = defaultdict(<span class="hljs-built_in">list</span>)<br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> char, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(sent, tags_list):<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;B-&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>            entity = char<br>            j = i+<span class="hljs-number">1</span><br>            entity_type = tag.split(<span class="hljs-string">&#x27;-&#x27;</span>)[-<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">while</span> j &lt; <span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(sent), <span class="hljs-built_in">len</span>(tags_list)) <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;I-%s&#x27;</span> % entity_type <span class="hljs-keyword">in</span> tags_list[j]:<br>                entity += sent[j]<br>                j += <span class="hljs-number">1</span><br><br>            entity_dict[entity_type].append(entity)<br><br>        i += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">dict</span>(entity_dict)<br><br><br><span class="hljs-comment"># è¾“å…¥å¥å­ï¼Œè¿›è¡Œé¢„æµ‹</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    <span class="hljs-comment"># è¾“å…¥å¥å­</span><br>    text = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Please enter an sentence: &quot;</span>).replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-comment"># åˆ©ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹</span><br>    train_x = np.array([f(text)])<br>    y = np.argmax(ner_model.predict(train_x), axis=<span class="hljs-number">2</span>)<br>    y = [id_label_dict[_] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> y[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> _]<br><br>    <span class="hljs-comment"># è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>    pprint(get_entity(text, y)<br></code></pre></td></tr></table></figure><p>éšæœºåœ¨ç½‘ä¸Šæ‰¾å‡ æ¡æ–°é—»æµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>Please enter an sentence:æ˜¨å¤©è¿›è¡Œçš„å¥³å•åŠå†³èµ›ä¸­ï¼Œé™ˆæ¢¦4-2å‡»è´¥äº†é˜Ÿå‹ç‹æ›¼æ˜±ï¼Œä¼Šè—¤ç¾è¯šåˆ™ä»¥4-0æ¨ªæ‰«äº†ä¸­å›½é€‰æ‰‹ä¸å®ã€‚{'LOC': ['ä¸­å›½'], 'PER': ['é™ˆæ¢¦', 'ç‹æ›¼æ˜±', 'ä¼Šè—¤ç¾è¯š', 'ä¸å®']} Pleaseenter an sentence:æŠ¥é“è¿˜æåˆ°ï¼Œå¾·å›½å«ç”Ÿéƒ¨é•¿å»¶æ–¯Â·æ–½æ½˜åœ¨ä¼šä¸Šä¹Ÿè¡¨ç¤ºï¼Œå¦‚æœä¸èƒ½ç‡å…ˆå¼€å‘å‡ºä¸”ä½¿ç”¨ç–«è‹—ï¼Œé‚£ä¹ˆ60%è‡³70%çš„äººå¯èƒ½ä¼šè¢«æ„ŸæŸ“æ–°å† ç—…æ¯’ã€‚{'ORG': ['å¾·å›½å«ç”Ÿéƒ¨'], 'PER': ['å»¶æ–¯Â·æ–½æ½˜']} Please enter an sentence:â€œéš”ç¦»ç»“æŸå›æ¥ï¼Œå‘ç°å…¬å¸ä¸è§äº†â€ï¼Œç½‘ä¸Šçš„æ®µå­ï¼ŒçœŸå‘ç”Ÿåœ¨äº†æ˜†å±±è¾¾é‘«ç”µå­æœ‰é™å…¬å¸å‘˜å·¥èº«ä¸Šã€‚{'ORG': ['æ˜†å±±è¾¾é‘«ç”µå­æœ‰é™å…¬å¸']} Please enter an sentence:çœŸäººç‰ˆçš„ã€ŠèŠ±æœ¨å…°ã€‹ç”±æ–°è¥¿å…°å¯¼æ¼”å¦®åŸºÂ·å¡ç½—æ‰§å¯¼ï¼Œç”±åˆ˜äº¦è²ã€ç”„å­ä¸¹ã€éƒ‘ä½©ä½©ã€å·©ä¿ã€æè¿æ°ç­‰åŠ ç›Ÿï¼Œå‡ ä¹æ˜¯å…¨äºšæ´²æ•´å®¹ã€‚{'LOC': ['æ–°è¥¿å…°', 'äºšæ´²'], 'PER': ['å¦®åŸºÂ·å¡ç½—', 'åˆ˜äº¦è²', 'ç”„å­ä¸¹','éƒ‘ä½©ä½©', 'å·©ä¿', 'æè¿æ°']}</p></blockquote><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼ŒGithubç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/ALBERT_NER_KERAS">https://github.com/percent4/ALBERT_NER_KERAS</a>ã€‚</p><p>æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»ï¼Œæ¬¢è¿å…³æ³¨ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼š<code>NLPå¥‡å¹»ä¹‹æ—…</code>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>NER</tag>
      
      <tag>ALBERT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåä¸‰ï¼‰åºåˆ—æ ‡æ³¨ç®—æ³•è¯„ä¼°æ¨¡å—seqevalçš„ä½¿ç”¨</title>
    <link href="/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%89%EF%BC%89%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E7%AE%97%E6%B3%95%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9D%97seqeval%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/07/09/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%89%EF%BC%89%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E7%AE%97%E6%B3%95%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9D%97seqeval%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨NLPä¸­ï¼Œåºåˆ—æ ‡æ³¨ç®—æ³•æ˜¯å¸¸è§çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä½†æ˜¯ï¼Œå¯¹äºåºåˆ—æ ‡æ³¨ç®—æ³•çš„è¯„ä¼°ï¼Œæˆ‘ä»¬çœŸçš„ç†Ÿæ‚‰å—ï¼Ÿ</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œç¬”è€…å°†ä¼šåºåˆ—æ ‡æ³¨ç®—æ³•çš„æ¨¡å‹æ•ˆæœè¯„ä¼°æ–¹æ³•å’Œ<code>seqeval</code>çš„ä½¿ç”¨ã€‚</p><h3 id="åºåˆ—æ ‡æ³¨ç®—æ³•çš„æ¨¡å‹æ•ˆæœè¯„ä¼°">åºåˆ—æ ‡æ³¨ç®—æ³•çš„æ¨¡å‹æ•ˆæœè¯„ä¼°</h3><p>åœ¨åºåˆ—æ ‡æ³¨ç®—æ³•ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå½¢æˆå¦‚ä¸‹çš„åºåˆ—åˆ—è¡¨ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;B-MISC</span>&#x27;, <span class="hljs-symbol">&#x27;I-MISC</span>&#x27;, <span class="hljs-symbol">&#x27;B-MISC</span>&#x27;, <span class="hljs-symbol">&#x27;I-MISC</span>&#x27;, <span class="hljs-symbol">&#x27;O</span>&#x27;, <span class="hljs-symbol">&#x27;B-PER</span>&#x27;, <span class="hljs-symbol">&#x27;I-PER</span>&#x27;]<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬åºåˆ—æ ‡æ³¨ç®—æ³•çš„æ ¼å¼æœ‰<code>BIO</code>ï¼Œ<code>IOBES</code>ï¼Œ<code>BMES</code>ç­‰ã€‚å…¶ä¸­ï¼Œ<code>å®ä½“</code>æŒ‡çš„æ˜¯ä»Bå¼€å¤´æ ‡ç­¾å¼€å§‹çš„ï¼ŒåŒä¸€ç±»å‹ï¼ˆæ¯”å¦‚ï¼šPER/LOC/ORGï¼‰çš„ï¼ŒéOçš„è¿ç»­æ ‡ç­¾åºåˆ—ã€‚</p><p>å¸¸è§çš„åºåˆ—æ ‡æ³¨ç®—æ³•çš„æ¨¡å‹æ•ˆæœè¯„ä¼°æŒ‡æ ‡æœ‰å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰ã€æŸ¥å‡†ç‡(percision)ã€å¬å›ç‡(recall)ã€F1å€¼ç­‰ï¼Œè®¡ç®—çš„å…¬å¼å¦‚ä¸‹ï¼š</p><ul><li><p>å‡†ç¡®ç‡: accuracy = é¢„æµ‹å¯¹çš„å…ƒç´ ä¸ªæ•°/æ€»çš„å…ƒç´ ä¸ªæ•°</p></li><li><p>æŸ¥å‡†ç‡ï¼šprecision = é¢„æµ‹æ­£ç¡®çš„å®ä½“ä¸ªæ•° /é¢„æµ‹çš„å®ä½“æ€»ä¸ªæ•°</p></li><li><p>å¬å›ç‡ï¼šrecall = é¢„æµ‹æ­£ç¡®çš„å®ä½“ä¸ªæ•° / æ ‡æ³¨çš„å®ä½“æ€»ä¸ªæ•°</p></li><li><p>F1å€¼ï¼šF1 = 2 <em>å‡†ç¡®ç‡ </em> å¬å›ç‡ / (å‡†ç¡®ç‡ + å¬å›ç‡)</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹çš„çœŸå®åºåˆ—<code>y_true</code>å’Œé¢„æµ‹åºåˆ—<code>y_pred</code>ï¼Œå¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">y_true</span> = [<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;I-PER&#x27;</span>]<br><span class="hljs-attr">y_pred</span> = [<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;I-PER&#x27;</span>]<br></code></pre></td></tr></table></figure><p>åˆ—è¡¨ä¸­ä¸€ä¸ªæœ‰9ä¸ªå…ƒç´ ï¼Œå…¶ä¸­é¢„æµ‹å¯¹çš„å…ƒç´ ä¸ªæ•°ä¸º6ä¸ªï¼Œé‚£ä¹ˆå‡†ç¡®ç‡ä¸º2/3ã€‚æ ‡æ³¨çš„å®ä½“æ€»ä¸ªæ•°ä¸º2ä¸ªï¼Œé¢„æµ‹çš„å®ä½“æ€»ä¸ªæ•°ä¸º3ä¸ªï¼Œé¢„æµ‹æ­£ç¡®çš„å®ä½“ä¸ªæ•°ä¸º1ä¸ªï¼Œé‚£ä¹ˆprecision=1/3,recall=1/2, F1=0.4ã€‚</p><h3 id="seqevalçš„ä½¿ç”¨">seqevalçš„ä½¿ç”¨</h3><p>ä¸€èˆ¬æˆ‘ä»¬çš„åºåˆ—æ ‡æ³¨ç®—æ³•ï¼Œæ˜¯ç”¨<code>conlleval.pl</code>è„šæœ¬å®ç°ï¼Œä½†è¿™æ˜¯ç”¨perlè¯­è¨€å®ç°çš„ã€‚åœ¨Pythonä¸­ï¼Œä¹Ÿæœ‰ç›¸åº”çš„åºåˆ—æ ‡æ³¨ç®—æ³•çš„æ¨¡å‹æ•ˆæœè¯„ä¼°çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œé‚£å°±æ˜¯<code>seqeval</code>ï¼Œå…¶å®˜ç½‘ç½‘å€ä¸ºï¼š<ahref="https://pypi.org/project/seqeval/0.0.3/">https://pypi.org/project/seqeval/0.0.3/</a>ã€‚</p><p><code>seqeval</code>æ”¯æŒ<code>BIO</code>ï¼Œ<code>IOBES</code>æ ‡æ³¨æ¨¡å¼ï¼Œå¯ç”¨äºå‘½åå®ä½“è¯†åˆ«ï¼Œè¯æ€§æ ‡æ³¨ï¼Œè¯­ä¹‰è§’è‰²æ ‡æ³¨ç­‰ä»»åŠ¡çš„è¯„ä¼°ã€‚</p><p>å®˜ç½‘æ–‡æ¡£ä¸­ç»™å‡ºäº†ä¸¤ä¸ªä¾‹å­ï¼Œç¬”è€…ä¿®æ”¹å¦‚ä¸‹ï¼š</p><p>ä¾‹å­1ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> f1_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> precision_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> accuracy_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> recall_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> classification_report<br><br>y_true = [<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;I-PER&#x27;</span>]<br>y_pred = [<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;I-PER&#x27;</span>]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;accuary: &quot;</span>, accuracy_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p: &quot;</span>, precision_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;r: &quot;</span>, recall_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;f1: &quot;</span>, f1_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;classification report: &quot;</span>)<br><span class="hljs-built_in">print</span>(classification_report(y_true, y_pred))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">accuary</span>:  <span class="hljs-number">0</span>.<span class="hljs-number">6666666666666666</span><br><span class="hljs-attribute">p</span>:  <span class="hljs-number">0</span>.<span class="hljs-number">3333333333333333</span><br><span class="hljs-attribute">r</span>:  <span class="hljs-number">0</span>.<span class="hljs-number">5</span><br><span class="hljs-attribute">f1</span>:  <span class="hljs-number">0</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">classification</span> report: <br>           <span class="hljs-attribute">precision</span>    recall  f1-score   support<br><br>     <span class="hljs-attribute">MISC</span>       <span class="hljs-number">0</span>.<span class="hljs-number">00</span>      <span class="hljs-number">0</span>.<span class="hljs-number">00</span>      <span class="hljs-number">0</span>.<span class="hljs-number">00</span>         <span class="hljs-number">1</span><br>      <span class="hljs-attribute">PER</span>       <span class="hljs-number">1</span>.<span class="hljs-number">00</span>      <span class="hljs-number">1</span>.<span class="hljs-number">00</span>      <span class="hljs-number">1</span>.<span class="hljs-number">00</span>         <span class="hljs-number">1</span><br><br><span class="hljs-attribute">micro</span> avg       <span class="hljs-number">0</span>.<span class="hljs-number">33</span>      <span class="hljs-number">0</span>.<span class="hljs-number">50</span>      <span class="hljs-number">0</span>.<span class="hljs-number">40</span>         <span class="hljs-number">2</span><br><span class="hljs-attribute">macro</span> avg       <span class="hljs-number">0</span>.<span class="hljs-number">50</span>      <span class="hljs-number">0</span>.<span class="hljs-number">50</span>      <span class="hljs-number">0</span>.<span class="hljs-number">50</span>         <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>ä¾‹å­2ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> f1_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> precision_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> accuracy_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> recall_score<br><span class="hljs-keyword">from</span> seqeval.metrics <span class="hljs-keyword">import</span> classification_report<br><br>y_true = [[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>], [<span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;I-PER&#x27;</span>]]<br>y_pred =  [[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>], [<span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;I-PER&#x27;</span>]]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;accuary: &quot;</span>, accuracy_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p: &quot;</span>, precision_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;r: &quot;</span>, recall_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;f1: &quot;</span>, f1_score(y_true, y_pred))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;classification report: &quot;</span>)<br><span class="hljs-built_in">print</span>(classification_report(y_true, y_pred))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœåŒä¸Šã€‚</p><h3 id="åœ¨kerasä¸­ä½¿ç”¨seqeval">åœ¨Kerasä¸­ä½¿ç”¨seqeval</h3><p>ç¬”è€…ä¸€å¹´å¤šå¹´å†™è¿‡æ–‡ç« ï¼š<ahref="https://percent4.github.io/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%E7%94%A8%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%EF%BC%88NER%EF%BC%89/">ç”¨æ·±åº¦å­¦ä¹ å®ç°å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰</a>ï¼Œæˆ‘ä»¬å¯¹æ¨¡å‹è®­ç»ƒéƒ¨åˆ†çš„ä»£ç åŠ ä»¥æ”¹é€ ï¼Œä½¿ä¹‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½è¾“å‡ºF1å€¼ã€‚</p><p>åœ¨Githubä¸Šä¸‹è½½é¡¹ç›®<code>DL_4_NER</code>ï¼Œç½‘å€ä¸ºï¼š<ahref="https://github.com/percent4/DL_4_NER">https://github.com/percent4/DL_4_NER</a>ã€‚ä¿®æ”¹utils.pyä¸­çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œä»¥åŠæ¨¡å‹è®­ç»ƒéƒ¨åˆ†çš„ä»£ç ï¼ˆDL_4_NER/Bi_LSTM_Model_training.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> BASE_DIR, CONSTANTS, load_data<br><span class="hljs-keyword">from</span> data_processing <span class="hljs-keyword">import</span> data_processing<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> np_utils, plot_model<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Sequential<br><span class="hljs-keyword">from</span> keras.preprocessing.sequence <span class="hljs-keyword">import</span> pad_sequences<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Bidirectional, LSTM, Dense, Embedding, TimeDistributed<br><br><br><span class="hljs-comment"># æ¨¡å‹è¾“å…¥æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">input_data_for_model</span>(<span class="hljs-params">input_shape</span>):<br><br>    <span class="hljs-comment"># æ•°æ®å¯¼å…¥</span><br>    input_data = load_data()<br>    <span class="hljs-comment"># æ•°æ®å¤„ç†</span><br>    data_processing()<br>    <span class="hljs-comment"># å¯¼å…¥å­—å…¸</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        word_dictionary = pickle.load(f)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">2</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        inverse_word_dictionary = pickle.load(f)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">3</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        label_dictionary = pickle.load(f)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">4</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        output_dictionary = pickle.load(f)<br>    vocab_size = <span class="hljs-built_in">len</span>(word_dictionary.keys())<br>    label_size = <span class="hljs-built_in">len</span>(label_dictionary.keys())<br><br>    <span class="hljs-comment"># å¤„ç†è¾“å…¥æ•°æ®</span><br>    aggregate_function = <span class="hljs-keyword">lambda</span> <span class="hljs-built_in">input</span>: [(word, pos, label) <span class="hljs-keyword">for</span> word, pos, label <span class="hljs-keyword">in</span><br>                                            <span class="hljs-built_in">zip</span>(<span class="hljs-built_in">input</span>[<span class="hljs-string">&#x27;word&#x27;</span>].values.tolist(),<br>                                                <span class="hljs-built_in">input</span>[<span class="hljs-string">&#x27;pos&#x27;</span>].values.tolist(),<br>                                                <span class="hljs-built_in">input</span>[<span class="hljs-string">&#x27;tag&#x27;</span>].values.tolist())]<br><br>    grouped_input_data = input_data.groupby(<span class="hljs-string">&#x27;sent_no&#x27;</span>).apply(aggregate_function)<br>    sentences = [sentence <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> grouped_input_data]<br><br>    x = [[word_dictionary[word[<span class="hljs-number">0</span>]] <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent] <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sentences]<br>    x = pad_sequences(maxlen=input_shape, sequences=x, padding=<span class="hljs-string">&#x27;post&#x27;</span>, value=<span class="hljs-number">0</span>)<br>    y = [[label_dictionary[word[<span class="hljs-number">2</span>]] <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent] <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sentences]<br>    y = pad_sequences(maxlen=input_shape, sequences=y, padding=<span class="hljs-string">&#x27;post&#x27;</span>, value=<span class="hljs-number">0</span>)<br>    y = [np_utils.to_categorical(label, num_classes=label_size + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> y]<br><br>    <span class="hljs-keyword">return</span> x, y, output_dictionary, vocab_size, label_size, inverse_word_dictionary<br><br><br><span class="hljs-comment"># å®šä¹‰æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼šBi-LSTM</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_Bi_LSTM</span>(<span class="hljs-params">vocab_size, label_size, input_shape, output_dim, n_units, out_act, activation</span>):<br>    model = Sequential()<br>    model.add(Embedding(input_dim=vocab_size + <span class="hljs-number">1</span>, output_dim=output_dim,<br>                        input_length=input_shape, mask_zero=<span class="hljs-literal">True</span>))<br>    model.add(Bidirectional(LSTM(units=n_units, activation=activation,<br>                                 return_sequences=<span class="hljs-literal">True</span>)))<br>    model.add(TimeDistributed(Dense(label_size + <span class="hljs-number">1</span>, activation=out_act)))<br>    model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">&#x27;adam&#x27;</span>, loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>    <span class="hljs-keyword">return</span> model<br><br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">model_train</span>():<br><br>    <span class="hljs-comment"># å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå æ¯”ä¸º9:1</span><br>    input_shape = <span class="hljs-number">60</span><br>    x, y, output_dictionary, vocab_size, label_size, inverse_word_dictionary = input_data_for_model(input_shape)<br>    train_end = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(x)*<span class="hljs-number">0.9</span>)<br>    train_x, train_y = x[<span class="hljs-number">0</span>:train_end], np.array(y[<span class="hljs-number">0</span>:train_end])<br>    test_x, test_y = x[train_end:], np.array(y[train_end:])<br><br>    <span class="hljs-comment"># æ¨¡å‹è¾“å…¥å‚æ•°</span><br>    activation = <span class="hljs-string">&#x27;selu&#x27;</span><br>    out_act = <span class="hljs-string">&#x27;softmax&#x27;</span><br>    n_units = <span class="hljs-number">100</span><br>    batch_size = <span class="hljs-number">32</span><br>    epochs = <span class="hljs-number">10</span><br>    output_dim = <span class="hljs-number">20</span><br><br>    <span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br>    lstm_model = create_Bi_LSTM(vocab_size, label_size, input_shape, output_dim, n_units, out_act, activation)<br>    lstm_model.fit(train_x, train_y, validation_data=(test_x, test_y), epochs=epochs, batch_size=batch_size, verbose=<span class="hljs-number">1</span>)<br><br><br>model_train()<br></code></pre></td></tr></table></figure><p>æ¨¡å‹è®­ç»ƒçš„ç»“æœå¦‚ä¸‹ï¼ˆä¸­é—´è¿‡ç¨‹çœç•¥ï¼‰ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">......<br><span class="hljs-number">12598</span><span class="hljs-regexp">/12598 [==============================] - 26s 2ms/</span><span class="hljs-keyword">step</span> - loss: <span class="hljs-number">0.0075</span> - acc: <span class="hljs-number">0.9981</span> - val_loss: <span class="hljs-number">0.2131</span> - val_acc: <span class="hljs-number">0.9592</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¿®æ”¹ä»£ç ï¼Œåœ¨lstm_model.fité‚£ä¸€è¡Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">lables = [<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-MISC&#x27;</span>, <span class="hljs-string">&#x27;I-MISC&#x27;</span>, <span class="hljs-string">&#x27;B-ORG&#x27;</span>, <span class="hljs-string">&#x27;I-ORG&#x27;</span>, <span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;I-PER&#x27;</span>, <span class="hljs-string">&#x27;I-LOC&#x27;</span>, <span class="hljs-string">&#x27;sO&#x27;</span>]<br>   id2label = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(lables)), lables))<br>   callbacks = [F1Metrics(id2label)]<br>   lstm_model.fit(train_x, train_y, validation_data=(test_x, test_y), epochs=epochs,<br>                  batch_size=batch_size, verbose=<span class="hljs-number">1</span>, callbacks=callbacks)<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stata">12598/12598 [==============================] - 26s 2ms/step - loss: 0.0089 - acc: 0.9978 - val_loss: 0.2145 - val_acc: 0.9560<br> - f1: 95.40<br>           precision    recall  f1-<span class="hljs-keyword">score</span>   support<br><br>     MISC     0.9707    0.9833    0.9769     15844<br>      PER     0.9080    0.8194    0.8614      1157<br>      <span class="hljs-keyword">LOC</span>     0.7517    0.8095    0.7795       677<br>      ORG     0.8290    0.7289    0.7757       745<br>       <span class="hljs-keyword">sO</span>     0.7757    0.8300    0.8019       100<br><br>micro avg     0.9524    0.9556    0.9540     18523<br><span class="hljs-keyword">macro</span> avg     0.9520    0.9556    0.9535     18523<br></code></pre></td></tr></table></figure><p>è¿™å°±æ˜¯seqevalçš„å¼ºå¤§ä¹‹å¤„ã€‚</p><p>å…³äºseqevalåœ¨Kerasçš„ä½¿ç”¨ï¼Œæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹å¯ä»¥å‚è€ƒè¯¥é¡¹ç›®çš„Githubç½‘å€ï¼š<ahref="https://github.com/chakki-works/seqeval">https://github.com/chakki-works/seqeval</a>ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼Œæœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸã€‚</p><p>æ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼š<code>NLPå¥‡å¹»ä¹‹æ—…</code>ã€‚</p><h3 id="å‚è€ƒç½‘å€">å‚è€ƒç½‘å€</h3><ol type="1"><li>åºåˆ—æ ‡æ³¨çš„å‡†ç¡®ç‡å’Œå¬å›ç‡è®¡ç®—: <ahref="https://zhuanlan.zhihu.com/p/56582082">https://zhuanlan.zhihu.com/p/56582082</a></li><li>seqevalå®˜æ–¹æ–‡æ¡£ï¼š <ahref="https://pypi.org/project/seqeval/0.0.3/">https://pypi.org/project/seqeval/0.0.3/</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>NLPå·¥å…·</tag>
      
      <tag>åºåˆ—æ ‡æ³¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çŸ¥è¯†å›¾è°±æ„å»ºä¸¾ä¾‹</title>
    <link href="/2023/07/09/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E6%9E%84%E5%BB%BA%E4%B8%BE%E4%BE%8B/"/>
    <url>/2023/07/09/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E6%9E%84%E5%BB%BA%E4%B8%BE%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç¬”è€…åœ¨å»å¹´çš„æ—¶å€™ï¼Œç»™å‡ºäº†åˆ©ç”¨æ·±åº¦å­¦ä¹ æ¥æ„å»ºçŸ¥è¯†å›¾è°±çš„ä¸€æ¬¡å°è¯•ï¼Œæ–‡ç« ä¸ºï¼š<a href="https://percent4.github.io/2023/07/08/%E5%88%A9%E7%94%A8%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E6%9E%84%E5%BB%BA%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/">åˆ©ç”¨å…³ç³»æŠ½å–æ„å»ºçŸ¥è¯†å›¾è°±çš„ä¸€æ¬¡å°è¯•</a> ï¼Œæœ¬æ–‡å°†ä¼šæ›´å‡ºæ›´å¤šçš„ä¾‹å­ï¼Œä¹Ÿæ˜¯ç¬”è€…è¿‘ä¸€ä¸ªæ˜ŸæœŸçš„å¿™ç¢Œç»“æœã€‚<br>ä¸‹é¢ä¸ºçŸ¥è¯†å›¾è°±æ„å»ºçš„ä¾‹å­ï¼Œç”±ç¬”è€…åŸåˆ›ï¼Œæ˜¯ä»æ–°é—»æˆ–è€…å°è¯´ä¸­ç›´æ¥æŠ½å–è€Œæ¥ï¼ŒåŠ ä¸Šå¤§é‡æ—¶é—´çš„äººå·¥æ•´ç†è€Œå¾—åˆ°ï¼Œä¸‹é¢çš„å›¾ç‰‡æ˜¯ä»Neo4Jå¯¼å‡ºå¹¶æˆªå›¾ã€‚<br>ä¾‹å­1ï¼šã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰ï¼š<br><img src="/img/kg2_1.png" alt="ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰"><br>ä¾‹å­2ï¼šã€Šç™½é¹¿åŸã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰ï¼š<br><img src="/img/kg2_2.png" alt="ã€Šç™½é¹¿åŸã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰"><br>ä¾‹å­3ï¼šæ”¿æ²»æ–°é—»å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰ï¼š<br><img src="/img/kg2_3.png" alt="æ”¿æ²»æ–°é—»å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰"><br>ä¾‹å­4ï¼šã€Šç¥é›•ä¾ ä¾£ã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰ï¼š<br><img src="/img/kg2_4.png" alt="ã€Šç¥é›•ä¾ ä¾£ã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰"><br>ä¾‹å­5ï¼šã€Šæ˜æœé‚£äº›äº‹å„¿ã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰ï¼š<br><img src="/img/kg2_5.png" alt="ã€Šæ˜æœé‚£äº›äº‹å„¿ã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰"><br>ä¾‹å­6ï¼šã€Šæ›¾å›½è—©ã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰ï¼š<br><img src="/img/kg2_6.png" alt="ã€Šæ›¾å›½è—©ã€‹å®ä½“å…³ç³»å›¾ï¼ˆå±€éƒ¨ï¼‰"></p><p>ä»¥ä¸Šå±•ç¤ºçš„å›¾ä»¥åŠæ•°æ®æ”¾åœ¨Githubä¸Šï¼Œç½‘å€ä¸ºï¼š<a href="https://github.com/percent4/knowledge_graph_demo">https://github.com/percent4/knowledge_graph_demo</a> ã€‚<br>å…³äºè¿™æ–¹é¢çš„æŠ€æœ¯å’Œæ•°æ®å°†ä¼šåœ¨ä¸ä¹…åå…¬å¼€ï¼Œä»£ç å’Œæ•°æ®å·²ç»æ”¾åœ¨Githubä¸Šï¼Œç½‘å€ä¸ºï¼š<a href="https://github.com/percent4/spo_extract_platform">https://github.com/percent4/spo_extract_platform</a> ï¼Œç¬”è€…å°†ä¼šå¦å†™æ–‡ç« æ¥ä»‹ç»ã€‚</p><p>æ„Ÿè§‰å¤§å®¶çš„é˜…è¯»ï¼Œç¬”è€…å°†ä¼šåœ¨ä¸ä¹…ä¹‹åå…¬å¼€è¯¥æŠ€æœ¯çš„æºä»£ç å’Œæ•°æ®ï¼Œæ•¬è¯·æœŸå¾…~</p><blockquote><p>æ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼š<code>NLPå¥‡å¹»ä¹‹æ—…</code> ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†å›¾è°±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çŸ¥è¯†å›¾è°±</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåäºŒï¼‰åˆ©ç”¨ALBERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%BA%8C%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8BERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåï¼‰åˆ©ç”¨BERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨BERTæ¥å®ç°æ–‡æœ¬äºŒåˆ†ç±»åŠŸèƒ½ï¼Œä»¥åˆ¤åˆ«æ˜¯å¦å±äºå‡ºè®¿ç±»äº‹ä»¶ä¸ºä¾‹å­ã€‚ä½†æ˜¯å‘¢ï¼Œåˆ©ç”¨BERTåœ¨åšæ¨¡å‹é¢„æµ‹çš„æ—¶å€™å­˜åœ¨é¢„æµ‹æ—¶é—´è¾ƒé•¿çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è€ƒè™‘ç”¨æ–°å‡ºæ¥çš„é¢„è®­ç»ƒæ¨¡å‹æ¥åŠ å¿«æ¨¡å‹é¢„æµ‹é€Ÿåº¦ã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åˆ©ç”¨ALBERTæ¥å®ç°æ–‡æœ¬äºŒåˆ†ç±»ã€‚</p><h3 id="å…³äºalbert">å…³äºALBERT</h3><p>ALBERTçš„æå‡ºæ—¶é—´å¤§çº¦æ˜¯åœ¨2019å¹´10æœˆï¼Œå…¶ç¬¬ä¸€ä½œè€…ä¸ºè°·æ­Œç§‘å­¦å®¶è“æŒ¯å¿ åšå£«ã€‚ALBERTçš„è®ºæ–‡åœ°å€ä¸ºï¼š<ahref="https://openreview.net/pdf?id=H1eA7AEtvS">https://openreview.net/pdf?id=H1eA7AEtvS</a>, Githubé¡¹ç›®åœ°å€ä¸ºï¼š <ahref="https://github.com/brightmart/albert_zh">https://github.com/brightmart/albert_zh</a>ã€‚ç®€å•è¯´æ¥ï¼ŒALBERTæ˜¯BERTçš„ä¸€ä¸ªç²¾ç®€ç‰ˆï¼Œå®ƒåœ¨BERTæ¨¡å‹çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹é€ ï¼Œå‡å°‘äº†å¤§é‡å‚æ•°ï¼Œä½¿å¾—å…¶åœ¨æ¨¡å‹è®­ç»ƒå’Œæ¨¡å‹é¢„æµ‹çš„é€Ÿåº¦ä¸Šæœ‰å¾ˆå¤§æå‡ï¼Œè€Œæ¨¡å‹çš„æ•ˆæœåªä¼šæœ‰å¾®å°å¹…åº¦çš„ä¸‹é™ï¼Œå…·ä½“çš„æ•ˆæœå’Œé€Ÿåº¦æ–¹é¢çš„è¯´æ˜å¯ä»¥å‚è€ƒGithubé¡¹ç›®ã€‚ALBERTç›¸å¯¹äºBERTçš„æ”¹è¿›å¦‚ä¸‹ï¼š</p><ul><li><p>å¯¹Embeddingå› å¼åˆ†è§£ï¼ˆFactorized embeddingparameterizationï¼‰ï¼›</p></li><li><p>è·¨å±‚çš„å‚æ•°å…±äº«ï¼ˆCross-layer parameter sharingï¼‰ï¼›</p></li><li><p>å¥é—´è¿è´¯ï¼ˆInter-sentence coherence lossï¼‰ï¼›</p></li><li><p>ç§»é™¤dropout ã€‚</p><p>ç¬”è€…åœ¨åŒ—äº¬çš„æ—¶å€™ä¹Ÿå†™è¿‡ALBERTåœ¨æå‡åºåˆ—æ ‡æ³¨ç®—æ³•çš„é¢„æµ‹é€Ÿåº¦æ–¹é¢çš„ä¸€ç¯‡æ–‡ç« ï¼š<ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E5%8D%81%E5%85%AB%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E6%8F%90%E5%8D%87%E6%A8%A1%E5%9E%8B%E9%A2%84%E6%B5%8B%E9%80%9F%E5%BA%A6%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/">NLPï¼ˆåå…«ï¼‰åˆ©ç”¨ALBERTæå‡æ¨¡å‹é¢„æµ‹é€Ÿåº¦çš„ä¸€æ¬¡å°è¯•</a>ï¼Œè¯¥é¡¹ç›®çš„Githubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/ALBERT_4_Time_Recognition">https://github.com/percent4/ALBERT_4_Time_Recognition</a>ã€‚</p></li></ul><h3 id="é¡¹ç›®è¯´æ˜">é¡¹ç›®è¯´æ˜</h3><p>æœ¬é¡¹ç›®çš„æ•°æ®å’Œä»£ç ä¸»è¦å‚è€ƒç¬”è€…çš„æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8BERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåï¼‰åˆ©ç”¨BERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</a>ï¼Œè¯¥é¡¹ç›®æ˜¯æƒ³åˆ¤åˆ«è¾“å…¥çš„å¥å­æ˜¯å¦å±äºæ”¿æ²»ä¸Šçš„å‡ºè®¿ç±»äº‹ä»¶ã€‚ç¬”è€…ä¸€å…±æ”¶é›†äº†340æ¡æ•°æ®ï¼Œå…¶ä¸­280æ¡ç”¨ä½œè®­ç»ƒé›†ï¼Œ60æ¡ç”¨ä½œæµ‹è¯•é›†ã€‚</p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><p><a href="/img/nlp22_1.png">é¡¹ç›®ç»“æ„</a></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ALBERTå·²ç»è®­ç»ƒå¥½çš„æ–‡ä»¶<code>albert_tiny</code>ï¼Œå€Ÿé‰´BERTçš„è°ƒç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç»™å‡º<code>albert_zh</code>æ¨¡å—ï¼Œèƒ½å¤Ÿè®©ALBERTæå–æ–‡æœ¬çš„ç‰¹å¾ï¼Œå…·ä½“ä»£ç ä¸åœ¨è¿™é‡Œç»™å‡ºï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è®¿é—®è¯¥é¡¹ç›®çš„Githubåœ°å€ï¼š<ahref="https://github.com/percent4/ALBERT_text_classification">https://github.com/percent4/ALBERT_text_classification</a>ã€‚</p><p>æ³¨æ„ï¼Œ<code>albert_tiny</code>ç»™å‡ºçš„å‘é‡ç»´åº¦ä¸º312ï¼Œæˆ‘ä»¬çš„æ¨¡å‹è®­ç»ƒä»£ç ï¼ˆmodel_train.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-04 13:37</span><br><br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> load_data <span class="hljs-keyword">import</span> train_df, test_df<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> to_categorical<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.optimizers <span class="hljs-keyword">import</span> Adam<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Input, BatchNormalization, Dense<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-comment"># è¯»å–æ–‡ä»¶å¹¶è¿›è¡Œè½¬æ¢</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;REDUCE_MEAN&quot;</span>, max_seq_len=<span class="hljs-number">100</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;begin encoding&#x27;</span>)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>train_df[<span class="hljs-string">&#x27;x&#x27;</span>] = train_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(f)<br>test_df[<span class="hljs-string">&#x27;x&#x27;</span>] = test_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(f)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end encoding&#x27;</span>)<br><br>x_train = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> train_df[<span class="hljs-string">&#x27;x&#x27;</span>]])<br>x_test = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> test_df[<span class="hljs-string">&#x27;x&#x27;</span>]])<br>y_train = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> train_df[<span class="hljs-string">&#x27;label&#x27;</span>]])<br>y_test = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> test_df[<span class="hljs-string">&#x27;label&#x27;</span>]])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x_train: &#x27;</span>, x_train.shape)<br><br><span class="hljs-comment"># Convert class vectors to binary class matrices.</span><br>num_classes = <span class="hljs-number">2</span><br>y_train = to_categorical(y_train, num_classes)<br>y_test = to_categorical(y_test, num_classes)<br><br><span class="hljs-comment"># åˆ›å»ºæ¨¡å‹</span><br>x_in = Input(shape=(<span class="hljs-number">312</span>, ))<br>x_out = Dense(<span class="hljs-number">32</span>, activation=<span class="hljs-string">&quot;relu&quot;</span>)(x_in)<br>x_out = BatchNormalization()(x_out)<br>x_out = Dense(num_classes, activation=<span class="hljs-string">&quot;softmax&quot;</span>)(x_out)<br>model = Model(inputs=x_in, outputs=x_out)<br><span class="hljs-built_in">print</span>(model.summary())<br><br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>,<br>              optimizer=Adam(),<br>              metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒä»¥åŠè¯„ä¼°</span><br>history = model.fit(x_train, y_train, validation_data=(x_test, y_test), batch_size=<span class="hljs-number">8</span>, epochs=<span class="hljs-number">20</span>)<br>model.save(<span class="hljs-string">&#x27;visit_classify.h5&#x27;</span>)<br><span class="hljs-built_in">print</span>(model.evaluate(x_test, y_test))<br><br><span class="hljs-comment"># ç»˜åˆ¶losså’Œaccå›¾åƒ</span><br>plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>epochs = <span class="hljs-built_in">len</span>(history.history[<span class="hljs-string">&#x27;loss&#x27;</span>])<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;loss&#x27;</span>], label=<span class="hljs-string">&#x27;loss&#x27;</span>)<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;val_loss&#x27;</span>], label=<span class="hljs-string">&#x27;val_loss&#x27;</span>)<br>plt.legend()<br><br>plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>epochs = <span class="hljs-built_in">len</span>(history.history[<span class="hljs-string">&#x27;acc&#x27;</span>])<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;acc&#x27;</span>], label=<span class="hljs-string">&#x27;acc&#x27;</span>)<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), history.history[<span class="hljs-string">&#x27;val_acc&#x27;</span>], label=<span class="hljs-string">&#x27;val_acc&#x27;</span>)<br>plt.legend()<br>plt.savefig(<span class="hljs-string">&quot;loss_acc.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ¨¡å‹è®­ç»ƒçš„æ•ˆæœå¾ˆä¸é”™ï¼Œåœ¨è®­ç»ƒé›†çš„accä¸º0.9857,åœ¨æµ‹è¯•é›†ä¸Šçš„accä¸º0.9500ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp22_2.png" alt="è®­ç»ƒè¿‡ç¨‹ä¸­çš„losså’Œaccå›¾" /><figcaption aria-hidden="true">è®­ç»ƒè¿‡ç¨‹ä¸­çš„losså’Œaccå›¾</figcaption></figure><h3 id="ä¸bertçš„é¢„æµ‹å¯¹æ¯”">ä¸BERTçš„é¢„æµ‹å¯¹æ¯”</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ¨¡å‹é¢„æµ‹ä¸Šçš„æ—¶é—´ï¼Œä¸BERTçš„æ–‡æœ¬äºŒåˆ†ç±»æ¨¡å‹é¢„æµ‹æ—¶é—´åšä¸€ä¸ªå¯¹æ¯”ï¼Œè¿™æ ·æœ‰åŠ©äºæå‡æˆ‘ä»¬å¯¹ALBERTçš„å°è±¡ã€‚</p><p>BERTçš„æ–‡æœ¬äºŒåˆ†ç±»æ¨¡å‹é¢„æµ‹å¯ä»¥å‚è€ƒæ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8BERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåï¼‰åˆ©ç”¨BERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</a>ï¼Œæœ¬æ–‡ç»™å‡ºçš„ä»£ç ä¸BERTå®ç°çš„æ¨¡å‹é¢„æµ‹ä»£ç åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡BERTæå–ç‰¹å¾æ”¹æˆALBERTæå–ç‰¹å¾ã€‚</p><p>æœ¬æ–‡çš„æ¨¡å‹é¢„æµ‹ä»£ç ï¼ˆmodel_predict.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-04 17:33</span><br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br>load_model = load_model(<span class="hljs-string">&quot;visit_classify.h5&quot;</span>)<br><br><span class="hljs-comment"># é¢„æµ‹è¯­å¥</span><br>texts = [<span class="hljs-string">&#x27;åœ¨è®¿é—®é™åˆ¶ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ç¦ç”¨iPhoneçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬Siriã€iTunesè´­ä¹°åŠŸèƒ½ã€å®‰è£…/åˆ é™¤åº”ç”¨ç­‰ï¼Œç”šè‡³è¿˜å¯ä»¥è®©iPhoneå˜æˆä¸€å°åŠŸèƒ½æ‰‹æœºã€‚ä»¥ä¸‹æ˜¯è®¿é—®é™åˆ¶å…·ä½“å¯ä»¥å®ç°çš„ä¸€äº›åŠŸèƒ½&#x27;</span>,<br>         <span class="hljs-string">&#x27;ITä¹‹å®¶4æœˆ23æ—¥æ¶ˆæ¯ è¿‘æ—¥ï¼Œè°·æ­Œåœ¨å…¶å®˜æ–¹è®ºå›å‘å¸ƒæ¶ˆæ¯è¡¨ç¤ºï¼Œä»–ä»¬ä¸ºAndroid Autoæ·»åŠ äº†ä¸€é¡¹æ–°åŠŸèƒ½ï¼šå¯ä»¥è®¿é—®å®Œæ•´è”ç³»äººåˆ—è¡¨ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡åœ¨Autoçš„ç”µè¯æ‹¨å·ç•Œé¢ä¸­æ‰“å¼€å·¦ä¸Šè§’çš„èœå•è®¿é—®å®Œæ•´çš„è”ç³»äººåˆ—è¡¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€åŠŸèƒ½ä»…æ”¯æŒåœ¨è½¦è¾†åœæ­¢æ—¶ä½¿ç”¨ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;è¦é€šè¿‡telnet è®¿é—®è·¯ç”±å™¨ï¼Œéœ€è¦å…ˆé€šè¿‡console å£å¯¹è·¯ç”±å™¨è¿›è¡ŒåŸºæœ¬é…ç½®ï¼Œä¾‹å¦‚ï¼šIPåœ°å€ã€å¯†ç ç­‰ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ITä¹‹å®¶3æœˆ26æ—¥æ¶ˆæ¯ è¿‘æ—¥åç›—ç‰ˆçš„å›½é™…å’¨è¯¢å…¬å¸MUSOå‘å¸ƒäº†2017å¹´çš„å¹´åº¦æŠ¥å‘Šï¼Œå…¶ä¸­çš„æ•°æ®æ˜¾ç¤ºï¼Œå»å¹´ç›—ç‰ˆèµ„æºç½‘ç«™è®¿é—®é‡è¾¾åˆ°äº†3000äº¿æ¬¡ï¼Œæ¯”å‰ä¸€å¹´ï¼ˆ2016å¹´ï¼‰æé«˜äº†1.6%ã€‚ç¾å›½æ˜¯è®¿é—®ç›—ç‰ˆç«™ç‚¹æ¬¡æ•°æœ€å¤šçš„å›½å®¶ï¼Œå…±æœ‰279äº¿æ¬¡è®¿é—®ï¼›å…¶ååˆ†åˆ«æ˜¯ä¿„ç½—æ–¯ã€å°åº¦å’Œå·´è¥¿ï¼Œä¸­å›½ä½åˆ—ç¬¬18ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ç›®å‰Aç«™å·²ç»æ¢å¤äº†è®¿é—®ï¼Œå¯ä»¥ç›´æ¥ç™»å½•ï¼Œç½‘é¡µåŠ è½½æ­£å¸¸ï¼Œè§†é¢‘å·²ç»å¯ä»¥æ­£å¸¸æ’­æ”¾ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;Win7ç”µè„‘æç¤ºæ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜æ€ä¹ˆåŠ?å¾ˆå¤šç”¨æˆ·åœ¨ä½¿ç”¨æ— çº¿ç½‘è¿æ¥ä¸Šç½‘æ—¶ï¼Œå‘ç°æ— çº¿ç½‘æ˜¾ç¤ºå·²è¿æ¥ï¼Œä½†æ—è¾¹å´å‡ºç°äº†ä¸€ä¸ªé»„è‰²æ„Ÿå¹å·ï¼Œæ— æ³•è¿›è¡Œç½‘ç»œæ“ä½œï¼Œé€šè¿‡è¯Šæ–­æç¤ºç”µè„‘æ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜ï¼Œä¸”å¤„äºæœªä¿®å¤çŠ¶æ€ï¼Œè¿™è¯¥æ€ä¹ˆåŠå‘¢?ä¸‹é¢å°ç¼–å°±å’Œå¤§å®¶åˆ†äº«ä¸‹Win7ç”µè„‘æç¤ºæ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æœªå¼€å‘æ‰€æœ‰å®‰å…¨ç»„ä¹‹å‰è®¿é—®ï¼ŒFTPå¯ä»¥é“¾æ¥ä¸Šï¼Œä½†æ˜¯æ‰“å¼€ä¼šå¾ˆæ…¢ï¼Œéœ€è¦1-2åˆ†é’Ÿæ‰èƒ½é“¾æ¥ä¸Š&#x27;</span>,<br>         <span class="hljs-string">&#x27;win7ç³»ç»Ÿç”µè„‘çš„ç”¨æˆ·ï¼Œåœ¨è¿æ¥WIFIç½‘ç»œç½‘ä¸Šæ—¶ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°çªç„¶ä¸Šä¸äº†ç½‘ï¼ŒæŸ¥çœ‹è¿æ¥çš„WIFIå‡ºç°â€œæœ‰é™çš„è®¿é—®æƒé™â€çš„æ–‡å­—æç¤ºã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2æœˆ28æ—¥ï¼Œå”å±±æ›¹å¦ƒç”¸è“è‰²æµ·æ´‹ç§‘æŠ€æœ‰é™å…¬å¸è‘£äº‹é•¿èµµåŠ›å†›ç­‰ä¸€è¡Œ5äººåˆ°é»„æµ·æ°´äº§ç ”ç©¶æ‰€äº¤æµè®¿é—®ã€‚é»„æµ·æ°´äº§ç ”ç©¶æ‰€å‰¯æ‰€é•¿è¾›ç¦è¨€åŠç›¸å…³éƒ¨é—¨è´Ÿè´£äººã€ä¸“å®¶ç­‰å‚åŠ äº†ä¼šè®®ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ä¸æ ‡å‡†Mozyä¸€æ ·ï¼ŒStashæ–‡ä»¶å¤¹ä¸ºç”¨æˆ·æä¾›äº†å¯¹å…¶å¤‡ä»½æ–‡ä»¶çš„åŸºäºäº‘çš„è®¿é—®ï¼Œä½†æ˜¯å®ƒä»¬è¿˜ä½¿ä»–ä»¬å¯ä»¥éšæ—¶ï¼Œè·¨å¤šä¸ªè®¾å¤‡(åŒ…æ‹¬æ‰€æœ‰è®¡ç®—æœºï¼Œæ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç”µè„‘)è®¿é—®å®ƒä»¬ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨æµè§ˆå™¨çš„ä»»ä½•äººéƒ½å¯ä»¥åŒæ—¶æŸ¥çœ‹æ–‡ä»¶(å¦‚æœéœ€è¦)ã€‚æ“ä½œç³»ç»Ÿå’Œè®¾å¤‡å“ç‰Œæ— å…³ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ç ”ç©¶è¡¨æ˜ï¼Œæ¯ä¸ªç½‘é¡µçš„å¹³å‡é¢„æœŸå¯¿å‘½ä¸º44è‡³100å¤©ã€‚å½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®å·²æ¶ˆå¤±çš„ç½‘é¡µæ—¶ï¼Œå°±ä¼šçœ‹åˆ°ã€ŒPage Not Foundã€çš„é”™è¯¯ä¿¡æ¯ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œç›¸ä¿¡å¤§å¤šæ•°äººä¹Ÿåªèƒ½ä¸äº†äº†ä¹‹ã€‚ä¸è¿‡æœ‰è´£ä»»å¿ƒçš„ç»„ç»‡â€”â€”äº’è”ç½‘æ¡£æ¡ˆé¦†ä¸ºäº†æä¾›æ›´å¯é çš„WebæœåŠ¡ï¼Œå®ƒè”æ‰‹Braveæµè§ˆå™¨ä¸“é—¨é’ˆå¯¹æ­¤ç±»ç½‘é¡µæä¾›äº†ä¸€é”®åŠ è½½å­˜æ¡£é¡µé¢çš„åŠŸèƒ½ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;3æ—¥ï¼Œæ ¹æ®ä¸‰æ˜Ÿç”µå­çš„æ¶ˆæ¯ï¼Œæåœ¨é••å‰¯ä¼šé•¿è¿™å¤©è®¿é—®äº†ä½äºéŸ©å›½åº†å°šåŒ—é“é¾Ÿå°¾å¸‚çš„ä¸‰æ˜Ÿç”µå­å·¥å‚ã€‚&#x27;</span>] * <span class="hljs-number">10</span><br><br>labels = []<br><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;REDUCE_MEAN&quot;</span>, max_seq_len=<span class="hljs-number">100</span>)<br><br>init_time = time.time()<br><br><span class="hljs-comment"># å¯¹ä¸Šè¿°å¥å­è¿›è¡Œé¢„æµ‹</span><br><span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts:<br><br>    <span class="hljs-comment"># å°†å¥å­è½¬æ¢æˆå‘é‡</span><br>    vec = bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>    x_train = np.array([vec])<br><br>    <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>    predicted = load_model.predict(x_train)<br>    y = np.argmax(predicted[<span class="hljs-number">0</span>])<br>    label = <span class="hljs-string">&#x27;Y&#x27;</span> <span class="hljs-keyword">if</span> y <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;N&#x27;</span><br>    labels.append(label)<br><br>cost_time = time.time() - init_time<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Average cost time: %s.&quot;</span> % (cost_time/<span class="hljs-built_in">len</span>(texts)))<br><br><span class="hljs-keyword">for</span> text, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(texts, labels):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%s\t%s&#x27;</span> % (label, text))<br><br>df = pd.DataFrame(&#123;<span class="hljs-string">&#x27;å¥å­&#x27;</span>:texts, <span class="hljs-string">&quot;æ˜¯å¦å±äºå‡ºè®¿ç±»äº‹ä»¶&quot;</span>: labels&#125;)<br>df.to_excel(<span class="hljs-string">&#x27;./result.xlsx&#x27;</span>, index=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„å¹³å‡é¢„æµ‹æ—¶é•¿ä¸ºï¼š<code>16.98ms</code>ï¼Œè€ŒBERTç‰ˆçš„å¹³å‡é¢„æµ‹æ—¶é—´ä¸ºï¼š<code>257.31ms</code>ã€‚</p><p>æˆ‘ä»¬å°†æ¨¡å‹é¢„æµ‹å†™æˆHTTPæœåŠ¡ï¼Œä»£ç ï¼ˆserver.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-03-04 20:13</span><br><br><span class="hljs-keyword">import</span> tornado.httpserver<br><span class="hljs-keyword">import</span> tornado.ioloop<br><span class="hljs-keyword">import</span> tornado.options<br><span class="hljs-keyword">import</span> tornado.web<br><span class="hljs-keyword">from</span> tornado.options <span class="hljs-keyword">import</span> define, options<br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> albert_zh.extract_feature <span class="hljs-keyword">import</span> BertVector<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><br><br><span class="hljs-comment"># å®šä¹‰ç«¯å£ä¸º10008</span><br>define(<span class="hljs-string">&quot;port&quot;</span>, default=<span class="hljs-number">10008</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;run on the given port&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>)<br><br><span class="hljs-comment"># åŠ è½½ALBERT</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;REDUCE_MEAN&quot;</span>, max_seq_len=<span class="hljs-number">100</span>)<br><span class="hljs-comment"># åŠ è½½å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹</span><br>load_model = load_model(<span class="hljs-string">&quot;visit_classify.h5&quot;</span>)<br><br><br><span class="hljs-comment"># å¯¹å¥å­è¿›è¡Œé¢„æµ‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PredictHandler</span>(tornado.web.RequestHandler):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self</span>):<br><br>        text = self.get_argument(<span class="hljs-string">&quot;text&quot;</span>)<br><br>        <span class="hljs-comment"># å°†å¥å­è½¬æ¢æˆå‘é‡</span><br>        vec = bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>        x_train = np.array([vec])<br><br>        <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>        predicted = load_model.predict(x_train)<br>        y = np.argmax(predicted[<span class="hljs-number">0</span>])<br>        label = <span class="hljs-string">&#x27;æ˜¯&#x27;</span> <span class="hljs-keyword">if</span> y <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;å¦&quot;</span><br><br>        <span class="hljs-comment"># è¿”å›ç»“æœ</span><br>        result = &#123;<span class="hljs-string">&quot;åŸæ–‡&quot;</span>: text, <span class="hljs-string">&quot;æ˜¯å¦å±äºå‡ºè®¿ç±»äº‹ä»¶ï¼Ÿ&quot;</span>: label&#125;<br><br>        self.write(json.dumps(result, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))<br><br><br><span class="hljs-comment"># ä¸»å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><br>    <span class="hljs-comment"># å¼€å¯tornadoæœåŠ¡</span><br>    tornado.options.parse_command_line()<br>    <span class="hljs-comment"># å®šä¹‰app</span><br>    app = tornado.web.Application(<br>            handlers=[(<span class="hljs-string">r&#x27;/predict&#x27;</span>, PredictHandler)] <span class="hljs-comment">#ç½‘é¡µè·¯å¾„æ§åˆ¶</span><br>           )<br>    http_server = tornado.httpserver.HTTPServer(app)<br>    http_server.listen(options.port)<br>    tornado.ioloop.IOLoop.instance().start()<br><br><br>main()<br></code></pre></td></tr></table></figure><p>ç”¨Postmanè¿›è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/nlp22_3.png" /></p><p>å®è·µè¯æ˜ï¼Œç”¨ALBERTåšæ–‡æœ¬ç‰¹å¾æå–ï¼Œæ¨¡å‹è®­ç»ƒçš„æ•ˆæœåŸºæœ¬ä¸BERTå·®åˆ«å¾®å°ï¼Œæ¨¡å‹è®­ç»ƒé€Ÿåº¦æ˜æ˜¾æå‡ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæ¨¡å‹é¢„æµ‹çš„é€Ÿåº¦åªæœ‰BERTç‰ˆæœ¬çš„6.6%ï¼ˆä¸åŒæƒ…å†µä¸‹å¯èƒ½æœ‰ç•¥å¾®å·®å¼‚ï¼‰ï¼Œè¿™åœ¨ç”Ÿäº§ä¸Šæ˜¯ååˆ†æœ‰å¸®åŠ©çš„ã€‚</p><h3 id="å‚è€ƒç½‘å€">å‚è€ƒç½‘å€</h3><ol type="1"><li>ä¸­æ–‡é¢„è®­ç»ƒALBERTæ¨¡å‹æ¥äº†ï¼šå°æ¨¡å‹ç™»é¡¶GLUEï¼ŒBaseç‰ˆæ¨¡å‹å°10å€é€Ÿåº¦å¿«1å€ï¼š<ahref="https://zhuanlan.zhihu.com/p/85037097">https://zhuanlan.zhihu.com/p/85037097</a></li><li>ALBERTä¸€ä½œè“æŒ¯å¿ ï¼šé¢„è®­ç»ƒæ¨¡å‹åº”ç”¨å·²æˆç†Ÿï¼ŒChineseGLUEè¦å¯¹æ ‡GLUEåŸºå‡†ï¼š<ahref="https://tech.sina.com.cn/roll/2019-11-17/doc-iihnzhfy9804802.shtml">https://tech.sina.com.cn/roll/2019-11-17/doc-iihnzhfy9804802.shtml</a>ã€‚</li><li>è§£è¯»ALBERTï¼š<ahref="https://blog.csdn.net/weixin_37947156/article/details/101529943">https://blog.csdn.net/weixin_37947156/article/details/101529943</a>ã€‚</li><li>ALBERTçš„Githubé¡¹ç›®åœ°å€ï¼š<ahref="https://github.com/brightmart/albert_zh">https://github.com/brightmart/albert_zh</a>ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
      <tag>ALBERT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåä¸€ï¼‰äººç‰©å…³ç³»æŠ½å–çš„ä¸€æ¬¡å®æˆ˜</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%E4%B8%80%EF%BC%89%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å»å¹´ï¼Œç¬”è€…å†™è¿‡ä¸€ç¯‡æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/%E5%88%A9%E7%94%A8%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E6%9E%84%E5%BB%BA%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/">åˆ©ç”¨å…³ç³»æŠ½å–æ„å»ºçŸ¥è¯†å›¾è°±çš„ä¸€æ¬¡å°è¯•</a>ï¼Œè¯•å›¾ç”¨ç°åœ¨çš„æ·±åº¦å­¦ä¹ åŠæ³•å»åšå¼€æ”¾é¢†åŸŸçš„å…³ç³»æŠ½å–ï¼Œä½†æ˜¯é—æ†¾çš„æ˜¯ï¼Œç›®å‰åœ¨å¼€æ”¾é¢†åŸŸçš„å…³ç³»æŠ½å–ï¼Œè¿˜æ²¡æœ‰æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆå’Œæ¨¡å‹ã€‚å½“æ—¶çš„æ–‡ç« ä»…ä½œä¸ºç¬”è€…çš„ä¸€æ¬¡å°è¯•ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ•ˆæœæœ‰é™ã€‚</p><p>æœ¬æ–‡å°†è®²è¿°å¦‚ä½•åˆ©ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹æ¥è¿›è¡Œäººç‰©å…³ç³»æŠ½å–ã€‚äººç‰©å…³ç³»æŠ½å–å¯ä»¥ç†è§£ä¸ºæ˜¯å…³ç³»æŠ½å–ï¼Œè¿™æ˜¯æˆ‘ä»¬æ„å»ºçŸ¥è¯†å›¾è°±çš„é‡è¦ä¸€æ­¥ã€‚æœ¬æ–‡äººç‰©å…³ç³»æŠ½å–çš„ä¸»è¦æ€æƒ³æ˜¯å…³ç³»æŠ½å–çš„pipelineï¼ˆç®¡é“ï¼‰æ¨¡å¼ï¼Œå› ä¸ºäººåå¯ä»¥ä½¿ç”¨ç°æˆçš„NERæ¨¡å‹æå–ï¼Œå› æ­¤æœ¬æ–‡ä»…è§£å†³ä»æ–‡ç« ä¸­æŠ½å–å‡ºäººååï¼Œå¦‚ä½•è¿›è¡Œäººç‰©å…³ç³»æŠ½å–ã€‚</p><p>æœ¬æ–‡é‡‡ç”¨çš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ˜¯æ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œç»“åˆBERTé¢„è®­ç»ƒæ¨¡å‹ï¼Œå–å¾—äº†è¾ƒä¸ºä¸é”™çš„æ•ˆæœã€‚</p><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/people_relation_extract">https://github.com/percent4/people_relation_extract</a>ã€‚</p><p>æœ¬é¡¹ç›®çš„é¡¹ç›®ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp21_1.png" alt="äººç‰©å…³ç³»æŠ½å–é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">äººç‰©å…³ç³»æŠ½å–é¡¹ç›®ç»“æ„</figcaption></figure><h3 id="æ•°æ®é›†ä»‹ç»">æ•°æ®é›†ä»‹ç»</h3><p>åœ¨è¿›è¡Œè¿™æ–¹é¢çš„å°è¯•ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜ä¸å¾—ä¸é¢å¯¹è¿™æ ·ä¸€ä¸ªéš¾é¢˜ï¼Œé‚£å°±æ˜¯ä¸­æ–‡äººç‰©å…³ç³»æŠ½å–è¯­æ–™çš„ç¼ºå¤±ã€‚æ•°æ®æ˜¯æ¨¡å‹çš„å‰æï¼Œæ²¡æœ‰æ•°æ®ï¼Œä¸€åˆ‡æ¨¡å‹æ— ä»è°ˆèµ·ã€‚å› æ­¤ï¼Œç¬”è€…ä¸å¾—ä¸èŠ±è´¹å¤§é‡çš„æ—¶é—´æ”¶é›†æ•°æ®ã€‚</p><p>ç¬”è€…åˆ©ç”¨å¤§é‡è‡ªå·±ä¸šä½™çš„æ—¶é—´ï¼Œæ”¶é›†äº†å¤§çº¦2900æ¡äººç‰©å…³ç³»æ ·æœ¬ï¼Œæ•´ç†æˆExcelï¼ˆæ–‡ä»¶åç§°ä¸º<code>äººç‰©å…³ç³»è¡¨.xlsx</code>ï¼‰ï¼Œå…¶ä¸­å‡ è¡Œå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp21_2.png" alt="ç¬”è€…è‡ªå·±æ”¶é›†çš„æ•°æ®é›†" /><figcaption aria-hidden="true">ç¬”è€…è‡ªå·±æ”¶é›†çš„æ•°æ®é›†</figcaption></figure><p>äººç‰©å…³ç³»ä¸€å…±æœ‰14ç±»ï¼Œåˆ†åˆ«ä¸º<code>unknown</code>,<code>å¤«å¦»</code>,<code>çˆ¶æ¯</code>,<code>å…„å¼Ÿå§å¦¹</code>,<code>ä¸Šä¸‹çº§</code>,<code>å¸ˆç”Ÿ</code>,<code>å¥½å‹</code>,<code>åŒå­¦</code>,<code>åˆä½œ</code>,<code>åŒäºº</code>,<code>æƒ…ä¾£</code>,<code>ç¥–å­™</code>,<code>åŒé—¨</code>,<code>äº²æˆš</code>ï¼Œå…¶ä¸­<code>unknown</code>ç±»åˆ«è¡¨ç¤ºè¯¥äººç‰©å…³ç³»ä¸åœ¨å…¶ä½™çš„13ç±»ä¸­ï¼ˆäººç‰©ä¹‹é—´æ²¡æœ‰å…³ç³»æˆ–è€…ä¸ºå…¶ä»–å…³ç³»ï¼‰ï¼Œ<code>åŒäºº</code>å…³ç³»æŒ‡çš„æ˜¯ä¸¤ä¸ªäººç‰©å…¶å®æ˜¯åŒä¸€ä¸ªäººï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">é‚µé€¸å¤«(<span class="hljs-number">1907å¹´10æœˆ4</span>æ—¥â€”<span class="hljs-number">2014å¹´1æœˆ7</span>æ—¥)ï¼ŒåŸåé‚µä»æ¥ï¼Œç”Ÿäºæµ™æ±Ÿçœå®æ³¢å¸‚é•‡æµ·é•‡ï¼Œç¥–ç±æµ™æ±Ÿå®æ³¢ã€‚<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé‚µé€¸å¤«å’Œé‚µä»æ¥å°±æ˜¯åŒä¸€ä¸ªäººã€‚<code>äº²æˆš</code>å…³ç³»æŒ‡çš„æ˜¯é™¤äº†<code>å¤«å¦»</code>,<code>çˆ¶æ¯</code>,<code>å…„å¼Ÿå§å¦¹</code>,<code>ç¥–å­™</code>ä¹‹å¤–çš„äº²æˆšå…³ç³»ï¼Œæ¯”å¦‚å”ä¾„ï¼Œèˆ…ç”¥å…³ç³»ç­‰ã€‚</p><p>ä¸ºäº†å¯¹è¯¥æ•°æ®é›†çš„æ¯ä¸ªå…³ç³»ç±»åˆ«çš„æ•°é‡è¿›è¡Œç»Ÿè®¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è„šæœ¬<code>data/relation_bar_chart.py</code>ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># ç»˜åˆ¶äººç‰©å…³ç³»é¢‘æ•°ç»Ÿè®¡æ¡å½¢å›¾</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-comment"># è¯»å–EXCELæ•°æ®</span><br>df = pd.read_excel(<span class="hljs-string">&#x27;äººç‰©å…³ç³»è¡¨.xlsx&#x27;</span>)<br>label_list = <span class="hljs-built_in">list</span>(df[<span class="hljs-string">&#x27;å…³ç³»&#x27;</span>].value_counts().index)<br>num_list= df[<span class="hljs-string">&#x27;å…³ç³»&#x27;</span>].value_counts().tolist()<br><br><span class="hljs-comment"># Macç³»ç»Ÿè®¾ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ</span><br>plt.rcParams[<span class="hljs-string">&quot;font.family&quot;</span>] = <span class="hljs-string">&#x27;Arial Unicode MS&#x27;</span><br><br><span class="hljs-comment"># åˆ©ç”¨Matplotlibç»˜åˆ¶æ¡å½¢å›¾</span><br>x = <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(num_list))<br>rects = plt.bar(left=x, height=num_list, width=<span class="hljs-number">0.6</span>, color=<span class="hljs-string">&#x27;blue&#x27;</span>, label=<span class="hljs-string">&quot;é¢‘æ•°&quot;</span>)<br>plt.ylim(<span class="hljs-number">0</span>, <span class="hljs-number">500</span>) <span class="hljs-comment"># yè½´èŒƒå›´</span><br>plt.ylabel(<span class="hljs-string">&quot;æ•°é‡&quot;</span>)<br>plt.xticks([index + <span class="hljs-number">0.1</span> <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> x], label_list)<br>plt.xticks(rotation=<span class="hljs-number">45</span>) <span class="hljs-comment"># xè½´çš„æ ‡ç­¾æ—‹è½¬45åº¦</span><br>plt.xlabel(<span class="hljs-string">&quot;äººç‰©å…³ç³»&quot;</span>)<br>plt.title(<span class="hljs-string">&quot;äººç‰©å…³ç³»é¢‘æ•°ç»Ÿè®¡&quot;</span>)<br>plt.legend()<br><br><span class="hljs-comment"># æ¡å½¢å›¾çš„æ–‡å­—è¯´æ˜</span><br><span class="hljs-keyword">for</span> rect <span class="hljs-keyword">in</span> rects:<br>    height = rect.get_height()<br>    plt.text(rect.get_x() + rect.get_width() / <span class="hljs-number">2</span>, height+<span class="hljs-number">1</span>, <span class="hljs-built_in">str</span>(height), ha=<span class="hljs-string">&quot;center&quot;</span>, va=<span class="hljs-string">&quot;bottom&quot;</span>)<br><br>plt.show()<br></code></pre></td></tr></table></figure><p>è¿è¡Œåçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp21_3.png" alt="äººç‰©å…³ç³»æ¡å½¢å›¾" /><figcaption aria-hidden="true">äººç‰©å…³ç³»æ¡å½¢å›¾</figcaption></figure><p><code>unknown</code>ç±»åˆ«æœ€å¤šï¼Œæœ‰791æ¡ï¼Œå…¶ä½™çš„å¦‚<code>ç¥–å­™</code>,<code>äº²æˆš</code>,<code>æƒ…ä¾£</code>ç­‰è¾ƒå°‘ï¼Œåªæœ‰90å¤šæ¡ï¼Œè¿™æ˜¯å› ä¸ºè¿™ç±»äººç‰©å…³ç³»çš„æ•°æ®ç¼ºå¤±ä¸å¥½æ”¶é›†ã€‚å› æ­¤ï¼Œè¯­æ–™çš„æ”¶é›†è´¹æ—¶è´¹åŠ›ï¼Œéœ€è¦æ¶ˆè€—å¤§é‡çš„ç²¾åŠ›ã€‚</p><h3 id="æ•°æ®é¢„å¤„ç†">æ•°æ®é¢„å¤„ç†</h3><p>æ”¶é›†å¥½æ•°æ®åï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œé¢„å¤„ç†ä¸»è¦åˆ†ä¸¤æ­¥ï¼Œä¸€æ­¥æ˜¯å°†äººç‰©å…³ç³»å’ŒåŸæ–‡æœ¬æ•´åˆåœ¨ä¸€èµ·ï¼Œç¬¬äºŒæ­¥ç®€å•ï¼Œå°†æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ¯”ä¾‹ä¸º8:2ã€‚</p><p>æˆ‘ä»¬å¯¹ç¬¬ä¸€æ­¥è¿›è¡Œè¯¦ç»†è¯´æ˜ï¼Œå°†äººç‰©å…³ç³»å’ŒåŸæ–‡æœ¬æ•´åˆåœ¨ä¸€èµ·ã€‚ä¸€èˆ¬æˆ‘ä»¬ç»™å®šåŸæ–‡æœ¬å’Œè¯¥æ–‡æœ¬ä¸­çš„ä¸¤ä¸ªäººç‰©ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">é‚µé€¸å¤«(<span class="hljs-number">1907å¹´10æœˆ4</span>æ—¥â€”<span class="hljs-number">2014å¹´1æœˆ7</span>æ—¥)ï¼ŒåŸåé‚µä»æ¥ï¼Œç”Ÿäºæµ™æ±Ÿçœå®æ³¢å¸‚é•‡æµ·é•‡ï¼Œç¥–ç±æµ™æ±Ÿå®æ³¢ã€‚<br></code></pre></td></tr></table></figure><p>è¿™å¥è¯ä¸­æœ‰ä¸¤ä¸ªäººç‰©ï¼šé‚µé€¸å¤«ï¼Œé‚µä»æ¥ï¼Œè¿™ä¸ªå®¹æ˜“åœ¨è¯­æ–™ä¸­æ‰¾åˆ°ã€‚ç„¶åæˆ‘ä»¬å°†åŸæ–‡æœ¬çš„è¿™ä¸¤ä¸ªäººç‰©ä¸­çš„æ¯ä¸ªå­—ç¬¦åˆ†åˆ«ç”¨'#'å·ä»£ç ï¼Œå¹¶é€šè¿‡'$'ç¬¦å·æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆçš„æ•´åˆæ–‡æœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">é‚µé€¸å¤«$é‚µä»æ¥$###(<span class="hljs-number">1907</span>å¹´<span class="hljs-number">10</span>æœˆ<span class="hljs-number">4</span>æ—¥â€”<span class="hljs-number">2014</span>å¹´<span class="hljs-number">1</span>æœˆ<span class="hljs-number">7</span>æ—¥)ï¼ŒåŸå###ï¼Œç”Ÿäºæµ™æ±Ÿçœå®æ³¢å¸‚é•‡æµ·é•‡ï¼Œç¥–ç±æµ™æ±Ÿå®æ³¢ã€‚<br></code></pre></td></tr></table></figure><p>å¤„ç†æˆè¿™ç§æ ¼å¼æ˜¯ä¸ºäº†æ–¹ä¾¿æ–‡æœ¬åˆ†ç±»æ¨¡å‹è¿›è¡Œè°ƒç”¨ã€‚</p><p>æ•°æ®é¢„å¤„ç†çš„è„šæœ¬ä¸º<code>data/data_into_train_test.py</code>ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><br>df = pd.read_excel(<span class="hljs-string">&#x27;äººç‰©å…³ç³»è¡¨.xlsx&#x27;</span>)<br>relations = <span class="hljs-built_in">list</span>(df[<span class="hljs-string">&#x27;å…³ç³»&#x27;</span>].unique())<br>relations.remove(<span class="hljs-string">&#x27;unknown&#x27;</span>)<br>relation_dict = &#123;<span class="hljs-string">&#x27;unknown&#x27;</span>: <span class="hljs-number">0</span>&#125;<br>relation_dict.update(<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(relations, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(relations)+<span class="hljs-number">1</span>))))<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;rel_dict.json&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> h:<br>    h.write(json.dumps(relation_dict, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))<br><br>pprint(df[<span class="hljs-string">&#x27;å…³ç³»&#x27;</span>].value_counts())<br>df[<span class="hljs-string">&#x27;rel&#x27;</span>] = df[<span class="hljs-string">&#x27;å…³ç³»&#x27;</span>].apply(<span class="hljs-keyword">lambda</span> x: relation_dict[x])<br><br>texts = []<br><span class="hljs-keyword">for</span> per1, per2, text <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(df[<span class="hljs-string">&#x27;äººç‰©1&#x27;</span>].tolist(), df[<span class="hljs-string">&#x27;äººç‰©2&#x27;</span>].tolist(), df[<span class="hljs-string">&#x27;æ–‡æœ¬&#x27;</span>].tolist()):<br>    text = <span class="hljs-string">&#x27;$&#x27;</span>.join([per1, per2, text.replace(per1, <span class="hljs-built_in">len</span>(per1)*<span class="hljs-string">&#x27;#&#x27;</span>).replace(per2, <span class="hljs-built_in">len</span>(per2)*<span class="hljs-string">&#x27;#&#x27;</span>)])<br>    texts.append(text)<br><br>df[<span class="hljs-string">&#x27;text&#x27;</span>] = texts<br><br>train_df = df.sample(frac=<span class="hljs-number">0.8</span>, random_state=<span class="hljs-number">1024</span>)<br>test_df = df.drop(train_df.index)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;train.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> text, rel <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(train_df[<span class="hljs-string">&#x27;text&#x27;</span>].tolist(), train_df[<span class="hljs-string">&#x27;rel&#x27;</span>].tolist()):<br>        f.write(<span class="hljs-built_in">str</span>(rel)+<span class="hljs-string">&#x27; &#x27;</span>+text+<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> g:<br>    <span class="hljs-keyword">for</span> text, rel <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(test_df[<span class="hljs-string">&#x27;text&#x27;</span>].tolist(), test_df[<span class="hljs-string">&#x27;rel&#x27;</span>].tolist()):<br>        g.write(<span class="hljs-built_in">str</span>(rel)+<span class="hljs-string">&#x27; &#x27;</span>+text+<span class="hljs-string">&#x27;\n&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®Œè¯¥è„šæœ¬åï¼Œä¼šåœ¨<code>data</code>ç›®å½•ä¸‹ç”Ÿæˆtrain.txt,test.txtå’Œrel_dict.jsonï¼Œè¯¥jsonæ–‡ä»¶ä¸­ä¿å­˜çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;unknown&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;å¤«å¦»&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;çˆ¶æ¯&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;å…„å¼Ÿå§å¦¹&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ä¸Šä¸‹çº§&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;å¸ˆç”Ÿ&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;å¥½å‹&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;åŒå­¦&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;åˆä½œ&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;åŒäºº&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;æƒ…ä¾£&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ç¥–å­™&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;åŒé—¨&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;äº²æˆš&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">13</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œæ˜¯ç»™æ¯ç§å…³ç³»ä¸€ä¸ªidï¼Œè½¬åŒ–æˆç±»åˆ«å‹å˜é‡ã€‚</p><p>ä»¥train.txtä¸ºä¾‹ï¼Œå…¶å‰5è¡Œçš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">4 </span>æ–¹ç³$æä¼Ÿåº·$åœ¨ç”Ÿæ´»ä¸­ï¼Œ###åˆ™æŠŠ##çœ‹ä½œå°è¾ˆï¼Œå¸¸å¸¸æ›¿å¥¹è§£å†³éš¾é¢˜ã€‚<br><span class="hljs-symbol">3 </span>ä½³å­$ä¹…ä»$<span class="hljs-number">12</span>æœˆï¼Œ##å’Œå¼Ÿå¼Ÿ##å‚åŠ äº†åœ¨ä¸œäº¬ä¸¾è¡Œçš„å…¨å›½åˆä¸­ç”Ÿæ¼”è®²æ¯”èµ›ã€‚<br><span class="hljs-symbol">2 </span>é’±æ…§å®‰$é’±ç¦„æ–°$###ï¼Œç”Ÿå’å¹´ä¸è¯¦ï¼Œæµ·ä¸Šç”»å®¶###ä¹‹å­ã€‚<br><span class="hljs-symbol">0 </span>å´ç»§å¤$é‚“æ–°ç”Ÿ$###è¿˜æ›¾å¯¹åª’ä½“è¯´ï¼šâ€œæˆ‘è¿™ä¸ªå°å°çš„æŠ•èµ„å•†ï¼Œç»å¸¸å¾—åˆ°###ç­‰é¢†å¯¼çš„äº²è‡ªå…³æ³¨å’Œå…³ç…§ï¼Œæˆ‘è§‰åˆ°å—å® è‹¥æƒŠã€‚â€<br><span class="hljs-symbol">2 </span>æ´ªåšåŸ¹$ä¹”æ©Â·MÂ·äº¨èŒ¨æ›¼$###çš„çˆ¶äº²########æ˜¯è‘—åä¼ä¸šå®¶ã€ç¾å›½æœ€å¤§åŒ–å­¦å…¬å¸äº¨èŒ¨æ›¼å…¬å¸åˆ›å§‹äººã€‚<br><span class="hljs-symbol">10 </span>å¤ä¹$é™ˆé£$ä¸¤å°æ— çŒœå‰§æƒ…ç®€ä»‹:##å’Œ##æ˜¯ä¸€å¯¹ä»å°ä¸€èµ·é•¿å¤§çš„é’æ¢…ç«¹é©¬ã€‚<br></code></pre></td></tr></table></figure><p>åœ¨æ¯ä¸€è¡Œä¸­ï¼Œç©ºæ ¼ä¹‹å‰çš„æ•°å­—æ‰€å¯¹åº”çš„äººç‰©å…³ç³»å¯ä»¥åœ¨<code>rel_dict.json</code>ä¸­æ‰¾åˆ°ã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>åœ¨æ¨¡å‹è®­ç»ƒå‰ï¼Œä¸ºäº†å°†æ•°æ®çš„æ ¼å¼æ›´å¥½åœ°é€‚åº”æ¨¡å‹ï¼Œéœ€è¦å†å¯¹trian.txtå’Œtest.txtè¿›è¡Œå¤„ç†ã€‚å¤„ç†è„šæœ¬ä¸º<code>load_data.py</code>ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-comment"># è¯»å–txtæ–‡ä»¶</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_txt_file</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br>    labels, texts = [], []<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> content:<br>        parts = line.split()<br>        label, text = parts[<span class="hljs-number">0</span>], <span class="hljs-string">&#x27;&#x27;</span>.join(parts[<span class="hljs-number">1</span>:])<br>        labels.append(label)<br>        texts.append(text)<br><br>    <span class="hljs-keyword">return</span> labels, texts<br><br><span class="hljs-comment"># è·å–è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ï¼Œæ ¼å¼ä¸ºpandasçš„DataFrame</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_train_test_pd</span>():<br>    file_path = <span class="hljs-string">&#x27;data/train.txt&#x27;</span><br>    labels, texts = read_txt_file(file_path)<br>    train_df = pd.DataFrame(&#123;<span class="hljs-string">&#x27;label&#x27;</span>: labels, <span class="hljs-string">&#x27;text&#x27;</span>: texts&#125;)<br><br>    file_path = <span class="hljs-string">&#x27;data/test.txt&#x27;</span><br>    labels, texts = read_txt_file(file_path)<br>    test_df = pd.DataFrame(&#123;<span class="hljs-string">&#x27;label&#x27;</span>: labels, <span class="hljs-string">&#x27;text&#x27;</span>: texts&#125;)<br><br>    <span class="hljs-keyword">return</span> train_df, test_df<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    train_df, test_df = get_train_test_pd()<br>    <span class="hljs-built_in">print</span>(train_df.head())<br>    <span class="hljs-built_in">print</span>(test_df.head())<br><br>    train_df[<span class="hljs-string">&#x27;text_len&#x27;</span>] = train_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x))<br>    <span class="hljs-built_in">print</span>(train_df.describe())<br></code></pre></td></tr></table></figure><p>æœ¬é¡¹ç›®æ‰€é‡‡ç”¨çš„æ¨¡å‹ä¸ºï¼šBERT + åŒå‘GRU + Attention +FCï¼Œå…¶ä¸­BERTç”¨æ¥æå–æ–‡æœ¬çš„ç‰¹å¾ï¼Œå…³äºè¿™ä¸€éƒ¨åˆ†çš„ä»‹ç»ï¼Œå·²ç»åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8BERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/">NLPï¼ˆäºŒåï¼‰åˆ©ç”¨BERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</a>ä¸­ç»™å‡ºï¼›Attentionä¸ºæ³¨æ„åŠ›æœºåˆ¶å±‚ï¼ŒFCä¸ºå…¨è¿æ¥å±‚ï¼Œæ¨¡å‹çš„ç»“æ„å›¾å¦‚ä¸‹ï¼ˆåˆ©ç”¨Keraså¯¼å‡ºï¼‰ï¼š</p><figure><img src="/img/nlp21_4.png" alt="æ¨¡å‹ç»“æ„ç¤ºä¾‹å›¾" /><figcaption aria-hidden="true">æ¨¡å‹ç»“æ„ç¤ºä¾‹å›¾</figcaption></figure><p>æ¨¡å‹è®­ç»ƒçš„è„šæœ¬ä¸º<code>model_train.py</code>ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> load_data <span class="hljs-keyword">import</span> get_train_test_pd<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> to_categorical<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.optimizers <span class="hljs-keyword">import</span> Adam<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Input, Dense<br><span class="hljs-keyword">from</span> bert.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-keyword">from</span> att <span class="hljs-keyword">import</span> Attention<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> GRU, Bidirectional<br><br><br><span class="hljs-comment"># è¯»å–æ–‡ä»¶å¹¶è¿›è¡Œè½¬æ¢</span><br>train_df, test_df = get_train_test_pd()<br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;NONE&quot;</span>, max_seq_len=<span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;begin encoding&#x27;</span>)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br><br>train_df[<span class="hljs-string">&#x27;x&#x27;</span>] = train_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(f)<br>test_df[<span class="hljs-string">&#x27;x&#x27;</span>] = test_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(f)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end encoding&#x27;</span>)<br><br><span class="hljs-comment"># è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br>x_train = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> train_df[<span class="hljs-string">&#x27;x&#x27;</span>]])<br>x_test = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> test_df[<span class="hljs-string">&#x27;x&#x27;</span>]])<br>y_train = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> train_df[<span class="hljs-string">&#x27;label&#x27;</span>]])<br>y_test = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> test_df[<span class="hljs-string">&#x27;label&#x27;</span>]])<br><span class="hljs-comment"># print(&#x27;x_train: &#x27;, x_train.shape)</span><br><br><span class="hljs-comment"># å°†ç±»å‹yå€¼è½¬åŒ–ä¸ºont-hotå‘é‡</span><br>num_classes = <span class="hljs-number">14</span><br>y_train = to_categorical(y_train, num_classes)<br>y_test = to_categorical(y_test, num_classes)<br><br><span class="hljs-comment"># æ¨¡å‹ç»“æ„ï¼šBERT + åŒå‘GRU + Attention + FC</span><br>inputs = Input(shape=(<span class="hljs-number">80</span>, <span class="hljs-number">768</span>,))<br>gru = Bidirectional(GRU(<span class="hljs-number">128</span>, dropout=<span class="hljs-number">0.2</span>, return_sequences=<span class="hljs-literal">True</span>))(inputs)<br>attention = Attention(<span class="hljs-number">32</span>)(gru)<br>output = Dense(<span class="hljs-number">14</span>, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>)(attention)<br>model = Model(inputs, output)<br><br><span class="hljs-comment"># æ¨¡å‹å¯è§†åŒ–</span><br><span class="hljs-comment"># from keras.utils import plot_model</span><br><span class="hljs-comment"># plot_model(model, to_file=&#x27;model.png&#x27;)</span><br><br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>,<br>              optimizer=Adam(),<br>              metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒä»¥åŠè¯„ä¼°</span><br>model.fit(x_train, y_train, batch_size=<span class="hljs-number">8</span>, epochs=<span class="hljs-number">30</span>)<br>model.save(<span class="hljs-string">&#x27;people_relation.h5&#x27;</span>)<br><span class="hljs-built_in">print</span>(model.evaluate(x_test, y_test))<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨è¯¥æ¨¡å‹å¯¹æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown">begin encoding<br>end encoding<br>Epoch 1/30<br>1433/1433 [==============================] - 15s 10ms/step - loss: 1.5558 - acc: 0.4962<br><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**(ä¸­é—´éƒ¨åˆ†çœç•¥è¾“å‡º)**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br>Epoch 30/30<br>1433/1433 [==============================] - 12s 8ms/step - loss: 0.0210 - acc: 0.9951<br>[1.1099, 0.7709]<br></code></pre></td></tr></table></figure><p>æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹æŒç»­åæ¥åˆ†é’Ÿï¼Œç»è¿‡30ä¸ªepochçš„è®­ç»ƒï¼Œæœ€ç»ˆåœ¨æµ‹è¯•é›†ä¸Šçš„lossä¸º1.1099ï¼Œaccä¸º0.7709ï¼Œåœ¨å°æ•°æ®é‡ä¸‹çš„æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚è®­ç»ƒè¿‡ç¨‹ï¼ˆåŠ å…¥äº†earlystoppingæœºåˆ¶ï¼‰ç”Ÿæˆçš„losså’Œaccå›¾å½¢å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp21_5.png" alt="åŠ å…¥early stoppingåçš„è®­ç»ƒç»“æœ" /><figcaption aria-hidden="true">åŠ å…¥earlystoppingåçš„è®­ç»ƒç»“æœ</figcaption></figure><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>ä¸Šè¿°æ¨¡å‹è®­ç»ƒå®Œåï¼Œåˆ©ç”¨ä¿å­˜å¥½çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¯¹æ–°çš„æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚æ¨¡å‹é¢„æµ‹çš„è„šæœ¬ä¸º<code>model_predict.py</code>ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> bert.extract_feature <span class="hljs-keyword">import</span> BertVector<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> att <span class="hljs-keyword">import</span> Attention<br><br><span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>model = load_model(<span class="hljs-string">&#x27;people_relation.h5&#x27;</span>, custom_objects=&#123;<span class="hljs-string">&quot;Attention&quot;</span>: Attention&#125;)<br><br><span class="hljs-comment"># ç¤ºä¾‹è¯­å¥åŠé¢„å¤„ç†</span><br>text = <span class="hljs-string">&#x27;èµµé‡‘é—ª#ç½—ç‰å…„#åœ¨è¿™é‡Œï¼Œèµµé‡‘é—ªå’Œç½—ç‰å…„å¤«å¦‡å·²ç»ç”Ÿæ´»äº†å¤§åŠè¾ˆå­ã€‚ä»–ä»¬å¤«å¦‡éƒ½æ˜¯å“ˆå¯†å¸‚ä¼Šå·åŒºæ—ä¸šå’Œè‰åŸå±€çš„æŠ¤æ—å‘˜ï¼Œæ‰æ ¹ä¸œå¤©å±±è„šä¸‹ï¼Œå®ˆæŠ¤ç€è¿™ç‰‡ç»¿ã€‚&#x27;</span><br>per1, per2, doc = text.split(<span class="hljs-string">&#x27;#&#x27;</span>)<br>text = <span class="hljs-string">&#x27;$&#x27;</span>.join([per1, per2, doc.replace(per1, <span class="hljs-built_in">len</span>(per1)*<span class="hljs-string">&#x27;#&#x27;</span>).replace(per2, <span class="hljs-built_in">len</span>(per2)*<span class="hljs-string">&#x27;#&#x27;</span>)])<br><span class="hljs-built_in">print</span>(text)<br><br><br><span class="hljs-comment"># åˆ©ç”¨BERTæå–å¥å­ç‰¹å¾</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;NONE&quot;</span>, max_seq_len=<span class="hljs-number">80</span>)<br>vec = bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>x_train = np.array([vec])<br><br><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹å¹¶è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>predicted = model.predict(x_train)<br>y = np.argmax(predicted[<span class="hljs-number">0</span>])<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data/rel_dict.json&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    rel_dict = json.load(f)<br><br>id_rel_dict = &#123;v:k <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> rel_dict.items()&#125;<br><span class="hljs-built_in">print</span>(id_rel_dict[y])<br></code></pre></td></tr></table></figure><p>è¯¥äººç‰©å…³ç³»è¾“å‡ºçš„ç»“æœä¸º<code>å¤«å¦»</code>ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬å¯¹æ›´å¥½çš„æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs clean">åŸæ–‡: æ¶¦ç”Ÿ#æ¶¦å¶#ä¸è¿‡ï¼Œä»–å¯¹æ¶¦ç”Ÿçš„å§å§æ¶¦å¶å€’æ€€æœ‰ä¸€ç§äº²åˆ‡çš„æ„Ÿæƒ…ã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: å…„å¼Ÿå§å¦¹<br>åŸæ–‡: å­™ç‰åš#å…°èŠ±#è„‘å­é‡ŒæŠŠå‰åæ‘åº„æœªå«çš„å¥³å­ä¸€ä¸ªä¸ªæƒ³è¿‡å»ï¼Œæœ€åé€‰å®šäº†åŒæ°´æ‘å­™ç‰åšçš„å¤§å¥³å­å…°èŠ±ã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: çˆ¶æ¯<br>åŸæ–‡: é‡‘æ³¢#ç”°ç¦å ‚#æ¯å¤©æ¥å›äºŒåé‡Œè·¯ï¼Œä¸ä»–ä¸€å—ä¸Šå­¦çš„é‡‘æ³¢å’Œå¤§é˜Ÿä¹¦è®°ç”°ç¦å ‚çš„å„¿å­æ¶¦ç”Ÿéƒ½æœ‰è‡ªè¡Œè½¦ï¼Œåªæœ‰ä»–æ˜¯ä¸¤æ¡è…¿èµ°è·¯ã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: unknown<br>åŸæ–‡: æ¶¦ç”Ÿ#ç”°ç¦å ‚#æ¯å¤©æ¥å›äºŒåé‡Œè·¯ï¼Œä¸ä»–ä¸€å—ä¸Šå­¦çš„é‡‘æ³¢å’Œå¤§é˜Ÿä¹¦è®°ç”°ç¦å ‚çš„å„¿å­æ¶¦ç”Ÿéƒ½æœ‰è‡ªè¡Œè½¦ï¼Œåªæœ‰ä»–æ˜¯ä¸¤æ¡è…¿èµ°è·¯ã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: çˆ¶æ¯<br>åŸæ–‡: å‘¨å±±#æè‡ªæˆ#å‘¨å±±åŸæ˜¯æè‡ªæˆäº²æ‰‹ææ‹”çš„å°†é¢†ï¼Œé—¯ç‹å¯¹ä»–ååˆ†ä¿¡ä»»ï¼Œå«ä»–æ‹…ä»»ä¸­å†›ã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: ä¸Šä¸‹çº§<br>åŸæ–‡: é«˜æ¡‚è‹±#æè‡ªæˆ#é«˜æ¡‚è‹±æ˜¯æè‡ªæˆçš„ç»“å‘å¦»å­ï¼Œä»Šå¹´æ‰ä¸‰åå²ã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: å¤«å¦»<br>åŸæ–‡: ç½—æ–¯ç¦#ç‰¹å¾·#æœç„¶ï¼Œæ­¤åç½—æ–¯ç¦çš„æ”¿æ²»æ—…ç¨‹ä¸é•¿ä»–<span class="hljs-number">24</span>å²çš„ç‰¹å¾·å”å”å¦‚å‡ºä¸€è¾™â€”â€”çº½çº¦å·è®®å‘˜ã€åŠ©ç†æµ·å†›éƒ¨é•¿ã€çº½çº¦å·å·é•¿ä»¥è‡³ç¾å›½æ€»ç»Ÿã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: äº²æˆš<br>åŸæ–‡: è©¹å§†æ–¯#å…‹åˆ©å¤«å…°#è©¹å§†æ–¯æ‹…ä»»äº†è¯¥å…¬å¸çš„ç»ç†ï¼Œä½œä¸ºä¸€åæ°‘ä¸»å…šäººï¼Œä»–æ›¾èµ„åŠ©è¿‡å…‹åˆ©å¤«å…°çš„å†åº¦ç«é€‰ï¼Œä¸¤äººç§äº¤ä¸é”™ã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: ä¸Šä¸‹çº§ï¼ˆé¢„æµ‹å‡ºé”™ï¼Œåº”è¯¥æ˜¯å¥½å‹å…³ç³»ï¼‰<br>åŸæ–‡: é«˜å‰‘çˆ¶#å…³å±±æœˆ#é«˜å‰‘çˆ¶æ˜¯å…³å±±æœˆåœ¨è‰ºæœ¯é“è·¯ä¸Šéå¸¸é‡è¦çš„å¯¼å¸ˆï¼ŒåŒæ—¶å…³å±±æœˆä¹Ÿæ˜¯æœ€èƒ½å¤Ÿè´¯å½»é«˜å‰‘çˆ¶â€œæŠ˜ä¸­ä¸­è¥¿â€ç†å¿µçš„å¾—æ„é—¨ç”Ÿã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: å¸ˆç”Ÿ<br>åŸæ–‡: å”æ€¡è¹#å”çŸ³éœ#å”æ€¡è¹ï¼Œå§“ä»–ä»–æ‹‰æ°ï¼Œåä¸ºä»–ä»–æ‹‰Â·æ€¡è¹ï¼Œåˆåå”çŸ³éœï¼Œéš¶å±äºæ»¡æ´²é•¶çº¢æ——ã€‚<br>é¢„æµ‹äººç‰©å…³ç³»: åŒäºº<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡é‡‡ç”¨çš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ˜¯æ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œç»“åˆBERTé¢„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨å°æ ‡æ³¨æ•°æ®é‡ä¸‹å¯¹äººç‰©å…³ç³»æŠ½å–è¿™ä¸ªä»»åŠ¡å–å¾—äº†è¿˜ä¸é”™çš„æ•ˆæœã€‚åŒæ—¶æ¨¡å‹çš„è¯†åˆ«å‡†ç¡®ç‡å’Œä½¿ç”¨èŒƒå›´è¿˜æœ‰å¾…äºæå‡ï¼Œæå‡ç‚¹ç¬”è€…è®¤ä¸ºå¦‚ä¸‹ï¼š</p><ul><li><p>æ ‡æ³¨çš„æ•°æ®é‡éœ€è¦åŠ å¤§ï¼Œç°åœ¨çš„æ•°æ®æ‰2900æ¡å·¦å³ï¼Œå¦‚æœæ•°æ®é‡ä¸Šå»äº†ï¼Œé‚£ä¹ˆæ¨¡å‹çš„å‡†ç¡®ç‡è¿˜æœ‰ä½¿ç”¨èŒƒå›´ä¹Ÿä¼šæå‡ï¼›</p></li><li><p>å…¶ä»–æ›´å¤šçš„æ¨¡å‹æœ‰å¾…äºå°è¯•ï¼›</p></li><li><p>åœ¨é¢„æµ‹æ—¶ï¼Œæ¨¡å‹çš„é¢„æµ‹æ—¶é—´è¾ƒé•¿ï¼ŒåŸå› åœ¨äºç”¨BERTæå–ç‰¹å¾æ—¶è€—æ—¶è¾ƒé•¿ï¼Œå¯ä»¥è€ƒè™‘ç¼©çŸ­æ¨¡å‹é¢„æµ‹çš„æ—¶é—´ï¼ˆæ¯”å¦‚ä½¿ç”¨ALBERTå°±èƒ½å¤§å¤§ç¼©çŸ­é¢„æµ‹æ—¶é—´ï¼‰ï¼›</p></li><li><p>å…¶ä»–é—®é¢˜æ¬¢è¿è¡¥å……ã€‚</p><p>æ„Ÿè°¢å¤§å®¶é˜…è¯»~</p></li></ul><blockquote><p>æœ¬äººçš„å¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>å…³ç³»æŠ½å–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆäºŒåï¼‰åˆ©ç”¨BERTå®ç°æ–‡æœ¬äºŒåˆ†ç±»</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8BERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E4%BA%8C%E5%8D%81%EF%BC%89%E5%88%A9%E7%94%A8BERT%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BA%8C%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æˆ‘ä»¬è¿›è¡Œäº‹ä»¶æŠ½å–çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è§¦å‘è¯æ¥ç¡®å®šæ˜¯å¦å±äºæŸä¸ªç‰¹å®šçš„äº‹ä»¶ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬ä»¥æ”¿æ²»ä¸Šçš„å‡ºè®¿ç±»äº‹ä»¶ä¸ºä¾‹ï¼Œè¿™ç±»äº‹ä»¶å¾€å¾€ä¼šå‡ºç°â€œè®¿é—®â€è¿™ä¸ªè¯è¯­ï¼Œä½†æ˜¯ä»…ä»…é€šè¿‡â€œè®¿é—®â€è¿™ä¸ªè§¦å‘è¯æ¥åˆ¤æ–­æ˜¯å¦å±äºå‡ºè®¿ç±»äº‹ä»¶æ˜¯ä¸å¯é çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¼šç¢°åˆ°ä»¥ä¸‹æƒ…å†µï¼š</p><p><img src="/img/nlp20_1.png" /></p><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåƒè®¿é—®é€Ÿåº¦ï¼Œè®¿é—®é‡è¿™ç§æ–‡æ¡£è™½ç„¶å‡ºç°äº†è®¿é—®ï¼Œä½†å´ä¸å±äºæ”¿æ²»ä¸Šçš„å‡ºè®¿ç±»äº‹ä»¶ã€‚å› æ­¤ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦å€ŸåŠ©<code>æ–‡æœ¬åˆ†ç±»</code>æ¨¡å‹æ¥åˆ¤æ–­ï¼Œæ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒåˆ†ç±»æ¨¡å‹ã€‚</p><p>æœ¬æ–‡å°†ä¼šè®²è¿°å¦‚ä½•åˆ©ç”¨BERT+DNNæ¨¡å‹æ¥åˆ¤æ–­æ–‡æ¡£æ˜¯å¦å±äºæ”¿æ²»ä¸Šçš„å‡ºè®¿ç±»äº‹ä»¶ã€‚</p><h3 id="æ•°æ®é›†">æ•°æ®é›†</h3><p>ç¬”è€…æ‰¾äº†300ä¸ªæ–‡æ¡£ï¼Œé‡Œé¢çš„æ–‡æ¡£éƒ½å«æœ‰â€œå‡ºè®¿â€è¿™ä¸ªè¯è¯­ï¼Œæ ‡ç­¾1è¡¨ç¤ºå±äºæ”¿æ²»ä¸Šçš„å‡ºè®¿ç±»äº‹ä»¶ï¼Œæ ‡ç­¾0åˆ™ä¸æ˜¯ã€‚å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†ï¼ˆ250ä¸ªæ ·æœ¬ï¼‰å’Œæµ‹è¯•é›†ï¼ˆ50ä¸ªæ ·æœ¬ï¼‰ï¼Œæ¯”ä¾‹ä¸º5:1ï¼Œæ ·æœ¬ä¸æ˜¯å¾ˆå¤šï¼Œä½†å€ŸåŠ©BERTï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å°æ ·æœ¬ä¸Šå–å¾—ä¸é”™çš„æ•ˆæœã€‚</p><p>è®­ç»ƒé›†ï¼ˆéƒ¨åˆ†ï¼‰çš„æ ·æœ¬å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp20_2.png" alt="è®­ç»ƒé›†éƒ¨åˆ†æ•°æ®" /><figcaption aria-hidden="true">è®­ç»ƒé›†éƒ¨åˆ†æ•°æ®</figcaption></figure><h3 id="ä»£ç ">ä»£ç </h3><p>æœ¬é¡¹ç›®çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp20_3.png" alt="é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„</figcaption></figure><p>å› ä¸ºæˆ‘ä»¬è¿™è¾¹æ˜¯å°æ ·æœ¬é‡ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°BERTã€‚åˆå› ä¸ºæ˜¯ä¸­æ–‡ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½BERTçš„ä¸­æ–‡è®­ç»ƒæ–‡ä»¶<code>chinese_L-12_H-768_A-12</code>ï¼Œè¿™æ˜¯å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶ã€‚</p><p>æ ¹æ®æˆ‘ä»¬åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B9%9D%EF%BC%89%E9%A6%96%E6%AC%A1%E4%BD%BF%E7%94%A8BERT%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%AF%BC/">NLPï¼ˆåä¹ï¼‰é¦–æ¬¡ä½¿ç”¨BERTçš„å¯è§†åŒ–æŒ‡å¯¼</a>ä¸­çš„ç»éªŒï¼Œæˆ‘ä»¬éœ€è¦å†™ä»£ç æ¥è°ƒç”¨BERTæ¨¡å‹æ–‡ä»¶ï¼Œæ¯”å¦‚tokenizerï¼Œpadding,maskingä»¥åŠBERTæ¨¡å‹äº§ç”Ÿè¾“å‡ºå‘é‡ç­‰ï¼Œå¹¸è¿çš„æ˜¯ï¼Œæœ‰äººå·²ç»å¸®åŠ©æˆ‘ä»¬åšå¥½äº†è¿™ä»¶äº‹ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨å…¶ä»£ç å°±è¡Œäº†ã€‚è¿™éƒ¨åˆ†çš„ä»£ç ä½äºbertæ–‡ä»¶å¤¹ä¸‹ï¼Œè¯»è€…å¯ä»¥åœ¨æ–‡ç« æœ€åçš„Githubåœ°å€ä¸Šæ‰¾åˆ°ã€‚å› ä¸ºæœ¬æ–‡çš„æ¨¡å‹ä¸ºæ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œæ‰€ä»¥éœ€è¦å–[CLS]è¿™ä¸ªtokenæ‰€å¯¹åº”çš„768ç»´çš„å‘é‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆè¯»å–æ•°æ®é›†ï¼Œå¤„ç†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè„šæœ¬ä¸ºload_data.pyï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-02-12 12:57</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-comment"># è¯»å–txtæ–‡ä»¶</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_txt_file</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br>    labels, texts = [], []<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> content:<br>        parts = line.split()<br>        label, text = parts[<span class="hljs-number">0</span>], <span class="hljs-string">&#x27;&#x27;</span>.join(parts[<span class="hljs-number">1</span>:])<br>        labels.append(label)<br>        texts.append(text)<br><br>    <span class="hljs-keyword">return</span> labels, texts<br><br><br>file_path = <span class="hljs-string">&#x27;data/train.txt&#x27;</span><br>labels, texts = read_txt_file(file_path)<br>train_df = pd.DataFrame(&#123;<span class="hljs-string">&#x27;label&#x27;</span>: labels, <span class="hljs-string">&#x27;text&#x27;</span>: texts&#125;)<br><br>file_path = <span class="hljs-string">&#x27;data/test.txt&#x27;</span><br>labels, texts = read_txt_file(file_path)<br>test_df = pd.DataFrame(&#123;<span class="hljs-string">&#x27;label&#x27;</span>: labels, <span class="hljs-string">&#x27;text&#x27;</span>: texts&#125;)<br><br><span class="hljs-built_in">print</span>(train_df.head())<br><span class="hljs-built_in">print</span>(test_df.head())<br><br>train_df[<span class="hljs-string">&#x27;text_len&#x27;</span>] = train_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x))<br><span class="hljs-built_in">print</span>(train_df.describe())<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">  label                                               text<br>0     1  å½“åœ°æ—¶é—´2æœˆ10æ—¥ï¼Œç™½å®«å‘è¡¨å£°æ˜ç§°ï¼Œç¾å›½æ€»ç»Ÿç‰¹æœ—æ™®åŠå¤«äººæ¢…æ‹‰å°¼å¨…å°†äº2æœˆ24æ—¥è‡³25æ—¥è®¿é—®å°...<br>1     0  ä¿„ç½—æ–¯å«æ˜Ÿé€šè®¯ç¤¾11æ—¥æœ€æ–°æ¶ˆæ¯ï¼Œè²å¾‹å®¾æ€»ç»Ÿæœç‰¹å°”ç‰¹å·²ä¸‹ä»¤ç»ˆæ­¢ä¸ç¾å›½é—´çš„ã€Šè®¿é—®éƒ¨é˜Ÿåå®šã€‹(VFA)ã€‚<br>2     1  æ®ä¿„ç½—æ–¯å«æ˜Ÿç½‘6æ—¥æŠ¥é“ï¼ŒåœŸè€³å…¶æ€»ç»Ÿå‘è¨€äººå¡æ—è¡¨ç¤ºï¼Œä¿„ç½—æ–¯å†›äº‹ä»£è¡¨å›¢å°†äºè¿‘æ—¥è®¿é—®å®‰å¡æ‹‰ï¼Œè®¨è®ºå™...<br>3     0  å…ˆæ¥è¯´è¯´ä»€ä¹ˆæ˜¯LPDDR5ï¼šè¦çŸ¥é“ï¼Œæ‰‹æœºä¸­æœ‰ä¸¤ç§å†…å­˜é¢—ç²’ï¼Œä¸€ç§å°±æ˜¯DRAMä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è¯´çš„â€œ...<br>4     1  åœ¨ç–«æƒ…çš„å…³é”®æ—¶åˆ»ï¼Œå‡ºç°äº†ä¸€ä»¶ä»¤äººæ„ŸåŠ¨çš„äº‹æƒ…ï¼Œè®©æˆ‘ä»¬æ˜ç™½è¿™æ‰æ˜¯çœŸæ­£çš„å¥½æœ‹å‹ï¼Œä¸æƒ§ç–«æƒ…è®¿é—®æˆ‘å›½ï¼Œ...<br>  label                                               text<br>0     1  åº”å·´åŸºæ–¯å¦æ€»ç†ä¼Šå§†å…°Â·æ±—ã€è·å…°ç‹å›½é¦–ç›¸å•ç‰¹ã€å¾·å›½è”é‚¦æ”¿åºœé‚€è¯·ï¼Œå›½å®¶å‰¯ä¸»å¸­ç‹å²å±±å°†äº5æœˆ26æ—¥...<br>1     1  è”é‚¦å¾·å›½æ€»ç†é»˜å…‹å°”æŠµè¾¾å°åº¦è¿›è¡Œè®¿é—®ï¼Œåœ¨é›¾éœ¾ç¬¼ç½©ä¸‹çš„æ–°å¾·é‡Œå—åˆ°å†›äººä»ªä»—é˜Ÿçš„æ¬¢è¿ã€‚é»˜å…‹å°”èµæ‰¬äº†å¾·...<br>2     1  5æœˆ6æ—¥è‡³12æ—¥ï¼Œçœå§”å‰¯ä¹¦è®°ä¹Œå…°ç‡ä»£è¡¨å›¢è®¿é—®éŸ©å›½ã€æ³°å›½ï¼Œä¸éŸ©å›½å›½é™…äº¤æµè”ç›Ÿã€æ–°æ‘è¿åŠ¨ä¸­å¤®ä¼šç­‰...<br>3     1  å›½å°åŠå‘è¨€äººé©¬æ™“å…‰ä»Šå¤©ï¼ˆ5æœˆ22æ—¥ï¼‰è¡¨ç¤ºï¼Œæ–°å…šä¸»å¸­ã€æ–°ä¸­åå„¿å¥³å­¦ä¼šè£èª‰ç†äº‹é•¿éƒæ…•æ˜å°†ç‡å°æ¹¾å„...<br>4     1  6æœˆ13æ—¥è‡³15æ—¥ï¼Œè”åˆå›½åæäº‹åŠ¡å‰¯ç§˜ä¹¦é•¿æ²ƒä¼¦ç§‘å¤«åº”é‚€è®¿é—®åŒ—äº¬å’Œæ–°ç–†ï¼Œå¹¶ä¸ä¸­å›½å¤–äº¤éƒ¨å‰¯éƒ¨é•¿ä¹...<br>         text_len<br>count  250.000000<br>mean    77.540000<br>std     36.804493<br>min     11.000000<br>25%     47.500000<br>50%     73.000000<br>75%    100.750000<br>max    192.000000<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œè®­ç»ƒæ•°æ®é›†çš„æ–‡æœ¬é•¿åº¦çš„75%åˆ†ä½ç‚¹ä¸º100.75ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ¨¡å‹è®­ç»ƒçš„æ—¶å€™ï¼Œpaddingè¿‡ç¨‹ä¸­çš„ç»Ÿä¸€é•¿åº¦å–100ã€‚</p><p>æ•°æ®é¢„å¤„ç†ä¹‹åï¼Œæˆ‘ä»¬åˆ©ç”¨BERTæå–æ–‡æ¡£çš„ç‰¹å¾ï¼Œæ¯ä¸ªæ–‡æ¡£çš„å¡«å……é•¿åº¦ä¸º100ï¼Œå¯¹åº”1ä¸ª768ç»´çš„å‘é‡ï¼Œç„¶åç”¨Kerasåˆ›å»ºDNNæ¥è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œè®­ç»ƒå®Œæ¨¡å‹åå¯¹æµ‹è¯•é›†è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¿å­˜è¯¥æ¨¡å‹æ–‡ä»¶ï¼Œä¾¿äºåç»­çš„æ¨¡å‹é¢„æµ‹ä½¿ç”¨ã€‚æ¨¡å‹è®­ç»ƒçš„è„šæœ¬ä¸ºmodel_train.pyï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-02-12 13:37</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-comment"># æ˜¯å¦ä½¿ç”¨GPUè®­ç»ƒ</span><br><span class="hljs-comment"># os.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = &quot;4,5,6,7,8&quot;</span><br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> load_data <span class="hljs-keyword">import</span> train_df, test_df<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> to_categorical<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.optimizers <span class="hljs-keyword">import</span> Adam<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Input, BatchNormalization, Dense<br><span class="hljs-keyword">from</span> bert.extract_feature <span class="hljs-keyword">import</span> BertVector<br><br><span class="hljs-comment"># è¯»å–æ–‡ä»¶å¹¶è¿›è¡Œè½¬æ¢</span><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;REDUCE_MEAN&quot;</span>, max_seq_len=<span class="hljs-number">100</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;begin encoding&#x27;</span>)<br>f = <span class="hljs-keyword">lambda</span> text: bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>train_df[<span class="hljs-string">&#x27;x&#x27;</span>] = train_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(f)<br>test_df[<span class="hljs-string">&#x27;x&#x27;</span>] = test_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(f)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end encoding&#x27;</span>)<br><br>x_train = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> train_df[<span class="hljs-string">&#x27;x&#x27;</span>]])<br>x_test = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> test_df[<span class="hljs-string">&#x27;x&#x27;</span>]])<br>y_train = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> train_df[<span class="hljs-string">&#x27;label&#x27;</span>]])<br>y_test = np.array([vec <span class="hljs-keyword">for</span> vec <span class="hljs-keyword">in</span> test_df[<span class="hljs-string">&#x27;label&#x27;</span>]])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x_train: &#x27;</span>, x_train.shape)<br><br><span class="hljs-comment"># Convert class vectors to binary class matrices.</span><br>num_classes = <span class="hljs-number">2</span><br>y_train = to_categorical(y_train, num_classes)<br>y_test = to_categorical(y_test, num_classes)<br><br><span class="hljs-comment"># åˆ›å»ºDNNæ¨¡å‹</span><br>x_in = Input(shape=(<span class="hljs-number">768</span>, ))<br>x_out = Dense(<span class="hljs-number">32</span>, activation=<span class="hljs-string">&quot;relu&quot;</span>)(x_in)<br>x_out = BatchNormalization()(x_out)<br>x_out = Dense(num_classes, activation=<span class="hljs-string">&quot;softmax&quot;</span>)(x_out)<br>model = Model(inputs=x_in, outputs=x_out)<br><span class="hljs-built_in">print</span>(model.summary())<br><br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>,<br>              optimizer=Adam(),<br>              metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒã€è¯„ä¼°ä»¥åŠä¿å­˜</span><br>model.fit(x_train, y_train, batch_size=<span class="hljs-number">8</span>, epochs=<span class="hljs-number">20</span>)<br>model.save(<span class="hljs-string">&#x27;visit_classify.h5&#x27;</span>)<br><span class="hljs-built_in">print</span>(model.evaluate(x_test, y_test))<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>åœ¨æ¨¡å‹è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºçš„DNNæ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><span class="hljs-section">Layer (type)                 Output Shape              Param #   </span><br><span class="hljs-section">=================================================================</span><br>input<span class="hljs-emphasis">_1 (InputLayer)         (None, 768)               0         </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span><br>dense<span class="hljs-emphasis">_1 (Dense)              (None, 32)                24608     </span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span><br>batch<span class="hljs-emphasis">_normalization_</span>1 (Batch (None, 32)                128       <br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><span class="hljs-section">dense<span class="hljs-emphasis">_2 (Dense)              (None, 2)                 66        </span></span><br><span class="hljs-emphasis"><span class="hljs-section">=================================================================</span></span><br><span class="hljs-emphasis"><span class="hljs-section">Total params: 24,802</span></span><br><span class="hljs-emphasis"><span class="hljs-section">Trainable params: 24,738</span></span><br><span class="hljs-emphasis"><span class="hljs-section">Non-trainable params: 64</span></span><br><span class="hljs-emphasis"><span class="hljs-section"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span></span><br></code></pre></td></tr></table></figure>æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">Epoch 1/20<br><br>  8/250 [..............................] - ETA: 43s - loss: 1.0427 - acc: 0.3750<br>250/250 [==============================] - 1s 6ms/step - loss: 0.3345 - acc: 0.8640<br>Epoch 2/20<br><br>  8/250 [..............................] - ETA: 0s - loss: 0.2664 - acc: 0.8750<br>250/250 [==============================] - 0s 133us/step - loss: 0.2147 - acc: 0.9320<br><br>.........(çœç•¥éƒ¨åˆ†è¾“å‡ºç»“æœ)............<br><br>Epoch 19/20<br><br>  8/250 [..............................] - ETA: 0s - loss: 0.2481 - acc: 0.8750<br>250/250 [==============================] - 0s 136us/step - loss: 0.0716 - acc: 0.9760<br>Epoch 20/20<br><br>  8/250 [..............................] - ETA: 0s - loss: 0.0149 - acc: 1.0000<br>250/250 [==============================] - 0s 140us/step - loss: 0.0560 - acc: 0.9800<br><br>32/50 [==================&gt;...........] - ETA: 0s<br>50/50 [==============================] - 0s 4ms/step<br>[0.3687818288803101, 0.9199999928474426]<br></code></pre></td></tr></table></figure><p>ç»è¿‡20ä¸ªepochçš„è®­ç»ƒï¼Œæ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„å‡†ç¡®ç‡ä¸º0.9800ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡çº¦ä¸º0.9200ï¼ŒBERTçš„æ•ˆæœå¦‚æ­¤æƒŠäººï¼Œåæ¥ç®€å•çš„DNNæ¨¡å‹å°±èƒ½å–å¾—å¦‚æ­¤ä¸é”™çš„æ•ˆæœã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>ä¸ºäº†å†æ¬¡éªŒè¯æ¨¡å‹çš„é¢„æµ‹æ•ˆæœï¼Œç¬”è€…ä»ç½‘ç«™ä¸Šåˆé‡æ–°æ‰¾äº†20ä¸ªæ–‡æ¡£ï¼Œå¯¹å…¶è¿›è¡Œé¢„æµ‹ã€‚é¢„æµ‹çš„è„šæœ¬ä¸ºmodel_predict.pyï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># author: Jclian91</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><span class="hljs-comment"># time: 2020-02-12 17:33</span><br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> bert.extract_feature <span class="hljs-keyword">import</span> BertVector<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br>load_model = load_model(<span class="hljs-string">&quot;visit_classify.h5&quot;</span>)<br><br><span class="hljs-comment"># é¢„æµ‹è¯­å¥</span><br>texts = [<span class="hljs-string">&#x27;åœ¨è®¿é—®é™åˆ¶ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ç¦ç”¨iPhoneçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬Siriã€iTunesè´­ä¹°åŠŸèƒ½ã€å®‰è£…/åˆ é™¤åº”ç”¨ç­‰ï¼Œç”šè‡³è¿˜å¯ä»¥è®©iPhoneå˜æˆä¸€å°åŠŸèƒ½æ‰‹æœºã€‚ä»¥ä¸‹æ˜¯è®¿é—®é™åˆ¶å…·ä½“å¯ä»¥å®ç°çš„ä¸€äº›åŠŸèƒ½&#x27;</span>,<br>         <span class="hljs-string">&#x27;ITä¹‹å®¶4æœˆ23æ—¥æ¶ˆæ¯ è¿‘æ—¥ï¼Œè°·æ­Œåœ¨å…¶å®˜æ–¹è®ºå›å‘å¸ƒæ¶ˆæ¯è¡¨ç¤ºï¼Œä»–ä»¬ä¸ºAndroid Autoæ·»åŠ äº†ä¸€é¡¹æ–°åŠŸèƒ½ï¼šå¯ä»¥è®¿é—®å®Œæ•´è”ç³»äººåˆ—è¡¨ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡åœ¨Autoçš„ç”µè¯æ‹¨å·ç•Œé¢ä¸­æ‰“å¼€å·¦ä¸Šè§’çš„èœå•è®¿é—®å®Œæ•´çš„è”ç³»äººåˆ—è¡¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€åŠŸèƒ½ä»…æ”¯æŒåœ¨è½¦è¾†åœæ­¢æ—¶ä½¿ç”¨ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;è¦é€šè¿‡telnet è®¿é—®è·¯ç”±å™¨ï¼Œéœ€è¦å…ˆé€šè¿‡console å£å¯¹è·¯ç”±å™¨è¿›è¡ŒåŸºæœ¬é…ç½®ï¼Œä¾‹å¦‚ï¼šIPåœ°å€ã€å¯†ç ç­‰ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ITä¹‹å®¶3æœˆ26æ—¥æ¶ˆæ¯ è¿‘æ—¥åç›—ç‰ˆçš„å›½é™…å’¨è¯¢å…¬å¸MUSOå‘å¸ƒäº†2017å¹´çš„å¹´åº¦æŠ¥å‘Šï¼Œå…¶ä¸­çš„æ•°æ®æ˜¾ç¤ºï¼Œå»å¹´ç›—ç‰ˆèµ„æºç½‘ç«™è®¿é—®é‡è¾¾åˆ°äº†3000äº¿æ¬¡ï¼Œæ¯”å‰ä¸€å¹´ï¼ˆ2016å¹´ï¼‰æé«˜äº†1.6%ã€‚ç¾å›½æ˜¯è®¿é—®ç›—ç‰ˆç«™ç‚¹æ¬¡æ•°æœ€å¤šçš„å›½å®¶ï¼Œå…±æœ‰279äº¿æ¬¡è®¿é—®ï¼›å…¶ååˆ†åˆ«æ˜¯ä¿„ç½—æ–¯ã€å°åº¦å’Œå·´è¥¿ï¼Œä¸­å›½ä½åˆ—ç¬¬18ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;åº”è‘¡è„ç‰™è®®ä¼šé‚€è¯·ï¼Œå…¨å›½äººå¤§å¸¸å§”ä¼šå‰¯å§”å‘˜é•¿å‰ç‚³è½©ç‡å›¢äº12æœˆ14æ—¥è‡³16æ—¥è®¿é—®è‘¡è„ç‰™ï¼Œä¼šè§å‰¯è®®é•¿è´¹åˆ©ä½©ã€ç¤¾ä¼šå…šå‰¯æ€»ä¹¦è®°å¡å†…ç½—ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2æœˆ26æ—¥è‡³3æœˆ2æ—¥ï¼Œåº”é¦™æ¸¯ç‰¹åŒºæ”¿åºœâ€œå†…åœ°è´µå®¾è®¿æ¸¯è®¡åˆ’â€é‚€è¯·ï¼Œçœå§”å¸¸å§”ã€å¸¸åŠ¡å‰¯çœé•¿é™ˆå‘ç¾¤èµ´æ¸¯è€ƒå¯Ÿè®¿é—®ï¼Œé‡ç‚¹å›´ç»•â€œé¦™æ¸¯æ‰€é•¿ã€æ¹–å—æ‰€éœ€â€ï¼Œä¸ç‰¹åŒºæ”¿åºœç›¸å…³éƒ¨é—¨å’Œæœºæ„æ·±å…¥äº¤æµï¼Œæ¨åŠ¨æ¹–å—ä¸é¦™æ¸¯äº¤æµåˆä½œå–å¾—æ–°è¿›å±•ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ç›®å‰Aç«™å·²ç»æ¢å¤äº†è®¿é—®ï¼Œå¯ä»¥ç›´æ¥ç™»å½•ï¼Œç½‘é¡µåŠ è½½æ­£å¸¸ï¼Œè§†é¢‘å·²ç»å¯ä»¥æ­£å¸¸æ’­æ”¾ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;éš¾æ°‘ç½²ç‰¹ä½¿å®‰å‰ä¸½å¨œÂ·æœ±è‰6æœˆ8æ—¥ç»“æŸäº†å¯¹å“¥ä¼¦æ¯”äºšå’Œå§”å†…ç‘æ‹‰è¾¹å¢ƒåœ°åŒºçš„éš¾æ°‘è¥åœ°ä¸ºæœŸä¸¤å¤©çš„è®¿é—®ï¼Œå¥¹å¯¹å“¥ä¼¦æ¯”äºšäººæ°‘å±•ç°çš„äººé“ä¸»ä¹‰å’Œå‹‡æ°”è¡¨ç¤ºèµæ‰¬ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®ã€Šå—å¾·æ„å¿—æŠ¥ã€‹æŠ¥é“ï¼Œå¾·å›½æ€»ç†é»˜å…‹å°”è®¡åˆ’æ˜å¹´1æœˆå°±å‰å¾€å®‰å¡æ‹‰ï¼Œå’ŒåœŸè€³å…¶æ€»ç»ŸåŸƒå°”å¤šå®‰è¿›è¡Œä¼šè°ˆã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;è‡ª9æœˆ14æ—¥è‡³18æ—¥ï¼Œç”±è¶Šå…±ä¸­å¤®æ”¿æ²»å±€å§”å‘˜ã€ä¸­å¤®ä¹¦è®°å¤„ä¹¦è®°ã€ä¸­å¤®ç»æµéƒ¨éƒ¨é•¿é˜®æ–‡å¹³ç‡é¢†å·¥ä½œä»£è¡¨å›¢å¯¹å¸Œè…Šè¿›è¡Œå·¥ä½œè®¿é—®ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;Win7ç”µè„‘æç¤ºæ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜æ€ä¹ˆåŠ?å¾ˆå¤šç”¨æˆ·åœ¨ä½¿ç”¨æ— çº¿ç½‘è¿æ¥ä¸Šç½‘æ—¶ï¼Œå‘ç°æ— çº¿ç½‘æ˜¾ç¤ºå·²è¿æ¥ï¼Œä½†æ—è¾¹å´å‡ºç°äº†ä¸€ä¸ªé»„è‰²æ„Ÿå¹å·ï¼Œæ— æ³•è¿›è¡Œç½‘ç»œæ“ä½œï¼Œé€šè¿‡è¯Šæ–­æç¤ºç”µè„‘æ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜ï¼Œä¸”å¤„äºæœªä¿®å¤çŠ¶æ€ï¼Œè¿™è¯¥æ€ä¹ˆåŠå‘¢?ä¸‹é¢å°ç¼–å°±å’Œå¤§å®¶åˆ†äº«ä¸‹Win7ç”µè„‘æç¤ºæ— çº¿é€‚é…å™¨æˆ–è®¿é—®ç‚¹æœ‰é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2019å¹´10æœˆ13æ—¥è‡³14æ—¥ï¼Œå¤–äº¤éƒ¨å‰¯éƒ¨é•¿é©¬æœæ—­è®¿é—®æ™ºåˆ©ï¼Œä¼šè§æ™ºåˆ©å¤–é•¿é‡ŒéŸ¦æ‹‰ï¼ŒåŒæ™ºåˆ©æ€»ç»Ÿå¤–äº‹é¡¾é—®è¨æ‹‰æ–¯ä¸¾è¡Œä¼šè°ˆï¼Œå°±æ™ºåˆ©ä¸¾åŠäºšå¤ªç»åˆç»„ç»‡ï¼ˆAPECï¼‰ç¬¬äºŒåä¸ƒæ¬¡é¢†å¯¼äººéæ­£å¼ä¼šè®®ç­‰æ·±å…¥äº¤æ¢æ„è§ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æœªå¼€å‘æ‰€æœ‰å®‰å…¨ç»„ä¹‹å‰è®¿é—®ï¼ŒFTPå¯ä»¥é“¾æ¥ä¸Šï¼Œä½†æ˜¯æ‰“å¼€ä¼šå¾ˆæ…¢ï¼Œéœ€è¦1-2åˆ†é’Ÿæ‰èƒ½é“¾æ¥ä¸Š&#x27;</span>,<br>         <span class="hljs-string">&#x27;win7ç³»ç»Ÿç”µè„‘çš„ç”¨æˆ·ï¼Œåœ¨è¿æ¥WIFIç½‘ç»œç½‘ä¸Šæ—¶ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°çªç„¶ä¸Šä¸äº†ç½‘ï¼ŒæŸ¥çœ‹è¿æ¥çš„WIFIå‡ºç°â€œæœ‰é™çš„è®¿é—®æƒé™â€çš„æ–‡å­—æç¤ºã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;è”åˆå›½ç§˜ä¹¦é•¿æ½˜åŸºæ–‡ï¼˜æ—¥è®¿é—®äº†æ—¥æœ¬ç¦å²›å¿ï¼Œä¸å½“åœ°ç¾æ°‘äº¤æµå¹¶è®¿é—®äº†ä¸€æ‰€é«˜ä¸­ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å›½åŠ¡é™¢æ€»ç†æ¸©å®¶å®å½“åœ°æ—¶é—´23æ—¥ä¸‹åˆä¹˜ä¸“æœºæŠµè¾¾å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯ï¼Œå¼€å§‹å¯¹é˜¿æ ¹å»·è¿›è¡Œæ­£å¼è®¿é—®ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ­£åœ¨ä¸­å›½è®¿é—®çš„å·´å·´å¤šæ–¯æ€»ç†æ–¯å›¾å°”ç‰¹ï¼‘ï¼•æ—¥åœ¨é™•è¥¿è¥¿å®‰å‚è§‚è®¿é—®ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®å¤–åª’æŠ¥é“,å½“åœ°æ—¶é—´10æ—¥,ç¾å›½ç™½å®«å‘å£°æ˜ç§°,ç¾å›½æ€»ç»Ÿç‰¹æœ—æ™®å°†äº2æœˆåº•è®¿é—®å°åº¦,ä¸å°åº¦æ€»ç†è«è¿ªè¿›è¡Œæˆ˜ç•¥å¯¹è¯ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2æœˆ28æ—¥ï¼Œå”å±±æ›¹å¦ƒç”¸è“è‰²æµ·æ´‹ç§‘æŠ€æœ‰é™å…¬å¸è‘£äº‹é•¿èµµåŠ›å†›ç­‰ä¸€è¡Œ5äººåˆ°é»„æµ·æ°´äº§ç ”ç©¶æ‰€äº¤æµè®¿é—®ã€‚é»„æµ·æ°´äº§ç ”ç©¶æ‰€å‰¯æ‰€é•¿è¾›ç¦è¨€åŠç›¸å…³éƒ¨é—¨è´Ÿè´£äººã€ä¸“å®¶ç­‰å‚åŠ äº†ä¼šè®®ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;2018å¹´7æœˆ2æ—¥ï¼Œè«æ–¯ç§‘å­”å­æ–‡åŒ–ä¿ƒè¿›ä¼šä¼šé•¿å§œå½¦å½¬ï¼Œå¸¸åŠ¡å‰¯ä¼šé•¿é™ˆå›½å»ºï¼Œåœ¨ä¸­å›½è‘—åç•™ä¿„æ²¹ç”»å¤§å¸ˆç‰Ÿå…‹æ•™æˆçš„é™ªåŒä¸‹ï¼Œè®¿é—®äº†è«æ–¯ç§‘å›½ç«‹è‹é‡Œç§‘å¤«ç¾æœ¯å­¦é™¢ï¼Œå—åˆ°ç¬¬ä¸€å‰¯æ ¡é•¿ä¼Šæˆˆå°”Â·æˆˆå°”å·´ç§‹å…‹å…ˆç”Ÿæ¥å¾…ã€‚&#x27;</span><br>         ]<br><br>labels = []<br><br>bert_model = BertVector(pooling_strategy=<span class="hljs-string">&quot;REDUCE_MEAN&quot;</span>, max_seq_len=<span class="hljs-number">100</span>)<br><br><span class="hljs-comment"># å¯¹ä¸Šè¿°å¥å­è¿›è¡Œé¢„æµ‹</span><br><span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts:<br><br>    <span class="hljs-comment"># å°†å¥å­è½¬æ¢æˆå‘é‡</span><br>    vec = bert_model.encode([text])[<span class="hljs-string">&quot;encodes&quot;</span>][<span class="hljs-number">0</span>]<br>    x_train = np.array([vec])<br><br>    <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>    predicted = load_model.predict(x_train)<br>    y = np.argmax(predicted[<span class="hljs-number">0</span>])<br>    label = <span class="hljs-string">&#x27;Y&#x27;</span> <span class="hljs-keyword">if</span> y <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;N&#x27;</span><br>    labels.append(label)<br><br><span class="hljs-keyword">for</span> text,label <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(texts, labels):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%s\t%s&#x27;</span>%(label, text))<br><br><span class="hljs-comment"># å°†ç»“æœä¿å­˜ä¸ºxlsxæ–‡ä»¶</span><br>df = pd.DataFrame(&#123;<span class="hljs-string">&#x27;å¥å­&#x27;</span>:texts, <span class="hljs-string">&quot;æ˜¯å¦å±äºå‡ºè®¿ç±»äº‹ä»¶&quot;</span>: labels&#125;)<br>df.to_excel(<span class="hljs-string">&#x27;./result.xlsx&#x27;</span>, index=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><p>æ¨¡å‹é¢„æµ‹çš„ç»“æœä¼šè¾“å‡ºï¼ŒåŒæ—¶ä¹Ÿä¼šä¿å­˜è‡³Excelï¼Œæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp20_4.png" alt="excelæ–‡ä»¶ä¸­çš„å†…å®¹" /><figcaption aria-hidden="true">excelæ–‡ä»¶ä¸­çš„å†…å®¹</figcaption></figure><p>æ‰€æœ‰é¢„æµ‹çš„æ–‡æ¡£å®Œå…¨æ­£ç¡®ï¼</p><h3 id="é¢„æµ‹">é¢„æµ‹</h3><p>æœ¬é¡¹ç›®å·²å¼€æºï¼ŒGithubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/bert_doc_binary_classification">https://github.com/percent4/bert_doc_binary_classification</a>ã€‚</p><p>é€šè¿‡ç¬”è€…è‡ªå·±çš„è¯•éªŒï¼ŒBERTåœ¨å°æ ‡æ³¨æ ·æœ¬é‡çš„æ•ˆæœç¡®å®å¾ˆä¸é”™ï¼Œåç»­æˆ‘ä»¬è¿˜å°†ç»§ç»­æ¥è§¦BERTï¼</p><p>æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>BERT</tag>
      
      <tag>NLP</tag>
      
      <tag>æ–‡æœ¬åˆ†ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆåä¹ï¼‰é¦–æ¬¡ä½¿ç”¨BERTçš„å¯è§†åŒ–æŒ‡å¯¼</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B9%9D%EF%BC%89%E9%A6%96%E6%AC%A1%E4%BD%BF%E7%94%A8BERT%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%AF%BC/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B9%9D%EF%BC%89%E9%A6%96%E6%AC%A1%E4%BD%BF%E7%94%A8BERT%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%AF%BC/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡ï¼ˆéƒ¨åˆ†å†…å®¹ï¼‰ç¿»è¯‘è‡ªæ–‡ç« <ahref="http://jalammar.github.io/a-visual-guide-to-using-bert-for-the-first-time/">AVisual Guide to Using BERT for the First Time</a>ï¼Œå…¶ä½œè€…ä¸ºJayAlammarï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<ahref="http://jalammar.github.io/a-visual-guide-to-using-bert-for-the-first-time/">http://jalammar.github.io/a-visual-guide-to-using-bert-for-the-first-time/</a>ï¼Œå¯ä»¥ä½œä¸ºé‚£äº›ä¸ç†Ÿæ‚‰BERTçš„è¯»è€…é¦–æ¬¡é˜…è¯»ã€‚æ–‡ç« ä¸­å¦‚æœ‰ç¿»è¯‘ä¸å½“ä¹‹å¤„ï¼Œè¿˜è¯·æ‰¹è¯„æŒ‡æ­£ã€‚</p><p><img src="/img/nlp19_1.png" /></p><p>æœ¬æ–‡æ˜¯å…³äºå¦‚ä½•ä½¿ç”¨BERTçš„å˜å¼‚ç‰ˆæœ¬æ¥è¿›è¡Œå¥å­åˆ†ç±»çš„ç®€å•æ•™ç¨‹ã€‚è¯¥ä¾‹å­è¶³å¤Ÿç®€å•ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºé¦–æ¬¡ä½¿ç”¨BERTçš„ä»‹ç»ï¼Œå½“ç„¶ï¼Œå®ƒä¹ŸåŒ…å«äº†ä¸€äº›å…³é”®æ€§çš„æ¦‚å¿µã€‚</p><h3 id="æ•°æ®é›†sst2">æ•°æ®é›†ï¼šSST2</h3><p>æœ¬æ–‡ä¸­ä½¿ç”¨çš„æ•°æ®é›†ä¸º<ahref="https://nlp.stanford.edu/sentiment/index.html">SST2</a>ï¼Œå®ƒåŒ…å«äº†ç”µå½±è¯„è®ºçš„å¥å­ï¼Œæ¯ä¸€å¥å¸¦æœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œæˆ–è€…æ ‡æ³¨ä¸º<code>æ­£é¢æƒ…æ„Ÿ</code>ï¼ˆå–å€¼ä¸º1ï¼‰ï¼Œæˆ–è€…æ ‡æ³¨ä¸º<code>è´Ÿé¢æƒ…æ„Ÿ</code>ï¼ˆå–å€¼ä¸º0ï¼‰ã€‚</p><p><img src="/img/nlp19_2.png" /></p><h3 id="æ¨¡å‹å¥å­æƒ…æ„Ÿåˆ†ç±»">æ¨¡å‹ï¼šå¥å­æƒ…æ„Ÿåˆ†ç±»</h3><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªæ¨¡å‹ï¼Œå®ƒèƒ½å¤Ÿå¤„ç†ä¸€ä¸ªå¥å­ï¼ˆå°±è¡Œæˆ‘ä»¬æ•°æ®é›†ä¸­çš„å¥å­é‚£æ ·ï¼‰å¹¶ä¸”è¾“å‡º1ï¼ˆè¡¨æ˜è¯¥å¥å­å…·æœ‰æ­£é¢æƒ…æ„Ÿï¼‰æˆ–è€…0ï¼ˆè¡¨æ˜è¯¥å¥å­å…·æœ‰è´Ÿé¢æƒ…æ„Ÿï¼‰ã€‚æˆ‘ä»¬è®¾æƒ³å®ƒé•¿è¿™æ ·ï¼š</p><figure><img src="/img/nlp19_3.png" alt="æ¨¡å‹æè¿°" /><figcaption aria-hidden="true">æ¨¡å‹æè¿°</figcaption></figure><p>äº‹å®ä¸Šï¼Œè¯¥æ¨¡å‹åŒ…å«ä¸¤ä¸ªæ¨¡å‹ï¼š</p><ul><li><code>DistillBERT</code>ä¼šå¤„ç†å¥å­å¹¶æŠŠå®ƒæå–åçš„ä¿¡æ¯ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ¨¡å‹ã€‚<code>DistillBERT</code>æ˜¯<code>BERT</code>çš„å˜å¼‚ç‰ˆæœ¬ï¼Œç”±<code>HuggingFace</code>å°ç»„å¼€å‘å’Œå¼€æºã€‚å®ƒæ˜¯<code>BERT</code>çš„æ›´è½»é‡ã€æ›´å¿«é€Ÿçš„ç‰ˆæœ¬ï¼ŒåŒæ—¶å®ƒçš„è¡¨ç°åŸºæœ¬ä¸<code>BERT</code>ç›¸è¿‘ã€‚</li><li>ä¸‹ä¸€ä¸ªæ¨¡å‹ï¼Œä»scikitlearnä¸­å¯¼å…¥çš„ä¸€ä¸ªåŸºæœ¬çš„<code>é€»è¾‘å›å½’æ¨¡å‹</code>ï¼ˆLogistic Regressionmodelï¼‰ï¼Œå®ƒä¼šåˆ©ç”¨<code>DistillBERT</code>çš„å¤„ç†ç»“æœï¼Œç„¶åå°†å¥å­è¿›è¡Œåˆ†ç±»æˆ<code>æ­£é¢æƒ…æ„Ÿ</code>æˆ–è€…<code>è´Ÿé¢æƒ…æ„Ÿ</code>ï¼ˆåˆ†åˆ«ä¸º1æˆ–è€…0ï¼‰ã€‚</li></ul><p>åœ¨ä¸¤ä¸ªæ¨¡å‹ä¹‹é—´ä¼ é€’çš„æ•°æ®ä¸º1ä¸ª768ç»´çš„å‘é‡ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå‘é‡ç†è§£ä¸ºè¿™ä¸ªå¥å­çš„åµŒå…¥å‘é‡ï¼ˆEmbeddingVectorï¼‰ï¼Œç”¨äºåˆ†ç±»ã€‚</p><p><img src="/img/nlp19_4.png" /></p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>å°½ç®¡æˆ‘ä»¬ç”¨äº†ä¸¤ä¸ªæ¨¡å‹ï¼Œä½†æ˜¯æˆ‘ä»¬åªä¼šè®­ç»ƒ<code>é€»è¾‘å›å½’æ¨¡å‹</code>ã€‚å¯¹äº<code>DistillBERT</code>ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å·²ç»é¢„è®­ç»ƒå¥½çš„è‹±è¯­æ¨¡å‹ã€‚è¯¥æ¨¡å‹ï¼Œæ—¢ä¸ä¼šè¢«è®­ç»ƒä¹Ÿä¸ä¼šåš<code>å¾®è°ƒï¼ˆfine-tunedï¼‰</code>ï¼Œç›´æ¥è¿›è¡Œå¥å­åˆ†ç±»ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ä»<code>BERT</code>ä¸­è·å¾—å¥å­åˆ†ç±»çš„èƒ½åŠ›ã€‚è¿™å°¤å…¶é€‚åˆ<code>BERT</code>è¾“å‡ºçš„ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆè·Ÿ[CLS]æ ‡å¿—ç›¸å…³ï¼‰ã€‚æˆ‘ç›¸ä¿¡è¿™æ˜¯ç”±äº<code>BERT</code>çš„ç¬¬äºŒä¸ªè®­ç»ƒæ¨¡å‹â€”â€”<code>ä¸‹ä¸€å¥åˆ†ç±»ï¼ˆNext sentence classificationï¼‰</code>ã€‚è¯¥æ¨¡å‹çš„ç›®æ ‡åœ¨äºå°è£…å¥å­çº§åˆ«çš„è¯­æ–™è¿›è¡Œè®­ç»ƒï¼Œå¹¶è¾“å‡ºç¬¬ä¸€ä¸ªä½ç½®ã€‚<code>transformers</code>åº“å·²ç»æä¾›äº†<code>DistillBERT</code>çš„æ“ä½œï¼Œä½œä¸ºå…¶é¢„è®­ç»ƒæ¨¡å‹ç‰ˆæœ¬ã€‚</p><figure><img src="/img/nlp19_5.png" alt="æ¨¡å‹è®­ç»ƒ" /><figcaption aria-hidden="true">æ¨¡å‹è®­ç»ƒ</figcaption></figure><h3 id="æ•™ç¨‹æ€»è§ˆ">æ•™ç¨‹æ€»è§ˆ</h3><p>ä»¥ä¸‹æ˜¯è¯¥æ•™ç¨‹çš„è®¡åˆ’å®‰æ’ã€‚é¦–å…ˆæˆ‘ä»¬ä¼šä½¿ç”¨<code>DistillBERT</code>æ¥äº§ç”Ÿ2000ä¸ªå¥å­çš„å¥å­å‘é‡ã€‚</p><figure><img src="/img/nlp19_6.png" alt="åˆ©ç”¨DistillBERTäº§ç”Ÿå¥å­å‘é‡" /><figcaption aria-hidden="true">åˆ©ç”¨DistillBERTäº§ç”Ÿå¥å­å‘é‡</figcaption></figure><p>è¿™ä¸€æ­¥ä¹‹åæˆ‘ä»¬ä¸ä¼šæ¥è§¦<code>DistillBERT</code>ã€‚æ¥ä¸‹å»åªæ˜¯ScikitLearnçš„æ“ä½œã€‚æˆ‘ä»¬å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚</p><figure><img src="/img/nlp19_7.png"alt="å°†æ•°æ®é›†ç»è¿‡Distilllå¤„ç†ååˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ³¨æ„sklearnçš„åˆ’åˆ†æ˜¯å°†æ•°æ®é›†æ‰“ä¹±(shuffle)åå†è¿›è¡Œåˆ’åˆ†ï¼Œæ‰€ä»¥ä¸æ˜¯å–æ•°æ®é›†çš„å‰75%ä½œä¸ºè®­ç»ƒé›†ã€‚" /><figcaptionaria-hidden="true">å°†æ•°æ®é›†ç»è¿‡Distilllå¤„ç†ååˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ³¨æ„sklearnçš„åˆ’åˆ†æ˜¯å°†æ•°æ®é›†æ‰“ä¹±(shuffle)åå†è¿›è¡Œåˆ’åˆ†ï¼Œæ‰€ä»¥ä¸æ˜¯å–æ•°æ®é›†çš„å‰75%ä½œä¸ºè®­ç»ƒé›†ã€‚</figcaption></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸Šä½¿ç”¨<code>é€»è¾‘å›å½’æ¨¡å‹</code>è¿›è¡Œè®­ç»ƒã€‚</p><p><img src="/img/nlp19_8.png" /></p><h3 id="å•æ¬¡é¢„æµ‹å¦‚ä½•è®¡ç®—">å•æ¬¡é¢„æµ‹å¦‚ä½•è®¡ç®—</h3><p>åœ¨æˆ‘ä»¬è®²è§£ä»£ç å’Œè§£é‡Šå¦‚ä½•è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å·²é¢„è®­ç»ƒå¥½çš„æ¨¡å‹å¦‚ä½•è¿›è¡Œé¢„æµ‹ã€‚æˆ‘ä»¬å°è¯•ç€é¢„æµ‹å¥å­â€œa visually stunning rumination onloveâ€ã€‚ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨BERT tokenizerå°†å¥å­åˆ’åˆ†æˆtokensã€‚ç„¶ååŠ ä¸Šå¥å­åˆ†ç±»çš„ç‰¹æ®Štokensï¼ˆ[CLS]åœ¨å¼€å§‹ä½ç½®ï¼Œ[SEP]åœ¨å¥å­ç»“å°¾ï¼‰ã€‚</p><p><img src="/img/nlp19_9.png" /></p><p>ç¬¬ä¸‰æ­¥æ˜¯é€šè¿‡å·²é¢„è®­ç»ƒå¥½çš„æ¨¡å‹çš„åµŒå…¥è¡¨ï¼ˆembeddingtableï¼‰å°†æ¯ä¸€ä¸ªtokensæ˜ å°„æˆå„è‡ªçš„idã€‚è¿™ä¸€æ­¥å¯ä»¥å‚è€ƒ<code>word embedding</code>ï¼Œå‚è€ƒé˜…è¯»æ–‡ç« <ahref="http://jalammar.github.io/illustrated-word2vec/">The IllustratedWord2vec</a>ã€‚</p><p><img src="/img/nlp19_10.png" /></p><p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œtokenizerä»…éœ€è¦ä¸€è¡Œä»£ç å°±èƒ½å®Œæˆä»¥ä¸Šæ­¥éª¤ã€‚ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">tokenizer.encode(<span class="hljs-string">&quot;a visually stunning rumination on love&quot;</span>, add_special_tokens=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>æˆ‘ä»¬çš„è¾“å…¥å¥å­ç°åœ¨å·²ç»å¤„ç†æˆ<code>DistilBERT</code>å¯ä»¥å¤„ç†çš„æ ¼å¼äº†ã€‚å¦‚æœä½ å·²ç»è¯»è¿‡<ahref="http://jalammar.github.io/illustrated-bert/">IllustratedBERT</a>ï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥çš„å¯è§†åŒ–å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp19_11.png" /></p><h3 id="distilbertå¤„ç†æµç¨‹">DistilBERTå¤„ç†æµç¨‹</h3><p><code>DistilBERT</code>å¤„ç†è¾“å…¥å‘é‡çš„æµç¨‹ç±»ä¼¼äº<code>BERT</code>ã€‚è¾“å‡ºæ˜¯æ¯ä¸€ä¸ªtokenå¯¹åº”ä¸€ä¸ªå‘é‡ã€‚æ¯ä¸ªå‘é‡ç”±768ä¸ªæµ®ç‚¹å‹æ•°å­—ç»„æˆã€‚</p><p><img src="/img/nlp19_12.png" /></p><p>å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¥å­åˆ†ç±»ä»»åŠ¡ï¼Œæ•…æˆ‘ä»¬å¿½ç•¥å…¶ä»–å‘é‡è€Œåªå–ç¬¬ä¸€ä¸ªå‘é‡ï¼ˆè·Ÿ[CLS]ç›¸å…³çš„é‚£ä¸ªï¼‰ã€‚è¿™ä¸ªå‘é‡æˆ‘ä»¬ä¼šä½œä¸º<code>é€»è¾‘å›å½’æ¨¡å‹</code>çš„è¾“å…¥ã€‚</p><p><img src="/img/nlp19_13.png" /></p><p>ä»è¿™é‡Œå¼€å§‹ï¼Œå°±æ˜¯<code>é€»è¾‘å›å½’æ¨¡å‹</code>çš„äº‹å„¿äº†ï¼Œå®ƒè´Ÿè´£å°†è¾“å…¥çš„å‘é‡è¿›è¡Œåˆ†ç±»ã€‚æˆ‘ä»¬è®¾æƒ³ä¸€ä¸ªé¢„æµ‹çš„æµç¨‹é•¿è¿™æ ·ï¼š</p><p><img src="/img/nlp19_14.png" /></p><h3 id="ä»£ç ">ä»£ç </h3><p>æ–‡ç« ä¸­ç”¨åˆ°çš„æ•°æ®é›†ä¸‹è½½ç½‘å€ä¸ºï¼š<ahref="https://github.com/clairett/pytorch-sentiment-classification/raw/master/data/SST2/train.tsv">https://github.com/clairett/pytorch-sentiment-classification/raw/master/data/SST2/train.tsv</a>ã€‚ä¸‹è½½<code>DistillBERT</code>æ¨¡å‹æ–‡ä»¶ï¼Œç½‘å€ä¸ºï¼š<ahref="https://www.kaggle.com/abhishek/distilbertbaseuncased">https://www.kaggle.com/abhishek/distilbertbaseuncased</a>ã€‚</p><p>åŸæ–‡ä¸­è¿™éƒ¨åˆ†çš„ä»£ç è®²è§£æ¯”è¾ƒå¤šï¼Œæˆ‘è¿™è¾¹å¿½ç•¥è¿‡å»äº†ï¼Œç¬”è€…æƒ³æŒ‰è‡ªå·±çš„æ€è·¯æ¥å¤„ç†ï¼Œå› æ­¤è¿™éƒ¨åˆ†å†…å®¹ä¼šæœ‰è°ƒæ•´ã€‚å®Œæ•´çš„æ€è·¯å¦‚ä¸‹ï¼š</p><p>ä¸‹è½½æ•°æ®é›†å’Œæ¨¡å‹æ–‡ä»¶ï¼Œä¸ä»£ç æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚å»ºç«‹jupyterè„šæœ¬ï¼Œå…ˆè½½å…¥å¿…è¦çš„æ¨¡å—ï¼š</p><p><img src="/img/nlp19_15.png" /></p><p>æ¥ç€æˆ‘ä»¬åˆ©ç”¨pandasè¯»å–è®­ç»ƒé›†æ•°æ®ï¼Œå¹¶ç»Ÿè®¡æ ‡ç­¾å€¼çš„é¢‘æ•°ï¼š</p><p><img src="/img/nlp19_16.png" /></p><p>è¯»å–<code>DistillBERT</code>æ¨¡å‹æ–‡ä»¶å¹¶åˆ›å»ºtokenizerï¼š</p><p><img src="/img/nlp19_17.png" /></p><p>é€šè¿‡tokenizerå®Œæˆå¥å­åˆ‡åˆ†æˆtokensï¼Œå¹¶æ˜ å°„åˆ°id:</p><p><img src="/img/nlp19_18.png" /></p><p>ç”±äºæ¯ä¸ªå¥å­çš„é•¿åº¦å¯èƒ½ä¼šä¸åŒï¼Œå› æ­¤éœ€è¦å¯¹å¥å­è¿›è¡Œå¡«å……ï¼ˆPaddingï¼‰ï¼Œä¿æŒæ¯ä¸ªå¥å­çš„è¾“å…¥ç»´åº¦ä¸€è‡´ï¼Œå¥å­å¡«å……çš„é•¿åº¦ä¸ºè¯¥æ•°æ®é›†ä¸­å¥å­é•¿åº¦çš„æœ€å¤§å€¼ã€‚</p><p><img src="/img/nlp19_19.png" /></p><p>å¯¹å¥å­è¿›è¡Œå¡«å……åï¼Œç„¶åå†è¿›è¡ŒMaskingã€‚è¿™æ˜¯å› ä¸ºå¦‚æœæˆ‘ä»¬ç›´æ¥å°†paddedä¼ å…¥<code>BERT</code>ï¼Œè¿™ä¼šé€ æˆä¸€å®šçš„å›°æ‰°ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºå¦ä¸€ä¸ªå˜é‡ï¼Œæ¥å‘Šè¯‰æ¨¡å‹å»maskä¹‹å‰çš„å¡«å……ç»“æœã€‚è¿™å°±æ˜¯attention_maskçš„ä½œç”¨ï¼š</p><p><img src="/img/nlp19_20.png" /></p><p>æˆ‘ä»¬çš„è¾“å…¥å·²ç»å‡†å¤‡å®Œæ¯•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ç€ç”¨<code>DistillBERT</code>æ¥è·å–å‘é‡ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰è¯´çš„ç¬¬ä¸€æ­¥ã€‚è¿™ä¸€æ­¥çš„å¤„ç†ç»“æœä¼šè¿”å›<code>last_hidden_states</code>ï¼Œè€Œæˆ‘ä»¬çš„åˆ†ç±»æ¨¡å‹åªéœ€è¦è·å–<code>[CLS]</code>è¿™ä¸ªtokenå¯¹åº”çš„è¾“å‡ºå‘é‡ã€‚</p><p><img src="/img/nlp19_21.png" /></p><p>å¯è§†åŒ–çš„æ“ä½œè¯´æ˜å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/nlp19_22.png" /></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠä¹‹å‰çš„æ¯ä¸€ä¸ªå¥å­æ˜ å°„æˆäº†1ä¸ª768ç»´çš„å¥å­å‘é‡ï¼Œç„¶åå°±åˆ©ç”¨<code>é€»è¾‘å›å½’æ¨¡å‹</code>ç›´æ¥è¿›è¡Œè®­ç»ƒå°±å¯ä»¥äº†ã€‚</p><p><img src="/img/nlp19_23.png" /></p><p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„æ•ˆæœï¼š</p><p><img src="/img/nlp19_24.png" /></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨<code>DistillBERT</code>å’Œå·²ç»å°è£…å¥½çš„<code>transformers</code>æ¨¡å—ï¼Œç»“åˆ<code>é€»è¾‘å›å½’æ¨¡å‹</code>å¯¹è‹±æ–‡å¥å­è¿›è¡Œæ–‡æœ¬äºŒåˆ†ç±»ã€‚åç»­ç¬”è€…è¿˜ä¼šç ”ç©¶åœ¨ä¸­æ–‡ä¸Šçš„æ–‡æœ¬åˆ†ç±»ä»¥åŠå¦‚ä½•è¿›è¡Œå¾®è°ƒï¼ˆFine_tuningï¼‰ã€‚</p><p>æœ¬é¡¹ç›®çš„Gitlabåœ°å€ä¸ºï¼š<ahref="https://gitlab.com/jclian91/sentence_classify_using_distillBERT_LR">https://gitlab.com/jclian91/sentence_classify_using_distillBERT_LR</a>ï¼ŒåŸæ–‡ç« ä½œè€…çš„Githubåœ°å€ä¸º<ahref="https://github.com/jalammar/jalammar.github.io/blob/master/notebooks/bert/A_Visual_Notebook_to_Using_BERT_for_the_First_Time.ipynb">https://github.com/jalammar/jalammar.github.io/blob/master/notebooks/bert/A_Visual_Notebook_to_Using_BERT_for_the_First_Time.ipynb</a>ã€‚</p><p>æ„Ÿè°¢å¤§å®¶é˜…è¯»~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨å…³ç³»æŠ½å–æ„å»ºçŸ¥è¯†å›¾è°±çš„ä¸€æ¬¡å°è¯•</title>
    <link href="/2023/07/08/%E5%88%A9%E7%94%A8%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E6%9E%84%E5%BB%BA%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/08/%E5%88%A9%E7%94%A8%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E6%9E%84%E5%BB%BA%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="å…³ç³»æŠ½å–">å…³ç³»æŠ½å–</h3><p>ä¿¡æ¯æŠ½å–ï¼ˆInformation Extraction, IEï¼‰æ—¨åœ¨ä»å¤§è§„æ¨¡éç»“æ„æˆ–åŠç»“æ„çš„è‡ªç„¶è¯­è¨€æ–‡æœ¬ä¸­æŠ½å–ç»“æ„åŒ–ä¿¡æ¯ã€‚å…³ç³»æŠ½å–ï¼ˆRelation Extraction, REï¼‰æ˜¯å…¶ä¸­çš„é‡è¦å­ä»»åŠ¡ä¹‹ä¸€ï¼Œä¸»è¦ç›®çš„æ˜¯ä»æ–‡æœ¬ä¸­è¯†åˆ«å®ä½“å¹¶æŠ½å–å®ä½“ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ï¼Œæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä¸­çš„ä¸€é¡¹åŸºæœ¬ä»»åŠ¡ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢çš„ä¸€æ®µè¯ä¸­ï¼Œ</p><blockquote><p>é¸¿æµ·é›†å›¢è‘£äº‹é•¿éƒ­å°é“­25æ—¥è¡¨ç¤ºï¼Œé˜¿é‡Œå·´å·´é›†å›¢è‘£äº‹å±€ä¸»å¸­é©¬äº‘æçš„æ–°é›¶å”®ã€æ–°åˆ¶é€ ä¸­çš„ã€Œæ–°åˆ¶é€ ã€ï¼Œæ˜¯ä»–ç»™åŠ ä¸Šçš„ã€‚ç½‘æ˜“ç§‘æŠ€æŠ¥å¯¼ï¼Œéƒ­å°é“­åœ¨2018æ·±åœ³ITé¢†è¢–å³°ä¼šè°ˆåˆ°å·¥ä¸šäº’è”ç½‘æ—¶è¡¨ç¤ºï¼Œçœ¼ç›çœ‹çš„ã€è„‘ç­‹æƒ³çš„ã€å˜´å·´åƒçš„ã€è€³æœµå¬çš„ï¼Œéƒ½åœ¨éšç€äº’è”ç½‘çš„å‘å±•è€Œè“¬å‹ƒå‘å±•ï¼Œå½“ç„¶äº’è”ç½‘ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæ¯”å¦‚è¯´åˆšæ‰æå°åŠ è¦æ°´å–ï¼Œåœ¨æ‰‹æœºä¸Šä¸€æŒ‰å°±èƒ½å‡ºä¸€ç“¶æ°´å—ï¼Ÿå½“ç„¶åšä¸åˆ°ï¼Œè¿˜æ˜¯å¾—æœ‰å®ä½“ç»æµã€‚</p></blockquote><p>å¯ä»¥æŠ½å–å‡ºå¦‚ä¸‹ä¸‰å…ƒç»„ï¼Œç”¨æ¥è¡¨ç¤ºå®ä½“ä¹‹é—´çš„å…³ç³»ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;é¸¿æµ·é›†å›¢</span>&#x27;, <span class="hljs-symbol">&#x27;è‘£äº‹é•¿</span>&#x27;, <span class="hljs-symbol">&#x27;éƒ­å°é“­</span>&#x27;]<br>[<span class="hljs-symbol">&#x27;é˜¿é‡Œå·´å·´é›†å›¢</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸»å¸­</span>&#x27;, <span class="hljs-symbol">&#x27;é©¬äº‘</span>&#x27;]<br></code></pre></td></tr></table></figure><p>å¹¶ä¸”èƒ½å¤Ÿå½¢æˆå¦‚ä¸‹çš„ç®€å•çš„çŸ¥è¯†å›¾è°±ï¼ˆKnowledge Graphï¼‰ã€‚</p><p><img src="/img/kg1_1.png" alt=""></p><p>å…³äºçŸ¥è¯†å›¾è°±ï¼Œç¬”è€…å·²ç»åœ¨æ–‡ç« <a href="https://www.jianshu.com/p/286eeef0e0c3">SPARQLå…¥é—¨ï¼ˆä¸€ï¼‰SPARQLç®€ä»‹ä¸ç®€å•ä½¿ç”¨</a>ä¸­ç»™å‡ºäº†ä¸€äº›ä»‹ç»ï¼Œè€Œåˆ©ç”¨å…³ç³»æŠ½å–ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸€äº›éç»“æ„åŒ–æ•°æ®ä¸­ï¼Œæå–å‡ºå®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œå½¢æˆçŸ¥è¯†å›¾è°±ï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡è½»æ„å»ºçŸ¥è¯†å›¾è°±çš„æˆæœ¬ã€‚éç»“æ„åŒ–æ•°æ®è¶Šå¤šï¼Œå…³ç³»æŠ½å–æ•ˆæœè¶Šå¥½ï¼Œæˆ‘ä»¬æ„å»ºçš„çŸ¥è¯†å›¾è°±å°±ä¼šè¶Šåºå¤§ï¼Œå®ä½“ä¹‹é—´çš„å…³ç³»ä¹Ÿä¼šè¶Šä¸°å¯Œã€‚</p><h3 id="å¦‚ä½•åšå¥½å…³ç³»æŠ½å–ï¼Ÿ">å¦‚ä½•åšå¥½å…³ç³»æŠ½å–ï¼Ÿ</h3><p>ç›®å‰ï¼Œç½‘ç»œä¸Šæœ‰è®¸å¤šä¸å…³ç³»æŠ½å–ç›¸å…³çš„å…¬å¼€æ¯”èµ›ï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>CCKS 2019 äººç‰©å…³ç³»æŠ½å–ï¼Œç½‘å€ä¸ºï¼š<a href="https://biendata.com/competition/ccks_2019_ipre/">https://biendata.com/competition/ccks_2019_ipre/</a>  ï¼›</p></li><li><p>2019è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›ä¿¡æ¯æŠ½å–ï¼š<a href="http://lic2019.ccf.org.cn/kg">http://lic2019.ccf.org.cn/kg</a> ã€‚</p><p>å¸¸ç”¨çš„å…³ç³»æŠ½å–è¯­æ–™å¦‚ä¸‹ï¼š</p></li><li><p>MUCå…³ç³»æŠ½å–ä»»åŠ¡æ•°æ®é›†ï¼›</p></li><li><p>ACEå…³ç³»æŠ½å–ä»»åŠ¡æ•°æ®é›†ï¼›</p></li><li><p>TAC-KBPæ•°æ®é›†ã€‚</p><p>ç°é˜¶æ®µï¼Œå…³ç³»æŠ½å–çš„åŠæ³•ä¸»è¦å¦‚ä¸‹ï¼š</p></li><li><p>åŸºäºè§„åˆ™çš„æ¨¡å¼åŒ¹é…ï¼›</p></li><li><p>åŸºäºç›‘ç£å­¦ä¹ çš„æ–¹æ³•ï¼›</p></li><li><p>åŠç›‘ç£å’Œæ— ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼›</p></li><li><p>è¿œç¨‹ç›‘ç£çš„æ–¹æ³•ï¼›</p></li><li><p>æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚</p><p>æ¥ç€ï¼Œç¬”è€…æƒ³è¯´ä¸‹ï¼Œä¸ºä»€ä¹ˆæœ€è¿‘ä¼šç ”ç©¶å…³ç³»æŠ½å–ã€‚åœ¨ä¸€ä¸ªå¶ç„¶çš„æœºä¼šï¼Œç¬”è€…çœ‹åˆ°äº†è¿™ä¸ªç½‘ç«™ï¼š<a href="https://www.wisers.ai/zh-cn/browse/relation-extraction/demo/">https://www.wisers.ai/zh-cn/browse/relation-extraction/demo/</a> ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p></li></ul><p><img src="/img/kg1_2.png" alt=""></p><p>è¿™ä¸ªå›¾ç»™äººä»¥ä¸€ç§éå¸¸ç‚«é…·çš„æ„Ÿè§‰ï¼Œå› æ­¤ï¼Œç¬”è€…å°±è¢«å®ƒæ‰€å¸å¼•äº†ã€‚ä½†ç¬”è€…åœ¨è¿™ä¸ªdemoç½‘ç«™ä¸Šå°è¯•äº†å‡ ç¯‡æ–°çš„è¯­æ–™ï¼Œæœ‰äº›æ•ˆæœå¥½ï¼Œæœ‰äº›æ•ˆæœä¸å°½å¦‚äººæ„ï¼Œå› æ­¤ï¼Œç¬”è€…å†³å®šè‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸ªå…³ç³»æŠ½å–çš„æ¨¡å‹ï¼</p><p>è™½ç„¶ç½‘ä¸Šå·²ç»æœ‰è®¸å¤šç°æˆçš„å¾ˆå¥½çš„å…³ç³»æŠ½å–çš„æ¨¡å‹ï¼Œä½†ç¬”è€…è¿˜æ˜¯å¸Œæœ›èƒ½å¤ŸæŒ‰ç…§è‡ªå·±çš„æ„æ„¿å’Œæƒ³æ³•æ¥å®ç°ä¸€ä¸‹ï¼Œå½“ç„¶ï¼Œä»…ä»…æ˜¯ä½œä¸ºä¸€æ¬¡å°è¯•ã€‚ç¬”è€…çš„æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>ä»¥å¥å­çº§åˆ«è¿›è¡Œæ ‡æ³¨ï¼Œæ ‡æ³¨å‡ºå¥å­ä¸­çš„ä¸»è¯­ï¼Œè°“è¯­ï¼Œå®¾è¯­ï¼Œå½¢æˆæ ‡æ³¨åºåˆ—ï¼›</li><li>åˆ©ç”¨æ ‡æ³¨å¥½çš„è¯­æ–™ï¼Œé‡‡ç”¨bert+dlçš„æ–¹æ³•è¿›è¡Œè®­ç»ƒï¼›</li><li>å¯¹æ–°çš„è¯­æ–™ï¼Œé¢„æµ‹ä¸»è¯­ï¼Œè°“è¯­ï¼Œå®¾è¯­ï¼Œç„¶ååˆ©ç”¨ä¸€å®šçš„ç­–ç•¥ï¼Œå½¢æˆå®ä½“å…³ç³»ï¼›</li><li>å¯¹æ–°è¯­æ–™çš„å®ä½“å…³ç³»è¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚</li></ul><p>å¦‚æœä½ å¯¹ç¬”è€…çš„å°è¯•æ„Ÿå…´è¶£ï¼Œè¯·å°è¯•è¿™é˜…è¯»ä¸‹å»ã€‚</p><h3 id="å¦‚ä½•æ ‡æ³¨ï¼Ÿ">å¦‚ä½•æ ‡æ³¨ï¼Ÿ</h3><p>æŒ‰ç…§ç¬”è€…çš„æƒ¯ä¾‹ï¼Œè¿˜æ˜¯è‡ªå·±è¿›è¡Œæ ‡æ³¨ã€‚é‚£ä¹ˆï¼Œå¯¹äºå…³ç³»æŠ½å–ï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ ‡æ³¨å‘¢ï¼Ÿæ¯”å¦‚ï¼Œä¸‹é¢è¿™å¥è¯ï¼š</p><blockquote><p>åº”æ—¥æœ¬å›½é¦–ç›¸å®‰å€æ™‹ä¸‰é‚€è¯·ï¼Œå‡ºå¸­äºŒåå›½é›†å›¢é¢†å¯¼äººç¬¬åå››æ¬¡å³°ä¼šã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦çš„å®ä½“å…³ç³»åº”è¯¥æ˜¯ï¼š æ—¥æœ¬å›½â€“&gt;é¦–ç›¸â€“&gt;å®‰å€æ™‹ä¸‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸»è¯­ä¸ºæ—¥æœ¬ï¼Œè°“è¯­ä¸ºé¦–ç›¸ï¼Œå®¾è¯­ä¸ºå®‰å€æ™‹ä¸‰ï¼Œå½¢æˆçš„æ ‡æ³¨åºåˆ—å¦‚ä¸‹ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">åº”<span class="hljs-built_in">O</span><br>æ—¥<span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>æœ¬<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>å›½<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>é¦–<span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">PRED</span><br>ç›¸<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">PRED</span><br>å®‰<span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">OBJ</span><br>å€<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">OBJ</span><br>æ™‹<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">OBJ</span><br>ä¸‰<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">OBJ</span><br>é‚€<span class="hljs-built_in">O</span><br>è¯·<span class="hljs-built_in">O</span><br>ï¼Œ<span class="hljs-built_in">O</span><br>å‡º<span class="hljs-built_in">O</span><br>å¸­<span class="hljs-built_in">O</span><br>äºŒ<span class="hljs-built_in">O</span><br>å<span class="hljs-built_in">O</span><br>å›½<span class="hljs-built_in">O</span><br>é›†<span class="hljs-built_in">O</span><br>å›¢<span class="hljs-built_in">O</span><br>é¢†<span class="hljs-built_in">O</span><br>å¯¼<span class="hljs-built_in">O</span><br>äºº<span class="hljs-built_in">O</span><br>ç¬¬<span class="hljs-built_in">O</span><br>å<span class="hljs-built_in">O</span><br>å››<span class="hljs-built_in">O</span><br>æ¬¡<span class="hljs-built_in">O</span><br>å³°<span class="hljs-built_in">O</span><br>ä¼š<span class="hljs-built_in">O</span><br>ã€‚<span class="hljs-built_in">O</span><br></code></pre></td></tr></table></figure><p>å¯¹äºå¥å­ä¸­å‡ºç°å¤šä¸»è¯­ï¼Œå¤šè°“è¯­ï¼Œå¤šå®¾è¯­çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥ç…§æ­¤è¿›è¡Œæ ‡æ³¨ï¼Œæ¯”å¦‚ä¸‹é¢è¿™å¥ï¼š</p><blockquote><p>é½é¹é£åŒå¿—ä»»ä¸­å…±ä¸­å›½äººæ°‘å¤§å­¦å§”å‘˜ä¼šå¸¸å§”ã€å‰¯ä¹¦è®°ã€‚</p></blockquote><p>å½¢æˆçš„æ ‡æ³¨åºåˆ—å¦‚ä¸‹ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">é½<span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">OBJ</span><br>é¹<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">OBJ</span><br>é£<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">OBJ</span><br>åŒ<span class="hljs-built_in">O</span><br>å¿—<span class="hljs-built_in">O</span><br>ä»»<span class="hljs-built_in">O</span><br>ä¸­<span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>å…±<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>ä¸­<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>å›½<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>äºº<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>æ°‘<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>å¤§<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>å­¦<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>å§”<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>å‘˜<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>ä¼š<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">SUBJ</span><br>å¸¸<span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">PRED</span><br>å§”<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">PRED</span><br>ã€<span class="hljs-built_in">O</span><br>å‰¯<span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">PRED</span><br>ä¹¦<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">PRED</span><br>è®°<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">PRED</span><br>ã€‚<span class="hljs-built_in">O</span><br></code></pre></td></tr></table></figure><p>å¯¹æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›å½¢æˆä¸¤ä¸ªä¸‰å…ƒç»„ï¼Œåˆ†åˆ«ä¸ºï¼šä¸­å…±ä¸­å›½äººæ°‘å¤§å­¦å§”å‘˜ä¼šâ€“&gt;å¸¸å§”â€“&gt;é½é¹é£, ä¸­å…±ä¸­å›½äººæ°‘å¤§å­¦å§”å‘˜ä¼šâ€“&gt;å‰¯ä¹¦è®°â€“&gt;é½é¹é£ã€‚</p><p>ç¬”è€…åˆ©ç”¨è‡ªå·±çš„æ ‡æ³¨å¹³å°ï¼ˆåç»­ä¼šåœ¨Githubå¼€æºï¼‰ï¼Œä¸€å…±æ ‡æ³¨äº†950åˆ†è¯­æ–™ï¼Œå…¶ä¸­80%ä½œä¸ºè®­ç»ƒé›†ï¼Œ10%ä½œä¸ºéªŒè¯é›†ï¼Œå¦å¤–10%ä½œä¸ºæµ‹è¯•é›†ã€‚å½“ç„¶ï¼Œæ ‡æ³¨çš„è¿‡ç¨‹æ˜¯å¾ˆç—›è‹¦çš„ï¼Œè¿™äº›æ ‡æ³¨é‡ä¹Ÿè¿˜è¿œè¿œä¸å¤Ÿï¼Œåç»­ä¼šæŒç»­ä¸æ–­åœ°æ›´æ–°ã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>ç”±äºæ˜¯å°æ ·æœ¬é‡çš„æ ‡æ³¨æ•°é‡ï¼Œå› æ­¤ï¼Œåœ¨æ¨¡å‹çš„é€‰æ‹©ä¸Šï¼Œéœ€è¦é¢„è®­ç»ƒæ¨¡å‹ï¼Œç¬”è€…çš„é¢„è®­ç»ƒæ¨¡å‹é€‰æ‹©BERTã€‚åœ¨é¢„è®­ç»ƒçš„åŸºç¡€ä¸Šï¼Œé€‰æ‹©BiLSTM+CRFæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¯¹ä¸Šè¿°è¯­æ–™è¿›è¡Œè®­ç»ƒï¼Œå…±è®­ç»ƒ100æ¬¡ï¼Œåœ¨éªŒè¯é›†å’Œæµ‹è¯•é›†ä¸Šçš„æ•ˆæœå¦‚ä¸‹ï¼š</p><p>éªŒè¯é›†ï¼š</p><table><thead><tr><th>é¡¹ç›®</th><th>precision</th><th>recall</th><th>f1</th></tr></thead><tbody><tr><td>å…¨éƒ¨</td><td>71.08%</td><td>78.27%</td><td>74.50%</td></tr><tr><td>å®¾è¯­</td><td>78.95%</td><td>88.24%</td><td>83.33%</td></tr><tr><td>è°“è¯­</td><td>68.00%</td><td>74.56%</td><td>71.13%</td></tr><tr><td>ä¸»è¯­</td><td>67.18%</td><td>73.33%</td><td>70.12%</td></tr></tbody></table><p>æµ‹è¯•é›†</p><table><thead><tr><th>é¡¹ç›®</th><th>precision</th><th>recall</th><th>f1</th></tr></thead><tbody><tr><td>å…¨éƒ¨</td><td>75.07%</td><td>82.18%</td><td>78.46%</td></tr><tr><td>å®¾è¯­</td><td>78.33%</td><td>85.45%</td><td>81.74%</td></tr><tr><td>è°“è¯­</td><td>73.23%</td><td>82.30%</td><td>77.50%</td></tr><tr><td>ä¸»è¯­</td><td>73.88%</td><td>79.20%</td><td>76.45%</td></tr></tbody></table><p>æ•ˆæœå¹¶æ²¡æœ‰è¾¾åˆ°å¾ˆå¥½ï¼Œä¸€æ–¹é¢æ˜¯æ ‡æ³¨ç­–ç•¥çš„é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢æ˜¯æ ‡æ³¨çš„æ•°é‡é—®é¢˜ï¼ˆå› ä¸ºè¿™æ˜¯ä¸€ä¸ªé€šç”¨æ¨¡å‹ï¼‰ï¼Œåç»­æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ï¼Œå½“æ ‡æ³¨æ•°é‡æä¸Šå»åï¼Œæ¨¡å‹è®­ç»ƒçš„æ•ˆæœæ˜¯å¦ä¼šæœ‰æå‡ã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æ¥ç€ï¼Œæˆ‘ä»¬åˆ©ç”¨åˆšæ‰è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¯¹æ–°çš„å¥å­è¿›è¡Œé¢„æµ‹ï¼Œè®°ä½ï¼Œé¢„æµ‹çš„çº§åˆ«ä¸ºå¥å­ã€‚å½“ç„¶ï¼Œé¢„æµ‹çš„ç»“æœï¼Œåªæ˜¯åºåˆ—æ ‡æ³¨æ¨¡å‹è¯†åˆ«å‡ºçš„ç»“æœï¼Œæˆ‘ä»¬è¿˜è¦é‡‡ç”¨ä¸€å®šçš„ç­–ç•¥ï¼Œå°†å…¶å½¢æˆä¸‰å…ƒç»„ã€‚æ¯”å¦‚ä»¥ä¸‹çš„å¥å­ï¼š</p><blockquote><p>è‹±åª’ç§°ï¼Œç¾å›½å†œä¸šéƒ¨é•¿æ¡‘å°¼Â·ç€æœåœ¨6æœˆ25æ—¥æ’­å‡ºçš„ä¸€ä¸ªè®¿è°ˆèŠ‚ç›®ä¸­æ‰¿è®¤ï¼Œç¾å›½å†œæ°‘æ˜¯ç‰¹æœ—æ™®æ€»ç»Ÿå¯¹åè´¸æ˜“æˆ˜çš„â€œå—å®³è€…â€ã€‚</p></blockquote><p>é¢„æµ‹çš„ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>[{â€˜wordâ€™: â€˜ç¾å›½â€™, â€˜startâ€™: 4, â€˜endâ€™: 6, â€˜typeâ€™: â€˜SUBJâ€™}, {â€˜wordâ€™: â€˜å†œä¸šéƒ¨é•¿â€™, â€˜startâ€™: 6, â€˜endâ€™: 10, â€˜typeâ€™: â€˜PREDâ€™}, {â€˜wordâ€™: â€˜æ¡‘å°¼Â·ç€æœâ€™, â€˜startâ€™: 10, â€˜endâ€™: 15, â€˜typeâ€™: â€˜OBJâ€™}, {â€˜wordâ€™: â€˜ç¾å›½â€™, â€˜startâ€™: 34, â€˜endâ€™: 36, â€˜typeâ€™: â€˜SUBJâ€™}]</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡å‹è¯†åˆ«å‡ºä¸»è¯­ä¸ºç¾å›½ï¼Œè°“è¯­ä¸ºå†œä¸šéƒ¨é•¿ï¼Œå®¾è¯­ä¸ºæ¡‘å°¼Â·ç€æœï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œç¾çš„ä¸‰å…ƒç»„ã€‚</p><p>æˆ‘ä»¬å†æ¥å¯¹ä¸‹é¢çš„è¯­å¥è¿›è¡Œé¢„æµ‹ï¼š</p><blockquote><p>6æœˆ25æ—¥ï¼Œåä¸ºå¸¸åŠ¡è‘£äº‹ã€è¿è¥å•†äº‹ä¸šéƒ¨æ€»è£ä¸è€˜è¡¨ç¤ºï¼Œåä¸ºå·²åœ¨å…¨çƒèŒƒå›´å†…è·å¾—50ä¸ª5Gå•†ç”¨åˆåŒï¼Œå…¶ä¸­2/3æ˜¯ç”±åä¸ºååŠ©å…¶æ„å»ºçš„ã€‚</p></blockquote><p>é¢„æµ‹ç»“æœä¸ºï¼š</p><blockquote><p>[{â€˜wordâ€™: â€˜åä¸ºâ€™, â€˜startâ€™: 6, â€˜endâ€™: 8, â€˜typeâ€™: â€˜SUBJâ€™}, {â€˜wordâ€™: â€˜å¸¸åŠ¡è‘£äº‹â€™, â€˜startâ€™: 8, â€˜endâ€™: 12, â€˜typeâ€™: â€˜PREDâ€™}, {â€˜wordâ€™: â€˜è¿è¥å•†äº‹ä¸šéƒ¨â€™, â€˜startâ€™: 13, â€˜endâ€™: 19, â€˜typeâ€™: â€˜SUBJâ€™}, {â€˜wordâ€™: â€˜æ€»è£â€™, â€˜startâ€™: 19, â€˜endâ€™: 21, â€˜typeâ€™: â€˜PREDâ€™}, {â€˜wordâ€™: â€˜ä¸è€˜â€™, â€˜startâ€™: 21, â€˜endâ€™: 23, â€˜typeâ€™: â€˜OBJâ€™}, {â€˜wordâ€™: â€˜åä¸ºâ€™, â€˜startâ€™: 26, â€˜endâ€™: 28, â€˜typeâ€™: â€˜SUBJâ€™}, {â€˜wordâ€™: â€˜åä¸ºâ€™, â€˜startâ€™: 54, â€˜endâ€™: 56, â€˜typeâ€™: â€˜SUBJâ€™}]</p></blockquote><p>è¿™å°±éœ€è¦ä¸€å®šçš„ç­–ç•¥ï¼Œæ‰èƒ½è¯†åˆ«å‡ºå…·ä½“çš„ä¸‰å…ƒç»„äº†ã€‚ç¬”è€…é‡‡ç”¨çš„ç­–ç•¥å¦‚ä¸‹ï¼š</p><ul><li>æŒ‰ä¸»è¯­ï¼Œè°“è¯­ï¼Œå®¾è¯­è¿›è¡Œå½’ç±»ï¼Œå½¢æˆä¸»ä½“é›†åˆ<code>&#123;åä¸º, è¿è¥å•†äº‹ä¸šéƒ¨&#125;</code>ï¼Œè°“è¯­é›†åˆ<code>&#123;å¸¸åŠ¡è‘£äº‹, æ€»è£&#125;</code>ä»¥åŠå®¾è¯­é›†åˆ<code>&#123;ä¸è€˜&#125;</code>ï¼›</li><li>æ¥ç€ï¼ŒæŒ‰ç…§å„ä¸ªå…ƒç´ åœ¨å¥å­å‡ºç°çš„ä½ç½®è¿›è¡Œç»„åˆï¼Œæ¯”å¦‚<code>åä¸º</code>çš„ä½ç½®ï¼Œç¦»<code>å¸¸åŠ¡è‘£äº‹</code>æŒ¨å¾—è¿‘ï¼Œé‚£ä¹ˆå½¢æˆä¸€ä¸ªä¸‰å…ƒç»„[â€˜åä¸ºâ€™, â€˜å¸¸åŠ¡è‘£äº‹â€™, â€˜ä¸è€˜â€™]ï¼ŒåŒç†ï¼Œå½¢æˆå¦ä¸€ä¸ªä¸‰å…ƒç»„[â€˜è¿è¥å•†äº‹ä¸šéƒ¨â€™, â€˜æ€»è£â€™, â€˜ä¸è€˜â€™];</li><li>å°†å¥å­æŒ‰ç…§é€—å·è¿›è¡Œåˆ†å‰²ï¼Œå½¢æˆ<code>å°å¥å­é›†åˆ</code>ï¼Œçœ‹ä¸‰å…ƒç»„çš„ä¸‰ä¸ªå…ƒç´ æ˜¯å¦éƒ½åœ¨ä¸€ä¸ªå°å¥å­ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æå–è¯¥ä¸‰å…ƒç»„ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æ”¾å¼ƒè¯¥ä¸‰å…ƒç»„ã€‚</li></ul><h3 id="å…³ç³»æŠ½å–å¯è§†åŒ–">å…³ç³»æŠ½å–å¯è§†åŒ–</h3><p>å¯¹äºå…³ç³»æŠ½å–åçš„èŠ‚åï¼Œæˆ‘ä»¬å°†ä¸‰å…ƒç»„å¯¼å…¥è‡³Neo4Jä¸­ï¼ŒæŸ¥çœ‹å¯è§†åŒ–çš„æ•ˆæœã€‚æˆ‘ä»¬ä¸€å…±é€‰æ‹©ä¸‰ç¯‡æ–‡ç« è¿›è¡Œæµ‹è¯•ï¼Œä¸ºäº†å–å¾—è¾ƒå¥½çš„æ•ˆæœï¼Œæˆ‘ä»¬é€‰æ‹©äº†ç¨‹åºå¤„ç†+äººå·¥checkï¼ˆè¿‡æ»¤ï¼‰çš„è¿‡ç¨‹ï¼Œç¨å¾®æœ‰ç‚¹å·¥ä½œé‡ã€‚</p><p>ç¬¬ä¸€ç¯‡æ–‡ç« æ¥è‡ªå¾®ä¿¡å…¬ä¼—å·ï¼Œæ ‡é¢˜ä¸ºï¼š<code>å“ˆå·¥å¤§ç¤¾ä¼šè®¡ç®—ä¸ä¿¡æ¯æ£€ç´¢ç ”ç©¶ä¸­å¿ƒï¼ˆHIT-SCIRï¼‰æ‹Ÿäº7æœˆ20æ—¥åœ¨å“ˆå·¥å¤§ä¸¾åŠé¦–å±Šäº‹ç†å›¾è°±ç ”è®¨ä¼š</code>, è®¿é—®ç½‘å€ä¸ºï¼š<a href="https://mp.weixin.qq.com/s/9H7rxsPdo5S5trwz_CASZw%EF%BC%8C">https://mp.weixin.qq.com/s/9H7rxsPdo5S5trwz_CASZwï¼Œ</a> æˆ‘ä»¬æŠ½å–å‡ºæ¥çš„å®ä½“å…³ç³»ï¼ˆå¸¦åŸæ–‡ï¼‰å¦‚ä¸‹ï¼š</p><blockquote><p>åŸæ–‡,s,p,o<br>2017å¹´10æœˆï¼Œç ”ç©¶ä¸­å¿ƒä¸»ä»»åˆ˜æŒºæ•™æˆåœ¨ä¸­å›½è®¡ç®—æœºå¤§ä¼šï¼ˆCNCCï¼‰ä¸Šæ­£å¼æå‡ºäº‹ç†å›¾è°±çš„æ¦‚å¿µï¼Œ2018å¹´9æœˆï¼Œåœ¨ç ”ç©¶ä¸­å¿ƒä¸æ•ˆè€å¸ˆçš„ä¸»æŒä¸‹ï¼Œç ”åˆ¶å‡ºä¸­æ–‡é‡‘èäº‹ç†å›¾è°±1.0ç‰ˆæœ¬ã€‚,ç ”ç©¶ä¸­å¿ƒ,è€å¸ˆ,ä¸æ•ˆ<br>2017å¹´10æœˆï¼Œç ”ç©¶ä¸­å¿ƒä¸»ä»»åˆ˜æŒºæ•™æˆåœ¨ä¸­å›½è®¡ç®—æœºå¤§ä¼šï¼ˆCNCCï¼‰ä¸Šæ­£å¼æå‡ºäº‹ç†å›¾è°±çš„æ¦‚å¿µï¼Œ2018å¹´9æœˆï¼Œåœ¨ç ”ç©¶ä¸­å¿ƒä¸æ•ˆè€å¸ˆçš„ä¸»æŒä¸‹ï¼Œç ”åˆ¶å‡ºä¸­æ–‡é‡‘èäº‹ç†å›¾è°±1.0ç‰ˆæœ¬ã€‚,ç ”ç©¶ä¸­å¿ƒ,æ•™æˆ,åˆ˜æŒº<br>2017å¹´10æœˆï¼Œç ”ç©¶ä¸­å¿ƒä¸»ä»»åˆ˜æŒºæ•™æˆåœ¨ä¸­å›½è®¡ç®—æœºå¤§ä¼šï¼ˆCNCCï¼‰ä¸Šæ­£å¼æå‡ºäº‹ç†å›¾è°±çš„æ¦‚å¿µï¼Œ2018å¹´9æœˆï¼Œåœ¨ç ”ç©¶ä¸­å¿ƒä¸æ•ˆè€å¸ˆçš„ä¸»æŒä¸‹ï¼Œç ”åˆ¶å‡ºä¸­æ–‡é‡‘èäº‹ç†å›¾è°±1.0ç‰ˆæœ¬ã€‚,ç ”ç©¶ä¸­å¿ƒ,ä¸»ä»»,åˆ˜æŒº<br>ç™½ç¡•ï¼ˆä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€å‰ä»»æ€»å·¥ç¨‹å¸ˆï¼Œä¸­ç§‘é™¢è®¡ç®—æ‰€åšå¯¼ï¼‰,ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€,å‰ä»»æ€»å·¥ç¨‹å¸ˆ,ç™½ç¡•<br>è€æ©ä¸œï¼ˆåŒ—äº¬è¯­è¨€å¤§å­¦ä¿¡æ¯å­¦é™¢é™¢é•¿ï¼‰,åŒ—äº¬è¯­è¨€å¤§å­¦ä¿¡æ¯å­¦é™¢,é™¢é•¿,è€æ©ä¸œ<br>èµµå†›ï¼ˆä¸­ç§‘é™¢è‡ªåŠ¨åŒ–æ‰€ç ”ç©¶å‘˜ï¼‰,ä¸­ç§‘é™¢è‡ªåŠ¨åŒ–æ‰€,ç ”ç©¶å‘˜,èµµå†›<br>å´åï¼ˆç™¾åº¦æŠ€æœ¯å§”å‘˜ä¼šä¸»å¸­ï¼‰,ç™¾åº¦æŠ€æœ¯,ä¸»å¸­,å´å<br>å´åï¼ˆç™¾åº¦æŠ€æœ¯å§”å‘˜ä¼šä¸»å¸­ï¼‰,ç™¾åº¦æŠ€æœ¯,å§”å‘˜,å´å<br>å®‹é˜³ç§‹ï¼ˆé¦™æ¸¯ç§‘æŠ€å¤§å­¦åŠ©ç†æ•™æˆï¼‰,é¦™æ¸¯ç§‘æŠ€å¤§å­¦,åŠ©ç†æ•™æˆ,å®‹é˜³ç§‹<br>æé‡‘é¾™ï¼ˆæ‹›å•†é“¶è¡Œäººå·¥æ™ºèƒ½å®éªŒå®¤è´Ÿè´£äººï¼‰,æ‹›å•†é“¶è¡Œäººå·¥æ™ºèƒ½å®éªŒå®¤,è´Ÿè´£äºº,æé‡‘é¾™<br>æä¸–å¥‡ï¼ˆåŒ—äº¬è¥¿äºšè´¢ä¿¡äººå·¥æ™ºèƒ½ç§‘æŠ€æœ‰é™è´£ä»»å…¬å¸CEOï¼‰,åŒ—äº¬è¥¿äºšè´¢ä¿¡äººå·¥æ™ºèƒ½ç§‘æŠ€æœ‰é™è´£ä»»å…¬å¸,CEO,æä¸–å¥‡</p></blockquote><p>å¯¹äºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ²¡æœ‰æŠ½å–å‡º<code>ææ–Œé˜³ï¼ˆå›½é™…å…³ç³»å­¦é™¢å‰¯æ•™æˆï¼‰</code>ä¸­çš„å®ä½“å…³ç³»ï¼Œå¹¶ä¸”<code>å´åï¼ˆç™¾åº¦æŠ€æœ¯å§”å‘˜ä¼šä¸»å¸­</code>è¿™å¥ä¸ºæŠ½å–æœ‰è¯¯ï¼Œæ­£ç¡®çš„åº”ä¸ºï¼šç™¾åº¦æŠ€æœ¯å§”å‘˜ä¼š,ä¸»å¸­,å´åã€‚</p><p>å°†ä¸Šè¿°å…³ç³»ä¿®æ”¹ä¸‹ï¼Œå¯¼å…¥è‡³Neo4Jä¸­ï¼Œå¾—åˆ°çš„å®ä½“å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/kg1_3.png" alt=""></p><p>ç¬¬äºŒç¯‡æ–‡ç« ä¸ºå‡¤å‡°ç½‘çš„æ–°é—»ï¼Œæ ‡é¢˜ä¸º<code>å—é˜³â€œæ°´æ°¢è½¦â€é£æ³¢ï¼šä¸€ä¸ªä¸­éƒ¨åŸå¸‚çš„æ‹›å•†çªå›´æˆ˜</code>ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<a href="https://news.ifeng.com/c/7ntawxhCDvj">https://news.ifeng.com/c/7ntawxhCDvj</a> ï¼Œæˆ‘ä»¬æŠ½å–å‡ºæ¥çš„å®ä½“å…³ç³»ï¼ˆå¸¦åŸæ–‡ï¼‰å¦‚ä¸‹è¡¨ï¼š</p><blockquote><p>åŸæ–‡,s,p,o<br>2017å¹´ï¼Œå› å·´é“æ‰€å±ä¼ä¸šåŒ—äº¬åèµ¢å‡¯æ¥èµ„äº§ç®¡ç†æœ‰é™å…¬å¸æ¶‰å«Œéæ³•é›†èµ„æ´»åŠ¨ï¼ŒåŒ—äº¬è­¦æ–¹å°†â€œå·´é“ä¹‹çˆ¶â€ç™½ä¸¹é’ä¾æ³•åˆ‘æ‹˜ã€‚,å·´é“,ä¹‹çˆ¶,ç™½ä¸¹é’<br>å—é˜³â€œç¥è½¦â€ä¸‹çº¿ä¹‹åï¼Œç•Œé¢æ–°é—»çº¦è®¿å—é˜³å¸‚å§”ä¹¦è®°å¼ æ–‡æ·±ï¼Œè¢«å‘ŠçŸ¥å¼ æ–‡æ·±ä¸å¸‚é•¿åŒåŒå‡ºå·®ï¼Œå·¥ä½œäººå‘˜å¹¶ä¸ç¡®å®šå¼ æ–‡æ·±ä½•æ—¶å›åˆ°å—é˜³ï¼Œä»–çš„æ‰‹æœºåˆ™å¤„äºå¿™çº¿çŠ¶æ€ã€‚,å—é˜³,å¸‚å§”ä¹¦è®°,å¼ æ–‡æ·±<br>å—é˜³æ´›ç‰¹æ–¯æ–°èƒ½æºæ±½è½¦æœ‰é™å…¬å¸å®é™…æ§åˆ¶äººåºé’å¹´è¯´ï¼Œæ°´æ°¢æ±½è½¦å¹¶æœªä¸‹çº¿ï¼Œåª’ä½“çš„æŠ¥é“ä½¿ä»–æªæ‰‹ä¸åŠã€‚,å—é˜³æ´›ç‰¹æ–¯æ–°èƒ½æºæ±½è½¦æœ‰é™å…¬å¸,å®é™…æ§åˆ¶äºº,åºé’å¹´<br>ä»2006å¹´å¼€å§‹ï¼Œå‰æ¹–åŒ—å·¥ä¸šå¤§å­¦å­¦è€…è‘£ä»•èŠ‚å¸¦é¢†çš„å›¢é˜Ÿå¼€å§‹ç ”å‘ä¸€é¡¹è½¦è½½é“åˆé‡‘æ°´è§£åˆ¶æ°¢æŠ€æœ¯ï¼Œå¹¶è·å¾—å›½å®¶973å‰æœŸç ”ç©¶é¡¹ç›®å’Œå›½å®¶è‡ªç„¶åŸºé‡‘çš„æ”¯æŒã€‚,æ¹–åŒ—å·¥ä¸šå¤§å­¦,å­¦è€…,è‘£ä»•èŠ‚<br>å—é˜³å¸‚é«˜æ–°åŒºæŠ•èµ„å…¬å¸è´Ÿè´£äººå°¹å¬ç¿¼åœ¨æ¥å—å¤®è§†é‡‡è®¿æ—¶è¡¨ç¤ºï¼Œåºé’å¹´ç»å¸¸æ‹¿â€œæ°´æ°¢â€æ¥æ··æ·†â€œæ°´è§£åˆ¶æ°¢â€çš„æ¦‚å¿µã€‚,å—é˜³å¸‚é«˜æ–°åŒºæŠ•èµ„å…¬å¸,è´Ÿè´£äºº,å°¹å¬ç¿¼<br>å—é˜³å¸‚æ‹›å•†å±€æ‹›å•†äºŒç§‘ç§‘é•¿èµµæ€¿æ¥å—ç•Œé¢æ–°é—»é‡‡è®¿æ—¶è¡¨ç¤ºï¼Œä»–åªçŸ¥é“è¿™ä¸ªé¡¹ç›®ä¸æ˜¯æ‹›å•†ç§‘å¼•è¿›çš„ã€‚,å—é˜³å¸‚æ‹›å•†å±€æ‹›å•†äºŒç§‘,ç§‘é•¿,èµµæ€¿<br>åºé’å¹´å‘Šè¯‰ç•Œé¢æ–°é—»ï¼Œå—é˜³å¸‚é«˜æ–°åŒºæŠ•èµ„æœ‰é™å…¬å¸å·²ç»ä¸ºä»–æä¾›äº†9600ä¸‡å…ƒï¼Œç”¨é€”æ˜¯å—é˜³é«˜æ–°åŒºæŠ•èµ„æœ‰é™å…¬å¸ç»™å—é˜³å¸‚æ´›ç‰¹æ–¯æ–°èƒ½æºæ±½è½¦æœ‰é™å…¬å¸çš„æ³¨å†Œèµ„é‡‘ï¼Œå è‚¡49%ã€‚,å—é˜³é«˜æ–°åŒºæŠ•èµ„æœ‰é™å…¬å¸,å—é˜³å¸‚,æ´›ç‰¹æ–¯æ–°èƒ½<br>æ›¾å…ˆååœ¨å—é˜³å¸‚å§”å…šæ ¡ã€å—é˜³å¸‚å‘æ”¹å§”ä»»èŒçš„é€€ä¼‘å¹²éƒ¨å¼ ä¸€æ±Ÿï¼ˆåŒ–åï¼‰è¯´ï¼Œâ€œèµ°å·¥ä¸šçªå›´é“è·¯çš„å†²åŠ¨åœ¨å—é˜³æ—©å·²æœ‰ä¹‹ï¼Œæ‰€ä»¥è¿™å‡ å¹´çš„å·´é“ç¥è½¦é¡¹ç›®ã€åŠ æ°´å°±èƒ½è·‘çš„ç¥è½¦é¡¹ç›®èƒ½è¢«å¼•è¿›å—é˜³ï¼Œæˆ‘è§‰å¾—ç®—ä¸ä¸Šå¥‡æ€ªã€‚â€,å—é˜³å¸‚å‘æ”¹å§”,é€€ä¼‘å¹²éƒ¨,å¼ ä¸€æ±Ÿ<br>ä»¥æ­¤æ¬¡å—é˜³ç¥è½¦é¡¹ç›®ä¸ºä¾‹ï¼Œå—é˜³å¸‚ç§‘æŠ€å±€å±€é•¿å¼ æ¢…æ˜ç¡®å‘Šè¯‰ç•Œé¢æ–°é—»ï¼Œåºé’å¹´çš„ä¼ä¸šè¿›å…¥å—é˜³æ—¶æœªæœ‰ä»»ä½•éƒ¨é—¨é‚€è¯·ç§‘æŠ€å±€é‰´åˆ«å…¶â€œæ–°èƒ½æºæŠ€æœ¯â€ã€‚,å—é˜³å¸‚ç§‘æŠ€å±€,å±€é•¿,å¼ æ¢…<br>å®˜æ–¹æŠ¥é“æ˜¾ç¤ºï¼Œ2012å¹´6æœˆ18æ—¥ï¼Œä¸€ä½æ—¶ä»»å—é˜³å¸‚å§”ä¸»è¦é¢†å¯¼åœ¨å—é˜³å®¾é¦†ä¼šè§äº†é’å¹´æ±½è½¦è‘£äº‹å±€ä¸»å¸­åºé’å¹´ä¸€è¡Œï¼ŒåŒæ–¹å°±å¦‚ä½•å‘æŒ¥è‡ªèº«ä¼˜åŠ¿ï¼Œè°‹æ±‚åˆä½œå…±èµ¢è¿›è¡Œäº†äº¤æµï¼Œâ€œå—é˜³çš„å‘å±•éœ€è¦å¤§é¡¹ç›®çš„å¸¦åŠ¨å’Œæ”¯æ’‘ï¼Œæˆ‘ä»¬æ¬¢è¿ä¸­å›½é’å¹´æ±½è½¦é›†å›¢è¿™æ ·æœ‰å®åŠ›ã€æœ‰å½±å“çš„å¤§ä¼ä¸šæ¥å—é˜³æŠ•èµ„å…´ä¸šã€‚,é’å¹´æ±½è½¦,è‘£äº‹å±€ä¸»å¸­,åºé’å¹´<br>æ—©åœ¨å½“å¹´5æœˆï¼Œåœ¨ç¬¬åä¹å±Šä¸­å›½åŒ—äº¬å›½é™…ç§‘æŠ€åšè§ˆä¼šä¸Šï¼Œæ—¶ä»»å—é˜³å¸‚å‰¯å¸‚é•¿éƒ‘èŒ‚æ°ä¸å·´é“ç§‘æŠ€å‘å±•æœ‰é™å…¬å¸æ€»å·¥ç¨‹å¸ˆå®‹æœ‰æ´²ç­¾ç½²æˆ˜ç•¥åˆä½œåè®®ã€‚,å·´é“ç§‘æŠ€å‘å±•æœ‰é™å…¬å¸,æ€»å·¥ç¨‹å¸ˆ,å®‹æœ‰æ´²<br>æ—©åœ¨å½“å¹´5æœˆï¼Œåœ¨ç¬¬åä¹å±Šä¸­å›½åŒ—äº¬å›½é™…ç§‘æŠ€åšè§ˆä¼šä¸Šï¼Œæ—¶ä»»å—é˜³å¸‚å‰¯å¸‚é•¿éƒ‘èŒ‚æ°ä¸å·´é“ç§‘æŠ€å‘å±•æœ‰é™å…¬å¸æ€»å·¥ç¨‹å¸ˆå®‹æœ‰æ´²ç­¾ç½²æˆ˜ç•¥åˆä½œåè®®ã€‚,å—é˜³å¸‚,å‰¯å¸‚é•¿,éƒ‘èŒ‚æ°</p></blockquote><p>å¯¹äºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ²¡æœ‰æŠ½å–å‡ºä¸€äº›å…³ç³»ï¼Œæ¯”å¦‚<code>å—é˜³å¸‚å‘å±•å’Œæ”¹é©å§”å‘˜ä¼šä¸»ä»»ä¹”é•¿æ©å—è®¿æ—¶æ‰¿è®¤ï¼Œæ‹›å•†å¼•å…¥å—é˜³æ´›æ–¯ç‰¹ä¹‹å‰â€œæŒæ¡è¿™ä¸ªæƒ…å†µã€‚â€</code>ç­‰ï¼Œå¹¶ä¸”<code>åºé’å¹´å‘Šè¯‰ç•Œé¢æ–°é—»ï¼Œå—é˜³å¸‚é«˜æ–°åŒºæŠ•èµ„æœ‰é™å…¬å¸å·²ç»ä¸ºä»–æä¾›äº†9600ä¸‡å…ƒï¼Œç”¨é€”æ˜¯å—é˜³é«˜æ–°åŒºæŠ•èµ„æœ‰é™å…¬å¸ç»™å—é˜³å¸‚æ´›ç‰¹æ–¯æ–°èƒ½æºæ±½è½¦æœ‰é™å…¬å¸çš„æ³¨å†Œèµ„é‡‘ï¼Œå è‚¡49%ã€‚</code>è¿™å¥ä¸ºæŠ½å–æœ‰è¯¯ï¼Œåº”å½“åˆ é™¤ã€‚</p><p>å°†ä¸Šè¿°å…³ç³»ä¿®æ”¹ä¸‹ï¼Œå¯¼å…¥è‡³Neo4Jä¸­ï¼Œå¾—åˆ°çš„å®ä½“å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/kg1_4.png" alt=""></p><p>æœ€åä¸€ç¯‡ä¸ºé•¿ç¯‡å°è¯´â€”â€”è‘—åä½œå®¶è·¯é¥çš„ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹ç¬¬ä¸€éƒ¨ã€‚åˆ©ç”¨æˆ‘ä»¬çš„å…³ç³»æŠ½å–æ¨¡å‹ï¼Œä¸€å…±åœ¨è¯¥å°è¯´ä¸­æŠ½å–äº†169å¯¹å®ä½“å…³ç³»ï¼Œå…¶ä¸­æœ‰æ•ˆå®ä½“å…³ç³»100å¯¹ã€‚ç”±äºæˆ‘ä»¬åœ¨è¯¥å°è¯´ä¸­æŠ½å–çš„å®ä½“å…³ç³»è¿‡å¤šï¼Œå› æ­¤åªå±•ç¤ºå‰10æ¡åŸæ–‡åŠæŠ½å–çš„å®ä½“å…³ç³»ï¼š</p><blockquote><p>åŸæ–‡,s,p,o<br>æ¯å¤©æ¥å›äºŒåé‡Œè·¯ï¼Œä¸ä»–ä¸€å—ä¸Šå­¦çš„é‡‘æ³¢å’Œå¤§é˜Ÿä¹¦è®°ç”°ç¦å ‚çš„å„¿å­æ¶¦ç”Ÿéƒ½æœ‰è‡ªè¡Œè½¦ï¼Œåªæœ‰ä»–æ˜¯ä¸¤æ¡è…¿èµ°è·¯ã€‚,ç”°ç¦å ‚,å„¿å­,æ¶¦ç”Ÿ<br>ä¸è¿‡ï¼Œä»–å¯¹æ¶¦ç”Ÿçš„å§å§æ¶¦å¶å€’æ€€æœ‰ä¸€ç§äº²åˆ‡çš„æ„Ÿæƒ…ã€‚,æ¶¦ç”Ÿ,å§å§,æ¶¦å¶<br>â€œé‡‘æ³¢æ˜¯é‡‘ä¿Šæµ·çš„å°å­ã€‚â€,é‡‘ä¿Šæµ·,å°å­,â€œé‡‘æ³¢<br>è„‘å­é‡ŒæŠŠå‰åæ‘åº„æœªå«çš„å¥³å­ä¸€ä¸ªä¸ªæƒ³è¿‡å»ï¼Œæœ€åé€‰å®šäº†åŒæ°´æ‘å­™ç‰åšçš„å¤§å¥³å­å…°èŠ±ã€‚,åŒæ°´æ‘å­™ç‰åš,å¤§å¥³å­,å…°èŠ±<br>ç‰äº­æ˜¯å¤§é˜Ÿå…šæ”¯éƒ¨å§”å‘˜ã€å†œç”°åŸºå»ºé˜Ÿé˜Ÿé•¿ã€è´«ä¸‹ä¸­å†œç®¡ç†å­¦æ ¡å§”å‘˜ä¼šä¸»ä»»ï¼Œä¸€èº«ä¸‰èŒï¼Œåœ¨æ‘é‡Œä¹Ÿæ˜¯ä¸€ä¸ªäººç‰©ã€‚,è´«ä¸‹ä¸­å†œç®¡ç†å­¦æ ¡,ä¸»ä»»,ç‰äº­<br>ç‰äº­æ˜¯å¤§é˜Ÿå…šæ”¯éƒ¨å§”å‘˜ã€å†œç”°åŸºå»ºé˜Ÿé˜Ÿé•¿ã€è´«ä¸‹ä¸­å†œç®¡ç†å­¦æ ¡å§”å‘˜ä¼šä¸»ä»»ï¼Œä¸€èº«ä¸‰èŒï¼Œåœ¨æ‘é‡Œä¹Ÿæ˜¯ä¸€ä¸ªäººç‰©ã€‚,å†œç”°åŸºå»ºé˜Ÿ,é˜Ÿé•¿,ç‰äº­<br>ç‰äº­æ˜¯å¤§é˜Ÿå…šæ”¯éƒ¨å§”å‘˜ã€å†œç”°åŸºå»ºé˜Ÿé˜Ÿé•¿ã€è´«ä¸‹ä¸­å†œç®¡ç†å­¦æ ¡å§”å‘˜ä¼šä¸»ä»»ï¼Œä¸€èº«ä¸‰èŒï¼Œåœ¨æ‘é‡Œä¹Ÿæ˜¯ä¸€ä¸ªäººç‰©ã€‚,å¤§é˜Ÿ,å…šæ”¯éƒ¨å§”å‘˜,ç‰äº­<br>ä¼šæˆ˜æ€»æŒ‡æŒ¥æ˜¯å…¬ç¤¾å‰¯ä¸»ä»»å¾æ²»åŠŸï¼Œå‰¯æ€»æŒ‡æŒ¥æ˜¯å…¬ç¤¾æ­¦è£…ä¸“å¹²æ¨é«˜è™ã€‚,å…¬ç¤¾,æ­¦è£…,æ¨é«˜è™<br>ä¼šæˆ˜æ€»æŒ‡æŒ¥æ˜¯å…¬ç¤¾å‰¯ä¸»ä»»å¾æ²»åŠŸï¼Œå‰¯æ€»æŒ‡æŒ¥æ˜¯å…¬ç¤¾æ­¦è£…ä¸“å¹²æ¨é«˜è™ã€‚,å…¬ç¤¾,å‰¯ä¸»ä»»,å¾æ²»åŠŸ<br>è¿™æ—¶å€™ï¼ŒåŒæ°´æ‘å¦‡å¥³ä¸»ä»»è´ºå‡¤è‹±ï¼Œæ­£é¢†ç€æœ¬æ‘å’Œå¤–æ‘çš„ä¸€äº›â€œé“å§‘å¨˜â€ï¼Œå¿™ç¢Œåœ°å¸ƒç½®ä¼šåœºã€‚,åŒæ°´æ‘,å¦‡å¥³ä¸»ä»»,è´ºå‡¤è‹±<br>â€¦â€¦</p></blockquote><p>å°†ä¸Šè¿°å…³ç³»ä¿®æ”¹ä¸‹ï¼Œå¯¼å…¥è‡³Neo4Jä¸­ï¼Œå¾—åˆ°çš„å®ä½“å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/kg1_5.png" alt=""></p><p><img src="/img/kg1_6.png" alt=""></p><p><img src="/img/kg1_7.png" alt=""></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ¬¡å…³ç³»æŠ½å–ä»…ä»…ä½œä¸ºç¬”è€…çš„ä¸€æ¬¡å°è¯•ï¼Œåœ¨å®é™…çš„åº”ç”¨ä¸­è¿˜å­˜åœ¨ç€è®¸å¤šçš„ä¸è¶³ä¹‹å¤„ï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>å¯¹è¯­æ–™çš„æ ‡æ³¨ï¼Œæ˜¯å¦å¯ä»¥é‡‡ç”¨å…¶ä»–æ›´å¥½çš„åŠæ³•ï¼›</p></li><li><p>ä½œä¸ºé€šç”¨æ¨¡å‹ï¼Œæ ‡æ³¨çš„æ•°é‡è¿˜è¿œè¿œä¸å¤Ÿï¼›</p></li><li><p>æ¨¡å‹çš„é€‰æ‹©æ–¹é¢ï¼Œæ˜¯å¦å¯ä»¥å…¶ä»–æ›´å¥½çš„æ¨¡å‹ï¼›</p></li><li><p>å¯¹é¢„æµ‹çš„ç»“æœï¼Œå¦‚ä½•èƒ½æ›´å¥½åœ°æå–å‡ºä¸‰å…ƒç»„ï¼›</p></li><li><p>å°†ä¸‰å…ƒç»„æ‰«å…¥è‡³å›¾æ•°æ®åº“ä¸­ï¼Œèƒ½å¦åšåˆ°å®ä½“å¯¹é½ï¼Œä¸”èƒ½åšä¸€äº›å®ä½“å…³ç³»çš„åˆ†æä¸æ¨ç†ã€‚</p><p>æœ¬æ–‡ç”¨åˆ°çš„è¯­æ–™ä»¥åŠæ¨¡å‹ä¼šåœ¨åç»­çš„æ–‡ç« ä¸­å…¬å¼€ï¼Œå¸Œæœ›å¤§å®¶èƒ½ç»§ç»­å…³æ³¨ï½</p><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼š NLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨~</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†å›¾è°±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…³ç³»æŠ½å–</tag>
      
      <tag>çŸ¥è¯†å›¾è°±</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆåå…«ï¼‰åˆ©ç”¨ALBERTæå‡æ¨¡å‹é¢„æµ‹é€Ÿåº¦çš„ä¸€æ¬¡å°è¯•</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E5%8D%81%E5%85%AB%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E6%8F%90%E5%8D%87%E6%A8%A1%E5%9E%8B%E9%A2%84%E6%B5%8B%E9%80%9F%E5%BA%A6%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E5%8D%81%E5%85%AB%EF%BC%89%E5%88%A9%E7%94%A8ALBERT%E6%8F%90%E5%8D%87%E6%A8%A1%E5%9E%8B%E9%A2%84%E6%B5%8B%E9%80%9F%E5%BA%A6%E7%9A%84%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="å‰æ²¿">å‰æ²¿</h3><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89%E5%88%A9%E7%94%A8tensorflow-serving%E9%83%A8%E7%BD%B2kashgari%E6%A8%A1%E5%9E%8B/">NLPï¼ˆåä¸ƒï¼‰åˆ©ç”¨tensorflow-servingéƒ¨ç½²kashgariæ¨¡å‹</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨tensorflow-servingéƒ¨ç½²æ¥éƒ¨ç½²æ·±åº¦æ¨¡å‹æ¨¡å‹ï¼Œåœ¨é‚£ç¯‡æ–‡ç« ä¸­ï¼Œç¬”è€…åˆ©ç”¨kashgariæ¨¡å—å®ç°äº†ç»å…¸çš„BERT+Bi-LSTM+CRFæ¨¡å‹ç»“æ„ï¼Œåœ¨æ ‡æ³¨äº†æ—¶é—´çš„æ–‡æœ¬è¯­æ–™ï¼ˆå¤§çº¦2000å¤šä¸ªè®­ç»ƒå¥å­ï¼‰ä¸­ä¹Ÿè¾¾åˆ°äº†å¾ˆå¥½çš„è¯†åˆ«æ•ˆæœï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ç€ä¸è¶³ä¹‹å¤„ï¼Œé‚£å°±æ˜¯æ¨¡å‹çš„é¢„æµ‹æ—¶é—´è¿‡é•¿ï¼Œå¹³å‡é¢„æµ‹ä¸€ä¸ªå¥å­ä¸­çš„æ—¶é—´è€—æ—¶çº¦400æ¯«ç§’ï¼Œè¿™ç§é¢„æµ‹é€Ÿåº¦åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–å®é™…åº”ç”¨ä¸­æ˜¯ä¸èƒ½å¿å—çš„ã€‚</p><p>æŸ¥çœ‹è¯¥æ¨¡å‹çš„è€—æ—¶åŸå› ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› åœ¨äºBERTçš„è°ƒç”¨ã€‚BERTæ˜¯å½“ä¸‹æœ€ç«ï¼ŒçŸ¥ååº¦æœ€é«˜çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œè™½ç„¶ä¼šä½¿å¾—æ¨¡å‹çš„è®­ç»ƒã€é¢„æµ‹è€—æ—¶å¢åŠ ï¼Œä½†ä¹Ÿæ˜¯å°æ ·æœ¬è¯­æ–™ä¸‹çš„æœ€ä½³æ¨¡å‹å·¥å…·ä¹‹ä¸€ï¼Œå› æ­¤ï¼ŒBERTåœ¨æ¨¡å‹çš„æ¶æ„ä¸Šæ˜¯ä¸å¯ç¼ºå°‘çš„ã€‚é‚£ä¹ˆï¼Œè¯¥å¦‚ä½•é¿å…ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹å¸¦æ¥çš„æ¨¡å‹é¢„æµ‹è€—æ—¶è¿‡é•¿çš„é—®é¢˜å‘¢ï¼Ÿ</p><p>æœ¬æ–‡å†³å®šå°è¯•ä½¿ç”¨ALBERTï¼Œæ¥éªŒè¯ALBERTåœ¨æå‡æ¨¡å‹é¢„æµ‹é€Ÿåº¦æ–¹é¢çš„åº”ç”¨ï¼ŒåŒæ—¶ï¼Œä¹Ÿç®—æ˜¯æœ¬äººå¯¹äºä½¿ç”¨ALBERTçš„ä¸€æ¬¡å®æˆ˜å§~</p><h3 id="albertç®€ä»‹">ALBERTç®€ä»‹</h3><p>æˆ‘ä»¬ä¸å¦¨èŠ±ä¸€äº›æ—¶é—´æ¥ç®€å•åœ°äº†è§£ä¸€ä¸‹ALBERTã€‚ALBERTæ˜¯æœ€è¿‘ä¸€å‘¨æ‰å¼€æºçš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå…¶Githubçš„ç½‘å€ä¸ºï¼šhttps://github.com/brightmart/albert_zhï¼Œå…¶è®ºæ–‡å¯ä»¥å‚è€ƒç½‘å€ï¼šhttps://arxiv.org/pdf/1909.11942.pdf ã€‚</p><p>æ ¹æ®ALBERTçš„Githubä»‹ç»ï¼ŒALBERTåœ¨æµ·é‡ä¸­æ–‡è¯­æ–™ä¸Šè¿›è¡Œäº†é¢„è®­ç»ƒï¼Œæ¨¡å‹çš„å‚æ•°æ›´å°‘ï¼Œæ•ˆæœæ›´å¥½ã€‚ä»¥albert_tiny_zhä¸ºä¾‹ï¼Œå…¶æ–‡ä»¶å¤§å°16Mã€å‚æ•°ä¸º1.8Mï¼Œæ¨¡å‹å¤§å°ä»…ä¸ºBERTçš„1/25ï¼Œæ•ˆæœä»…æ¯”BERTç•¥å·®æˆ–è€…åœ¨æŸäº›NLPä»»åŠ¡ä¸Šæ›´å¥½ã€‚åœ¨æœ¬æ–‡çš„é¢„è®­ç»ƒæ¨¡å‹ä¸­ï¼Œå°†é‡‡ç”¨albert_tiny_zhã€‚</p><h3 id="åˆ©ç”¨albertè®­ç»ƒæ—¶é—´è¯†åˆ«æ¨¡å‹">åˆ©ç”¨ALBERTè®­ç»ƒæ—¶é—´è¯†åˆ«æ¨¡å‹</h3><p>æˆ‘ä»¬ä»¥Githubä¸­çš„bertNERä¸ºæœ¬æ¬¡é¡¹ç›®çš„ä»£ç æ¨¡æ¿ï¼Œåœ¨è¯¥é¡¹ç›®ä¸­ï¼Œå®ç°çš„æ¨¡å‹ä¸ºBERT+Bi-LSTM+CRFï¼Œæˆ‘ä»¬å°†BERTæ›¿æ¢ä¸ºALBERTï¼Œä¹Ÿå°±æ˜¯è¯´ç¬”è€…çš„é¡¹ç›®ä¸­æ¨¡å‹ä¸ºALBERT+Bi-LSTM+CRFï¼ŒåŒæ—¶æ›¿æ¢bertæ–‡ä»¶å¤¹çš„ä»£ç ä¸ºalert_zhï¼Œæ›¿æ¢é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶å¤¹chinese_L-12_H-768_A-12ï¼ˆBERTä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶ï¼‰ä¸ºalbert_tinyã€‚å½“ç„¶ï¼Œä¹Ÿéœ€è¦ä¿®æ”¹ä¸€éƒ¨åˆ†çš„é¡¹ç›®æºä»£ç ï¼Œæ¥é€‚åº”ALBERTçš„æ¨¡å‹è®­ç»ƒã€‚</p><p>æ•°æ®é›†é‡‡ç”¨ç¬”è€…è‡ªå·±æ ‡æ³¨çš„æ—¶é—´è¯­æ–™ï¼Œå³æ ‡æ³¨äº†æ—¶é—´çš„å¥å­ï¼Œå¤§æ¦‚2000+å¥å­ï¼Œå…¶ä¸­75%ä½œä¸ºè®­ç»ƒé›†ï¼ˆtime.trainæ–‡ä»¶ï¼‰ï¼Œ10%ä½œä¸ºéªŒè¯é›†ï¼ˆtime.devæ–‡ä»¶ï¼‰ï¼Œ15%ä½œä¸ºæµ‹è¯•é›†ï¼ˆtime.testæ–‡ä»¶ï¼‰ã€‚åœ¨è¿™é‡Œç¬”è€…ä¸æ‰“ç®—ç»™å‡ºå…·ä½“çš„Pythonä»£ç ï¼Œå› ä¸ºå·¥ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œæœ‰å…´è¶£çš„é¢è¯»è€…å¯ä»¥å»æŸ¥çœ‹è¯¥é¡¹ç›®çš„Githubåœ°å€ï¼š<ahref="https://github.com/percent4/ALBERT_4_Time_Recognition">https://github.com/percent4/ALBERT_4_Time_Recognition</a>ã€‚</p><p>ä¸€äº›æ¨¡å‹çš„å‚æ•°å¯ä»¥å¦‚ä¸‹ï¼š</p><ul><li><p>é¢„è®­ç»ƒæ¨¡å‹ï¼šALBERTï¼ˆtinyï¼‰</p></li><li><p>è®­ç»ƒæ ·æœ¬çš„æœ€å¤§å­—ç¬¦é•¿åº¦ï¼š 128</p></li><li><p>batch_size: 8</p></li><li><p>epoch: 100</p></li><li><p>åŒå‘LSTMçš„ä¸ªæ•°ï¼š100</p><p>ALBERTçš„æ¨¡å‹è®­ç»ƒæ—¶é—´ä¹Ÿä¼šæ˜¾è‘—æé«˜ï¼Œæˆ‘ä»¬è€å¿ƒåœ°ç­‰å¾…æ¨¡å‹è®­ç»ƒå®Œæ¯•ã€‚åœ¨time.devå’Œtime.testæ•°æ®é›†ä¸Šçš„è¡¨ç°å¦‚ä¸‹è¡¨ï¼š</p></li></ul><table><thead><tr class="header"><th>æ•°æ®é›†</th><th>precision</th><th>recall</th><th>f1</th></tr></thead><tbody><tr class="odd"><td>time.dev</td><td>81.41%</td><td>84.95%</td><td>83.14%</td></tr><tr class="even"><td>time.test</td><td>83.03%</td><td>86.38%</td><td>84.67%</td></tr></tbody></table><p>æ¥ç€ç¬”è€…åˆ©ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œç”¨tornadoå°è£…äº†ä¸€ä¸ªæ¨¡å‹é¢„æµ‹çš„HTTPæœåŠ¡ï¼Œå…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> traceback<br><br><span class="hljs-keyword">import</span> tornado.httpserver<br><span class="hljs-keyword">import</span> tornado.ioloop<br><span class="hljs-keyword">import</span> tornado.options<br><span class="hljs-keyword">import</span> tornado.web<br><span class="hljs-keyword">from</span> tornado.options <span class="hljs-keyword">import</span> define, options<br><br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> create_model, get_logger<br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> loader <span class="hljs-keyword">import</span> input_from_line<br><span class="hljs-keyword">from</span> train <span class="hljs-keyword">import</span> FLAGS, load_config, train<br><br><span class="hljs-comment"># å®šä¹‰ç«¯å£ä¸º12306</span><br>define(<span class="hljs-string">&quot;port&quot;</span>, default=<span class="hljs-number">12306</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;run on the given port&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>)<br><span class="hljs-comment"># å¯¼å…¥æ¨¡å‹</span><br>config = load_config(FLAGS.config_file)<br>logger = get_logger(FLAGS.log_file)<br><span class="hljs-comment"># limit GPU memory</span><br>tf_config = tf.ConfigProto()<br>tf_config.gpu_options.allow_growth = <span class="hljs-literal">False</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(FLAGS.map_file, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    tag_to_id, id_to_tag = pickle.load(f)<br><br>sess = tf.Session(config=tf_config)<br>model = create_model(sess, Model, FLAGS.ckpt_path, config, logger)<br><br><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹çš„HTTPæ¥å£</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ResultHandler</span>(tornado.web.RequestHandler):<br>    <span class="hljs-comment"># postå‡½æ•°</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self</span>):<br>        event = self.get_argument(<span class="hljs-string">&#x27;event&#x27;</span>)<br>        result = model.evaluate_line(sess, input_from_line(event, FLAGS.max_seq_len, tag_to_id), id_to_tag)<br>        self.write(json.dumps(result, ensure_ascii=<span class="hljs-literal">False</span>))<br><br><span class="hljs-comment"># ä¸»å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># å¼€å¯tornadoæœåŠ¡</span><br>    tornado.options.parse_command_line()<br>    <span class="hljs-comment"># å®šä¹‰app</span><br>    app = tornado.web.Application(<br>            handlers=[<br>                      (<span class="hljs-string">r&#x27;/subj_extract&#x27;</span>, ResultHandler)<br>                     ], <span class="hljs-comment">#ç½‘é¡µè·¯å¾„æ§åˆ¶</span><br>           )<br>    http_server = tornado.httpserver.HTTPServer(app)<br>    http_server.listen(options.port)<br>    tornado.ioloop.IOLoop.instance().start()<br><br>main()<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹é¢„æµ‹æé€Ÿäº†å—">æ¨¡å‹é¢„æµ‹æé€Ÿäº†å—ï¼Ÿ</h3><p>å°†æ¨¡å‹é¢„æµ‹å°è£…æˆHTTPæœåŠ¡åï¼Œæˆ‘ä»¬åˆ©ç”¨Postmanæ¥æµ‹è¯•æ¨¡å‹é¢„æµ‹çš„æ•ˆæœå’Œæ—¶é—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/nlp18_1.png" /></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡å‹é¢„æµ‹çš„ç»“æœæ­£ç¡®ï¼Œä¸”è€—æ—¶ä»…ä¸º38msã€‚</p><p>æ¥ç€æˆ‘ä»¬å°è¯•å¤šæµ‹è¯•å‡ ä¸ªå¥å­çš„æµ‹è¯•ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Daxing, Beijing</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> time<br><br>url = <span class="hljs-string">&#x27;http://localhost:12306/subj_extract&#x27;</span><br><br>texts = [<span class="hljs-string">&#x27;è®°è€…ä»å›½å®¶å‘å±•æ”¹é©å§”ã€å•†åŠ¡éƒ¨ç›¸å…³æ–¹é¢è·æ‚‰ï¼Œæ—¥å‰ç¾æ–¹å·²å†³å®šå¯¹æ‹Ÿäº10æœˆ1æ—¥å®æ–½çš„ä¸­å›½è¾“ç¾å•†å“åŠ å¾å…³ç¨æªæ–½åšå‡ºè°ƒæ•´ï¼Œä¸­æ–¹æ”¯æŒç›¸å…³ä¼ä¸šä»å³æ—¥èµ·æŒ‰ç…§å¸‚åœºåŒ–åŸåˆ™å’ŒWTOè§„åˆ™ï¼Œè‡ªç¾é‡‡è´­ä¸€å®šæ•°é‡å¤§è±†ã€çŒªè‚‰ç­‰å†œäº§å“ï¼Œå›½åŠ¡é™¢å…³ç¨ç¨åˆ™å§”å‘˜ä¼šå°†å¯¹ä¸Šè¿°é‡‡è´­äºˆä»¥åŠ å¾å…³ç¨æ’é™¤ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®å°åº¦Zeeæ–°é—»ç½‘ç«™12æ—¥æŠ¥é“ï¼Œäºšæ´²æ–°é—»å›½é™…é€šè®¯ç¤¾æ´å¼•å°åº¦å†›æ–¹æ¶ˆæ¯äººå£«çš„è¯è¯´ï¼Œ9æœˆ11æ—¥çš„å¯¹å³™äº‹ä»¶å‘ç”Ÿåœ¨é è¿‘ç­å…¬é”™åŒ—å²¸çš„å®é™…æ§åˆ¶çº¿ä¸€å¸¦ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å„‹å·å¸‚å†³å®šï¼Œä»9æœˆå¼€å§‹ï¼Œå¯¹åŸå¸‚ä½ä¿ã€å†œæ‘ä½ä¿ã€ç‰¹å›°ä¾›å…»äººå‘˜ã€ä¼˜æŠšå¯¹è±¡ã€é¢†å–å¤±ä¸šä¿é™©é‡‘äººå‘˜ã€å»ºæ¡£ç«‹å¡æœªè„±è´«äººå£ç­‰ä½æ”¶å…¥ç¾¤ä½“å…±3ä¸‡å¤šäººï¼Œå‘æ”¾çŒªè‚‰ä»·æ ¼è¡¥è´´ï¼Œæ¯äººæ¯æœˆå‘æ”¾ä¸ä½äº100å…ƒè¡¥è´´ï¼Œä»¥åå‘æ”¾æ ‡å‡†ï¼Œå°†æ ¹æ®çŒªè‚‰ä»·æ³¢åŠ¨æƒ…å†µè¿›è¡ŒåŠ¨æ€è°ƒæ•´ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;9æœˆ11æ—¥ï¼Œåä¸ºå¿ƒå£°ç¤¾åŒºå‘å¸ƒç¾å›½ç»æµå­¦å®¶æ‰˜é©¬æ–¯.å¼—é‡Œå¾·æ›¼åœ¨ã€Šçº½çº¦æ—¶æŠ¥ã€‹ä¸Šçš„ä¸“æ å†…å®¹ï¼Œå¼—é‡Œå¾·æ›¼é€éœ²ï¼Œåœ¨ä¸åä¸ºåˆ›å§‹äººä»»æ­£éæœ€è¿‘ä¸€æ¬¡é‡‡è®¿ä¸­ï¼Œä»»æ­£éè¡¨ç¤ºåä¸ºæ„¿æ„ä¸ç¾å›½å¸æ³•éƒ¨å±•å¼€è¯é¢˜ä¸è®¾é™çš„è®¨è®ºã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;é€ è¡€å¹²ç»†èƒç§»æ¤æ²»ç–—ç™½è¡€ç—…æŠ€æœ¯å·²æ—¥ç›Šæˆç†Ÿï¼Œç„¶è€Œï¼Œé€šè¿‡è¯¥æ–¹æ³•åŒæ—¶æ²»æ„ˆè‰¾æ»‹ç—…ç›®å‰è¿˜æ˜¯ä¸€é“å…¨çƒå°šåœ¨æ”»å…‹çš„éš¾é¢˜ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;è‹±å›½èˆªç©ºäº‹æ•…è°ƒæŸ¥å±€ï¼ˆAAIBï¼‰è¿‘æ—¥æŠ«éœ²ï¼Œä»Šå¹´2æœˆ6æ—¥ä¸€è¶Ÿç”±å¾·å›½æ³•å…°å…‹ç¦é£å¾€å¢¨è¥¿å“¥åæ˜†çš„èˆªç­ä¸Šï¼Œå› é£è¡Œå‘˜æ‰“ç¿»å’–å•¡ä½¿æ“ä½œé¢æ¿å†’çƒŸï¼Œå¯¼è‡´é£æœºæŠ˜è¿”è¿«é™çˆ±å°”å…°ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å½“åœ°æ—¶é—´å‘¨å››ï¼ˆ9æœˆ12æ—¥ï¼‰ï¼Œå°åº¦å°¼è¥¿äºšè´¢æ”¿éƒ¨é•¿è‹±å“åï¼ˆSri Mulyani Indrawatiï¼‰æ˜ç¡®è¡¨ç¤ºï¼šç‰¹æœ—æ™®çš„æ¨ç‰¹æ˜¯é£é™©ä¹‹ä¸€ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;åä¸­ç§‘æŠ€å¤§å­¦9æœˆ12æ—¥é€šè¿‡å…¶å®˜æ–¹ç½‘ç«™å‘å¸ƒé€šæŠ¥ç§°ï¼Œ9æœˆ2æ—¥ï¼Œæˆ‘æ ¡ä¸€ç¡•å£«ç ”ç©¶ç”Ÿä¸å¹¸å æ¥¼èº«äº¡ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å¾®åšç”¨æˆ·@ooooviki 9æœˆ12æ—¥ä¸‹åˆå…¬å¸ƒå‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šçš„æƒŠæ‚šé­é‡ï¼šä¸€ä¸ªè‡ªç§°ç½‘è­¦ã€åå«éƒ‘æ´‹çš„äººåˆ©ç”¨èŒåŠ¡ä¹‹ä¾¿ï¼ŒæŸ¥åˆ°å¥¹çš„å®Œå¤‡çš„ä¸ªäººä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºèº«ä»½è¯å·ã€å®¶åº­åœ°å€ã€ç”µè¯å·ç ã€æˆ·ç±å˜åŠ¨æƒ…å†µç­‰ï¼Œè¦æ±‚å¥¹åšä»–å¥³æœ‹å‹ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ä»Šå¤©ï¼Œè´µé˜³å–æ¶ˆäº†æ±½è½¦é™è´­ï¼Œæˆä¸ºç›®å‰å…¨å›½å®è¡Œé™è´­æ”¿ç­–çš„9ä¸ªçœå¸‚ä¸­ï¼Œé¦–ä¸ªå–æ¶ˆé™è´­çš„åŸå¸‚ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®æ‚‰ï¼Œä¸å…¨çƒåŒæ­¥ï¼Œä¸­å›½åŒºæ­¤æ¬¡å°†äº9æœˆ13æ—¥äºiPhoneå®˜æ–¹æ¸ é“å’Œäº¬ä¸œæ­£å¼å¼€å¯é¢„å”®ï¼Œäº¬ä¸œæˆAppleä¸­å›½åŒºå”¯ä¸€å®˜æ–¹æˆæƒé¢„å”®æ¸ é“ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ ¹æ®å¤®è¡Œå…¬å¸ƒçš„æ•°æ®ï¼Œæˆªè‡³2019å¹´6æœˆæœ«ï¼Œå­˜æ¬¾ç±»é‡‘èæœºæ„ä½æˆ·éƒ¨é—¨çŸ­æœŸæ¶ˆè´¹è´·æ¬¾è§„æ¨¡ä¸º9.11ä¸‡äº¿å…ƒï¼Œ2019å¹´ä¸ŠåŠå¹´è¯¥é¡¹å‡€å¢3293.19äº¿å…ƒï¼Œä¸ŠåŠå¹´å¢é‡çœ‹èµ·æ¥å¹¶ä¸ä¹è§‚ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;9æœˆ11æ—¥ï¼Œä¸€æ®µæ‹æ‘„æµ™æ±Ÿä¸‡é‡Œå­¦é™¢å­¦ç”Ÿé£Ÿå ‚çš„è§†é¢‘èµ°çº¢ç½‘ç»œï¼Œè§†é¢‘æ˜¾ç¤ºè¯¥å­¦æ ¡é£Ÿå ‚ä¸ä»…åœ¨ç”¨é¤åŒºåŸŸè®¾ç½®äº†å¯ä»¥çœ‹ç”µå½±ã€æ¯”èµ›çš„å¤§å±å¹•ï¼Œè¿˜æ¨å‡ºäº†â€œä¸€äººé£Ÿâ€é¤ä½ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å½“æ—¥ï¼Œåœ¨åŒ—äº¬ä¸¾è¡Œçš„2019å¹´å›½é™…ç¯®è”ç¯®çƒä¸–ç•Œæ¯åŠå†³èµ›ä¸­ï¼Œè¥¿ç­ç‰™é˜Ÿå¯¹é˜µæ¾³å¤§åˆ©äºšé˜Ÿã€‚&#x27;</span>,<br>         ]<br><br>t1 = time.time()<br><span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts:<br>    data = &#123;<span class="hljs-string">&#x27;event&#x27;</span>: text.replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)&#125;<br>    req = requests.post(url, data)<br>    <span class="hljs-keyword">if</span> req.status_code == <span class="hljs-number">200</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;åŸæ–‡ï¼š%s&#x27;</span> % text)<br>        res = json.loads(req.content)[<span class="hljs-string">&#x27;entities&#x27;</span>]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æŠ½å–ç»“æœï¼š%s&#x27;</span> % <span class="hljs-built_in">str</span>([_[<span class="hljs-string">&#x27;word&#x27;</span>] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> res]))<br><br><br>t2 = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸€å…±è€—æ—¶ï¼š%ss.&#x27;</span> % <span class="hljs-built_in">str</span>(<span class="hljs-built_in">round</span>(t2-t1, <span class="hljs-number">4</span>)))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs prolog">åŸæ–‡ï¼šè®°è€…ä»å›½å®¶å‘å±•æ”¹é©å§”ã€å•†åŠ¡éƒ¨ç›¸å…³æ–¹é¢è·æ‚‰ï¼Œæ—¥å‰ç¾æ–¹å·²å†³å®šå¯¹æ‹Ÿäº<span class="hljs-number">10</span>æœˆ<span class="hljs-number">1</span>æ—¥å®æ–½çš„ä¸­å›½è¾“ç¾å•†å“åŠ å¾å…³ç¨æªæ–½åšå‡ºè°ƒæ•´ï¼Œä¸­æ–¹æ”¯æŒç›¸å…³ä¼ä¸šä»å³æ—¥èµ·æŒ‰ç…§å¸‚åœºåŒ–åŸåˆ™å’Œ<span class="hljs-symbol">WTO</span>è§„åˆ™ï¼Œè‡ªç¾é‡‡è´­ä¸€å®šæ•°é‡å¤§è±†ã€çŒªè‚‰ç­‰å†œäº§å“ï¼Œå›½åŠ¡é™¢å…³ç¨ç¨åˆ™å§”å‘˜ä¼šå°†å¯¹ä¸Šè¿°é‡‡è´­äºˆä»¥åŠ å¾å…³ç¨æ’é™¤ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;æ—¥å‰&#x27;</span>, <span class="hljs-string">&#x27;10æœˆ1æ—¥&#x27;</span>]<br>åŸæ–‡ï¼šæ®å°åº¦<span class="hljs-symbol">Zee</span>æ–°é—»ç½‘ç«™<span class="hljs-number">12</span>æ—¥æŠ¥é“ï¼Œäºšæ´²æ–°é—»å›½é™…é€šè®¯ç¤¾æ´å¼•å°åº¦å†›æ–¹æ¶ˆæ¯äººå£«çš„è¯è¯´ï¼Œ<span class="hljs-number">9</span>æœˆ<span class="hljs-number">11</span>æ—¥çš„å¯¹å³™äº‹ä»¶å‘ç”Ÿåœ¨é è¿‘ç­å…¬é”™åŒ—å²¸çš„å®é™…æ§åˆ¶çº¿ä¸€å¸¦ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;12æ—¥&#x27;</span>, <span class="hljs-string">&#x27;9æœˆ11æ—¥&#x27;</span>]<br>åŸæ–‡ï¼šå„‹å·å¸‚å†³å®šï¼Œä»<span class="hljs-number">9</span>æœˆå¼€å§‹ï¼Œå¯¹åŸå¸‚ä½ä¿ã€å†œæ‘ä½ä¿ã€ç‰¹å›°ä¾›å…»äººå‘˜ã€ä¼˜æŠšå¯¹è±¡ã€é¢†å–å¤±ä¸šä¿é™©é‡‘äººå‘˜ã€å»ºæ¡£ç«‹å¡æœªè„±è´«äººå£ç­‰ä½æ”¶å…¥ç¾¤ä½“å…±<span class="hljs-number">3</span>ä¸‡å¤šäººï¼Œå‘æ”¾çŒªè‚‰ä»·æ ¼è¡¥è´´ï¼Œæ¯äººæ¯æœˆå‘æ”¾ä¸ä½äº<span class="hljs-number">100</span>å…ƒè¡¥è´´ï¼Œä»¥åå‘æ”¾æ ‡å‡†ï¼Œå°†æ ¹æ®çŒªè‚‰ä»·æ³¢åŠ¨æƒ…å†µè¿›è¡ŒåŠ¨æ€è°ƒæ•´ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;9æœˆ&#x27;</span>]<br>åŸæ–‡ï¼š<span class="hljs-number">9</span>æœˆ<span class="hljs-number">11</span>æ—¥ï¼Œåä¸ºå¿ƒå£°ç¤¾åŒºå‘å¸ƒç¾å›½ç»æµå­¦å®¶æ‰˜é©¬æ–¯.å¼—é‡Œå¾·æ›¼åœ¨ã€Šçº½çº¦æ—¶æŠ¥ã€‹ä¸Šçš„ä¸“æ å†…å®¹ï¼Œå¼—é‡Œå¾·æ›¼é€éœ²ï¼Œåœ¨ä¸åä¸ºåˆ›å§‹äººä»»æ­£éæœ€è¿‘ä¸€æ¬¡é‡‡è®¿ä¸­ï¼Œä»»æ­£éè¡¨ç¤ºåä¸ºæ„¿æ„ä¸ç¾å›½å¸æ³•éƒ¨å±•å¼€è¯é¢˜ä¸è®¾é™çš„è®¨è®ºã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;9æœˆ11æ—¥&#x27;</span>]<br>åŸæ–‡ï¼šé€ è¡€å¹²ç»†èƒç§»æ¤æ²»ç–—ç™½è¡€ç—…æŠ€æœ¯å·²æ—¥ç›Šæˆç†Ÿï¼Œç„¶è€Œï¼Œé€šè¿‡è¯¥æ–¹æ³•åŒæ—¶æ²»æ„ˆè‰¾æ»‹ç—…ç›®å‰è¿˜æ˜¯ä¸€é“å…¨çƒå°šåœ¨æ”»å…‹çš„éš¾é¢˜ã€‚<br>æŠ½å–ç»“æœï¼š[]<br>åŸæ–‡ï¼šè‹±å›½èˆªç©ºäº‹æ•…è°ƒæŸ¥å±€ï¼ˆ<span class="hljs-symbol">AAIB</span>ï¼‰è¿‘æ—¥æŠ«éœ²ï¼Œä»Šå¹´<span class="hljs-number">2</span>æœˆ<span class="hljs-number">6</span>æ—¥ä¸€è¶Ÿç”±å¾·å›½æ³•å…°å…‹ç¦é£å¾€å¢¨è¥¿å“¥åæ˜†çš„èˆªç­ä¸Šï¼Œå› é£è¡Œå‘˜æ‰“ç¿»å’–å•¡ä½¿æ“ä½œé¢æ¿å†’çƒŸï¼Œå¯¼è‡´é£æœºæŠ˜è¿”è¿«é™çˆ±å°”å…°ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;è¿‘æ—¥&#x27;</span>, <span class="hljs-string">&#x27;ä»Šå¹´2æœˆ6æ—¥&#x27;</span>]<br>åŸæ–‡ï¼šå½“åœ°æ—¶é—´å‘¨å››ï¼ˆ<span class="hljs-number">9</span>æœˆ<span class="hljs-number">12</span>æ—¥ï¼‰ï¼Œå°åº¦å°¼è¥¿äºšè´¢æ”¿éƒ¨é•¿è‹±å“åï¼ˆ<span class="hljs-symbol">Sri</span> <span class="hljs-symbol">Mulyani</span> <span class="hljs-symbol">Indrawati</span>ï¼‰æ˜ç¡®è¡¨ç¤ºï¼šç‰¹æœ—æ™®çš„æ¨ç‰¹æ˜¯é£é™©ä¹‹ä¸€ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;å½“åœ°æ—¶é—´å‘¨å››ï¼ˆ9æœˆ12æ—¥ï¼‰&#x27;</span>]<br>åŸæ–‡ï¼šåä¸­ç§‘æŠ€å¤§å­¦<span class="hljs-number">9</span>æœˆ<span class="hljs-number">12</span>æ—¥é€šè¿‡å…¶å®˜æ–¹ç½‘ç«™å‘å¸ƒé€šæŠ¥ç§°ï¼Œ<span class="hljs-number">9</span>æœˆ<span class="hljs-number">2</span>æ—¥ï¼Œæˆ‘æ ¡ä¸€ç¡•å£«ç ”ç©¶ç”Ÿä¸å¹¸å æ¥¼èº«äº¡ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;9æœˆ12æ—¥&#x27;</span>, <span class="hljs-string">&#x27;9æœˆ2æ—¥&#x27;</span>]<br>åŸæ–‡ï¼šå¾®åšç”¨æˆ·@ooooviki <span class="hljs-number">9</span>æœˆ<span class="hljs-number">12</span>æ—¥ä¸‹åˆå…¬å¸ƒå‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šçš„æƒŠæ‚šé­é‡ï¼šä¸€ä¸ªè‡ªç§°ç½‘è­¦ã€åå«éƒ‘æ´‹çš„äººåˆ©ç”¨èŒåŠ¡ä¹‹ä¾¿ï¼ŒæŸ¥åˆ°å¥¹çš„å®Œå¤‡çš„ä¸ªäººä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºèº«ä»½è¯å·ã€å®¶åº­åœ°å€ã€ç”µè¯å·ç ã€æˆ·ç±å˜åŠ¨æƒ…å†µç­‰ï¼Œè¦æ±‚å¥¹åšä»–å¥³æœ‹å‹ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;9æœˆ12æ—¥ä¸‹åˆ&#x27;</span>]<br>åŸæ–‡ï¼šä»Šå¤©ï¼Œè´µé˜³å–æ¶ˆäº†æ±½è½¦é™è´­ï¼Œæˆä¸ºç›®å‰å…¨å›½å®è¡Œé™è´­æ”¿ç­–çš„<span class="hljs-number">9</span>ä¸ªçœå¸‚ä¸­ï¼Œé¦–ä¸ªå–æ¶ˆé™è´­çš„åŸå¸‚ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;ä»Šå¤©&#x27;</span>, <span class="hljs-string">&#x27;ç›®å‰&#x27;</span>]<br>åŸæ–‡ï¼šæ®æ‚‰ï¼Œä¸å…¨çƒåŒæ­¥ï¼Œä¸­å›½åŒºæ­¤æ¬¡å°†äº<span class="hljs-number">9</span>æœˆ<span class="hljs-number">13</span>æ—¥äºiPhoneå®˜æ–¹æ¸ é“å’Œäº¬ä¸œæ­£å¼å¼€å¯é¢„å”®ï¼Œäº¬ä¸œæˆ<span class="hljs-symbol">Apple</span>ä¸­å›½åŒºå”¯ä¸€å®˜æ–¹æˆæƒé¢„å”®æ¸ é“ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;9æœˆ13æ—¥&#x27;</span>]<br>åŸæ–‡ï¼šæ ¹æ®å¤®è¡Œå…¬å¸ƒçš„æ•°æ®ï¼Œæˆªè‡³<span class="hljs-number">2019</span>å¹´<span class="hljs-number">6</span>æœˆæœ«ï¼Œå­˜æ¬¾ç±»é‡‘èæœºæ„ä½æˆ·éƒ¨é—¨çŸ­æœŸæ¶ˆè´¹è´·æ¬¾è§„æ¨¡ä¸º<span class="hljs-number">9.11</span>ä¸‡äº¿å…ƒï¼Œ<span class="hljs-number">2019</span>å¹´ä¸ŠåŠå¹´è¯¥é¡¹å‡€å¢<span class="hljs-number">3293.19</span>äº¿å…ƒï¼Œä¸ŠåŠå¹´å¢é‡çœ‹èµ·æ¥å¹¶ä¸ä¹è§‚ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;2019å¹´6æœˆæœ«&#x27;</span>, <span class="hljs-string">&#x27;2019å¹´ä¸ŠåŠå¹´&#x27;</span>, <span class="hljs-string">&#x27;ä¸ŠåŠå¹´&#x27;</span>]<br>åŸæ–‡ï¼š<span class="hljs-number">9</span>æœˆ<span class="hljs-number">11</span>æ—¥ï¼Œä¸€æ®µæ‹æ‘„æµ™æ±Ÿä¸‡é‡Œå­¦é™¢å­¦ç”Ÿé£Ÿå ‚çš„è§†é¢‘èµ°çº¢ç½‘ç»œï¼Œè§†é¢‘æ˜¾ç¤ºè¯¥å­¦æ ¡é£Ÿå ‚ä¸ä»…åœ¨ç”¨é¤åŒºåŸŸè®¾ç½®äº†å¯ä»¥çœ‹ç”µå½±ã€æ¯”èµ›çš„å¤§å±å¹•ï¼Œè¿˜æ¨å‡ºäº†â€œä¸€äººé£Ÿâ€é¤ä½ã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;9æœˆ11æ—¥&#x27;</span>]<br>åŸæ–‡ï¼šå½“æ—¥ï¼Œåœ¨åŒ—äº¬ä¸¾è¡Œçš„<span class="hljs-number">2019</span>å¹´å›½é™…ç¯®è”ç¯®çƒä¸–ç•Œæ¯åŠå†³èµ›ä¸­ï¼Œè¥¿ç­ç‰™é˜Ÿå¯¹é˜µæ¾³å¤§åˆ©äºšé˜Ÿã€‚<br>æŠ½å–ç»“æœï¼š[<span class="hljs-string">&#x27;å½“æ—¥&#x27;</span>, <span class="hljs-string">&#x27;2019å¹´&#x27;</span>]<br>ä¸€å…±è€—æ—¶ï¼š<span class="hljs-number">0.5314</span>s.<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæµ‹è¯•çš„14ä¸ªå¥å­ï¼Œè¯†åˆ«çš„å‡†ç¡®ç‡å¾ˆé«˜ï¼Œä¸”é¢„æµ‹è€—æ—¶ä¸º531msï¼Œå¹³å‡æ¯ä¸ªè¯çš„é¢„æµ‹æ—¶é—´ä¸è¶…è¿‡40msã€‚ç›¸æ¯”è¾ƒè€Œè¨€ï¼Œæ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89%E5%88%A9%E7%94%A8tensorflow-serving%E9%83%A8%E7%BD%B2kashgari%E6%A8%A1%E5%9E%8B/">NLPï¼ˆåä¸ƒï¼‰åˆ©ç”¨tensorflow-servingéƒ¨ç½²kashgariæ¨¡å‹</a>ä¸­çš„æ¨¡å‹ï¼Œè¯¥æ¨¡å‹çš„é¢„æµ‹æ—¶é—´ä¸ºæ¯å¥è¯1ç§’å¤šï¼Œæ¨¡å‹é¢„æµ‹çš„é€Ÿåº¦ä¸ºå¸¦ALBERTæ¨¡å‹çš„25å€å¤šã€‚</p><p>å› æ­¤ï¼ŒALBERTæ¨¡å‹ç¡®å®æå‡äº†æ¨¡å‹é¢„æµ‹çš„æ—¶é—´ï¼Œè€Œä¸”æ•ˆæœéå¸¸æ˜¾è‘—ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>ç”±äºALBERTå¼€æºä¸åˆ°ä¸€å‘¨ï¼Œè€Œä¸”ç¬”è€…çš„å­¦è¯†ã€æ‰èƒ½æœ‰é™ï¼Œå› æ­¤ï¼Œåœ¨ä»£ç æ–¹é¢å¯èƒ½ä¼šå­˜åœ¨ä¸è¶³ã€‚ä½†æ˜¯ï¼Œä½œä¸ºä¸€æ¬¡ä½¿ç”¨ALBERTçš„å†ç»ï¼Œå¸Œæœ›èƒ½å¤Ÿä¸å¤§å®¶åˆ†äº«ã€‚</p><p>æœ¬æ–‡ç»ä¸æ˜¯ä¸Šè¿°é¡¹ç›®ä»£ç çš„æŠ„è¢­å’Œå †ç Œï¼Œè¯¥é¡¹ç›®èå…¥äº†ç¬”è€…è‡ªå·±çš„æ€è€ƒï¼Œå¸Œæœ›ä¸è¦è¢«è¯¯è§£ä¸ºæ˜¯æŠ„è¢­ã€‚ç¬”è€…ä½¿ç”¨ä¸Šè¿°çš„bertNERå’ŒALBERTï¼Œåªæ˜¯ä¸ºäº†éªŒè¯ALBERTåœ¨æ¨¡å‹é¢„æµ‹è€—æ—¶æ–¹é¢çš„æé€Ÿæ•ˆæœï¼Œè€Œäº‹å®æ˜¯ï¼ŒALBERTç¡®å®ç»™æˆ‘å¸¦æ¥äº†å¾ˆå¤§æƒŠå–œï¼Œæ„Ÿå—æºä»£ç ä½œè€…ä»¬ï½</p><p>æœ€åï¼Œé™„ä¸Šæœ¬æ–‡ä¸­ç¬”è€…é¡¹ç›®çš„Githubåœ°å€ï¼š<ahref="https://github.com/percent4/ALBERT_4_Time_Recognition">https://github.com/percent4/ALBERT_4_Time_Recognition</a>ã€‚</p><p>ä¼—é‡Œå¯»ä»–åƒç™¾åº¦ã€‚è“¦ç„¶å›é¦–ï¼Œé‚£äººå´åœ¨ï¼Œç¯ç«é˜‘çŠå¤„ã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>è¶…å°å‹BERTä¸­æ–‡ç‰ˆæ¨ªç©ºå‡ºä¸–ï¼æ¨¡å‹åªæœ‰16Mï¼Œè®­ç»ƒé€Ÿåº¦æå‡10å€ï¼šhttps://mp.weixin.qq.com/s/eVlNpejrxdE4ctDTBM-fiA</li><li>ALBERTçš„Githubåœ°å€ï¼šhttps://github.com/brightmart/albert_zh</li><li>bertNERé¡¹ç›®çš„Githubåœ°å€ï¼šhttps://github.com/yumath/bertNER</li><li>NLPï¼ˆåä¸ƒï¼‰åˆ©ç”¨tensorflow-servingéƒ¨ç½²kashgariæ¨¡å‹ï¼šhttps://www.cnblogs.com/jclian91/p/11526547.html</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>ALBERT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆåä¸ƒï¼‰åˆ©ç”¨tensorflow-servingéƒ¨ç½²kashgariæ¨¡å‹</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89%E5%88%A9%E7%94%A8tensorflow-serving%E9%83%A8%E7%BD%B2kashgari%E6%A8%A1%E5%9E%8B/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89%E5%88%A9%E7%94%A8tensorflow-serving%E9%83%A8%E7%BD%B2kashgari%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%BA%94%EF%BC%89%E8%AE%A9%E6%A8%A1%E5%9E%8B%E6%9D%A5%E5%91%8A%E8%AF%89%E4%BD%A0%E6%96%87%E6%9C%AC%E4%B8%AD%E7%9A%84%E6%97%B6%E9%97%B4/">NLPï¼ˆåäº”ï¼‰è®©æ¨¡å‹æ¥å‘Šè¯‰ä½ æ–‡æœ¬ä¸­çš„æ—¶é—´</a>ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•åˆ©ç”¨kashgariæ¨¡å—æ¥å®Œæˆåºåˆ—æ ‡æ³¨æ¨¡å‹çš„è®­ç»ƒä¸é¢„æµ‹ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šäº†è§£å¦‚ä½•tensorflow-servingæ¥éƒ¨ç½²æ¨¡å‹ã€‚</p><p>åœ¨kashgariçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå·²ç»æœ‰å¦‚ä½•åˆ©ç”¨tensorflow-servingæ¥éƒ¨ç½²æ¨¡å‹çš„è¯´æ˜äº†ï¼Œç½‘å€ä¸ºï¼š<ahref="https://kashgari.bmio.net/advance-use/tensorflow-serving/">https://kashgari.bmio.net/advance-use/tensorflow-serving/</a>ã€‚</p><p>ä¸‹é¢ï¼Œæœ¬æ–‡å°†ä»‹ç»tensorflow-servingä»¥åŠå¦‚ä½•åˆ©ç”¨tensorflow-servingæ¥éƒ¨ç½²kashgariçš„æ¨¡å‹ã€‚</p><h3 id="tensorflow-serving">tensorflow-serving</h3><p>TensorFlow Serving æ˜¯ä¸€ä¸ªç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹ servingçš„é«˜æ€§èƒ½å¼€æºåº“ã€‚å®ƒå¯ä»¥å°†è®­ç»ƒå¥½çš„æœºå™¨å­¦ä¹ æ¨¡å‹éƒ¨ç½²åˆ°çº¿ä¸Šï¼Œä½¿ç”¨ gRPCä½œä¸ºæ¥å£æ¥å—å¤–éƒ¨è°ƒç”¨ã€‚æ›´åŠ è®©äººçœ¼å‰ä¸€äº®çš„æ˜¯ï¼Œå®ƒæ”¯æŒæ¨¡å‹çƒ­æ›´æ–°ä¸è‡ªåŠ¨æ¨¡å‹ç‰ˆæœ¬ç®¡ç†ã€‚è¿™æ„å‘³ç€ä¸€æ—¦éƒ¨ç½²TensorFlow Servingåï¼Œä½ å†ä¹Ÿä¸éœ€è¦ä¸ºçº¿ä¸ŠæœåŠ¡æ“å¿ƒï¼Œåªéœ€è¦å…³å¿ƒä½ çš„çº¿ä¸‹æ¨¡å‹è®­ç»ƒã€‚</p><p>TensorFlowServingå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬éƒ¨ç½²TensorFlowæ¨¡å‹ï¼Œæœ¬æ–‡å°†ä½¿ç”¨TensorFlowServingçš„Dockeré•œåƒæ¥ä½¿ç”¨TensorFlow Servingï¼Œå®‰è£…çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull tensorflow/serving<br></code></pre></td></tr></table></figure><h3 id="å·¥ç¨‹å®è·µ">å·¥ç¨‹å®è·µ</h3><p>æœ¬é¡¹ç›®å°†æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨tensorflow/servingæ¥éƒ¨ç½²kashgariä¸­çš„æ¨¡å‹ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp17_1.png" /></p><p>æœ¬é¡¹ç›®çš„dataæ¥è‡ªä¹‹å‰ç¬”è€…æ ‡æ³¨çš„æ—¶é—´æ•°æ®é›†ï¼Œå³æ ‡æ³¨å‡ºæ–‡æœ¬ä¸­çš„æ—¶é—´ï¼Œé‡‡ç”¨BIOæ ‡æ³¨ç³»ç»Ÿã€‚chinese_wwm_extæ–‡ä»¶å¤¹ä¸ºå“ˆå·¥å¤§çš„é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶ã€‚</p><p>model_train.pyä¸ºæ¨¡å‹è®­ç»ƒçš„ä»£ç ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®Œæˆæ—¶é—´åºåˆ—æ ‡æ³¨æ¨¡å‹çš„è®­ç»ƒï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># time: 2019-09-12</span><br><span class="hljs-comment"># place: Huangcun Beijing</span><br><br><span class="hljs-keyword">import</span> kashgari<br><span class="hljs-keyword">from</span> kashgari <span class="hljs-keyword">import</span> utils<br><span class="hljs-keyword">from</span> kashgari.corpus <span class="hljs-keyword">import</span> DataReader<br><span class="hljs-keyword">from</span> kashgari.embeddings <span class="hljs-keyword">import</span> BERTEmbedding<br><span class="hljs-keyword">from</span> kashgari.tasks.labeling <span class="hljs-keyword">import</span> BiLSTM_CRF_Model<br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br><br>train_x, train_y = DataReader().read_conll_format_file(<span class="hljs-string">&#x27;./data/time.train&#x27;</span>)<br>valid_x, valid_y = DataReader().read_conll_format_file(<span class="hljs-string">&#x27;./data/time.dev&#x27;</span>)<br>test_x, test_y = DataReader().read_conll_format_file(<span class="hljs-string">&#x27;./data/time.test&#x27;</span>)<br><br>bert_embedding = BERTEmbedding(<span class="hljs-string">&#x27;chinese_wwm_ext_L-12_H-768_A-12&#x27;</span>,<br>                               task=kashgari.LABELING,<br>                               sequence_length=<span class="hljs-number">128</span>)<br><br>model = BiLSTM_CRF_Model(bert_embedding)<br><br>model.fit(train_x, train_y, valid_x, valid_y, batch_size=<span class="hljs-number">16</span>, epochs=<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># Save model</span><br>utils.convert_to_saved_model(model,<br>                             model_path=<span class="hljs-string">&#x27;saved_model/time_entity&#x27;</span>,<br>                             version=<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œè¯¥ä»£ç ï¼Œæ¨¡å‹è®­ç»ƒå®Œåä¼šç”Ÿæˆsaved_modelæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å«æœ‰æ¨¡å‹è®­ç»ƒå¥½åçš„æ–‡ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬åˆ©ç”¨tensorflow/servingè¿›è¡Œéƒ¨ç½²ã€‚æ¥ç€æˆ‘ä»¬åˆ©ç”¨tensorflow/servingæ¥å®Œæˆæ¨¡å‹çš„éƒ¨ç½²ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -t --rm -p 8501:8501 -v <span class="hljs-string">&quot;/Users/jclian/PycharmProjects/kashgari_tf_serving/saved_model:/models/&quot;</span> -e <span class="hljs-attribute">MODEL_NAME</span>=time_entity tensorflow/serving<br></code></pre></td></tr></table></figure><p>å…¶ä¸­éœ€è¦æ³¨æ„è¯¥æ¨¡å‹æ‰€åœ¨çš„è·¯å¾„ï¼Œè·¯å¾„éœ€è¦å†™å®Œæ•´è·¯å¾„ï¼Œä»¥åŠæ¨¡å‹çš„åç§°ï¼ˆMODEL_NAMEï¼‰ï¼Œè¿™åœ¨è®­ç»ƒä»£ç ï¼ˆtrain.pyï¼‰ä¸­å·²ç»ç»™å‡ºï¼ˆsaved_model/time_entityï¼‰ã€‚</p><p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨tornadoæ¥æ­å»ºHTTPæœåŠ¡ï¼Œå¸®åŠ©æˆ‘ä»¬æ–¹ä¾¿åœ°è¿›è¡Œæ¨¡å‹é¢„æµ‹ï¼ŒrunServer.pyçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> kashgari <span class="hljs-keyword">import</span> utils<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> model_predict <span class="hljs-keyword">import</span> get_predict<br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> tornado.httpserver<br><span class="hljs-keyword">import</span> tornado.ioloop<br><span class="hljs-keyword">import</span> tornado.options<br><span class="hljs-keyword">import</span> tornado.web<br><span class="hljs-keyword">from</span> tornado.options <span class="hljs-keyword">import</span> define, options<br><span class="hljs-keyword">import</span> traceback<br><br><span class="hljs-comment"># tornadoé«˜å¹¶å‘</span><br><span class="hljs-keyword">import</span> tornado.web<br><span class="hljs-keyword">import</span> tornado.gen<br><span class="hljs-keyword">import</span> tornado.concurrent<br><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><br><span class="hljs-comment"># å®šä¹‰ç«¯å£ä¸º12333</span><br>define(<span class="hljs-string">&quot;port&quot;</span>, default=<span class="hljs-number">16016</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;run on the given port&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>)<br><br><span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelPredictHandler</span>(tornado.web.RequestHandler):<br>    executor = ThreadPoolExecutor(max_workers=<span class="hljs-number">5</span>)<br><br>    <span class="hljs-comment"># get å‡½æ•°</span><br><span class="hljs-meta">    @tornado.gen.coroutine</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>):<br>        origin_text = self.get_argument(<span class="hljs-string">&#x27;text&#x27;</span>)<br>        result = <span class="hljs-keyword">yield</span> self.function(origin_text)<br>        self.write(json.dumps(result, ensure_ascii=<span class="hljs-literal">False</span>))<br><br><span class="hljs-meta">    @tornado.concurrent.run_on_executor</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">function</span>(<span class="hljs-params">self, text</span>):<br>        <span class="hljs-keyword">try</span>:<br>            text = text.replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            x = [_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> text]<br><br>            <span class="hljs-comment"># Pre-processor data</span><br>            processor = utils.load_processor(model_path=<span class="hljs-string">&#x27;saved_model/time_entity/1&#x27;</span>)<br>            tensor = processor.process_x_dataset([x])<br><br>            <span class="hljs-comment"># only for bert Embedding</span><br>            tensor = [&#123;<br>                <span class="hljs-string">&quot;Input-Token:0&quot;</span>: i.tolist(),<br>                <span class="hljs-string">&quot;Input-Segment:0&quot;</span>: np.zeros(i.shape).tolist()<br>            &#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tensor]<br><br>            <span class="hljs-comment"># predict</span><br>            r = requests.post(<span class="hljs-string">&quot;http://localhost:8501/v1/models/time_entity:predict&quot;</span>, json=&#123;<span class="hljs-string">&quot;instances&quot;</span>: tensor&#125;)<br>            preds = r.json()[<span class="hljs-string">&#x27;predictions&#x27;</span>]<br><br>            <span class="hljs-comment"># Convert result back to labels</span><br>            labels = processor.reverse_numerize_label_sequences(np.array(preds).argmax(-<span class="hljs-number">1</span>))<br><br>            entities = get_predict(<span class="hljs-string">&#x27;TIME&#x27;</span>, text, labels[<span class="hljs-number">0</span>])<br><br>            <span class="hljs-keyword">return</span> entities<br><br>        <span class="hljs-keyword">except</span> Exception:<br>            self.write(traceback.format_exc().replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>))<br><br><br><span class="hljs-comment"># getè¯·æ±‚</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloHandler</span>(tornado.web.RequestHandler):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>):<br>        self.write(<span class="hljs-string">&#x27;Hello from lmj from Daxing Beijing!&#x27;</span>)<br><br><br><span class="hljs-comment"># ä¸»å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># å¼€å¯tornadoæœåŠ¡</span><br>    tornado.options.parse_command_line()<br>    <span class="hljs-comment"># å®šä¹‰app</span><br>    app = tornado.web.Application(<br>            handlers=[(<span class="hljs-string">r&#x27;/model_predict&#x27;</span>, ModelPredictHandler),<br>                      (<span class="hljs-string">r&#x27;/hello&#x27;</span>, HelloHandler),<br>                      ], <span class="hljs-comment">#ç½‘é¡µè·¯å¾„æ§åˆ¶</span><br>          )<br>    http_server = tornado.httpserver.HTTPServer(app)<br>    http_server.listen(options.port)<br>    tornado.ioloop.IOLoop.instance().start()<br><br>main()<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å®šä¹‰äº†tornadoå°è£…HTTPæœåŠ¡æ¥è¿›è¡Œæ¨¡å‹é¢„æµ‹ï¼Œè¿è¡Œè¯¥è„šæœ¬ï¼Œå¯åŠ¨æ¨¡å‹é¢„æµ‹çš„HTTPæœåŠ¡ã€‚æ¥ç€æˆ‘ä»¬å†ä½¿ç”¨Pythonè„šæœ¬æ‰æµ‹è¯•ä¸‹æ¨¡å‹çš„é¢„æµ‹æ•ˆæœä»¥åŠé¢„æµ‹æ—¶é—´ï¼Œé¢„æµ‹çš„ä»£ç è„šæœ¬çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> requests<br><br>t1 = time.time()<br>texts = [<span class="hljs-string">&#x27;è®°è€…ä»å›½å®¶å‘å±•æ”¹é©å§”ã€å•†åŠ¡éƒ¨ç›¸å…³æ–¹é¢è·æ‚‰ï¼Œæ—¥å‰ç¾æ–¹å·²å†³å®šå¯¹æ‹Ÿäº10æœˆ1æ—¥å®æ–½çš„ä¸­å›½è¾“ç¾å•†å“åŠ å¾å…³ç¨æªæ–½åšå‡ºè°ƒæ•´ï¼Œä¸­æ–¹æ”¯æŒç›¸å…³ä¼ä¸šä»å³æ—¥èµ·æŒ‰ç…§å¸‚åœºåŒ–åŸåˆ™å’ŒWTOè§„åˆ™ï¼Œè‡ªç¾é‡‡è´­ä¸€å®šæ•°é‡å¤§è±†ã€çŒªè‚‰ç­‰å†œäº§å“ï¼Œå›½åŠ¡é™¢å…³ç¨ç¨åˆ™å§”å‘˜ä¼šå°†å¯¹ä¸Šè¿°é‡‡è´­äºˆä»¥åŠ å¾å…³ç¨æ’é™¤ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®å°åº¦Zeeæ–°é—»ç½‘ç«™12æ—¥æŠ¥é“ï¼Œäºšæ´²æ–°é—»å›½é™…é€šè®¯ç¤¾æ´å¼•å°åº¦å†›æ–¹æ¶ˆæ¯äººå£«çš„è¯è¯´ï¼Œ9æœˆ11æ—¥çš„å¯¹å³™äº‹ä»¶å‘ç”Ÿåœ¨é è¿‘ç­å…¬é”™åŒ—å²¸çš„å®é™…æ§åˆ¶çº¿ä¸€å¸¦ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å„‹å·å¸‚å†³å®šï¼Œä»9æœˆå¼€å§‹ï¼Œå¯¹åŸå¸‚ä½ä¿ã€å†œæ‘ä½ä¿ã€ç‰¹å›°ä¾›å…»äººå‘˜ã€ä¼˜æŠšå¯¹è±¡ã€é¢†å–å¤±ä¸šä¿é™©é‡‘äººå‘˜ã€å»ºæ¡£ç«‹å¡æœªè„±è´«äººå£ç­‰ä½æ”¶å…¥ç¾¤ä½“å…±3ä¸‡å¤šäººï¼Œå‘æ”¾çŒªè‚‰ä»·æ ¼è¡¥è´´ï¼Œæ¯äººæ¯æœˆå‘æ”¾ä¸ä½äº100å…ƒè¡¥è´´ï¼Œä»¥åå‘æ”¾æ ‡å‡†ï¼Œå°†æ ¹æ®çŒªè‚‰ä»·æ³¢åŠ¨æƒ…å†µè¿›è¡ŒåŠ¨æ€è°ƒæ•´ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;9æœˆ11æ—¥ï¼Œåä¸ºå¿ƒå£°ç¤¾åŒºå‘å¸ƒç¾å›½ç»æµå­¦å®¶æ‰˜é©¬æ–¯.å¼—é‡Œå¾·æ›¼åœ¨ã€Šçº½çº¦æ—¶æŠ¥ã€‹ä¸Šçš„ä¸“æ å†…å®¹ï¼Œå¼—é‡Œå¾·æ›¼é€éœ²ï¼Œåœ¨ä¸åä¸ºåˆ›å§‹äººä»»æ­£éæœ€è¿‘ä¸€æ¬¡é‡‡è®¿ä¸­ï¼Œä»»æ­£éè¡¨ç¤ºåä¸ºæ„¿æ„ä¸ç¾å›½å¸æ³•éƒ¨å±•å¼€è¯é¢˜ä¸è®¾é™çš„è®¨è®ºã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;é€ è¡€å¹²ç»†èƒç§»æ¤æ²»ç–—ç™½è¡€ç—…æŠ€æœ¯å·²æ—¥ç›Šæˆç†Ÿï¼Œç„¶è€Œï¼Œé€šè¿‡è¯¥æ–¹æ³•åŒæ—¶æ²»æ„ˆè‰¾æ»‹ç—…ç›®å‰è¿˜æ˜¯ä¸€é“å…¨çƒå°šåœ¨æ”»å…‹çš„éš¾é¢˜ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;è‹±å›½èˆªç©ºäº‹æ•…è°ƒæŸ¥å±€ï¼ˆAAIBï¼‰è¿‘æ—¥æŠ«éœ²ï¼Œä»Šå¹´2æœˆ6æ—¥ä¸€è¶Ÿç”±å¾·å›½æ³•å…°å…‹ç¦é£å¾€å¢¨è¥¿å“¥åæ˜†çš„èˆªç­ä¸Šï¼Œå› é£è¡Œå‘˜æ‰“ç¿»å’–å•¡ä½¿æ“ä½œé¢æ¿å†’çƒŸï¼Œå¯¼è‡´é£æœºæŠ˜è¿”è¿«é™çˆ±å°”å…°ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å½“åœ°æ—¶é—´å‘¨å››ï¼ˆ9æœˆ12æ—¥ï¼‰ï¼Œå°åº¦å°¼è¥¿äºšè´¢æ”¿éƒ¨é•¿è‹±å“åï¼ˆSri Mulyani Indrawatiï¼‰æ˜ç¡®è¡¨ç¤ºï¼šç‰¹æœ—æ™®çš„æ¨ç‰¹æ˜¯é£é™©ä¹‹ä¸€ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;åä¸­ç§‘æŠ€å¤§å­¦9æœˆ12æ—¥é€šè¿‡å…¶å®˜æ–¹ç½‘ç«™å‘å¸ƒé€šæŠ¥ç§°ï¼Œ9æœˆ2æ—¥ï¼Œæˆ‘æ ¡ä¸€ç¡•å£«ç ”ç©¶ç”Ÿä¸å¹¸å æ¥¼èº«äº¡ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å¾®åšç”¨æˆ·@ooooviki 9æœˆ12æ—¥ä¸‹åˆå…¬å¸ƒå‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šçš„æƒŠæ‚šé­é‡ï¼šä¸€ä¸ªè‡ªç§°ç½‘è­¦ã€åå«éƒ‘æ´‹çš„äººåˆ©ç”¨èŒåŠ¡ä¹‹ä¾¿ï¼ŒæŸ¥åˆ°å¥¹çš„å®Œå¤‡çš„ä¸ªäººä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºèº«ä»½è¯å·ã€å®¶åº­åœ°å€ã€ç”µè¯å·ç ã€æˆ·ç±å˜åŠ¨æƒ…å†µç­‰ï¼Œè¦æ±‚å¥¹åšä»–å¥³æœ‹å‹ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;ä»Šå¤©ï¼Œè´µé˜³å–æ¶ˆäº†æ±½è½¦é™è´­ï¼Œæˆä¸ºç›®å‰å…¨å›½å®è¡Œé™è´­æ”¿ç­–çš„9ä¸ªçœå¸‚ä¸­ï¼Œé¦–ä¸ªå–æ¶ˆé™è´­çš„åŸå¸‚ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ®æ‚‰ï¼Œä¸å…¨çƒåŒæ­¥ï¼Œä¸­å›½åŒºæ­¤æ¬¡å°†äº9æœˆ13æ—¥äºiPhoneå®˜æ–¹æ¸ é“å’Œäº¬ä¸œæ­£å¼å¼€å¯é¢„å”®ï¼Œäº¬ä¸œæˆAppleä¸­å›½åŒºå”¯ä¸€å®˜æ–¹æˆæƒé¢„å”®æ¸ é“ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;æ ¹æ®å¤®è¡Œå…¬å¸ƒçš„æ•°æ®ï¼Œæˆªè‡³2019å¹´6æœˆæœ«ï¼Œå­˜æ¬¾ç±»é‡‘èæœºæ„ä½æˆ·éƒ¨é—¨çŸ­æœŸæ¶ˆè´¹è´·æ¬¾è§„æ¨¡ä¸º9.11ä¸‡äº¿å…ƒï¼Œ2019å¹´ä¸ŠåŠå¹´è¯¥é¡¹å‡€å¢3293.19äº¿å…ƒï¼Œä¸ŠåŠå¹´å¢é‡çœ‹èµ·æ¥å¹¶ä¸ä¹è§‚ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;9æœˆ11æ—¥ï¼Œä¸€æ®µæ‹æ‘„æµ™æ±Ÿä¸‡é‡Œå­¦é™¢å­¦ç”Ÿé£Ÿå ‚çš„è§†é¢‘èµ°çº¢ç½‘ç»œï¼Œè§†é¢‘æ˜¾ç¤ºè¯¥å­¦æ ¡é£Ÿå ‚ä¸ä»…åœ¨ç”¨é¤åŒºåŸŸè®¾ç½®äº†å¯ä»¥çœ‹ç”µå½±ã€æ¯”èµ›çš„å¤§å±å¹•ï¼Œè¿˜æ¨å‡ºäº†â€œä¸€äººé£Ÿâ€é¤ä½ã€‚&#x27;</span>,<br>         <span class="hljs-string">&#x27;å½“æ—¥ï¼Œåœ¨åŒ—äº¬ä¸¾è¡Œçš„2019å¹´å›½é™…ç¯®è”ç¯®çƒä¸–ç•Œæ¯åŠå†³èµ›ä¸­ï¼Œè¥¿ç­ç‰™é˜Ÿå¯¹é˜µæ¾³å¤§åˆ©äºšé˜Ÿã€‚&#x27;</span>,<br>         ]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(texts))<br><br><span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts:<br>    url = <span class="hljs-string">&#x27;http://localhost:16016/model_predict?text=%s&#x27;</span> % text<br>    req = requests.get(url)<br>    <span class="hljs-built_in">print</span>(json.loads(req.content))<br><br>t2 = time.time()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">round</span>(t2-t1, <span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure><p>è¿è¡Œè¯¥ä»£ç ï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼šï¼ˆé¢„æµ‹æ–‡æœ¬ä¸­çš„æ—¶é—´ï¼‰</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs prolog">ä¸€å…±é¢„æµ‹<span class="hljs-number">14</span>ä¸ªå¥å­ã€‚<br>[<span class="hljs-string">&#x27;æ—¥å‰&#x27;</span>, <span class="hljs-string">&#x27;10æœˆ1æ—¥&#x27;</span>, <span class="hljs-string">&#x27;å³æ—¥&#x27;</span>]<br>[<span class="hljs-string">&#x27;12æ—¥&#x27;</span>, <span class="hljs-string">&#x27;9æœˆ11æ—¥&#x27;</span>]<br>[<span class="hljs-string">&#x27;9æœˆ&#x27;</span>]<br>[<span class="hljs-string">&#x27;9æœˆ11æ—¥&#x27;</span>]<br>[]<br>[<span class="hljs-string">&#x27;è¿‘æ—¥&#x27;</span>, <span class="hljs-string">&#x27;ä»Šå¹´2æœˆ6æ—¥&#x27;</span>]<br>[<span class="hljs-string">&#x27;å½“åœ°æ—¶é—´å‘¨å››ï¼ˆ9æœˆ12æ—¥ï¼‰&#x27;</span>]<br>[<span class="hljs-string">&#x27;9æœˆ12æ—¥&#x27;</span>, <span class="hljs-string">&#x27;9æœˆ2æ—¥&#x27;</span>]<br>[<span class="hljs-string">&#x27;9æœˆ12æ—¥ä¸‹åˆ&#x27;</span>]<br>[<span class="hljs-string">&#x27;ä»Šå¤©&#x27;</span>, <span class="hljs-string">&#x27;ç›®å‰&#x27;</span>]<br>[<span class="hljs-string">&#x27;9æœˆ13æ—¥&#x27;</span>]<br>[<span class="hljs-string">&#x27;2019å¹´6æœˆæœ«&#x27;</span>, <span class="hljs-string">&#x27;2019å¹´ä¸ŠåŠå¹´&#x27;</span>, <span class="hljs-string">&#x27;ä¸ŠåŠå¹´&#x27;</span>]<br>[<span class="hljs-string">&#x27;9æœˆ11æ—¥&#x27;</span>]<br>[<span class="hljs-string">&#x27;å½“æ—¥&#x27;</span>, <span class="hljs-string">&#x27;2019å¹´&#x27;</span>]<br>é¢„æµ‹è€—æ—¶: <span class="hljs-number">15.1085</span>s.<br></code></pre></td></tr></table></figure><p>æ¨¡å‹é¢„æµ‹çš„æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ï¼Œä½†å¹³å‡æ¯å¥è¯çš„é¢„æµ‹æ—¶é—´ä¸º1ç§’å¤šï¼Œæ¨¡å‹é¢„æµ‹æ—¶é—´è¿˜æ˜¯ç¨å¾®åé•¿ï¼Œåç»­ç¬”è€…å°†ä¼šç ”ç©¶å¦‚ä½•ç¼©çŸ­æ¨¡å‹é¢„æµ‹çš„æ—¶é—´ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬é¡¹ç›®ä¸»è¦æ˜¯ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨tensorflow-servingéƒ¨ç½²kashgariæ¨¡å‹ï¼Œè¯¥é¡¹ç›®å·²ç»ä¸Šä¼ è‡³githubï¼Œåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/tensorflow-serving_4_kashgari">https://github.com/percent4/tensorflow-serving_4_kashgari</a>ã€‚</p><p>è‡³äºå¦‚ä½•ç¼©çŸ­æ¨¡å‹é¢„æµ‹çš„æ—¶é—´ï¼Œç¬”è€…è¿˜éœ€è¦å†ç»§ç»­ç ”ç©¶ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ï½</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆåå…­ï¼‰è½»æ¾ä¸Šæ‰‹æ–‡æœ¬åˆ†ç±»</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89%E8%BD%BB%E6%9D%BE%E4%B8%8A%E6%89%8B%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89%E8%BD%BB%E6%9D%BE%E4%B8%8A%E6%89%8B%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h3><p>æ–‡æœ¬åˆ†ç±»æ˜¯NLPä¸­çš„å¸¸è§çš„é‡è¦ä»»åŠ¡ä¹‹ä¸€ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å°†è¾“å…¥çš„æ–‡æœ¬ä»¥åŠæ–‡æœ¬çš„ç±»åˆ«è®­ç»ƒå‡ºä¸€ä¸ªæ¨¡å‹ï¼Œä½¿ä¹‹å…·æœ‰ä¸€å®šçš„æ³›åŒ–èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¯¹æ–°æ–‡æœ¬è¿›è¡Œè¾ƒå¥½åœ°é¢„æµ‹ã€‚å®ƒçš„åº”ç”¨å¾ˆå¹¿æ³›ï¼Œåœ¨å¾ˆå¤šé¢†åŸŸå‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œä¾‹å¦‚åƒåœ¾é‚®ä»¶è¿‡æ»¤ã€èˆ†æƒ…åˆ†æä»¥åŠæ–°é—»åˆ†ç±»ç­‰ã€‚</p><p>ç°é˜¶æ®µçš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹é¢‘å‡ºï¼Œç§ç±»ç¹å¤šï¼ŒèŠ±æ ·ç™¾å˜ï¼Œæ—¢æœ‰æœºå™¨å­¦ä¹ ä¸­çš„æœ´ç´ è´å¶æ–¯æ¨¡å‹ã€SVMç­‰ï¼Œä¹Ÿæœ‰æ·±åº¦å­¦ä¹ ä¸­çš„å„ç§æ¨¡å‹ï¼Œæ¯”å¦‚ç»å…¸çš„CNN,RNNï¼Œä»¥åŠå®ƒä»¬çš„å˜å½¢ï¼Œå¦‚CNN-LSTMï¼Œè¿˜æœ‰å„ç§é«˜å¤§ä¸Šçš„Attentionæ¨¡å‹ã€‚</p><p>æ— ç–‘ï¼Œæ–‡æœ¬åˆ†ç±»æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒæˆç†Ÿçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å°½å¯ä»¥é€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ¨¡å‹æ¥å®Œæˆè¯¥ä»»åŠ¡ã€‚æœ¬æ–‡ä»¥kashgari-tfä¸ºä¾‹ï¼Œå®ƒèƒ½å¤Ÿæ”¯æŒå„ç§æ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œæ¯”å¦‚BiLSTMï¼ŒCNN_LSTMï¼ŒAVCNNç­‰ï¼Œä¸”å¯¹é¢„è®­ç»ƒæ¨¡å‹ï¼Œæ¯”å¦‚BERTçš„æ”¯æŒè¾ƒå¥½ï¼Œå®ƒèƒ½è®©æˆ‘ä»¬è½»æ¾åœ°å®Œæˆæ–‡æœ¬åˆ†ç±»ä»»åŠ¡ã€‚</p><p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬ä¸€èµ·èµ°è¿›æ–‡æœ¬åˆ†ç±»çš„ä¸–ç•Œï¼Œåˆ†åˆ†é’Ÿæå®štextclassificationï¼</p><h3 id="é¡¹ç›®">é¡¹ç›®</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä»½æ•°æ®ä½œä¸ºä¾‹å­ã€‚æˆ‘ä»¬é€‰æ‹©THUCNewsï¼ŒTHUCNewsæ˜¯æ ¹æ®æ–°æµªæ–°é—»RSSè®¢é˜…é¢‘é“2005~2011å¹´é—´çš„å†å²æ•°æ®ç­›é€‰è¿‡æ»¤ç”Ÿæˆï¼ŒåŒ…å«74ä¸‡ç¯‡æ–°é—»æ–‡æ¡£ï¼ˆ2.19GBï¼‰ï¼Œå‡ä¸ºUTF-8çº¯æ–‡æœ¬æ ¼å¼ã€‚æˆ‘ä»¬åœ¨åŸå§‹æ–°æµªæ–°é—»åˆ†ç±»ä½“ç³»çš„åŸºç¡€ä¸Šï¼Œä»ä¸­é€‰æ‹©10ä¸ªå€™é€‰åˆ†ç±»ç±»åˆ«ï¼šä½“è‚²ã€å¨±ä¹ã€å®¶å±…ã€æˆ¿äº§ã€æ•™è‚²ã€æ—¶å°šã€æ—¶æ”¿ã€æ¸¸æˆã€ç§‘æŠ€ã€è´¢ç»ã€‚</p><p>æ•°æ®æ€»é‡ä¸€å…±ä¸º6.5ä¸‡æ¡ï¼Œå…¶ä¸­è®­ç»ƒé›†æ•°æ®5ä¸‡æ¡ï¼Œæ¯ä¸ªç±»åˆ«5000æ¡ï¼ŒéªŒè¯é›†æ•°æ®0.5ä¸‡æ¡ï¼Œæ¯ä¸ªç±»åˆ«500æ¡ï¼Œæµ‹è¯•é›†æ•°æ®1ä¸‡æ¡ï¼Œæ¯ä¸ªç±»åˆ«1000æ¡ã€‚ç¬”è€…å·²å°†æ•°æ®æ”¾åœ¨Githubä¸Šï¼Œè¯»è€…å¯ä»¥åœ¨æœ€åçš„æ€»ç»“ä¸­æ‰¾åˆ°ã€‚</p><p>é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/nlp16_1.png" /></p><p>æ¥ç€ï¼Œæˆ‘ä»¬å°è¯•ç€åˆ©ç”¨kashgari-tfæ¥è®­ç»ƒä¸€ä¸ªæ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œå…¶ä¸­æ¨¡å‹æˆ‘ä»¬é‡‡ç”¨CNN-LSTMï¼Œå®Œæ•´çš„Pythonä»£ç ï¼ˆtext_classification_model_train.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># time: 2019-08-13 11:16</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><br><span class="hljs-keyword">from</span> kashgari.tasks.classification <span class="hljs-keyword">import</span> CNN_LSTM_Model<br><br><span class="hljs-comment"># è·å–æ•°æ®é›†</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>(<span class="hljs-params">data_type</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./data/cnews.%s.txt&#x27;</span> % data_type, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        content = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines() <span class="hljs-keyword">if</span> _.strip()]<br><br>    x, y = [], []<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> content:<br>        label, text = line.split(maxsplit=<span class="hljs-number">1</span>)<br>        y.append(label)<br>        x.append([_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> text])<br><br>    <span class="hljs-keyword">return</span> x, y<br><br><span class="hljs-comment"># è·å–æ•°æ®</span><br>train_x, train_y = load_data(<span class="hljs-string">&#x27;train&#x27;</span>)<br>valid_x, valid_y = load_data(<span class="hljs-string">&#x27;val&#x27;</span>)<br>test_x, test_y = load_data(<span class="hljs-string">&#x27;test&#x27;</span>)<br><br><span class="hljs-comment"># è®­ç»ƒæ¨¡å‹</span><br>model = CNN_LSTM_Model()<br>model.fit(train_x, train_y, valid_x, valid_y, batch_size=<span class="hljs-number">16</span>, epochs=<span class="hljs-number">5</span>)<br><br><span class="hljs-comment"># è¯„ä¼°æ¨¡å‹</span><br>model.evaluate(test_x, test_y)<br><br><span class="hljs-comment"># ä¿å­˜æ¨¡å‹</span><br>model.save(<span class="hljs-string">&#x27;text_classification_model&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„æ¨¡å‹ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><span class="hljs-section">Layer (type)                 Output Shape              Param #</span><br><span class="hljs-section">=================================================================</span><br>input (InputLayer)           (None, 2544)              0<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br>layer<span class="hljs-emphasis">_embedding (Embedding)  (None, 2544, 100)         553200</span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span><br>conv1d (Conv1D)              (None, 2544, 32)          9632<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br>max<span class="hljs-emphasis">_pooling1d (MaxPooling1D) (None, 1272, 32)          0</span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span><br>cu<span class="hljs-emphasis">_dnnlstm (CuDNNLSTM)       (None, 100)               53600</span><br><span class="hljs-emphasis"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_</span><br><span class="hljs-section">dense (Dense)                (None, 10)                1010</span><br><span class="hljs-section">=================================================================</span><br>Total params: 617,442<br>Trainable params: 617,442<br>Non-trainable params: 0<br></code></pre></td></tr></table></figure><p>è®¾å®šæ¨¡å‹è®­ç»ƒæ¬¡æ•°ä¸º5ä¸ªepochï¼Œbatch_sizeä¸º16ã€‚æ¨¡å‹è®­ç»ƒå®Œåï¼Œåœ¨è®­ç»ƒé›†ã€éªŒè¯é›†ä¸Šçš„ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ•°æ®é›†</th><th>accuracy</th><th>loss</th></tr></thead><tbody><tr class="odd"><td>è®­ç»ƒé›†</td><td>0.9661</td><td>0.1184</td></tr><tr class="even"><td>éªŒè¯é›†</td><td>0.9204</td><td>0.2567</td></tr></tbody></table><p>åœ¨æµ‹è¯•é›†ä¸Šçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml">             <span class="hljs-string">precision</span>    <span class="hljs-string">recall</span>  <span class="hljs-string">f1-score</span>   <span class="hljs-string">support</span><br><br>          <span class="hljs-string">ä½“è‚²</span>     <span class="hljs-number">0.9852</span>    <span class="hljs-number">0.9970</span>    <span class="hljs-number">0.9911</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">å¨±ä¹</span>     <span class="hljs-number">0.9938</span>    <span class="hljs-number">0.9690</span>    <span class="hljs-number">0.9813</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">å®¶å±…</span>     <span class="hljs-number">0.9384</span>    <span class="hljs-number">0.8830</span>    <span class="hljs-number">0.9098</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æˆ¿äº§</span>     <span class="hljs-number">0.9490</span>    <span class="hljs-number">0.9680</span>    <span class="hljs-number">0.9584</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æ•™è‚²</span>     <span class="hljs-number">0.9650</span>    <span class="hljs-number">0.8820</span>    <span class="hljs-number">0.9216</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æ—¶å°š</span>     <span class="hljs-number">0.9418</span>    <span class="hljs-number">0.9710</span>    <span class="hljs-number">0.9562</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æ—¶æ”¿</span>     <span class="hljs-number">0.9732</span>    <span class="hljs-number">0.9450</span>    <span class="hljs-number">0.9589</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">æ¸¸æˆ</span>     <span class="hljs-number">0.9454</span>    <span class="hljs-number">0.9700</span>    <span class="hljs-number">0.9576</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">ç§‘æŠ€</span>     <span class="hljs-number">0.8910</span>    <span class="hljs-number">0.9560</span>    <span class="hljs-number">0.9223</span>      <span class="hljs-number">1000</span><br>          <span class="hljs-string">è´¢ç»</span>     <span class="hljs-number">0.9566</span>    <span class="hljs-number">0.9920</span>    <span class="hljs-number">0.9740</span>      <span class="hljs-number">1000</span><br><br>    <span class="hljs-string">accuracy</span>                         <span class="hljs-number">0.9533</span>     <span class="hljs-number">10000</span><br>   <span class="hljs-string">macro</span> <span class="hljs-string">avg</span>     <span class="hljs-number">0.9539</span>    <span class="hljs-number">0.9533</span>    <span class="hljs-number">0.9531</span>     <span class="hljs-number">10000</span><br><span class="hljs-string">weighted</span> <span class="hljs-string">avg</span>     <span class="hljs-number">0.9539</span>    <span class="hljs-number">0.9533</span>    <span class="hljs-number">0.9531</span>     <span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure><p>æ€»çš„æ¥è¯´ï¼Œä¸Šè¿°æ¨¡å‹è®­ç»ƒçš„æ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚æ¥ä¸‹æ¥ï¼Œæ˜¯è€ƒéªŒæ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›çš„æ—¶åˆ»äº†ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦å…·ä½“æ–‡æœ¬åˆ†ç±»çš„æ³›åŒ–èƒ½åŠ›ã€‚</p><h3 id="æµ‹è¯•">æµ‹è¯•</h3><p>æˆ‘ä»¬å·²ç»æœ‰äº†è®­ç»ƒå¥½çš„æ¨¡å‹<code>text_classification_model</code>ï¼Œæ¥ç€è®©æˆ‘ä»¬åˆ©ç”¨è¯¥æ¨¡å‹æ¥å¯¹æ–°çš„æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œé¢„æµ‹çš„ä»£ç ï¼ˆmodel_predict.pyï¼‰å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># time: 2019-08-14 00:21</span><br><span class="hljs-comment"># place: Pudong Shanghai</span><br><br><span class="hljs-keyword">import</span> kashgari<br><br><span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>loaded_model = kashgari.utils.load_model(<span class="hljs-string">&#x27;text_classification_model&#x27;</span>)<br><br>text = <span class="hljs-string">&#x27;åå¤å¹¸ç¦æˆç«‹äº 1998 å¹´ï¼Œå‰èº«ä¸ºå»ŠåŠå¸‚åå¤æˆ¿åœ°äº§å¼€å‘æœ‰é™å…¬å¸ï¼Œåˆå§‹æ³¨å†Œèµ„æœ¬ 200 ä¸‡å…ƒï¼Œå…¶ä¸­ç‹æ–‡å­¦å‡ºèµ„ 160 ä¸‡å…ƒï¼Œå»ŠåŠå¸‚èé€šç‰©èµ„è´¸æ˜“æœ‰é™å…¬å¸å‡ºèµ„ 40 ä¸‡å…ƒï¼Œåç»å¤šæ¬¡è‚¡æƒè½¬è®©å’Œå¢èµ„ï¼Œå…¬å¸äº 2007 å¹´æ•´ä½“æ”¹åˆ¶ä¸ºè‚¡ä»½åˆ¶å…¬å¸ï¼Œ2011 å¹´å®Œæˆå€Ÿå£³ä¸Šå¸‚ã€‚&#x27;</span><br><br>x = [[_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> text]]<br><br>label = loaded_model.predict(x)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;é¢„æµ‹åˆ†ç±»:%s&#x27;</span> % label)<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯æµ‹è¯•ç»“æœï¼š</p><blockquote><p>åŸæ–‡1: åå¤å¹¸ç¦æˆç«‹äº 1998å¹´ï¼Œå‰èº«ä¸ºå»ŠåŠå¸‚åå¤æˆ¿åœ°äº§å¼€å‘æœ‰é™å…¬å¸ï¼Œåˆå§‹æ³¨å†Œèµ„æœ¬ 200ä¸‡å…ƒï¼Œå…¶ä¸­ç‹æ–‡å­¦å‡ºèµ„ 160 ä¸‡å…ƒï¼Œå»ŠåŠå¸‚èé€šç‰©èµ„è´¸æ˜“æœ‰é™å…¬å¸å‡ºèµ„ 40ä¸‡å…ƒï¼Œåç»å¤šæ¬¡è‚¡æƒè½¬è®©å’Œå¢èµ„ï¼Œå…¬å¸äº 2007 å¹´æ•´ä½“æ”¹åˆ¶ä¸ºè‚¡ä»½åˆ¶å…¬å¸ï¼Œ2011å¹´å®Œæˆå€Ÿå£³ä¸Šå¸‚ã€‚ åˆ†ç±»ç»“æœï¼šé¢„æµ‹åˆ†ç±»:['è´¢ç»']</p></blockquote><blockquote><p>åŸæ–‡2:ç°ä»Šå¸¸è§çš„çŸ­è¢–è¡¬è¡«å¤§è‡´ä¸Šå¯ä»¥åˆ†ä¸ºï¼šå¤å¨å¤·è¡¬è¡«ã€å¤å·´è¡¬è¡«ã€ä¿é¾„çƒè¡«ï¼Œä¸‰è€…ä¹‹é—´è™½æœ‰äº›å¾®åˆ†åˆ«ï¼Œä½†å…¶å®æœ‰äº›æ—¶å€™ï¼Œä¸€ä»¶è¡¬è¡«ä¹Ÿå¯èƒ½åŒ…å«äº†å¤šç§æ¬¾å¼çš„ç‰¹è‰²ã€‚è€Œâ€˜å¤å·´ï¼ˆé¢†ï¼‰è¡¬è¡«â€™æœ€æ˜¾è€Œæ˜“è§çš„ç‰¹ç‚¹åœ¨äºâ€˜é¢†å£â€™ï¼Œé€šå¸¸ä¼šè®¾è®¡ä¸ºVé¢†ï¼Œä¸”å‘ˆç°å¾®å¾®çš„å¤–ç¿»ï¼Œä¹Ÿå› æ­¤ç¼ºå°‘è¡¬è¡«é¢†å£å¸¸è§çš„â€˜ç¬¬ä¸€é¢—é’®æ‰£â€™ï¼Œè¡£æœåˆ°é¢†å­çš„å‰ªè£ä¸ºä¸€ä½“æˆå½¢ï¼Œæ•´ä½“è¾ƒå®½æ¾èˆ’é€‚ã€‚åˆ†ç±»ç»“æœï¼šé¢„æµ‹åˆ†ç±»:['æ—¶å°š']</p></blockquote><blockquote><p>åŸæ–‡3:å‘¨ç¦2014å¹´åŠ ç›Ÿæ–°ç–†å¹¿æ±‡ç¯®çƒä¿±ä¹éƒ¨ï¼Œå½“å¹´å°±ä»£è¡¨ä¿±ä¹éƒ¨é’å¹´é˜Ÿæ¥è¿æ‹¿ä¸‹å…¨å›½ç¯®çƒé’å¹´è”èµ›å† å†›å’Œå…¨å›½ä¿±ä¹éƒ¨é’å¹´è”èµ›å† å†›ã€‚å‡å…¥ä¸€é˜Ÿåï¼Œå‘¨ç¦2016å¹´éšé˜Ÿå‡ºæˆ˜ç¬¬25å±Šäºšå† æ¯ï¼Œè·å¾—å† å†›ã€‚2016-2017èµ›å­£ï¼Œå‘¨ç¦ä¸ºæ–°ç–†å¹¿æ±‡é˜Ÿå¤ºå¾—é˜Ÿå²é¦–åº§æ€»å† å†›å¥–æ¯ç«‹ä¸‹æ±—é©¬åŠŸåŠ³ï¼Œä»–åœ¨æ€»å†³èµ›ä¸­å¸¦ä¼¤å‡ºæˆ˜ï¼Œæ›´æ˜¯ä¼ ä¸ºä½³è¯ã€‚åˆ†ç±»ç»“æœï¼šé¢„æµ‹åˆ†ç±»:['ä½“è‚²']</p></blockquote><blockquote><p>åŸæ–‡4:å‘¨æ°ä¼¦[å¾®åš]ç›‘åˆ¶èµ›è½¦ç”µå½±ã€Šå±å’¤é£äº‘ã€‹13æ—¥é‡Šå‡ºèŠ±çµ®å¯¼æ¼”ç¯‡ï¼Œä¸ä»…çœŸå®èµ›è½¦ç«é€Ÿç”»é¢å¤§é‡æ›å…‰ï¼Œå‡ åè¾†ç™¾ä¸‡èµ›è½¦åœ¨å›½é™…ä¸“ä¸šèµ›é“ã€å±±è·¯é£™é€Ÿï¼Œåœºé¢æµ©å¤§éœ‡æ’¼ï¼Œæ›´æ­å¼€ä¸å°‘ç°åœºæ‹æ‘„çš„å¹•åç”»é¢ã€‚ç›‘åˆ¶å‘¨æ°ä¼¦åœ¨ç°åœºä¸å¯¼æ¼”è®¨è®ºå‰§æœ¬ã€èŒƒé€¸è‡£[å¾®åš]ä¸é«˜è‹±è½©å¤§æ‰“å‡ºæ‰‹ã€ç”šè‡³æœ‰çœ¼å°–ç½‘å‹å‘ç°åœ¨èŠ±çµ®ä¸­é—ªè¿‡â€œç”·ç¥â€æç‰çº[å¾®åš]çš„ç”»é¢ã€‚åˆ†ç±»ç»“æœï¼šé¢„æµ‹åˆ†ç±»:['å¨±ä¹']</p></blockquote><blockquote><p>åŸæ–‡5:åŒ—äº¬æ—¶é—´8æœˆ13æ—¥ä¸Šåˆæ¶ˆæ¯ï¼Œæ®ã€ŠéŸ©å›½å…ˆé©±æŠ¥ã€‹ç½‘ç«™æŠ¥é“ï¼Œè¿‘æ—¥ç¾å›½çŸ¥è¯†äº§æƒæ‰€æœ‰è€…åä¼šï¼ˆIntellectual Property Owners Associationï¼‰å‘å¸ƒçš„ä¸€ä»½æŠ¥å‘Šæ˜¾ç¤ºï¼Œåœ¨è·å¾—çš„ç¾å›½ä¸“åˆ©æ•°é‡æ–¹é¢ï¼ŒIBMã€å¾®è½¯å’Œé€šç”¨ç”µæ°”ç­‰ç¾å›½ä¼ä¸šååˆ—å‰èŒ…ï¼Œæ’åœ¨åé¢çš„éŸ©å›½ç§‘æŠ€å·¨å¤´ä¸‰æ˜Ÿã€LGä¸ä¹‹ç«äº‰æ¿€çƒˆã€‚åˆ†ç±»ç»“æœï¼šé¢„æµ‹åˆ†ç±»:['ç§‘æŠ€']</p></blockquote><h3 id="æ€»ç»“">æ€»ç»“</h3><p>è™½ç„¶æˆ‘ä»¬ä¸Šè¿°æµ‹è¯•çš„æ–‡æœ¬åˆ†ç±»æ•ˆæœè¿˜ä¸é”™ï¼Œä½†ä¹Ÿå­˜åœ¨ç€ä¸€äº›åˆ†ç±»é”™è¯¯çš„æƒ…å†µã€‚</p><p>æœ¬æ–‡è®²è¿°äº†å¦‚ä½•åˆ©ç”¨kashgari-tfæ¨¡å—æ¥å¿«é€Ÿåœ°æ­å»ºæ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼Œå…¶å®ï¼Œä¹Ÿæ²¡é‚£ä¹ˆéš¾ï¼</p><p>æœ¬æ–‡ä»£ç å’Œæ•°æ®åŠå·²ä¸Šä¼ è‡³Github, ç½‘å€ä¸ºï¼š <ahref="https://github.com/percent4/cnews_text_classification">https://github.com/percent4/cnews_text_classification</a></p><blockquote><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>Kashgari</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆåäº”ï¼‰è®©æ¨¡å‹æ¥å‘Šè¯‰ä½ æ–‡æœ¬ä¸­çš„æ—¶é—´</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%BA%94%EF%BC%89%E8%AE%A9%E6%A8%A1%E5%9E%8B%E6%9D%A5%E5%91%8A%E8%AF%89%E4%BD%A0%E6%96%87%E6%9C%AC%E4%B8%AD%E7%9A%84%E6%97%B6%E9%97%B4/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%BA%94%EF%BC%89%E8%AE%A9%E6%A8%A1%E5%9E%8B%E6%9D%A5%E5%91%8A%E8%AF%89%E4%BD%A0%E6%96%87%E6%9C%AC%E4%B8%AD%E7%9A%84%E6%97%B6%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h3><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E4%BB%8E%E6%96%87%E6%9C%AC%E4%B8%AD%E6%8F%90%E5%8F%96%E6%97%B6%E9%97%B4/">NLPå…¥é—¨ï¼ˆåä¸€ï¼‰ä»æ–‡æœ¬ä¸­æå–æ—¶é—´</a>ä¸­ï¼Œç¬”è€…æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨åˆ†è¯ã€è¯æ€§æ ‡æ³¨çš„æ–¹æ³•ä»æ–‡æœ¬ä¸­è·å–æ—¶é—´ã€‚å½“æ—¶çš„æƒ³æ³•æ¯”è¾ƒç®€å•å¿«æ·ï¼Œåªæ˜¯åˆ©ç”¨äº†è¯æ€§æ ‡æ³¨è¿™ä¸ªåŠŸèƒ½è€Œå·²ï¼Œå› æ­¤ï¼Œåœ¨æŸäº›åœ°æ–¹ï¼Œæ—¶é—´çš„è¯†åˆ«æ•ˆæœå¹¶ä¸å¤ªå¥½ã€‚æ¯”å¦‚ä»¥ä¸‹çš„ä¸¤ä¸ªä¾‹å­ï¼š</p><p>åŸæ–‡1:</p><blockquote><p>è‹åŒ—å¤§é‡å†œæ‘ä½æˆ¿å»ºäºä¸Šä¸–çºª80å¹´ä»£ä¹‹å‰ã€‚å»å¹´9æœˆï¼Œæ±Ÿè‹çœå†³å®šå…¨é¢æ”¹å–„è‹åŒ—å†œæ°‘ä½æˆ¿æ¡ä»¶ï¼Œè®¡åˆ’3å¹´å†…æ”¹å–„30ä¸‡æˆ·ï¼Œä½œä¸ºå†³èƒœå…¨é¢å»ºæˆå°åº·ç¤¾ä¼šè¡¥çŸ­æ¿çš„é‡è¦ä¸¾æªã€‚</p></blockquote><p>ç”¨ç¬”è€…ä¹‹å‰çš„ä»£ç ï¼Œæå–çš„æ—¶é—´ç»“æœä¸ºï¼š</p><blockquote><p>æå–æ—¶é—´ï¼š ['å»å¹´9æœˆ']</p></blockquote><p>ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬æå–çš„æ—¶é—´åº”è¯¥æ˜¯ï¼š</p><blockquote><p>ä¸Šä¸–çºª80å¹´ä»£ä¹‹å‰ï¼Œ å»å¹´9æœˆï¼Œ3å¹´å†…</p></blockquote><p>åŸæ–‡2:</p><blockquote><p>å—å®‹ç»å…´åå¹´ï¼Œé‡‘åˆ†å…µä¸¤è·¯å‘é™•è¥¿å’Œæ²³å—å¤§ä¸¾è¿›æ”»ï¼Œåœ¨å¾ˆå¿«å¤ºå›äº†æ²³å—ã€é™•è¥¿ä¹‹åï¼Œåˆç‡å¤§å†›å‘æ·®å—å¤§ä¸¾è¿›æ”»ã€‚</p></blockquote><p>ç”¨ç¬”è€…ä¹‹å‰çš„ä»£ç ï¼Œæå–çš„æ—¶é—´ç»“æœä¸ºï¼š</p><blockquote><p>æå–æ—¶é—´ï¼š ['å—å®‹']</p></blockquote><p>ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬æå–çš„æ—¶é—´åº”è¯¥æ˜¯ï¼š</p><blockquote><p>å—å®‹ç»å…´åå¹´</p></blockquote><p>å› æ­¤ï¼Œåˆ©ç”¨ç®€å•çš„è¯æ€§æ ‡æ³¨åŠŸèƒ½æ¥æå–æ–‡æœ¬ä¸­çš„æ—¶é—´ä¼šå­˜åœ¨æ¼æã€é”™æçš„æƒ…å†µï¼Œé‰´äºæ­¤ï¼Œç¬”è€…æƒ³åˆ°èƒ½å¦ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹æ¥å®ç°æ–‡æœ¬ä¸­çš„æ—¶é—´æå–å‘¢ï¼Ÿ</p><p>è¯¥åŠŸèƒ½ç±»ä¼¼äºå‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰åŠŸèƒ½ï¼Œåªä¸è¿‡NERæ˜¯è¯†åˆ«æ–‡æœ¬ä¸­çš„äººåã€åœ°åã€ç»„ç»‡æœºæ„åï¼Œè€Œæˆ‘ä»¬è¿™æ¬¡éœ€è¦è¯†åˆ«æ–‡æœ¬ä¸­çš„æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬èƒŒåçš„ç®—æ³•åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³é‡‡ç”¨åºåˆ—æ ‡æ³¨æ¨¡å‹æ¥è§£å†³ã€‚</p><h3 id="é¡¹ç›®">é¡¹ç›®</h3><p>åœ¨æ–‡ç« <ahref="https://percent4.github.io/2023/07/08/NLP%EF%BC%88%E5%8D%81%E5%9B%9B%EF%BC%89%E8%87%AA%E5%88%B6%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E5%B9%B3%E5%8F%B0/">NLPï¼ˆåå››ï¼‰è‡ªåˆ¶åºåˆ—æ ‡æ³¨å¹³å°</a>ä¸­ï¼Œç¬”è€…æå‡ºäº†ä¸€ç§è‡ªåˆ¶çš„åºåˆ—æ ‡æ³¨å¹³å°ï¼Œåˆ©ç”¨è¯¥æ ‡æ³¨å¹³å°ï¼Œç¬”è€…ä»æ–°é—»ç½‘ç«™ä¸­æ ‡æ³¨äº†å¤§çº¦2000ä»½è¯­æ–™ï¼Œæ ‡æ³¨å‡ºæ–‡æœ¬ä¸­çš„æ—¶é—´ï¼Œå…¶ä¸­75%ä½œä¸ºè®­ç»ƒé›†ï¼ˆtime.trainæ–‡ä»¶ï¼‰ï¼Œ10%ä½œä¸ºéªŒè¯é›†ï¼ˆtime.devæ–‡ä»¶ï¼‰ï¼Œ15%ä½œä¸ºæµ‹è¯•é›†ï¼ˆtime.testæ–‡ä»¶ï¼‰ã€‚</p><p>è™½ç„¶æˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†æ·±åº¦å­¦ä¹ æ¡†æ¶æ–¹ä¾¿æˆ‘ä»¬æ¥è®­ç»ƒæ¨¡å‹ï¼Œæ¯”å¦‚TensorFlow,Keras,PyTorchç­‰ï¼Œä½†ç›®å‰å·²æœ‰æŸå¤§ç¥å¼€æºäº†ä¸€ä¸ªåºåˆ—æ ‡æ³¨å’Œæ–‡æœ¬åˆ†ç±»çš„æ¨¡å—ï¼Œåç§°ä¸ºkashgari-tfï¼Œå®ƒèƒ½å¤Ÿæ–¹ä¾¿å¿«é€Ÿåœ°ç”¨å‡ è¡Œå‘½ä»¤å°±å¯ä»¥è®­ç»ƒä¸€ä¸ªåºåˆ—æ ‡æ³¨æˆ–æ–‡æœ¬åˆ†ç±»çš„æ¨¡å‹ï¼Œå®¹æ˜“ä¸Šæ‰‹ï¼Œè€Œä¸”é›†ä¸­äº†å¤šç§æ¨¡å‹ï¼ˆBiGRUï¼ŒCNNï¼ŒBiLSTMï¼ŒCRFï¼‰ä»¥åŠå¤šç§é¢„è®­ç»ƒæ¨¡å‹ï¼ˆBERTï¼ŒERNIEï¼Œwwm-extï¼‰ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ç®—æ˜¯ååˆ†å‹å¥½äº†ã€‚è¯¥æ¨¡å—çš„å‚è€ƒç½‘å€ä¸ºï¼š<ahref="https://kashgari.bmio.net/">https://kashgari.bmio.net/</a> ã€‚</p><p>ç¬”è€…è‡ªå·±èŠ±äº†å‡ å¤©çš„æ—¶é—´æ¥æ ‡æ³¨æ•°æ®ï¼Œç›®å‰å·²ç´¯è®¡æ ‡æ³¨2000+æ•°æ®ï¼Œåç»­å°†æ”¾åˆ°Githubä¾›å¤§å®¶å‚è€ƒã€‚æˆ‘ä»¬è®­ç»ƒçš„æ•°æ®ï¼Œæ¯”å¦‚time.trainçš„å‰å‡ è¡Œå¦‚ä¸‹ï¼šï¼ˆæ¯ä¸€è¡Œä¸­é—´ç”¨ç©ºæ ¼éš”å¼€ï¼‰</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-number">1</span> <span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">6</span> <span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">0</span> <span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">9</span> <span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>å¹´ <span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>ï¼Œ <span class="hljs-built_in">O</span><br>æ—¥ <span class="hljs-built_in">O</span><br>æœ¬ <span class="hljs-built_in">O</span><br>è¨ <span class="hljs-built_in">O</span><br>æ‘© <span class="hljs-built_in">O</span><br>è—© <span class="hljs-built_in">O</span><br>å…¥ <span class="hljs-built_in">O</span><br>ä¾µ <span class="hljs-built_in">O</span><br>ç‰ <span class="hljs-built_in">O</span><br>çƒ <span class="hljs-built_in">O</span><br>å›½ <span class="hljs-built_in">O</span><br>ï¼Œ <span class="hljs-built_in">O</span><br>å¹¶ <span class="hljs-built_in">O</span><br>åœ¨ <span class="hljs-built_in">O</span><br>ä¸€ <span class="hljs-built_in">O</span><br>ä¸ª <span class="hljs-built_in">O</span><br>æ—¶ <span class="hljs-built_in">O</span><br>æœŸ <span class="hljs-built_in">O</span><br>å†… <span class="hljs-built_in">O</span><br>æ§ <span class="hljs-built_in">O</span><br>åˆ¶ <span class="hljs-built_in">O</span><br>ç‰ <span class="hljs-built_in">O</span><br>çƒ <span class="hljs-built_in">O</span><br>å›½ <span class="hljs-built_in">O</span><br><span class="hljs-operator">...</span><br></code></pre></td></tr></table></figure><p>æ¥ç€æ˜¯æ¨¡å‹è¿™å—ï¼Œæˆ‘ä»¬é‡‡ç”¨ç»å…¸çš„BERT+Bi-LSTM+CRFæ¨¡å‹ï¼Œè®­ç»ƒ1ä¸ªepochï¼Œbatch_sizeä¸º16ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># time: 2019-08-09 16:47</span><br><span class="hljs-comment"># place: Zhichunlu Beijing</span><br><br><span class="hljs-keyword">import</span> kashgari<br><span class="hljs-keyword">from</span> kashgari.corpus <span class="hljs-keyword">import</span> DataReader<br><span class="hljs-keyword">from</span> kashgari.embeddings <span class="hljs-keyword">import</span> BERTEmbedding<br><span class="hljs-keyword">from</span> kashgari.tasks.labeling <span class="hljs-keyword">import</span> BiLSTM_CRF_Model<br><br>train_x, train_y = DataReader().read_conll_format_file(<span class="hljs-string">&#x27;./data/time.train&#x27;</span>)<br>valid_x, valid_y = DataReader().read_conll_format_file(<span class="hljs-string">&#x27;./data/time.dev&#x27;</span>)<br>test_x, test_y = DataReader().read_conll_format_file(<span class="hljs-string">&#x27;./data/time.test&#x27;</span>)<br><br>bert_embedding = BERTEmbedding(<span class="hljs-string">&#x27;chinese_L-12_H-768_A-12&#x27;</span>,<br>                               task=kashgari.LABELING,<br>                               sequence_length=<span class="hljs-number">128</span>)<br><br>model = BiLSTM_CRF_Model(bert_embedding)<br>model.fit(train_x, train_y, valid_x, valid_y, batch_size=<span class="hljs-number">16</span>, epochs=<span class="hljs-number">1</span>)<br><br>model.save(<span class="hljs-string">&#x27;time_ner.h5&#x27;</span>)<br><br>model.evaluate(test_x, test_y)<br></code></pre></td></tr></table></figure><p>æ¨¡å‹è®­ç»ƒå®Œåï¼Œå¾—åˆ°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ•°æ®é›†</th><th>accuracy</th><th>loss</th></tr></thead><tbody><tr class="odd"><td>è®­ç»ƒé›†</td><td>0.9814</td><td>6.7295</td></tr><tr class="even"><td>éªŒè¯é›†</td><td>0.6868</td><td>150.8513</td></tr></tbody></table><p>åœ¨æµ‹è¯•é›†ä¸Šçš„ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>æ•°æ®é›†</th><th>precision</th><th>recall</th><th>f1</th></tr></thead><tbody><tr class="odd"><td>æµ‹è¯•é›†</td><td>0.8547</td><td>0.8934</td><td>0.8736</td></tr></tbody></table><p>ç”±äºæ˜¯å°æ ‡æ³¨é‡ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©äº†ç”¨BERTé¢„è®­ç»ƒæ¨¡å‹ã€‚å¦‚æœä¸é‡‡ç”¨BERTé¢„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨åŒæ ·çš„æ•°æ®é›†ä¸Šï¼Œå³ä½¿è®­ç»ƒ100ä¸ªepochï¼Œè™½ç„¶åœ¨è®­ç»ƒé›†ä¸Šçš„å‡†ç¡®ç‡è¶…è¿‡95%ï¼Œä½†æ˜¯åœ¨æµ‹è¯•é›†ä¸Šå´åªæœ‰å¤§çº¦50%çš„å‡†ç¡®ç‡ï¼Œæ•ˆæœä¸è¡Œï¼Œå› æ­¤ï¼Œéœ€è¦é‡‡ç”¨é¢„è®­ç»ƒæ¨¡å‹ã€‚</p><h3 id="æµ‹è¯•æ•ˆæœ">æµ‹è¯•æ•ˆæœ</h3><p>åœ¨è®­ç»ƒå®Œæ¨¡å‹åï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆtime_ner.h5æ¨¡å‹æ–‡ä»¶ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦è¯¥æ¨¡å‹æ–‡ä»¶æ¥å¯¹æ–°çš„æ–‡ä»¶è¿›è¡Œé¢„æµ‹ï¼Œæå–å‡ºæ–‡æœ¬ä¸­çš„æ—¶é—´ã€‚æ¨¡å‹é¢„æµ‹çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Load saved model</span><br><span class="hljs-keyword">import</span> kashgari<br><br>loaded_model = kashgari.utils.load_model(<span class="hljs-string">&#x27;time_ner.h5&#x27;</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    text = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;sentence: &#x27;</span>)<br>    t = loaded_model.predict([[char <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> text]])<br>    <span class="hljs-built_in">print</span>(t)<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬åœ¨å‡ æ¡æ–°çš„æ•°æ®ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œçœ‹çœ‹è¯¥æ¨¡å‹çš„è¡¨ç°æ•ˆæœï¼š</p><blockquote><p>"åŸæ–‡":"ç»¿åœ°æ§è‚¡2018å¹´å¹´åº¦å¹´æŠ¥æ˜¾ç¤ºï¼Œæˆªè‡³2018å¹´12æœˆ31æ—¥ï¼Œä¸‡ç§‘é‡‘åŸŸä¸­å¤®é¡¹ç›®çš„ç»è¥çŠ¶æ€ä¸ºâ€œä½å®…ã€åŠå…¬ã€å•†ä¸šâ€ï¼Œé¡¹ç›®ç”¨åœ°é¢ç§¯18.90ä¸‡å¹³æ–¹ç±³ï¼Œè§„åˆ’è®¡å®¹å»ºç­‘é¢ç§¯79.38ä¸‡å¹³æ–¹ç±³ï¼Œæ€»å»ºç­‘é¢ç§¯ä¸º105.78ä¸‡å¹³æ–¹ç±³ï¼Œå·²ç«£å·¥é¢ç§¯32.90ä¸‡å¹³æ–¹ç±³ï¼Œæ€»æŠ•èµ„é¢95äº¿å…ƒï¼ŒæŠ¥å‘ŠæœŸå®é™…æŠ•èµ„é¢ä¸º10.18äº¿å…ƒã€‚","é¢„æµ‹æ—¶é—´": [ "2018å¹´å¹´åº¦", "2018å¹´12æœˆ31æ—¥"]</p></blockquote><blockquote><p>"åŸæ–‡":"ç»è¿‡å·¥ä½œäººå‘˜ä¸¤å¤©çš„åå¤éªŒè¯ã€ä¸¥å¯†æµ‹ç®—ï¼Œè®°è€…æ˜¨å¤©ä»ä¸Šæµ·ä¸­å¿ƒå¤§å¦å¾—åˆ°ç¡®è®¤ï¼šè¢«èª‰ä¸ºä¸Šæµ·ä¸­å¿ƒå¤§å¦â€œå®šæ¥¼ç¥å™¨â€çš„é˜»å°¼å™¨ï¼Œåœ¨8æœˆ10æ—¥å‡ºç°è‡ª2016å¹´æ­£å¼å¯ç”¨ä»¥æ¥çš„æœ€å¤§æ‘†å¹…ã€‚","é¢„æµ‹æ—¶é—´": [ "ä¸¤å¤©", "æ˜¨å¤©", "8æœˆ10æ—¥", "2016å¹´"]</p></blockquote><blockquote><p>"åŸæ–‡": "ä¸å¹¸çš„æ˜¯ï¼Œåœ¨å‡ä»»å†…å²çš„åŒå¹´ä¹æœˆï¼Œç‹„ä»æ°å°±åœ¨æ´›é˜³ç§å®…ç¦»ä¸–ã€‚","é¢„æµ‹æ—¶é—´": [ "åŒå¹´ä¹æœˆ"]</p></blockquote><blockquote><p>"åŸæ–‡":"æ—©ä¸Š9ç‚¹25åˆ†åˆ°è¾¾åŒ—äº¬ç«è½¦ç«™ï¼Œç«è½¦ç«™åœ¨åŒ—äº¬å¸‚åŒºå“¦ï¼Œåœ°é“å¾ˆæ–¹ä¾¿åˆ°è¾¾é…’åº—ï¼Œæˆ‘ä»¬å®šäº†ç‹åºœäº•å¤§è¡—çš„é”¦æ±Ÿä¹‹æ˜Ÿï¼Œ409å…ƒä¸€æ™šï¼Œæœ‰ç‚¹å°è´µã€‚ä¸‹åˆå»äº†å¤©å›å…¬å›­ï¼Œå‚æ™šå»äº†å¤©å®‰é—¨å¹¿åœºã€‚","é¢„æµ‹æ—¶é—´": [ "æ—©ä¸Š9ç‚¹25åˆ†", "ä¸‹åˆ", "å‚æ™š"],</p></blockquote><h3 id="æ€»ç»“">æ€»ç»“</h3><p>åˆ©ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œåœ¨å°æ ‡æ³¨é‡æ•°æ®ä¸Šï¼Œæˆ‘ä»¬å¯¹æ—¶é—´è¯†åˆ«å–å¾—äº†ä¸é”™çš„æ•ˆæœã€‚åç»­å¦‚æœæˆ‘ä»¬æƒ³è¦æé«˜æ—¶é—´è¯†åˆ«çš„å‡†ç¡®ç‡ï¼Œå¯ä»¥å†å¤šå¢åŠ æ ‡æ³¨æ•°æ®ï¼Œç›®å‰è¿˜åªæœ‰2000+æ•°æ®ï½</p><p>æœ¬é¡¹ç›®å·²ç»å¼€æºï¼ŒGithubçš„åœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/Chinese_Time_Recogniztion">https://github.com/percent4/Chinese_Time_Recogniztion</a>ã€‚</p><p>å¦å¤–ï¼Œå¼ºçƒˆæ¨èkashgari-tfæ¨¡å—ï¼Œå®ƒèƒ½å¤Ÿè®©ä½ åœ¨å‡ åˆ†é’Ÿå†…æ­å»ºä¸€ä¸ªåºåˆ—æ ‡æ³¨æ¨¡å‹ï¼Œè€Œä¸”æ–¹ä¾¿åŠ è½½å„ç§é¢„è®­ç»ƒæ¨¡å‹ã€‚</p><blockquote><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆåå››ï¼‰è‡ªåˆ¶åºåˆ—æ ‡æ³¨å¹³å°</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E5%8D%81%E5%9B%9B%EF%BC%89%E8%87%AA%E5%88%B6%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E5%B9%B3%E5%8F%B0/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E5%8D%81%E5%9B%9B%EF%BC%89%E8%87%AA%E5%88%B6%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E5%B9%B3%E5%8F%B0/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h3><p>åœ¨å¹³æ—¶çš„NLPä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰ï¼Œå¸¸ç”¨çš„è¯†åˆ«å®ä½“ç±»å‹ä¸ºäººåã€åœ°åã€ç»„ç»‡æœºæ„åï¼Œä½†æ˜¯æˆ‘ä»¬å¾€å¾€ä¹Ÿä¼šæœ‰è¯†åˆ«å…¶å®ƒå®ä½“çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ—¶é—´ã€å“ç‰Œåç­‰ã€‚åœ¨åˆ©ç”¨ç®—æ³•åšå®ä½“è¯†åˆ«çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨åºåˆ—æ ‡æ³¨ç®—æ³•ï¼Œè¿™å°±å¯¹æ ‡æ³¨çš„æ–‡æœ¬æ ¼å¼æœ‰ä¸€å®šçš„è¦æ±‚ï¼Œå› æ­¤ï¼Œä¸€ä¸ªå¥½çš„åºåˆ—æ ‡æ³¨çš„å¹³å°å¿…ä¸å¯å°‘ï¼Œå°†ä¼šå¤§å¤§å‡å°‘æˆ‘ä»¬æ ‡æ³¨çš„å·¥ä½œé‡ï¼Œæœ‰æ•ˆæå‡ç®—æ³•çš„æ›´æ–°è¿­ä»£é€Ÿåº¦ã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»ç¬”è€…çš„ä¸€ä¸ªå·¥ä½œï¼šè‡ªåˆ¶çš„åºåˆ—æ ‡æ³¨å¹³å°ã€‚æˆ‘ä»¬ä»¥æ—¶é—´è¯†åˆ«ä¸ºä¾‹ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸‹é¢çš„æ–‡ç« ä¸­ï¼š</p><blockquote><p>æŒ‰è®¡åˆ’ï¼Œ2019å¹´8æœˆ10æ—¥ï¼Œè£è€€æ™ºæ…§å±å°†åœ¨åä¸ºå¼€å‘è€…å¤§ä¼šä¸Šæ­£å¼äº®ç›¸ï¼Œåœ¨8æœˆ6æ—¥ï¼Œè£è€€å®˜å¾®è¡¨ç¤ºè¯¥äº§å“çš„é¢„çº¦é‡å·²ç ´åä¸‡å°ï¼Œ8æœˆ7æ—¥ä¸‹åˆï¼Œè£è€€æ€»è£èµµæ˜åˆåœ¨å¾®åšä¸Šé€ åŠ¿ç‡å…ˆæ‰“å‡ºå·®å¼‚åŒ–ç‰Œï¼Œæ™ºæ…§å±æ²¡æœ‰å¼€å…³æœºå¹¿å‘Šï¼Œå¹¶è¡¨æ€ä»¥åä¹Ÿä¸ä¼šæœ‰ï¼Œæ¶ˆè´¹è€…ä½“éªŒè‡³ä¸Šï¼Œè¥é”€ä¸€æ³¢æ¥ä¸€æ³¢ï¼Œå¯è°“æ¥åŠ¿æ±¹æ±¹ã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦ä»è¯¥æ–‡ç« ä¸­æ ‡æ³¨å‡ºä¸‰ä¸ªæ—¶é—´ï¼š<code>2019å¹´8æœˆ10æ—¥</code>ï¼Œ<code>8æœˆ6æ—¥</code>ï¼Œ<code>8æœˆ7æ—¥ä¸‹åˆ</code>ï¼Œå¹¶å½¢æˆæ ‡æ³¨åºåˆ—ã€‚</p><p>ä¸‹é¢å°†è¯¦ç»†ä»‹ç»ç¬”è€…çš„å·¥ä½œã€‚</p><h3 id="åºåˆ—æ ‡æ³¨å¹³å°">åºåˆ—æ ‡æ³¨å¹³å°</h3><p>ç”±äºå¼€å‘æ—¶é—´ä»“ä¿ƒä»¥åŠç¬”è€…èƒ½åŠ›æœ‰é™ï¼Œå› æ­¤ï¼Œåºåˆ—æ ‡æ³¨å¹³å°çš„åŠŸèƒ½è¿˜æ²¡æœ‰å¾ˆå®Œå–„ï¼Œå¸Œæœ›ç¬”è€…çš„å·¥ä½œèƒ½æŠ›ç –å¼•ç‰ã€‚</p><p>é¡¹ç›®çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp14_1.png" /></p><p>templatesä¸­å­˜æ”¾é™æ€èµ„æºï¼Œtime_index.htmlä¸ºå¹³å°çš„æ“ä½œç•Œé¢ï¼Œtime_outputä¸ºå¹³å°æ ‡æ³¨å®Œå®ä½“åçš„æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œtime_server.pyæ˜¯ç”¨tornadoå†™çš„æœåŠ¡ç«¯è·¯å¾„æ§åˆ¶ä»£ç ï¼Œutils.pyä¸­æ˜¯è·å–æŸä¸ªè·¯å¾„ä¸‹çš„txtæ–‡ä»¶çš„æœ€å¤§æ•°å€¼çš„å‡½æ•°ã€‚</p><p>å…¶ä¸­ï¼Œutils.pyçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># time: 2019-03-14</span><br><span class="hljs-comment"># place: Xinbeiqiao, Beijing</span><br><br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># è·å–å½“å‰æ‰€åœ¨ç›®å½•çš„txtæ–‡æœ¬çš„æœ€å¤§æ•°å€¼</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_max_num</span>(<span class="hljs-params">path</span>):<br>    files = os.listdir(path)<br>    <span class="hljs-keyword">if</span> files:<br>        numbers = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">int</span>(x.replace(<span class="hljs-string">&#x27;.txt&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)), files))<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(numbers)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>time_server.pyçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># time: 2019-08-08</span><br><span class="hljs-comment"># place: Xinbeiqiao, Beijing</span><br><br><span class="hljs-keyword">import</span> os.path<br><span class="hljs-keyword">import</span> tornado.httpserver<br><span class="hljs-keyword">import</span> tornado.ioloop<br><span class="hljs-keyword">import</span> tornado.options<br><span class="hljs-keyword">import</span> tornado.web<br><span class="hljs-keyword">from</span> tornado.options <span class="hljs-keyword">import</span> define, options<br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> get_max_num<br><br><span class="hljs-comment">#å®šä¹‰ç«¯å£ä¸º9005</span><br>define(<span class="hljs-string">&quot;port&quot;</span>, default=<span class="hljs-number">9005</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;run on the given port&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>)<br><br><span class="hljs-comment"># GETè¯·æ±‚</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryHandler</span>(tornado.web.RequestHandler):<br>    <span class="hljs-comment"># getå‡½æ•°</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>):<br>        self.render(<span class="hljs-string">&#x27;time_index.html&#x27;</span>, data = [<span class="hljs-string">&#x27;&#x27;</span>, []])<br><br><span class="hljs-comment"># POSTè¯·æ±‚</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PostHandler</span>(tornado.web.RequestHandler):<br>    <span class="hljs-comment"># postå‡½æ•°</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self</span>):<br><br>        <span class="hljs-comment"># è·å–å‰ç«¯å‚æ•°, event, time, index</span><br>        event = self.get_argument(<span class="hljs-string">&#x27;event&#x27;</span>)<br>        times = self.get_arguments(<span class="hljs-string">&#x27;time&#x27;</span>)<br>        indices = self.get_arguments(<span class="hljs-string">&#x27;index&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(event)<br>        <span class="hljs-built_in">print</span>(times)<br>        <span class="hljs-built_in">print</span>(indices)<br><br>        <span class="hljs-comment"># å‰ç«¯æ˜¾ç¤ºåºåˆ—æ ‡æ³¨ä¿¡æ¯</span><br>        tags = [<span class="hljs-string">&#x27;O&#x27;</span>] * <span class="hljs-built_in">len</span>(event)<br><br>        <span class="hljs-keyword">for</span> time, index <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(times, indices):<br>            index = <span class="hljs-built_in">int</span>(index)<br>            tags[index] = <span class="hljs-string">&#x27;B-TIME&#x27;</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(time)):<br>                tags[index+i] = <span class="hljs-string">&#x27;I-TIME&#x27;</span><br><br>        data = [event, tags]<br><br>        self.render(<span class="hljs-string">&#x27;time_index.html&#x27;</span>, data=data)<br><br>        <span class="hljs-comment"># ä¿å­˜ä¸ºtxtæ–‡ä»¶</span><br>        dir_path = <span class="hljs-string">&#x27;./time_output&#x27;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./%s/%s.txt&#x27;</span> % (dir_path, get_max_num(dir_path)+<span class="hljs-number">1</span>), <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-keyword">for</span> char, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(event, tags):<br>                f.write(char+<span class="hljs-string">&#x27;\t&#x27;</span>+tag+<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><br><span class="hljs-comment"># ä¸»å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># å¼€å¯tornadoæœåŠ¡</span><br>    tornado.options.parse_command_line()<br>    <span class="hljs-comment"># å®šä¹‰app</span><br>    app = tornado.web.Application(<br>            handlers=[(<span class="hljs-string">r&#x27;/query&#x27;</span>, QueryHandler),<br>                      (<span class="hljs-string">r&#x27;/result&#x27;</span>, PostHandler)<br>                      ], <span class="hljs-comment">#ç½‘é¡µè·¯å¾„æ§åˆ¶</span><br>            template_path=os.path.join(os.path.dirname(__file__), <span class="hljs-string">&quot;templates&quot;</span>) <span class="hljs-comment"># æ¨¡æ¿è·¯å¾„</span><br>          )<br>    http_server = tornado.httpserver.HTTPServer(app)<br>    http_server.listen(options.port)<br>    tornado.ioloop.IOLoop.instance().start()<br><br>main()<br></code></pre></td></tr></table></figure><p>time_index.htmlæ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ—¶é—´æŠ½å–æ ‡æ³¨å¹³å°<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">mark</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">background-color</span>:<span class="hljs-number">#00ff90</span>; <span class="hljs-attribute">font-weight</span>:bold;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"><span class="hljs-selector-tag">p</span>&#123;<span class="hljs-attribute">text-indent</span>:<span class="hljs-number">2em</span>;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> click_cnt = <span class="hljs-number">0</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">// åŒå‡»ç¬¬iä¸ªselect, æ·»åŠ æ–‡å­—çš„index</span></span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">select_click</span>(<span class="hljs-params">i</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> content = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;event&#x27;</span>).<span class="hljs-property">value</span>;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> time = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;time_&#x27;</span>+i.<span class="hljs-title function_">toString</span>()).<span class="hljs-property">value</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j&lt;=content.<span class="hljs-property">length</span>-time.<span class="hljs-property">length</span>; j++)&#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span>(content.<span class="hljs-title function_">substr</span>(j, time.<span class="hljs-property">length</span>) == time)&#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> select = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;index_&#x27;</span>+i.<span class="hljs-title function_">toString</span>());</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> option = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;option&quot;</span>);</span><br><span class="language-javascript">        option.<span class="hljs-property">value</span> = j;</span><br><span class="language-javascript">        option.<span class="hljs-property">innerHTML</span> = j;</span><br><span class="language-javascript">        select.<span class="hljs-title function_">appendChild</span>(option);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// æ·»åŠ è¾“å…¥æ¡†å’Œselectæ¡†</span></span><br><span class="language-javascript">        $(<span class="hljs-variable language_">document</span>).<span class="hljs-title function_">ready</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"></span><br><span class="language-javascript">            $(<span class="hljs-string">&quot;#add_time&quot;</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">                 click_cnt = click_cnt + <span class="hljs-number">1</span>;</span><br><span class="language-javascript">                 <span class="hljs-keyword">var</span> input_id = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&#x27;time_&#x27;</span>+click_cnt.<span class="hljs-title function_">toString</span>());</span><br><span class="language-javascript">                 <span class="hljs-keyword">var</span> index_id = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&#x27;index_&#x27;</span>+click_cnt.<span class="hljs-title function_">toString</span>());</span><br><span class="language-javascript">                 <span class="hljs-keyword">var</span> content = <span class="hljs-string">&quot;&lt;input type=&#x27;text&#x27; id=&quot;</span> + input_id + <span class="hljs-string">&quot; class=&#x27;form-control&#x27; style=&#x27;width:306px;&#x27; name=&#x27;time&#x27; /&gt; \</span></span><br><span class="hljs-string"><span class="language-javascript">                     &lt;select class=&#x27;form-control&#x27; name=&#x27;index&#x27; id=&quot;</span>+ index_id + <span class="hljs-string">&quot; style=&#x27;width:120px;&#x27; \</span></span><br><span class="hljs-string"><span class="language-javascript">                 ondblclick=&#x27;select_click(&quot;</span>+click_cnt.<span class="hljs-title function_">toString</span>()+<span class="hljs-string">&quot;)&#x27;&gt;&lt;/select&gt;&quot;</span>;</span><br><span class="language-javascript">                 $(content).<span class="hljs-title function_">appendTo</span>($(<span class="hljs-string">&quot;#time_column&quot;</span>));</span><br><span class="language-javascript">            &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-horizontal&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;form&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/result&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:600px&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;event&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 control-label&quot;</span>&gt;</span>è¾“å…¥è¯­æ–™<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;event&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:490px; height:200px&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;event&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-inline&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:left;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;time_0&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-2 control-label&quot;</span>&gt;</span>æ—¶é—´<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-10&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;time_column&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;time_0&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:306px;&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;time&quot;</span> /&gt;</span><br>               <br>            <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;index_0&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;index&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:120px;&quot;</span> <span class="hljs-attr">ondblclick</span>=<span class="hljs-string">&quot;select_click(0)&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-sm-offset-2 col-sm-10&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-default&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;add_time&quot;</span>&gt;</span>æ·»åŠ æ—¶é—´<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-success&quot;</span>&gt;</span>æ˜¾ç¤ºæ ‡ç­¾<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/query&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-danger&quot;</span>&gt;</span>è¿”å›<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;reset&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-warning&quot;</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:600px&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> åŸæ–‡ï¼š&#123;&#123;data[0]&#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table table-striped&quot;</span>&gt;</span><br>&#123;% for char, tag in zip(data[0], data[1]) %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123;char&#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123;tag&#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>&#123;%end%&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="å¹³å°ä½¿ç”¨">å¹³å°ä½¿ç”¨</h3><p>è¿è¡Œä¸Šè¿°time_server.pyåï¼Œåœ¨æµè§ˆå™¨ç«¯è¾“å…¥ç½‘å€: <ahref="http://localhost:9005/query">http://localhost:9005/query</a> ,åˆ™ä¼šæ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢ï¼š</p><p><img src="/img/nlp14_2.png" /></p><p>åœ¨<code>è¾“å…¥è¯­æ–™æ¡†</code>ä¸­ï¼Œæˆ‘ä»¬è¾“å…¥è¯­æ–™ï¼š</p><blockquote><p>8æœˆ8æ—¥æ˜¯â€œå…¨æ°‘å¥èº«æ—¥â€ï¼Œæ¨å‡ºé‡ç£…å¾®è§†é¢‘ã€Šæˆ‘ä»¬è¦èµ¢çš„ï¼Œæ˜¯è‡ªå·±ã€‹ã€‚</p></blockquote><p>åœ¨æ—¶é—´è¿™ä¸ªè¾“å…¥æ¡†ä¸­ï¼Œå¯ä»¥æ ‡æ³¨è¯­æ–™ä¸­çš„æ—¶é—´ï¼ŒåŒæ—¶åŒå‡»åŒä¸€è¡Œä¸­çš„ä¸‹æ‹‰åˆ—è¡¨ï¼Œå°±èƒ½æ˜¾ç¤ºè¯¥æ ‡æ³¨æ—¶é—´åœ¨è¯­æ–™ä¸­çš„èµ·å§‹ä½ç½®ï¼Œæœ‰æ—¶å€™åŒæ ·çš„æ ‡æ³¨æ—¶é—´ä¼šåœ¨è¯­æ–™ä¸­å‡ºç°å¤šæ¬¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„æ ‡æ³¨çš„èµ·å§‹ä½ç½®å³å¯ã€‚</p><p>ç‚¹å‡»<code>æ·»åŠ æ—¶é—´</code>æŒ‰é’®ï¼Œå®ƒä¼šå¢åŠ ä¸€è¡Œæ ‡æ³¨ï¼Œå…è®¸æˆ‘ä»¬åœ¨åŒä¸€ä»½é¢„æ–™ä¸­æ ‡æ³¨å¤šä¸ªæ—¶é—´ã€‚æˆ‘ä»¬çš„ä¸€ä¸ªç®€å•çš„æ ‡æ³¨ä¾‹å­å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp14_3.png" /></p><p>ç‚¹å‡»<code>æ˜¾ç¤ºæ ‡æ³¨</code>ï¼Œåˆ™ä¼šæ˜¾ç¤ºæˆ‘ä»¬æ ‡æ³¨å®Œåå½¢æˆçš„åºåˆ—æ ‡æ³¨ä¿¡æ¯ï¼ŒåŒæ—¶å°†è¯¥åºåˆ—ä¿¡æ¯ä¿å­˜ä¸ºtxtæ–‡ä»¶ï¼Œè¯¥txtæ–‡ä»¶ä½äºtime_outputç›®å½•ä¸‹ã€‚åœ¨ç½‘é¡µä¸Šçš„åºåˆ—æ ‡æ³¨ä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp14_4.png" /></p><p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹ä¿å­˜çš„txtæ–‡æ¡£ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/img/nlp14_5.png" /></p><p>ç‚¹å‡»<code>è¿”å›</code>æŒ‰é’®ï¼Œå®ƒä¼šå…è®¸æˆ‘ä»¬è¿›è¡Œä¸‹ä¸€æ¬¡çš„æ ‡æ³¨ã€‚åˆšæ‰å±•ç¤ºçš„åªæ˜¯ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œç¨å¾®å¤æ‚çš„æ ‡æ³¨å¦‚ä¸‹å›¾ï¼š</p><p><img src="/img/nlp14_6.png" /></p><p>å®ƒå½¢æˆçš„æ ‡æ³¨åºåˆ—(éƒ¨åˆ†)å¦‚ä¸‹ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">æŒ‰<span class="hljs-built_in">O</span><br>è®¡<span class="hljs-built_in">O</span><br>åˆ’<span class="hljs-built_in">O</span><br>ï¼Œ<span class="hljs-built_in">O</span><br><span class="hljs-number">2</span><span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">0</span><span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">1</span><span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">9</span><span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>å¹´<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">8</span><span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>æœˆ<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">1</span><span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">0</span><span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>æ—¥<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>ï¼Œ<span class="hljs-built_in">O</span><br>è£<span class="hljs-built_in">O</span><br>è€€<span class="hljs-built_in">O</span><br>æ™º<span class="hljs-built_in">O</span><br>æ…§<span class="hljs-built_in">O</span><br>å±<span class="hljs-built_in">O</span><br>å°†<span class="hljs-built_in">O</span><br>åœ¨<span class="hljs-built_in">O</span><br>å<span class="hljs-built_in">O</span><br>ä¸º<span class="hljs-built_in">O</span><br>å¼€<span class="hljs-built_in">O</span><br>å‘<span class="hljs-built_in">O</span><br>è€…<span class="hljs-built_in">O</span><br>å¤§<span class="hljs-built_in">O</span><br>ä¼š<span class="hljs-built_in">O</span><br>ä¸Š<span class="hljs-built_in">O</span><br>æ­£<span class="hljs-built_in">O</span><br>å¼<span class="hljs-built_in">O</span><br>äº®<span class="hljs-built_in">O</span><br>ç›¸<span class="hljs-built_in">O</span><br>ï¼Œ<span class="hljs-built_in">O</span><br>åœ¨<span class="hljs-built_in">O</span><br><span class="hljs-number">8</span><span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>æœˆ<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br><span class="hljs-number">6</span><span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>æ—¥<span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">TIME</span><br>ï¼Œ<span class="hljs-built_in">O</span><br>è£<span class="hljs-built_in">O</span><br>è€€<span class="hljs-built_in">O</span><br>å®˜<span class="hljs-built_in">O</span><br>å¾®<span class="hljs-built_in">O</span><br>è¡¨<span class="hljs-built_in">O</span><br>ç¤º<span class="hljs-built_in">O</span><br>è¯¥<span class="hljs-built_in">O</span><br>äº§<span class="hljs-built_in">O</span><br>å“<span class="hljs-built_in">O</span><br><span class="hljs-operator">......</span><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬å¹³å°ä»…ä½œä¸ºåºåˆ—æ ‡æ³¨ç®—æ³•çš„å‰æœŸæ ‡æ³¨å·¥å…·ä½¿ç”¨ï¼Œå¹¶ä¸æ¶‰åŠå…·ä½“çš„ç®—æ³•ã€‚å¦å¤–ï¼Œåç»­è¯¥å¹³å°ä¹Ÿä¼šé™†ç»­å¼€æ”¾å‡ºæ¥ï¼Œå¦‚æœå¤§å®¶æœ‰å¥½çš„å»ºè®®ï¼Œä¹Ÿå¯ä»¥ç•™è¨€ï½</p><p>æœ¬é¡¹ç›®å·²ä¸Šä¼ åªGithub, ç½‘å€ä¸ºï¼š <ahref="https://github.com/percent4/entity_tagging_platform">https://github.com/percent4/entity_tagging_platform</a></p><blockquote><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æ ‡æ³¨å¹³å°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆåä¸‰ï¼‰ä¸­æ–‡åˆ†è¯å·¥å…·çš„ä½¿ç”¨å°è¯•</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8%E5%B0%9D%E8%AF%95/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†å¯¹ä¸‰ç§ä¸­æ–‡åˆ†è¯å·¥å…·è¿›è¡Œä½¿ç”¨å°è¯•ï¼Œè¿™ä¸‰ç§å·¥å…·åˆ†åˆ«ä¸ºå“ˆå·¥å¤§çš„LTPï¼Œç»“å·´åˆ†è¯ä»¥åŠåŒ—å¤§çš„pkusegã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆå‡†å¤‡å¥½ç¯å¢ƒï¼Œå³éœ€è¦å®‰è£…ä¸‰ä¸ªæ¨¡å—ï¼špyltp, jieba,pkusegä»¥åŠLTPçš„åˆ†è¯æ¨¡å‹æ–‡ä»¶<code>cws.model</code>ã€‚åœ¨ç”¨æˆ·å­—å…¸ä¸­æ·»åŠ ä»¥ä¸‹5ä¸ªè¯è¯­ï¼š</p><blockquote><p>ç» å°‘å®‰ è´ºå‡¤è‹± F-35æˆ˜æ–—æœº åŸƒè¾¾å°”Â·é˜¿å‹’å</p></blockquote><p>æµ‹è¯•çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> jieba<br><span class="hljs-keyword">import</span> pkuseg<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Segmentor<br><br>lexicon = [<span class="hljs-string">&#x27;ç»&#x27;</span>, <span class="hljs-string">&#x27;å°‘å®‰&#x27;</span>, <span class="hljs-string">&#x27;è´ºå‡¤è‹±&#x27;</span>, <span class="hljs-string">&#x27;F-35æˆ˜æ–—æœº&#x27;</span>, <span class="hljs-string">&#x27;åŸƒè¾¾å°”Â·é˜¿å‹’å&#x27;</span>] <span class="hljs-comment"># è‡ªå®šä¹‰è¯å…¸</span><br><br><span class="hljs-comment"># å“ˆå·¥å¤§LTPåˆ†è¯</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ltp_segment</span>(<span class="hljs-params">sent</span>):<br>    <span class="hljs-comment"># åŠ è½½æ–‡ä»¶</span><br>    cws_model_path = os.path.join(<span class="hljs-string">&#x27;data/cws.model&#x27;</span>) <span class="hljs-comment"># åˆ†è¯æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`cws.model`</span><br>    lexicon_path = os.path.join(<span class="hljs-string">&#x27;data/lexicon.txt&#x27;</span>) <span class="hljs-comment"># å‚æ•°lexiconæ˜¯è‡ªå®šä¹‰è¯å…¸çš„æ–‡ä»¶è·¯å¾„</span><br>    segmentor = Segmentor()<br>    segmentor.load_with_lexicon(cws_model_path, lexicon_path)<br>    words = <span class="hljs-built_in">list</span>(segmentor.segment(sent))<br>    segmentor.release()<br><br>    <span class="hljs-keyword">return</span> words<br><br><span class="hljs-comment"># ç»“å·´åˆ†è¯</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">jieba_cut</span>(<span class="hljs-params">sent</span>):<br>    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> lexicon:<br>        jieba.add_word(word)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(jieba.cut(sent))<br><br><span class="hljs-comment"># pkusegåˆ†è¯</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pkuseg_cut</span>(<span class="hljs-params">sent</span>):<br>    seg = pkuseg.pkuseg(user_dict=lexicon)<br>    words = seg.cut(sent)<br>    <span class="hljs-keyword">return</span> words<br><br>sent = <span class="hljs-string">&#x27;å°½ç®¡ç‰äº­æˆå®¶ä»¥åï¼Œä»–è€å©†è´ºå‡¤è‹±é‚£äº›å¹´æŠŠå°‘å®‰å¦ˆæ¬ºè´Ÿä¸Šä¸€å›åˆä¸€å›ï¼Œæ€•è€å©†çš„ç‰äº­è¿ä¸€å£°ä¹Ÿä¸æ•¢å­ï¼Œä½†å°‘å®‰ä»–å¦ˆä¸è®¡è¾ƒä»–ã€‚&#x27;</span><br><span class="hljs-comment">#sent = &#x27;æ®æ­¤å‰æŠ¥é“ï¼Œä»¥è‰²åˆ—äºå»å¹´5æœˆæˆä¸ºä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªåœ¨å®æˆ˜ä¸­ä½¿ç”¨F-35æˆ˜æ–—æœºçš„å›½å®¶ã€‚&#x27;</span><br><span class="hljs-comment">#sent = &#x27;å°èˆ¹4æœˆ8æ—¥ç»é•¿æ±Ÿå‰å¾€å°é¸Ÿå²›ã€‚&#x27;</span><br><span class="hljs-comment">#sent = &#x27;1958å¹´ï¼ŒåŸƒè¾¾å°”Â·é˜¿å‹’åå‡ºç”Ÿåœ¨åœŸè€³å…¶é¦–éƒ½å®‰å¡æ‹‰ï¼Œä½†ä»–çš„æ±‚å­¦ç”Ÿæ¶¯å¤šåœ¨ç¾å›½åº¦è¿‡ã€‚&#x27;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ltp:&#x27;</span>, ltp_segment(sent))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;jieba:&#x27;</span>, jieba_cut(sent))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;pkuseg:&#x27;</span>, pkuseg_cut(sent))<br></code></pre></td></tr></table></figure><p>&amp;emsp å¯¹äºç¬¬ä¸€å¥è¯ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>åŸæ–‡:å°½ç®¡ç‰äº­æˆå®¶ä»¥åï¼Œä»–è€å©†è´ºå‡¤è‹±é‚£äº›å¹´æŠŠå°‘å®‰å¦ˆæ¬ºè´Ÿä¸Šä¸€å›åˆä¸€å›ï¼Œæ€•è€å©†çš„ç‰äº­è¿ä¸€å£°ä¹Ÿä¸æ•¢å­ï¼Œä½†å°‘å®‰ä»–å¦ˆä¸è®¡è¾ƒä»–ã€‚</p></blockquote><blockquote><p>ltp: ['å°½ç®¡', 'ç‰äº­', 'æˆå®¶', 'ä»¥å', 'ï¼Œ', 'ä»–', 'è€å©†', 'è´ºå‡¤è‹±','é‚£äº›', 'å¹´', 'æŠŠ', 'å°‘å®‰', 'å¦ˆ', 'æ¬ºè´Ÿ', 'ä¸Š', 'ä¸€', 'å›', 'åˆ', 'ä¸€','å›', 'ï¼Œ', 'æ€•', 'è€å©†', 'çš„', 'ç‰äº­', 'è¿', 'ä¸€', 'å£°', 'ä¹Ÿ', 'ä¸','æ•¢', 'å­', 'ï¼Œ', 'ä½†', 'å°‘å®‰', 'ä»–å¦ˆ', 'ä¸', 'è®¡è¾ƒ', 'ä»–', 'ã€‚']</p></blockquote><blockquote><p>jieba: ['å°½ç®¡', 'ç‰äº­', 'æˆå®¶', 'ä»¥å', 'ï¼Œ', 'ä»–', 'è€å©†', 'è´ºå‡¤è‹±','é‚£äº›', 'å¹´', 'æŠŠ', 'å°‘å®‰', 'å¦ˆ', 'æ¬ºè´Ÿ', 'ä¸Š', 'ä¸€å›', 'åˆ', 'ä¸€å›','ï¼Œ', 'æ€•è€å©†', 'çš„', 'ç‰äº­', 'è¿', 'ä¸€å£°', 'ä¹Ÿ', 'ä¸æ•¢', 'å­', 'ï¼Œ','ä½†å°‘å®‰', 'ä»–å¦ˆ', 'ä¸', 'è®¡è¾ƒ', 'ä»–', 'ã€‚']</p></blockquote><blockquote><p>pkuseg: ['å°½ç®¡', 'ç‰äº­', 'æˆå®¶', 'ä»¥å', 'ï¼Œ', 'ä»–', 'è€å©†','è´ºå‡¤è‹±', 'é‚£äº›', 'å¹´', 'æŠŠ', 'å°‘å®‰', 'å¦ˆ', 'æ¬ºè´Ÿ', 'ä¸Š', 'ä¸€', 'å›','åˆ', 'ä¸€', 'å›', 'ï¼Œ', 'æ€•', 'è€å©†', 'çš„', 'ç‰äº­', 'è¿', 'ä¸€', 'å£°','ä¹Ÿ', 'ä¸', 'æ•¢', 'å­', 'ï¼Œ', 'ä½†', 'å°‘å®‰', 'ä»–å¦ˆ', 'ä¸', 'è®¡è¾ƒ', 'ä»–','ã€‚']</p></blockquote><p>å¯¹äºç¬¬äºŒå¥è¯ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>åŸæ–‡:æ®æ­¤å‰æŠ¥é“ï¼Œä»¥è‰²åˆ—äºå»å¹´5æœˆæˆä¸ºä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªåœ¨å®æˆ˜ä¸­ä½¿ç”¨F-35æˆ˜æ–—æœºçš„å›½å®¶ã€‚</p></blockquote><blockquote><p>ltp: ['æ®', 'æ­¤å‰', 'æŠ¥é“', 'ï¼Œ', 'ä»¥è‰²åˆ—', 'äº', 'å»å¹´', '5æœˆ','æˆä¸º', 'ä¸–ç•Œ', 'ä¸Š', 'ç¬¬ä¸€', 'ä¸ª', 'åœ¨', 'å®æˆ˜', 'ä¸­', 'ä½¿ç”¨', 'F-35','æˆ˜æ–—æœº', 'çš„', 'å›½å®¶', 'ã€‚']</p></blockquote><blockquote><p>jieba: ['æ®æ­¤', 'å‰', 'æŠ¥é“', 'ï¼Œ', 'ä»¥è‰²åˆ—', 'äº', 'å»å¹´', '5','æœˆ', 'æˆä¸º', 'ä¸–ç•Œ', 'ä¸Š', 'ç¬¬ä¸€ä¸ª', 'åœ¨', 'å®æˆ˜', 'ä¸­', 'ä½¿ç”¨', 'F','-', '35', 'æˆ˜æ–—æœº', 'çš„', 'å›½å®¶', 'ã€‚']</p></blockquote><blockquote><p>pkuseg: ['æ®', 'æ­¤å‰', 'æŠ¥é“', 'ï¼Œ', 'ä»¥è‰²åˆ—', 'äº', 'å»å¹´', '5æœˆ','æˆä¸º', 'ä¸–ç•Œ', 'ä¸Š', 'ç¬¬ä¸€', 'ä¸ª', 'åœ¨', 'å®æˆ˜', 'ä¸­', 'ä½¿ç”¨','F-35æˆ˜æ–—æœº', 'çš„', 'å›½å®¶', 'ã€‚']</p></blockquote><p>å¯¹äºç¬¬ä¸‰å¥è¯ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>åŸæ–‡: å°èˆ¹4æœˆ8æ—¥ç»é•¿æ±Ÿå‰å¾€å°é¸Ÿå²›ã€‚</p></blockquote><blockquote><p>ltp: ['å°èˆ¹', '4æœˆ', '8æ—¥', 'ç»é•¿æ±Ÿ', 'å‰å¾€', 'å°é¸Ÿå²›', 'ã€‚']</p></blockquote><blockquote><p>jieba: ['å°èˆ¹', '4', 'æœˆ', '8', 'æ—¥ç»', 'é•¿æ±Ÿ', 'å‰å¾€', 'å°', 'é¸Ÿå²›','ã€‚']</p></blockquote><blockquote><p>pkuseg: ['å°èˆ¹', '4æœˆ', '8æ—¥', 'ç»', 'é•¿æ±Ÿ', 'å‰å¾€', 'å°é¸Ÿ', 'å²›','ã€‚']</p></blockquote><p>å¯¹äºç¬¬å››å¥è¯ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>åŸæ–‡:1958å¹´ï¼ŒåŸƒè¾¾å°”Â·é˜¿å‹’åå‡ºç”Ÿåœ¨åœŸè€³å…¶é¦–éƒ½å®‰å¡æ‹‰ï¼Œä½†ä»–çš„æ±‚å­¦ç”Ÿæ¶¯å¤šåœ¨ç¾å›½åº¦è¿‡ã€‚</p></blockquote><blockquote><p>ltp: ['1958å¹´', 'ï¼Œ', 'åŸƒè¾¾å°”Â·é˜¿å‹’å', 'å‡ºç”Ÿ', 'åœ¨', 'åœŸè€³å…¶','é¦–éƒ½', 'å®‰å¡æ‹‰', 'ï¼Œ', 'ä½†', 'ä»–', 'çš„', 'æ±‚å­¦', 'ç”Ÿæ¶¯', 'å¤š', 'åœ¨','ç¾å›½', 'åº¦è¿‡', 'ã€‚']</p></blockquote><blockquote><p>jieba: ['1958', 'å¹´', 'ï¼Œ', 'åŸƒ', 'è¾¾å°”', 'Â·', 'é˜¿å‹’', 'å', 'å‡ºç”Ÿ','åœ¨', 'åœŸè€³å…¶', 'é¦–éƒ½', 'å®‰å¡æ‹‰', 'ï¼Œ', 'ä½†', 'ä»–', 'çš„', 'æ±‚å­¦','ç”Ÿæ¶¯', 'å¤š', 'åœ¨', 'ç¾å›½', 'åº¦è¿‡', 'ã€‚']</p></blockquote><blockquote><p>pkuseg: ['1958å¹´', 'ï¼Œ', 'åŸƒè¾¾å°”Â·é˜¿å‹’å', 'å‡ºç”Ÿ', 'åœ¨', 'åœŸè€³å…¶','é¦–éƒ½', 'å®‰å¡æ‹‰', 'ï¼Œ', 'ä½†', 'ä»–', 'çš„', 'æ±‚å­¦', 'ç”Ÿæ¶¯', 'å¤š', 'åœ¨','ç¾å›½', 'åº¦è¿‡', 'ã€‚']</p></blockquote><p>æ¥ç€ï¼Œå¯¹ä»¥ä¸Šçš„æµ‹è¯•æƒ…å†µåšä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼š</p><ol type="1"><li><p>ç”¨æˆ·è¯å…¸æ–¹é¢ï¼šLTPå’Œpkusegçš„æ•ˆæœéƒ½å¾ˆå¥½ï¼Œjiebaçš„è¡¨ç°ä¸å°½å¦‚äººæ„ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºè‡ªå®šä¹‰çš„å­—å…¸çš„è¯è¯­é‡Œé¢å«æœ‰æ ‡ç‚¹ç¬¦å·ï¼Œå…³äºè¯¥é—®é¢˜çš„è§£å†³åŠæ³•ï¼Œå¯ä»¥å‚è€ƒç½‘å€ï¼š<ahref="https://blog.csdn.net/weixin_42471956/article/details/80795534">https://blog.csdn.net/weixin_42471956/article/details/80795534</a></p></li><li><p>ä»ç¬¬äºŒå¥è¯çš„æ•ˆæœæ¥çœ‹ï¼Œpkusegçš„åˆ†è¯æ•ˆæœåº”è¯¥æ˜¯æœ€å¥½çš„ï¼Œâ€˜ç»â€™åº”è¯¥ä½œä¸ºå•ä¸ªçš„è¯è¯­åˆ‡åˆ†å‡ºæ¥ï¼Œè€ŒLTPå’Œjiebaå³ä½¿åŠ äº†è‡ªå®šä¹‰è¯å…¸ï¼Œä¹Ÿæ²¡æœ‰æ•ˆæœï¼ŒåŒç†ï¼Œâ€˜F-35æˆ˜æ–—æœºâ€™ä¹Ÿæ˜¯ç±»ä¼¼çš„æƒ…å½¢ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œä¸‰è€…çš„åˆ†è¯æ•ˆæœéƒ½å¾ˆä¼˜ç§€ï¼Œå·®è·ä¸æ˜¯å¾ˆå¤§ï¼Œä½†åœ¨è‡ªå®šä¹‰è¯å…¸è¿™å—ï¼Œæ— ç–‘pkusegçš„æ•ˆæœæ›´åŠ ç¨³å®šäº›ã€‚ç¬”è€…ä¹Ÿä¼šåœ¨ä»¥åçš„åˆ†è¯ä½¿ç”¨ä¸­å¤šå¤šè€ƒè™‘pkusegï½æœ‰å…³pkusegçš„ä»‹ç»ä¸ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒç½‘å€ï¼š<ahref="https://github.com/lancopku/PKUSeg-python">https://github.com/lancopku/PKUSeg-python</a></p><blockquote><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>åˆ†è¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPï¼ˆåäºŒï¼‰ä¾å­˜å¥æ³•åˆ†æçš„å¯è§†åŒ–åŠå›¾åˆ†æ</title>
    <link href="/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BE%9D%E5%AD%98%E5%8F%A5%E6%B3%95%E5%88%86%E6%9E%90%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%8F%8A%E5%9B%BE%E5%88%86%E6%9E%90/"/>
    <url>/2023/07/08/NLP%EF%BC%88%E5%8D%81%E4%BA%8C%EF%BC%89%E4%BE%9D%E5%AD%98%E5%8F%A5%E6%B3%95%E5%88%86%E6%9E%90%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%8F%8A%E5%9B%BE%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä¾å­˜å¥æ³•åˆ†æçš„æ•ˆæœè™½ç„¶æ²¡æœ‰åƒåˆ†è¯ã€NERçš„æ•ˆæœæ¥çš„å¥½ï¼Œä½†ä¹Ÿæœ‰å…¶ä½¿ç”¨ä»·å€¼ï¼Œåœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å…ä¸äº†è¦å’Œå…¶æ‰“äº¤é“ã€‚ç¬”è€…è¿™å‡ å¤©ä¸€ç›´åœ¨æƒ³å¦‚ä½•åˆ†æä¾å­˜å¥æ³•åˆ†æçš„ç»“æœï¼Œä¸€ä¸ªé‡è¦çš„æ–¹é¢ä¾¿æ˜¯å…¶å¯è§†åŒ–å’Œå®ƒçš„å›¾åˆ†æã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨çš„NLPå·¥å…·ä¸ºjiebaå’ŒLTPï¼Œå…¶ä¸­jiebaç”¨äºåˆ†è¯ï¼ŒLTPç”¨äºè¯æ€§æ ‡æ³¨å’Œå¥æ³•åˆ†æï¼Œéœ€è¦äº‹ä»¶ä¸‹è½½<code>pos.model</code>å’Œ<code>parser.model</code>æ–‡ä»¶ã€‚</p><p>æœ¬æ–‡ä½¿ç”¨çš„ç¤ºä¾‹å¥å­ä¸ºï¼š</p><blockquote><p>2018å¹´7æœˆ26æ—¥ï¼Œåä¸ºåˆ›å§‹äººä»»æ­£éå‘5GæåŒ–ç ï¼ˆPolarç ï¼‰ä¹‹çˆ¶åŸƒå°”è¾¾å°”æ•™æˆä¸¾è¡Œé¢å¥–ä»ªå¼ï¼Œè¡¨å½°å…¶å¯¹äºé€šä¿¡é¢†åŸŸåšå‡ºçš„è´¡çŒ®ã€‚</p></blockquote><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ²¡æœ‰å¯è§†åŒ–æ•ˆæœä¹‹å‰çš„å¥æ³•åˆ†æç»“æœã€‚Pythonä»£ç å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> jieba<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span>  Postagger, Parser<br><br>sent = <span class="hljs-string">&#x27;2018å¹´7æœˆ26æ—¥ï¼Œåä¸ºåˆ›å§‹äººä»»æ­£éå‘5GæåŒ–ç ï¼ˆPolarç ï¼‰ä¹‹çˆ¶åŸƒå°”è¾¾å°”æ•™æˆä¸¾è¡Œé¢å¥–ä»ªå¼ï¼Œè¡¨å½°å…¶å¯¹äºé€šä¿¡é¢†åŸŸåšå‡ºçš„è´¡çŒ®ã€‚&#x27;</span><br><br>jieba.add_word(<span class="hljs-string">&#x27;Polarç &#x27;</span>)<br>jieba.add_word(<span class="hljs-string">&#x27;5GæåŒ–ç &#x27;</span>)<br>jieba.add_word(<span class="hljs-string">&#x27;åŸƒå°”è¾¾å°”&#x27;</span>)<br>jieba.add_word(<span class="hljs-string">&#x27;ä¹‹çˆ¶&#x27;</span>)<br>words = <span class="hljs-built_in">list</span>(jieba.cut(sent))<br><br><span class="hljs-built_in">print</span>(words)<br><br><span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br>pos_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/pos.model&#x27;</span>)<br>postagger = Postagger()<br>postagger.load(pos_model_path)<br>postags = postagger.postag(words)<br><br><span class="hljs-comment"># ä¾å­˜å¥æ³•åˆ†æ</span><br>par_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/parser.model&#x27;</span>)<br>parser = Parser()<br>parser.load(par_model_path)<br>arcs = parser.parse(words, postags)<br><br>rely_id = [arc.head <span class="hljs-keyword">for</span> arc <span class="hljs-keyword">in</span> arcs]  <span class="hljs-comment"># æå–ä¾å­˜çˆ¶èŠ‚ç‚¹id</span><br>relation = [arc.relation <span class="hljs-keyword">for</span> arc <span class="hljs-keyword">in</span> arcs]  <span class="hljs-comment"># æå–ä¾å­˜å…³ç³»</span><br>heads = [<span class="hljs-string">&#x27;Root&#x27;</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">id</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> words[<span class="hljs-built_in">id</span>-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> <span class="hljs-built_in">id</span> <span class="hljs-keyword">in</span> rely_id]  <span class="hljs-comment"># åŒ¹é…ä¾å­˜çˆ¶èŠ‚ç‚¹è¯è¯­</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(words)):<br>    <span class="hljs-built_in">print</span>(relation[i] + <span class="hljs-string">&#x27;(&#x27;</span> + words[i] + <span class="hljs-string">&#x27;, &#x27;</span> + heads[i] + <span class="hljs-string">&#x27;)&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;2018&#x27;</span>, <span class="hljs-string">&#x27;å¹´&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;æœˆ&#x27;</span>, <span class="hljs-string">&#x27;26&#x27;</span>, <span class="hljs-string">&#x27;æ—¥&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;åä¸º&#x27;</span>, <span class="hljs-string">&#x27;åˆ›å§‹äºº&#x27;</span>, <span class="hljs-string">&#x27;ä»»æ­£é&#x27;</span>, <span class="hljs-string">&#x27;å‘&#x27;</span>, <span class="hljs-string">&#x27;5GæåŒ–ç &#x27;</span>, <span class="hljs-string">&#x27;ï¼ˆ&#x27;</span>, <span class="hljs-string">&#x27;Polarç &#x27;</span>, <span class="hljs-string">&#x27;ï¼‰&#x27;</span>, <span class="hljs-string">&#x27;ä¹‹çˆ¶&#x27;</span>, <span class="hljs-string">&#x27;åŸƒå°”è¾¾å°”&#x27;</span>, <span class="hljs-string">&#x27;æ•™æˆ&#x27;</span>, <span class="hljs-string">&#x27;ä¸¾è¡Œ&#x27;</span>, <span class="hljs-string">&#x27;é¢å¥–ä»ªå¼&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;è¡¨å½°&#x27;</span>, <span class="hljs-string">&#x27;å…¶&#x27;</span>, <span class="hljs-string">&#x27;å¯¹äº&#x27;</span>, <span class="hljs-string">&#x27;é€šä¿¡&#x27;</span>, <span class="hljs-string">&#x27;é¢†åŸŸ&#x27;</span>, <span class="hljs-string">&#x27;åšå‡º&#x27;</span>, <span class="hljs-string">&#x27;çš„&#x27;</span>, <span class="hljs-string">&#x27;è´¡çŒ®&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>]</span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(<span class="hljs-number">2018</span>, å¹´)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(å¹´, æ—¥)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(<span class="hljs-number">7</span>, æœˆ)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(æœˆ, æ—¥)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(<span class="hljs-number">26</span>, æ—¥)</span></span><br><span class="hljs-function"><span class="hljs-title">ADV</span><span class="hljs-params">(æ—¥, ä¸¾è¡Œ)</span></span><br><span class="hljs-function"><span class="hljs-title">WP</span><span class="hljs-params">(ï¼Œ, æ—¥)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(åä¸º, åˆ›å§‹äºº)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(åˆ›å§‹äºº, ä»»æ­£é)</span></span><br><span class="hljs-function"><span class="hljs-title">SBV</span><span class="hljs-params">(ä»»æ­£é, ä¸¾è¡Œ)</span></span><br><span class="hljs-function"><span class="hljs-title">ADV</span><span class="hljs-params">(å‘, ä¸¾è¡Œ)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(<span class="hljs-number">5</span>GæåŒ–ç , ä¹‹çˆ¶)</span></span><br><span class="hljs-function"><span class="hljs-title">WP</span><span class="hljs-params">(ï¼ˆ, Polarç )</span></span><br><span class="hljs-function"><span class="hljs-title">COO</span><span class="hljs-params">(Polarç , <span class="hljs-number">5</span>GæåŒ–ç )</span></span><br><span class="hljs-function"><span class="hljs-title">WP</span><span class="hljs-params">(ï¼‰, Polarç )</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(ä¹‹çˆ¶, åŸƒå°”è¾¾å°”)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(åŸƒå°”è¾¾å°”, æ•™æˆ)</span></span><br><span class="hljs-function"><span class="hljs-title">POB</span><span class="hljs-params">(æ•™æˆ, å‘)</span></span><br><span class="hljs-function"><span class="hljs-title">HED</span><span class="hljs-params">(ä¸¾è¡Œ, Root)</span></span><br><span class="hljs-function"><span class="hljs-title">VOB</span><span class="hljs-params">(é¢å¥–ä»ªå¼, ä¸¾è¡Œ)</span></span><br><span class="hljs-function"><span class="hljs-title">WP</span><span class="hljs-params">(ï¼Œ, ä¸¾è¡Œ)</span></span><br><span class="hljs-function"><span class="hljs-title">COO</span><span class="hljs-params">(è¡¨å½°, ä¸¾è¡Œ)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(å…¶, è´¡çŒ®)</span></span><br><span class="hljs-function"><span class="hljs-title">ADV</span><span class="hljs-params">(å¯¹äº, åšå‡º)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(é€šä¿¡, é¢†åŸŸ)</span></span><br><span class="hljs-function"><span class="hljs-title">POB</span><span class="hljs-params">(é¢†åŸŸ, å¯¹äº)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(åšå‡º, è´¡çŒ®)</span></span><br><span class="hljs-function"><span class="hljs-title">RAD</span><span class="hljs-params">(çš„, åšå‡º)</span></span><br><span class="hljs-function"><span class="hljs-title">VOB</span><span class="hljs-params">(è´¡çŒ®, è¡¨å½°)</span></span><br><span class="hljs-function"><span class="hljs-title">WP</span><span class="hljs-params">(ã€‚, ä¸¾è¡Œ)</span></span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾—åˆ°äº†è¯¥å¥å­çš„ä¾å­˜å¥æ³•åˆ†æçš„ç»“æœï¼Œä½†æ˜¯å…¶å¯è§†åŒ–æ•ˆæœå´ä¸å¥½ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨Graphvizå·¥å…·æ¥å¾—åˆ°ä¸Šè¿°ä¾å­˜å¥æ³•åˆ†æçš„å¯è§†åŒ–ç»“æœï¼Œä»£ç ï¼ˆæ¥ä¸Šè¿°ä»£ç ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> graphviz <span class="hljs-keyword">import</span> Digraph<br><br>g = Digraph(<span class="hljs-string">&#x27;æµ‹è¯•å›¾ç‰‡&#x27;</span>)<br><br>g.node(name=<span class="hljs-string">&#x27;Root&#x27;</span>)<br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:<br>    g.node(name=word)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(words)):<br>    <span class="hljs-keyword">if</span> relation[i] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;HED&#x27;</span>]:<br>        g.edge(words[i], heads[i], label=relation[i])<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> heads[i] == <span class="hljs-string">&#x27;Root&#x27;</span>:<br>            g.edge(words[i], <span class="hljs-string">&#x27;Root&#x27;</span>, label=relation[i])<br>        <span class="hljs-keyword">else</span>:<br>            g.edge(heads[i], <span class="hljs-string">&#x27;Root&#x27;</span>, label=relation[i])<br><br>g.view()<br></code></pre></td></tr></table></figure><p>å¾—åˆ°çš„ä¾å­˜å¥æ³•åˆ†æçš„å¯è§†åŒ–å›¾ç‰‡å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp12_1.png" /></p><p>åœ¨è¿™å¼ å›¾ç‰‡ä¸­ï¼Œæˆ‘ä»¬æœ‰äº†å¯¹ä¾å­˜å¥æ³•åˆ†æç»“æœçš„ç›´è§‚æ„Ÿè§‰ï¼Œæ•ˆæœä¹Ÿéå¸¸å¥½ï¼Œä½†æ˜¯é—æ†¾çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½å¯¹ä¸Šè¿°å¯è§†åŒ–ç»“æœå½¢æˆçš„å›¾ï¼ˆGraphï¼‰è¿›è¡Œå›¾åˆ†æï¼Œå› ä¸ºGraphvizä»…ä»…åªæ˜¯ä¸€ä¸ªå¯è§†åŒ–å·¥å…·ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥ç”¨ä»€ä¹ˆæ ·çš„å·¥å…·æ¥è¿›è¡Œå›¾åˆ†æå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯NetworkXã€‚ä»¥ä¸‹æ˜¯ç¬”è€…å¯¹äºNetworkXåº”ç”¨äºä¾å­˜å¥æ³•åˆ†æçš„å¯è§†åŒ–å’Œå›¾åˆ†æçš„å±•ç¤ºï¼Œå…¶ä¸­å›¾åˆ†æå±•ç¤ºäº†ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚ç¤ºä¾‹çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆ©ç”¨networkxç»˜åˆ¶å¥æ³•åˆ†æç»“æœ</span><br><span class="hljs-keyword">import</span> networkx <span class="hljs-keyword">as</span> nx<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> pylab <span class="hljs-keyword">import</span> mpl<br><br>mpl.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;Arial Unicode MS&#x27;</span>]  <span class="hljs-comment"># æŒ‡å®šé»˜è®¤å­—ä½“</span><br><br><br>G = nx.Graph()  <span class="hljs-comment"># å»ºç«‹æ— å‘å›¾G</span><br><br><span class="hljs-comment"># æ·»åŠ èŠ‚ç‚¹</span><br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:<br>    G.add_node(word)<br><br>G.add_node(<span class="hljs-string">&#x27;Root&#x27;</span>)<br><br><span class="hljs-comment"># æ·»åŠ è¾¹</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(words)):<br>    G.add_edge(words[i], heads[i])<br><br>source = <span class="hljs-string">&#x27;5GæåŒ–ç &#x27;</span><br>target1 = <span class="hljs-string">&#x27;ä»»æ­£é&#x27;</span><br>distance1 = nx.shortest_path_length(G, source=source, target=target1)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#x27;%s&#x27;ä¸&#x27;%s&#x27;åœ¨ä¾å­˜å¥æ³•åˆ†æå›¾ä¸­çš„æœ€çŸ­è·ç¦»ä¸º:  %s&quot;</span> % (source, target1, distance1))<br><br>target2 = <span class="hljs-string">&#x27;åŸƒå°”è¾¾å°”&#x27;</span><br>distance2 = nx.shortest_path_length(G, source=source, target=target2)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#x27;%s&#x27;ä¸&#x27;%s&#x27;åœ¨ä¾å­˜å¥æ³•åˆ†æå›¾ä¸­çš„æœ€çŸ­è·ç¦»ä¸º:  %s&quot;</span> % (source, target2, distance2))<br><br>nx.draw(G, with_labels=<span class="hljs-literal">True</span>)<br>plt.savefig(<span class="hljs-string">&quot;undirected_graph.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>å¾—åˆ°çš„å¯è§†åŒ–å›¾ç‰‡å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp12_2.png" /></p><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scheme"><span class="hljs-symbol">&#x27;5GæåŒ–ç </span><span class="hljs-symbol">&#x27;ä¸</span><span class="hljs-symbol">&#x27;ä»»æ­£é</span><span class="hljs-symbol">&#x27;åœ¨ä¾å­˜å¥æ³•åˆ†æå›¾ä¸­çš„æœ€çŸ­è·ç¦»ä¸º:</span>  <span class="hljs-number">6</span><br><span class="hljs-symbol">&#x27;5GæåŒ–ç </span><span class="hljs-symbol">&#x27;ä¸</span><span class="hljs-symbol">&#x27;åŸƒå°”è¾¾å°”</span><span class="hljs-symbol">&#x27;åœ¨ä¾å­˜å¥æ³•åˆ†æå›¾ä¸­çš„æœ€çŸ­è·ç¦»ä¸º:</span>  <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>æœ¬æ¬¡åˆ°æ­¤ç»“æŸï¼Œå¸Œæœ›è¿™ç¯‡ç®€çŸ­çš„æ–‡ç« èƒ½å¤Ÿç»™è¯»è€…å¸¦æ¥ä¸€äº›å¯å‘ï½</p><blockquote><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>ä¾å­˜å¥æ³•åˆ†æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆåä¸€ï¼‰ä»æ–‡æœ¬ä¸­æå–æ—¶é—´</title>
    <link href="/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E4%BB%8E%E6%96%87%E6%9C%AC%E4%B8%AD%E6%8F%90%E5%8F%96%E6%97%B6%E9%97%B4/"/>
    <url>/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E4%BB%8E%E6%96%87%E6%9C%AC%E4%B8%AD%E6%8F%90%E5%8F%96%E6%97%B6%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»å’Œå·¥ä½œä¸­ï¼Œä»æ–‡æœ¬ä¸­æå–æ—¶é—´æ˜¯ä¸€é¡¹éå¸¸åŸºç¡€å´é‡è¦çš„å·¥ä½œï¼Œå› æ­¤ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä»æ–‡æœ¬ä¸­æœ‰æ•ˆåœ°æå–æ—¶é—´ã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦ä»ä¸‹é¢çš„æ–‡æœ¬ä¸­æå–æ—¶é—´ï¼š</p><blockquote><p>6æœˆ28æ—¥ï¼Œæ­å·å¸‚ç»Ÿè®¡å±€æƒå¨å…¬å¸ƒã€Š2019å¹´5æœˆæœˆæŠ¥ã€‹ï¼Œæ­å·å¸‚åŒ»ä¿å‚ä¿äººæ•°è¾¾åˆ°1006ä¸‡ï¼Œç›¸æ¯”äº2æœˆä»½çš„989ä¸‡ï¼Œä¸‰ä¸ªæœˆæš´æ¶¨16ä¸‡äººå‚ä¿ï¼Œå‚²è§†æ–°ä¸€çº¿åŸå¸‚ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥ä»æ–‡æœ¬æœ‰æå–<code>6æœˆ28æ—¥</code>ï¼Œ<code>2019å¹´5æœˆ</code>ï¼Œ<code>2æœˆä»½</code>è¿™ä¸‰ä¸ªæœ‰æ•ˆæ—¶é—´ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè¾ƒå¥½çš„è§£å†³æ€è·¯æ˜¯åˆ©ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹æ¥è¯†åˆ«æ–‡æœ¬ä¸­çš„æ—¶é—´ï¼Œé€šè¿‡ä¸€å®šæ•°é‡çš„æ ‡è®°æ–‡æœ¬å’Œåˆé€‚çš„æ¨¡å‹ã€‚æœ¬æ–‡å°è¯•åˆ©ç”¨ç°æœ‰çš„NLPå·¥å…·æ¥è§£å†³å¦‚ä½•ä»æ–‡æœ¬ä¸­æå–æ—¶é—´ã€‚</p><p>æœ¬æ–‡ä½¿ç”¨çš„å·¥å…·ä¸ºå“ˆå·¥å¤§çš„pyltpï¼Œå¯ä»¥åœ¨Pythonçš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¸­æ‰¾åˆ°ï¼Œå®ç°ä¸‹è½½å¥½åˆ†è¯æ¨¡å‹<code>cws.model</code>å’Œè¯æ€§æ ‡æ³¨<code>pos.model</code>è¿™ä¸¤ä¸ªæ¨¡å‹æ–‡ä»¶ã€‚</p><p>è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥ä¸ŠPythonä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Segmentor<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Postagger<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LTP</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        cws_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;cws.model&#x27;</span>)  <span class="hljs-comment"># åˆ†è¯æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`cws.model`</span><br>        pos_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;pos.model&#x27;</span>)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`pos.model`</span><br>        self.segmentor = Segmentor()  <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>        self.segmentor.load(cws_model_path) <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>        self.postagger = Postagger()  <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>        self.postagger.load(pos_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br><br>    <span class="hljs-comment"># åˆ†è¯</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">segment</span>(<span class="hljs-params">self, text</span>):<br>        words = <span class="hljs-built_in">list</span>(self.segmentor.segment(text))<br>        <span class="hljs-keyword">return</span> words<br><br>    <span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">postag</span>(<span class="hljs-params">self, words</span>):<br>        postags = <span class="hljs-built_in">list</span>(self.postagger.postag(words))<br>        <span class="hljs-keyword">return</span> postags<br><br>    <span class="hljs-comment"># è·å–æ–‡æœ¬ä¸­çš„æ—¶é—´</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_time</span>(<span class="hljs-params">self, text</span>):<br><br>        <span class="hljs-comment"># å¼€å§‹åˆ†è¯åŠè¯æ€§æ ‡æ³¨</span><br>        words = self.segment(text)<br>        postags = self.postag(words)<br><br>        time_lst = []<br><br>        i = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> tag, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(postags, words):<br>            <span class="hljs-keyword">if</span> tag == <span class="hljs-string">&#x27;nt&#x27;</span>:<br>                j = i<br>                <span class="hljs-keyword">while</span> postags[j] == <span class="hljs-string">&#x27;nt&#x27;</span> <span class="hljs-keyword">or</span> words[j] <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;è‡³&#x27;</span>, <span class="hljs-string">&#x27;åˆ°&#x27;</span>]:<br>                    j += <span class="hljs-number">1</span><br>                time_lst.append(<span class="hljs-string">&#x27;&#x27;</span>.join(words[i:j]))<br>            i += <span class="hljs-number">1</span><br><br>        <span class="hljs-comment"># å»é‡å­å­—ç¬¦ä¸²çš„æƒ…å½¢</span><br>        remove_lst = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> time_lst:<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> time_lst:<br>                <span class="hljs-keyword">if</span> i != j <span class="hljs-keyword">and</span> i <span class="hljs-keyword">in</span> j:<br>                    remove_lst.append(i)<br><br>        text_time_lst = []<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> time_lst:<br>            <span class="hljs-keyword">if</span> item <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> remove_lst:<br>                text_time_lst.append(item)<br><br>        <span class="hljs-comment"># print(text_time_lst)</span><br>        <span class="hljs-keyword">return</span> text_time_lst<br><br>    <span class="hljs-comment"># é‡Šæ”¾æ¨¡å‹</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">free_ltp</span>(<span class="hljs-params">self</span>):<br>        self.segmentor.release()<br>        self.postagger.release()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    ltp = LTP()<br><br>    <span class="hljs-comment"># è¾“å…¥æ–‡æœ¬</span><br>    sent = <span class="hljs-string">&#x27;6æœˆ28æ—¥ï¼Œæ­å·å¸‚ç»Ÿè®¡å±€æƒå¨å…¬å¸ƒã€Š2019å¹´5æœˆæœˆæŠ¥ã€‹ï¼Œæ­å·å¸‚åŒ»ä¿å‚ä¿äººæ•°è¾¾åˆ°1006ä¸‡ï¼Œç›¸æ¯”äº2æœˆä»½çš„989ä¸‡ï¼Œä¸‰ä¸ªæœˆæš´æ¶¨16ä¸‡äººå‚ä¿ï¼Œå‚²è§†æ–°ä¸€çº¿åŸå¸‚ã€‚&#x27;</span><br>    time_lst = ltp.get_time(sent)<br>    ltp.free_ltp()<br><br>    <span class="hljs-comment"># è¾“å‡ºæ–‡æœ¬ä¸­æå–çš„æ—¶é—´</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æå–æ—¶é—´ï¼š %s&#x27;</span> % <span class="hljs-built_in">str</span>(time_lst))<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬æµ‹è¯•å‡ ä¸ªä¾‹å­ã€‚</p><p>è¾“å…¥æ–‡æœ¬ä¸ºï¼š</p><blockquote><p>ä»Šå¤©ï¼Œå¤®è¡Œä¸¾è¡Œäº†2019å¹´6æœˆä»½é‡‘èç»Ÿè®¡æ•°æ®è§£è¯»å¹é£ä¼šï¼Œå‘å¸ƒäº†2019å¹´6æœˆä»½é‡‘èç»Ÿè®¡æ•°æ®å¹¶å°±å½“å‰çš„ä¸€äº›çƒ­ç‚¹é—®é¢˜è¿›è¡Œäº†è§£è¯»å’Œå›åº”ã€‚</p></blockquote><p>æ–‡æœ¬ä¸­æå–çš„æ—¶é—´ä¸ºï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">æå–æ—¶é—´ï¼š [&#x27;ä»Šå¤©&#x27;, &#x27;<span class="hljs-number">2019</span>å¹´6æœˆä»½&#x27;, &#x27;<span class="hljs-number">2019</span>å¹´6æœˆä»½&#x27;, &#x27;å½“å‰&#x27;]<br></code></pre></td></tr></table></figure><p>è¾“å…¥æ–‡æœ¬ä¸ºï¼š</p><blockquote><p>2006å¹´ï¼Œä¸Šæµ·çš„å›½å†…ç”Ÿäº§æ€»å€¼è¾¾åˆ°10296.97äº¿å…ƒï¼Œæ˜¯ä¸­å›½å†…åœ°ç¬¬ä¸€ä¸ªGDPçªç ´ä¸‡äº¿å…ƒçš„åŸå¸‚ã€‚2008å¹´ï¼ŒåŒ—äº¬GDPç ´ä¸‡äº¿ã€‚ä¸¤å¹´åï¼Œå¹¿å·GDPè¶…è¿‡ä¸‡äº¿ã€‚2011å¹´ï¼Œæ·±åœ³ã€å¤©æ´¥ã€è‹å·ã€é‡åº†4åŸçš„GDPä¹Ÿè¿›å…¥äº†ä¸‡äº¿è¡Œåˆ—ã€‚æ­¦æ±‰ã€æˆéƒ½åœ¨2014å¹´è·»èº«â€œä¸‡äº¿ä¿±ä¹éƒ¨â€ï¼Œæ­å·ã€å—äº¬å’Œé’å²›ã€æ— é”¡å’Œé•¿æ²™çš„GDPä¾æ¬¡åœ¨2015å¹´ã€2016å¹´å’Œ2017å¹´è¿‡ä¸‡äº¿ã€‚å®æ³¢å’Œéƒ‘å·åˆ™æˆä¸º2018å¹´ä¸‡äº¿ä¿±ä¹éƒ¨çš„æ–°æˆå‘˜ã€‚</p></blockquote><p>æ–‡æœ¬ä¸­æå–çš„æ—¶é—´ä¸ºï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">æå–æ—¶é—´ï¼š [&#x27;<span class="hljs-number">2006</span>å¹´&#x27;, &#x27;<span class="hljs-number">2008</span>å¹´&#x27;, &#x27;<span class="hljs-number">2011</span>å¹´&#x27;, &#x27;<span class="hljs-number">2014</span>å¹´&#x27;, &#x27;<span class="hljs-number">2015</span>å¹´&#x27;, &#x27;<span class="hljs-number">2016</span>å¹´&#x27;, &#x27;<span class="hljs-number">2018</span>å¹´&#x27;]<br></code></pre></td></tr></table></figure><p>è¾“å…¥æ–‡æœ¬ä¸ºï¼š</p><blockquote><p>æ­¤åï¼Œ6æœˆ28æ—¥ã€7æœˆ9æ—¥å’Œ7æœˆ11æ—¥ä¸‹åˆï¼Œæ­¦å¨å¸‚æ”¿åã€å¸‚äººå¤§ã€å¸‚æ”¿åºœåˆ†åˆ«å¬å¼€åšå†³å…¨é¢å½»åº•è‚ƒæ¸…ç«è£è´µæµæ¯’å’Œå½±å“ä¸“é¢˜æ°‘ä¸»ç”Ÿæ´»ä¼šã€‚</p></blockquote><p>æ–‡æœ¬ä¸­æå–çš„æ—¶é—´ä¸ºï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">æå–æ—¶é—´ï¼š <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;æ­¤å&#x27;</span>, <span class="hljs-string">&#x27;6æœˆ28æ—¥&#x27;</span>, <span class="hljs-string">&#x27;7æœˆ9æ—¥&#x27;</span>, <span class="hljs-string">&#x27;7æœˆ11æ—¥ä¸‹åˆ&#x27;</span>]</span><br></code></pre></td></tr></table></figure><p>è¾“å…¥æ–‡æœ¬ä¸ºï¼š</p><blockquote><p>å§œä¿çº¢å‡ºç”Ÿäº1974å¹´4æœˆï¼Œå¥¹äº2016å¹´11æœˆè‡³2018å¹´9æœˆä»»æ­¦å¨å¸‚å‰¯å¸‚é•¿ï¼Œå±¥æ–°æ—¶ï¼Œæ­¦å¨å¸‚çš„ä¸€æŠŠæ‰‹æ­£æ˜¯ç«è£è´µã€‚</p></blockquote><p>æ–‡æœ¬ä¸­æå–çš„æ—¶é—´ä¸ºï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">æå–æ—¶é—´ï¼š [&#x27;<span class="hljs-number">1974</span>å¹´4æœˆ&#x27;, &#x27;<span class="hljs-number">2016</span>å¹´11æœˆè‡³<span class="hljs-number">2018</span>å¹´9æœˆ&#x27;]<br></code></pre></td></tr></table></figure><p>æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p><blockquote><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BERTçš„å‡ ä¸ªå¯èƒ½çš„åº”ç”¨</title>
    <link href="/2023/07/08/BERT%E7%9A%84%E5%87%A0%E4%B8%AA%E5%8F%AF%E8%83%BD%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    <url>/2023/07/08/BERT%E7%9A%84%E5%87%A0%E4%B8%AA%E5%8F%AF%E8%83%BD%E7%9A%84%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>BERTæ˜¯è°·æ­Œå…¬å¸äº2018å¹´11æœˆå‘å¸ƒçš„ä¸€æ¬¾æ–°æ¨¡å‹ï¼Œå®ƒä¸€ç§é¢„è®­ç»ƒè¯­è¨€è¡¨ç¤ºçš„æ–¹æ³•ï¼Œåœ¨å¤§é‡æ–‡æœ¬è¯­æ–™ï¼ˆç»´åŸºç™¾ç§‘ï¼‰ä¸Šè®­ç»ƒäº†ä¸€ä¸ªé€šç”¨çš„â€œè¯­è¨€ç†è§£â€æ¨¡å‹ï¼Œç„¶åç”¨è¿™ä¸ªæ¨¡å‹å»æ‰§è¡Œæƒ³åšçš„NLPä»»åŠ¡ã€‚ä¸€ç»å…¬å¸ƒï¼Œå®ƒä¾¿å¼•çˆ†äº†æ•´ä¸ªNLPç•Œï¼Œå…¶åœ¨11ä¸ªä¸»æµNLPä»»åŠ¡ä¸­éƒ½å–å¾—ä¼˜å¼‚çš„ç»“æœï¼Œå› æ­¤æˆä¸ºNLPé¢†åŸŸæœ€å¸å¼•äººçš„ä¸€ä¸ªæ¨¡å‹ã€‚ç®€å•æ¥è¯´ï¼ŒBERTå°±æ˜¯åœ¨è®­ç»ƒäº†å¤§é‡çš„æ–‡æœ¬è¯­æ–™ï¼ˆæ— ç›‘ç£ï¼‰ä¹‹åï¼Œèƒ½å¤Ÿåœ¨å¯¹è‹±è¯­ä¸­çš„å•è¯ï¼ˆæˆ–ä¸­æ–‡çš„æ±‰å­—ï¼‰ç»™å‡ºä¸€ä¸ªå‘é‡è¡¨ç¤ºï¼Œä½¿å¾—è¯¥å•è¯ï¼ˆæˆ–æ±‰å­—ï¼‰å…·æœ‰ä¸€å®šçš„è¯­ä¹‰è¡¨ç¤ºèƒ½åŠ›ï¼Œå› æ­¤ï¼ŒBERTå…·æœ‰ä¸€å®šçš„å…ˆéªŒçŸ¥è¯†ï¼Œåœ¨NLPä»»åŠ¡ä¸­è¡¨ç°ååˆ†æŠ¢çœ¼ã€‚</p><p>åœ¨æ–‡ç« <a href="https://blog.csdn.net/Vancl_Wang/article/details/90349047">åˆ©ç”¨bert-serving-serveræ­å»ºbertè¯å‘é‡æœåŠ¡(ä¸€)</a> ä¸­ï¼Œä½œè€…ç®€æ´æ˜äº†åœ°ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨bert-serving-serveræ¥è·å–ä¸­æ–‡æ±‰å­—çš„è¯å‘é‡ï¼Œè¿™å¤§å¤§é™ä½äº†ä¸€èˆ¬ä»ä¸šè€…ä½¿ç”¨BERTçš„é—¨æ§›ã€‚</p><p>ç»“åˆç¬”è€…è¿™æ®µæ—¶é—´çš„å·¥ä½œä½“ä¼šä»¥åŠæ€è€ƒï¼Œç¬”è€…å°è¯•ç€ç»™å‡ºBERTçš„å‡ ä¸ªå¯èƒ½çš„åº”ç”¨ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>NLPåŸºæœ¬ä»»åŠ¡</li><li>æŸ¥æ‰¾ç›¸ä¼¼è¯è¯­</li><li>æå–æ–‡æœ¬ä¸­çš„å®ä½“</li><li>é—®ç­”ä¸­çš„å®ä½“å¯¹é½</li></ul><p>ç”±äºç¬”è€…æ‰ç–å­¦æµ…ä¸”æ’°å†™æ–‡ç« æ—¶é—´ä»“ä¿ƒï¼Œæ–‡ç« ä¸­æœ‰ä¸è¶³ä¹‹å¤„ï¼Œè¯·è¯»è€…å¤šå¤šæ‰¹è¯„æŒ‡æ­£ï¼</p><h3 id="NLPåŸºæœ¬ä»»åŠ¡">NLPåŸºæœ¬ä»»åŠ¡</h3><p>BERTå…¬å¸ƒå·²ç»åŠå¹´å¤šäº†ï¼Œç°åœ¨å·²ç»æˆä¸ºNLPä¸­çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­å¿…ä¸å¯å°‘çš„å·¥å…·ï¼Œä¸€èˆ¬ä¼šåŠ è½½åœ¨æ¨¡å‹ä¸­çš„Embeddingå±‚ã€‚ç”±äºç¯‡å¹…åŸå› ï¼Œç¬”è€…ä¸å†ä»‹ç»è‡ªå·±çš„BERTé¡¹ç›®ï¼Œè€Œæ˜¯ä»‹ç»å‡ ä¸ªBERTåœ¨åŸºæœ¬ä»»åŠ¡ä¸­çš„Githubé¡¹ç›®ï¼š</p><ul><li>è‹±è¯­æ–‡æœ¬åˆ†ç±»ï¼š  <strong><a href="https://github.com/Socialbird-AILab/BERT-Classification-Tutorial">BERT-Classification-Tutorial</a></strong></li><li>ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»ï¼š <strong><a href="https://github.com/renxingkai/BERT_Chinese_Classification">BERT_Chinese_Classification</a></strong></li><li>ä¸­æ–‡å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰:  <strong><a href="https://github.com/yumath/bertNER">bertNER</a></strong></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼ŒBERTå·²ç»å¹¿æ³›åº”ç”¨äºNLPåŸºæœ¬ä»»åŠ¡ä¸­ï¼Œåœ¨å¼€æºé¡¹ç›®ä¸­å¯¼å‡ºå¯ä»¥è§åˆ°å®ƒçš„èº«å½±ï¼Œå¹¶ä¸”è¿™äº›é¡¹ç›®çš„ä½œè€…ä¹Ÿå†™äº†éå¸¸ç»†è‡´çš„ä»£ç å·¥ç¨‹ï¼Œä¾¿äºä¸Šæ‰‹ã€‚</p><p>åœ¨å…·ä½“è®²è¿°ä¸‹é¢çš„ä¸‰ä¸ªåº”ç”¨å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹BERTåº”ç”¨çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190607111211990.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2pjbGlhbjkx,size_16,color_FFFFFF,t_70" alt=""></p><p>å…¶ä¸­ï¼Œbert_client_lmj.pyä¸ºè°ƒç”¨BERTè¯å‘é‡æœåŠ¡ï¼Œå…·ä½“å¯å‚è€ƒæ–‡ç« <a href="https://blog.csdn.net/Vancl_Wang/article/details/90349047">åˆ©ç”¨bert-serving-serveræ­å»ºbertè¯å‘é‡æœåŠ¡(ä¸€)</a> ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><span class="hljs-keyword">from</span> bert_serving.client <span class="hljs-keyword">import</span> BertClient<br><span class="hljs-keyword">from</span> sklearn.metrics.pairwise <span class="hljs-keyword">import</span> cosine_similarity<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Encoding</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.server_ip = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>        self.bert_client = BertClient(ip=self.server_ip)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params">self, query</span>):<br>        tensor = self.bert_client.encode([query])<br>        <span class="hljs-keyword">return</span> tensor<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query_similarity</span>(<span class="hljs-params">self, query_list</span>):<br>        tensors = self.bert_client.encode(query_list)<br>        <span class="hljs-keyword">return</span> cosine_similarity(tensors)[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    ec = Encoding()<br>    <span class="hljs-built_in">print</span>(ec.encode(<span class="hljs-string">&quot;ä¸­å›½&quot;</span>).shape)<br>    <span class="hljs-built_in">print</span>(ec.encode(<span class="hljs-string">&quot;ç¾å›½&quot;</span>).shape)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸­å›½å’Œç¾å›½çš„å‘é‡ç›¸ä¼¼åº¦:&quot;</span>, ec.query_similarity([<span class="hljs-string">&quot;ä¸­å›½&quot;</span>, <span class="hljs-string">&quot;ç¾å›½&quot;</span>]))<br></code></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾ç›¸ä¼¼è¯è¯­">æŸ¥æ‰¾ç›¸ä¼¼è¯è¯­</h3><p>åˆ©ç”¨è¯å‘é‡å¯ä»¥æŸ¥æ‰¾æ–‡ç« ä¸­ä¸æŒ‡å®šè¯è¯­æœ€ç›¸è¿‘çš„å‡ ä¸ªè¯è¯­ã€‚å…·ä½“çš„åšæ³•ä¸ºï¼šç°å°†æ–‡ç« åˆ†è¯ï¼Œå¯¹åˆ†è¯åçš„æ¯ä¸ªè¯ï¼ŒæŸ¥è¯¢å…¶ä¸æŒ‡å®šè¯è¯­çš„ç›¸ä¼¼åº¦ï¼Œæœ€åæŒ‰ç›¸ä¼¼åº¦è¾“å‡ºè¯è¯­å³å¯ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹æ–‡ç« ä¸ºè€èˆçš„ã€Šå…»èŠ±ã€‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><blockquote><p>æˆ‘çˆ±èŠ±ï¼Œæ‰€ä»¥ä¹Ÿçˆ±å…»èŠ±ã€‚æˆ‘å¯è¿˜æ²¡æˆä¸ºå…»èŠ±ä¸“å®¶ï¼Œå› ä¸ºæ²¡æœ‰å·¥å¤«å»ç ”ç©¶å’Œè¯•éªŒã€‚æˆ‘åªæŠŠå…»èŠ±å½“åšç”Ÿæ´»ä¸­çš„ä¸€ç§ä¹è¶£ï¼ŒèŠ±å¼€å¾—å¤§å°å¥½åéƒ½ä¸è®¡è¾ƒï¼Œåªè¦å¼€èŠ±ï¼Œæˆ‘å°±é«˜å…´ã€‚åœ¨æˆ‘çš„å°é™¢å­é‡Œï¼Œä¸€åˆ°å¤å¤©æ»¡æ˜¯èŠ±è‰ï¼Œå°çŒ«åªå¥½ä¸Šæˆ¿å»ç©ï¼Œåœ°ä¸Šæ²¡æœ‰å®ƒä»¬çš„è¿åŠ¨åœºã€‚<br>èŠ±è™½ç„¶å¤šï¼Œä½†æ˜¯æ²¡æœ‰å¥‡èŠ±å¼‚è‰ã€‚çè´µçš„èŠ±è‰ä¸æ˜“å…»æ´»ï¼Œçœ‹ç€ä¸€æ£µå¥½èŠ±ç”Ÿç—…è¦æ­»ï¼Œæ˜¯ä»¶éš¾è¿‡çš„äº‹ã€‚åŒ—äº¬çš„æ°”å€™ï¼Œå¯¹å…»èŠ±æ¥è¯´ä¸ç®—å¾ˆå¥½ï¼Œå†¬å¤©å†·ï¼Œæ˜¥å¤©å¤šé£ï¼Œå¤å¤©ä¸æ˜¯å¹²æ—±å°±æ˜¯å¤§é›¨å€¾ç›†ï¼Œç§‹å¤©æœ€å¥½ï¼Œå¯æ˜¯ä¼šå¿½ç„¶é—¹éœœå†»ã€‚åœ¨è¿™ç§æ°”å€™é‡Œï¼Œæƒ³æŠŠå—æ–¹çš„å¥½èŠ±å…»æ´»ï¼Œæˆ‘è¿˜æ²¡æœ‰é‚£ä¹ˆå¤§çš„æœ¬äº‹ã€‚å› æ­¤ï¼Œæˆ‘åªå…»äº›å¥½ç§æ˜“æ´»ã€è‡ªå·±ä¼šå¥‹æ–—çš„èŠ±è‰ã€‚<br>ä¸è¿‡ï¼Œå°½ç®¡èŠ±è‰è‡ªå·±ä¼šå¥‹æ–—ï¼Œæˆ‘è‹¥æ˜¯ç½®ä¹‹ä¸ç†ï¼Œä»»å…¶è‡ªç”Ÿè‡ªç­ï¼Œå¤§åŠè¿˜æ˜¯ä¼šæ­»çš„ã€‚æˆ‘å¾—å¤©å¤©ç…§ç®¡å®ƒä»¬ï¼Œåƒå¥½æœ‹å‹ä¼¼çš„å…³å¿ƒå®ƒä»¬ã€‚ä¸€æ¥äºŒå»ï¼Œæˆ‘æ‘¸ç€ä¸€äº›é—¨é“ï¼šæœ‰çš„å–œé˜´ï¼Œå°±åˆ«æ”¾åœ¨å¤ªé˜³åœ°é‡Œï¼›æœ‰çš„å–œå¹²ï¼Œå°±åˆ«å¤šæµ‡æ°´ã€‚æ‘¸ç€é—¨é“ï¼ŒèŠ±è‰å…»æ´»äº†ï¼Œè€Œä¸”ä¸‰å¹´äº”è½½è€æ´»ç€ã€å¼€èŠ±ï¼Œå¤šä¹ˆæœ‰æ„æ€å•Šï¼ä¸æ˜¯ä¹±å¹ï¼Œè¿™å°±æ˜¯çŸ¥è¯†å‘€ï¼å¤šå¾—äº›çŸ¥è¯†å†³ä¸æ˜¯åäº‹ã€‚<br>æˆ‘ä¸æ˜¯æœ‰è…¿ç—…å—ï¼Œä¸ä½†ä¸åˆ©äºè¡Œï¼Œä¹Ÿä¸åˆ©äºä¹…åã€‚æˆ‘ä¸çŸ¥é“èŠ±è‰ä»¬å—æˆ‘çš„ç…§é¡¾ï¼Œæ„Ÿè°¢æˆ‘ä¸æ„Ÿè°¢ï¼›æˆ‘å¯å¾—æ„Ÿè°¢å®ƒä»¬ã€‚æˆ‘å·¥ä½œçš„æ—¶å€™ï¼Œæˆ‘æ€»æ˜¯å†™ä¸€ä¼šå„¿å°±åˆ°é™¢ä¸­å»çœ‹çœ‹ï¼Œæµ‡æµ‡è¿™æ£µï¼Œæ¬æ¬é‚£ç›†ï¼Œç„¶åå›åˆ°å±‹é‡Œå†å†™ä¸€ä¼šå„¿ï¼Œç„¶åå†å‡ºå»ã€‚å¦‚æ­¤å¾ªç¯ï¼Œè®©è„‘åŠ›åŠ³åŠ¨å’Œä½“åŠ›åŠ³åŠ¨å¾—åˆ°é€‚å½“çš„è°ƒèŠ‚ï¼Œæœ‰ç›Šèº«å¿ƒï¼Œèƒœäºåƒè¯ã€‚è¦æ˜¯èµ¶ä¸Šç‹‚é£æš´é›¨æˆ–å¤©æ°”çªå˜ï¼Œå°±å¾—å…¨å®¶åŠ¨å‘˜ï¼ŒæŠ¢æ•‘èŠ±è‰ï¼Œååˆ†ç´§å¼ ã€‚å‡ ç™¾ç›†èŠ±ï¼Œéƒ½è¦å¾ˆå¿«åœ°æŠ¢åˆ°å±‹é‡Œå»ï¼Œä½¿äººè…°é…¸è…¿ç–¼ï¼Œçƒ­æ±—ç›´æµã€‚ç¬¬äºŒå¤©ï¼Œå¤©æ°”å¥½äº†ï¼Œåˆå¾—æŠŠèŠ±éƒ½æ¬å‡ºå»ï¼Œå°±åˆä¸€æ¬¡è…°é…¸è…¿ç–¼ï¼Œçƒ­æ±—ç›´æµã€‚å¯æ˜¯ï¼Œè¿™å¤šä¹ˆæœ‰æ„æ€å‘€ï¼ä¸åŠ³åŠ¨ï¼Œè¿æ£µèŠ±ä¹Ÿå…»ä¸æ´»ï¼Œè¿™éš¾é“ä¸æ˜¯çœŸç†å—ï¼Ÿ<br>é€ç‰›å¥¶çš„åŒå¿—è¿›é—¨å°±å¤¸â€œå¥½é¦™â€ï¼Œè¿™ä½¿æˆ‘ä»¬å…¨å®¶éƒ½æ„Ÿåˆ°éª„å‚²ã€‚èµ¶åˆ°æ˜™èŠ±å¼€æ”¾çš„æ—¶å€™ï¼Œçº¦å‡ ä½æœ‹å‹æ¥çœ‹çœ‹ï¼Œæ›´æœ‰ç§‰çƒ›å¤œæ¸¸çš„å‘³é“â€”â€”æ˜™èŠ±æ€»åœ¨å¤œé‡Œå¼€æ”¾ã€‚èŠ±åˆ†æ ¹äº†ï¼Œä¸€æ£µåˆ†ä¸ºå‡ æ£µï¼Œå°±èµ ç»™æœ‹å‹ä»¬ä¸€äº›ã€‚çœ‹ç€å‹äººæ‹¿èµ°è‡ªå·±çš„åŠ³åŠ¨æœå®ï¼Œå¿ƒé‡Œè‡ªç„¶ç‰¹åˆ«æ¬¢å–œã€‚<br>å½“ç„¶ï¼Œä¹Ÿæœ‰ä¼¤å¿ƒçš„æ—¶å€™ï¼Œä»Šå¹´å¤å¤©å°±æœ‰è¿™ä¹ˆä¸€å›ã€‚ä¸‰ç™¾æ£µèŠç§§è¿˜åœ¨åœ°ä¸Šï¼ˆæ²¡åˆ°ç§»å…¥ç›†ä¸­çš„æ—¶å€™ï¼‰ï¼Œä¸‹äº†æš´é›¨ï¼Œé‚»å®¶çš„å¢™å€’äº†ï¼ŒèŠç§§è¢«ç ¸æ­»ä¸‰åå¤šç§ï¼Œä¸€ç™¾å¤šæ£µã€‚å…¨å®¶äººå‡ å¤©éƒ½æ²¡æœ‰ç¬‘å®¹ã€‚<br>æœ‰å–œæœ‰å¿§ï¼Œæœ‰ç¬‘æœ‰æ³ªï¼Œæœ‰èŠ±æœ‰æœï¼Œæœ‰é¦™æœ‰è‰²ï¼Œæ—¢é¡»åŠ³åŠ¨ï¼Œåˆé•¿è§è¯†ï¼Œè¿™å°±æ˜¯å…»èŠ±çš„ä¹è¶£ã€‚</p></blockquote><p>æŒ‡å®šè¯è¯­ä¸ºâ€œå¼€å¿ƒâ€ï¼ŒæŸ¥è¯¢ã€Šå…»èŠ±ã€‹ä¸€æ–‡ä¸­ä¸â€œå¼€å¿ƒâ€æœ€ä¸ºæ¥è¿‘çš„5ä¸ªè¯è¯­ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼šï¼ˆfind_similar_words.pyï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><span class="hljs-keyword">import</span> jieba<br><span class="hljs-keyword">from</span> bert_client_lmj <span class="hljs-keyword">import</span> Encoding<br><span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter<br><br><span class="hljs-comment"># è¯»å–æ–‡ç« </span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./doc.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    content = f.read().replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br><br>ec = Encoding()<br>similar_word_dict = &#123;&#125;<br><br><span class="hljs-comment"># æŸ¥æ‰¾æ–‡ç« ä¸­ä¸&#x27;å¼€å¿ƒ&#x27;çš„æœ€æ¥è¿‘çš„è¯è¯­</span><br>words = <span class="hljs-built_in">list</span>(jieba.cut(content))<br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:<br>    <span class="hljs-built_in">print</span>(word)<br>    <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> similar_word_dict.keys():<br>        similar_word_dict[word] = ec.query_similarity([word, <span class="hljs-string">&#x27;å¼€å¿ƒ&#x27;</span>])<br><br><span class="hljs-comment"># æŒ‰ç›¸ä¼¼åº¦ä»é«˜åˆ°ä½æ’åº</span><br>sorted_dict = <span class="hljs-built_in">sorted</span>(similar_word_dict.items(), key=itemgetter(<span class="hljs-number">1</span>), reverse=<span class="hljs-literal">True</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸%sæœ€æ¥è¿‘çš„5ä¸ªè¯è¯­åŠç›¸ä¼¼åº¦å¦‚ä¸‹ï¼š&#x27;</span> % <span class="hljs-string">&#x27;å¼€å¿ƒ&#x27;</span>)<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> sorted_dict[:<span class="hljs-number">5</span>]:<br>    <span class="hljs-built_in">print</span>(_)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c">ä¸å¼€å¿ƒæœ€æ¥è¿‘çš„<span class="hljs-number">5</span>ä¸ªè¯è¯­åŠç›¸ä¼¼åº¦å¦‚ä¸‹ï¼š<br>(&#x27;éš¾è¿‡&#x27;, <span class="hljs-number">0.9070794</span>)<br>(&#x27;é«˜å…´&#x27;, <span class="hljs-number">0.89517105</span>)<br>(&#x27;ä¹è¶£&#x27;, <span class="hljs-number">0.89260685</span>)<br>(&#x27;éª„å‚²&#x27;, <span class="hljs-number">0.87363803</span>)<br>(&#x27;æˆ‘çˆ±èŠ±&#x27;, <span class="hljs-number">0.86954254</span>)<br></code></pre></td></tr></table></figure><h3 id="æå–æ–‡æœ¬ä¸­çš„å®ä½“">æå–æ–‡æœ¬ä¸­çš„å®ä½“</h3><p>åœ¨äº‹ä»¶æŠ½å–ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦æŠ½å–ä¸€äº›æŒ‡å®šçš„å…ƒç´ ï¼Œæ¯”å¦‚åœ¨ä¸‹é¢çš„å¥å­ä¸­ï¼Œ</p><blockquote><p>å·´åŸºæ–¯å¦å½“åœ°æ—¶é—´2014å¹´12æœˆ16æ—¥æ—©æ™¨ï¼Œå·´åŸºæ–¯å¦å¡”åˆ©ç­è¿åŠ¨æ­¦è£…åˆ†å­è¢­å‡»äº†è¥¿åŒ—éƒ¨ç™½æ²™ç“¦å¸‚ä¸€æ‰€å†›äººå­å¼Ÿå­¦æ ¡ï¼Œæ‰“æ­»141äººï¼Œå…¶ä¸­132äººä¸º12å²è‡³16å²çš„å­¦ç”Ÿã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦æŠ½å–è¢­å‡»è€…ï¼Œä¹Ÿå°±æ˜¯ææ€–ç»„ç»‡è¿™ä¸ªå…ƒç´ ã€‚</p><p>ç›´æ¥ä»å¥æ³•åˆ†æï¼Œä¹Ÿè®¸å¯ä»¥å¾—åˆ°ä¸€å®šçš„æ•ˆæœï¼Œä½†ç”±äºäº‹ä»¶æè¿°æ–¹å¼å¤šå˜ï¼Œå¥æ³•åˆ†æä¼šæ˜¾å¾—æ¯”è¾ƒå¤æ‚ä¸”æ•ˆæœä¸ä¸€å®šèƒ½ä¿è¯ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°è¯•BERTè¯å‘é‡ï¼Œå®ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ä½œä¸ºè¡¥å……ç­–ç•¥ï¼Œå¸®åŠ©æˆ‘ä»¬å®šä½åˆ°äº‹ä»¶çš„å…ƒç´ ã€‚å…·ä½“çš„æƒ³æ³•å¦‚ä¸‹ï¼š</p><ul><li>æŒ‡å®šäº‹ä»¶å…ƒç´ æ¨¡æ¿</li><li>å¥å­åˆ†è¯ï¼Œå¯¹è¯è¯­åšn-gram</li><li>æŸ¥è¯¢æ¯ä¸ªn-gramä¸æ¨¡æ¿çš„ç›¸ä¼¼åº¦</li><li>æŒ‰ç›¸ä¼¼åº¦å¯¹n-gramæ’åºï¼Œå–ç›¸ä¼¼åº¦æœ€é«˜çš„n-gram</li></ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„äº‹ä»¶å…ƒç´ ä¸ºææ€–ç»„ç»‡ï¼ŒæŒ‡å®šçš„æ¨¡æ¿ä¸ºâ€œä¼Šæ–¯å…°ç»„ç»‡â€ï¼Œå®Œæ•´çš„Pythonç¨‹åºå¦‚ä¸‹ï¼ˆfind_similar_entity_in_sentence.pyï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> jieba<br><span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter<br><span class="hljs-keyword">from</span> bert_client_lmj <span class="hljs-keyword">import</span> Encoding<br><br><span class="hljs-comment"># åˆ›å»ºn-gram</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_ngrams</span>(<span class="hljs-params">sequence, n</span>):<br>    lst = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(*[sequence[index:] <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(lst)):<br>        lst[i] = <span class="hljs-string">&#x27;&#x27;</span>.join(lst[i])<br>    <span class="hljs-keyword">return</span> lst<br><br><span class="hljs-comment"># æ¨¡æ¿</span><br>template = <span class="hljs-string">&#x27;ä¼Šæ–¯å…°ç»„ç»‡&#x27;</span><br><span class="hljs-comment"># ç¤ºä¾‹å¥å­</span><br>doc = <span class="hljs-string">&quot;å·´åŸºæ–¯å¦å½“åœ°æ—¶é—´2014å¹´12æœˆ16æ—¥æ—©æ™¨ï¼Œå·´åŸºæ–¯å¦å¡”åˆ©ç­è¿åŠ¨æ­¦è£…åˆ†å­è¢­å‡»äº†è¥¿åŒ—éƒ¨ç™½æ²™ç“¦å¸‚ä¸€æ‰€å†›äººå­å¼Ÿå­¦æ ¡ï¼Œæ‰“æ­»141äººï¼Œå…¶ä¸­132äººä¸º12å²è‡³16å²çš„å­¦ç”Ÿã€‚&quot;</span><br><br>words = <span class="hljs-built_in">list</span>(jieba.cut(doc))<br>all_lst = []<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>):<br>    all_lst.extend(compute_ngrams(words, j))<br><br>ec = Encoding()<br>similar_word_dict = &#123;&#125;<br><br><span class="hljs-comment"># æŸ¥æ‰¾æ–‡ç« ä¸­ä¸templateçš„æœ€æ¥è¿‘çš„è¯è¯­</span><br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> all_lst:<br>    <span class="hljs-built_in">print</span>(word)<br>    <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> similar_word_dict.keys():<br>        similar_word_dict[word] = ec.query_similarity([word, template])<br><br><span class="hljs-comment"># æŒ‰ç›¸ä¼¼åº¦ä»é«˜åˆ°ä½æ’åº</span><br>sorted_dict = <span class="hljs-built_in">sorted</span>(similar_word_dict.items(), key=itemgetter(<span class="hljs-number">1</span>), reverse=<span class="hljs-literal">True</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸%sæœ€æ¥è¿‘çš„å®ä½“æ˜¯: %sï¼Œç›¸ä¼¼åº¦ä¸º %s.&#x27;</span> %(template, sorted_dict[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], sorted_dict[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">ä¸ä¼Šæ–¯å…°ç»„ç»‡æœ€æ¥è¿‘çš„å®ä½“æ˜¯: å¡”åˆ©ç­è¿åŠ¨æ­¦è£…åˆ†å­ï¼Œç›¸ä¼¼åº¦ä¸º <span class="hljs-number">0.8953854</span>.<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç®—æ³•æˆåŠŸåœ°å¸®åŠ©æˆ‘ä»¬å®šä½åˆ°äº†ææ€–ç»„ç»‡ï¼šå¡”åˆ©ç­è¿åŠ¨æ­¦è£…åˆ†å­ï¼Œæ•ˆæœå¾ˆå¥½ï¼Œä½†æ˜¯ç”±äºæ˜¯æ— ç›‘ç£äº§ç”Ÿçš„è¯å‘é‡ï¼Œæ•ˆæœä¸ä¸€å®šå¯æ§ï¼Œè€Œä¸”è¯¥ç®—æ³•è¿è¡Œé€Ÿåº¦è¾ƒæ…¢ï¼Œè¿™ç‚¹å¯ä»¥ä»å·¥ç¨‹ä¸ŠåŠ ä»¥æ”¹è¿›ã€‚</p><h3 id="é—®ç­”ä¸­çš„å®ä½“å¯¹é½">é—®ç­”ä¸­çš„å®ä½“å¯¹é½</h3><p>åœ¨æ™ºèƒ½é—®ç­”ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šé‡‡ç”¨çŸ¥è¯†å›¾è°±æˆ–è€…æ•°æ®åº“å­˜å‚¨å®ä½“ï¼Œå…¶ä¸­ä¸€ä¸ªéš¾ç‚¹å°±æ˜¯å®ä½“å¯¹é½ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­å‚¨å­˜çš„å®ä½“å¦‚ä¸‹ï¼šï¼ˆentities.txtï¼‰</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">094</span>å‹/æ™‹çº§<br><span class="hljs-number">052</span>Cå‹ï¼ˆæ—…æ´‹â…¡çº§ï¼‰<br>è¾½å®èˆ°<span class="hljs-regexp">/ç“¦è‰¯æ ¼/</span>Varyag<br>æ°æ‹‰å°”å¾·Â·RÂ·ç¦ç‰¹å·èˆªç©ºæ¯èˆ°<br><span class="hljs-number">052</span>Då‹ï¼ˆæ—…æ´‹IIIçº§ï¼‰<br><span class="hljs-number">054</span>Aå‹<br>CVN-<span class="hljs-number">72</span><span class="hljs-regexp">/æ—è‚¯å·/</span>Lincoln<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„å®ä½“åå­—å¾ˆå¤æ‚ï¼Œå¦‚æœç”¨æˆ·æƒ³æŸ¥è¯¢å®ä½“â€œè¾½å®èˆ°â€ï¼Œå°±ä¼šç¢°åˆ°å›°éš¾ï¼Œä½†æ˜¯ç”±äºå®ä½“ä»¥å‚¨å­˜åœ¨æ•°æ®åº“æˆ–çŸ¥è¯†å›¾è°±ä¸­ï¼Œå®ä½“ä¸å¥½ç›´æ¥ä¿®æ”¹ã€‚ä¸€ç§åŠæ³•æ˜¯é€šè¿‡å…³é”®å­—åŒ¹é…å®šä½å®ä½“ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©BERTè¯å‘é‡æ¥å®ç°ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼šï¼ˆEntity_Alignment.pyï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><span class="hljs-keyword">from</span> bert_client_lmj <span class="hljs-keyword">import</span> Encoding<br><span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;entities.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    entities = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br><br>ec = Encoding()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">entity_alignment</span>(<span class="hljs-params">query</span>):<br><br>    similar_word_dict = &#123;&#125;<br><br>    <span class="hljs-comment"># æŸ¥æ‰¾å·²æœ‰å®ä½“ä¸­ä¸queryæœ€æ¥è¿‘çš„å®ä½“</span><br>    <span class="hljs-keyword">for</span> entity <span class="hljs-keyword">in</span> entities:<br>        <span class="hljs-keyword">if</span> entity <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> similar_word_dict.keys():<br>            similar_word_dict[entity] = ec.query_similarity([entity, query])<br><br>    <span class="hljs-comment"># æŒ‰ç›¸ä¼¼åº¦ä»é«˜åˆ°ä½æ’åº</span><br>    sorted_dict = <span class="hljs-built_in">sorted</span>(similar_word_dict.items(), key=itemgetter(<span class="hljs-number">1</span>), reverse=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">return</span> sorted_dict[<span class="hljs-number">0</span>]<br><br>query = <span class="hljs-string">&#x27;è¾½å®èˆ°&#x27;</span><br>result = entity_alignment(query)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æŸ¥è¯¢å®ä½“ï¼š%sï¼ŒåŒ¹é…å®ä½“ï¼š%s ã€‚&#x27;</span> %(query, result))<br><br>query = <span class="hljs-string">&#x27;æ—è‚¯å·&#x27;</span><br>result = entity_alignment(query)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æŸ¥è¯¢å®ä½“ï¼š%sï¼ŒåŒ¹é…å®ä½“ï¼š%s ã€‚&#x27;</span> %(query, result))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">æŸ¥è¯¢å®ä½“ï¼šè¾½å®èˆ°ï¼ŒåŒ¹é…å®ä½“ï¼š(&#x27;è¾½å®èˆ°/ç“¦è‰¯æ ¼/Varyag&#x27;, <span class="hljs-number">0.8534695</span>) ã€‚<br>æŸ¥è¯¢å®ä½“ï¼šæ—è‚¯å·ï¼ŒåŒ¹é…å®ä½“ï¼š(&#x27;CVN-72/æ—è‚¯å·/Lincoln&#x27;, <span class="hljs-number">0.8389378</span>) ã€‚<br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼ŒæŸ¥è¯¢çš„é€Ÿåº¦åº”è¯¥ä¸æ˜¯å›°éš¾ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å°†å·²å‚¨å­˜çš„å®ä½“ä»¥ç¦»çº¿çš„æ–¹å¼æŸ¥è¯¢å…¶è¯å‘é‡å¹¶å‚¨å­˜ï¼Œè¿™æ ·è¿›æ¥ä¸€ä¸ªæŸ¥è¯¢åˆ°å®ä½“ï¼ŒåªæŸ¥è¯¢ä¸€æ¬¡è¯å‘é‡ï¼Œå¹¶è®¡ç®—å…¶ä¸ç¦»çº¿çš„è¯å‘é‡çš„ç›¸ä¼¼åº¦ã€‚è¿™ç§æ–¹æ³•ä¹Ÿå­˜åœ¨ç¼ºé™·ï¼Œä¸»è¦æ˜¯ç”±äºè¯å‘é‡çš„æ— ç›‘ç£ï¼Œå®ä½“å¯¹é½æœ‰æ—¶å€™ä¸ä¼šå¾ˆå‡†ï¼Œä½†ä½œä¸ºä¸€ç§è¡¥å……ç­–ç•¥ï¼Œä¹Ÿè®¸å¯ä»¥è€ƒè™‘ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†ç¬”è€…è¿™æ®µæ—¶é—´æ‰€æ€è€ƒçš„BERTè¯å‘é‡çš„å‡ ä¸ªåº”ç”¨ï¼Œç”±äºèƒ½åŠ›æœ‰é™ï¼Œæ–‡ç« ä¸­ä¼šå­˜åœ¨è€ƒè™‘ä¸å½“çš„åœ°æ–¹ï¼Œè¿˜è¯·è¯»è€…å¤šå¤šæ‰¹è¯„æŒ‡æ­£ã€‚</p><p>å¦å¤–ï¼Œç¬”è€…å°†ä¼šæŒç»­è°ƒç ”è¯å‘é‡æ–¹é¢çš„æŠ€æœ¯ï¼Œæ¯”å¦‚è…¾è®¯è¯å‘é‡ï¼Œç™¾åº¦è¯å‘é‡ç­‰ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ï½</p><blockquote><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼š NLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨~</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>BERT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆåï¼‰ä½¿ç”¨LSTMè¿›è¡Œæ–‡æœ¬æƒ…æ„Ÿåˆ†æ</title>
    <link href="/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%8D%81%EF%BC%89%E4%BD%BF%E7%94%A8LSTM%E8%BF%9B%E8%A1%8C%E6%96%87%E6%9C%AC%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90/"/>
    <url>/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%8D%81%EF%BC%89%E4%BD%BF%E7%94%A8LSTM%E8%BF%9B%E8%A1%8C%E6%96%87%E6%9C%AC%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="æƒ…æ„Ÿåˆ†æç®€ä»‹">æƒ…æ„Ÿåˆ†æç®€ä»‹</h4><p>æ–‡æœ¬æƒ…æ„Ÿåˆ†æï¼ˆSentimentAnalysisï¼‰æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰æ–¹æ³•ä¸­å¸¸è§çš„åº”ç”¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæœ‰è¶£çš„åŸºæœ¬ä»»åŠ¡ï¼Œå°¤å…¶æ˜¯ä»¥æç‚¼æ–‡æœ¬æƒ…ç»ªå†…å®¹ä¸ºç›®çš„çš„åˆ†ç±»ã€‚å®ƒæ˜¯å¯¹å¸¦æœ‰æƒ…æ„Ÿè‰²å½©çš„ä¸»è§‚æ€§æ–‡æœ¬è¿›è¡Œåˆ†æã€å¤„ç†ã€å½’çº³å’Œæ¨ç†çš„è¿‡ç¨‹ã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»æƒ…æ„Ÿåˆ†æä¸­çš„æƒ…æ„Ÿææ€§ï¼ˆå€¾å‘ï¼‰åˆ†æã€‚æ‰€è°“æƒ…æ„Ÿææ€§åˆ†æï¼ŒæŒ‡çš„æ˜¯å¯¹æ–‡æœ¬è¿›è¡Œè¤’ä¹‰ã€è´¬ä¹‰ã€ä¸­æ€§çš„åˆ¤æ–­ã€‚åœ¨å¤§å¤šåº”ç”¨åœºæ™¯ä¸‹ï¼Œåªåˆ†ä¸ºä¸¤ç±»ã€‚ä¾‹å¦‚å¯¹äºâ€œå–œçˆ±â€å’Œâ€œåŒæ¶â€è¿™ä¸¤ä¸ªè¯ï¼Œå°±å±äºä¸åŒçš„æƒ…æ„Ÿå€¾å‘ã€‚</p><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­çš„LSTMæ¨¡å‹æ¥å®ç°æ–‡æœ¬çš„æƒ…æ„Ÿåˆ†æã€‚</p><h3 id="æ–‡æœ¬ä»‹ç»åŠè¯­æ–™åˆ†æ">æ–‡æœ¬ä»‹ç»åŠè¯­æ–™åˆ†æ</h3><p>æˆ‘ä»¬ä»¥æŸç”µå•†ç½‘ç«™ä¸­æŸä¸ªå•†å“çš„è¯„è®ºä½œä¸ºè¯­æ–™ï¼ˆcorpus.csvï¼‰ï¼Œè¯¥æ•°æ®é›†çš„ä¸‹è½½ç½‘å€ä¸ºï¼š<ahref="https://github.com/renjunxiang/Text-Classification/blob/master/TextClassification/data/data_single.csv">https://github.com/renjunxiang/Text-Classification/blob/master/TextClassification/data/data_single.csv</a>ï¼Œè¯¥æ•°æ®é›†ä¸€å…±æœ‰4310æ¡è¯„è®ºæ•°æ®ï¼Œæ–‡æœ¬çš„æƒ…æ„Ÿåˆ†ä¸ºä¸¤ç±»ï¼šâ€œæ­£é¢â€å’Œâ€œåé¢â€ï¼Œè¯¥æ•°æ®é›†çš„å‰å‡ è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-built_in">evaluation,</span>label<br>ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ï¼Œå¯ä»¥,æ­£é¢<br>ç”µè§†éå¸¸å¥½ï¼Œå·²ç»æ˜¯å®¶é‡Œçš„ç¬¬äºŒå°äº†ã€‚ç¬¬ä¸€å¤©ä¸‹å•ï¼Œç¬¬äºŒå¤©å°±åˆ°æœ¬åœ°äº†ï¼Œå¯æ˜¯ç‰©æµçš„äººè¯´è½¦åäº†ï¼Œä¸€ç›´å‚¬ï¼Œå®¢æœä¹Ÿå¸®ç€å‚¬ï¼Œåˆ°ç¬¬ä¸‰å¤©ä¸‹åˆ<span class="hljs-number">5</span>ç‚¹æ‰é€è¿‡æ¥ã€‚çˆ¶æ¯å¹´çºªå¤§äº†ï¼Œä¹°ä¸ªå¤§ç”µè§†ç”»é¢æ¸…æ™°ï¼Œè¶ç€è€³æœµè¿˜å¥½ä½¿ï¼Œäº«å—å‡ å¹´ã€‚,æ­£é¢<br>ç”µè§†æ¯”æƒ³è±¡ä¸­çš„å¤§å¥½å¤šï¼Œç”»é¢ä¹Ÿå¾ˆæ¸…æ™°ï¼Œç³»ç»Ÿå¾ˆæ™ºèƒ½ï¼Œæ›´å¤šåŠŸèƒ½è¿˜åœ¨æ‘¸ç´¢ä¸­,æ­£é¢<br>ä¸é”™,æ­£é¢<br>ç”¨äº†è¿™ä¹ˆå¤šå¤©äº†ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ã€‚å¤æ™®çš„ç‰Œå­è¿˜æ˜¯æ¯”è¾ƒå¯é ã€‚å¸Œæœ›ä»¥åæ¯”è¾ƒè€ç”¨ï¼Œç°åœ¨æ˜¯è€ƒé‡è´¨é‡çš„æ—¶å€™ã€‚,æ­£é¢<br>ç‰©æµé€Ÿåº¦å¾ˆå¿«ï¼Œéå¸¸æ£’ï¼Œä»Šå¤©å°±çœ‹äº†ç”µè§†ï¼Œéå¸¸æ¸…æ™°ï¼Œéå¸¸æµç•…ï¼Œä¸€æ¬¡éå¸¸å®Œç¾çš„è´­ç‰©ä½“éªŒ,æ­£é¢<br>éå¸¸å¥½ï¼Œå®¢æœè¿˜ç‰¹æ„æ‰“ç”µè¯åšå›è®¿,æ­£é¢<br>ç‰©æµå°å“¥ä¸é”™ï¼Œè¾›è‹¦äº†ï¼Œä¸œè¥¿è¿˜æ²¡ç”¨,æ­£é¢<br>é€è´§é€Ÿåº¦å¿«ï¼Œè´¨é‡æœ‰ä¿éšœï¼Œæ´»åŠ¨ä»·æ ¼æŒºå¥½çš„ã€‚å¸Œæœ›ç”¨çš„ä¹…ï¼Œä¸å‡ºé—®é¢˜ã€‚,æ­£é¢<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬éœ€è¦å¯¹è¯­æ–™åšä¸€ä¸ªç®€å•çš„åˆ†æï¼š</p><ul><li><p>æ•°æ®é›†ä¸­çš„æƒ…æ„Ÿåˆ†å¸ƒï¼›</p></li><li><p>æ•°æ®é›†ä¸­çš„è¯„è®ºå¥å­é•¿åº¦åˆ†å¸ƒã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹Pythonè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿè®¡å‡ºæ•°æ®é›†ä¸­çš„æƒ…æ„Ÿåˆ†å¸ƒä»¥åŠè¯„è®ºå¥å­é•¿åº¦åˆ†å¸ƒã€‚</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> font_manager<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> accumulate<br><br><span class="hljs-comment"># è®¾ç½®matplotlibç»˜å›¾æ—¶çš„å­—ä½“</span><br>my_font = font_manager.FontProperties(fname=<span class="hljs-string">&quot;/Library/Fonts/Songti.ttc&quot;</span>)<br><br><span class="hljs-comment"># ç»Ÿè®¡å¥å­é•¿åº¦åŠé•¿åº¦å‡ºç°çš„é¢‘æ•°</span><br>df = pd.read_csv(<span class="hljs-string">&#x27;./corpus.csv&#x27;</span>)<br><span class="hljs-built_in">print</span>(df.groupby(<span class="hljs-string">&#x27;label&#x27;</span>)[<span class="hljs-string">&#x27;label&#x27;</span>].count())<br><br>df[<span class="hljs-string">&#x27;length&#x27;</span>] = df[<span class="hljs-string">&#x27;evaluation&#x27;</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x))<br>len_df = df.groupby(<span class="hljs-string">&#x27;length&#x27;</span>).count()<br>sent_length = len_df.index.tolist()<br>sent_freq = len_df[<span class="hljs-string">&#x27;evaluation&#x27;</span>].tolist()<br><br><span class="hljs-comment"># ç»˜åˆ¶å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾</span><br>plt.bar(sent_length, sent_freq)<br>plt.title(<span class="hljs-string">&quot;å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾&quot;</span>, fontproperties=my_font)<br>plt.xlabel(<span class="hljs-string">&quot;å¥å­é•¿åº¦&quot;</span>, fontproperties=my_font)<br>plt.ylabel(<span class="hljs-string">&quot;å¥å­é•¿åº¦å‡ºç°çš„é¢‘æ•°&quot;</span>, fontproperties=my_font)<br>plt.savefig(<span class="hljs-string">&quot;./å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾.png&quot;</span>)<br>plt.close()<br><br><span class="hljs-comment"># ç»˜åˆ¶å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°(CDF)</span><br>sent_pentage_list = [(count/<span class="hljs-built_in">sum</span>(sent_freq)) <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> accumulate(sent_freq)]<br><br><span class="hljs-comment"># ç»˜åˆ¶CDF</span><br>plt.plot(sent_length, sent_pentage_list)<br><br><span class="hljs-comment"># å¯»æ‰¾åˆ†ä½ç‚¹ä¸ºquantileçš„å¥å­é•¿åº¦</span><br>quantile = <span class="hljs-number">0.91</span><br><span class="hljs-comment">#print(list(sent_pentage_list))</span><br><span class="hljs-keyword">for</span> length, per <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(sent_length, sent_pentage_list):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">round</span>(per, <span class="hljs-number">2</span>) == quantile:<br>        index = length<br>        <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nåˆ†ä½ç‚¹ä¸º%sçš„å¥å­é•¿åº¦:%d.&quot;</span> % (quantile, index))<br><br><span class="hljs-comment"># ç»˜åˆ¶å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾</span><br>plt.plot(sent_length, sent_pentage_list)<br>plt.hlines(quantile, <span class="hljs-number">0</span>, index, colors=<span class="hljs-string">&quot;c&quot;</span>, linestyles=<span class="hljs-string">&quot;dashed&quot;</span>)<br>plt.vlines(index, <span class="hljs-number">0</span>, quantile, colors=<span class="hljs-string">&quot;c&quot;</span>, linestyles=<span class="hljs-string">&quot;dashed&quot;</span>)<br>plt.text(<span class="hljs-number">0</span>, quantile, <span class="hljs-built_in">str</span>(quantile))<br>plt.text(index, <span class="hljs-number">0</span>, <span class="hljs-built_in">str</span>(index))<br>plt.title(<span class="hljs-string">&quot;å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾&quot;</span>, fontproperties=my_font)<br>plt.xlabel(<span class="hljs-string">&quot;å¥å­é•¿åº¦&quot;</span>, fontproperties=my_font)<br>plt.ylabel(<span class="hljs-string">&quot;å¥å­é•¿åº¦ç´¯ç§¯é¢‘ç‡&quot;</span>, fontproperties=my_font)<br>plt.savefig(<span class="hljs-string">&quot;./å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾.png&quot;</span>)<br>plt.close()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">label</span><br><span class="hljs-string">æ­£é¢</span>    <span class="hljs-number">1908</span><br><span class="hljs-string">è´Ÿé¢</span>    <span class="hljs-number">2375</span><br><span class="hljs-attr">Name:</span> <span class="hljs-string">label,</span> <span class="hljs-attr">dtype:</span> <span class="hljs-string">int64</span><br><br><span class="hljs-string">åˆ†ä½ç‚¹ä¸º0.91çš„å¥å­é•¿åº¦:183.</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­£åé¢ä¸¤ç±»æƒ…æ„Ÿçš„æ¯”ä¾‹å·®ä¸å¤šã€‚å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp10_1.png" /></p><p>å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp10_2.png" /></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤§å¤šæ•°æ ·æœ¬çš„å¥å­é•¿åº¦é›†ä¸­åœ¨1-200ä¹‹é—´ï¼Œå¥å­é•¿åº¦ç´¯è®¡é¢‘ç‡å–0.91åˆ†ä½ç‚¹ï¼Œåˆ™é•¿åº¦ä¸º183å·¦å³ã€‚</p><h3 id="ä½¿ç”¨lstmæ¨¡å‹">ä½¿ç”¨LSTMæ¨¡å‹</h3><p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨æ·±åº¦å­¦ä¹ ä¸­çš„LSTMæ¨¡å‹æ¥å¯¹ä¸Šè¿°æ•°æ®é›†åšæƒ…æ„Ÿåˆ†æï¼Œç¬”è€…å®ç°çš„æ¨¡å‹æ¡†æ¶å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp10_3.png" alt="æ¨¡å‹ç»“æ„å›¾" /><figcaption aria-hidden="true">æ¨¡å‹ç»“æ„å›¾</figcaption></figure><p>å®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> np_utils, plot_model<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Sequential<br><span class="hljs-keyword">from</span> keras.preprocessing.sequence <span class="hljs-keyword">import</span> pad_sequences<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> LSTM, Dense, Embedding, Dropout<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><br><span class="hljs-comment"># å¯¼å…¥æ•°æ®</span><br><span class="hljs-comment"># æ–‡ä»¶çš„æ•°æ®ä¸­ï¼Œç‰¹å¾ä¸ºevaluation, ç±»åˆ«ä¸ºlabel.</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>(<span class="hljs-params">filepath, input_shape=<span class="hljs-number">20</span></span>):<br>    df = pd.read_csv(filepath)<br><br>    <span class="hljs-comment"># æ ‡ç­¾åŠè¯æ±‡è¡¨</span><br>    labels, vocabulary = <span class="hljs-built_in">list</span>(df[<span class="hljs-string">&#x27;label&#x27;</span>].unique()), <span class="hljs-built_in">list</span>(df[<span class="hljs-string">&#x27;evaluation&#x27;</span>].unique())<br><br>    <span class="hljs-comment"># æ„é€ å­—ç¬¦çº§åˆ«çš„ç‰¹å¾</span><br>    string = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> vocabulary:<br>        string += word<br><br>    vocabulary = <span class="hljs-built_in">set</span>(string)<br><br>    <span class="hljs-comment"># å­—å…¸åˆ—è¡¨</span><br>    word_dictionary = &#123;word: i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(vocabulary)&#125;<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;word_dict.pk&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        pickle.dump(word_dictionary, f)<br>    inverse_word_dictionary = &#123;i+<span class="hljs-number">1</span>: word <span class="hljs-keyword">for</span> i, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(vocabulary)&#125;<br>    label_dictionary = &#123;label: i <span class="hljs-keyword">for</span> i, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(labels)&#125;<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;label_dict.pk&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        pickle.dump(label_dictionary, f)<br>    output_dictionary = &#123;i: labels <span class="hljs-keyword">for</span> i, labels <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(labels)&#125;<br><br>    vocab_size = <span class="hljs-built_in">len</span>(word_dictionary.keys()) <span class="hljs-comment"># è¯æ±‡è¡¨å¤§å°</span><br>    label_size = <span class="hljs-built_in">len</span>(label_dictionary.keys()) <span class="hljs-comment"># æ ‡ç­¾ç±»åˆ«æ•°é‡</span><br><br>    <span class="hljs-comment"># åºåˆ—å¡«å……ï¼ŒæŒ‰input_shapeå¡«å……ï¼Œé•¿åº¦ä¸è¶³çš„æŒ‰0è¡¥å……</span><br>    x = [[word_dictionary[word] <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent] <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> df[<span class="hljs-string">&#x27;evaluation&#x27;</span>]]<br>    x = pad_sequences(maxlen=input_shape, sequences=x, padding=<span class="hljs-string">&#x27;post&#x27;</span>, value=<span class="hljs-number">0</span>)<br>    y = [[label_dictionary[sent]] <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> df[<span class="hljs-string">&#x27;label&#x27;</span>]]<br>    y = [np_utils.to_categorical(label, num_classes=label_size) <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> y]<br>    y = np.array([<span class="hljs-built_in">list</span>(_[<span class="hljs-number">0</span>]) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> y])<br><br>    <span class="hljs-keyword">return</span> x, y, output_dictionary, vocab_size, label_size, inverse_word_dictionary<br><br><span class="hljs-comment"># åˆ›å»ºæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œ Embedding + LSTM + Softmax.</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_LSTM</span>(<span class="hljs-params">n_units, input_shape, output_dim, filepath</span>):<br>    x, y, output_dictionary, vocab_size, label_size, inverse_word_dictionary = load_data(filepath)<br>    model = Sequential()<br>    model.add(Embedding(input_dim=vocab_size + <span class="hljs-number">1</span>, output_dim=output_dim,<br>                        input_length=input_shape, mask_zero=<span class="hljs-literal">True</span>))<br>    model.add(LSTM(n_units, input_shape=(x.shape[<span class="hljs-number">0</span>], x.shape[<span class="hljs-number">1</span>])))<br>    model.add(Dropout(<span class="hljs-number">0.2</span>))<br>    model.add(Dense(label_size, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>))<br>    model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>, optimizer=<span class="hljs-string">&#x27;adam&#x27;</span>, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br>    plot_model(model, to_file=<span class="hljs-string">&#x27;./model_lstm.png&#x27;</span>, show_shapes=<span class="hljs-literal">True</span>)<br>    model.summary()<br><br>    <span class="hljs-keyword">return</span> model<br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">model_train</span>(<span class="hljs-params">input_shape, filepath, model_save_path</span>):<br><br>    <span class="hljs-comment"># å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå æ¯”ä¸º9:1</span><br>    <span class="hljs-comment"># input_shape = 100</span><br>    x, y, output_dictionary, vocab_size, label_size, inverse_word_dictionary = load_data(filepath, input_shape)<br>    train_x, test_x, train_y, test_y = train_test_split(x, y, test_size = <span class="hljs-number">0.1</span>, random_state = <span class="hljs-number">42</span>)<br><br>    <span class="hljs-comment"># æ¨¡å‹è¾“å…¥å‚æ•°ï¼Œéœ€è¦è‡ªå·±æ ¹æ®éœ€è¦è°ƒæ•´</span><br>    n_units = <span class="hljs-number">100</span><br>    batch_size = <span class="hljs-number">32</span><br>    epochs = <span class="hljs-number">5</span><br>    output_dim = <span class="hljs-number">20</span><br><br>    <span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br>    lstm_model = create_LSTM(n_units, input_shape, output_dim, filepath)<br>    lstm_model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment"># æ¨¡å‹ä¿å­˜</span><br>    lstm_model.save(model_save_path)<br><br>    N = test_x.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment"># æµ‹è¯•çš„æ¡æ•°</span><br>    predict = []<br>    label = []<br>    <span class="hljs-keyword">for</span> start, end <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, N, <span class="hljs-number">1</span>), <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, N+<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)):<br>        sentence = [inverse_word_dictionary[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> test_x[start] <span class="hljs-keyword">if</span> i != <span class="hljs-number">0</span>]<br>        y_predict = lstm_model.predict(test_x[start:end])<br>        label_predict = output_dictionary[np.argmax(y_predict[<span class="hljs-number">0</span>])]<br>        label_true = output_dictionary[np.argmax(test_y[start:end])]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(sentence), label_true, label_predict) <span class="hljs-comment"># è¾“å‡ºé¢„æµ‹ç»“æœ</span><br>        predict.append(label_predict)<br>        label.append(label_true)<br><br>    acc = accuracy_score(predict, label) <span class="hljs-comment"># é¢„æµ‹å‡†ç¡®ç‡</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ä¸º: %s.&#x27;</span> % acc)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    filepath = <span class="hljs-string">&#x27;./corpus.csv&#x27;</span><br>    input_shape = <span class="hljs-number">180</span><br>    model_save_path = <span class="hljs-string">&#x27;./corpus_model.h5&#x27;</span><br>    model_train(input_shape, filepath, model_save_path)<br></code></pre></td></tr></table></figure><p>å¯¹ä¸Šè¿°æ¨¡å‹ï¼Œå…±è®­ç»ƒ5æ¬¡ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†æ¯”ä¾‹ä¸º9:1ï¼Œè¾“å‡ºçš„ç»“æœä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">......</span><br><span class="hljs-string">Epoch</span> <span class="hljs-number">5</span><span class="hljs-string">/5</span><br><span class="hljs-string">......</span><br><span class="hljs-number">3424</span><span class="hljs-string">/3854</span> [<span class="hljs-string">=========================&gt;....</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 2s - loss: 0.1280 - acc:</span> <span class="hljs-number">0.9565</span><br><span class="hljs-number">3456</span><span class="hljs-string">/3854</span> [<span class="hljs-string">=========================&gt;....</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 1s - loss: 0.1274 - acc:</span> <span class="hljs-number">0.9569</span><br><span class="hljs-number">3488</span><span class="hljs-string">/3854</span> [<span class="hljs-string">==========================&gt;...</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 1s - loss: 0.1274 - acc:</span> <span class="hljs-number">0.9570</span><br><span class="hljs-number">3520</span><span class="hljs-string">/3854</span> [<span class="hljs-string">==========================&gt;...</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 1s - loss: 0.1287 - acc:</span> <span class="hljs-number">0.9568</span><br><span class="hljs-number">3552</span><span class="hljs-string">/3854</span> [<span class="hljs-string">==========================&gt;...</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 1s - loss: 0.1290 - acc:</span> <span class="hljs-number">0.9564</span><br><span class="hljs-number">3584</span><span class="hljs-string">/3854</span> [<span class="hljs-string">==========================&gt;...</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 1s - loss: 0.1284 - acc:</span> <span class="hljs-number">0.9568</span><br><span class="hljs-number">3616</span><span class="hljs-string">/3854</span> [<span class="hljs-string">===========================&gt;..</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 1s - loss: 0.1284 - acc:</span> <span class="hljs-number">0.9569</span><br><span class="hljs-number">3648</span><span class="hljs-string">/3854</span> [<span class="hljs-string">===========================&gt;..</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 0s - loss: 0.1278 - acc:</span> <span class="hljs-number">0.9572</span><br><span class="hljs-number">3680</span><span class="hljs-string">/3854</span> [<span class="hljs-string">===========================&gt;..</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 0s - loss: 0.1271 - acc:</span> <span class="hljs-number">0.9576</span><br><span class="hljs-number">3712</span><span class="hljs-string">/3854</span> [<span class="hljs-string">===========================&gt;..</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 0s - loss: 0.1268 - acc:</span> <span class="hljs-number">0.9580</span><br><span class="hljs-number">3744</span><span class="hljs-string">/3854</span> [<span class="hljs-string">============================&gt;.</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 0s - loss: 0.1279 - acc:</span> <span class="hljs-number">0.9575</span><br><span class="hljs-number">3776</span><span class="hljs-string">/3854</span> [<span class="hljs-string">============================&gt;.</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 0s - loss: 0.1272 - acc:</span> <span class="hljs-number">0.9579</span><br><span class="hljs-number">3808</span><span class="hljs-string">/3854</span> [<span class="hljs-string">============================&gt;.</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 0s - loss: 0.1279 - acc:</span> <span class="hljs-number">0.9580</span><br><span class="hljs-number">3840</span><span class="hljs-string">/3854</span> [<span class="hljs-string">============================&gt;.</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">ETA: 0s - loss: 0.1281 - acc:</span> <span class="hljs-number">0.9581</span><br><span class="hljs-number">3854</span><span class="hljs-string">/3854</span> [<span class="hljs-string">==============================</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">18s 5ms/step - loss: 0.1298 - acc:</span> <span class="hljs-number">0.9577</span><br><span class="hljs-string">......</span><br><span class="hljs-string">ç»™çˆ¶æ¯ä¹°çš„ï¼Œç‰¹æ„ç”¨äº†ä¸€æ®µæ—¶é—´å†æ¥è¯„ä»·ï¼Œç”µè§†éå¸¸å¥½ï¼Œæ²¡æœ‰åç‚¹å’ŒæŸåï¼Œç•Œé¢ä¹Ÿå¾ˆç®€æ´ï¼Œä¾¿äºæ“ä½œï¼Œç¨å¾®ä¸è¶³å°±æ˜¯å¼€æœºä¼šæ¯”æ™®é€šç”µè§†æ…¢ä¸€äº›ï¼Œè¿™åº”è¯¥æ˜¯æ™ºèƒ½ç”µè§†çš„é€šç—…å§ï¼Œå¦‚æœå¯ä»¥å¸Œæœ›å¾®é²¸å¤§å¤§å¯ä»¥æ›´æ–°ç³»ç»Ÿä¼˜åŒ–ä¸‹å¼€æœºæ—¶é—´~ç”µè§†çœŸçš„å¾ˆæ£’ï¼Œæ€§ä»·æ¯”çˆ†æ£šï¼Œå€¼å¾—å¤§å®¶è€ƒè™‘è´­ä¹°ã€‚</span> <span class="hljs-string">å®¢æœå¾ˆç»†å¿ƒï¼Œå¿«é€’å°å“¥å¾ˆè€å¿ƒçš„ç­‰æˆ‘é€šç”µéªŒè´§ï¼Œæ€åº¦éå¸¸å¥½ã€‚</span> <span class="hljs-string">è´Ÿé¢</span> <span class="hljs-string">æ­£é¢</span><br><span class="hljs-string">é•¿é¡»é²¸å’Œæµ·ç‹®å›ç­”éƒ½å¾ˆåŠæ—¶ï¼Œè™½ç„¶ç‰©æµä¸å¤Ÿå¿«ä½†æ˜¯æœåŠ¡ä¸é”™ç”µè§†ä¸é”™ï¼Œå¯¹æ¯”äº†ä¹è§†å°ç±³å’Œå¾®é²¸è®ºæ€§ä»·æ¯”è¿˜æ˜¯å¾®é²¸å¥½ç‚¹</span> <span class="hljs-string">è´Ÿé¢</span> <span class="hljs-string">è´Ÿé¢</span><br><span class="hljs-string">æ‰€ä»¥çœ‹ä¸åˆ°4kæ•ˆæœï¼Œä½†æ˜¯åº”è¯¥å¯ä»¥ã€‚</span> <span class="hljs-string">è‡ªå¸¦éŸ³å“ï¼Œä¸­è§„ä¸­çŸ©å§ï¼Œå¥½åƒæ²¡æœ‰åˆ«äººè¯´çš„å¥½ã€‚è€Œä¸”ï¼Œåˆ°ç°åœ¨æ²¡è¿æ¥ä¸Šæˆ‘çš„æ¼«æ­¥è€…ï¼Œè¿™ä¸ªéå¸¸ä¸æ»¡æ„ï¼Œå› ä¸ºçœ‹åˆ°ç½‘ä¸Šè¯´å¥½åƒæ™®é€š3.5mmçš„è¿ä¸ä¸Šæˆ–è€…è¿ä¸Šäº†å£°éŸ³å°ã€‚å¸Œæœ›å‚å®¶æ¥ä¸‹æ¥å¼€å‘çš„ç”µè§†æœ‰æ”¹è¿›ã€‚ä¸çŸ¥é“æˆ‘è¦ä¸è¦æ¢ä¸ªéŸ³å“ã€‚å…¶ä»–çš„ç”¨ç”¨å†è¯´ã€‚</span> <span class="hljs-string">æ”¾åœ¨åœ°ä¸Šçš„æ˜¯è·Ÿæˆ‘æ··äº†ä¸¤å¹´çš„tclï¼Œå¤©æ°”å—æ½®ï¼Œä¿®äº†ä¸€æ¬¡ï¼Œä¸‹å²—äº†ã€‚</span> <span class="hljs-string">æœ€åï¼Œæˆ‘ä¹Ÿè§‰å¾—åº•åº§ä¸ç®—å¤ªç¨³ï¼Œå‡‘åˆç€ç”¨ã€‚</span> <span class="hljs-string">è´Ÿé¢</span> <span class="hljs-string">è´Ÿé¢</span><br><span class="hljs-string">ç”µè§†æœºä¸€èˆ¬ï¼Œä½ç«¯æœºä¸è¦æ±‚é‚£ä¹ˆé«˜å’¯ã€‚</span> <span class="hljs-string">è´Ÿé¢</span> <span class="hljs-string">è´Ÿé¢</span><br><span class="hljs-string">å¾ˆå¥½ï¼Œä¸¤ç‚¹ä¸‹å•ä¸Šåˆå°±åˆ°äº†ï¼ŒæœåŠ¡å¾ˆå¥½ã€‚</span> <span class="hljs-string">æ­£é¢</span> <span class="hljs-string">æ­£é¢</span><br><span class="hljs-string">å¸®æœ‹å‹ä¹°çš„ï¼Œå¥½å¥½å¥½å¥½å¥½å¥½å¥½å¥½</span> <span class="hljs-string">æ­£é¢</span> <span class="hljs-string">æ­£é¢</span><br><span class="hljs-string">......</span><br><span class="hljs-string">æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ä¸º:</span> <span class="hljs-number">0.9020979020979021</span><span class="hljs-string">.</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„å‡†ç¡®ç‡ä¸º95%ä»¥ä¸Šï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ä¸º90%ä»¥ä¸Šï¼Œæ•ˆæœè¿˜æ˜¯ç›¸å½“ä¸é”™çš„ã€‚</p><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æ¥ç€ï¼Œæˆ‘ä»¬åˆ©ç”¨åˆšåˆšè®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¯¹æ–°çš„æ•°æ®è¿›è¡Œæµ‹è¯•ã€‚ç¬”è€…éšæœºæ”¹é€ ä¸Šè¿°æ ·æœ¬çš„è¯„è®ºï¼Œç„¶åé¢„æµ‹å…¶æƒ…æ„Ÿå€¾å‘ã€‚æƒ…æ„Ÿé¢„æµ‹çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-comment"># Import the necessary modules</span><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> keras.preprocessing.sequence <span class="hljs-keyword">import</span> pad_sequences<br><br><br><span class="hljs-comment"># å¯¼å…¥å­—å…¸</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;word_dict.pk&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    word_dictionary = pickle.load(f)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;label_dict.pk&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    output_dictionary = pickle.load(f)<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># æ•°æ®é¢„å¤„ç†</span><br>    input_shape = <span class="hljs-number">180</span><br>    sent = <span class="hljs-string">&quot;ç”µè§†åˆšå®‰è£…å¥½ï¼Œè¯´å®è¯ï¼Œç”»è´¨ä¸æ€ä¹ˆæ ·ï¼Œå¾ˆå·®ï¼&quot;</span><br>    x = [[word_dictionary[word] <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent]]<br>    x = pad_sequences(maxlen=input_shape, sequences=x, padding=<span class="hljs-string">&#x27;post&#x27;</span>, value=<span class="hljs-number">0</span>)<br><br>    <span class="hljs-comment"># è½½å…¥æ¨¡å‹</span><br>    model_save_path = <span class="hljs-string">&#x27;./sentiment_analysis.h5&#x27;</span><br>    lstm_model = load_model(model_save_path)<br><br>    <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>    y_predict = lstm_model.predict(x)<br>    label_dict = &#123;v:k <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> output_dictionary.items()&#125;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è¾“å…¥è¯­å¥: %s&#x27;</span> % sent)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æƒ…æ„Ÿé¢„æµ‹ç»“æœ: %s&#x27;</span> % label_dict[np.argmax(y_predict)])<br><br><span class="hljs-keyword">except</span> KeyError <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ‚¨è¾“å…¥çš„å¥å­æœ‰æ±‰å­—ä¸åœ¨è¯æ±‡è¡¨ä¸­ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸åœ¨è¯æ±‡è¡¨ä¸­çš„å•è¯ä¸ºï¼š%s.&quot;</span> % err)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥è¯­å¥: ç”µè§†åˆšå®‰è£…å¥½ï¼Œè¯´å®è¯ï¼Œç”»è´¨ä¸æ€ä¹ˆæ ·ï¼Œå¾ˆå·®ï¼</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: è´Ÿé¢</span><br></code></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬å†å°è¯•ç€æµ‹è¯•ä¸€äº›å…¶ä»–çš„è¯„è®ºï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">è¾“å…¥è¯­å¥: ç‰©è¶…æ‰€å€¼ï¼ŒçœŸå¿ƒä¸é”™</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: æ­£é¢</span><br><span class="hljs-section">è¾“å…¥è¯­å¥: å¾ˆå¤§å¾ˆå¥½ï¼Œæ–¹ä¾¿å®‰è£…ï¼</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: æ­£é¢</span><br><span class="hljs-section">è¾“å…¥è¯­å¥: å¡ï¼Œæ…¢ï¼Œæ­»æœºï¼Œé—ªé€€ã€‚</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: è´Ÿé¢</span><br><span class="hljs-section">è¾“å…¥è¯­å¥: è¿™ç§è´§è‰²å°±è¿™æ ·å§ï¼Œåˆ«æœŸå¾…æ€æ ·ã€‚</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: è´Ÿé¢</span><br><span class="hljs-section">è¾“å…¥è¯­å¥: å•¥æœåŠ¡æ€åº¦ç ï¼Œå‡ºäº†äº‹æƒ…ä¸€ä¸ªæ¨ä¸€ä¸ªï¼Œé€è´§å®‰è£…è¿˜æ”¶æˆ‘50</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: è´Ÿé¢</span><br><span class="hljs-section">è¾“å…¥è¯­å¥: äº¬ä¸œæœåŠ¡å¾ˆå¥½ï¼ä½†æˆ‘ä¹°çš„è¿™æ¬¾ç”µè§†ä¸¤å¤©åå°±å‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œå¾ˆåæ‚”ä¹°äº†è¿™æ ·çš„ç”µè§†</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: è´Ÿé¢</span><br><span class="hljs-section">è¾“å…¥è¯­å¥: äº§å“è´¨é‡ä¸é”™ï¼Œå°±æ˜¯è¿™ä½å®¢æœçš„æ€åº¦ååˆ†æ¶åŠ£ï¼Œå¯¹ç›¸å…³æœåŠ¡ä¸äºˆè§£é‡Šè¯´æ˜ï¼Œç¼ºä¹è€å¿ƒï¼Œ</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: è´Ÿé¢</span><br><span class="hljs-section">è¾“å…¥è¯­å¥: å¾ˆæ»¡æ„ï¼Œç”µè§†éå¸¸å¥½ã€‚æŠ¤çœ¼æ¨¡å¼ï¼Œå¾ˆå¥½ï¼Œä¹Ÿå¾ˆæ¸…æ™°ã€‚</span><br><span class="hljs-section">æƒ…æ„Ÿé¢„æµ‹ç»“æœ: è´Ÿé¢</span><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>å½“ç„¶ï¼Œè¯¥æ¨¡å‹å¹¶ä¸æ˜¯å¯¹ä¸€åˆ‡è¯¥å•†å“çš„è¯„è®ºéƒ½ä¼šæœ‰å¥½çš„æ•ˆæœï¼Œè¿˜æ˜¯åº”è¯¥é’ˆå¯¹ç‰¹å®šçš„è¯­æ–™å»è®­ç»ƒï¼Œå»é¢„æµ‹ã€‚</p><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†LSTMæ¨¡å‹åœ¨æ–‡æœ¬æƒ…æ„Ÿåˆ†ææ–¹é¢çš„åº”ç”¨ï¼Œè¯¥é¡¹ç›®å·²ä¸Šä¼ Githubï¼Œåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/Sentiment_Analysis">https://github.com/percent4/Sentiment_Analysis</a>ã€‚</p><p>æ³¨æ„ï¼šä¸å¦¨äº†è§£ä¸‹ç¬”è€…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨~</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>Pythonæœºå™¨å­¦ä¹  -- NLPæƒ…æ„Ÿåˆ†æï¼š<ahref="https://blog.csdn.net/qq_38328378/article/details/81198322">https://blog.csdn.net/qq_38328378/article/details/81198322</a></li><li>æ•°æ®é›†æ¥æºï¼š<ahref="https://github.com/renjunxiang/Text-Classification/blob/master/TextClassification/data/data_single.csv">https://github.com/renjunxiang/Text-Classification/blob/master/TextClassification/data/data_single.csv</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>æƒ…æ„Ÿåˆ†æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆä¹ï¼‰è¯ä¹‰æ¶ˆå²ï¼ˆWSDï¼‰çš„ç®€ä»‹ä¸å®ç°</title>
    <link href="/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B9%9D%EF%BC%89%E8%AF%8D%E4%B9%89%E6%B6%88%E5%B2%90%EF%BC%88WSD%EF%BC%89%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
    <url>/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B9%9D%EF%BC%89%E8%AF%8D%E4%B9%89%E6%B6%88%E5%B2%90%EF%BC%88WSD%EF%BC%89%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="è¯ä¹‰æ¶ˆå²ç®€ä»‹">è¯ä¹‰æ¶ˆå²ç®€ä»‹</h3><p>è¯ä¹‰æ¶ˆå²ï¼Œè‹±æ–‡åç§°ä¸ºWord SenseDisambiguationï¼Œè‹±è¯­ç¼©å†™ä¸ºWSDï¼Œæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä¸­ä¸€ä¸ªéå¸¸æœ‰è¶£çš„åŸºæœ¬ä»»åŠ¡ã€‚</p><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯è¯ä¹‰æ¶ˆå²å‘¢ï¼Ÿé€šå¸¸ï¼Œåœ¨æˆ‘ä»¬çš„è‡ªç„¶è¯­è¨€ä¸­ï¼Œä¸ç®¡æ˜¯è‹±è¯­ï¼Œè¿˜æ˜¯ä¸­æ–‡ï¼Œéƒ½æœ‰å¤šä¹‰è¯å­˜åœ¨ã€‚è¿™äº›å¤šä¹‰è¯çš„å­˜åœ¨ï¼Œä¼šè®©äººå¯¹å¥å­çš„æ„æ€äº§ç”Ÿæ··æ·†ï¼Œä½†äººé€šè¿‡å­¦ä¹ åˆæ˜¯å¯ä»¥æ­£ç¡®åœ°åŒºåˆ†å‡ºæ¥çš„ã€‚</p><p>ä»¥<strong>â€œå°ç±³â€</strong>è¿™ä¸ªè¯ä¸ºä¾‹ï¼Œå¦‚æœä»…ä»…åªæ˜¯è¯´â€œå°ç±³â€è¿™ä¸ªè¯è¯­ï¼Œä½ å¹¶ä¸çŸ¥é“å®ƒå®é™…æŒ‡çš„åˆ°åº•æ˜¯å°ç±³ç§‘æŠ€å…¬å¸è¿˜æ˜¯è°·ç‰©ã€‚ä½†å½“æˆ‘ä»¬æŠŠè¯è¯­ç½®äºæŸä¸ªç‰¹å®šçš„è¯­å¢ƒä¸­ï¼Œæˆ‘ä»¬èƒ½å¾ˆå¥½åœ°åŒºåˆ†å‡ºè¿™ä¸ªè¯è¯­çš„æ„æ€ã€‚æ¯”å¦‚ï¼Œ</p><blockquote><p>é›·å†›æ˜¯å°ç±³çš„åˆ›å§‹äººã€‚</p></blockquote><p>åœ¨è¿™ä¸ªå¥å­ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªâ€œå°ç±³â€æŒ‡çš„æ˜¯å°ç±³ç§‘æŠ€å…¬å¸ã€‚æ¯”å¦‚</p><blockquote><p>æˆ‘ä»Šå¤©æ—©ä¸Šå–äº†ä¸€ç¢—å°ç±³ç²¥ã€‚</p></blockquote><p>åœ¨è¿™ä¸ªå¥å­ä¸­ï¼Œâ€œå°ç±³â€æŒ‡çš„æ˜¯è°·ç‰©ã€å†œä½œç‰©ã€‚</p><p>æ‰€è°“è¯ä¹‰æ¶ˆå²ï¼ŒæŒ‡çš„æ˜¯åœ¨ç‰¹å®šçš„è¯­å¢ƒä¸­ï¼Œè¯†åˆ«å‡ºæŸä¸ªæ­§ä¹‰è¯çš„æ­£ç¡®å«ä¹‰ã€‚</p><p>é‚£ä¹ˆï¼Œè¯ä¹‰æ¶ˆå²æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿè¯ä¹‰æ¶ˆå²å¯ä»¥å¾ˆå¥½åœ°æœåŠ¡äºè¯­è¨€ç¿»è¯‘å’Œæ™ºèƒ½é—®ç­”é¢†åŸŸï¼Œå½“ç„¶ï¼Œè¿˜æœ‰è®¸å¤šåº”ç”¨æœ‰å¾…å¼€å‘ï½</p><h3 id="è¯ä¹‰æ¶ˆå²å®ç°">è¯ä¹‰æ¶ˆå²å®ç°</h3><p>åœ¨ç›®å‰çš„è¯ä¹‰æ¶ˆå²ç®—æ³•ä¸­ï¼Œæœ‰ä¸å°‘åŸåˆ›ç®—æ³•ï¼Œæœ‰äº›å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œæœ‰äº›æƒ³æ³•è¾ƒä¸ºå¤æ‚ï¼Œä½†å®ç°çš„æ•ˆæœæ™®ééƒ½ä¸æ˜¯å¾ˆå¥½ã€‚æ¯”è¾ƒç»å…¸çš„è¯ä¹‰æ¶ˆå²çš„ç®—æ³•ä¸ºLeskç®—æ³•ï¼Œè¯¥ç®—æ³•çš„æƒ³æ³•å¾ˆç®€å•ï¼Œé€šè¿‡å¯¹æŸä¸ªæ­§ä¹‰è¯æ„å»ºä¸åŒå«ä¹‰çš„è¯­æ–™åŠå¾…åˆ¤åˆ«å¥å­ä¸­è¯¥è¯è¯­ä¸è¯­æ–™çš„é‡åˆç¨‹åº¦æ¥å®ç°ï¼Œå…·ä½“çš„ç®—æ³•åŸç†å¯å‚è€ƒç½‘å€ï¼š<ahref="https://en.wikipedia.org/wiki/Lesk_algorithm">https://en.wikipedia.org/wiki/Lesk_algorithm</a>.</p><p>åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­ï¼Œç¬”è€…å°†ä¼šä»‹ç»è‡ªå·±æƒ³çš„ä¸€ç§å®ç°è¯ä¹‰æ¶ˆå²çš„ç®—æ³•ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªæƒ³æ³•ï¼Œä»…ä¾›å‚è€ƒã€‚</p><p>æˆ‘ä»¬ä»¥è¯è¯­â€œç«ç®­â€ä¸ºä¾‹ï¼Œé€‰å–å…¶ä¸­çš„ä¸¤ä¸ª<strong>ä¹‰é¡¹</strong>ï¼ˆåŒä¸€ä¸ªè¯è¯­çš„ä¸åŒå«ä¹‰ï¼‰ï¼š<ahref="https://baike.baidu.com/item/%E7%81%AB%E7%AE%AD/8794081#viewPageContent"title="NBAçƒé˜Ÿå">NBAçƒé˜Ÿå</a> å’Œ <ahref="https://baike.baidu.com/item/%E7%81%AB%E7%AE%AD/6308#viewPageContent"title="ç‡ƒæ°”æ¨è¿›è£…ç½®">ç‡ƒæ°”æ¨è¿›è£…ç½®</a> ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/img/nlp9_1.png" /></p><h4 id="è·å–è¯­æ–™">è·å–è¯­æ–™</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ©ç”¨çˆ¬è™«çˆ¬å–è¿™ä¸¤ä¸ªä¹‰é¡¹çš„ç™¾åº¦ç™¾ç§‘ç½‘é¡µï¼Œä»¥å¥å­ä¸ºå•ä½ï¼Œåªè¦å¥å­ä¸­å‡ºç°è¯¥è¯è¯­ï¼Œåˆ™æŠŠè¿™å¥è¯åŠ å…¥åˆ°è¿™ä¸ªä¹‰é¡¹çš„é¢„æ–™ä¸­ã€‚çˆ¬è™«çš„å®Œæ•´Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> SentenceSplitter<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebScrape</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, word, url</span>):<br>        self.url = url<br>        self.word = word<br><br>    <span class="hljs-comment"># çˆ¬å–ç™¾åº¦ç™¾ç§‘é¡µé¢</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">web_parse</span>(<span class="hljs-params">self</span>):<br>        headers = &#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 \</span><br><span class="hljs-string">                                             (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36&#x27;</span>&#125;<br>        req = requests.get(url=self.url, headers=headers)<br><br>        <span class="hljs-comment"># è§£æç½‘é¡µï¼Œå®šä½åˆ°main-contentéƒ¨åˆ†</span><br>        <span class="hljs-keyword">if</span> req.status_code == <span class="hljs-number">200</span>:<br>            soup = BeautifulSoup(req.text.encode(req.encoding), <span class="hljs-string">&#x27;lxml&#x27;</span>)<br>            <span class="hljs-keyword">return</span> soup<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># è·å–è¯¥è¯è¯­çš„ä¹‰é¡¹</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_gloss</span>(<span class="hljs-params">self</span>):<br>        soup = self.web_parse()<br>        <span class="hljs-keyword">if</span> soup:<br>            lis = soup.find(<span class="hljs-string">&#x27;ul&#x27;</span>, class_=<span class="hljs-string">&quot;polysemantList-wrapper cmn-clearfix&quot;</span>)<br>            <span class="hljs-keyword">if</span> lis:<br>                <span class="hljs-keyword">for</span> li <span class="hljs-keyword">in</span> lis(<span class="hljs-string">&#x27;li&#x27;</span>):<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&lt;a&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(li):<br>                        gloss = li.text.replace(<span class="hljs-string">&#x27;â–ª&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                        <span class="hljs-keyword">return</span> gloss<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># è·å–è¯¥ä¹‰é¡¹çš„è¯­æ–™ï¼Œä»¥å¥å­ä¸ºå•ä½</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_content</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># å‘é€HTTPè¯·æ±‚</span><br>        result = []<br>        soup = self.web_parse()<br>        <span class="hljs-keyword">if</span> soup:<br>            paras = soup.find(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;main-content&#x27;</span>).text.split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            <span class="hljs-keyword">for</span> para <span class="hljs-keyword">in</span> paras:<br>                <span class="hljs-keyword">if</span> self.word <span class="hljs-keyword">in</span> para:<br>                    sents = <span class="hljs-built_in">list</span>(SentenceSplitter.split(para))<br>                    <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents:<br>                        <span class="hljs-keyword">if</span> self.word <span class="hljs-keyword">in</span> sent:<br>                            sent = sent.replace(<span class="hljs-string">&#x27;\xa0&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;\u3000&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>                            result.append(sent)<br><br>        result = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(result))<br><br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-comment"># å°†è¯¥ä¹‰é¡¹çš„è¯­æ–™å†™å…¥åˆ°txt</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">write_2_file</span>(<span class="hljs-params">self</span>):<br>        gloss = self.get_gloss()<br>        result = self.get_content()<br>        <span class="hljs-built_in">print</span>(gloss)<br>        <span class="hljs-built_in">print</span>(result)<br>        <span class="hljs-keyword">if</span> result <span class="hljs-keyword">and</span> gloss:<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./%s_%s.txt&#x27;</span>% (self.word, gloss), <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.writelines([_+<span class="hljs-string">&#x27;\n&#x27;</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> result])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        self.write_2_file()<br><br><span class="hljs-comment"># NBAçƒé˜Ÿå</span><br><span class="hljs-comment">#url = &#x27;https://baike.baidu.com/item/%E4%BC%91%E6%96%AF%E6%95%A6%E7%81%AB%E7%AE%AD%E9%98%9F/370758?fromtitle=%E7%81%AB%E7%AE%AD&amp;fromid=8794081#viewPageContent&#x27;</span><br><span class="hljs-comment"># ç‡ƒæ°”æ¨è¿›è£…ç½®</span><br>url = <span class="hljs-string">&#x27;https://baike.baidu.com/item/%E7%81%AB%E7%AE%AD/6308#viewPageContent&#x27;</span><br>WebScrape(<span class="hljs-string">&#x27;ç«ç®­&#x27;</span>, url).run()<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨è¿™ä¸ªçˆ¬è™«ï¼Œæˆ‘ä»¬çˆ¬å–äº†â€œç«ç®­â€è¿™ä¸ªè¯è¯­çš„ä¸¤ä¸ªä¹‰é¡¹çš„è¯­æ–™ï¼Œç”Ÿæˆäº†ç«ç®­_ç‡ƒæ°”æ¨è¿›è£…ç½®.txtæ–‡ä»¶å’Œç«ç®­_NBAçƒé˜Ÿå.txtæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«å«æœ‰361å’Œ171ä¸ªå¥å­ã€‚ä»¥ç«ç®­_ç‡ƒæ°”æ¨è¿›è£…ç½®.txtæ–‡ä»¶ä¸ºä¾‹ï¼Œå‰10ä¸ªå¥å­å¦‚ä¸‹ï¼š</p><blockquote><p>ç«ç®­æŠ€æœ¯çš„é£é€Ÿå‘å±•ï¼Œä¸ä»…å¯æä¾›æ›´åŠ å®Œå–„çš„å„ç±»å¯¼å¼¹å’Œæ¨åŠ¨ç›¸å…³ç§‘å­¦çš„å‘å±•ï¼Œè¿˜å°†ä½¿å¼€å‘ç©ºé—´èµ„æºã€å»ºç«‹ç©ºé—´äº§ä¸šã€ç©ºé—´åŸºåœ°åŠæ˜Ÿé™…èˆªè¡Œç­‰æˆä¸ºå¯èƒ½ã€‚ç«ç®­æŠ€æœ¯æ˜¯ä¸€é¡¹ååˆ†å¤æ‚çš„ç»¼åˆæ€§æŠ€æœ¯ï¼Œä¸»è¦åŒ…æ‹¬ç«ç®­æ¨è¿›æŠ€æœ¯ã€æ€»ä½“è®¾è®¡æŠ€æœ¯ã€ç«ç®­ç»“æ„æŠ€æœ¯ã€æ§åˆ¶å’Œåˆ¶å¯¼æŠ€æœ¯ã€è®¡åˆ’ç®¡ç†æŠ€æœ¯ã€å¯é æ€§å’Œè´¨é‡æ§åˆ¶æŠ€æœ¯ã€è¯•éªŒæŠ€æœ¯ï¼Œå¯¹å¯¼å¼¹æ¥è¯´è¿˜æœ‰å¼¹å¤´åˆ¶å¯¼å’Œæ§åˆ¶ã€1903å¹´ï¼Œä¿„å›½çš„Ğš.E.é½å¥¥å°”ç§‘å¤«æ–¯åŸºæå‡ºäº†åˆ¶é€ å¤§å‹æ¶²ä½“ç«ç®­çš„è®¾æƒ³å’Œè®¾è®¡åŸç†ã€‚ç«ç®­æœ‰å¾ˆå¤šç§ï¼ŒåŸå§‹çš„ç«ç®­æ˜¯ç”¨å¼•ç«ç‰©é™„åœ¨å¼“ç®­å¤´ä¸Šï¼Œç„¶åå°„åˆ°æ•Œäººèº«ä¸Šå¼•èµ·ç„šçƒ§çš„ä¸€ç§ç®­çŸ¢ã€‚â€œé•¿å¾ä¸‰å·ä¸™â€ç«ç®­æ˜¯åœ¨ â€œé•¿å¾ä¸‰å·ä¹™â€ç«ç®­çš„åŸºç¡€ä¸Šï¼Œå‡å°‘äº†ä¸¤ä¸ªåŠ©æ¨å™¨å¹¶å–æ¶ˆäº†åŠ©æ¨å™¨ä¸Šçš„å°¾ç¿¼ã€‚ ç«ç®­ä¸å¯¼å¼¹æœ‰ä»€ä¹ˆåŒºåˆ«ä¸ºäº†èƒ½å¤Ÿåœ¨æœªæ¥å¤§è§„æ¨¡çš„å°†äººç±»é€å…¥å¤ªç©ºï¼Œä¸å¯èƒ½ä¾èµ–ä¼ ç»Ÿçš„ç«ç®­å’Œé£èˆ¹ã€‚ç«ç®­V2ç«ç®­æ¢æµ‹é«˜å±‚å¤§æ°”çš„ç‰©ç†ç‰¹å¾ï¼ˆå¦‚æ°”å‹ã€æ¸©åº¦ã€æ¹¿åº¦ç­‰ï¼‰å’Œç°è±¡çš„æ¢ç©ºç«ç®­ã€‚å¯ä¸€æ¬¡å‘å°„ä¸€å‘è‡³æ•°åå‘ç«ç®­å¼¹ã€‚</p></blockquote><h4 id="å®ç°ç®—æ³•">å®ç°ç®—æ³•</h4><p>æˆ‘ä»¬ä»¥å¥å­ä¸ºå•ä½è¿›è¡Œè¯ä¹‰æ¶ˆå²ï¼Œå³è¾“å…¥ä¸€å¥è¯ï¼Œè¯†åˆ«å‡ºè¯¥å¥å­ä¸­æŸä¸ªæ­§ä¹‰è¯çš„å«ä¹‰ã€‚ç¬”è€…ä½¿ç”¨çš„ç®—æ³•æ¯”è¾ƒç®€å•ï¼Œæ˜¯ä»¥TF-IDFä¸ºæƒé‡çš„é¢‘æ•°åˆ¤åˆ«ã€‚ä»¥å¥å­</p><blockquote><p>èµ›å­£åˆçš„æ—¶å€™ï¼Œç«ç®­æ˜¯ä¼—æœ›æ‰€å½’çš„è¥¿éƒ¨å†³èµ›çƒé˜Ÿã€‚</p></blockquote><p>ä¸ºä¾‹ï¼Œå¯¹è¯¥å¥å­åˆ†è¯åï¼Œå»æ‰åœç”¨è¯ï¼ˆstopwordsï¼‰ï¼Œç„¶ååˆ†åˆ«ç»Ÿè®¡é™¤äº†â€œç«ç®­â€è¿™ä¸ªè¯ä»¥å¤–çš„TF-IDFå€¼ï¼Œç´¯åŠ èµ·æ¥,æ¯”è¾ƒåœ¨ä¸¤ä¸ªä¹‰é¡¹ä¸‹è¿™ä¸ªå€¼çš„å¤§å°å³å¯ã€‚</p><p>å®ç°è¿™ä¸ªç®—æ³•çš„å®Œæ•´Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> jieba<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> log2<br><br><span class="hljs-comment"># è¯»å–æ¯ä¸ªä¹‰é¡¹çš„è¯­æ–™</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        lines = [_.strip() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> f.readlines()]<br>        <span class="hljs-keyword">return</span> lines<br><br><span class="hljs-comment"># å¯¹ç¤ºä¾‹å¥å­åˆ†è¯</span><br>sent = <span class="hljs-string">&#x27;èµ›å­£åˆçš„æ—¶å€™ï¼Œç«ç®­æ˜¯ä¼—æœ›æ‰€å½’çš„è¥¿éƒ¨å†³èµ›çƒé˜Ÿã€‚&#x27;</span><br>wsd_word = <span class="hljs-string">&#x27;ç«ç®­&#x27;</span><br><br>jieba.add_word(wsd_word)<br>sent_words = <span class="hljs-built_in">list</span>(jieba.cut(sent, cut_all=<span class="hljs-literal">False</span>))<br><br><span class="hljs-comment"># å»æ‰åœç”¨è¯</span><br>stopwords = [wsd_word, <span class="hljs-string">&#x27;æˆ‘&#x27;</span>, <span class="hljs-string">&#x27;ä½ &#x27;</span>, <span class="hljs-string">&#x27;å®ƒ&#x27;</span>, <span class="hljs-string">&#x27;ä»–&#x27;</span>, <span class="hljs-string">&#x27;å¥¹&#x27;</span>, <span class="hljs-string">&#x27;äº†&#x27;</span>, <span class="hljs-string">&#x27;æ˜¯&#x27;</span>, <span class="hljs-string">&#x27;çš„&#x27;</span>, <span class="hljs-string">&#x27;å•Š&#x27;</span>, <span class="hljs-string">&#x27;è°&#x27;</span>, <span class="hljs-string">&#x27;ä»€ä¹ˆ&#x27;</span>,<span class="hljs-string">&#x27;éƒ½&#x27;</span>,\<br>             <span class="hljs-string">&#x27;å¾ˆ&#x27;</span>, <span class="hljs-string">&#x27;ä¸ª&#x27;</span>, <span class="hljs-string">&#x27;ä¹‹&#x27;</span>, <span class="hljs-string">&#x27;äºº&#x27;</span>, <span class="hljs-string">&#x27;åœ¨&#x27;</span>, <span class="hljs-string">&#x27;ä¸Š&#x27;</span>, <span class="hljs-string">&#x27;ä¸‹&#x27;</span>, <span class="hljs-string">&#x27;å·¦&#x27;</span>, <span class="hljs-string">&#x27;å³&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;ï¼&#x27;</span>, <span class="hljs-string">&#x27;ï¼Ÿ&#x27;</span>]<br><br>sent_cut = []<br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent_words:<br>    <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stopwords:<br>        sent_cut.append(word)<br><br><span class="hljs-built_in">print</span>(sent_cut)<br><br><br><span class="hljs-comment"># è®¡ç®—å…¶ä»–è¯çš„TF-IDFä»¥åŠé¢‘æ•°</span><br>wsd_dict = &#123;&#125;<br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(<span class="hljs-string">&#x27;.&#x27;</span>):<br>    <span class="hljs-keyword">if</span> wsd_word <span class="hljs-keyword">in</span> file:<br>        wsd_dict[file.replace(<span class="hljs-string">&#x27;.txt&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)] = read_file(file)<br><br><span class="hljs-comment"># ç»Ÿè®¡æ¯ä¸ªè¯è¯­åœ¨è¯­æ–™ä¸­å‡ºç°çš„æ¬¡æ•°</span><br>tf_dict = &#123;&#125;<br><span class="hljs-keyword">for</span> meaning, sents <span class="hljs-keyword">in</span> wsd_dict.items():<br>    tf_dict[meaning] = []<br>    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent_cut:<br>        word_count = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents:<br>            example = <span class="hljs-built_in">list</span>(jieba.cut(sent, cut_all=<span class="hljs-literal">False</span>))<br>            word_count += example.count(word)<br><br>        <span class="hljs-keyword">if</span> word_count:<br>            tf_dict[meaning].append((word, word_count))<br><br>idf_dict = &#123;&#125;<br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent_cut:<br>    document_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> meaning, sents <span class="hljs-keyword">in</span> wsd_dict.items():<br>        <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents:<br>            <span class="hljs-keyword">if</span> word <span class="hljs-keyword">in</span> sent:<br>                document_count += <span class="hljs-number">1</span><br><br>    idf_dict[word] = document_count<br><br><span class="hljs-comment"># è¾“å‡ºå€¼</span><br>total_document = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> meaning, sents <span class="hljs-keyword">in</span> wsd_dict.items():<br>    total_document += <span class="hljs-built_in">len</span>(sents)<br><br><span class="hljs-comment"># è®¡ç®—tf_idfå€¼</span><br>mean_tf_idf = []<br><span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> tf_dict.items():<br>    <span class="hljs-built_in">print</span>(k+<span class="hljs-string">&#x27;:&#x27;</span>)<br>    tf_idf_sum = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> v:<br>        word = item[<span class="hljs-number">0</span>]<br>        tf = item[<span class="hljs-number">1</span>]<br>        tf_idf = item[<span class="hljs-number">1</span>]*log2(total_document/(<span class="hljs-number">1</span>+idf_dict[word]))<br>        tf_idf_sum += tf_idf<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%s, é¢‘æ•°ä¸º: %s, TF-IDFå€¼ä¸º: %s&#x27;</span>% (word, tf, tf_idf))<br><br>    mean_tf_idf.append((k, tf_idf_sum))<br><br>sort_array = <span class="hljs-built_in">sorted</span>(mean_tf_idf, key=<span class="hljs-keyword">lambda</span> x:x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)<br>true_meaning = sort_array[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>].split(<span class="hljs-string">&#x27;_&#x27;</span>)[<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\nç»è¿‡è¯ä¹‰æ¶ˆå²ï¼Œ%såœ¨è¯¥å¥å­ä¸­çš„æ„æ€ä¸º %s .&#x27;</span> % (wsd_word, true_meaning))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">[&#x27;èµ›å­£&#x27;, &#x27;åˆ&#x27;, &#x27;æ—¶å€™&#x27;, &#x27;ä¼—æœ›æ‰€å½’&#x27;, &#x27;è¥¿éƒ¨&#x27;, &#x27;å†³èµ›&#x27;, &#x27;çƒé˜Ÿ&#x27;]</span><br><span class="hljs-attribute">ç«ç®­_ç‡ƒæ°”æ¨è¿›è£…ç½®</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">åˆ, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2, TF-IDFå€¼ä¸º: 12.49585502688717</span><br><span class="hljs-attribute">ç«ç®­_NBAçƒé˜Ÿå</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">èµ›å­£, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">63, TF-IDFå€¼ä¸º: 204.6194333469459</span><br><span class="hljs-attribute">åˆ, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1, TF-IDFå€¼ä¸º: 6.247927513443585</span><br><span class="hljs-attribute">æ—¶å€™, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1, TF-IDFå€¼ä¸º: 8.055282435501189</span><br><span class="hljs-attribute">è¥¿éƒ¨, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">16, TF-IDFå€¼ä¸º: 80.88451896801904</span><br><span class="hljs-attribute">å†³èµ›, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">7, TF-IDFå€¼ä¸º: 33.13348038429679</span><br><span class="hljs-attribute">çƒé˜Ÿ, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">40, TF-IDFå€¼ä¸º: 158.712783770034</span><br><br>ç»è¿‡è¯ä¹‰æ¶ˆå²ï¼Œç«ç®­åœ¨è¯¥å¥å­ä¸­çš„æ„æ€ä¸º NBAçƒé˜Ÿå .<br></code></pre></td></tr></table></figure><h4 id="æµ‹è¯•">æµ‹è¯•</h4><p>æ¥ç€ï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„ç®—æ³•å’Œç¨‹åºè¿›è¡Œæ›´å¤šçš„æµ‹è¯•ã€‚</p><p>è¾“å…¥å¥å­ä¸º:</p><blockquote><p>ä¸‰åå¤šå¹´å‰ï¼Œæˆ˜å£«ä»¬åœ¨æˆˆå£æ»©ç™½æ‰‹èµ·å®¶ï¼Œå»ºèµ·äº†æˆ‘å›½çš„ç«ç®­å‘å°„åŸºåœ°ã€‚</p></blockquote><p>è¾“å‡ºç»“æœä¸º:</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[<span class="hljs-string">&#x27;ä¸‰åå¤šå¹´&#x27;</span>, <span class="hljs-string">&#x27;å‰&#x27;</span>, <span class="hljs-string">&#x27;æˆ˜å£«&#x27;</span>, <span class="hljs-string">&#x27;ä»¬&#x27;</span>, <span class="hljs-string">&#x27;æˆˆå£æ»©&#x27;</span>, <span class="hljs-string">&#x27;ç™½æ‰‹èµ·å®¶&#x27;</span>, <span class="hljs-string">&#x27;å»ºèµ·&#x27;</span>, <span class="hljs-string">&#x27;æˆ‘å›½&#x27;</span>, <span class="hljs-string">&#x27;å‘å°„&#x27;</span>, <span class="hljs-string">&#x27;åŸºåœ°&#x27;</span>]<br>ç«ç®­<span class="hljs-symbol">_</span>ç‡ƒæ°”æ¨è¿›è£…ç½®:<br>å‰, é¢‘æ•°ä¸º: <span class="hljs-number">2</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">9.063440958888354</span><br>ä»¬, é¢‘æ•°ä¸º: <span class="hljs-number">1</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">6.05528243550119</span><br>æˆ‘å›½, é¢‘æ•°ä¸º: <span class="hljs-number">3</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">22.410959804340102</span><br>å‘å°„, é¢‘æ•°ä¸º: <span class="hljs-number">89</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">253.27878721862933</span><br>åŸºåœ°, é¢‘æ•°ä¸º: <span class="hljs-number">7</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">42.38697704850833</span><br>ç«ç®­<span class="hljs-symbol">_NBA</span>çƒé˜Ÿå:<br>å‰, é¢‘æ•°ä¸º: <span class="hljs-number">3</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">13.59516143833253</span><br>ä»¬, é¢‘æ•°ä¸º: <span class="hljs-number">1</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">6.05528243550119</span><br><br>ç»è¿‡è¯ä¹‰æ¶ˆå²ï¼Œç«ç®­åœ¨è¯¥å¥å­ä¸­çš„æ„æ€ä¸º ç‡ƒæ°”æ¨è¿›è£…ç½® .<br></code></pre></td></tr></table></figure><p>è¾“å…¥å¥å­ä¸ºï¼š</p><blockquote><p>å¯¹äºé©¬åˆºè¿™æ ·çº§åˆ«çš„çƒé˜Ÿï¼Œå¸¸è§„èµ›åªæœ‰å±ˆæŒ‡å¯æ•°çš„å‡ æ¬¡äº¤é”‹å…·æœ‰çœŸæ­£çš„æ„ä¹‰ï¼Œä»Šå¤©å¯¹ç«ç®­ä¸€å½¹æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p></blockquote><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[<span class="hljs-string">&#x27;å¯¹äº&#x27;</span>, <span class="hljs-string">&#x27;é©¬åˆº&#x27;</span>, <span class="hljs-string">&#x27;è¿™æ ·&#x27;</span>, <span class="hljs-string">&#x27;çº§åˆ«&#x27;</span>, <span class="hljs-string">&#x27;çƒé˜Ÿ&#x27;</span>, <span class="hljs-string">&#x27;å¸¸è§„èµ›&#x27;</span>, <span class="hljs-string">&#x27;åªæœ‰&#x27;</span>, <span class="hljs-string">&#x27;å±ˆæŒ‡å¯æ•°&#x27;</span>, <span class="hljs-string">&#x27;å‡ æ¬¡&#x27;</span>, <span class="hljs-string">&#x27;äº¤é”‹&#x27;</span>, <span class="hljs-string">&#x27;å…·æœ‰&#x27;</span>, <span class="hljs-string">&#x27;çœŸæ­£&#x27;</span>, <span class="hljs-string">&#x27;æ„ä¹‰&#x27;</span>, <span class="hljs-string">&#x27;ä»Šå¤©&#x27;</span>, <span class="hljs-string">&#x27;å¯¹&#x27;</span>, <span class="hljs-string">&#x27;ä¸€å½¹&#x27;</span>, <span class="hljs-string">&#x27;å…¶ä¸­&#x27;</span>, <span class="hljs-string">&#x27;ä¹‹ä¸€&#x27;</span>]<br>ç«ç®­<span class="hljs-symbol">_</span>ç‡ƒæ°”æ¨è¿›è£…ç½®:<br>åªæœ‰, é¢‘æ•°ä¸º: <span class="hljs-number">1</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">7.470319934780034</span><br>å…·æœ‰, é¢‘æ•°ä¸º: <span class="hljs-number">5</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">32.35159967390017</span><br>çœŸæ­£, é¢‘æ•°ä¸º: <span class="hljs-number">2</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">14.940639869560068</span><br>æ„ä¹‰, é¢‘æ•°ä¸º: <span class="hljs-number">1</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">8.055282435501189</span><br>å¯¹, é¢‘æ•°ä¸º: <span class="hljs-number">5</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">24.03677461028802</span><br>å…¶ä¸­, é¢‘æ•°ä¸º: <span class="hljs-number">3</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">21.16584730650357</span><br>ä¹‹ä¸€, é¢‘æ•°ä¸º: <span class="hljs-number">2</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">14.11056487100238</span><br>ç«ç®­<span class="hljs-symbol">_NBA</span>çƒé˜Ÿå:<br>é©¬åˆº, é¢‘æ•°ä¸º: <span class="hljs-number">1</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">7.470319934780034</span><br>çƒé˜Ÿ, é¢‘æ•°ä¸º: <span class="hljs-number">40</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">158.712783770034</span><br>å¸¸è§„èµ›, é¢‘æ•°ä¸º: <span class="hljs-number">14</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">73.4709851882102</span><br>åªæœ‰, é¢‘æ•°ä¸º: <span class="hljs-number">1</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">7.470319934780034</span><br>å¯¹, é¢‘æ•°ä¸º: <span class="hljs-number">10</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">48.07354922057604</span><br>ä¹‹ä¸€, é¢‘æ•°ä¸º: <span class="hljs-number">1</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">7.05528243550119</span><br><br>ç»è¿‡è¯ä¹‰æ¶ˆå²ï¼Œç«ç®­åœ¨è¯¥å¥å­ä¸­çš„æ„æ€ä¸º <span class="hljs-symbol">NBA</span>çƒé˜Ÿå .<br></code></pre></td></tr></table></figure><p>è¾“å…¥å¥å­ä¸ºï¼š</p><blockquote><p>å§šæ˜æ˜¯ç«ç®­é˜Ÿçš„ä¸»è¦å¾—åˆ†æ‰‹ä¹‹ä¸€ã€‚</p></blockquote><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">[&#x27;å§šæ˜&#x27;, &#x27;ç«ç®­é˜Ÿ&#x27;, &#x27;ä¸»è¦&#x27;, &#x27;å¾—åˆ†æ‰‹&#x27;, &#x27;ä¹‹ä¸€&#x27;]</span><br><span class="hljs-attribute">ç«ç®­_ç‡ƒæ°”æ¨è¿›è£…ç½®</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">ä¸»è¦, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">9, TF-IDFå€¼ä¸º: 51.60018906552445</span><br><span class="hljs-attribute">ä¹‹ä¸€, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2, TF-IDFå€¼ä¸º: 14.11056487100238</span><br><span class="hljs-attribute">ç«ç®­_NBAçƒé˜Ÿå</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">å§šæ˜, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">18, TF-IDFå€¼ä¸º: 90.99508383902142</span><br><span class="hljs-attribute">ç«ç®­é˜Ÿ, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">133, TF-IDFå€¼ä¸º: 284.1437533641371</span><br><span class="hljs-attribute">ä¹‹ä¸€, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1, TF-IDFå€¼ä¸º: 7.05528243550119</span><br><br>ç»è¿‡è¯ä¹‰æ¶ˆå²ï¼Œç«ç®­åœ¨è¯¥å¥å­ä¸­çš„æ„æ€ä¸º NBAçƒé˜Ÿå .<br></code></pre></td></tr></table></figure><p>è¾“å…¥çš„å¥å­ä¸º:</p><blockquote><p>ä»1992å¹´å¼€å§‹ç ”åˆ¶çš„é•¿å¾äºŒå·Få‹ç«ç®­ï¼Œæ˜¯ä¸­å›½èˆªå¤©å²ä¸ŠæŠ€æœ¯æœ€å¤æ‚ã€å¯é æ€§å’Œå®‰å…¨æ€§æŒ‡æ ‡æœ€é«˜çš„è¿è½½ç«ç®­ã€‚</p></blockquote><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">[&#x27;ä»&#x27;, &#x27;1992&#x27;, &#x27;å¹´&#x27;, &#x27;å¼€å§‹&#x27;, &#x27;ç ”åˆ¶&#x27;, &#x27;é•¿å¾äºŒå·&#x27;, &#x27;F&#x27;, &#x27;å‹&#x27;, &#x27;ä¸­å›½&#x27;, &#x27;èˆªå¤©å²&#x27;, &#x27;æŠ€æœ¯&#x27;, &#x27;æœ€&#x27;, &#x27;å¤æ‚&#x27;, &#x27;ã€&#x27;, &#x27;å¯é æ€§&#x27;, &#x27;å’Œ&#x27;, &#x27;å®‰å…¨æ€§&#x27;, &#x27;æŒ‡æ ‡&#x27;, &#x27;æœ€é«˜&#x27;, &#x27;è¿è½½ç«ç®­&#x27;]</span><br><span class="hljs-attribute">ç«ç®­_ç‡ƒæ°”æ¨è¿›è£…ç½®</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">ä», é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">6, TF-IDFå€¼ä¸º: 29.312144604353264</span><br><span class="hljs-attribute">1992, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1, TF-IDFå€¼ä¸º: 6.733354340613827</span><br><span class="hljs-attribute">å¹´, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">43, TF-IDFå€¼ä¸º: 107.52982410441274</span><br><span class="hljs-attribute">å¼€å§‹, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">5, TF-IDFå€¼ä¸º: 30.27641217750595</span><br><span class="hljs-attribute">ç ”åˆ¶, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">25, TF-IDFå€¼ä¸º: 110.28565614316162</span><br><span class="hljs-attribute">é•¿å¾äºŒå·, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">37, TF-IDFå€¼ä¸º: 159.11461253349566</span><br><span class="hljs-attribute">F, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">7, TF-IDFå€¼ä¸º: 40.13348038429679</span><br><span class="hljs-attribute">ä¸­å›½, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">45, TF-IDFå€¼ä¸º: 153.51418105769093</span><br><span class="hljs-attribute">æŠ€æœ¯, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">27, TF-IDFå€¼ä¸º: 119.10850863461454</span><br><span class="hljs-attribute">æœ€, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2, TF-IDFå€¼ä¸º: 7.614709844115208</span><br><span class="hljs-attribute">ã€, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">117, TF-IDFå€¼ä¸º: 335.25857156467714</span><br><span class="hljs-attribute">å¯é æ€§, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">5, TF-IDFå€¼ä¸º: 30.27641217750595</span><br><span class="hljs-attribute">å’Œ, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">76, TF-IDFå€¼ä¸º: 191.22539545388003</span><br><span class="hljs-attribute">å®‰å…¨æ€§, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2, TF-IDFå€¼ä¸º: 14.940639869560068</span><br><span class="hljs-attribute">è¿è½½ç«ç®­, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">95, TF-IDFå€¼ä¸º: 256.28439093389505</span><br><span class="hljs-attribute">ç«ç®­_NBAçƒé˜Ÿå</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">ä», é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">5, TF-IDFå€¼ä¸º: 24.42678717029439</span><br><span class="hljs-attribute">1992, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2, TF-IDFå€¼ä¸º: 13.466708681227654</span><br><span class="hljs-attribute">å¹´, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">52, TF-IDFå€¼ä¸º: 130.0360663588247</span><br><span class="hljs-attribute">å¼€å§‹, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2, TF-IDFå€¼ä¸º: 12.11056487100238</span><br><span class="hljs-attribute">ä¸­å›½, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">4, TF-IDFå€¼ä¸º: 13.64570498290586</span><br><span class="hljs-attribute">æœ€, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">3, TF-IDFå€¼ä¸º: 11.422064766172813</span><br><span class="hljs-attribute">ã€, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">16, TF-IDFå€¼ä¸º: 45.847326025938756</span><br><span class="hljs-attribute">å’Œ, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">31, TF-IDFå€¼ä¸º: 77.99983235618791</span><br><span class="hljs-attribute">æœ€é«˜, é¢‘æ•°ä¸º</span><span class="hljs-punctuation">:</span> <span class="hljs-string">8, TF-IDFå€¼ä¸º: 59.76255947824027</span><br><br>ç»è¿‡è¯ä¹‰æ¶ˆå²ï¼Œç«ç®­åœ¨è¯¥å¥å­ä¸­çš„æ„æ€ä¸º ç‡ƒæ°”æ¨è¿›è£…ç½® .<br></code></pre></td></tr></table></figure><p>è¾“å…¥å¥å­ä¸ºï¼š</p><blockquote><p>åˆ°ç›®å‰ä¸ºæ­¢ç«ç®­å·²ç»åœ¨ä¼‘æ–¯é¡¿è¿›è¡Œäº†ç”µè§†å®£ä¼ ï¼Œå¹¶åœ¨å¤§è¡—å°å··ç«–èµ·å¹¿å‘Šæ ã€‚</p></blockquote><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[<span class="hljs-string">&#x27;åˆ°&#x27;</span>, <span class="hljs-string">&#x27;ç›®å‰ä¸ºæ­¢&#x27;</span>, <span class="hljs-string">&#x27;å·²ç»&#x27;</span>, <span class="hljs-string">&#x27;ä¼‘æ–¯é¡¿&#x27;</span>, <span class="hljs-string">&#x27;è¿›è¡Œ&#x27;</span>, <span class="hljs-string">&#x27;ç”µè§†&#x27;</span>, <span class="hljs-string">&#x27;å®£ä¼ &#x27;</span>, <span class="hljs-string">&#x27;å¹¶&#x27;</span>, <span class="hljs-string">&#x27;å¤§è¡—å°å··&#x27;</span>, <span class="hljs-string">&#x27;ç«–èµ·&#x27;</span>, <span class="hljs-string">&#x27;å¹¿å‘Šæ &#x27;</span>]<br>ç«ç®­<span class="hljs-symbol">_</span>ç‡ƒæ°”æ¨è¿›è£…ç½®:<br>åˆ°, é¢‘æ•°ä¸º: <span class="hljs-number">11</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">39.19772273088667</span><br>å·²ç», é¢‘æ•°ä¸º: <span class="hljs-number">2</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">13.466708681227654</span><br>è¿›è¡Œ, é¢‘æ•°ä¸º: <span class="hljs-number">14</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">68.39500407682429</span><br>å¹¶, é¢‘æ•°ä¸º: <span class="hljs-number">11</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">49.17351928258037</span><br>ç«ç®­<span class="hljs-symbol">_NBA</span>çƒé˜Ÿå:<br>åˆ°, é¢‘æ•°ä¸º: <span class="hljs-number">6</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">21.38057603502909</span><br>å·²ç», é¢‘æ•°ä¸º: <span class="hljs-number">2</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">13.466708681227654</span><br>ä¼‘æ–¯é¡¿, é¢‘æ•°ä¸º: <span class="hljs-number">2</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">14.940639869560068</span><br>è¿›è¡Œ, é¢‘æ•°ä¸º: <span class="hljs-number">2</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">9.770714868117755</span><br>å¹¶, é¢‘æ•°ä¸º: <span class="hljs-number">5</span>, <span class="hljs-symbol">TF</span>-<span class="hljs-symbol">IDF</span>å€¼ä¸º: <span class="hljs-number">22.351599673900168</span><br><br>ç»è¿‡è¯ä¹‰æ¶ˆå²ï¼Œç«ç®­åœ¨è¯¥å¥å­ä¸­çš„æ„æ€ä¸º ç‡ƒæ°”æ¨è¿›è£…ç½® .<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>å¯¹äºç¬”è€…çš„è¿™ä¸ªç®—æ³•ï¼Œè™½ç„¶æœ‰ä¸€å®šçš„æ•ˆæœï¼Œä½†æ˜¯ä¹Ÿä¸æ€»æ˜¯è¯†åˆ«æ­£ç¡®ã€‚æ¯”å¦‚ï¼Œå¯¹äºæœ€åä¸€ä¸ªæµ‹è¯•çš„å¥å­ï¼Œè¯†åˆ«çš„ç»“æœå°±æ˜¯é”™è¯¯çš„ï¼Œå…¶å®â€œä¼‘æ–¯é¡¿â€æ‰æ˜¯è¯†åˆ«è¯¥è¯è¯­ä¹‰é¡¹çš„å…³é”®è¯ï¼Œä½†å¾ˆé—æ†¾ï¼Œåœ¨ç¬”è€…çš„ç®—æ³•ä¸­ï¼Œâ€œä¼‘æ–¯é¡¿â€çš„æƒé‡å¹¶ä¸é«˜ã€‚</p><p>å¯¹äºè¯ä¹‰æ¶ˆå²ç®—æ³•ï¼Œå¦‚æœè¿˜æ˜¯ç¬”è€…çš„è¿™ä¸ªæ€è·¯ï¼Œé‚£ä¹ˆæœ‰ä»¥ä¸‹å‡ æ–¹é¢éœ€è¦æ”¹è¿›ï¼š</p><ul><li><p>è¯­æ–™å¤§å°åŠä¸°å¯Œç¨‹åº¦ï¼›</p></li><li><p>åœç”¨è¯çš„æ‰©å……ï¼›</p></li><li><p>æ›´å¥½çš„ç®—æ³•ã€‚</p><p>ç¬”è€…çš„è¿™ç¯‡æ–‡ç« ä»…ä½œä¸ºè¯ä¹‰æ¶ˆå²çš„ç®€ä»‹ä»¥åŠç®€å•å®ç°ï¼Œå¸Œæœ›èƒ½å¯¹è¯»è€…æœ‰æ‰€å¯å‘ï½</p></li></ul><p><strong>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</strong></p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>è¯ä¹‰æ¶ˆå²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆå…«ï¼‰ä½¿ç”¨CRF++å®ç°å‘½åå®ä½“è¯†åˆ«(NER)</title>
    <link href="/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8CRF-%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB-NER/"/>
    <url>/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8CRF-%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB-NER/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="crfä¸nerç®€ä»‹">CRFä¸NERç®€ä»‹</h3><p>CRFï¼Œè‹±æ–‡å…¨ç§°ä¸ºconditional random field,ä¸­æ–‡åä¸ºæ¡ä»¶éšæœºåœºï¼Œæ˜¯ç»™å®šä¸€ç»„è¾“å…¥éšæœºå˜é‡æ¡ä»¶ä¸‹å¦ä¸€ç»„è¾“å‡ºéšæœºå˜é‡çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒæ¨¡å‹ï¼Œå…¶ç‰¹ç‚¹æ˜¯å‡è®¾è¾“å‡ºéšæœºå˜é‡æ„æˆé©¬å°”å¯å¤«ï¼ˆMarkovï¼‰éšæœºåœºã€‚</p><p>è¾ƒä¸ºç®€å•çš„æ¡ä»¶éšæœºåœºæ˜¯å®šä¹‰åœ¨çº¿æ€§é“¾ä¸Šçš„æ¡ä»¶éšæœºåœºï¼Œç§°ä¸ºçº¿æ€§é“¾æ¡ä»¶éšæœºåœºï¼ˆlinearchain conditional random fieldï¼‰.çº¿æ€§é“¾æ¡ä»¶éšæœºåœºå¯ä»¥ç”¨äºåºåˆ—æ ‡æ³¨ç­‰é—®é¢˜ï¼Œè€Œæœ¬æ–‡éœ€è¦è§£å†³çš„å‘½åå®ä½“è¯†åˆ«(NER)ä»»åŠ¡æ­£å¥½å¯é€šè¿‡åºåˆ—æ ‡æ³¨æ–¹æ³•è§£å†³ã€‚è¿™æ—¶ï¼Œåœ¨æ¡ä»¶æ¦‚ç‡æ¨¡å‹P(Y|X)ä¸­ï¼ŒYæ˜¯è¾“å‡ºå˜é‡ï¼Œè¡¨ç¤ºæ ‡è®°åºåˆ—ï¼ˆæˆ–çŠ¶æ€åºåˆ—ï¼‰ï¼ŒXæ˜¯è¾“å…¥å˜é‡ï¼Œè¡¨ç¤ºéœ€è¦æ ‡æ³¨çš„è§‚æµ‹åºåˆ—ã€‚å­¦ä¹ æ—¶ï¼Œåˆ©ç”¨è®­ç»ƒæ•°æ®é›†é€šè¿‡æå¤§ä¼¼ç„¶ä¼°è®¡æˆ–æ­£åˆ™åŒ–çš„æå¤§ä¼¼ç„¶ä¼°è®¡å¾—åˆ°æ¡ä»¶æ¦‚ç‡æ¨¡å‹p(Y|X)ï¼›é¢„æµ‹æ—¶ï¼Œå¯¹äºç»™å®šçš„è¾“å…¥åºåˆ—xï¼Œæ±‚å‡ºæ¡ä»¶æ¦‚ç‡p(y|x)æœ€å¤§çš„è¾“å‡ºåºåˆ—y0.</p><p><img src="/img/nlp8_1.jpeg" /></p><p>å‘½åå®ä½“è¯†åˆ«ï¼ˆNamed EntityRecognitionï¼Œç®€ç§°NERï¼‰æ˜¯ä¿¡æ¯æå–ã€é—®ç­”ç³»ç»Ÿã€å¥æ³•åˆ†æã€æœºå™¨ç¿»è¯‘ç­‰åº”ç”¨é¢†åŸŸçš„é‡è¦åŸºç¡€å·¥å…·ï¼Œåœ¨è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯èµ°å‘å®ç”¨åŒ–çš„è¿‡ç¨‹ä¸­å æœ‰é‡è¦åœ°ä½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‘½åå®ä½“è¯†åˆ«çš„ä»»åŠ¡å°±æ˜¯è¯†åˆ«å‡ºå¾…å¤„ç†æ–‡æœ¬ä¸­ä¸‰å¤§ç±»ï¼ˆå®ä½“ç±»ã€æ—¶é—´ç±»å’Œæ•°å­—ç±»ï¼‰ã€ä¸ƒå°ç±»ï¼ˆäººåã€æœºæ„åã€åœ°åã€æ—¶é—´ã€æ—¥æœŸã€è´§å¸å’Œç™¾åˆ†æ¯”ï¼‰å‘½åå®ä½“ã€‚å¸¸è§çš„å®ç°NERçš„ç®—æ³•å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp8_2.jpeg" /></p><p>æœ¬æ–‡ä¸å‡†å¤‡è¯¦ç»†ä»‹ç»æ¡ä»¶éšæœºåœºçš„åŸç†ä¸å®ç°ç®—æ³•ï¼Œå…³äºå…·ä½“çš„åŸç†ä¸å®ç°ç®—æ³•ï¼Œå¯ä»¥å‚è€ƒã€Šç»Ÿè®¡å­¦ä¹ ç®—æ³•ã€‹ä¸€ä¹¦ã€‚æˆ‘ä»¬å°†å€ŸåŠ©å·²å®ç°æ¡ä»¶éšæœºåœºçš„å·¥å…·â€”â€”CRF++æ¥å®ç°å‘½åå®ä½“è¯†åˆ«ã€‚å…³äºç”¨æ·±åº¦å­¦ä¹ ç®—æ³•æ¥å®ç°å‘½åå®ä½“è¯†åˆ«ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« ï¼š<ahref="https://www.jianshu.com/p/ee750877ab6f">NLPå…¥é—¨ï¼ˆäº”ï¼‰ç”¨æ·±åº¦å­¦ä¹ å®ç°å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰</a>ã€‚</p><h3 id="crf">CRF++</h3><h4 id="ç®€ä»‹">ç®€ä»‹</h4><p>CRF++æ˜¯è‘—åçš„æ¡ä»¶éšæœºåœºçš„å¼€æºå·¥å…·ï¼Œä¹Ÿæ˜¯ç›®å‰ç»¼åˆæ€§èƒ½æœ€ä½³çš„CRFå·¥å…·ï¼Œé‡‡ç”¨C++è¯­è¨€ç¼–å†™è€Œæˆã€‚å…¶æœ€é‡è¦çš„åŠŸèƒ½æˆ‘è®¤ä¸ºæ˜¯é‡‡ç”¨äº†ç‰¹å¾æ¨¡æ¿ã€‚è¿™æ ·å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆä¸€ç³»åˆ—çš„ç‰¹å¾å‡½æ•°ï¼Œè€Œä¸ç”¨æˆ‘ä»¬è‡ªå·±ç”Ÿæˆç‰¹å¾å‡½æ•°ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å¯»æ‰¾ç‰¹å¾ï¼Œæ¯”å¦‚è¯æ€§ç­‰ã€‚å…³äºCRF++çš„ç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒç½‘å€ï¼š<ahref="http://taku910.github.io/crfpp/">http://taku910.github.io/crfpp/</a>ã€‚</p><h4 id="å®‰è£…">å®‰è£…</h4><p>CRF++çš„å®‰è£…å¯åˆ†ä¸ºWindowsç¯å¢ƒå’ŒLinuxç¯å¢ƒä¸‹çš„å®‰è£…ã€‚å…³äºLinuxç¯å¢ƒä¸‹çš„å®‰è£…ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« ï¼š<ahref="https://blog.51cto.com/wutengfei/2095715">CRFPP/CRF++ç¼–è¯‘å®‰è£…ä¸éƒ¨ç½²</a>ã€‚åœ¨Windowsä¸­CRF++ä¸éœ€è¦å®‰è£…ï¼Œä¸‹è½½è§£å‹CRF++0.58æ–‡ä»¶å³å¯ä»¥ä½¿ç”¨ï¼Œä¸‹è½½ç½‘å€ä¸ºï¼š<ahref="https://blog.csdn.net/lilong117194/article/details/81160265">https://blog.csdn.net/lilong117194/article/details/81160265</a>ã€‚</p><h4 id="ä½¿ç”¨">ä½¿ç”¨</h4><h5 id="è¯­æ–™">1. è¯­æ–™</h5><p>ä»¥æˆ‘ä»¬æœ¬æ¬¡ä½¿ç”¨çš„å‘½åå®ä½“è¯†åˆ«çš„è¯­æ–™ä¸ºä¾‹ï¼Œä½œä¸ºCRF++è®­ç»ƒçš„è¯­æ–™ï¼ˆå‰20è¡Œï¼Œæ¯ä¸€å¥è¯ä»¥ç©ºæ ¼éš”å¼€ã€‚ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">played VBD O<br>on IN O<br>Monday NNP O<br>( ( O<br>home NN O<br>team NN O<br><span class="hljs-keyword">in</span> IN O<br>CAPS NNP O<br>) ) O<br>: : O<br><br>American NNP B-MISC<br>League NNP I-MISC<br><br>Cleveland NNP B-ORG<br>2 CD O<br>DETROIT NNP B-ORG<br>1 CD O<br><br>BALTIMORE VB B-ORG<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„å­—ä¸æ ‡ç­¾ä¹‹é—´çš„åˆ†éš”ç¬¦ä¸ºåˆ¶è¡¨ç¬¦å¦åˆ™ä¼šå¯¼è‡´feature_index.cpp(86)[max_size == size] inconsistent column sizeé”™è¯¯ã€‚ ##### 2. æ¨¡æ¿æ¨¡æ¿æ˜¯ä½¿ç”¨CRF++çš„å…³é”®ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä¸€ç³»åˆ—çš„ç‰¹å¾å‡½æ•°ï¼Œè€Œä¸ç”¨æˆ‘ä»¬è‡ªå·±ç”Ÿæˆç‰¹å¾å‡½æ•°ï¼Œè€Œç‰¹å¾å‡½æ•°æ­£æ˜¯CRFç®—æ³•çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚ä¸€ä¸ªç®€å•çš„æ¨¡æ¿æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Unigram</span><br>U00:%x[-2,0]<br>U01:%x[0,1]<br>U02:%x[0,0]<br>U03:%x[1,0]<br>U04:%x[2,0]<br>U05:%x[-2,0]/%x[-1,0]/%x[0,0]<br>U06:%x[-1,0]/%x[0,0]/%x[1,0]<br>U07:%x[0,0]/%x[1,0]/%x[2,0]<br>U08:%x[-1,0]/%x[0,0]<br>U09:%x[0,0]/%x[1,0]<br> <br><span class="hljs-comment"># Bigram</span><br>B<br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å¥½å¥½ç†è§£ä¸‹æ¨¡æ¿æ–‡ä»¶çš„è§„åˆ™ã€‚T**:%x[#,#]ä¸­çš„Tè¡¨ç¤ºæ¨¡æ¿ç±»å‹ï¼Œä¸¤ä¸ª"#"åˆ†åˆ«è¡¨ç¤ºç›¸å¯¹çš„è¡Œåç§»ä¸åˆ—åç§»ã€‚ä¸€å…±æœ‰ä¸¤ç§æ¨¡æ¿ï¼š</p><ul><li>ç¬¬ä¸€ç§æ¨¡æ¿æ˜¯Unigram template:ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯Uï¼Œç”¨äºæè¿°unigramfeatureçš„æ¨¡æ¿ã€‚æ¯ä¸€è¡Œ%x[#,#]ç”Ÿæˆä¸€ä¸ªCRFä¸­çš„ç‚¹(state)å‡½æ•°: f(s, o),å…¶ä¸­sä¸ºtæ—¶åˆ»çš„çš„æ ‡ç­¾(output)ï¼Œoä¸ºtæ—¶åˆ»çš„ä¸Šä¸‹æ–‡ã€‚å‡è®¾<code>home NN O</code>æ‰€åœ¨è¡Œä¸º<code>CURRENT TOKEN</code>ï¼Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">played VBD O<br>on IN O<br>Monday NNP O<br>( ( O<br>home NN O &lt;&lt; <span class="hljs-string">CURRENT TOKEN</span><br><span class="hljs-string">team NN O</span><br><span class="hljs-string">in IN O</span><br><span class="hljs-string">CAPS NNP O</span><br><span class="hljs-string">) ) O</span><br><span class="hljs-string">: : O</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆ%x[#,#]çš„å¯¹åº”è§„åˆ™å¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>template</th><th>expanded feature</th></tr></thead><tbody><tr class="odd"><td>%x[0,0]</td><td>home</td></tr><tr class="even"><td>%x[0,1]</td><td>NN</td></tr><tr class="odd"><td>%x[-1,0]</td><td>(</td></tr><tr class="even"><td>%x[-2,1]</td><td>NNP</td></tr><tr class="odd"><td>%x[0,0]/%x[0,1]</td><td>home/NN</td></tr><tr class="even"><td>ABC%x[0,1]123</td><td>ABCNN123</td></tr></tbody></table><p>ä»¥â€œU01:%x[0,1]â€ä¸ºä¾‹ï¼Œå®ƒåœ¨è¯¥è¯­æ–™ä¸­ç”Ÿæˆçš„ç¤ºä¾‹å‡½æ•°å¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">func1 = <span class="hljs-keyword">if</span> (output = O and feature=<span class="hljs-string">&quot;U01:NN&quot;</span>) <span class="hljs-built_in">return</span> 1 <span class="hljs-keyword">else</span> <span class="hljs-built_in">return</span> 0<br>func2 = <span class="hljs-keyword">if</span> (output = O and feature=<span class="hljs-string">&quot;U01:N&quot;</span>) <span class="hljs-built_in">return</span> 1 <span class="hljs-keyword">else</span> <span class="hljs-built_in">return</span> 0<br>func3 = <span class="hljs-keyword">if</span> (output = O and feature=<span class="hljs-string">&quot;U01:NNP&quot;</span>) <span class="hljs-built_in">return</span> 1  <span class="hljs-keyword">else</span> <span class="hljs-built_in">return</span> 0<br>....<br></code></pre></td></tr></table></figure><ul><li>ç¬¬äºŒç§æ¨¡æ¿æ˜¯Bigramtemplate:ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯Bï¼Œæ¯ä¸€è¡Œ%x[#,#]ç”Ÿæˆä¸€ä¸ªCRFsä¸­çš„è¾¹(Edge)å‡½æ•°:f(s',s, o),å…¶ä¸­s'ä¸ºtâ€“1æ—¶åˆ»çš„æ ‡ç­¾ã€‚ä¹Ÿå°±æ˜¯è¯´,Bigramç±»å‹ä¸Unigramå¤§è‡´ç›¸åŒ,åªæ˜¯è¿˜è¦è€ƒè™‘åˆ°tâ€“1æ—¶åˆ»çš„æ ‡ç­¾ã€‚å¦‚æœåªå†™ä¸€ä¸ªBçš„è¯,é»˜è®¤ç”Ÿæˆf(s',s)ï¼Œè¿™æ„å‘³ç€å‰ä¸€ä¸ªoutput tokenå’Œcurrent tokenå°†ç»„åˆæˆbigramfeaturesã€‚</li></ul><h5 id="è®­ç»ƒ">3. è®­ç»ƒ</h5><p>CRF++çš„è®­ç»ƒå‘½ä»¤ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crf_learn  -f 3 -c 4.0 template train.data model -t<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œtemplateä¸ºæ¨¡æ¿æ–‡ä»¶ï¼Œtrain.dataä¸ºè®­ç»ƒè¯­æ–™ï¼Œ-tè¡¨ç¤ºå¯ä»¥å¾—åˆ°ä¸€ä¸ªmodelæ–‡ä»¶å’Œä¸€ä¸ªmodel.txtæ–‡ä»¶ï¼Œå…¶ä»–å¯é€‰å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">-f, â€“freq=INTä½¿ç”¨å±æ€§çš„å‡ºç°æ¬¡æ•°ä¸å°‘äºINT(é»˜è®¤ä¸º1)<br><br>-m, â€“maxiter=INTè®¾ç½®INTä¸ºLBFGSçš„æœ€å¤§è¿­ä»£æ¬¡æ•° (é»˜è®¤10k)<br><br>-c, â€“cost=FLOAT    è®¾ç½®FLOATä¸ºä»£ä»·å‚æ•°ï¼Œè¿‡å¤§ä¼šè¿‡åº¦æ‹Ÿåˆ (é»˜è®¤1.0)<br><br>-e, â€“eta=FLOATè®¾ç½®ç»ˆæ­¢æ ‡å‡†FLOAT(é»˜è®¤0.0001)<br><br>-C, â€“convertå°†æ–‡æœ¬æ¨¡å¼è½¬ä¸ºäºŒè¿›åˆ¶æ¨¡å¼<br><br>-t, â€“textmodelä¸ºè°ƒè¯•å»ºç«‹æ–‡æœ¬æ¨¡å‹æ–‡ä»¶<br><br>-a, â€“algorithm=(CRF|MIRA)    é€‰æ‹©è®­ç»ƒç®—æ³•ï¼Œé»˜è®¤ä¸ºCRF-L2<br><br>-p, â€“thread=INTçº¿ç¨‹æ•°(é»˜è®¤1)ï¼Œåˆ©ç”¨å¤šä¸ªCPUå‡å°‘è®­ç»ƒæ—¶é—´<br><br>-H, â€“shrinking-size=INT    è®¾ç½®INTä¸ºæœ€é€‚å®œçš„è·Œä»£å˜é‡æ¬¡æ•° (é»˜è®¤20)<br><br>-v, â€“versionæ˜¾ç¤ºç‰ˆæœ¬å·å¹¶é€€å‡º<br><br>-h, â€“<span class="hljs-built_in">help</span>æ˜¾ç¤ºå¸®åŠ©å¹¶é€€å‡º<br></code></pre></td></tr></table></figure><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šè¾“å‡ºä¸€äº›ä¿¡æ¯ï¼Œå…¶æ„ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">iterï¼šè¿­ä»£æ¬¡æ•°ã€‚å½“è¿­ä»£æ¬¡æ•°è¾¾åˆ°maxiteræ—¶ï¼Œè¿­ä»£ç»ˆæ­¢<br><br>terrï¼šæ ‡è®°é”™è¯¯ç‡<br><br>serrï¼šå¥å­é”™è¯¯ç‡<br><br>objï¼šå½“å‰å¯¹è±¡çš„å€¼ã€‚å½“è¿™ä¸ªå€¼æ”¶æ•›åˆ°ä¸€ä¸ªç¡®å®šå€¼çš„æ—¶å€™ï¼Œè®­ç»ƒå®Œæˆ<br><br>diffï¼šä¸ä¸Šä¸€ä¸ªå¯¹è±¡å€¼ä¹‹é—´çš„ç›¸å¯¹å·®ã€‚å½“æ­¤å€¼ä½äºetaæ—¶ï¼Œè®­ç»ƒå®Œæˆ<br></code></pre></td></tr></table></figure><h5 id="é¢„æµ‹">4. é¢„æµ‹</h5><p>åœ¨è®­ç»ƒå®Œæ¨¡å‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œé¢„æµ‹å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crf_test -m model NER_predict.data &gt; predict.txt<br></code></pre></td></tr></table></figure><p><code>-m model</code>è¡¨ç¤ºä½¿ç”¨æˆ‘ä»¬åˆšåˆšè®­ç»ƒå¥½çš„modelæ¨¡å‹ï¼Œé¢„æµ‹çš„æ•°æ®æ–‡ä»¶ä¸ºNER_predict.data,<code>&gt; predict.txt</code>è¡¨ç¤ºå°†é¢„æµ‹åçš„æ•°æ®å†™å…¥åˆ°predict.txtä¸­ã€‚</p><h3 id="nerå®ç°å®ä¾‹">NERå®ç°å®ä¾‹</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨CRF++æ¥å®ç°è‹±æ–‡å‘½åå®ä½“è¯†åˆ«åŠŸèƒ½ã€‚</p><p>æœ¬é¡¹ç›®å®ç°NERçš„è¯­æ–™åº“å¦‚ä¸‹(æ–‡ä»¶åä¸ºtrain.txtï¼Œä¸€å…±42000è¡Œï¼Œè¿™é‡Œåªå±•ç¤ºå‰15è¡Œï¼Œå¯ä»¥åœ¨æ–‡ç« æœ€åçš„Githubåœ°å€ä¸‹è½½è¯¥è¯­æ–™åº“)ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">played on Monday ( home team <span class="hljs-keyword">in</span> CAPS ) :<br>VBD IN NNP ( NN NN IN NNP ) :<br>O O O O O O O O O O<br>American League<br>NNP NNP<br>B-MISC I-MISC<br>Cleveland 2 DETROIT 1<br>NNP CD NNP CD<br>B-ORG O B-ORG O<br>BALTIMORE 12 Oakland 11 ( 10 innings )<br>VB CD NNP CD ( CD NN )<br>B-ORG O B-ORG O O O O O<br>TORONTO 5 Minnesota 3<br>TO CD NNP CD<br>B-ORG O B-ORG O<br>......<br></code></pre></td></tr></table></figure><p>ç®€å•ä»‹ç»ä¸‹è¯¥è¯­æ–™åº“çš„ç»“æ„ï¼šè¯¥è¯­æ–™åº“ä¸€å…±42000è¡Œï¼Œæ¯ä¸‰è¡Œä¸ºä¸€ç»„ï¼Œå…¶ä¸­ï¼Œç¬¬ä¸€è¡Œä¸ºè‹±è¯­å¥å­ï¼Œç¬¬äºŒè¡Œä¸ºå¥å­ä¸­æ¯ä¸ªå•è¯çš„è¯æ€§ï¼Œç¬¬ä¸‰è¡Œä¸ºNERç³»ç»Ÿçš„æ ‡æ³¨ï¼Œå…±åˆ†4ä¸ªæ ‡æ³¨ç±»åˆ«ï¼šPERï¼ˆäººåï¼‰ï¼ŒLOCï¼ˆä½ç½®ï¼‰ï¼ŒORGï¼ˆç»„ç»‡ï¼‰ä»¥åŠMISCï¼Œå…¶ä¸­Bè¡¨ç¤ºå¼€å§‹ï¼ŒIè¡¨ç¤ºä¸­é—´ï¼ŒOè¡¨ç¤ºå•å­—è¯ï¼Œä¸è®¡å…¥NERï¼ŒsOè¡¨ç¤ºç‰¹æ®Šå•å­—è¯ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å°†è¯¥è¯­æ–™åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ¯”ä¾‹ä¸º9:1ï¼Œå®ç°çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-comment"># NERé¢„æ–™train.txtæ‰€åœ¨çš„è·¯å¾„</span><br><span class="hljs-built_in">dir</span> = <span class="hljs-string">&quot;/Users/Shared/CRF_4_NER/CRF_TEST&quot;</span><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s/train.txt&quot;</span> % <span class="hljs-built_in">dir</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    sents = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f.readlines()]<br><br><span class="hljs-comment"># è®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„æ¯”ä¾‹ä¸º9:1</span><br>RATIO = <span class="hljs-number">0.9</span><br>train_num = <span class="hljs-built_in">int</span>((<span class="hljs-built_in">len</span>(sents)//<span class="hljs-number">3</span>)*RATIO)<br><br><span class="hljs-comment"># å°†æ–‡ä»¶åˆ†ä¸ºè®­ç»ƒé›†ä¸æµ‹è¯•é›†</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s/NER_train.data&quot;</span> % <span class="hljs-built_in">dir</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> g:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(train_num):<br>        words = sents[<span class="hljs-number">3</span>*i].split(<span class="hljs-string">&#x27;\t&#x27;</span>)<br>        postags = sents[<span class="hljs-number">3</span>*i+<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;\t&#x27;</span>)<br>        tags = sents[<span class="hljs-number">3</span>*i+<span class="hljs-number">2</span>].split(<span class="hljs-string">&#x27;\t&#x27;</span>)<br>        <span class="hljs-keyword">for</span> word, postag, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(words, postags, tags):<br>            g.write(word+<span class="hljs-string">&#x27; &#x27;</span>+postag+<span class="hljs-string">&#x27; &#x27;</span>+tag+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        g.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s/NER_test.data&quot;</span> % <span class="hljs-built_in">dir</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> h:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(train_num+<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(sents)//<span class="hljs-number">3</span>):<br>        words = sents[<span class="hljs-number">3</span>*i].split(<span class="hljs-string">&#x27;\t&#x27;</span>)<br>        postags = sents[<span class="hljs-number">3</span>*i+<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;\t&#x27;</span>)<br>        tags = sents[<span class="hljs-number">3</span>*i+<span class="hljs-number">2</span>].split(<span class="hljs-string">&#x27;\t&#x27;</span>)<br>        <span class="hljs-keyword">for</span> word, postag, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(words, postags, tags):<br>            h.write(word+<span class="hljs-string">&#x27; &#x27;</span>+postag+<span class="hljs-string">&#x27; &#x27;</span>+tag+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        h.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;OK!&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ­¤ç¨‹åºï¼Œå¾—åˆ°NER_train.data,æ­¤ä¸ºè®­ç»ƒé›†æ•°æ®ï¼ŒNER_test.dataï¼Œæ­¤ä¸ºæµ‹è¯•é›†æ•°æ®ã€‚NER_train.dataçš„å‰20è¡Œæ•°æ®å¦‚ä¸‹ï¼ˆä»¥ï¼‰ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">played</span> <span class="hljs-variable">VBD</span> <span class="hljs-built_in">O</span><br><span class="hljs-variable">on</span> <span class="hljs-variable">IN</span> <span class="hljs-built_in">O</span><br><span class="hljs-built_in">Monday</span> <span class="hljs-variable">NNP</span> <span class="hljs-built_in">O</span><br><span class="hljs-punctuation">(</span> <span class="hljs-punctuation">(</span> <span class="hljs-built_in">O</span><br><span class="hljs-variable">home</span> <span class="hljs-variable">NN</span> <span class="hljs-built_in">O</span><br><span class="hljs-variable">team</span> <span class="hljs-variable">NN</span> <span class="hljs-built_in">O</span><br><span class="hljs-variable">in</span> <span class="hljs-variable">IN</span> <span class="hljs-built_in">O</span><br><span class="hljs-variable">CAPS</span> <span class="hljs-variable">NNP</span> <span class="hljs-built_in">O</span><br><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">)</span> <span class="hljs-built_in">O</span><br><span class="hljs-operator">:</span> <span class="hljs-operator">:</span> <span class="hljs-built_in">O</span><br><br><span class="hljs-variable">American</span> <span class="hljs-variable">NNP</span> <span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">MISC</span><br><span class="hljs-variable">League</span> <span class="hljs-variable">NNP</span> <span class="hljs-built_in">I</span><span class="hljs-operator">-</span><span class="hljs-variable">MISC</span><br><br><span class="hljs-variable">Cleveland</span> <span class="hljs-variable">NNP</span> <span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">ORG</span><br><span class="hljs-number">2</span> <span class="hljs-variable">CD</span> <span class="hljs-built_in">O</span><br><span class="hljs-variable">DETROIT</span> <span class="hljs-variable">NNP</span> <span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">ORG</span><br><span class="hljs-number">1</span> <span class="hljs-variable">CD</span> <span class="hljs-built_in">O</span><br><br><span class="hljs-variable">BALTIMORE</span> <span class="hljs-variable">VB</span> <span class="hljs-variable">B</span><span class="hljs-operator">-</span><span class="hljs-variable">ORG</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨çš„æ¨¡æ¿æ–‡ä»¶templateå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Unigram</span><br><span class="hljs-attribute">U00</span>:%x[-<span class="hljs-number">2</span>,<span class="hljs-number">0</span>]<br><span class="hljs-attribute">U01</span>:%x[-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]<br><span class="hljs-attribute">U02</span>:%x[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br><span class="hljs-attribute">U03</span>:%x[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]<br><span class="hljs-attribute">U04</span>:%x[<span class="hljs-number">2</span>,<span class="hljs-number">0</span>]<br><span class="hljs-attribute">U05</span>:%x[-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]/%x[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br><span class="hljs-attribute">U06</span>:%x[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]/%x[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]<br><br><span class="hljs-attribute">U10</span>:%x[-<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U11</span>:%x[-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U12</span>:%x[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U13</span>:%x[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U14</span>:%x[<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U15</span>:%x[-<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]/%x[-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U16</span>:%x[-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]/%x[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U17</span>:%x[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]/%x[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U18</span>:%x[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]/%x[<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]<br><br><span class="hljs-attribute">U20</span>:%x[-<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]/%x[-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]/%x[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U21</span>:%x[-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]/%x[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]/%x[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]<br><span class="hljs-attribute">U22</span>:%x[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]/%x[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]/%x[<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]<br><br><span class="hljs-comment"># Bigram</span><br><span class="hljs-attribute">B</span><br></code></pre></td></tr></table></figure><p>æ¥ç€è®­ç»ƒè¯¥æ•°æ®ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crf_learn -c 3.0 template NER_train.data model -t<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ—¶çš„è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><img src="/img/nlp8_3.jpeg" /></p><p>åœ¨ç¬”è€…çš„ç”µè„‘ä¸Šä¸€å…±è¿­ä»£äº†193æ¬¡ï¼Œè¿è¡Œæ—¶é—´ä¸º490.32ç§’ï¼Œæ ‡è®°é”™è¯¯ç‡ä¸º0.00004ï¼Œå¥å­é”™è¯¯ç‡ä¸º0.00056ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµ‹è¯•é›†ä¸Šå¯¹è¯¥æ¨¡å‹çš„é¢„æµ‹è¡¨ç°åšè¯„ä¼°ã€‚é¢„æµ‹å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crf_test -m model NER_test.data &gt; result.txt<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Pythonè„šæœ¬ç»Ÿè®¡é¢„æµ‹çš„å‡†ç¡®ç‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-built_in">dir</span> = <span class="hljs-string">&quot;/Users/Shared/CRF_4_NER/CRF_TEST&quot;</span><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s/result.txt&quot;</span> % <span class="hljs-built_in">dir</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    sents = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f.readlines() <span class="hljs-keyword">if</span> line.strip()]<br><br>total = <span class="hljs-built_in">len</span>(sents)<br><span class="hljs-built_in">print</span>(total)<br><br>count = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents:<br>    words = sent.split()<br>    <span class="hljs-comment"># print(words)</span><br>    <span class="hljs-keyword">if</span> words[-<span class="hljs-number">1</span>] == words[-<span class="hljs-number">2</span>]:<br>        count += <span class="hljs-number">1</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Accuracy: %.4f&quot;</span> %(count/total))<br><span class="hljs-comment"># 0.9706</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">21487</span><br><span class="hljs-attribute">Accuracy</span>: <span class="hljs-number">0</span>.<span class="hljs-number">9706</span><br></code></pre></td></tr></table></figure><p>ç”±æ­¤å¯è§ï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡é«˜è¾¾0.9706ï¼Œæ•ˆæœç›¸å½“å¥½ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¯¹æ–°æ•°æ®è¿›è¡Œå‘½åå®ä½“è¯†åˆ«ï¼Œçœ‹çœ‹æ¨¡å‹åœ¨æ–°æ•°æ®ä¸Šçš„è¯†åˆ«æ•ˆæœã€‚å®ç°çš„Pythonä»£ç å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> nltk<br><br><span class="hljs-built_in">dir</span> = <span class="hljs-string">&quot;/Users/Shared/CRF_4_NER/CRF_TEST&quot;</span><br><br>sentence = <span class="hljs-string">&quot;Venezuelan opposition leader and self-proclaimed interim president Juan GuaidÃ³ said Thursday he will return to his country by Monday, and that a dialogue with President Nicolas Maduro won&#x27;t be possible without discussing elections.&quot;</span><br><span class="hljs-comment">#sentence = &quot;Real Madrid&#x27;s season on the brink after 3-0 Barcelona defeat&quot;</span><br><span class="hljs-comment"># sentence = &quot;British artist David Hockney is known as a voracious smoker, but the habit got him into a scrape in Amsterdam on Wednesday.&quot;</span><br><span class="hljs-comment"># sentence = &quot;India is waiting for the release of an pilot who has been in Pakistani custody since he was shot down over Kashmir on Wednesday, a goodwill gesture which could defuse the gravest crisis in the disputed border region in years.&quot;</span><br><span class="hljs-comment"># sentence = &quot;Instead, President Donald Trump&#x27;s second meeting with North Korean despot Kim Jong Un ended in a most uncharacteristic fashion for a showman commander in chief: fizzle.&quot;</span><br><span class="hljs-comment"># sentence = &quot;And in a press conference at the Civic Leadership Academy in Queens, de Blasio said the program is already working.&quot;</span><br><span class="hljs-comment">#sentence = &quot;The United States is a founding member of the United Nations, World Bank, International Monetary Fund.&quot;</span><br><br>default_wt = nltk.word_tokenize <span class="hljs-comment"># åˆ†è¯</span><br>words = default_wt(sentence)<br><span class="hljs-built_in">print</span>(words)<br>postags = nltk.pos_tag(words)<br><span class="hljs-built_in">print</span>(postags)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s/NER_predict.data&quot;</span> % <span class="hljs-built_in">dir</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> postags:<br>        f.write(item[<span class="hljs-number">0</span>]+<span class="hljs-string">&#x27; &#x27;</span>+item[<span class="hljs-number">1</span>]+<span class="hljs-string">&#x27; O\n&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;write successfully!&quot;</span>)<br><br>os.chdir(<span class="hljs-built_in">dir</span>)<br>os.system(<span class="hljs-string">&quot;crf_test -m model NER_predict.data &gt; predict.txt&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;get predict file!&quot;</span>)<br><br><span class="hljs-comment"># è¯»å–é¢„æµ‹æ–‡ä»¶redict.txt</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;%s/predict.txt&quot;</span> % <span class="hljs-built_in">dir</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    sents = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f.readlines() <span class="hljs-keyword">if</span> line.strip()]<br><br>word = []<br>predict = []<br><br><span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents:<br>    words = sent.split()<br>    word.append(words[<span class="hljs-number">0</span>])<br>    predict.append(words[-<span class="hljs-number">1</span>])<br><br><span class="hljs-comment"># print(word)</span><br><span class="hljs-comment"># print(predict)</span><br><br><span class="hljs-comment"># å»æ‰NERæ ‡æ³¨ä¸ºOçš„å…ƒç´ </span><br>ner_reg_list = []<br><span class="hljs-keyword">for</span> word, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(word, predict):<br>    <span class="hljs-keyword">if</span> tag != <span class="hljs-string">&#x27;O&#x27;</span>:<br>        ner_reg_list.append((word, tag))<br><br><span class="hljs-comment"># è¾“å‡ºæ¨¡å‹çš„NERè¯†åˆ«ç»“æœ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;NERè¯†åˆ«ç»“æœï¼š&quot;</span>)<br><span class="hljs-keyword">if</span> ner_reg_list:<br>    <span class="hljs-keyword">for</span> i, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(ner_reg_list):<br>        <span class="hljs-keyword">if</span> item[<span class="hljs-number">1</span>].startswith(<span class="hljs-string">&#x27;B&#x27;</span>):<br>            end = i+<span class="hljs-number">1</span><br>            <span class="hljs-keyword">while</span> end &lt;= <span class="hljs-built_in">len</span>(ner_reg_list)-<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> ner_reg_list[end][<span class="hljs-number">1</span>].startswith(<span class="hljs-string">&#x27;I&#x27;</span>):<br>                end += <span class="hljs-number">1</span><br><br>            ner_type = item[<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;-&#x27;</span>)[<span class="hljs-number">1</span>]<br>            ner_type_dict = &#123;<span class="hljs-string">&#x27;PER&#x27;</span>: <span class="hljs-string">&#x27;PERSON: &#x27;</span>,<br>                             <span class="hljs-string">&#x27;LOC&#x27;</span>: <span class="hljs-string">&#x27;LOCATION: &#x27;</span>,<br>                             <span class="hljs-string">&#x27;ORG&#x27;</span>: <span class="hljs-string">&#x27;ORGANIZATION: &#x27;</span>,<br>                             <span class="hljs-string">&#x27;MISC&#x27;</span>: <span class="hljs-string">&#x27;MISC: &#x27;</span><br>                            &#125;<br>            <span class="hljs-built_in">print</span>(ner_type_dict[ner_type], <span class="hljs-string">&#x27; &#x27;</span>.join([item[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> ner_reg_list[i:end]]))<br></code></pre></td></tr></table></figure><p>è¯†åˆ«çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">MISC:</span>  Venezuelan<br><span class="hljs-symbol">PERSON:</span>  Juan GuaidÃ³<br><span class="hljs-symbol">PERSON:</span>  Nicolas Maduro<br></code></pre></td></tr></table></figure><p>è¯†åˆ«æœ‰ä¸ªåœ°æ–¹ä¸å‡†ç¡®ï¼Œ Venezuelanåº”è¯¥æ˜¯LOCï¼Œè€Œä¸æ˜¯MISC.æˆ‘ä»¬å†æ¥ç€æµ‹è¯•å…¶å®ƒçš„æ–°æ•°æ®ï¼š</p><p>è¾“å…¥è¯­å¥1ï¼š</p><blockquote><p>Real Madrid's season on the brink after 3-0 Barcelona defeat</p></blockquote><p>è¯†åˆ«æ•ˆæœ1ï¼š</p><blockquote><p>ORGANIZATION: Real Madrid LOCATION: Barcelona</p></blockquote><p>è¾“å…¥è¯­å¥2ï¼š</p><blockquote><p>British artist David Hockney is known as a voracious smoker, but thehabit got him into a scrape in Amsterdam on Wednesday.</p></blockquote><p>è¯†åˆ«æ•ˆæœ2ï¼š</p><blockquote><p>MISC: British PERSON: David Hockney LOCATION: Amsterdam</p></blockquote><p>è¾“å…¥è¯­å¥3ï¼š</p><blockquote><p>India is waiting for the release of an pilot who has been inPakistani custody since he was shot down over Kashmir on Wednesday, agoodwill gesture which could defuse the gravest crisis in the disputedborder region in years.</p></blockquote><p>è¯†åˆ«æ•ˆæœ3ï¼š</p><blockquote><p>LOCATION: India LOCATION: Pakistani LOCATION: Kashmir</p></blockquote><p>è¾“å…¥è¯­å¥4ï¼š</p><blockquote><p>Instead, President Donald Trump's second meeting with North Koreandespot Kim Jong Un ended in a most uncharacteristic fashion for ashowman commander in chief: fizzle.</p></blockquote><p>è¯†åˆ«æ•ˆæœ4ï¼š</p><blockquote><p>PERSON: Donald Trump PERSON: Kim Jong Un</p></blockquote><p>è¾“å…¥è¯­å¥5ï¼š</p><blockquote><p>And in a press conference at the Civic Leadership Academy in Queens,de Blasio said the program is already working.</p></blockquote><p>è¯†åˆ«æ•ˆæœ5ï¼š</p><blockquote><p>ORGANIZATION: Civic Leadership Academy LOCATION: Queens PERSON: deBlasio</p></blockquote><p>è¾“å…¥è¯­å¥6ï¼š</p><blockquote><p>The United States is a founding member of the United Nations, WorldBank, International Monetary Fund.</p></blockquote><p>è¯†åˆ«æ•ˆæœ6ï¼š</p><blockquote><p>LOCATION: United States ORGANIZATION: United Nations PERSON: WorldBank ORGANIZATION: International Monetary Fund</p></blockquote><p>åœ¨è¿™äº›ä¾‹å­ä¸­ï¼Œæœ‰è®©æˆ‘ä»¬æƒŠå–œä¹‹å¤„ï¼šè¯†åˆ«å‡ºäº†äººç‰©Donald Trump, Kim JongUn. ä½†ä¹Ÿæœ‰äº›ä¸è¶³æŒ‡å‡ºï¼Œå¦‚å°†WorldBankè¯†åˆ«ä¸ºäººç‰©ï¼Œè€Œä¸æ˜¯ç»„ç»‡æœºæ„ã€‚æ€»çš„æ¥è¯´ï¼Œè¯†åˆ«æ•ˆæœè¿˜æ˜¯è®©äººæ»¡æ„çš„ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ€è¿‘ç”±äºå·¥ä½œç¹å¿™ï¼Œæ— æš‡é¡¾åŠåšå®¢ã€‚ä½†è½¬å¿µä¸€æƒ³ï¼ŒæŠ€æœ¯è¾“å‡ºä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œéœ€è¦é•¿æœŸåšæŒä¸‹å»ï½</p><p>æœ¬é¡¹ç›®çš„Githubåœ°å€ä¸ºï¼š<ahref="https://github.com/percent4/CRF_4_NER">https://github.com/percent4/CRF_4_NER</a>ã€‚</p><p>äº”ä¸€å°†è‡³ï¼Œç¥å¤§å®¶å‡æœŸæ„‰å¿«ï½</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>NER</tag>
      
      <tag>CRF++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆä¸ƒï¼‰ä¸­æ–‡é¢„å¤„ç†ä¹‹ç¹ç®€ä½“è½¬æ¢åŠè·å–æ‹¼éŸ³</title>
    <link href="/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%83%EF%BC%89%E4%B8%AD%E6%96%87%E9%A2%84%E5%A4%84%E7%90%86%E4%B9%8B%E7%B9%81%E7%AE%80%E4%BD%93%E8%BD%AC%E6%8D%A2%E5%8F%8A%E8%8E%B7%E5%8F%96%E6%8B%BC%E9%9F%B3/"/>
    <url>/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%83%EF%BC%89%E4%B8%AD%E6%96%87%E9%A2%84%E5%A4%84%E7%90%86%E4%B9%8B%E7%B9%81%E7%AE%80%E4%BD%93%E8%BD%AC%E6%8D%A2%E5%8F%8A%E8%8E%B7%E5%8F%96%E6%8B%BC%E9%9F%B3/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åœ¨æ—¥å¸¸çš„ä¸­æ–‡NLPä¸­ï¼Œç»å¸¸ä¼šæ¶‰åŠåˆ°ä¸­æ–‡çš„ç¹ç®€ä½“è½¬æ¢ä»¥åŠæ‹¼éŸ³çš„æ ‡æ³¨ç­‰é—®é¢˜ï¼Œæœ¬æ–‡å°†ä»‹ç»è¿™ä¸¤ä¸ªæ–¹é¢çš„å®ç°ã€‚</p><p>é¦–å…ˆæ˜¯ä¸­æ–‡çš„ç¹ç®€ä½“è½¬æ¢ï¼Œä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„Pythonæ¨¡å—ï¼Œè‡³éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªPythonä»£ç æ–‡ä»¶å³å¯ï¼š</p><ul><li><p>langconv.py åœ°å€ï¼š <ahref="https://raw.githubusercontent.com/skydark/nstools/master/zhtools/langconv.py">https://raw.githubusercontent.com/skydark/nstools/master/zhtools/langconv.py</a></p></li><li><p>zh_wiki.py åœ°å€ï¼š<ahref="https://raw.githubusercontent.com/skydark/nstools/master/zhtools/zh_wiki.py">https://raw.githubusercontent.com/skydark/nstools/master/zhtools/zh_wiki.py</a></p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼ˆå°†ä»£ç æ–‡ä»¶ä¸langconv.pyä¸zh_wiki.pyæ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ï¼‰ï¼š</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langconv <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è½¬æ¢ç¹ä½“åˆ°ç®€ä½“</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cht_2_chs</span>(<span class="hljs-params">line</span>):<br>    line = Converter(<span class="hljs-string">&#x27;zh-hans&#x27;</span>).convert(line)<br>    line.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-keyword">return</span> line<br><br>line_cht= <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">å°åŒ—å¸‚é•·æŸ¯æ–‡å“²ä»Šåœ¨è‡‰æ›¸é–‹ç›´æ’­ï¼Œå…ˆå‘ç¶²å‹å ±å‘Šè‡ªå·±3æœˆ16æ—¥è‡³24æ—¥è¦å‡ºè¨ªç¾åœ‹æ±éƒ¨4åŸå¸‚ï¼Œæ¥è‘—ä»–ç„¡é è­¦å®£å¸ƒï¼Œ</span><br><span class="hljs-string">2æœˆ23æ—¥è¦å…ˆå‡ºè¨ªä»¥è‰²åˆ—ï¼Œé è¨ˆåœç•™4è‡³5å¤©ã€‚é›–ä»–å¼·èª¿å°åŒ—å¸‚ã€ä»¥è‰²åˆ—å·²åœ¨è³‡å®‰æ–¹é¢æœ‰æ‰€äº¤æµï¼Œä¹Ÿå¯åˆ°ç•¶åœ°åŸå¸‚äº¤æµã€</span><br><span class="hljs-string">åƒè§€ç”¢æ¥­å‰µæ–°ç­‰å…§å®¹ï¼Œä½†æŸ¯ä¹Ÿèªªã€Œä¹Ÿæ˜¯å»çœ‹çœ‹ä¸€å€‹å°åœ‹åœ¨é€™éº¼æƒ¡åŠ£ç’°å¢ƒï¼Œhowtosurviveï¼Œä»–çš„ç¥•è¨£æ˜¯ä»€éº¼ï¼Ÿã€é€™ç•ªè©±ï¼Œ</span><br><span class="hljs-string">ä¹Ÿè¢«è§£è®€ï¼Œé —æœ‰æ›´ä¸Šå±¤æ¨“ã€ç›´æŒ‡ç¸½çµ±å¤§ä½çš„æ€ç¶­ã€‚</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>line_cht = line_cht.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>ret_chs = cht_2_chs(line_cht)<br><span class="hljs-built_in">print</span>(ret_chs)<br><br><span class="hljs-comment"># è½¬æ¢ç®€ä½“åˆ°ç¹ä½“</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chs_2_cht</span>(<span class="hljs-params">sentence</span>):<br>    sentence = Converter(<span class="hljs-string">&#x27;zh-hant&#x27;</span>).convert(sentence)<br>    <span class="hljs-keyword">return</span> sentence<br><br>line_chs = <span class="hljs-string">&#x27;å¿§éƒçš„å°æ¹¾ä¹Œé¾Ÿ&#x27;</span><br>line_cht = chs_2_cht(line_chs)<br><span class="hljs-built_in">print</span>(line_cht)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>å°åŒ—å¸‚é•¿æŸ¯æ–‡å“²ä»Šåœ¨è„¸ä¹¦å¼€ç›´æ’­ï¼Œå…ˆå‘ç½‘å‹æŠ¥å‘Šè‡ªå·±3æœˆ16æ—¥è‡³24æ—¥è¦å‡ºè®¿ç¾å›½ä¸œéƒ¨4åŸå¸‚ï¼Œæ¥ç€ä»–æ— é¢„è­¦å®£å¸ƒï¼Œ2æœˆ23æ—¥è¦å…ˆå‡ºè®¿ä»¥è‰²åˆ—ï¼Œé¢„è®¡åœç•™4è‡³5å¤©ã€‚è™½ä»–å¼ºè°ƒå°åŒ—å¸‚ã€ä»¥è‰²åˆ—å·²åœ¨èµ„å®‰æ–¹é¢æœ‰æ‰€äº¤æµï¼Œä¹Ÿå¯åˆ°å½“åœ°åŸå¸‚äº¤æµã€å‚è§‚äº§ä¸šåˆ›æ–°ç­‰å†…å®¹ï¼Œä½†æŸ¯ä¹Ÿè¯´ã€Œä¹Ÿæ˜¯å»çœ‹çœ‹ä¸€ä¸ªå°å›½åœ¨è¿™ä¹ˆæ¶åŠ£ç¯å¢ƒï¼Œhowtosurviveï¼Œä»–çš„ç¥•è¯€æ˜¯ä»€ä¹ˆï¼Ÿã€è¿™ç•ªè¯ï¼Œä¹Ÿè¢«è§£è¯»ï¼Œé¢‡æœ‰æ›´ä¸Šå±‚æ¥¼ã€ç›´æŒ‡æ€»ç»Ÿå¤§ä½çš„æ€ç»´ã€‚æ†‚éƒçš„è‡ºç£çƒé¾œ</p></blockquote><p>æ¥ç€æ˜¯è·å–ä¸­æ–‡æ±‰å­—çš„æ‹¼éŸ³ï¼Œè¿™æ–¹é¢çš„Pythonæ¨¡å—æœ‰xpinyin,pypinyinç­‰ã€‚æœ¬æ–‡ä»¥xpinyinä¸ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•è·å–æ±‰å­—çš„æ‹¼éŸ³ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> xpinyin <span class="hljs-keyword">import</span> Pinyin<br><br>p = Pinyin()<br><br><span class="hljs-comment"># é»˜è®¤åˆ†éš”ç¬¦ä¸º-</span><br><span class="hljs-built_in">print</span>(p.get_pinyin(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>))<br><br><span class="hljs-comment"># æ˜¾ç¤ºå£°è°ƒ</span><br><span class="hljs-built_in">print</span>(p.get_pinyin(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>, tone_marks=<span class="hljs-string">&#x27;marks&#x27;</span>))<br><span class="hljs-built_in">print</span>(p.get_pinyin(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>, tone_marks=<span class="hljs-string">&#x27;numbers&#x27;</span>))<br><br><span class="hljs-comment"># å»æ‰åˆ†éš”ç¬¦</span><br><span class="hljs-built_in">print</span>(p.get_pinyin(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>, <span class="hljs-string">&#x27;&#x27;</span>))<br><span class="hljs-comment"># è®¾ä¸ºåˆ†éš”ç¬¦ä¸ºç©ºæ ¼</span><br><span class="hljs-built_in">print</span>(p.get_pinyin(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>, <span class="hljs-string">&#x27; &#x27;</span>))<br><br><span class="hljs-comment"># è·å–æ‹¼éŸ³é¦–å­—æ¯</span><br><span class="hljs-built_in">print</span>(p.get_initial(<span class="hljs-string">&quot;ä¸Š&quot;</span>))<br><span class="hljs-built_in">print</span>(p.get_initials(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>))<br><span class="hljs-built_in">print</span>(p.get_initials(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>, <span class="hljs-string">&#x27;&#x27;</span>))<br><span class="hljs-built_in">print</span>(p.get_initials(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>, <span class="hljs-string">&#x27; &#x27;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">shang-hai</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">shÃ ng-hÇi</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">shang4-hai3</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">shanghai</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">shang </span>hai<br>S<br>S-H<br><span class="hljs-keyword">SH</span><br><span class="hljs-keyword"></span>S H<br></code></pre></td></tr></table></figure><p>æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»~</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>ç¹ç®€ä½“è½¬æ¢</tag>
      
      <tag>æ‹¼éŸ³</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆå…­ï¼‰pyltpçš„ä»‹ç»ä¸ä½¿ç”¨</title>
    <link href="/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89pyltp%E7%9A%84%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89pyltp%E7%9A%84%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="pyltpçš„ç®€ä»‹">pyltpçš„ç®€ä»‹</h3><p>è¯­è¨€æŠ€æœ¯å¹³å°(LTP)ç»è¿‡å“ˆå·¥å¤§ç¤¾ä¼šè®¡ç®—ä¸ä¿¡æ¯æ£€ç´¢ç ”ç©¶ä¸­å¿ƒ 11å¹´çš„æŒç»­ç ”å‘å’Œæ¨å¹¿ï¼Œæ˜¯å›½å†…å¤–æœ€å…·å½±å“åŠ›çš„ä¸­æ–‡å¤„ç†åŸºç¡€å¹³å°ã€‚å®ƒæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ä¸­æ–‡åˆ†è¯ã€è¯æ€§æ ‡æ³¨ã€å‘½åå®ä½“è¯†åˆ«ã€ä¾å­˜å¥æ³•åˆ†æã€è¯­ä¹‰è§’è‰²æ ‡æ³¨ç­‰ã€‚</p><figure><img src="/img/nlp6_1.png" alt="è¯­è¨€æŠ€æœ¯å¹³å°æ¶æ„" /><figcaption aria-hidden="true">è¯­è¨€æŠ€æœ¯å¹³å°æ¶æ„</figcaption></figure><p>pyltp æ˜¯ LTP çš„ Pythonå°è£…ï¼ŒåŒæ—¶æ”¯æŒPython2å’ŒPython3ç‰ˆæœ¬ã€‚Python3çš„å®‰è£…æ–¹æ³•ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install pyltp<br></code></pre></td></tr></table></figure><ul><li><p>å®˜ç½‘ä¸‹è½½ç½‘å€ï¼šhttps://pypi.org/project/pyltp/0.1.7/</p></li><li><p>å®˜æ–¹ä½¿ç”¨è¯´æ˜æ–‡æ¡£ï¼šhttps://pyltp.readthedocs.io/zh_CN/develop/api.html</p><p>åœ¨ä½¿ç”¨è¯¥æ¨¡å—å‰ï¼Œéœ€è¦ä¸‹è½½å®Œæ•´çš„æ¨¡å‹æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸‹è½½åœ°å€ä¸ºï¼š<ahref="https://pan.baidu.com/share/link?shareid=1988562907&amp;uk=2738088569#list/path=%2F">https://pan.baidu.com/share/link?shareid=1988562907&amp;uk=2738088569#list/path=%2F</a>ã€‚pyltp çš„æ‰€æœ‰è¾“å…¥çš„åˆ†ææ–‡æœ¬å’Œè¾“å‡ºçš„ç»“æœçš„ç¼–ç å‡ä¸ºUTF-8ã€‚æ¨¡å‹çš„æ•°æ®æ–‡ä»¶å¦‚ä¸‹ï¼š</p></li></ul><figure><img src="/img/nlp6_2.png" alt="æ¨¡å‹æ•°æ®" /><figcaption aria-hidden="true">æ¨¡å‹æ•°æ®</figcaption></figure><p>å…¶ä¸­ï¼Œcws.modelç”¨äºåˆ†è¯æ¨¡å‹ï¼Œlexicon.txtä¸ºåˆ†è¯æ—¶æ·»åŠ çš„ç”¨æˆ·å­—å…¸ï¼Œner.modelä¸ºå‘½åå®ä½“è¯†åˆ«æ¨¡å‹ï¼Œparser.modelä¸ºä¾å­˜å¥æ³•åˆ†ææ¨¡å‹ï¼Œpisrl.modelä¸ºè¯­ä¹‰è§’è‰²æ ‡æ³¨æ¨¡å‹ï¼Œposä¸ºè¯æ€§æ ‡æ³¨æ¨¡å‹ã€‚</p><h3 id="pyltpçš„ä½¿ç”¨">pyltpçš„ä½¿ç”¨</h3><p>pyltpçš„ä½¿ç”¨ç¤ºä¾‹é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp6_3.png" alt="ç¤ºä¾‹é¡¹ç›®" /><figcaption aria-hidden="true">ç¤ºä¾‹é¡¹ç›®</figcaption></figure><h5 id="åˆ†å¥">åˆ†å¥</h5><p>åˆ†å¥æŒ‡çš„æ˜¯å°†ä¸€æ®µè¯æˆ–ä¸€ç‰‡æ–‡ç« ä¸­çš„æ–‡å­—æŒ‰å¥å­åˆ†å¼€ï¼ŒæŒ‰å¥å­å½¢æˆç‹¬ç«‹çš„å•å…ƒã€‚ç¤ºä¾‹çš„Pythonä»£ç sentenct_split.pyå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> SentenceSplitter<br><br><span class="hljs-comment"># åˆ†å¥</span><br>doc = <span class="hljs-string">&#x27;æ®éŸ©è”ç¤¾12æœˆ28æ—¥åæ˜ ï¼Œç¾å›½é˜²éƒ¨å‘è¨€äººæ°å¤«Â·è«è±å°”27æ—¥è¡¨ç¤ºï¼Œç¾å›½é˜²éƒ¨é•¿ç›–èŒ¨å°†äº2011å¹´1æœˆ14æ—¥è®¿é—®éŸ©å›½ã€‚&#x27;</span> \<br>      <span class="hljs-string">&#x27;ç›–èŒ¨åŸè®¡åˆ’ä»æ˜å¹´1æœˆ9æ—¥è‡³14æ—¥é™†ç»­è®¿é—®ä¸­å›½å’Œæ—¥æœ¬ï¼Œç›®å‰ï¼Œä»–å†³å®šåœ¨è¡Œç¨‹ä¸­å¢åŠ å¯¹éŸ©å›½çš„è®¿é—®ã€‚è«è±å°”è¡¨ç¤ºï¼Œ&#x27;</span> \<br>      <span class="hljs-string">&#x27;ç›–èŒ¨åœ¨è®¿éŸ©æœŸé—´å°†ä¼šæ™¤éŸ©å›½å›½é˜²éƒ¨é•¿å®˜é‡‘å®½é•‡ï¼Œå°±æœé²œè¿‘æ—¥çš„è¡ŒåŠ¨äº¤æ¢æ„è§ï¼ŒåŒæ—¶å•†è®¨åŠ å¼ºéŸ©ç¾ä¸¤å†›åŒç›Ÿå…³ç³»ç­‰é—®é¢˜ï¼Œ&#x27;</span> \<br>      <span class="hljs-string">&#x27;æ‹Ÿå®šå…±åŒåº”å¯¹æœé²œæŒ‘è¡…å’Œæ ¸è®¡åˆ’çš„æ–¹æ¡ˆã€‚&#x27;</span><br>sents = SentenceSplitter.split(doc)  <span class="hljs-comment"># åˆ†å¥</span><br><br><br><span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents:<br>    <span class="hljs-built_in">print</span>(sent)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">æ®éŸ©è”ç¤¾<span class="hljs-number">12</span>æœˆ<span class="hljs-number">28</span>æ—¥åæ˜ ï¼Œç¾å›½é˜²éƒ¨å‘è¨€äººæ°å¤«Â·è«è±å°”<span class="hljs-number">27</span>æ—¥è¡¨ç¤ºï¼Œç¾å›½é˜²éƒ¨é•¿ç›–èŒ¨å°†äº<span class="hljs-number">2011å¹´1æœˆ14</span>æ—¥è®¿é—®éŸ©å›½ã€‚<br>ç›–èŒ¨åŸè®¡åˆ’ä»æ˜å¹´<span class="hljs-number">1</span>æœˆ<span class="hljs-number">9</span>æ—¥è‡³<span class="hljs-number">14</span>æ—¥é™†ç»­è®¿é—®ä¸­å›½å’Œæ—¥æœ¬ï¼Œç›®å‰ï¼Œä»–å†³å®šåœ¨è¡Œç¨‹ä¸­å¢åŠ å¯¹éŸ©å›½çš„è®¿é—®ã€‚<br>è«è±å°”è¡¨ç¤ºï¼Œç›–èŒ¨åœ¨è®¿éŸ©æœŸé—´å°†ä¼šæ™¤éŸ©å›½å›½é˜²éƒ¨é•¿å®˜é‡‘å®½é•‡ï¼Œå°±æœé²œè¿‘æ—¥çš„è¡ŒåŠ¨äº¤æ¢æ„è§ï¼ŒåŒæ—¶å•†è®¨åŠ å¼ºéŸ©ç¾ä¸¤å†›åŒç›Ÿå…³ç³»ç­‰é—®é¢˜ï¼Œæ‹Ÿå®šå…±åŒåº”å¯¹æœé²œæŒ‘è¡…å’Œæ ¸è®¡åˆ’çš„æ–¹æ¡ˆã€‚<br></code></pre></td></tr></table></figure><h5 id="åˆ†è¯">åˆ†è¯</h5><p>åˆ†è¯æŒ‡çš„æ˜¯å°†ä¸€å¥è¯æŒ‰è¯è¯­åˆ†å¼€ï¼ŒæŒ‰è¯è¯­å½¢æˆç‹¬ç«‹çš„å•å…ƒã€‚ç¤ºä¾‹çš„Pythonä»£ç words_split.pyå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Segmentor<br><br>cws_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/cws.model&#x27;</span>)  <span class="hljs-comment"># åˆ†è¯æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`cws.model`</span><br>lexicon_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/lexicon.txt&#x27;</span>)  <span class="hljs-comment"># å‚æ•°lexiconæ˜¯è‡ªå®šä¹‰è¯å…¸çš„æ–‡ä»¶è·¯å¾„</span><br><br>segmentor = Segmentor()<br>segmentor.load_with_lexicon(cws_model_path, lexicon_path)<br><br>sent = <span class="hljs-string">&#x27;æ®éŸ©è”ç¤¾12æœˆ28æ—¥åæ˜ ï¼Œç¾å›½é˜²éƒ¨å‘è¨€äººæ°å¤«Â·è«è±å°”27æ—¥è¡¨ç¤ºï¼Œç¾å›½é˜²éƒ¨é•¿ç›–èŒ¨å°†äº2011å¹´1æœˆ14æ—¥è®¿é—®éŸ©å›½ã€‚&#x27;</span><br>words = segmentor.segment(sent)  <span class="hljs-comment"># åˆ†è¯</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;/&#x27;</span>.join(words))<br><br>segmentor.release()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ®<span class="hljs-regexp">/éŸ©è”ç¤¾/</span><span class="hljs-number">12</span>æœˆ<span class="hljs-regexp">/28æ—¥/</span>åæ˜ <span class="hljs-regexp">/ï¼Œ/</span>ç¾<span class="hljs-regexp">/å›½é˜²éƒ¨/</span>å‘è¨€äºº<span class="hljs-regexp">/æ°å¤«Â·è«è±å°”/</span><span class="hljs-number">27</span>æ—¥<span class="hljs-regexp">/è¡¨ç¤º/</span>ï¼Œ<span class="hljs-regexp">/ç¾/</span>å›½é˜²éƒ¨é•¿<span class="hljs-regexp">/ç›–èŒ¨/</span>å°†<span class="hljs-regexp">/äº/</span><span class="hljs-number">2011</span>å¹´<span class="hljs-regexp">/1æœˆ/</span><span class="hljs-number">14</span>æ—¥<span class="hljs-regexp">/è®¿é—®/</span>éŸ©å›½/ã€‚<br></code></pre></td></tr></table></figure><h5 id="è¯æ€§æ ‡æ³¨">è¯æ€§æ ‡æ³¨</h5><p>è¯æ€§æ ‡æ³¨æŒ‡çš„æ˜¯ä¸€å¥è¯åˆ†å®Œè¯åï¼Œåˆ¶å®šæ¯ä¸ªè¯è¯­çš„è¯æ€§ã€‚ç¤ºä¾‹çš„Pythonä»£ç postagger.pyå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Segmentor, Postagger<br><br><span class="hljs-comment"># åˆ†è¯</span><br>cws_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/cws.model&#x27;</span>)  <span class="hljs-comment"># åˆ†è¯æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`cws.model`</span><br>lexicon_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/lexicon.txt&#x27;</span>)  <span class="hljs-comment"># å‚æ•°lexiconæ˜¯è‡ªå®šä¹‰è¯å…¸çš„æ–‡ä»¶è·¯å¾„</span><br><br>segmentor = Segmentor()<br>segmentor.load_with_lexicon(cws_model_path, lexicon_path)<br><br>sent = <span class="hljs-string">&#x27;æ®éŸ©è”ç¤¾12æœˆ28æ—¥åæ˜ ï¼Œç¾å›½é˜²éƒ¨å‘è¨€äººæ°å¤«Â·è«è±å°”27æ—¥è¡¨ç¤ºï¼Œç¾å›½é˜²éƒ¨é•¿ç›–èŒ¨å°†äº2011å¹´1æœˆ14æ—¥è®¿é—®éŸ©å›½ã€‚&#x27;</span><br>words = segmentor.segment(sent)  <span class="hljs-comment"># åˆ†è¯</span><br><br><span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br>pos_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/pos.model&#x27;</span>)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`pos.model`</span><br><br>postagger = Postagger()  <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>postagger.load(pos_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>postags = postagger.postag(words)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br><br><span class="hljs-keyword">for</span> word, postag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(words, postags):<br>    <span class="hljs-built_in">print</span>(word, postag)<br><br><span class="hljs-comment"># é‡Šæ”¾æ¨¡å‹</span><br>segmentor.release()<br>postagger.release()<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è¯æ€§æ ‡æ³¨ç»“æœè¯´æ˜</span><br><span class="hljs-string">https://ltp.readthedocs.io/zh_CN/latest/appendix.html#id3</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs excel">æ® p<br>éŸ©è”ç¤¾ ni<br><span class="hljs-number">12</span>æœˆ nt<br><span class="hljs-number">28</span>æ—¥ nt<br>åæ˜  v<br>ï¼Œ wp<br>ç¾ j<br>å›½é˜²éƒ¨ <span class="hljs-built_in">n</span><br>å‘è¨€äºº <span class="hljs-built_in">n</span><br>æ°å¤«Â·è«è±å°” nh<br><span class="hljs-number">27</span>æ—¥ nt<br>è¡¨ç¤º v<br>ï¼Œ wp<br>ç¾ j<br>å›½é˜²éƒ¨é•¿ <span class="hljs-built_in">n</span><br>ç›–èŒ¨ nh<br>å°† d<br>äº p<br><span class="hljs-number">2011</span>å¹´ nt<br><span class="hljs-number">1</span>æœˆ nt<br><span class="hljs-number">14</span>æ—¥ nt<br>è®¿é—® v<br>éŸ©å›½ ns<br>ã€‚ wp<br></code></pre></td></tr></table></figure><p>è¯æ€§æ ‡æ³¨ç»“æœå¯å‚è€ƒç½‘å€ï¼š<ahref="https://ltp.readthedocs.io/zh_CN/latest/appendix.html">https://ltp.readthedocs.io/zh_CN/latest/appendix.html</a>ã€‚</p><h5 id="å‘½åå®ä½“è¯†åˆ«">å‘½åå®ä½“è¯†åˆ«</h5><p>å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰æŒ‡çš„æ˜¯è¯†åˆ«å‡ºä¸€å¥è¯æˆ–ä¸€æ®µè¯æˆ–ä¸€ç‰‡æ–‡ç« ä¸­çš„å‘½åå®ä½“ï¼Œæ¯”å¦‚äººåï¼Œåœ°åï¼Œç»„ç»‡æœºæ„åã€‚ç¤ºä¾‹çš„Pythonä»£ç ner.pyå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Segmentor, Postagger<br><br><span class="hljs-comment"># åˆ†è¯</span><br>cws_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/cws.model&#x27;</span>)  <span class="hljs-comment"># åˆ†è¯æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`cws.model`</span><br>lexicon_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/lexicon.txt&#x27;</span>)  <span class="hljs-comment"># å‚æ•°lexiconæ˜¯è‡ªå®šä¹‰è¯å…¸çš„æ–‡ä»¶è·¯å¾„</span><br><br>segmentor = Segmentor()<br>segmentor.load_with_lexicon(cws_model_path, lexicon_path)<br><br>sent = <span class="hljs-string">&#x27;æ®éŸ©è”ç¤¾12æœˆ28æ—¥åæ˜ ï¼Œç¾å›½é˜²éƒ¨å‘è¨€äººæ°å¤«Â·è«è±å°”27æ—¥è¡¨ç¤ºï¼Œç¾å›½é˜²éƒ¨é•¿ç›–èŒ¨å°†äº2011å¹´1æœˆ14æ—¥è®¿é—®éŸ©å›½ã€‚&#x27;</span><br>words = segmentor.segment(sent)  <span class="hljs-comment"># åˆ†è¯</span><br><br><span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br>pos_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/pos.model&#x27;</span>)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`pos.model`</span><br><br>postagger = Postagger()  <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>postagger.load(pos_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>postags = postagger.postag(words)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br><br><br>ner_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/ner.model&#x27;</span>)   <span class="hljs-comment"># å‘½åå®ä½“è¯†åˆ«æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`pos.model`</span><br><br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> NamedEntityRecognizer<br>recognizer = NamedEntityRecognizer() <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>recognizer.load(ner_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br><span class="hljs-comment"># netags = recognizer.recognize(words, postags)  # å‘½åå®ä½“è¯†åˆ«</span><br><br><br><span class="hljs-comment"># æå–è¯†åˆ«ç»“æœä¸­çš„äººåï¼Œåœ°åï¼Œç»„ç»‡æœºæ„å</span><br><br>persons, places, orgs = <span class="hljs-built_in">set</span>(), <span class="hljs-built_in">set</span>(), <span class="hljs-built_in">set</span>()<br><br><br>netags = <span class="hljs-built_in">list</span>(recognizer.recognize(words, postags))  <span class="hljs-comment"># å‘½åå®ä½“è¯†åˆ«</span><br><span class="hljs-built_in">print</span>(netags)<br><span class="hljs-comment"># print(netags)</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> tag, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(netags, words):<br>    j = i<br>    <span class="hljs-comment"># äººå</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nh&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;S&#x27;</span>):<br>            persons.add(word)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;B&#x27;</span>):<br>            union_person = word<br>            <span class="hljs-keyword">while</span> netags[j] != <span class="hljs-string">&#x27;E-Nh&#x27;</span>:<br>                j += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(words):<br>                    union_person += words[j]<br>            persons.add(union_person)<br>    <span class="hljs-comment"># åœ°å</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Ns&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;S&#x27;</span>):<br>            places.add(word)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;B&#x27;</span>):<br>            union_place = word<br>            <span class="hljs-keyword">while</span> netags[j] != <span class="hljs-string">&#x27;E-Ns&#x27;</span>:<br>                j += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(words):<br>                    union_place += words[j]<br>            places.add(union_place)<br>    <span class="hljs-comment"># æœºæ„å</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Ni&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;S&#x27;</span>):<br>            orgs.add(word)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">str</span>(tag).startswith(<span class="hljs-string">&#x27;B&#x27;</span>):<br>            union_org = word<br>            <span class="hljs-keyword">while</span> netags[j] != <span class="hljs-string">&#x27;E-Ni&#x27;</span>:<br>                j += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(words):<br>                    union_org += words[j]<br>            orgs.add(union_org)<br><br>    i += <span class="hljs-number">1</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;äººåï¼š&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>.join(persons))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;åœ°åï¼š&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>.join(places))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»„ç»‡æœºæ„ï¼š&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>.join(orgs))<br><br><br><span class="hljs-comment"># é‡Šæ”¾æ¨¡å‹</span><br>segmentor.release()<br>postagger.release()<br>recognizer.release()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Ni&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-Ni&#x27;</span>, <span class="hljs-string">&#x27;E-Ni&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Nh&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Ns&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Nh&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;S-Ns&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>äººåï¼š æ°å¤«Â·è«è±å°”ï¼Œç›–èŒ¨<br>åœ°åï¼š ç¾ï¼ŒéŸ©å›½<br>ç»„ç»‡æœºæ„ï¼š éŸ©è”ç¤¾ï¼Œç¾å›½é˜²éƒ¨<br></code></pre></td></tr></table></figure><p>å‘½åå®ä½“è¯†åˆ«ç»“æœå¯å‚è€ƒç½‘å€ï¼š<ahref="https://ltp.readthedocs.io/zh_CN/latest/appendix.html">https://ltp.readthedocs.io/zh_CN/latest/appendix.html</a>ã€‚</p><h4 id="ä¾å­˜å¥æ³•åˆ†æ">ä¾å­˜å¥æ³•åˆ†æ</h4><p>ä¾å­˜è¯­æ³• (Dependency Parsing, DP)é€šè¿‡åˆ†æè¯­è¨€å•ä½å†…æˆåˆ†ä¹‹é—´çš„ä¾å­˜å…³ç³»æ­ç¤ºå…¶å¥æ³•ç»“æ„ã€‚ç›´è§‚æ¥è®²ï¼Œä¾å­˜å¥æ³•åˆ†æè¯†åˆ«å¥å­ä¸­çš„â€œä¸»è°“å®¾â€ã€â€œå®šçŠ¶è¡¥â€è¿™äº›è¯­æ³•æˆåˆ†ï¼Œå¹¶åˆ†æå„æˆåˆ†ä¹‹é—´çš„å…³ç³»ã€‚ç¤ºä¾‹çš„Pythonä»£ç parser.pyä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Segmentor, Postagger, Parser<br><br><span class="hljs-comment"># åˆ†è¯</span><br>cws_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/cws.model&#x27;</span>)  <span class="hljs-comment"># åˆ†è¯æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`cws.model`</span><br>lexicon_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/lexicon.txt&#x27;</span>)  <span class="hljs-comment"># å‚æ•°lexiconæ˜¯è‡ªå®šä¹‰è¯å…¸çš„æ–‡ä»¶è·¯å¾„</span><br><br>segmentor = Segmentor()<br>segmentor.load_with_lexicon(cws_model_path, lexicon_path)<br><br>sent = <span class="hljs-string">&#x27;æ®éŸ©è”ç¤¾12æœˆ28æ—¥åæ˜ ï¼Œç¾å›½é˜²éƒ¨å‘è¨€äººæ°å¤«Â·è«è±å°”27æ—¥è¡¨ç¤ºï¼Œç¾å›½é˜²éƒ¨é•¿ç›–èŒ¨å°†äº2011å¹´1æœˆ14æ—¥è®¿é—®éŸ©å›½ã€‚&#x27;</span><br>words = segmentor.segment(sent)  <span class="hljs-comment"># åˆ†è¯</span><br><br><span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br>pos_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/pos.model&#x27;</span>)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`pos.model`</span><br><br>postagger = Postagger()  <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>postagger.load(pos_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>postags = postagger.postag(words)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br><br><br><span class="hljs-comment"># ä¾å­˜å¥æ³•åˆ†æ</span><br>par_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/parser.model&#x27;</span>)  <span class="hljs-comment"># æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`parser.model`</span><br><br>parser = Parser() <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>parser.load(par_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>arcs = parser.parse(words, postags)  <span class="hljs-comment"># å¥æ³•åˆ†æ</span><br><br>rely_id = [arc.head <span class="hljs-keyword">for</span> arc <span class="hljs-keyword">in</span> arcs]  <span class="hljs-comment"># æå–ä¾å­˜çˆ¶èŠ‚ç‚¹id</span><br>relation = [arc.relation <span class="hljs-keyword">for</span> arc <span class="hljs-keyword">in</span> arcs]  <span class="hljs-comment"># æå–ä¾å­˜å…³ç³»</span><br>heads = [<span class="hljs-string">&#x27;Root&#x27;</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">id</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> words[<span class="hljs-built_in">id</span>-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> <span class="hljs-built_in">id</span> <span class="hljs-keyword">in</span> rely_id]  <span class="hljs-comment"># åŒ¹é…ä¾å­˜çˆ¶èŠ‚ç‚¹è¯è¯­</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(words)):<br>    <span class="hljs-built_in">print</span>(relation[i] + <span class="hljs-string">&#x27;(&#x27;</span> + words[i] + <span class="hljs-string">&#x27;, &#x27;</span> + heads[i] + <span class="hljs-string">&#x27;)&#x27;</span>)<br><br><span class="hljs-comment"># é‡Šæ”¾æ¨¡å‹</span><br>segmentor.release()<br>postagger.release()<br>parser.release()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">ADV</span><span class="hljs-params">(æ®, è¡¨ç¤º)</span></span><br><span class="hljs-function"><span class="hljs-title">SBV</span><span class="hljs-params">(éŸ©è”ç¤¾, åæ˜ )</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(<span class="hljs-number">12</span>æœˆ, <span class="hljs-number">28</span>æ—¥)</span></span><br><span class="hljs-function"><span class="hljs-title">ADV</span><span class="hljs-params">(<span class="hljs-number">28</span>æ—¥, åæ˜ )</span></span><br><span class="hljs-function"><span class="hljs-title">POB</span><span class="hljs-params">(åæ˜ , æ®)</span></span><br><span class="hljs-function"><span class="hljs-title">WP</span><span class="hljs-params">(ï¼Œ, æ®)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(ç¾, å›½é˜²éƒ¨)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(å›½é˜²éƒ¨, å‘è¨€äºº)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(å‘è¨€äºº, æ°å¤«Â·è«è±å°”)</span></span><br><span class="hljs-function"><span class="hljs-title">SBV</span><span class="hljs-params">(æ°å¤«Â·è«è±å°”, è¡¨ç¤º)</span></span><br><span class="hljs-function"><span class="hljs-title">ADV</span><span class="hljs-params">(<span class="hljs-number">27</span>æ—¥, è¡¨ç¤º)</span></span><br><span class="hljs-function"><span class="hljs-title">HED</span><span class="hljs-params">(è¡¨ç¤º, Root)</span></span><br><span class="hljs-function"><span class="hljs-title">WP</span><span class="hljs-params">(ï¼Œ, è¡¨ç¤º)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(ç¾, å›½é˜²éƒ¨é•¿)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(å›½é˜²éƒ¨é•¿, ç›–èŒ¨)</span></span><br><span class="hljs-function"><span class="hljs-title">SBV</span><span class="hljs-params">(ç›–èŒ¨, è®¿é—®)</span></span><br><span class="hljs-function"><span class="hljs-title">ADV</span><span class="hljs-params">(å°†, è®¿é—®)</span></span><br><span class="hljs-function"><span class="hljs-title">ADV</span><span class="hljs-params">(äº, è®¿é—®)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(<span class="hljs-number">2011</span>å¹´, <span class="hljs-number">14</span>æ—¥)</span></span><br><span class="hljs-function"><span class="hljs-title">ATT</span><span class="hljs-params">(<span class="hljs-number">1</span>æœˆ, <span class="hljs-number">14</span>æ—¥)</span></span><br><span class="hljs-function"><span class="hljs-title">POB</span><span class="hljs-params">(<span class="hljs-number">14</span>æ—¥, äº)</span></span><br><span class="hljs-function"><span class="hljs-title">VOB</span><span class="hljs-params">(è®¿é—®, è¡¨ç¤º)</span></span><br><span class="hljs-function"><span class="hljs-title">VOB</span><span class="hljs-params">(éŸ©å›½, è®¿é—®)</span></span><br><span class="hljs-function"><span class="hljs-title">WP</span><span class="hljs-params">(ã€‚, è¡¨ç¤º)</span></span><br></code></pre></td></tr></table></figure><p>ä¾å­˜å¥æ³•åˆ†æç»“æœå¯å‚è€ƒç½‘å€ï¼š<ahref="https://ltp.readthedocs.io/zh_CN/latest/appendix.html">https://ltp.readthedocs.io/zh_CN/latest/appendix.html</a>ã€‚</p><h5 id="è¯­ä¹‰è§’è‰²æ ‡æ³¨">è¯­ä¹‰è§’è‰²æ ‡æ³¨</h5><p>è¯­ä¹‰è§’è‰²æ ‡æ³¨æ˜¯å®ç°æµ…å±‚è¯­ä¹‰åˆ†æçš„ä¸€ç§æ–¹å¼ã€‚åœ¨ä¸€ä¸ªå¥å­ä¸­ï¼Œè°“è¯æ˜¯å¯¹ä¸»è¯­çš„é™ˆè¿°æˆ–è¯´æ˜ï¼ŒæŒ‡å‡ºâ€œåšä»€ä¹ˆâ€ã€â€œæ˜¯ä»€ä¹ˆâ€æˆ–â€œæ€ä¹ˆæ ·ï¼Œä»£è¡¨äº†ä¸€ä¸ªäº‹ä»¶çš„æ ¸å¿ƒï¼Œè·Ÿè°“è¯æ­é…çš„åè¯ç§°ä¸ºè®ºå…ƒã€‚è¯­ä¹‰è§’è‰²æ˜¯æŒ‡è®ºå…ƒåœ¨åŠ¨è¯æ‰€æŒ‡äº‹ä»¶ä¸­æ‹…ä»»çš„è§’è‰²ã€‚ä¸»è¦æœ‰ï¼šæ–½äº‹è€…ï¼ˆAgentï¼‰ã€å—äº‹è€…ï¼ˆPatientï¼‰ã€å®¢ä½“ï¼ˆThemeï¼‰ã€ç»éªŒè€…ï¼ˆExperiencerï¼‰ã€å—ç›Šè€…ï¼ˆBeneficiaryï¼‰ã€å·¥å…·ï¼ˆInstrumentï¼‰ã€å¤„æ‰€ï¼ˆLocationï¼‰ã€ç›®æ ‡ï¼ˆGoalï¼‰å’Œæ¥æºï¼ˆSourceï¼‰ç­‰ã€‚ç¤ºä¾‹çš„Pythonä»£ç rolelabel.pyå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> pyltp <span class="hljs-keyword">import</span> Segmentor, Postagger, Parser, SementicRoleLabeller<br><br><span class="hljs-comment"># åˆ†è¯</span><br>cws_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/cws.model&#x27;</span>)  <span class="hljs-comment"># åˆ†è¯æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`cws.model`</span><br>lexicon_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/lexicon.txt&#x27;</span>)  <span class="hljs-comment"># å‚æ•°lexiconæ˜¯è‡ªå®šä¹‰è¯å…¸çš„æ–‡ä»¶è·¯å¾„</span><br><br>segmentor = Segmentor()<br>segmentor.load_with_lexicon(cws_model_path, lexicon_path)<br><br>sent = <span class="hljs-string">&#x27;æ®éŸ©è”ç¤¾12æœˆ28æ—¥åæ˜ ï¼Œç¾å›½é˜²éƒ¨å‘è¨€äººæ°å¤«Â·è«è±å°”27æ—¥è¡¨ç¤ºï¼Œç¾å›½é˜²éƒ¨é•¿ç›–èŒ¨å°†äº2011å¹´1æœˆ14æ—¥è®¿é—®éŸ©å›½ã€‚&#x27;</span><br>words = segmentor.segment(sent)  <span class="hljs-comment"># åˆ†è¯</span><br><br><span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br>pos_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/pos.model&#x27;</span>)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`pos.model`</span><br><br>postagger = Postagger()  <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>postagger.load(pos_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>postags = postagger.postag(words)  <span class="hljs-comment"># è¯æ€§æ ‡æ³¨</span><br><br><span class="hljs-comment"># ä¾å­˜å¥æ³•åˆ†æ</span><br>par_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/parser.model&#x27;</span>)  <span class="hljs-comment"># æ¨¡å‹è·¯å¾„ï¼Œæ¨¡å‹åç§°ä¸º`parser.model`</span><br><br>parser = Parser() <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>parser.load(par_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>arcs = parser.parse(words, postags)  <span class="hljs-comment"># å¥æ³•åˆ†æ</span><br><br><span class="hljs-comment"># è¯­ä¹‰è§’è‰²æ ‡æ³¨</span><br>srl_model_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">&#x27;data/pisrl.model&#x27;</span>)  <span class="hljs-comment"># è¯­ä¹‰è§’è‰²æ ‡æ³¨æ¨¡å‹ç›®å½•è·¯å¾„</span><br>labeller = SementicRoleLabeller() <span class="hljs-comment"># åˆå§‹åŒ–å®ä¾‹</span><br>labeller.load(srl_model_path)  <span class="hljs-comment"># åŠ è½½æ¨¡å‹</span><br>roles = labeller.label(words, postags, arcs)  <span class="hljs-comment"># è¯­ä¹‰è§’è‰²æ ‡æ³¨</span><br><br><span class="hljs-comment"># æ‰“å°ç»“æœ</span><br><span class="hljs-keyword">for</span> role <span class="hljs-keyword">in</span> roles:<br>    <span class="hljs-built_in">print</span>(words[role.index], end=<span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-built_in">print</span>(role.index, <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-string">&quot;%s:(%d,%d)&quot;</span> % (arg.name, arg.<span class="hljs-built_in">range</span>.start, arg.<span class="hljs-built_in">range</span>.end) <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">in</span> role.arguments]))<br><br><span class="hljs-comment"># é‡Šæ”¾æ¨¡å‹</span><br>segmentor.release()<br>postagger.release()<br>parser.release()<br>labeller.release()<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">åæ˜  <span class="hljs-number">4</span> <span class="hljs-built_in">A0</span>:(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-built_in">A0</span>:(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<br>è¡¨ç¤º <span class="hljs-number">11</span> MNR:(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>)<span class="hljs-built_in">A0</span>:(<span class="hljs-number">6</span>,<span class="hljs-number">9</span>)TMP:(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>)<span class="hljs-built_in">A1</span>:(<span class="hljs-number">13</span>,<span class="hljs-number">22</span>)<br>è®¿é—® <span class="hljs-number">21</span> <span class="hljs-built_in">A0</span>:(<span class="hljs-number">13</span>,<span class="hljs-number">15</span>)ADV:(<span class="hljs-number">16</span>,<span class="hljs-number">16</span>)TMP:(<span class="hljs-number">17</span>,<span class="hljs-number">20</span>)<span class="hljs-built_in">A1</span>:(<span class="hljs-number">22</span>,<span class="hljs-number">22</span>)<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“">æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†ä¸­æ–‡NLPçš„ä¸€ä¸ªæ°å‡ºå·¥å…·pyltpï¼Œå¹¶ç»™å‡ºäº†è¯¥æ¨¡å—çš„å„ä¸ªåŠŸèƒ½çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå¸Œæœ›èƒ½ç»™è¯»è€…ä¸€äº›æ€è€ƒä¸å¯ç¤ºã€‚æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»~</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>pyltp</tag>
      
      <tag>NLPå·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆäº”ï¼‰ç”¨æ·±åº¦å­¦ä¹ å®ç°å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰</title>
    <link href="/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%E7%94%A8%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%EF%BC%88NER%EF%BC%89/"/>
    <url>/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%E7%94%A8%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E7%8E%B0%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%EF%BC%88NER%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="å‰è¨€">å‰è¨€</h3><p>åœ¨æ–‡ç« ï¼š<ahref="https://percent4.github.io/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%EF%BC%88NER%EF%BC%89/">NLPå…¥é—¨ï¼ˆå››ï¼‰å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰</a>ä¸­ï¼Œç¬”è€…ä»‹ç»äº†ä¸¤ä¸ªå®ç°å‘½åå®ä½“è¯†åˆ«çš„å·¥å…·â€”â€”NLTKå’ŒStanfordNLPã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ åˆ°å¦‚ä½•ä½¿ç”¨æ·±åº¦å­¦ä¹ å·¥å…·æ¥è‡ªå·±ä¸€æ­¥æ­¥åœ°å®ç°NERï¼Œåªè¦ä½ åšæŒçœ‹å®Œï¼Œå°±ä¸€å®šä¼šå¾ˆæœ‰æ”¶è·çš„ã€‚</p><p>OKï¼Œè¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬è¿›å…¥æ­£é¢˜ã€‚</p><p>å‡ ä¹æ‰€æœ‰çš„NLPéƒ½ä¾èµ–ä¸€ä¸ªå¼ºå¤§çš„è¯­æ–™åº“ï¼Œæœ¬é¡¹ç›®å®ç°NERçš„è¯­æ–™åº“å¦‚ä¸‹(æ–‡ä»¶åä¸ºtrain.txtï¼Œä¸€å…±42000è¡Œï¼Œè¿™é‡Œåªå±•ç¤ºå‰15è¡Œï¼Œå¯ä»¥åœ¨æ–‡ç« æœ€åçš„Githubåœ°å€ä¸‹è½½è¯¥è¯­æ–™åº“)ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">playedonMonday(hometeam<span class="hljs-keyword">in</span>CAPS):<br>VBDINNNP(NNNNINNNP):<br>OOOOOOOOOO<br>AmericanLeague<br>NNPNNP<br>B-MISCI-MISC<br>Cleveland2DETROIT1<br>NNPCDNNPCD<br>B-ORGOB-ORGO<br>BALTIMORE12Oakland11(10innings)<br>VBCDNNPCD(CDNN)<br>B-ORGOB-ORGOOOOO<br>TORONTO5Minnesota3<br>TOCDNNPCD<br>B-ORGOB-ORGO<br>......<br></code></pre></td></tr></table></figure><p>ç®€å•ä»‹ç»ä¸‹è¯¥è¯­æ–™åº“çš„ç»“æ„ï¼šè¯¥è¯­æ–™åº“ä¸€å…±42000è¡Œï¼Œæ¯ä¸‰è¡Œä¸ºä¸€ç»„ï¼Œå…¶ä¸­ï¼Œç¬¬ä¸€è¡Œä¸ºè‹±è¯­å¥å­ï¼Œç¬¬äºŒè¡Œä¸ºæ¯ä¸ªå¥å­çš„è¯æ€§ï¼ˆå…³äºè‹±è¯­å•è¯çš„è¯æ€§ï¼Œå¯å‚è€ƒæ–‡ç« ï¼š<ahref="https://percent4.github.io/2023/07/06/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E8%AF%8D%E5%BD%A2%E8%BF%98%E5%8E%9F%EF%BC%88Lemmatization%EF%BC%89/">NLPå…¥é—¨ï¼ˆä¸‰ï¼‰è¯å½¢è¿˜åŸï¼ˆLemmatizationï¼‰</a>ï¼‰ï¼Œç¬¬ä¸‰è¡Œä¸ºNERç³»ç»Ÿçš„æ ‡æ³¨ï¼Œå…·ä½“çš„å«ä¹‰ä¼šåœ¨ä¹‹åä»‹ç»ã€‚</p><p>æˆ‘ä»¬çš„NERé¡¹ç›®çš„åç§°ä¸ºDL_4_NERï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp5_1.png" alt="NERé¡¹ç›®åç§°" /><figcaption aria-hidden="true">NERé¡¹ç›®åç§°</figcaption></figure><p>é¡¹ç›®ä¸­æ¯ä¸ªæ–‡ä»¶çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li><p>utils.py: é¡¹ç›®é…ç½®åŠæ•°æ®å¯¼å…¥</p></li><li><p>data_processing.py: æ•°æ®æ¢ç´¢</p></li><li><p>Bi_LSTM_Model_training.py: æ¨¡å‹åˆ›å»ºåŠè®­ç»ƒ</p></li><li><p>Bi_LSTM_Model_predict.py: å¯¹æ–°å¥å­è¿›è¡ŒNERé¢„æµ‹</p><p>æ¥ä¸‹æ¥ï¼Œç¬”è€…å°†ç»“åˆä»£ç æ–‡ä»¶ï¼Œåˆ†éƒ¨ä»‹ç»è¯¥é¡¹ç›®çš„æ­¥éª¤ï¼Œå½“æ‰€æœ‰æ­¥éª¤ä»‹ç»å®Œæ¯•åï¼Œæˆ‘ä»¬çš„é¡¹ç›®å°±ç»“æŸäº†ï¼Œè€Œä½ ï¼Œä¹Ÿå°±çŸ¥é“äº†å¦‚ä½•ç”¨æ·±åº¦å­¦ä¹ å®ç°å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰ã€‚</p><p>Let's begin!</p></li></ul><h3 id="é¡¹ç›®é…ç½®">é¡¹ç›®é…ç½®</h3><p>ç¬¬ä¸€æ­¥ï¼Œæ˜¯é¡¹ç›®çš„é…ç½®åŠæ•°æ®å¯¼å…¥ï¼Œåœ¨utils.pyæ–‡ä»¶ä¸­å®ç°ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><span class="hljs-comment"># basic settings for DL_4_NER Project</span><br>BASE_DIR = <span class="hljs-string">&quot;F://NERSystem&quot;</span><br>CORPUS_PATH = <span class="hljs-string">&quot;%s/train.txt&quot;</span> % BASE_DIR<br><br>KERAS_MODEL_SAVE_PATH = <span class="hljs-string">&#x27;%s/Bi-LSTM-4-NER.h5&#x27;</span> % BASE_DIR<br>WORD_DICTIONARY_PATH = <span class="hljs-string">&#x27;%s/word_dictionary.pk&#x27;</span> % BASE_DIR<br>InVERSE_WORD_DICTIONARY_PATH = <span class="hljs-string">&#x27;%s/inverse_word_dictionary.pk&#x27;</span> % BASE_DIR<br>LABEL_DICTIONARY_PATH = <span class="hljs-string">&#x27;%s/label_dictionary.pk&#x27;</span> % BASE_DIR<br>OUTPUT_DICTIONARY_PATH = <span class="hljs-string">&#x27;%s/output_dictionary.pk&#x27;</span> % BASE_DIR<br><br>CONSTANTS = [<br>             KERAS_MODEL_SAVE_PATH,<br>             InVERSE_WORD_DICTIONARY_PATH,<br>             WORD_DICTIONARY_PATH,<br>             LABEL_DICTIONARY_PATH,<br>             OUTPUT_DICTIONARY_PATH<br>             ]<br><br><span class="hljs-comment"># load data from corpus to from pandas DataFrame</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_data</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CORPUS_PATH, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        text_data = [text.strip() <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> f.readlines()]<br>    text_data = [text_data[k].split(<span class="hljs-string">&#x27;\t&#x27;</span>) <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(text_data))]<br>    index = <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(text_data), <span class="hljs-number">3</span>)<br><br>    <span class="hljs-comment"># Transforming data to matrix format for neural network</span><br>    input_data = <span class="hljs-built_in">list</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(index) - <span class="hljs-number">1</span>):<br>        rows = text_data[index[i-<span class="hljs-number">1</span>]:index[i]]<br>        sentence_no = np.array([i]*<span class="hljs-built_in">len</span>(rows[<span class="hljs-number">0</span>]), dtype=<span class="hljs-built_in">str</span>)<br>        rows.append(sentence_no)<br>        rows = np.array(rows).T<br>        input_data.append(rows)<br><br>    input_data = pd.DataFrame(np.concatenate([item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> input_data]),\<br>                               columns=[<span class="hljs-string">&#x27;word&#x27;</span>, <span class="hljs-string">&#x27;pos&#x27;</span>, <span class="hljs-string">&#x27;tag&#x27;</span>, <span class="hljs-string">&#x27;sent_no&#x27;</span>])<br><br>    <span class="hljs-keyword">return</span> input_data<br></code></pre></td></tr></table></figure><p>åœ¨è¯¥ä»£ç ä¸­ï¼Œå…ˆæ˜¯è®¾ç½®äº†è¯­æ–™åº“æ–‡ä»¶çš„è·¯å¾„CORPUS_PATHï¼ŒKERASæ¨¡å‹ä¿å­˜è·¯å¾„KERAS_MODEL_SAVE_PATHï¼Œä»¥åŠåœ¨é¡¹ç›®è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°çš„ä¸‰ä¸ªå­—å…¸çš„ä¿å­˜è·¯å¾„ï¼ˆä»¥pickleæ–‡ä»¶å½¢å¼ä¿å­˜ï¼‰WORD_DICTIONARY_PATHï¼ŒLABEL_DICTIONARY_PATHï¼ŒOUTPUT_DICTIONARY_PATHã€‚ç„¶åæ˜¯load_data()å‡½æ•°ï¼Œå®ƒå°†è¯­æ–™åº“ä¸­çš„æ–‡æœ¬ä»¥Pandasä¸­çš„DataFrameç»“æ„å±•ç¤ºå‡ºæ¥ï¼Œè¯¥æ•°æ®æ¡†çš„å‰30è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs apache">         <span class="hljs-attribute">word</span>  pos     tag sent_no<br><span class="hljs-attribute">0</span>      played  VBD       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">1</span>          <span class="hljs-literal">on</span>   IN       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">2</span>      Monday  NNP       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">3</span>           (    (       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">4</span>        home   NN       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">5</span>        team   NN       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">6</span>          in   IN       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">7</span>        CAPS  NNP       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">8</span>           )    )       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">9</span>           :    :       O       <span class="hljs-number">1</span><br><span class="hljs-attribute">10</span>   American  NNP  B-MISC       <span class="hljs-number">2</span><br><span class="hljs-attribute">11</span>     League  NNP  I-MISC       <span class="hljs-number">2</span><br><span class="hljs-attribute">12</span>  Cleveland  NNP   B-ORG       <span class="hljs-number">3</span><br><span class="hljs-attribute">13</span>          <span class="hljs-number">2</span>   CD       O       <span class="hljs-number">3</span><br><span class="hljs-attribute">14</span>    DETROIT  NNP   B-ORG       <span class="hljs-number">3</span><br><span class="hljs-attribute">15</span>          <span class="hljs-number">1</span>   CD       O       <span class="hljs-number">3</span><br><span class="hljs-attribute">16</span>  BALTIMORE   VB   B-ORG       <span class="hljs-number">4</span><br><span class="hljs-attribute">17</span>         <span class="hljs-number">12</span>   CD       O       <span class="hljs-number">4</span><br><span class="hljs-attribute">18</span>    Oakland  NNP   B-ORG       <span class="hljs-number">4</span><br><span class="hljs-attribute">19</span>         <span class="hljs-number">11</span>   CD       O       <span class="hljs-number">4</span><br><span class="hljs-attribute">20</span>          (    (       O       <span class="hljs-number">4</span><br><span class="hljs-attribute">21</span>         <span class="hljs-number">10</span>   CD       O       <span class="hljs-number">4</span><br><span class="hljs-attribute">22</span>    innings   NN       O       <span class="hljs-number">4</span><br><span class="hljs-attribute">23</span>          )    )       O       <span class="hljs-number">4</span><br><span class="hljs-attribute">24</span>    TORONTO   TO   B-ORG       <span class="hljs-number">5</span><br><span class="hljs-attribute">25</span>          <span class="hljs-number">5</span>   CD       O       <span class="hljs-number">5</span><br><span class="hljs-attribute">26</span>  Minnesota  NNP   B-ORG       <span class="hljs-number">5</span><br><span class="hljs-attribute">27</span>          <span class="hljs-number">3</span>   CD       O       <span class="hljs-number">5</span><br><span class="hljs-attribute">28</span>  Milwaukee  NNP   B-ORG       <span class="hljs-number">6</span><br><span class="hljs-attribute">29</span>          <span class="hljs-number">3</span>   CD       O       <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><p>åœ¨è¯¥æ•°æ®æ¡†ä¸­ï¼Œwordè¿™ä¸€åˆ—è¡¨ç¤ºæ–‡æœ¬è¯­æ–™åº“ä¸­çš„å•è¯ï¼Œposè¿™ä¸€åˆ—è¡¨ç¤ºè¯¥å•è¯çš„è¯æ€§ï¼Œtagè¿™ä¸€åˆ—è¡¨ç¤ºNERçš„æ ‡æ³¨ï¼Œsent_noè¿™ä¸€åˆ—è¡¨ç¤ºè¯¥å•è¯åœ¨ç¬¬å‡ ä¸ªå¥å­ä¸­ã€‚</p><h3 id="æ•°æ®æ¢ç´¢">æ•°æ®æ¢ç´¢</h3><p>æ¥ç€ï¼Œç¬¬äºŒæ­¥æ˜¯æ•°æ®æ¢ç´¢ï¼Œå³å¯¹è¾“å…¥çš„æ•°æ®ï¼ˆinput_dataï¼‰è¿›è¡Œä¸€äº›æ•°æ®reviewï¼Œå®Œæ•´çš„ä»£ç ï¼ˆdata_processing.pyï¼‰å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> accumulate<br><span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> BASE_DIR, CONSTANTS, load_data<br><br><span class="hljs-comment"># è®¾ç½®matplotlibç»˜å›¾æ—¶çš„å­—ä½“</span><br>mpl.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>]=[<span class="hljs-string">&#x27;SimHei&#x27;</span>]<br><br><span class="hljs-comment"># æ•°æ®æŸ¥çœ‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">data_review</span>():<br><br>    <span class="hljs-comment"># æ•°æ®å¯¼å…¥</span><br>    input_data = load_data()<br><br>    <span class="hljs-comment"># åŸºæœ¬çš„æ•°æ®review</span><br>    sent_num = input_data[<span class="hljs-string">&#x27;sent_no&#x27;</span>].astype(np.<span class="hljs-built_in">int</span>).<span class="hljs-built_in">max</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸€å…±æœ‰%sä¸ªå¥å­ã€‚\n&quot;</span>%sent_num)<br><br>    vocabulary = input_data[<span class="hljs-string">&#x27;word&#x27;</span>].unique()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸€å…±æœ‰%dä¸ªå•è¯ã€‚&quot;</span>%<span class="hljs-built_in">len</span>(vocabulary))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å‰10ä¸ªå•è¯ä¸ºï¼š%s.\n&quot;</span>%vocabulary[:<span class="hljs-number">11</span>])<br><br>    pos_arr = input_data[<span class="hljs-string">&#x27;pos&#x27;</span>].unique()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å•è¯çš„è¯æ€§åˆ—è¡¨ï¼š%s.\n&quot;</span>%pos_arr)<br><br>    ner_tag_arr = input_data[<span class="hljs-string">&#x27;tag&#x27;</span>].unique()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;NERçš„æ ‡æ³¨åˆ—è¡¨ï¼š%s.\n&quot;</span> % ner_tag_arr)<br><br>    df = input_data[[<span class="hljs-string">&#x27;word&#x27;</span>, <span class="hljs-string">&#x27;sent_no&#x27;</span>]].groupby(<span class="hljs-string">&#x27;sent_no&#x27;</span>).count()<br>    sent_len_list = df[<span class="hljs-string">&#x27;word&#x27;</span>].tolist()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°å­—å…¸ï¼š\n%s.&quot;</span> % <span class="hljs-built_in">dict</span>(Counter(sent_len_list)))<br><br>    <span class="hljs-comment"># ç»˜åˆ¶å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾</span><br>    sort_sent_len_dist = <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">dict</span>(Counter(sent_len_list)).items(), key=itemgetter(<span class="hljs-number">0</span>))<br>    sent_no_data = [item[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> sort_sent_len_dist]<br>    sent_count_data = [item[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> sort_sent_len_dist]<br>    plt.bar(sent_no_data, sent_count_data)<br>    plt.title(<span class="hljs-string">&quot;å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾&quot;</span>)<br>    plt.xlabel(<span class="hljs-string">&quot;å¥å­é•¿åº¦&quot;</span>)<br>    plt.ylabel(<span class="hljs-string">&quot;å¥å­é•¿åº¦å‡ºç°çš„é¢‘æ•°&quot;</span>)<br>    plt.savefig(<span class="hljs-string">&quot;%s/å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾.png&quot;</span> % BASE_DIR)<br>    plt.close()<br><br>    <span class="hljs-comment"># ç»˜åˆ¶å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°(CDF)</span><br>    sent_pentage_list = [(count/sent_num) <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> accumulate(sent_count_data)]<br><br>    <span class="hljs-comment"># å¯»æ‰¾åˆ†ä½ç‚¹ä¸ºquantileçš„å¥å­é•¿åº¦</span><br>    quantile = <span class="hljs-number">0.9992</span><br>    <span class="hljs-comment">#print(list(sent_pentage_list))</span><br>    <span class="hljs-keyword">for</span> length, per <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(sent_no_data, sent_pentage_list):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">round</span>(per, <span class="hljs-number">4</span>) == quantile:<br>            index = length<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nåˆ†ä½ç‚¹ä¸º%sçš„å¥å­é•¿åº¦:%d.&quot;</span> % (quantile, index))<br><br>    <span class="hljs-comment"># ç»˜åˆ¶CDF</span><br>    plt.plot(sent_no_data, sent_pentage_list)<br>    plt.hlines(quantile, <span class="hljs-number">0</span>, index, colors=<span class="hljs-string">&quot;c&quot;</span>, linestyles=<span class="hljs-string">&quot;dashed&quot;</span>)<br>    plt.vlines(index, <span class="hljs-number">0</span>, quantile, colors=<span class="hljs-string">&quot;c&quot;</span>, linestyles=<span class="hljs-string">&quot;dashed&quot;</span>)<br>    plt.text(<span class="hljs-number">0</span>, quantile, <span class="hljs-built_in">str</span>(quantile))<br>    plt.text(index, <span class="hljs-number">0</span>, <span class="hljs-built_in">str</span>(index))<br>    plt.title(<span class="hljs-string">&quot;å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾&quot;</span>)<br>    plt.xlabel(<span class="hljs-string">&quot;å¥å­é•¿åº¦&quot;</span>)<br>    plt.ylabel(<span class="hljs-string">&quot;å¥å­é•¿åº¦ç´¯ç§¯é¢‘ç‡&quot;</span>)<br>    plt.savefig(<span class="hljs-string">&quot;%s/å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾.png&quot;</span> % BASE_DIR)<br>    plt.close()<br><br><span class="hljs-comment"># æ•°æ®å¤„ç†</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">data_processing</span>():<br>    <span class="hljs-comment"># æ•°æ®å¯¼å…¥</span><br>    input_data = load_data()<br><br>    <span class="hljs-comment"># æ ‡ç­¾åŠè¯æ±‡è¡¨</span><br>    labels, vocabulary = <span class="hljs-built_in">list</span>(input_data[<span class="hljs-string">&#x27;tag&#x27;</span>].unique()), <span class="hljs-built_in">list</span>(input_data[<span class="hljs-string">&#x27;word&#x27;</span>].unique())<br><br>    <span class="hljs-comment"># å­—å…¸åˆ—è¡¨</span><br>    word_dictionary = &#123;word: i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(vocabulary)&#125;<br>    inverse_word_dictionary = &#123;i+<span class="hljs-number">1</span>: word <span class="hljs-keyword">for</span> i, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(vocabulary)&#125;<br>    label_dictionary = &#123;label: i+<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(labels)&#125;<br>    output_dictionary = &#123;i+<span class="hljs-number">1</span>: labels <span class="hljs-keyword">for</span> i, labels <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(labels)&#125;<br><br>    dict_list = [word_dictionary, inverse_word_dictionary,label_dictionary, output_dictionary]<br><br>    <span class="hljs-comment"># ä¿å­˜ä¸ºpickleå½¢å¼</span><br>    <span class="hljs-keyword">for</span> dict_item, path <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(dict_list, CONSTANTS[<span class="hljs-number">1</span>:]):<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            pickle.dump(dict_item, f)<br><br><span class="hljs-comment">#data_review()</span><br></code></pre></td></tr></table></figure><p>è°ƒç”¨data_review()å‡½æ•°ï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs prolog">ä¸€å…±æœ‰<span class="hljs-number">13998</span>ä¸ªå¥å­ã€‚<br><br>ä¸€å…±æœ‰<span class="hljs-number">24339</span>ä¸ªå•è¯ã€‚<br>å‰<span class="hljs-number">10</span>ä¸ªå•è¯ä¸ºï¼š[<span class="hljs-string">&#x27;played&#x27;</span> <span class="hljs-string">&#x27;on&#x27;</span> <span class="hljs-string">&#x27;Monday&#x27;</span> <span class="hljs-string">&#x27;(&#x27;</span> <span class="hljs-string">&#x27;home&#x27;</span> <span class="hljs-string">&#x27;team&#x27;</span> <span class="hljs-string">&#x27;in&#x27;</span> <span class="hljs-string">&#x27;CAPS&#x27;</span> <span class="hljs-string">&#x27;)&#x27;</span> <span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;American&#x27;</span>].<br><br>å•è¯çš„è¯æ€§åˆ—è¡¨ï¼š[<span class="hljs-string">&#x27;VBD&#x27;</span> <span class="hljs-string">&#x27;IN&#x27;</span> <span class="hljs-string">&#x27;NNP&#x27;</span> <span class="hljs-string">&#x27;(&#x27;</span> <span class="hljs-string">&#x27;NN&#x27;</span> <span class="hljs-string">&#x27;)&#x27;</span> <span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;CD&#x27;</span> <span class="hljs-string">&#x27;VB&#x27;</span> <span class="hljs-string">&#x27;TO&#x27;</span> <span class="hljs-string">&#x27;NNS&#x27;</span> <span class="hljs-string">&#x27;,&#x27;</span> <span class="hljs-string">&#x27;VBP&#x27;</span> <span class="hljs-string">&#x27;VBZ&#x27;</span><br> <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-string">&#x27;VBG&#x27;</span> <span class="hljs-string">&#x27;PRP$&#x27;</span> <span class="hljs-string">&#x27;JJ&#x27;</span> <span class="hljs-string">&#x27;CC&#x27;</span> <span class="hljs-string">&#x27;JJS&#x27;</span> <span class="hljs-string">&#x27;RB&#x27;</span> <span class="hljs-string">&#x27;DT&#x27;</span> <span class="hljs-string">&#x27;VBN&#x27;</span> <span class="hljs-string">&#x27;&quot;&#x27;</span> <span class="hljs-string">&#x27;PRP&#x27;</span> <span class="hljs-string">&#x27;WDT&#x27;</span> <span class="hljs-string">&#x27;WRB&#x27;</span><br> <span class="hljs-string">&#x27;MD&#x27;</span> <span class="hljs-string">&#x27;WP&#x27;</span> <span class="hljs-string">&#x27;POS&#x27;</span> <span class="hljs-string">&#x27;JJR&#x27;</span> <span class="hljs-string">&#x27;WP$&#x27;</span> <span class="hljs-string">&#x27;RP&#x27;</span> <span class="hljs-string">&#x27;NNPS&#x27;</span> <span class="hljs-string">&#x27;RBS&#x27;</span> <span class="hljs-string">&#x27;FW&#x27;</span> <span class="hljs-string">&#x27;$&#x27;</span> <span class="hljs-string">&#x27;RBR&#x27;</span> <span class="hljs-string">&#x27;EX&#x27;</span> <span class="hljs-string">&quot;&#x27;&#x27;&quot;</span><br> <span class="hljs-string">&#x27;PDT&#x27;</span> <span class="hljs-string">&#x27;UH&#x27;</span> <span class="hljs-string">&#x27;SYM&#x27;</span> <span class="hljs-string">&#x27;LS&#x27;</span> <span class="hljs-string">&#x27;NN|SYM&#x27;</span>].<br><br><span class="hljs-symbol">NER</span>çš„æ ‡æ³¨åˆ—è¡¨ï¼š[<span class="hljs-string">&#x27;O&#x27;</span> <span class="hljs-string">&#x27;B-MISC&#x27;</span> <span class="hljs-string">&#x27;I-MISC&#x27;</span> <span class="hljs-string">&#x27;B-ORG&#x27;</span> <span class="hljs-string">&#x27;I-ORG&#x27;</span> <span class="hljs-string">&#x27;B-PER&#x27;</span> <span class="hljs-string">&#x27;B-LOC&#x27;</span> <span class="hljs-string">&#x27;I-PER&#x27;</span> <span class="hljs-string">&#x27;I-LOC&#x27;</span><br> <span class="hljs-string">&#x27;sO&#x27;</span>].<br><br>å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°å­—å…¸ï¼š<br>&#123;<span class="hljs-number">1</span>: <span class="hljs-number">177</span>, <span class="hljs-number">2</span>: <span class="hljs-number">1141</span>, <span class="hljs-number">3</span>: <span class="hljs-number">620</span>, <span class="hljs-number">4</span>: <span class="hljs-number">794</span>, <span class="hljs-number">5</span>: <span class="hljs-number">769</span>, <span class="hljs-number">6</span>: <span class="hljs-number">639</span>, <span class="hljs-number">7</span>: <span class="hljs-number">999</span>, <span class="hljs-number">8</span>: <span class="hljs-number">977</span>, <span class="hljs-number">9</span>: <span class="hljs-number">841</span>, <span class="hljs-number">10</span>: <span class="hljs-number">501</span>, <span class="hljs-number">11</span>: <span class="hljs-number">395</span>, <span class="hljs-number">12</span>: <span class="hljs-number">316</span>, <span class="hljs-number">13</span>: <span class="hljs-number">339</span>, <span class="hljs-number">14</span>: <span class="hljs-number">291</span>, <span class="hljs-number">15</span>: <span class="hljs-number">275</span>, <span class="hljs-number">16</span>: <span class="hljs-number">225</span>, <span class="hljs-number">17</span>: <span class="hljs-number">229</span>, <span class="hljs-number">18</span>: <span class="hljs-number">212</span>, <span class="hljs-number">19</span>: <span class="hljs-number">197</span>, <span class="hljs-number">20</span>: <span class="hljs-number">221</span>, <span class="hljs-number">21</span>: <span class="hljs-number">228</span>, <span class="hljs-number">22</span>: <span class="hljs-number">221</span>, <span class="hljs-number">23</span>: <span class="hljs-number">230</span>, <span class="hljs-number">24</span>: <span class="hljs-number">210</span>, <span class="hljs-number">25</span>: <span class="hljs-number">207</span>, <span class="hljs-number">26</span>: <span class="hljs-number">224</span>, <span class="hljs-number">27</span>: <span class="hljs-number">188</span>, <span class="hljs-number">28</span>: <span class="hljs-number">199</span>, <span class="hljs-number">29</span>: <span class="hljs-number">214</span>, <span class="hljs-number">30</span>: <span class="hljs-number">183</span>, <span class="hljs-number">31</span>: <span class="hljs-number">202</span>, <span class="hljs-number">32</span>: <span class="hljs-number">167</span>, <span class="hljs-number">33</span>: <span class="hljs-number">167</span>, <span class="hljs-number">34</span>: <span class="hljs-number">141</span>, <span class="hljs-number">35</span>: <span class="hljs-number">130</span>, <span class="hljs-number">36</span>: <span class="hljs-number">119</span>, <span class="hljs-number">37</span>: <span class="hljs-number">105</span>, <span class="hljs-number">38</span>: <span class="hljs-number">112</span>, <span class="hljs-number">39</span>: <span class="hljs-number">98</span>, <span class="hljs-number">40</span>: <span class="hljs-number">78</span>, <span class="hljs-number">41</span>: <span class="hljs-number">74</span>, <span class="hljs-number">42</span>: <span class="hljs-number">63</span>, <span class="hljs-number">43</span>: <span class="hljs-number">51</span>, <span class="hljs-number">44</span>: <span class="hljs-number">42</span>, <span class="hljs-number">45</span>: <span class="hljs-number">39</span>, <span class="hljs-number">46</span>: <span class="hljs-number">19</span>, <span class="hljs-number">47</span>: <span class="hljs-number">22</span>, <span class="hljs-number">48</span>: <span class="hljs-number">19</span>, <span class="hljs-number">49</span>: <span class="hljs-number">15</span>, <span class="hljs-number">50</span>: <span class="hljs-number">16</span>, <span class="hljs-number">51</span>: <span class="hljs-number">8</span>, <span class="hljs-number">52</span>: <span class="hljs-number">9</span>, <span class="hljs-number">53</span>: <span class="hljs-number">5</span>, <span class="hljs-number">54</span>: <span class="hljs-number">4</span>, <span class="hljs-number">55</span>: <span class="hljs-number">9</span>, <span class="hljs-number">56</span>: <span class="hljs-number">2</span>, <span class="hljs-number">57</span>: <span class="hljs-number">2</span>, <span class="hljs-number">58</span>: <span class="hljs-number">2</span>, <span class="hljs-number">59</span>: <span class="hljs-number">2</span>, <span class="hljs-number">60</span>: <span class="hljs-number">3</span>, <span class="hljs-number">62</span>: <span class="hljs-number">2</span>, <span class="hljs-number">66</span>: <span class="hljs-number">1</span>, <span class="hljs-number">67</span>: <span class="hljs-number">1</span>, <span class="hljs-number">69</span>: <span class="hljs-number">1</span>, <span class="hljs-number">71</span>: <span class="hljs-number">1</span>, <span class="hljs-number">72</span>: <span class="hljs-number">1</span>, <span class="hljs-number">78</span>: <span class="hljs-number">1</span>, <span class="hljs-number">80</span>: <span class="hljs-number">1</span>, <span class="hljs-number">113</span>: <span class="hljs-number">1</span>, <span class="hljs-number">124</span>: <span class="hljs-number">1</span>&#125;.<br><br>åˆ†ä½ç‚¹ä¸º<span class="hljs-number">0.9992</span>çš„å¥å­é•¿åº¦:<span class="hljs-number">60.</span><br></code></pre></td></tr></table></figure><p>åœ¨è¯¥è¯­æ–™åº“ä¸­ï¼Œä¸€å…±æœ‰13998ä¸ªå¥å­ï¼Œæ¯”é¢„æœŸçš„42000/3=14000ä¸ªå¥å­å°‘ä¸¤ä¸ªã€‚ä¸€ä¸ªæœ‰24339ä¸ªå•è¯ï¼Œå•è¯é‡è¿˜æ˜¯è›®å¤§çš„ï¼Œå½“ç„¶ï¼Œè¿™é‡Œå¯¹å•è¯æ²¡æœ‰åšä»»ä½•å¤„ç†ï¼Œç›´æ¥ä¿ç•™äº†è¯­æ–™åº“ä¸­çš„å½¢å¼ï¼ˆåæœŸå¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼‰ã€‚å•è¯çš„è¯æ€§å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<ahref="https://www.jianshu.com/p/79255fe0c5b5">NLPå…¥é—¨ï¼ˆä¸‰ï¼‰è¯å½¢è¿˜åŸï¼ˆLemmatizationï¼‰</a>ã€‚æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNERçš„æ ‡æ³¨åˆ—è¡¨ä¸º['O','B-MISC', 'I-MISC', 'B-ORG' ,'I-ORG', 'B-PER' ,'B-LOC' ,'I-PER','I-LOC','sO']ï¼Œå› æ­¤ï¼Œæœ¬é¡¹ç›®çš„NERä¸€å…±åˆ†ä¸ºå››ç±»ï¼šPERï¼ˆäººåï¼‰ï¼ŒLOCï¼ˆä½ç½®ï¼‰ï¼ŒORGï¼ˆç»„ç»‡ï¼‰ä»¥åŠMISCï¼Œå…¶ä¸­Bè¡¨ç¤ºå¼€å§‹ï¼ŒIè¡¨ç¤ºä¸­é—´ï¼ŒOè¡¨ç¤ºå•å­—è¯ï¼Œä¸è®¡å…¥NERï¼ŒsOè¡¨ç¤ºç‰¹æ®Šå•å­—è¯ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸‹å¥å­çš„é•¿åº¦ï¼Œè¿™å¯¹åé¢çš„å»ºæ¨¡æ—¶å¡«å……çš„å¥å­é•¿åº¦æœ‰æœ‰å‚è€ƒä½œç”¨ã€‚å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°çš„ç»Ÿè®¡å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp5_2.png" alt="å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾" /><figcaption aria-hidden="true">å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°ç»Ÿè®¡å›¾</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå¥å­é•¿åº¦åŸºæœ¬åœ¨60ä»¥ä¸‹ï¼Œå½“ç„¶ï¼Œè¿™ä¹Ÿå¯ä»¥åœ¨è¾“å‡ºçš„å¥å­é•¿åº¦åŠå‡ºç°é¢‘æ•°å­—å…¸ä¸­çœ‹åˆ°ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥é€‰åœ¨ä¸€ä¸ªæ ‡å‡†ä½œä¸ºåé¢æ¨¡å‹çš„å¥å­å¡«å……çš„é•¿åº¦å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œåˆ©ç”¨å‡ºç°é¢‘æ•°çš„ç´¯è®¡åˆ†å¸ƒå‡½æ•°çš„åˆ†ä½ç‚¹ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©åˆ†ä½ç‚¹ä¸º0.9992,å¯¹åº”çš„å¥å­é•¿åº¦ä¸º60ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp5_3.png" alt="å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾" /><figcaption aria-hidden="true">å¥å­é•¿åº¦ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾</figcaption></figure><p>æ¥ç€æ˜¯æ•°æ®å¤„ç†å‡½æ•°data_processing()ï¼Œå®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯å®ç°å•è¯ã€æ ‡ç­¾å­—å…¸ï¼Œå¹¶ä¿å­˜ä¸ºpickleæ–‡ä»¶å½¢å¼ï¼Œä¾¿äºåç»­ç›´æ¥è°ƒç”¨ã€‚</p><h3 id="å»ºæ¨¡">å»ºæ¨¡</h3><p>åœ¨ç¬¬ä¸‰æ­¥ä¸­ï¼Œæˆ‘ä»¬å»ºç«‹Bi-LSTMæ¨¡å‹æ¥è®­ç»ƒè®­ç»ƒï¼Œå®Œæ•´çš„Pythonä»£ç ï¼ˆBi_LSTM_Model_training.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> BASE_DIR, CONSTANTS, load_data<br><span class="hljs-keyword">from</span> data_processing <span class="hljs-keyword">import</span> data_processing<br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> np_utils, plot_model<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Sequential<br><span class="hljs-keyword">from</span> keras.preprocessing.sequence <span class="hljs-keyword">import</span> pad_sequences<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Bidirectional, LSTM, Dense, Embedding, TimeDistributed<br><br><br><span class="hljs-comment"># æ¨¡å‹è¾“å…¥æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">input_data_for_model</span>(<span class="hljs-params">input_shape</span>):<br><br>    <span class="hljs-comment"># æ•°æ®å¯¼å…¥</span><br>    input_data = load_data()<br>    <span class="hljs-comment"># æ•°æ®å¤„ç†</span><br>    data_processing()<br>    <span class="hljs-comment"># å¯¼å…¥å­—å…¸</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        word_dictionary = pickle.load(f)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">2</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        inverse_word_dictionary = pickle.load(f)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">3</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        label_dictionary = pickle.load(f)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">4</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        output_dictionary = pickle.load(f)<br>    vocab_size = <span class="hljs-built_in">len</span>(word_dictionary.keys())<br>    label_size = <span class="hljs-built_in">len</span>(label_dictionary.keys())<br><br>    <span class="hljs-comment"># å¤„ç†è¾“å…¥æ•°æ®</span><br>    aggregate_function = <span class="hljs-keyword">lambda</span> <span class="hljs-built_in">input</span>: [(word, pos, label) <span class="hljs-keyword">for</span> word, pos, label <span class="hljs-keyword">in</span><br>                                            <span class="hljs-built_in">zip</span>(<span class="hljs-built_in">input</span>[<span class="hljs-string">&#x27;word&#x27;</span>].values.tolist(),<br>                                                <span class="hljs-built_in">input</span>[<span class="hljs-string">&#x27;pos&#x27;</span>].values.tolist(),<br>                                                <span class="hljs-built_in">input</span>[<span class="hljs-string">&#x27;tag&#x27;</span>].values.tolist())]<br><br>    grouped_input_data = input_data.groupby(<span class="hljs-string">&#x27;sent_no&#x27;</span>).apply(aggregate_function)<br>    sentences = [sentence <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> grouped_input_data]<br><br>    x = [[word_dictionary[word[<span class="hljs-number">0</span>]] <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent] <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sentences]<br>    x = pad_sequences(maxlen=input_shape, sequences=x, padding=<span class="hljs-string">&#x27;post&#x27;</span>, value=<span class="hljs-number">0</span>)<br>    y = [[label_dictionary[word[<span class="hljs-number">2</span>]] <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sent] <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sentences]<br>    y = pad_sequences(maxlen=input_shape, sequences=y, padding=<span class="hljs-string">&#x27;post&#x27;</span>, value=<span class="hljs-number">0</span>)<br>    y = [np_utils.to_categorical(label, num_classes=label_size + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> y]<br><br>    <span class="hljs-keyword">return</span> x, y, output_dictionary, vocab_size, label_size, inverse_word_dictionary<br><br><br><span class="hljs-comment"># å®šä¹‰æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼šBi-LSTM</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_Bi_LSTM</span>(<span class="hljs-params">vocab_size, label_size, input_shape, output_dim, n_units, out_act, activation</span>):<br>    model = Sequential()<br>    model.add(Embedding(input_dim=vocab_size + <span class="hljs-number">1</span>, output_dim=output_dim,<br>                        input_length=input_shape, mask_zero=<span class="hljs-literal">True</span>))<br>    model.add(Bidirectional(LSTM(units=n_units, activation=activation,<br>                                 return_sequences=<span class="hljs-literal">True</span>)))<br>    model.add(TimeDistributed(Dense(label_size + <span class="hljs-number">1</span>, activation=out_act)))<br>    model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">&#x27;adam&#x27;</span>, loss=<span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>, metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>    <span class="hljs-keyword">return</span> model<br><br><br><span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">model_train</span>():<br><br>    <span class="hljs-comment"># å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå æ¯”ä¸º9:1</span><br>    input_shape = <span class="hljs-number">60</span><br>    x, y, output_dictionary, vocab_size, label_size, inverse_word_dictionary = input_data_for_model(input_shape)<br>    train_end = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(x)*<span class="hljs-number">0.9</span>)<br>    train_x, train_y = x[<span class="hljs-number">0</span>:train_end], np.array(y[<span class="hljs-number">0</span>:train_end])<br>    test_x, test_y = x[train_end:], np.array(y[train_end:])<br><br>    <span class="hljs-comment"># æ¨¡å‹è¾“å…¥å‚æ•°</span><br>    activation = <span class="hljs-string">&#x27;selu&#x27;</span><br>    out_act = <span class="hljs-string">&#x27;softmax&#x27;</span><br>    n_units = <span class="hljs-number">100</span><br>    batch_size = <span class="hljs-number">32</span><br>    epochs = <span class="hljs-number">10</span><br>    output_dim = <span class="hljs-number">20</span><br><br>    <span class="hljs-comment"># æ¨¡å‹è®­ç»ƒ</span><br>    lstm_model = create_Bi_LSTM(vocab_size, label_size, input_shape, output_dim, n_units, out_act, activation)<br>    lstm_model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment"># æ¨¡å‹ä¿å­˜</span><br>    model_save_path = CONSTANTS[<span class="hljs-number">0</span>]<br>    lstm_model.save(model_save_path)<br>    plot_model(lstm_model, to_file=<span class="hljs-string">&#x27;%s/LSTM_model.png&#x27;</span> % BASE_DIR)<br><br>    <span class="hljs-comment"># åœ¨æµ‹è¯•é›†ä¸Šçš„æ•ˆæœ</span><br>    N = test_x.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment"># æµ‹è¯•çš„æ¡æ•°</span><br>    avg_accuracy = <span class="hljs-number">0</span>  <span class="hljs-comment"># é¢„æµ‹çš„å¹³å‡å‡†ç¡®ç‡</span><br>    <span class="hljs-keyword">for</span> start, end <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, N, <span class="hljs-number">1</span>), <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, N+<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)):<br>        sentence = [inverse_word_dictionary[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> test_x[start] <span class="hljs-keyword">if</span> i != <span class="hljs-number">0</span>]<br>        y_predict = lstm_model.predict(test_x[start:end])<br>        input_sequences, output_sequences = [], []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(y_predict[<span class="hljs-number">0</span>])):<br>            output_sequences.append(np.argmax(y_predict[<span class="hljs-number">0</span>][i]))<br>            input_sequences.append(np.argmax(test_y[start][i]))<br><br>        <span class="hljs-built_in">eval</span> = lstm_model.evaluate(test_x[start:end], test_y[start:end])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Test Accuracy: loss = %0.6f accuracy = %0.2f%%&#x27;</span> % (<span class="hljs-built_in">eval</span>[<span class="hljs-number">0</span>], <span class="hljs-built_in">eval</span>[<span class="hljs-number">1</span>] * <span class="hljs-number">100</span>))<br>        avg_accuracy += <span class="hljs-built_in">eval</span>[<span class="hljs-number">1</span>]<br>        output_sequences = <span class="hljs-string">&#x27; &#x27;</span>.join([output_dictionary[key] <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> output_sequences <span class="hljs-keyword">if</span> key != <span class="hljs-number">0</span>]).split()<br>        input_sequences = <span class="hljs-string">&#x27; &#x27;</span>.join([output_dictionary[key] <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> input_sequences <span class="hljs-keyword">if</span> key != <span class="hljs-number">0</span>]).split()<br>        output_input_comparison = pd.DataFrame([sentence, output_sequences, input_sequences]).T<br>        <span class="hljs-built_in">print</span>(output_input_comparison.dropna())<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;#&#x27;</span> * <span class="hljs-number">80</span>)<br><br>    avg_accuracy /= N<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æµ‹è¯•æ ·æœ¬çš„å¹³å‡é¢„æµ‹å‡†ç¡®ç‡ï¼š%.2f%%.&quot;</span> % (avg_accuracy * <span class="hljs-number">100</span>))<br><br>model_train()<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå…ˆæ˜¯é€šè¿‡input_data_for_model()å‡½æ•°æ¥å¤„ç†å¥½è¿›å…¥æ¨¡å‹çš„æ•°æ®ï¼Œå…¶å‚æ•°ä¸ºinput_shapeï¼Œå³å¡«å……å¥å­æ—¶çš„é•¿åº¦ã€‚ç„¶åæ˜¯åˆ›å»ºBi-LSTMæ¨¡å‹create_Bi_LSTM()ï¼Œæ¨¡å‹çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp5_4.png" alt="æ¨¡å‹ç¤ºæ„å›¾" /><figcaption aria-hidden="true">æ¨¡å‹ç¤ºæ„å›¾</figcaption></figure><p>æœ€åï¼Œæ˜¯åœ¨è¾“å…¥çš„æ•°æ®ä¸Šè¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œå°†åŸå§‹çš„æ•°æ®åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå æ¯”ä¸º9:1ï¼Œè®­ç»ƒçš„å‘¨æœŸä¸º10æ¬¡ã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ">æ¨¡å‹è®­ç»ƒ</h3><p>è¿è¡Œä¸Šè¿°æ¨¡å‹è®­ç»ƒä»£ç ï¼Œä¸€å…±è®­ç»ƒ10ä¸ªå‘¨æœŸï¼Œè®­ç»ƒæ—¶é—´å¤§æ¦‚ä¸º500sï¼Œåœ¨è®­ç»ƒé›†ä¸Šçš„å‡†ç¡®ç‡è¾¾99%ä»¥ä¸Šï¼Œåœ¨æµ‹è¯•é›†ä¸Šçš„å¹³å‡å‡†ç¡®ç‡ä¸º95%ä»¥ä¸Šã€‚ä»¥ä¸‹æ˜¯æœ€åå‡ ä¸ªæµ‹è¯•é›†ä¸Šçš„é¢„æµ‹ç»“æœï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs clean">......(å‰é¢çš„è¾“å‡ºå·²å¿½ç•¥)<br>Test Accuracy: loss = <span class="hljs-number">0.000986</span> accuracy = <span class="hljs-number">100.00</span>%<br>          <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">2</span><br><span class="hljs-number">0</span>   Cardiff  B-ORG  B-ORG<br><span class="hljs-number">1</span>         <span class="hljs-number">1</span>      O      O<br><span class="hljs-number">2</span>  Brighton  B-ORG  B-ORG<br><span class="hljs-number">3</span>         <span class="hljs-number">0</span>      O      O<br>################################################################################<br><br><span class="hljs-number">1</span>/<span class="hljs-number">1</span> [==============================] - <span class="hljs-number">0</span>s <span class="hljs-number">10</span>ms/step<br>Test Accuracy: loss = <span class="hljs-number">0.000274</span> accuracy = <span class="hljs-number">100.00</span>%<br>          <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">2</span><br><span class="hljs-number">0</span>  Carlisle  B-ORG  B-ORG<br><span class="hljs-number">1</span>         <span class="hljs-number">0</span>      O      O<br><span class="hljs-number">2</span>      Hull  B-ORG  B-ORG<br><span class="hljs-number">3</span>         <span class="hljs-number">0</span>      O      O<br>################################################################################<br><br><span class="hljs-number">1</span>/<span class="hljs-number">1</span> [==============================] - <span class="hljs-number">0</span>s <span class="hljs-number">9</span>ms/step<br>Test Accuracy: loss = <span class="hljs-number">0.000479</span> accuracy = <span class="hljs-number">100.00</span>%<br>           <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">2</span><br><span class="hljs-number">0</span>    Chester  B-ORG  B-ORG<br><span class="hljs-number">1</span>          <span class="hljs-number">1</span>      O      O<br><span class="hljs-number">2</span>  Cambridge  B-ORG  B-ORG<br><span class="hljs-number">3</span>          <span class="hljs-number">1</span>      O      O<br>################################################################################<br><br><span class="hljs-number">1</span>/<span class="hljs-number">1</span> [==============================] - <span class="hljs-number">0</span>s <span class="hljs-number">9</span>ms/step<br>Test Accuracy: loss = <span class="hljs-number">0.003092</span> accuracy = <span class="hljs-number">100.00</span>%<br>            <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">2</span><br><span class="hljs-number">0</span>  Darlington  B-ORG  B-ORG<br><span class="hljs-number">1</span>           <span class="hljs-number">4</span>      O      O<br><span class="hljs-number">2</span>     Swansea  B-ORG  B-ORG<br><span class="hljs-number">3</span>           <span class="hljs-number">1</span>      O      O<br>################################################################################<br><br><span class="hljs-number">1</span>/<span class="hljs-number">1</span> [==============================] - <span class="hljs-number">0</span>s <span class="hljs-number">8</span>ms/step<br>Test Accuracy: loss = <span class="hljs-number">0.000705</span> accuracy = <span class="hljs-number">100.00</span>%<br>             <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">2</span><br><span class="hljs-number">0</span>       Exeter  B-ORG  B-ORG<br><span class="hljs-number">1</span>            <span class="hljs-number">2</span>      O      O<br><span class="hljs-number">2</span>  Scarborough  B-ORG  B-ORG<br><span class="hljs-number">3</span>            <span class="hljs-number">2</span>      O      O<br>################################################################################<br>æµ‹è¯•æ ·æœ¬çš„å¹³å‡é¢„æµ‹å‡†ç¡®ç‡ï¼š<span class="hljs-number">95.55</span>%.<br></code></pre></td></tr></table></figure><p>è¯¥æ¨¡å‹åœ¨åŸå§‹æ•°æ®ä¸Šçš„è¯†åˆ«æ•ˆæœè¿˜æ˜¯å¯ä»¥çš„ã€‚</p><p>è®­ç»ƒå®Œæ¨¡å‹åï¼ŒBASE_DIRä¸­çš„æ‰€æœ‰æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure><img src="/img/nlp5_5.png" alt="æ¨¡å‹è®­ç»ƒå®Œåçš„æ‰€æœ‰æ–‡ä»¶æˆªå›¾" /><figcaption aria-hidden="true">æ¨¡å‹è®­ç»ƒå®Œåçš„æ‰€æœ‰æ–‡ä»¶æˆªå›¾</figcaption></figure><h3 id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3><p>æœ€åï¼Œä¹Ÿè®¸æ˜¯æ•´ä¸ªé¡¹ç›®æœ€ä¸ºæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬è¦åœ¨æ–°æ•°æ®é›†ä¸Šæµ‹è¯•æ¨¡å‹çš„è¯†åˆ«æ•ˆæœã€‚é¢„æµ‹æ–°æ•°æ®çš„è¯†åˆ«ç»“æœçš„å®Œæ•´Pythonä»£ç ï¼ˆBi_LSTM_Model_predict.pyï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># Name entity recognition for new data</span><br><br><span class="hljs-comment"># Import the necessary modules</span><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> CONSTANTS<br><span class="hljs-keyword">from</span> keras.preprocessing.sequence <span class="hljs-keyword">import</span> pad_sequences<br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model<br><span class="hljs-keyword">from</span> nltk <span class="hljs-keyword">import</span> word_tokenize<br><br><span class="hljs-comment"># å¯¼å…¥å­—å…¸</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    word_dictionary = pickle.load(f)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(CONSTANTS[<span class="hljs-number">4</span>], <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    output_dictionary = pickle.load(f)<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># æ•°æ®é¢„å¤„ç†</span><br>    input_shape = <span class="hljs-number">60</span><br>    sent = <span class="hljs-string">&#x27;New York is the biggest city in America.&#x27;</span><br>    new_sent = word_tokenize(sent)<br>    new_x = [[word_dictionary[word] <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> new_sent]]<br>    x = pad_sequences(maxlen=input_shape, sequences=new_x, padding=<span class="hljs-string">&#x27;post&#x27;</span>, value=<span class="hljs-number">0</span>)<br><br>    <span class="hljs-comment"># è½½å…¥æ¨¡å‹</span><br>    model_save_path = CONSTANTS[<span class="hljs-number">0</span>]<br>    lstm_model = load_model(model_save_path)<br><br>    <span class="hljs-comment"># æ¨¡å‹é¢„æµ‹</span><br>    y_predict = lstm_model.predict(x)<br><br>    ner_tag = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(new_sent)):<br>        ner_tag.append(np.argmax(y_predict[<span class="hljs-number">0</span>][i]))<br><br>    ner = [output_dictionary[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ner_tag]<br>    <span class="hljs-built_in">print</span>(new_sent)<br>    <span class="hljs-built_in">print</span>(ner)<br><br>    <span class="hljs-comment"># å»æ‰NERæ ‡æ³¨ä¸ºOçš„å…ƒç´ </span><br>    ner_reg_list = []<br>    <span class="hljs-keyword">for</span> word, tag <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(new_sent, ner):<br>        <span class="hljs-keyword">if</span> tag != <span class="hljs-string">&#x27;O&#x27;</span>:<br>            ner_reg_list.append((word, tag))<br><br>    <span class="hljs-comment"># è¾“å‡ºæ¨¡å‹çš„NERè¯†åˆ«ç»“æœ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;NERè¯†åˆ«ç»“æœï¼š&quot;</span>)<br>    <span class="hljs-keyword">if</span> ner_reg_list:<br>        <span class="hljs-keyword">for</span> i, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(ner_reg_list):<br>            <span class="hljs-keyword">if</span> item[<span class="hljs-number">1</span>].startswith(<span class="hljs-string">&#x27;B&#x27;</span>):<br>                end = i+<span class="hljs-number">1</span><br>                <span class="hljs-keyword">while</span> end &lt;= <span class="hljs-built_in">len</span>(ner_reg_list)-<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> ner_reg_list[end][<span class="hljs-number">1</span>].startswith(<span class="hljs-string">&#x27;I&#x27;</span>):<br>                    end += <span class="hljs-number">1</span><br><br>                ner_type = item[<span class="hljs-number">1</span>].split(<span class="hljs-string">&#x27;-&#x27;</span>)[<span class="hljs-number">1</span>]<br>                ner_type_dict = &#123;<span class="hljs-string">&#x27;PER&#x27;</span>: <span class="hljs-string">&#x27;PERSON: &#x27;</span>,<br>                                <span class="hljs-string">&#x27;LOC&#x27;</span>: <span class="hljs-string">&#x27;LOCATION: &#x27;</span>,<br>                                <span class="hljs-string">&#x27;ORG&#x27;</span>: <span class="hljs-string">&#x27;ORGANIZATION: &#x27;</span>,<br>                                <span class="hljs-string">&#x27;MISC&#x27;</span>: <span class="hljs-string">&#x27;MISC: &#x27;</span><br>                                &#125;<br>                <span class="hljs-built_in">print</span>(ner_type_dict[ner_type],\<br>                    <span class="hljs-string">&#x27; &#x27;</span>.join([item[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> ner_reg_list[i:end]]))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¨¡å‹å¹¶æœªè¯†åˆ«ä»»ä½•æœ‰æ•ˆå‘½åå®ä½“ã€‚&quot;</span>)<br><br><span class="hljs-keyword">except</span> KeyError <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ‚¨è¾“å…¥çš„å¥å­æœ‰å•è¯ä¸åœ¨è¯æ±‡è¡¨ä¸­ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸åœ¨è¯æ±‡è¡¨ä¸­çš„å•è¯ä¸ºï¼š%s.&quot;</span> % err)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-string">&#x27;New&#x27;</span>, <span class="hljs-string">&#x27;York&#x27;</span>, <span class="hljs-string">&#x27;is&#x27;</span>, <span class="hljs-string">&#x27;the&#x27;</span>, <span class="hljs-string">&#x27;biggest&#x27;</span>, <span class="hljs-string">&#x27;city&#x27;</span>, <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;America&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>]<br>[<span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;I-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]<br>NERè¯†åˆ«ç»“æœï¼š<br><span class="hljs-keyword">LOCATION</span>:  <span class="hljs-built_in">New</span> York<br><span class="hljs-keyword">LOCATION</span>:  America<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå†æµ‹è¯•ä¸‰ä¸ªç¬”è€…è‡ªå·±æƒ³çš„å¥å­ï¼š</p><p>è¾“å…¥ä¸ºï¼š <figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">sent = <span class="hljs-symbol">&#x27;James</span> <span class="hljs-keyword">is</span> a world famous actor, whose home <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> London.&#x27;<br></code></pre></td></tr></table></figure> è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;James&#x27;</span>, <span class="hljs-string">&#x27;is&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;world&#x27;</span>, <span class="hljs-string">&#x27;famous&#x27;</span>, <span class="hljs-string">&#x27;actor&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;whose&#x27;</span>, <span class="hljs-string">&#x27;home&#x27;</span>, <span class="hljs-string">&#x27;is&#x27;</span>, <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;London&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>]</span><br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>NERè¯†åˆ«ç»“æœï¼š<br>PERSON:  James<br>LOCATION:  London<br></code></pre></td></tr></table></figure><p>è¾“å…¥ä¸ºï¼š <figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">sent = <span class="hljs-symbol">&#x27;Oxford</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> England, Jack <span class="hljs-keyword">is</span> from here.&#x27;<br></code></pre></td></tr></table></figure> è¾“å‡ºä¸ºï¼š <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;Oxford&#x27;</span>, <span class="hljs-string">&#x27;is&#x27;</span>, <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-string">&#x27;England&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;is&#x27;</span>, <span class="hljs-string">&#x27;from&#x27;</span>, <span class="hljs-string">&#x27;here&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>]</span><br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-PER&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>NERè¯†åˆ«ç»“æœï¼š<br>PERSON:  Oxford<br>LOCATION:  England<br>PERSON:  Jack<br></code></pre></td></tr></table></figure></p><p>è¾“å…¥ä¸ºï¼š <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">sent</span> = <span class="hljs-string">&#x27;I love Shanghai.&#x27;</span><br></code></pre></td></tr></table></figure> è¾“å‡ºä¸ºï¼š <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;love&#x27;</span>, <span class="hljs-string">&#x27;Shanghai&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>]</span><br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>NERè¯†åˆ«ç»“æœï¼š<br>LOCATION:  Shanghai<br></code></pre></td></tr></table></figure></p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåªæœ‰Oxfordçš„è¯†åˆ«æ•ˆæœä¸ç†æƒ³ï¼Œæ¨¡å‹å°†å®ƒè¯†åˆ«ä¸ºPERSONï¼Œå…¶å®åº”è¯¥æ˜¯ORGANIZATIONã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ä¸‰ä¸ªæ¥è‡ªCNNå’Œwikipediaçš„å¥å­ï¼š</p><p>è¾“å…¥ä¸ºï¼š <figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">sent</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;the US runs the risk of a military defeat by China or Russia&quot;</span><br></code></pre></td></tr></table></figure> è¾“å‡ºä¸ºï¼š <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-string">&#x27;the&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>, <span class="hljs-string">&#x27;runs&#x27;</span>, <span class="hljs-string">&#x27;the&#x27;</span>, <span class="hljs-string">&#x27;risk&#x27;</span>, <span class="hljs-string">&#x27;of&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;military&#x27;</span>, <span class="hljs-string">&#x27;defeat&#x27;</span>, <span class="hljs-string">&#x27;by&#x27;</span>, <span class="hljs-string">&#x27;China&#x27;</span>, <span class="hljs-string">&#x27;or&#x27;</span>, <span class="hljs-string">&#x27;Russia&#x27;</span>]<br>[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>]<br>NERè¯†åˆ«ç»“æœï¼š<br><span class="hljs-keyword">LOCATION</span>:  US<br><span class="hljs-keyword">LOCATION</span>:  China<br><span class="hljs-keyword">LOCATION</span>:  Russia<br></code></pre></td></tr></table></figure> è¾“å…¥ä¸ºï¼š<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk">sent = <span class="hljs-comment">&quot;Home to the headquarters of the United Nations, New York is an important center for international diplomacy.&quot;</span><br></code></pre></td></tr></table></figure> è¾“å‡ºä¸ºï¼š <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;Home&#x27;</span>, <span class="hljs-string">&#x27;to&#x27;</span>, <span class="hljs-string">&#x27;the&#x27;</span>, <span class="hljs-string">&#x27;headquarters&#x27;</span>, <span class="hljs-string">&#x27;of&#x27;</span>, <span class="hljs-string">&#x27;the&#x27;</span>, <span class="hljs-string">&#x27;United&#x27;</span>, <span class="hljs-string">&#x27;Nations&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;New&#x27;</span>, <span class="hljs-string">&#x27;York&#x27;</span>, <span class="hljs-string">&#x27;is&#x27;</span>, <span class="hljs-string">&#x27;an&#x27;</span>, <span class="hljs-string">&#x27;important&#x27;</span>, <span class="hljs-string">&#x27;center&#x27;</span>, <span class="hljs-string">&#x27;for&#x27;</span>, <span class="hljs-string">&#x27;international&#x27;</span>, <span class="hljs-string">&#x27;diplomacy&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>]</span><br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-ORG&#x27;</span>, <span class="hljs-string">&#x27;I-ORG&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;I-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>NERè¯†åˆ«ç»“æœï¼š<br>ORGANIZATION:  United Nations<br>LOCATION:  New York<br></code></pre></td></tr></table></figure></p><p>è¾“å…¥ä¸ºï¼š <figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">sent</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;The United States is a founding member of the United Nations, World Bank, International Monetary Fund.&quot;</span><br></code></pre></td></tr></table></figure> è¾“å‡ºä¸º: <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;The&#x27;</span>, <span class="hljs-string">&#x27;United&#x27;</span>, <span class="hljs-string">&#x27;States&#x27;</span>, <span class="hljs-string">&#x27;is&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;founding&#x27;</span>, <span class="hljs-string">&#x27;member&#x27;</span>, <span class="hljs-string">&#x27;of&#x27;</span>, <span class="hljs-string">&#x27;the&#x27;</span>, <span class="hljs-string">&#x27;United&#x27;</span>, <span class="hljs-string">&#x27;Nations&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;World&#x27;</span>, <span class="hljs-string">&#x27;Bank&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;International&#x27;</span>, <span class="hljs-string">&#x27;Monetary&#x27;</span>, <span class="hljs-string">&#x27;Fund&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>]</span><br><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-LOC&#x27;</span>, <span class="hljs-string">&#x27;I-LOC&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-ORG&#x27;</span>, <span class="hljs-string">&#x27;I-ORG&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-ORG&#x27;</span>, <span class="hljs-string">&#x27;I-ORG&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;B-ORG&#x27;</span>, <span class="hljs-string">&#x27;I-ORG&#x27;</span>, <span class="hljs-string">&#x27;I-ORG&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>]</span><br>NERè¯†åˆ«ç»“æœï¼š<br>LOCATION:  United States<br>ORGANIZATION:  United Nations<br>ORGANIZATION:  World Bank<br>ORGANIZATION:  International Monetary Fund<br></code></pre></td></tr></table></figure></p><p>è¿™ä¸‰ä¸ªä¾‹å­è¯†åˆ«å…¨éƒ¨æ­£ç¡®ã€‚</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>åˆ°è¿™å„¿ï¼Œç¬”è€…çš„è¿™ä¸ªé¡¹ç›®å°±å·®ä¸å¤šäº†ã€‚æˆ‘ä»¬æœ‰å¿…è¦å¯¹è¿™ä¸ªé¡¹ç›®åšä¸ªæ€»ç»“ã€‚</p><p>é¦–å…ˆæ˜¯è¿™ä¸ªé¡¹ç›®çš„ä¼˜ç‚¹ã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äºèƒ½å¤Ÿè®©ä½ ä¸€æ­¥æ­¥åœ°å®ç°NERï¼Œè€Œä¸”é™¤äº†è¯­æ–™åº“ï¼Œä½ åŸºæœ¬ç†Ÿæ‚‰äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªè¯†åˆ«NERç³»ç»Ÿçš„æ­¥éª¤ï¼ŒåŒæ—¶ï¼Œå¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹åŠå…¶åº”ç”¨ä¹Ÿæœ‰äº†æ·±åˆ»ç†è§£ã€‚å› æ­¤ï¼Œå¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚å½“ç„¶ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œè¯­æ–™åº“çš„æ•´ç†æ‰æ˜¯æœ€è€—è´¹æ—¶é—´çš„ï¼Œèƒ½å¤Ÿå åˆ°90%æˆ–è€…æ›´å¤šçš„æ—¶é—´ï¼Œå› æ­¤ï¼Œæœ‰ä¸€ä¸ªå¥½çš„è¯­æ–™åº“ä½ æ‰èƒ½å±•å¼€å·¥ä½œã€‚</p><p>æ¥ç€è®²è®²è¿™ä¸ªé¡¹ç›®çš„ç¼ºç‚¹ã€‚ç¬¬ä¸€ä¸ªï¼Œæ˜¯è¯­æ–™åº“ä¸å¤Ÿå¤§ï¼Œå½“ç„¶ï¼Œçº¦14000æ¡å¥å­ä¹Ÿå¤Ÿäº†ï¼Œä½†æœ¬é¡¹ç›®æ²¡æœ‰å¯¹å¥å­è¿›è¡Œæ–‡æœ¬é¢„å¤„ç†ï¼Œæ‰€ä»¥ï¼Œæœ‰äº›å•è¯çš„å˜å½¢å¯èƒ½æ— æ³•è¿›å…¥è¯æ±‡è¡¨ã€‚ç¬¬äºŒä¸ªï¼Œç¼ºå°‘å¯¹æ–°è¯çš„å¤„ç†ï¼Œä¸€æ—¦å¥å­ä¸­å‡ºç°ä¸€ä¸ªæ–°çš„å•è¯ï¼Œè¿™ä¸ªæ¨¡å‹ä¾¿æ— æ³•å¤„ç†ï¼Œè¿™æ˜¯åæœŸéœ€è¦å®Œå–„çš„åœ°æ–¹ã€‚ç¬¬ä¸‰ä¸ªï¼Œå¥å­çš„å¡«å……é•¿åº¦ä¸º60ï¼Œå¦‚æœè¾“å…¥çš„å¥å­é•¿åº¦å¤§äº60ï¼Œåˆ™åé¢çš„éƒ¨åˆ†å°†æ— æ³•æœ‰æ•ˆè¯†åˆ«ã€‚</p><p>å› æ­¤ï¼Œåç»­è¿˜æœ‰æ›´å¤šçš„å·¥ä½œéœ€è¦å»åšï¼Œå½“ç„¶ï¼Œåšä¸€ä¸ªä¸­æ–‡NERä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘çš„ã€‚</p><p>æœ¬é¡¹ç›®å·²ä¸Šä¼ Github,åœ°å€ä¸º <ahref="https://github.com/percent4/DL_4_NER">https://github.com/percent4/DL_4_NER</a>ã€‚ï¼šæ¬¢è¿å¤§å®¶å‚è€ƒ~</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><ol type="1"><li>BOOKï¼š Applied Natural Language Processing with Pythonï¼Œ TawehBeysolow II</li><li>WEBSITEï¼šhttps://github.com/Apress/applied-natural-language-processing-w-python</li><li>WEBSITE: NLPå…¥é—¨ï¼ˆå››ï¼‰å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰:https://www.jianshu.com/p/16e1f6a7aaef</li></ol>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>NER</tag>
      
      <tag>æ·±åº¦å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆå››ï¼‰å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰</title>
    <link href="/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%EF%BC%88NER%EF%BC%89/"/>
    <url>/2023/07/08/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%EF%BC%88NER%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡å°†ä¼šç®€å•ä»‹ç»è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä¸­çš„å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰ã€‚</p><p>å‘½åå®ä½“è¯†åˆ«ï¼ˆNamed EntityRecognitionï¼Œç®€ç§°NERï¼‰æ˜¯ä¿¡æ¯æå–ã€é—®ç­”ç³»ç»Ÿã€å¥æ³•åˆ†æã€æœºå™¨ç¿»è¯‘ç­‰åº”ç”¨é¢†åŸŸçš„é‡è¦åŸºç¡€å·¥å…·ï¼Œåœ¨è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯èµ°å‘å®ç”¨åŒ–çš„è¿‡ç¨‹ä¸­å æœ‰é‡è¦åœ°ä½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‘½åå®ä½“è¯†åˆ«çš„ä»»åŠ¡å°±æ˜¯è¯†åˆ«å‡ºå¾…å¤„ç†æ–‡æœ¬ä¸­ä¸‰å¤§ç±»ï¼ˆå®ä½“ç±»ã€æ—¶é—´ç±»å’Œæ•°å­—ç±»ï¼‰ã€ä¸ƒå°ç±»ï¼ˆäººåã€æœºæ„åã€åœ°åã€æ—¶é—´ã€æ—¥æœŸã€è´§å¸å’Œç™¾åˆ†æ¯”ï¼‰å‘½åå®ä½“ã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨å¥å­â€œå°æ˜æ—©ä¸Š8ç‚¹å»å­¦æ ¡ä¸Šè¯¾ã€‚â€ä¸­ï¼Œå¯¹å…¶è¿›è¡Œå‘½åå®ä½“è¯†åˆ«ï¼Œåº”è¯¥èƒ½æå–ä¿¡æ¯</p><blockquote><p>äººåï¼šå°æ˜ï¼Œæ—¶é—´ï¼šæ—©ä¸Š8ç‚¹ï¼Œåœ°ç‚¹ï¼šå­¦æ ¡ã€‚</p></blockquote><p>æœ¬æ–‡å°†ä¼šä»‹ç»å‡ ä¸ªå·¥å…·ç”¨æ¥è¿›è¡Œå‘½åå®ä½“è¯†åˆ«ï¼Œåç»­æœ‰æœºä¼šçš„è¯ï¼Œæˆ‘ä»¬å°†ä¼šå°è¯•ç€ç”¨HMMã€CRFæˆ–æ·±åº¦å­¦ä¹ æ¥å®ç°å‘½åå®ä½“è¯†åˆ«ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹NLTKå’ŒStanfordNLPä¸­å¯¹å‘½åå®ä½“è¯†åˆ«çš„åˆ†ç±»ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="/img/nlp4_1.png"alt="NLTKå’ŒStanford NLPä¸­å¯¹å‘½åå®ä½“è¯†åˆ«çš„åˆ†ç±»" /><figcaption aria-hidden="true">NLTKå’ŒStanfordNLPä¸­å¯¹å‘½åå®ä½“è¯†åˆ«çš„åˆ†ç±»</figcaption></figure><p>åœ¨ä¸Šå›¾ä¸­ï¼ŒLOCATIONå’ŒGPEæœ‰é‡åˆã€‚GPEé€šå¸¸è¡¨ç¤ºåœ°ç†â€”æ”¿æ²»æ¡ç›®ï¼Œæ¯”å¦‚åŸå¸‚ï¼Œå·ï¼Œå›½å®¶ï¼Œæ´²ç­‰ã€‚LOCATIONé™¤äº†ä¸Šè¿°å†…å®¹å¤–ï¼Œè¿˜èƒ½è¡¨ç¤ºåå±±å¤§å·ç­‰ã€‚FACILITYé€šå¸¸è¡¨ç¤ºçŸ¥åçš„çºªå¿µç¢‘æˆ–äººå·¥åˆ¶å“ç­‰ã€‚</p><p>ä¸‹é¢ä»‹ç»ä¸¤ä¸ªå·¥å…·æ¥è¿›è¡ŒNERçš„ä»»åŠ¡ï¼šNLTKå’ŒStanford NLPã€‚</p><p>é¦–å…ˆæ˜¯NLTKï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹æ–‡æ¡£ï¼ˆä»‹ç»FIFAï¼Œæ¥æºäºç»´åŸºç™¾ç§‘ï¼‰å¦‚ä¸‹ï¼š</p><blockquote><p>FIFA was founded in 1904 to oversee international competition amongthe national associations of Belgium, Denmark, France, Germany, theNetherlands, Spain, Sweden, and Switzerland. Headquartered in ZÃ¼rich,its membership now comprises 211 national associations. Member countriesmust each also be members of one of the six regional confederations intowhich the world is divided: Africa, Asia, Europe, North &amp; CentralAmerica and the Caribbean, Oceania, and South America.</p></blockquote><p>å®ç°NERçš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> nltk<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_document</span>(<span class="hljs-params">document</span>):<br>   document = re.sub(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, document)<br>   <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(document, <span class="hljs-built_in">str</span>):<br>       document = document<br>   <span class="hljs-keyword">else</span>:<br>       <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Document is not string!&#x27;</span>)<br>   document = document.strip()<br>   sentences = nltk.sent_tokenize(document)<br>   sentences = [sentence.strip() <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences]<br>   <span class="hljs-keyword">return</span> sentences<br><br><span class="hljs-comment"># sample document</span><br>text = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">FIFA was founded in 1904 to oversee international competition among the national associations of Belgium, </span><br><span class="hljs-string">Denmark, France, Germany, the Netherlands, Spain, Sweden, and Switzerland. Headquartered in ZÃ¼rich, its </span><br><span class="hljs-string">membership now comprises 211 national associations. Member countries must each also be members of one of </span><br><span class="hljs-string">the six regional confederations into which the world is divided: Africa, Asia, Europe, North &amp; Central America </span><br><span class="hljs-string">and the Caribbean, Oceania, and South America.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># tokenize sentences</span><br>sentences = parse_document(text)<br>tokenized_sentences = [nltk.word_tokenize(sentence) <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences]<br><span class="hljs-comment"># tag sentences and use nltk&#x27;s Named Entity Chunker</span><br>tagged_sentences = [nltk.pos_tag(sentence) <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> tokenized_sentences]<br>ne_chunked_sents = [nltk.ne_chunk(tagged) <span class="hljs-keyword">for</span> tagged <span class="hljs-keyword">in</span> tagged_sentences]<br><span class="hljs-comment"># extract all named entities</span><br>named_entities = []<br><span class="hljs-keyword">for</span> ne_tagged_sentence <span class="hljs-keyword">in</span> ne_chunked_sents:<br>   <span class="hljs-keyword">for</span> tagged_tree <span class="hljs-keyword">in</span> ne_tagged_sentence:<br>       <span class="hljs-comment"># extract only chunks having NE labels</span><br>       <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(tagged_tree, <span class="hljs-string">&#x27;label&#x27;</span>):<br>           entity_name = <span class="hljs-string">&#x27; &#x27;</span>.join(c[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> tagged_tree.leaves()) <span class="hljs-comment">#get NE name</span><br>           entity_type = tagged_tree.label() <span class="hljs-comment"># get NE category</span><br>           named_entities.append((entity_name, entity_type))<br>           <span class="hljs-comment"># get unique named entities</span><br>           named_entities = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(named_entities))<br><br><span class="hljs-comment"># store named entities in a data frame</span><br>entity_frame = pd.DataFrame(named_entities, columns=[<span class="hljs-string">&#x27;Entity Name&#x27;</span>, <span class="hljs-string">&#x27;Entity Type&#x27;</span>])<br><span class="hljs-comment"># display results</span><br><span class="hljs-built_in">print</span>(entity_frame)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">        Entity Name   Entity Type<br><span class="hljs-number">0</span>              FIFA  <span class="hljs-keyword">ORGANIZATION</span><br><span class="hljs-keyword"></span><span class="hljs-number">1</span>   Central America  <span class="hljs-keyword">ORGANIZATION</span><br><span class="hljs-keyword"></span><span class="hljs-number">2</span>           <span class="hljs-keyword">Belgium </span>          GPE<br><span class="hljs-number">3</span>         Caribbean      LOCATION<br><span class="hljs-number">4</span>              Asia           GPE<br><span class="hljs-number">5</span>            France           GPE<br><span class="hljs-number">6</span>           Oceania           GPE<br><span class="hljs-number">7</span>           Germany           GPE<br><span class="hljs-number">8</span>     South America           GPE<br><span class="hljs-number">9</span>           Denmark           GPE<br><span class="hljs-number">10</span>           ZÃ¼rich           GPE<br><span class="hljs-number">11</span>           Africa        PERSON<br><span class="hljs-number">12</span>           <span class="hljs-keyword">Sweden </span>          GPE<br><span class="hljs-number">13</span>      Netherlands           GPE<br><span class="hljs-number">14</span>            Spain           GPE<br><span class="hljs-number">15</span>      <span class="hljs-keyword">Switzerland </span>          GPE<br><span class="hljs-number">16</span>            <span class="hljs-keyword">North </span>          GPE<br><span class="hljs-number">17</span>           Europe           GPE<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒNLTKä¸­çš„NERä»»åŠ¡å¤§ä½“ä¸Šå®Œæˆå¾—è¿˜æ˜¯ä¸é”™çš„ï¼Œèƒ½å¤Ÿè¯†åˆ«FIFAä¸ºç»„ç»‡ï¼ˆORGANIZATIONï¼‰ï¼ŒBelgium,Asiaä¸ºGPE,ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ä¸å¤ªå¦‚äººæ„çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼Œå®ƒå°†CentralAmericaè¯†åˆ«ä¸ºORGANIZATIONï¼Œè€Œå®é™…ä¸Šå®ƒåº”è¯¥ä¸ºGPEï¼›å°†Africaè¯†åˆ«ä¸ºPERSONï¼Œå®é™…ä¸Šåº”è¯¥ä¸ºGPEã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•ç€ç”¨StanfordNLPå·¥å…·ã€‚å…³äºè¯¥å·¥å…·ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨Stanford NERæ ‡æ³¨å·¥å…·ã€‚åœ¨ä½¿ç”¨è¿™ä¸ªå·¥å…·ä¹‹å‰ï¼Œä½ éœ€è¦åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šå®‰è£…Javaï¼ˆä¸€èˆ¬æ˜¯JDKï¼‰ï¼Œå¹¶å°†Javaæ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„ä¸­ï¼ŒåŒæ—¶ä¸‹è½½è‹±è¯­NERçš„æ–‡ä»¶åŒ…ï¼šstanford-ner-2018-10-16.zipï¼ˆå¤§å°ä¸º172MBï¼‰ï¼Œä¸‹è½½åœ°å€ä¸ºï¼šhttps://nlp.stanford.edu/software/CRF-NER.shtmlã€‚ä»¥ç¬”è€…çš„ç”µè„‘ä¸ºä¾‹ï¼ŒJavaæ‰€åœ¨çš„è·¯å¾„ä¸ºï¼šC:Files.0_161.exeï¼Œ ä¸‹è½½StanfordNERçš„zipæ–‡ä»¶è§£å‹åçš„æ–‡ä»¶å¤¹çš„è·¯å¾„ä¸ºï¼šE://stanford-ner-2018-10-16ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/nlp4_2.png" /></p><p>åœ¨classiferæ–‡ä»¶å¤¹ä¸­æœ‰å¦‚ä¸‹æ–‡ä»¶ï¼š</p><p><img src="/img/nlp4_3.png" /></p><p>å®ƒä»¬ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>3 class: Location, Person, Organization 4 class: Location, Person,Organization, Misc 7 class: Location, Person, Organization, Money,Percent, Date, Time</p></blockquote><p>å¯ä»¥ä½¿ç”¨Pythonå®ç°Stanford NERï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> nltk.tag <span class="hljs-keyword">import</span> StanfordNERTagger<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> nltk<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_document</span>(<span class="hljs-params">document</span>):<br>   document = re.sub(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, document)<br>   <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(document, <span class="hljs-built_in">str</span>):<br>       document = document<br>   <span class="hljs-keyword">else</span>:<br>       <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Document is not string!&#x27;</span>)<br>   document = document.strip()<br>   sentences = nltk.sent_tokenize(document)<br>   sentences = [sentence.strip() <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences]<br>   <span class="hljs-keyword">return</span> sentences<br><br><span class="hljs-comment"># sample document</span><br>text = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">FIFA was founded in 1904 to oversee international competition among the national associations of Belgium, </span><br><span class="hljs-string">Denmark, France, Germany, the Netherlands, Spain, Sweden, and Switzerland. Headquartered in ZÃ¼rich, its </span><br><span class="hljs-string">membership now comprises 211 national associations. Member countries must each also be members of one of </span><br><span class="hljs-string">the six regional confederations into which the world is divided: Africa, Asia, Europe, North &amp; Central America </span><br><span class="hljs-string">and the Caribbean, Oceania, and South America.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>sentences = parse_document(text)<br>tokenized_sentences = [nltk.word_tokenize(sentence) <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences]<br><br><span class="hljs-comment"># set java path in environment variables</span><br>java_path = <span class="hljs-string">r&#x27;C:\Program Files\Java\jdk1.8.0_161\bin\java.exe&#x27;</span><br>os.environ[<span class="hljs-string">&#x27;JAVAHOME&#x27;</span>] = java_path<br><span class="hljs-comment"># load stanford NER</span><br>sn = StanfordNERTagger(<span class="hljs-string">&#x27;E://stanford-ner-2018-10-16/classifiers/english.muc.7class.distsim.crf.ser.gz&#x27;</span>,<br>                       path_to_jar=<span class="hljs-string">&#x27;E://stanford-ner-2018-10-16/stanford-ner.jar&#x27;</span>)<br><br><span class="hljs-comment"># tag sentences</span><br>ne_annotated_sentences = [sn.tag(sent) <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> tokenized_sentences]<br><span class="hljs-comment"># extract named entities</span><br>named_entities = []<br><span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> ne_annotated_sentences:<br>   temp_entity_name = <span class="hljs-string">&#x27;&#x27;</span><br>   temp_named_entity = <span class="hljs-literal">None</span><br>   <span class="hljs-keyword">for</span> term, tag <span class="hljs-keyword">in</span> sentence:<br>       <span class="hljs-comment"># get terms with NE tags</span><br>       <span class="hljs-keyword">if</span> tag != <span class="hljs-string">&#x27;O&#x27;</span>:<br>           temp_entity_name = <span class="hljs-string">&#x27; &#x27;</span>.join([temp_entity_name, term]).strip() <span class="hljs-comment">#get NE name</span><br>           temp_named_entity = (temp_entity_name, tag) <span class="hljs-comment"># get NE and its category</span><br>       <span class="hljs-keyword">else</span>:<br>           <span class="hljs-keyword">if</span> temp_named_entity:<br>               named_entities.append(temp_named_entity)<br>               temp_entity_name = <span class="hljs-string">&#x27;&#x27;</span><br>               temp_named_entity = <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># get unique named entities</span><br>named_entities = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(named_entities))<br><span class="hljs-comment"># store named entities in a data frame</span><br>entity_frame = pd.DataFrame(named_entities, columns=[<span class="hljs-string">&#x27;Entity Name&#x27;</span>, <span class="hljs-string">&#x27;Entity Type&#x27;</span>])<br><span class="hljs-comment"># display results</span><br><span class="hljs-built_in">print</span>(entity_frame)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">                Entity Name   Entity <span class="hljs-keyword">Type</span><br><span class="hljs-number">0</span>                      <span class="hljs-number">1904</span>          <span class="hljs-keyword">DATE</span><br><span class="hljs-number">1</span>                   Denmark      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">2</span>                     Spain      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">3</span>   North &amp; Central America  ORGANIZATION<br><span class="hljs-number">4</span>             South America      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">5</span>                   Belgium      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">6</span>                    ZÃ¼rich      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">7</span>           the Netherlands      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">8</span>                    France      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">9</span>                 Caribbean      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">10</span>                   Sweden      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">11</span>                  Oceania      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">12</span>                     Asia      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">13</span>                     FIFA  ORGANIZATION<br><span class="hljs-number">14</span>                   Europe      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">15</span>                   Africa      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">16</span>              Switzerland      <span class="hljs-keyword">LOCATION</span><br><span class="hljs-title">17</span>                  Germany      LOCATION<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨StanfordNERçš„å¸®åŠ©ä¸‹ï¼ŒNERçš„å®ç°æ•ˆæœè¾ƒå¥½ï¼Œå°†Africaè¯†åˆ«ä¸ºLOCATIONï¼Œå°†1904è¯†åˆ«ä¸ºæ—¶é—´ï¼ˆè¿™åœ¨NLTKä¸­æ²¡æœ‰è¯†åˆ«å‡ºæ¥ï¼‰ï¼Œä½†è¿˜æ˜¯å¯¹North&amp; Central Americaè¯†åˆ«æœ‰è¯¯ï¼Œå°†å…¶è¯†åˆ«ä¸ºORGANIZATIONã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯è¯´Stanford NERä¸€å®šä¼šæ¯”NLTKNERçš„æ•ˆæœå¥½ï¼Œä¸¤è€…é’ˆå¯¹çš„å¯¹è±¡ï¼Œé¢„æ–™ï¼Œç®—æ³•å¯èƒ½æœ‰å·®å¼‚ï¼Œå› æ­¤ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚å†³å®šä½¿ç”¨ä»€ä¹ˆå·¥å…·ã€‚</p><p>æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œä»¥åæœ‰æœºä¼šçš„è¯ï¼Œå°†ä¼šå°è¯•ç€ç”¨HMMã€CRFæˆ–æ·±åº¦å­¦ä¹ æ¥å®ç°å‘½åå®ä½“è¯†åˆ«ã€‚</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>NER</tag>
      
      <tag>NLPå·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆä¸‰ï¼‰è¯å½¢è¿˜åŸï¼ˆLemmatizationï¼‰</title>
    <link href="/2023/07/06/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E8%AF%8D%E5%BD%A2%E8%BF%98%E5%8E%9F%EF%BC%88Lemmatization%EF%BC%89/"/>
    <url>/2023/07/06/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E8%AF%8D%E5%BD%A2%E8%BF%98%E5%8E%9F%EF%BC%88Lemmatization%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è¯å½¢è¿˜åŸï¼ˆLemmatizationï¼‰æ˜¯æ–‡æœ¬é¢„å¤„ç†ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œä¸è¯å¹²æå–ï¼ˆstemmingï¼‰å¾ˆç›¸ä¼¼ã€‚</p><p>ç®€å•è¯´æ¥ï¼Œè¯å½¢è¿˜åŸå°±æ˜¯å»æ‰å•è¯çš„è¯ç¼€ï¼Œæå–å•è¯çš„ä¸»å¹²éƒ¨åˆ†ï¼Œé€šå¸¸æå–åçš„å•è¯ä¼šæ˜¯å­—å…¸ä¸­çš„å•è¯ï¼Œä¸åŒäºè¯å¹²æå–ï¼ˆstemmingï¼‰ï¼Œæå–åçš„å•è¯ä¸ä¸€å®šä¼šå‡ºç°åœ¨å•è¯ä¸­ã€‚æ¯”å¦‚ï¼Œå•è¯â€œcarsâ€è¯å½¢è¿˜åŸåçš„å•è¯ä¸ºâ€œcarâ€ï¼Œå•è¯â€œateâ€è¯å½¢è¿˜åŸåçš„å•è¯ä¸ºâ€œeatâ€ã€‚</p><p>åœ¨Pythonçš„nltkæ¨¡å—ä¸­ï¼Œä½¿ç”¨WordNetä¸ºæˆ‘ä»¬æä¾›äº†ç¨³å¥çš„è¯å½¢è¿˜åŸçš„å‡½æ•°ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹Pythonä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> nltk.stem <span class="hljs-keyword">import</span> WordNetLemmatizer<br><br>wnl = WordNetLemmatizer()<br><span class="hljs-comment"># lemmatize nouns</span><br><span class="hljs-built_in">print</span>(wnl.lemmatize(<span class="hljs-string">&#x27;cars&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>))<br><span class="hljs-built_in">print</span>(wnl.lemmatize(<span class="hljs-string">&#x27;men&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>))<br><br><span class="hljs-comment"># lemmatize verbs</span><br><span class="hljs-built_in">print</span>(wnl.lemmatize(<span class="hljs-string">&#x27;running&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>))<br><span class="hljs-built_in">print</span>(wnl.lemmatize(<span class="hljs-string">&#x27;ate&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>))<br><br><span class="hljs-comment"># lemmatize adjectives</span><br><span class="hljs-built_in">print</span>(wnl.lemmatize(<span class="hljs-string">&#x27;saddest&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>))<br><span class="hljs-built_in">print</span>(wnl.lemmatize(<span class="hljs-string">&#x27;fancier&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>car men run eat sad fancy</p></blockquote><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œwnl.lemmatize()å‡½æ•°å¯ä»¥è¿›è¡Œè¯å½¢è¿˜åŸï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå•è¯ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¯¥å•è¯çš„è¯æ€§ï¼Œå¦‚åè¯ï¼ŒåŠ¨è¯ï¼Œå½¢å®¹è¯ç­‰ï¼Œè¿”å›çš„ç»“æœä¸ºè¾“å…¥å•è¯çš„è¯å½¢è¿˜åŸåçš„ç»“æœã€‚</p><p>è¯å½¢è¿˜åŸä¸€èˆ¬æ˜¯ç®€å•çš„ï¼Œä½†å…·ä½“æˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶ï¼ŒæŒ‡å®šå•è¯çš„è¯æ€§å¾ˆé‡è¦ï¼Œä¸ç„¶è¯å½¢è¿˜åŸå¯èƒ½æ•ˆæœä¸å¥½ï¼Œå¦‚ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> nltk.stem <span class="hljs-keyword">import</span> WordNetLemmatizer<br><br>wnl = WordNetLemmatizer()<br><span class="hljs-built_in">print</span>(wnl.lemmatize(<span class="hljs-string">&#x27;ate&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>))<br><span class="hljs-built_in">print</span>(wnl.lemmatize(<span class="hljs-string">&#x27;fancier&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>ate fancier</p></blockquote><p>é‚£ä¹ˆï¼Œå¦‚ä½•è·å–å•è¯çš„è¯æ€§å‘¢ï¼Ÿåœ¨NLPä¸­ï¼Œä½¿ç”¨Parts ofspeechï¼ˆPOSï¼‰æŠ€æœ¯å®ç°ã€‚åœ¨nltkä¸­ï¼Œå¯ä»¥ä½¿ç”¨nltk.pos_tag()è·å–å•è¯åœ¨å¥å­ä¸­çš„è¯æ€§ï¼Œå¦‚ä»¥ä¸‹Pythonä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">sentence = <span class="hljs-string">&#x27;The brown fox is quick and he is jumping over the lazy dog&#x27;</span><br><span class="hljs-keyword">import</span> nltk<br>tokens = nltk.word_tokenize(sentence)<br>tagged_sent = nltk.pos_tag(tokens)<br><span class="hljs-built_in">print</span>(tagged_sent)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>[('The', 'DT'), ('brown', 'JJ'), ('fox', 'NN'), ('is', 'VBZ'),('quick', 'JJ'), ('and', 'CC'), ('he', 'PRP'), ('is', 'VBZ'),('jumping', 'VBG'), ('over', 'IN'), ('the', 'DT'), ('lazy', 'JJ'),('dog', 'NN')]</p></blockquote><p>å…³äºä¸Šè¿°è¯æ€§çš„è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨ï¼š</p><figure><img src="/img/nlp3_1.webp" alt="è¯æ€§è¯´æ˜è¡¨1" /><figcaption aria-hidden="true">è¯æ€§è¯´æ˜è¡¨1</figcaption></figure><figure><img src="/img/nlp3_2.webp" alt="è¯æ€§è¯´æ˜è¡¨2" /><figcaption aria-hidden="true">è¯æ€§è¯´æ˜è¡¨2</figcaption></figure><p>OKï¼ŒçŸ¥é“äº†è·å–å•è¯åœ¨å¥å­ä¸­çš„è¯æ€§ï¼Œå†ç»“åˆè¯å½¢è¿˜åŸï¼Œå°±èƒ½å¾ˆå¥½åœ°å®Œæˆè¯å½¢è¿˜åŸåŠŸèƒ½ã€‚ç¤ºä¾‹çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> nltk <span class="hljs-keyword">import</span> word_tokenize, pos_tag<br><span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> wordnet<br><span class="hljs-keyword">from</span> nltk.stem <span class="hljs-keyword">import</span> WordNetLemmatizer<br><br><span class="hljs-comment"># è·å–å•è¯çš„è¯æ€§</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_wordnet_pos</span>(<span class="hljs-params">tag</span>):<br>    <span class="hljs-keyword">if</span> tag.startswith(<span class="hljs-string">&#x27;J&#x27;</span>):<br>        <span class="hljs-keyword">return</span> wordnet.ADJ<br>    <span class="hljs-keyword">elif</span> tag.startswith(<span class="hljs-string">&#x27;V&#x27;</span>):<br>        <span class="hljs-keyword">return</span> wordnet.VERB<br>    <span class="hljs-keyword">elif</span> tag.startswith(<span class="hljs-string">&#x27;N&#x27;</span>):<br>        <span class="hljs-keyword">return</span> wordnet.NOUN<br>    <span class="hljs-keyword">elif</span> tag.startswith(<span class="hljs-string">&#x27;R&#x27;</span>):<br>        <span class="hljs-keyword">return</span> wordnet.ADV<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>sentence = <span class="hljs-string">&#x27;football is a family of team sports that involve, to varying degrees, kicking a ball to score a goal.&#x27;</span><br>tokens = word_tokenize(sentence)  <span class="hljs-comment"># åˆ†è¯</span><br>tagged_sent = pos_tag(tokens)     <span class="hljs-comment"># è·å–å•è¯è¯æ€§</span><br><br>wnl = WordNetLemmatizer()<br>lemmas_sent = []<br><span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> tagged_sent:<br>    wordnet_pos = get_wordnet_pos(tag[<span class="hljs-number">1</span>]) <span class="hljs-keyword">or</span> wordnet.NOUN<br>    lemmas_sent.append(wnl.lemmatize(tag[<span class="hljs-number">0</span>], pos=wordnet_pos)) <span class="hljs-comment"># è¯å½¢è¿˜åŸ</span><br><br><span class="hljs-built_in">print</span>(lemmas_sent)<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>['football', 'be', 'a', 'family', 'of', 'team', 'sport', 'that','involve', ',', 'to', 'vary', 'degree', ',', 'kick', 'a', 'ball', 'to','score', 'a', 'goal', '.']</p></blockquote><p>è¾“å‡ºçš„ç»“æœå°±æ˜¯å¯¹å¥å­ä¸­çš„å•è¯è¿›è¡Œè¯å½¢è¿˜åŸåçš„ç»“æœã€‚æœ¬æ¬¡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œæ¬¢è¿å¤§å®¶äº¤æµ~</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>è¯å½¢è¿˜åŸ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆäºŒï¼‰æ¢ç©¶TF-IDFçš„åŸç†</title>
    <link href="/2023/07/06/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E6%8E%A2%E7%A9%B6TF-IDF%E7%9A%84%E5%8E%9F%E7%90%86/"/>
    <url>/2023/07/06/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E6%8E%A2%E7%A9%B6TF-IDF%E7%9A%84%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="tf-idfä»‹ç»">TF-IDFä»‹ç»</h3><p>TF-IDFæ˜¯NLPä¸­ä¸€ç§å¸¸ç”¨çš„ç»Ÿè®¡æ–¹æ³•ï¼Œç”¨ä»¥è¯„ä¼°ä¸€ä¸ªå­—è¯å¯¹äºä¸€ä¸ªæ–‡ä»¶é›†æˆ–ä¸€ä¸ªè¯­æ–™åº“ä¸­çš„å…¶ä¸­ä¸€ä»½æ–‡ä»¶çš„é‡è¦ç¨‹åº¦ï¼Œé€šå¸¸ç”¨äºæå–æ–‡æœ¬çš„ç‰¹å¾ï¼Œå³å…³é”®è¯ã€‚å­—è¯çš„é‡è¦æ€§éšç€å®ƒåœ¨æ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°æˆæ­£æ¯”å¢åŠ ï¼Œä½†åŒæ—¶ä¼šéšç€å®ƒåœ¨è¯­æ–™åº“ä¸­å‡ºç°çš„é¢‘ç‡æˆåæ¯”ä¸‹é™ã€‚</p><p>åœ¨NLPä¸­ï¼ŒTF-IDFçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p><span class="math display">\[tfidf = tf*idf.\]</span></p><p>å…¶ä¸­ï¼Œtfæ˜¯è¯é¢‘(Term Frequency)ï¼Œidfä¸ºé€†å‘æ–‡ä»¶é¢‘ç‡(Inverse DocumentFrequency)ã€‚</p><p>tfä¸ºè¯é¢‘ï¼Œå³ä¸€ä¸ªè¯è¯­åœ¨æ–‡æ¡£ä¸­çš„å‡ºç°é¢‘ç‡ï¼Œå‡è®¾ä¸€ä¸ªè¯è¯­åœ¨æ•´ä¸ªæ–‡æ¡£ä¸­å‡ºç°äº†iæ¬¡ï¼Œè€Œæ•´ä¸ªæ–‡æ¡£æœ‰Nä¸ªè¯è¯­ï¼Œåˆ™tfçš„å€¼ä¸ºi/N.</p><p>idfä¸ºé€†å‘æ–‡ä»¶é¢‘ç‡ï¼Œå‡è®¾æ•´ä¸ªæ–‡æ¡£æœ‰nç¯‡æ–‡ç« ï¼Œè€Œä¸€ä¸ªè¯è¯­åœ¨kç¯‡æ–‡ç« ä¸­å‡ºç°ï¼Œåˆ™idfå€¼ä¸º</p><p><span class="math display">\[idf=\log_{2}(\frac{n}{k}).\]</span></p><p>å½“ç„¶ï¼Œä¸åŒåœ°æ–¹çš„idfå€¼è®¡ç®—å…¬å¼ä¼šæœ‰ç¨å¾®çš„ä¸åŒã€‚æ¯”å¦‚æœ‰äº›åœ°æ–¹ä¼šåœ¨åˆ†æ¯çš„kä¸ŠåŠ 1ï¼Œé˜²æ­¢åˆ†æ¯ä¸º0ï¼Œè¿˜æœ‰äº›åœ°æ–¹ä¼šè®©åˆ†å­ï¼Œåˆ†æ¯éƒ½åŠ ä¸Š1ï¼Œè¿™æ˜¯smoothingæŠ€å·§ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œè¿˜æ˜¯é‡‡ç”¨æœ€åŸå§‹çš„idfå€¼è®¡ç®—å…¬å¼ï¼Œå› ä¸ºè¿™ä¸gensimé‡Œé¢çš„è®¡ç®—å…¬å¼ä¸€è‡´ã€‚</p><p>å‡è®¾æ•´ä¸ªæ–‡æ¡£æœ‰Dç¯‡æ–‡ç« ï¼Œåˆ™å•è¯iåœ¨ç¬¬jç¯‡æ–‡ç« ä¸­çš„tfidfå€¼ä¸º</p><figure><img src="/img/nlp2_1.webp" alt="gensimä¸­tfidfçš„è®¡ç®—å…¬å¼" /><figcaption aria-hidden="true">gensimä¸­tfidfçš„è®¡ç®—å…¬å¼</figcaption></figure><p>ä»¥ä¸Šå°±æ˜¯TF-IDFçš„è®¡ç®—æ–¹æ³•ã€‚</p><h3 id="æ–‡æœ¬ä»‹ç»åŠé¢„å¤„ç†">æ–‡æœ¬ä»‹ç»åŠé¢„å¤„ç†</h3><p>æˆ‘ä»¬å°†é‡‡ç”¨ä»¥ä¸‹ä¸‰ä¸ªç¤ºä¾‹æ–‡æœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python">text1 =<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Football is a family of team sports that involve, to varying degrees, kicking a ball to score a goal. </span><br><span class="hljs-string">Unqualified, the word football is understood to refer to whichever form of football is the most popular </span><br><span class="hljs-string">in the regional context in which the word appears. Sports commonly called football in certain places </span><br><span class="hljs-string">include association football (known as soccer in some countries); gridiron football (specifically American </span><br><span class="hljs-string">football or Canadian football); Australian rules football; rugby football (either rugby league or rugby union); </span><br><span class="hljs-string">and Gaelic football. These different variations of football are known as football codes.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>text2 = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Basketball is a team sport in which two teams of five players, opposing one another on a rectangular court, </span><br><span class="hljs-string">compete with the primary objective of shooting a basketball (approximately 9.4 inches (24 cm) in diameter) </span><br><span class="hljs-string">through the defender&#x27;s hoop (a basket 18 inches (46 cm) in diameter mounted 10 feet (3.048 m) high to a backboard </span><br><span class="hljs-string">at each end of the court) while preventing the opposing team from shooting through their own hoop. A field goal is </span><br><span class="hljs-string">worth two points, unless made from behind the three-point line, when it is worth three. After a foul, timed play stops </span><br><span class="hljs-string">and the player fouled or designated to shoot a technical foul is given one or more one-point free throws. The team with </span><br><span class="hljs-string">the most points at the end of the game wins, but if regulation play expires with the score tied, an additional period </span><br><span class="hljs-string">of play (overtime) is mandated.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>text3 = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Volleyball, game played by two teams, usually of six players on a side, in which the players use their hands to bat a </span><br><span class="hljs-string">ball back and forth over a high net, trying to make the ball touch the court within the opponentsâ€™ playing area before </span><br><span class="hljs-string">it can be returned. To prevent this a player on the opposing team bats the ball up and toward a teammate before it touches </span><br><span class="hljs-string">the court surfaceâ€”that teammate may then volley it back across the net or bat it to a third teammate who volleys it across </span><br><span class="hljs-string">the net. A team is allowed only three touches of the ball before it must be returned over the net.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸‰ç¯‡æ–‡ç« åˆ†åˆ«æ˜¯å…³äºè¶³çƒï¼Œç¯®çƒï¼Œæ’çƒçš„ä»‹ç»ï¼Œå®ƒä»¬ç»„æˆä¸€ç¯‡æ–‡æ¡£ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯æ–‡æœ¬çš„é¢„å¤„ç†éƒ¨åˆ†ã€‚</p><p>é¦–å…ˆæ˜¯å¯¹æ–‡æœ¬å»æ‰æ¢è¡Œç¬¦ï¼Œç„¶åæ˜¯åˆ†å¥ï¼Œåˆ†è¯ï¼Œå†å»æ‰å…¶ä¸­çš„æ ‡ç‚¹ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼Œè¾“å…¥çš„å‚æ•°ä¸ºæ–‡ç« text:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> nltk<br><span class="hljs-keyword">import</span> string<br><br><span class="hljs-comment"># æ–‡æœ¬é¢„å¤„ç†</span><br><span class="hljs-comment"># å‡½æ•°ï¼štextæ–‡ä»¶åˆ†å¥ï¼Œåˆ†è¯ï¼Œå¹¶å»æ‰æ ‡ç‚¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tokens</span>(<span class="hljs-params">text</span>):<br>    text = text.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    sents = nltk.sent_tokenize(text)  <span class="hljs-comment"># åˆ†å¥</span><br>    tokens = []<br>    <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents:<br>        <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> nltk.word_tokenize(sent):  <span class="hljs-comment"># åˆ†è¯</span><br>            <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> string.punctuation: <span class="hljs-comment"># å»æ‰æ ‡ç‚¹</span><br>                tokens.append(word)<br>    <span class="hljs-keyword">return</span> tokens<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œå»æ‰æ–‡ç« ä¸­çš„é€šç”¨è¯ï¼ˆstopwordsï¼‰ï¼Œç„¶åç»Ÿè®¡æ¯ä¸ªå•è¯çš„å‡ºç°æ¬¡æ•°ï¼Œå®Œæ•´çš„Pythonä»£ç å¦‚ä¸‹ï¼Œè¾“å…¥çš„å‚æ•°ä¸ºæ–‡ç« text:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> stopwords     <span class="hljs-comment">#åœç”¨è¯</span><br><br><span class="hljs-comment"># å¯¹åŸå§‹çš„textæ–‡ä»¶å»æ‰åœç”¨è¯</span><br><span class="hljs-comment"># ç”Ÿæˆcountå­—å…¸ï¼Œå³æ¯ä¸ªå•è¯çš„å‡ºç°æ¬¡æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_count</span>(<span class="hljs-params">text</span>):<br>    tokens = get_tokens(text)<br>    filtered = [w <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> tokens <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> w <span class="hljs-keyword">in</span> stopwords.words(<span class="hljs-string">&#x27;english&#x27;</span>)]    <span class="hljs-comment">#å»æ‰åœç”¨è¯</span><br>    count = Counter(filtered)<br>    <span class="hljs-keyword">return</span> count<br></code></pre></td></tr></table></figure><p>ä»¥text3ä¸ºä¾‹ï¼Œç”Ÿæˆçš„countå­—å…¸å¦‚ä¸‹ï¼š</p><blockquote><p>Counter({'ball': 4, 'net': 4, 'teammate': 3, 'returned': 2, 'bat': 2,'court': 2, 'team': 2, 'across': 2, 'touches': 2, 'back': 2, 'players':2, 'touch': 1, 'must': 1, 'usually': 1, 'side': 1, 'player': 1, 'area':1, 'Volleyball': 1, 'hands': 1, 'may': 1, 'toward': 1, 'A': 1, 'third':1, 'two': 1, 'six': 1, 'opposing': 1, 'within': 1, 'prevent': 1,'allowed': 1, 'â€™': 1, 'playing': 1, 'played': 1, 'volley': 1,'surfaceâ€”that': 1, 'volleys': 1, 'opponents': 1, 'use': 1, 'high': 1,'teams': 1, 'bats': 1, 'To': 1, 'game': 1, 'make': 1, 'forth': 1,'three': 1, 'trying': 1})</p></blockquote><h3 id="gensimä¸­çš„tf-idf">Gensimä¸­çš„TF-IDF</h3><p>å¯¹æ–‡æœ¬è¿›è¡Œé¢„å¤„ç†åï¼Œå¯¹äºä»¥ä¸Šä¸‰ä¸ªç¤ºä¾‹æ–‡æœ¬ï¼Œæˆ‘ä»¬éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªcountå­—å…¸ï¼Œé‡Œé¢æ˜¯æ¯ä¸ªæ–‡æœ¬ä¸­å•è¯çš„å‡ºç°æ¬¡æ•°ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ç”¨gensimä¸­çš„å·²å®ç°çš„TF-IDFæ¨¡å‹ï¼Œæ¥è¾“å‡ºæ¯ç¯‡æ–‡ç« ä¸­TF-IDFæ’åå‰ä¸‰çš„å•è¯åŠå®ƒä»¬çš„tfidfå€¼ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> stopwords     <span class="hljs-comment">#åœç”¨è¯</span><br><span class="hljs-keyword">from</span> gensim <span class="hljs-keyword">import</span> corpora, models, matutils<br><br><span class="hljs-comment">#training by gensim&#x27;s Ifidf Model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_words</span>(<span class="hljs-params">text</span>):<br>    tokens = get_tokens(text)<br>    filtered = [w <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> tokens <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> w <span class="hljs-keyword">in</span> stopwords.words(<span class="hljs-string">&#x27;english&#x27;</span>)]<br>    <span class="hljs-keyword">return</span> filtered<br><br><span class="hljs-comment"># get text</span><br>count1, count2, count3 = get_words(text1), get_words(text2), get_words(text3)<br>countlist = [count1, count2, count3]<br><span class="hljs-comment"># training by TfidfModel in gensim</span><br>dictionary = corpora.Dictionary(countlist)<br>new_dict = &#123;v:k <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> dictionary.token2id.items()&#125;<br>corpus2 = [dictionary.doc2bow(count) <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> countlist]<br>tfidf2 = models.TfidfModel(corpus2)<br>corpus_tfidf = tfidf2[corpus2]<br><br><span class="hljs-comment"># output</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nTraining by gensim Tfidf Model.......\n&quot;</span>)<br><span class="hljs-keyword">for</span> i, doc <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(corpus_tfidf):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Top words in document %d&quot;</span>%(i + <span class="hljs-number">1</span>))<br>    sorted_words = <span class="hljs-built_in">sorted</span>(doc, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)    <span class="hljs-comment">#type=list</span><br>    <span class="hljs-keyword">for</span> num, score <span class="hljs-keyword">in</span> sorted_words[:<span class="hljs-number">3</span>]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;    Word: %s, TF-IDF: %s&quot;</span>%(new_dict[num], <span class="hljs-built_in">round</span>(score, <span class="hljs-number">5</span>)))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Training</span> by gensim Tfidf Model.......<br><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">1</span><br>    <span class="hljs-attribute">Word</span>: football, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">84766</span><br>    <span class="hljs-attribute">Word</span>: rugby, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">21192</span><br>    <span class="hljs-attribute">Word</span>: known, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">14128</span><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">2</span><br>    <span class="hljs-attribute">Word</span>: play, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">29872</span><br>    <span class="hljs-attribute">Word</span>: cm, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">19915</span><br>    <span class="hljs-attribute">Word</span>: diameter, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">19915</span><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">3</span><br>    <span class="hljs-attribute">Word</span>: net, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">45775</span><br>    <span class="hljs-attribute">Word</span>: teammate, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">34331</span><br>    <span class="hljs-attribute">Word</span>: across, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">22888</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœè¿˜æ˜¯æ¯”è¾ƒç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸçš„ï¼Œæ¯”å¦‚å…³äºè¶³çƒçš„æ–‡ç« ä¸­æå–äº†football,rugbyå…³é”®è¯ï¼Œå…³äºç¯®çƒçš„æ–‡ç« ä¸­æå–äº†plat,cmå…³é”®è¯ï¼Œå…³äºæ’çƒçš„æ–‡ç« ä¸­æå–äº†net, teammateå…³é”®è¯ã€‚</p><h3 id="è‡ªå·±åŠ¨æ‰‹å®è·µtf-idfæ¨¡å‹">è‡ªå·±åŠ¨æ‰‹å®è·µTF-IDFæ¨¡å‹</h3><p>æœ‰äº†ä»¥ä¸Šæˆ‘ä»¬å¯¹TF-IDFæ¨¡å‹çš„ç†è§£ï¼Œå…¶å®æˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥åŠ¨æ‰‹å®è·µä¸€æŠŠï¼Œè¿™æ˜¯å­¦ä¹ ç®—æ³•çš„æœ€ä½³æ–¹å¼ï¼</p><p>ä»¥ä¸‹æ˜¯ç¬”è€…å®è·µTF-IDFçš„ä»£ç ï¼ˆæ¥æ–‡æœ¬é¢„å¤„ç†ä»£ç ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><br><span class="hljs-comment"># è®¡ç®—tf</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tf</span>(<span class="hljs-params">word, count</span>):<br>    <span class="hljs-keyword">return</span> count[word] / <span class="hljs-built_in">sum</span>(count.values())<br><span class="hljs-comment"># è®¡ç®—count_listæœ‰å¤šå°‘ä¸ªæ–‡ä»¶åŒ…å«word</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">n_containing</span>(<span class="hljs-params">word, count_list</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> count_list <span class="hljs-keyword">if</span> word <span class="hljs-keyword">in</span> count)<br><br><span class="hljs-comment"># è®¡ç®—idf</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">idf</span>(<span class="hljs-params">word, count_list</span>):<br>    <span class="hljs-keyword">return</span> math.log2(<span class="hljs-built_in">len</span>(count_list) / (n_containing(word, count_list)))    <span class="hljs-comment">#å¯¹æ•°ä»¥2ä¸ºåº•</span><br><span class="hljs-comment"># è®¡ç®—tf-idf</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tfidf</span>(<span class="hljs-params">word, count, count_list</span>):<br>    <span class="hljs-keyword">return</span> tf(word, count) * idf(word, count_list)<br><br><span class="hljs-comment"># TF-IDFæµ‹è¯•</span><br>count1, count2, count3 = make_count(text1), make_count(text2), make_count(text3)<br>countlist = [count1, count2, count3]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Training by original algorithm......\n&quot;</span>)<br><span class="hljs-keyword">for</span> i, count <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(countlist):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Top words in document %d&quot;</span>%(i + <span class="hljs-number">1</span>))<br>    scores = &#123;word: tfidf(word, count, countlist) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> count&#125;<br>    sorted_words = <span class="hljs-built_in">sorted</span>(scores.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)    <span class="hljs-comment">#type=list</span><br>    <span class="hljs-comment"># sorted_words = matutils.unitvec(sorted_words)</span><br>    <span class="hljs-keyword">for</span> word, score <span class="hljs-keyword">in</span> sorted_words[:<span class="hljs-number">3</span>]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;    Word: %s, TF-IDF: %s&quot;</span>%(word, <span class="hljs-built_in">round</span>(score, <span class="hljs-number">5</span>)))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Training</span> by original algorithm......<br><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">1</span><br>    <span class="hljs-attribute">Word</span>: football, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">30677</span><br>    <span class="hljs-attribute">Word</span>: rugby, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">07669</span><br>    <span class="hljs-attribute">Word</span>: known, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">05113</span><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">2</span><br>    <span class="hljs-attribute">Word</span>: play, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">05283</span><br>    <span class="hljs-attribute">Word</span>: inches, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">03522</span><br>    <span class="hljs-attribute">Word</span>: worth, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">03522</span><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">3</span><br>    <span class="hljs-attribute">Word</span>: net, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">10226</span><br>    <span class="hljs-attribute">Word</span>: teammate, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">07669</span><br>    <span class="hljs-attribute">Word</span>: across, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">05113</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç¬”è€…è‡ªå·±åŠ¨æ‰‹å®è·µçš„TF-IDFæ¨¡å‹æå–çš„å…³é”®è¯ä¸gensimä¸€è‡´ï¼Œè‡³äºç¯®çƒä¸­ä¸ºä»€ä¹ˆåä¸¤ä¸ªå•è¯ä¸ä¸€è‡´ï¼Œæ˜¯å› ä¸ºè¿™äº›å•è¯çš„tfidfä¸€æ ·ï¼Œéšæœºé€‰æ‹©çš„ç»“æœä¸åŒè€Œå·²ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯è®¡ç®—å¾—åˆ°çš„tfidfå€¼ä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p><p>æŸ¥é˜…gensimä¸­è®¡ç®—tf-idfå€¼çš„æºä»£ç ï¼ˆhttps://github.com/RaRe-Technologies/gensim/blob/develop/gensim/models/tfidfmodel.pyï¼‰ï¼š</p><figure><img src="/img/nlp2_2.webp" alt="TfidfModelç±»çš„å‚æ•°" /><figcaption aria-hidden="true">TfidfModelç±»çš„å‚æ•°</figcaption></figure><figure><img src="/img/nlp2_3.webp" alt="normalizeå‚æ•°çš„è¯´æ˜" /><figcaption aria-hidden="true">normalizeå‚æ•°çš„è¯´æ˜</figcaption></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œgensimå¯¹å¾—åˆ°çš„tf-idfå‘é‡åšäº†è§„èŒƒåŒ–ï¼ˆnormalizeï¼‰ï¼Œå°†å…¶è½¬åŒ–ä¸ºå•ä½å‘é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆšæ‰çš„ä»£ç ä¸­åŠ å…¥è§„èŒƒåŒ–è¿™ä¸€æ­¥ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># å¯¹å‘é‡åšè§„èŒƒåŒ–, normalize</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">unitvec</span>(<span class="hljs-params">sorted_words</span>):<br>    lst = [item[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> sorted_words]<br>    L2Norm = math.sqrt(<span class="hljs-built_in">sum</span>(np.array(lst)*np.array(lst)))<br>    unit_vector = [(item[<span class="hljs-number">0</span>], item[<span class="hljs-number">1</span>]/L2Norm) <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> sorted_words]<br>    <span class="hljs-keyword">return</span> unit_vector<br><br><span class="hljs-comment"># TF-IDFæµ‹è¯•</span><br>count1, count2, count3 = make_count(text1), make_count(text2), make_count(text3)<br>countlist = [count1, count2, count3]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Training by original algorithm......\n&quot;</span>)<br><span class="hljs-keyword">for</span> i, count <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(countlist):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Top words in document %d&quot;</span>%(i + <span class="hljs-number">1</span>))<br>    scores = &#123;word: tfidf(word, count, countlist) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> count&#125;<br>    sorted_words = <span class="hljs-built_in">sorted</span>(scores.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)    <span class="hljs-comment">#type=list</span><br>    sorted_words = unitvec(sorted_words)   <span class="hljs-comment"># normalize</span><br>    <span class="hljs-keyword">for</span> word, score <span class="hljs-keyword">in</span> sorted_words[:<span class="hljs-number">3</span>]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;    Word: %s, TF-IDF: %s&quot;</span>%(word, <span class="hljs-built_in">round</span>(score, <span class="hljs-number">5</span>)))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Training</span> by original algorithm......<br><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">1</span><br>    <span class="hljs-attribute">Word</span>: football, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">84766</span><br>    <span class="hljs-attribute">Word</span>: rugby, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">21192</span><br>    <span class="hljs-attribute">Word</span>: known, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">14128</span><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">2</span><br>    <span class="hljs-attribute">Word</span>: play, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">29872</span><br>    <span class="hljs-attribute">Word</span>: shooting, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">19915</span><br>    <span class="hljs-attribute">Word</span>: diameter, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">19915</span><br><span class="hljs-attribute">Top</span> words in document <span class="hljs-number">3</span><br>    <span class="hljs-attribute">Word</span>: net, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">45775</span><br>    <span class="hljs-attribute">Word</span>: teammate, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">34331</span><br>    <span class="hljs-attribute">Word</span>: back, TF-IDF: <span class="hljs-number">0</span>.<span class="hljs-number">22888</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨çš„è¾“å‡ºç»“æœä¸gensimå¾—åˆ°çš„ç»“æœä¸€è‡´ï¼</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>Gensimæ˜¯PythonåšNLPæ—¶é¼é¼å¤§åçš„æ¨¡å—ï¼Œæœ‰ç©ºè¿˜æ˜¯å¤šè¯»è¯»æºç å§ï¼ä»¥åï¼Œæˆ‘ä»¬è¿˜ä¼šç»§ç»­ä»‹ç»TF-IDFåœ¨å…¶å®ƒæ–¹é¢çš„åº”ç”¨ï¼Œæ¬¢è¿å¤§å®¶äº¤æµ~</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œ æ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p><p>æœ¬æ–‡çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> nltk<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> stopwords     <span class="hljs-comment">#åœç”¨è¯</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter       <span class="hljs-comment">#è®¡æ•°</span><br><span class="hljs-keyword">from</span> gensim <span class="hljs-keyword">import</span> corpora, models, matutils<br><br>text1 =<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Football is a family of team sports that involve, to varying degrees, kicking a ball to score a goal. </span><br><span class="hljs-string">Unqualified, the word football is understood to refer to whichever form of football is the most popular </span><br><span class="hljs-string">in the regional context in which the word appears. Sports commonly called football in certain places </span><br><span class="hljs-string">include association football (known as soccer in some countries); gridiron football (specifically American </span><br><span class="hljs-string">football or Canadian football); Australian rules football; rugby football (either rugby league or rugby union); </span><br><span class="hljs-string">and Gaelic football. These different variations of football are known as football codes.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>text2 = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Basketball is a team sport in which two teams of five players, opposing one another on a rectangular court, </span><br><span class="hljs-string">compete with the primary objective of shooting a basketball (approximately 9.4 inches (24 cm) in diameter) </span><br><span class="hljs-string">through the defender&#x27;s hoop (a basket 18 inches (46 cm) in diameter mounted 10 feet (3.048 m) high to a backboard </span><br><span class="hljs-string">at each end of the court) while preventing the opposing team from shooting through their own hoop. A field goal is </span><br><span class="hljs-string">worth two points, unless made from behind the three-point line, when it is worth three. After a foul, timed play stops </span><br><span class="hljs-string">and the player fouled or designated to shoot a technical foul is given one or more one-point free throws. The team with </span><br><span class="hljs-string">the most points at the end of the game wins, but if regulation play expires with the score tied, an additional period </span><br><span class="hljs-string">of play (overtime) is mandated.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>text3 = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Volleyball, game played by two teams, usually of six players on a side, in which the players use their hands to bat a </span><br><span class="hljs-string">ball back and forth over a high net, trying to make the ball touch the court within the opponentsâ€™ playing area before </span><br><span class="hljs-string">it can be returned. To prevent this a player on the opposing team bats the ball up and toward a teammate before it touches </span><br><span class="hljs-string">the court surfaceâ€”that teammate may then volley it back across the net or bat it to a third teammate who volleys it across </span><br><span class="hljs-string">the net. A team is allowed only three touches of the ball before it must be returned over the net.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># æ–‡æœ¬é¢„å¤„ç†</span><br><span class="hljs-comment"># å‡½æ•°ï¼štextæ–‡ä»¶åˆ†å¥ï¼Œåˆ†è¯ï¼Œå¹¶å»æ‰æ ‡ç‚¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tokens</span>(<span class="hljs-params">text</span>):<br>    text = text.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    sents = nltk.sent_tokenize(text)  <span class="hljs-comment"># åˆ†å¥</span><br>    tokens = []<br>    <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents:<br>        <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> nltk.word_tokenize(sent):  <span class="hljs-comment"># åˆ†è¯</span><br>            <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> string.punctuation: <span class="hljs-comment"># å»æ‰æ ‡ç‚¹</span><br>                tokens.append(word)<br>    <span class="hljs-keyword">return</span> tokens<br><br><span class="hljs-comment"># å¯¹åŸå§‹çš„textæ–‡ä»¶å»æ‰åœç”¨è¯</span><br><span class="hljs-comment"># ç”Ÿæˆcountå­—å…¸ï¼Œå³æ¯ä¸ªå•è¯çš„å‡ºç°æ¬¡æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_count</span>(<span class="hljs-params">text</span>):<br>    tokens = get_tokens(text)<br>    filtered = [w <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> tokens <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> w <span class="hljs-keyword">in</span> stopwords.words(<span class="hljs-string">&#x27;english&#x27;</span>)]    <span class="hljs-comment">#å»æ‰åœç”¨è¯</span><br>    count = Counter(filtered)<br>    <span class="hljs-keyword">return</span> count<br><br><span class="hljs-comment"># è®¡ç®—tf</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tf</span>(<span class="hljs-params">word, count</span>):<br>    <span class="hljs-keyword">return</span> count[word] / <span class="hljs-built_in">sum</span>(count.values())<br><span class="hljs-comment"># è®¡ç®—count_listæœ‰å¤šå°‘ä¸ªæ–‡ä»¶åŒ…å«word</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">n_containing</span>(<span class="hljs-params">word, count_list</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> count_list <span class="hljs-keyword">if</span> word <span class="hljs-keyword">in</span> count)<br><br><span class="hljs-comment"># è®¡ç®—idf</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">idf</span>(<span class="hljs-params">word, count_list</span>):<br>    <span class="hljs-keyword">return</span> math.log2(<span class="hljs-built_in">len</span>(count_list) / (n_containing(word, count_list)))    <span class="hljs-comment">#å¯¹æ•°ä»¥2ä¸ºåº•</span><br><span class="hljs-comment"># è®¡ç®—tf-idf</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tfidf</span>(<span class="hljs-params">word, count, count_list</span>):<br>    <span class="hljs-keyword">return</span> tf(word, count) * idf(word, count_list)<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># å¯¹å‘é‡åšè§„èŒƒåŒ–, normalize</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">unitvec</span>(<span class="hljs-params">sorted_words</span>):<br>    lst = [item[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> sorted_words]<br>    L2Norm = math.sqrt(<span class="hljs-built_in">sum</span>(np.array(lst)*np.array(lst)))<br>    unit_vector = [(item[<span class="hljs-number">0</span>], item[<span class="hljs-number">1</span>]/L2Norm) <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> sorted_words]<br>    <span class="hljs-keyword">return</span> unit_vector<br><br><span class="hljs-comment"># TF-IDFæµ‹è¯•</span><br>count1, count2, count3 = make_count(text1), make_count(text2), make_count(text3)<br>countlist = [count1, count2, count3]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Training by original algorithm......\n&quot;</span>)<br><span class="hljs-keyword">for</span> i, count <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(countlist):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Top words in document %d&quot;</span>%(i + <span class="hljs-number">1</span>))<br>    scores = &#123;word: tfidf(word, count, countlist) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> count&#125;<br>    sorted_words = <span class="hljs-built_in">sorted</span>(scores.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)    <span class="hljs-comment">#type=list</span><br>    sorted_words = unitvec(sorted_words)   <span class="hljs-comment"># normalize</span><br>    <span class="hljs-keyword">for</span> word, score <span class="hljs-keyword">in</span> sorted_words[:<span class="hljs-number">3</span>]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;    Word: %s, TF-IDF: %s&quot;</span>%(word, <span class="hljs-built_in">round</span>(score, <span class="hljs-number">5</span>)))<br><br><span class="hljs-comment">#training by gensim&#x27;s Ifidf Model</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_words</span>(<span class="hljs-params">text</span>):<br>    tokens = get_tokens(text)<br>    filtered = [w <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> tokens <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> w <span class="hljs-keyword">in</span> stopwords.words(<span class="hljs-string">&#x27;english&#x27;</span>)]<br>    <span class="hljs-keyword">return</span> filtered<br><br><span class="hljs-comment"># get text</span><br>count1, count2, count3 = get_words(text1), get_words(text2), get_words(text3)<br>countlist = [count1, count2, count3]<br><span class="hljs-comment"># training by TfidfModel in gensim</span><br>dictionary = corpora.Dictionary(countlist)<br>new_dict = &#123;v:k <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> dictionary.token2id.items()&#125;<br>corpus2 = [dictionary.doc2bow(count) <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> countlist]<br>tfidf2 = models.TfidfModel(corpus2)<br>corpus_tfidf = tfidf2[corpus2]<br><br><span class="hljs-comment"># output</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nTraining by gensim Tfidf Model.......\n&quot;</span>)<br><span class="hljs-keyword">for</span> i, doc <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(corpus_tfidf):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Top words in document %d&quot;</span>%(i + <span class="hljs-number">1</span>))<br>    sorted_words = <span class="hljs-built_in">sorted</span>(doc, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)    <span class="hljs-comment">#type=list</span><br>    <span class="hljs-keyword">for</span> num, score <span class="hljs-keyword">in</span> sorted_words[:<span class="hljs-number">3</span>]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;    Word: %s, TF-IDF: %s&quot;</span>%(new_dict[num], <span class="hljs-built_in">round</span>(score, <span class="hljs-number">5</span>)))<br>        <br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">è¾“å‡ºç»“æœï¼š</span><br><span class="hljs-string"></span><br><span class="hljs-string">Training by original algorithm......</span><br><span class="hljs-string"></span><br><span class="hljs-string">Top words in document 1</span><br><span class="hljs-string">    Word: football, TF-IDF: 0.84766</span><br><span class="hljs-string">    Word: rugby, TF-IDF: 0.21192</span><br><span class="hljs-string">    Word: word, TF-IDF: 0.14128</span><br><span class="hljs-string">Top words in document 2</span><br><span class="hljs-string">    Word: play, TF-IDF: 0.29872</span><br><span class="hljs-string">    Word: inches, TF-IDF: 0.19915</span><br><span class="hljs-string">    Word: points, TF-IDF: 0.19915</span><br><span class="hljs-string">Top words in document 3</span><br><span class="hljs-string">    Word: net, TF-IDF: 0.45775</span><br><span class="hljs-string">    Word: teammate, TF-IDF: 0.34331</span><br><span class="hljs-string">    Word: bat, TF-IDF: 0.22888</span><br><span class="hljs-string"></span><br><span class="hljs-string">Training by gensim Tfidf Model.......</span><br><span class="hljs-string"></span><br><span class="hljs-string">Top words in document 1</span><br><span class="hljs-string">    Word: football, TF-IDF: 0.84766</span><br><span class="hljs-string">    Word: rugby, TF-IDF: 0.21192</span><br><span class="hljs-string">    Word: known, TF-IDF: 0.14128</span><br><span class="hljs-string">Top words in document 2</span><br><span class="hljs-string">    Word: play, TF-IDF: 0.29872</span><br><span class="hljs-string">    Word: cm, TF-IDF: 0.19915</span><br><span class="hljs-string">    Word: diameter, TF-IDF: 0.19915</span><br><span class="hljs-string">Top words in document 3</span><br><span class="hljs-string">    Word: net, TF-IDF: 0.45775</span><br><span class="hljs-string">    Word: teammate, TF-IDF: 0.34331</span><br><span class="hljs-string">    Word: across, TF-IDF: 0.22888</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>TF-IDF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NLPå…¥é—¨ï¼ˆä¸€ï¼‰è¯è¢‹æ¨¡å‹åŠå¥å­ç›¸ä¼¼åº¦</title>
    <link href="/2023/07/06/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E8%AF%8D%E8%A2%8B%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%8F%A5%E5%AD%90%E7%9B%B8%E4%BC%BC%E5%BA%A6/"/>
    <url>/2023/07/06/NLP%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E8%AF%8D%E8%A2%8B%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%8F%A5%E5%AD%90%E7%9B%B8%E4%BC%BC%E5%BA%A6/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœ¬æ–‡ä½œä¸ºç¬”è€…NLPå…¥é—¨ç³»åˆ—æ–‡ç« ç¬¬ä¸€ç¯‡ï¼Œä»¥åæˆ‘ä»¬å°±è¦æ­¥å…¥NLPæ—¶ä»£ã€‚</p><p>æœ¬æ–‡å°†ä¼šä»‹ç»NLPä¸­å¸¸è§çš„è¯è¢‹æ¨¡å‹ï¼ˆBag ofWordsï¼‰ä»¥åŠå¦‚ä½•åˆ©ç”¨è¯è¢‹æ¨¡å‹æ¥è®¡ç®—å¥å­é—´çš„ç›¸ä¼¼åº¦ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼Œcosinesimilarityï¼‰ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯è¯è¢‹æ¨¡å‹ã€‚æˆ‘ä»¬ä»¥ä¸‹é¢ä¸¤ä¸ªç®€å•å¥å­ä¸ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">sent1 = <span class="hljs-string">&quot;I love sky, I love sea.&quot;</span><br>sent2 = <span class="hljs-string">&quot;I like running, I love reading.&quot;</span><br></code></pre></td></tr></table></figure><p>é€šå¸¸ï¼ŒNLPæ— æ³•ä¸€ä¸‹å­å¤„ç†å®Œæ•´çš„æ®µè½æˆ–å¥å­ï¼Œå› æ­¤ï¼Œç¬¬ä¸€æ­¥å¾€å¾€æ˜¯åˆ†å¥å’Œåˆ†è¯ã€‚è¿™é‡Œåªæœ‰å¥å­ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦åˆ†è¯å³å¯ã€‚å¯¹äºè‹±è¯­å¥å­ï¼Œå¯ä»¥ä½¿ç”¨NLTKä¸­çš„word_tokenizeå‡½æ•°ï¼Œå¯¹äºä¸­æ–‡å¥å­ï¼Œåˆ™å¯ä½¿ç”¨jiebaæ¨¡å—ã€‚æ•…ç¬¬ä¸€æ­¥ä¸ºåˆ†è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> nltk <span class="hljs-keyword">import</span> word_tokenize<br>sents = [sent1, sent2]<br>texts = [[word <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> word_tokenize(sent)] <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents]<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[[<span class="hljs-symbol">&#x27;I</span>&#x27;, <span class="hljs-symbol">&#x27;love</span>&#x27;, <span class="hljs-symbol">&#x27;sky</span>&#x27;, &#x27;,&#x27;, <span class="hljs-symbol">&#x27;I</span>&#x27;, <span class="hljs-symbol">&#x27;love</span>&#x27;, <span class="hljs-symbol">&#x27;sea</span>&#x27;, <span class="hljs-symbol">&#x27;.</span>&#x27;], [<span class="hljs-symbol">&#x27;I</span>&#x27;, <span class="hljs-symbol">&#x27;like</span>&#x27;, <span class="hljs-symbol">&#x27;running</span>&#x27;, &#x27;,&#x27;, <span class="hljs-symbol">&#x27;I</span>&#x27;, <span class="hljs-symbol">&#x27;love</span>&#x27;, <span class="hljs-symbol">&#x27;reading</span>&#x27;, <span class="hljs-symbol">&#x27;.</span>&#x27;]]<br></code></pre></td></tr></table></figure><p>åˆ†è¯å®Œæ¯•ã€‚ä¸‹ä¸€æ­¥æ˜¯æ„å»ºè¯­æ–™åº“ï¼Œå³æ‰€æœ‰å¥å­ä¸­å‡ºç°çš„å•è¯åŠæ ‡ç‚¹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">all_list = []<br><span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts:<br>    all_list += text<br>corpus = <span class="hljs-built_in">set</span>(all_list)<br><span class="hljs-built_in">print</span>(corpus)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;&#x27;love&#x27;, &#x27;running&#x27;, &#x27;reading&#x27;, &#x27;sky&#x27;, &#x27;.&#x27;, &#x27;I&#x27;, &#x27;like&#x27;, &#x27;sea&#x27;, &#x27;,&#x27;&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯­æ–™åº“ä¸­ä¸€å…±æ˜¯8ä¸ªå•è¯åŠæ ‡ç‚¹ã€‚æ¥ä¸‹æ¥ï¼Œå¯¹è¯­æ–™åº“ä¸­çš„å•è¯åŠæ ‡ç‚¹å»ºç«‹æ•°å­—æ˜ å°„ï¼Œä¾¿äºåç»­çš„å¥å­çš„å‘é‡è¡¨ç¤ºã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">corpus_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(corpus, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(corpus))))<br><span class="hljs-built_in">print</span>(corpus_dict)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;&#x27;running&#x27;: <span class="hljs-number">1</span>, &#x27;reading&#x27;: <span class="hljs-number">2</span>, &#x27;love&#x27;: <span class="hljs-number">0</span>, &#x27;sky&#x27;: <span class="hljs-number">3</span>, &#x27;.&#x27;: <span class="hljs-number">4</span>, &#x27;I&#x27;: <span class="hljs-number">5</span>, &#x27;like&#x27;: <span class="hljs-number">6</span>, &#x27;sea&#x27;: <span class="hljs-number">7</span>, &#x27;,&#x27;: <span class="hljs-number">8</span>&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶å•è¯åŠæ ‡ç‚¹å¹¶æ²¡æœ‰æŒ‰ç…§å®ƒä»¬å‡ºç°çš„é¡ºåºæ¥å»ºç«‹æ•°å­—æ˜ å°„ï¼Œä¸è¿‡è¿™å¹¶ä¸ä¼šå½±å“å¥å­çš„å‘é‡è¡¨ç¤ºåŠåç»­çš„å¥å­é—´çš„ç›¸ä¼¼åº¦ã€‚</p><p>ä¸‹ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯è¯è¢‹æ¨¡å‹çš„å…³é”®ä¸€æ­¥ï¼Œå°±æ˜¯å»ºç«‹å¥å­çš„å‘é‡è¡¨ç¤ºã€‚è¿™ä¸ªè¡¨ç¤ºå‘é‡å¹¶ä¸æ˜¯ç®€å•åœ°ä»¥å•è¯æˆ–æ ‡ç‚¹å‡ºç°ä¸å¦æ¥é€‰æ‹©0ï¼Œ1æ•°å­—ï¼Œè€Œæ˜¯æŠŠå•è¯æˆ–æ ‡ç‚¹çš„å‡ºç°é¢‘æ•°ä½œä¸ºå…¶å¯¹åº”çš„æ•°å­—è¡¨ç¤ºï¼Œç»“åˆåˆšæ‰çš„è¯­æ–™åº“å­—å…¸ï¼Œå¥å­çš„å‘é‡è¡¨ç¤ºçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å»ºç«‹å¥å­çš„å‘é‡è¡¨ç¤º</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">vector_rep</span>(<span class="hljs-params">text, corpus_dict</span>):<br>    vec = []<br>    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> corpus_dict.keys():<br>        <span class="hljs-keyword">if</span> key <span class="hljs-keyword">in</span> text:<br>            vec.append((corpus_dict[key], text.count(key)))<br>        <span class="hljs-keyword">else</span>:<br>            vec.append((corpus_dict[key], <span class="hljs-number">0</span>))<br><br>    vec = <span class="hljs-built_in">sorted</span>(vec, key= <span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">0</span>])<br><br>    <span class="hljs-keyword">return</span> vec<br><br>vec1 = vector_rep(texts[<span class="hljs-number">0</span>], corpus_dict)<br>vec2 = vector_rep(texts[<span class="hljs-number">1</span>], corpus_dict)<br><span class="hljs-built_in">print</span>(vec1)<br><span class="hljs-built_in">print</span>(vec2)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[(<span class="hljs-name">0</span>, <span class="hljs-number">2</span>), (<span class="hljs-name">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">2</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">3</span>, <span class="hljs-number">1</span>), (<span class="hljs-name">4</span>, <span class="hljs-number">1</span>), (<span class="hljs-name">5</span>, <span class="hljs-number">2</span>), (<span class="hljs-name">6</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">7</span>, <span class="hljs-number">1</span>), (<span class="hljs-name">8</span>, <span class="hljs-number">1</span>)]<br>[(<span class="hljs-name">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-name">1</span>, <span class="hljs-number">1</span>), (<span class="hljs-name">2</span>, <span class="hljs-number">1</span>), (<span class="hljs-name">3</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">4</span>, <span class="hljs-number">1</span>), (<span class="hljs-name">5</span>, <span class="hljs-number">2</span>), (<span class="hljs-name">6</span>, <span class="hljs-number">1</span>), (<span class="hljs-name">7</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">8</span>, <span class="hljs-number">1</span>)]<br></code></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬ç¨å¾®é€—ç•™ä¸€ä¼šå„¿ï¼Œæ¥çœ‹çœ‹è¿™ä¸ªå‘é‡ã€‚åœ¨ç¬¬ä¸€å¥ä¸­Iå‡ºç°äº†ä¸¤æ¬¡ï¼Œåœ¨é¢„æ–™åº“å­—å…¸ä¸­ï¼ŒIå¯¹åº”çš„æ•°å­—ä¸º5ï¼Œå› æ­¤åœ¨ç¬¬ä¸€å¥ä¸­5å‡ºç°2æ¬¡ï¼Œåœ¨åˆ—è¡¨ä¸­çš„å…ƒç»„å³ä¸º(5,2)ï¼Œä»£è¡¨å•è¯Iåœ¨ç¬¬ä¸€å¥ä¸­å‡ºç°äº†2æ¬¡ã€‚ä»¥ä¸Šçš„è¾“å‡ºå¯èƒ½å¹¶ä¸é‚£ä¹ˆç›´è§‚ï¼ŒçœŸå®çš„ä¸¤ä¸ªå¥å­çš„ä»£è¡¨å‘é‡åº”ä¸ºï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[2, 0, 0, 1, 1, 2, 0, 1, 1]</span><br><span class="hljs-string">[1, 1, 1, 0, 1, 2, 1, 0, 1]</span><br></code></pre></td></tr></table></figure><p>OKï¼Œè¯è¢‹æ¨¡å‹åˆ°æ­¤ç»“æŸã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šåˆ©ç”¨åˆšæ‰å¾—åˆ°çš„è¯è¢‹æ¨¡å‹ï¼Œå³ä¸¤ä¸ªå¥å­çš„å‘é‡è¡¨ç¤ºï¼Œæ¥è®¡ç®—ç›¸ä¼¼åº¦ã€‚</p><p>åœ¨NLPä¸­ï¼Œå¦‚æœå¾—åˆ°äº†ä¸¤ä¸ªå¥å­çš„å‘é‡è¡¨ç¤ºï¼Œé‚£ä¹ˆï¼Œä¸€èˆ¬ä¼šé€‰æ‹©ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ä½œä¸ºå®ƒä»¬çš„ç›¸ä¼¼åº¦ï¼Œè€Œå‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦å³ä¸ºä¸¤ä¸ªå‘é‡çš„å¤¹è§’çš„ä½™å¼¦å€¼ã€‚å…¶è®¡ç®—çš„Pythonä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> sqrt<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">similarity_with_2_sents</span>(<span class="hljs-params">vec1, vec2</span>):<br>    inner_product = <span class="hljs-number">0</span><br>    square_length_vec1 = <span class="hljs-number">0</span><br>    square_length_vec2 = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> tup1, tup2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(vec1, vec2):<br>        inner_product += tup1[<span class="hljs-number">1</span>]*tup2[<span class="hljs-number">1</span>]<br>        square_length_vec1 += tup1[<span class="hljs-number">1</span>]**<span class="hljs-number">2</span><br>        square_length_vec2 += tup2[<span class="hljs-number">1</span>]**<span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">return</span> (inner_product/sqrt(square_length_vec1*square_length_vec2))<br><br><br>cosine_sim = similarity_with_2_sents(vec1, vec2)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸¤ä¸ªå¥å­çš„ä½™å¼¦ç›¸ä¼¼åº¦ä¸ºï¼š %.4fã€‚&#x27;</span>%cosine_sim)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ä¸¤ä¸ªå¥å­çš„ä½™å¼¦ç›¸ä¼¼åº¦ä¸ºï¼š 0.7303ã€‚<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡å¥å­çš„è¯è¢‹æ¨¡å‹ï¼Œå¾—åˆ°äº†å®ƒä»¬é—´çš„å¥å­ç›¸ä¼¼åº¦ã€‚</p><p>å½“ç„¶ï¼Œåœ¨å®é™…çš„NLPé¡¹ç›®ä¸­ï¼Œå¦‚æœéœ€è¦è®¡ç®—ä¸¤ä¸ªå¥å­çš„ç›¸ä¼¼åº¦ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨gensimæ¨¡å—å³å¯ï¼Œå®ƒæ˜¯NLPçš„åˆ©å™¨ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¤„ç†å¾ˆå¤šNLPä»»åŠ¡ã€‚ä¸‹é¢ä¸ºç”¨gensimè®¡ç®—ä¸¤ä¸ªå¥å­çš„ç›¸ä¼¼åº¦çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python">sent1 = <span class="hljs-string">&quot;I love sky, I love sea.&quot;</span><br>sent2 = <span class="hljs-string">&quot;I like running, I love reading.&quot;</span><br><br><span class="hljs-keyword">from</span> nltk <span class="hljs-keyword">import</span> word_tokenize<br>sents = [sent1, sent2]<br>texts = [[word <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> word_tokenize(sent)] <span class="hljs-keyword">for</span> sent <span class="hljs-keyword">in</span> sents]<br><span class="hljs-built_in">print</span>(texts)<br><br><span class="hljs-keyword">from</span> gensim <span class="hljs-keyword">import</span> corpora<br><span class="hljs-keyword">from</span> gensim.similarities <span class="hljs-keyword">import</span> Similarity<br><br><span class="hljs-comment">#  è¯­æ–™åº“</span><br>dictionary = corpora.Dictionary(texts)<br><br><span class="hljs-comment"># åˆ©ç”¨doc2bowä½œä¸ºè¯è¢‹æ¨¡å‹</span><br>corpus = [dictionary.doc2bow(text) <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts]<br>similarity = Similarity(<span class="hljs-string">&#x27;-Similarity-index&#x27;</span>, corpus, num_features=<span class="hljs-built_in">len</span>(dictionary))<br><span class="hljs-built_in">print</span>(similarity)<br><span class="hljs-comment"># è·å–å¥å­çš„ç›¸ä¼¼åº¦</span><br>new_sensence = sent1<br>test_corpus_1 = dictionary.doc2bow(word_tokenize(new_sensence))<br><br>cosine_sim = similarity[test_corpus_1][<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åˆ©ç”¨gensimè®¡ç®—å¾—åˆ°ä¸¤ä¸ªå¥å­çš„ç›¸ä¼¼åº¦ï¼š %.4fã€‚&quot;</span>%cosine_sim)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs delphi">[[<span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;love&#x27;</span>, <span class="hljs-string">&#x27;sky&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;love&#x27;</span>, <span class="hljs-string">&#x27;sea&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>], [<span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;like&#x27;</span>, <span class="hljs-string">&#x27;running&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;love&#x27;</span>, <span class="hljs-string">&#x27;reading&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>]]<br>Similarity <span class="hljs-keyword">index</span> <span class="hljs-keyword">with</span> <span class="hljs-number">2</span> documents <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> shards (<span class="hljs-keyword">stored</span> under -Similarity-<span class="hljs-keyword">index</span>)<br>åˆ©ç”¨gensimè®¡ç®—å¾—åˆ°ä¸¤ä¸ªå¥å­çš„ç›¸ä¼¼åº¦ï¼š <span class="hljs-number">0.7303</span>ã€‚<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœåœ¨è¿è¡Œä»£ç æ—¶å‡ºç°ä»¥ä¸‹warning:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">gensim\utils.py:<span class="hljs-number">1209</span>: UserWarning: detected Windows; aliasing chunkize <span class="hljs-keyword">to</span> chunkize_serial<br>  warnings.warn(&quot;detected Windows; aliasing chunkize to chunkize_serial&quot;)<br><br>gensim\matutils.py:<span class="hljs-number">737</span>: FutureWarning: <span class="hljs-keyword">Conversion</span> <span class="hljs-keyword">of</span> the second argument <span class="hljs-keyword">of</span> issubdtype <span class="hljs-keyword">from</span> `<span class="hljs-type">int</span>` <span class="hljs-keyword">to</span> `np.signedinteger` <span class="hljs-keyword">is</span> deprecated. <span class="hljs-keyword">In</span> future, it will be treated <span class="hljs-keyword">as</span> `np.int32 == np.dtype(<span class="hljs-type">int</span>).<span class="hljs-keyword">type</span>`.<br>  <span class="hljs-keyword">if</span> np.issubdtype(vec.dtype, np.int):<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦å»æ‰è¿™äº›warningï¼Œåˆ™åœ¨å¯¼å…¥gensimæ¨¡å—çš„ä»£ç å‰æ·»åŠ ä»¥ä¸‹ä»£ç å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> warnings<br>warnings.filterwarnings(action=<span class="hljs-string">&#x27;ignore&#x27;</span>,category=UserWarning,module=<span class="hljs-string">&#x27;gensim&#x27;</span>)<br>warnings.filterwarnings(action=<span class="hljs-string">&#x27;ignore&#x27;</span>,category=FutureWarning,module=<span class="hljs-string">&#x27;gensim&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢é˜…è¯»ï¼å¦‚æœä¸å½“ä¹‹å¤„ï¼Œè¯·é€Ÿè”ç³»ç¬”è€…ï¼Œæ¬¢è¿å¤§å®¶äº¤æµï¼ç¥æ‚¨å¥½è¿~</p><p>æ³¨æ„ï¼šæœ¬äººç°å·²å¼€é€šå¾®ä¿¡å…¬ä¼—å·ï¼šNLPå¥‡å¹»ä¹‹æ—…ï¼ˆå¾®ä¿¡å·ä¸ºï¼šeasy_web_scrapeï¼‰ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨å“¦~~</p>]]></content>
    
    
    <categories>
      
      <category>NLP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NLP</tag>
      
      <tag>è¯è¢‹æ¨¡å‹</tag>
      
      <tag>å¥å­ç›¸ä¼¼åº¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æŠ€æœ¯æ–‡ç« å†™ä½œè®¡åˆ’</title>
    <link href="/2023/07/06/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0%E5%86%99%E4%BD%9C%E8%AE%A1%E5%88%92/"/>
    <url>/2023/07/06/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0%E5%86%99%E4%BD%9C%E8%AE%A1%E5%88%92/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><table><thead><tr><th>åºå·</th><th>æ‹Ÿå®šé¢˜ç›®</th><th>æå‡ºæ—¥æœŸ</th><th>çŠ¶æ€</th><th>å®Œæˆæ—¥æœŸ</th></tr></thead><tbody><tr><td>1</td><td>æ»‘åŠ¨éªŒè¯ç çš„è¯†åˆ«</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>2</td><td>æ»‘åŠ¨éªŒè¯ç çš„è·å–</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>3</td><td>ç‚¹é€‰éªŒè¯ç çš„è¯†åˆ«</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>4</td><td>ELKç®€å•æ­å»ºçš„demo</td><td>/</td><td>âœ…</td><td>2023.12.23</td></tr><tr><td>5</td><td>æ–‡æœ¬èšç±»</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>6</td><td>æ™ºèƒ½é—®ç­”</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>7</td><td>è½¦ç‰Œçš„è¯†åˆ«</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>8</td><td>ä¸ªäººè¶³è¿¹åœ°å›¾ï¼ˆWEBæœåŠ¡ï¼‰</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>9</td><td>åˆ«åå‘ç°ç³»ç»Ÿ</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>10</td><td>è¯»å–docå’Œdocxæ–‡æ¡£</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>11</td><td>åˆ©ç”¨celeryå®ç°å®šæ—¶ä»»åŠ¡</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>12</td><td>æ–‡æœ¬æ ‡æ³¨å·¥å…·Doccano</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>13</td><td>åˆ©ç”¨Condaåˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>14</td><td>åˆ©ç”¨SFTPè¿æ¥LinuxæœåŠ¡å™¨å¹¶ä¸Šä¼ ã€ä¸‹è½½æ–‡ä»¶</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>15</td><td>Flaskå­¦ä¹ ä¹‹RESTful API</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>16</td><td>Flaskå­¦ä¹ ä¹‹JWTè®¤è¯</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>17</td><td>BSONæ–‡ä»¶è¯»å–</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>18</td><td>Flaskå­¦ä¹ ä¹‹Flask-SQLALCHEMY</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>19</td><td>è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ç¯‡ï¼šå•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€ç›‘å¬æ¨¡å¼ï¼‰</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>20</td><td>Redisè¿›é˜¶</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>21</td><td>supervisorä½¿ç”¨</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>22</td><td>tornadoä¹‹æ–‡ä»¶ä¸‹è½½ï¼ˆåŒ…å«ä¸­æ–‡æ–‡ä»¶ä¸‹è½½ï¼‰</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>23</td><td>åˆ©ç”¨CRFå®ç°ä¸­æ–‡åˆ†è¯</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>24</td><td>åˆ©ç”¨CRFå®ç°æ¨¡å‹é¢„æµ‹</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>25</td><td>protobufçš„åˆæ¬¡ä½¿ç”¨</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>26</td><td>æ›´æ–°tensorflow/servingä¸­çš„models.configæ–‡ä»¶ä¸­çš„model_version_policy</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>27</td><td>tensorflowåŒæ—¶ä½¿ç”¨å¤šä¸ªsession</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>28</td><td>å¦‚ä½•ç¦»çº¿å®‰è£…tensorflowæ¨¡å—</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>29</td><td>tensorboardæŸ¥çœ‹ckptå’Œpbæ–‡ä»¶æ¨¡å‹</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>30</td><td>å°†ckptè½¬åŒ–ä¸ºpbæ–‡ä»¶</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>31</td><td>tensorflow/servingä¹‹BERTæ¨¡å‹éƒ¨ç½²å’Œé¢„æµ‹</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>32</td><td>tensorflow/servingå®ç°æ¨¡å‹éƒ¨ç½²</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>33</td><td>@property</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>34</td><td>tf_record</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>35</td><td>æŒ‡ä»£å…³ç³»æŠ½å–</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>36</td><td>å®ä½“é“¾æ¥ï¼ˆç™¾åº¦å®ä½“é“¾æ¥æ¯”èµ›ã€æ­¦å™¨è£…å¤‡çŸ¥è¯†å›¾è°±ï¼‰</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>37</td><td>æ–‡æœ¬å¤šåˆ†ç±»BERTå¾®è°ƒ</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>38</td><td>æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»BERTå¾®è°ƒ</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>39</td><td>æ–‡æœ¬åºåˆ—æ ‡æ³¨BERTå¾®è°ƒ</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>40</td><td>keras-bert Englishç³»åˆ—ï¼ˆ3ä¸ªæ¨¡å‹ç¨å¾®è°ƒæ•´å³å¯ï¼‰</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>41</td><td>keras-bertè°ƒç”¨ALBERT</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>42</td><td>keras-bertæ¨¡å‹éƒ¨ç½²</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>43</td><td>h5æ–‡ä»¶è½¬åŒ–ä¸ºpbæ–‡ä»¶è¿›è¡Œéƒ¨ç½²</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>44</td><td>tensorflow/servingé«˜æ•ˆè°ƒç”¨</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>45</td><td>tensorflow_hubå®ç°è‹±æ–‡æ–‡æœ¬äºŒåˆ†ç±»</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>46</td><td>tensorflow2.0å’Œtransformerså®ç°æ–‡æœ¬å¤šåˆ†ç±»</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>47</td><td>æŠ½å–å¼é—®ç­”</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>48</td><td>å®Œå½¢å¡«ç©ºä¸æ–‡æœ¬çº é”™</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>49</td><td>transformerså®ç°ä¸­æ–‡åºåˆ—æ ‡æ³¨</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>50</td><td>tokenizersä¸­çš„tokenä½¿ç”¨æ–¹æ³•</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>51</td><td>BPE token ç®—æ³•</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>52</td><td>Keras: KæŠ˜äº¤å‰éªŒè¯</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>53</td><td>ä½¿ç”¨Prothemuså¯¹tensorflow/servingè¿›è¡ŒæœåŠ¡ç›‘æ§</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>54</td><td>seqevalè·å–åºåˆ—æ ‡æ³¨å®ä½“è¯†åˆ«ç»“æœ</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>55</td><td>ESè¿›é˜¶</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>56</td><td>ä»è·å…°å›½æ——é—®é¢˜åˆ°å¿«é€Ÿæ’åº</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>57</td><td>ä¸­è‹±æ–‡å¤§æ¨¡å‹è°ƒç ”</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>58</td><td>LLaMAæ¨¡å‹çš„ä»‹ç»åŠå…¶ä½¿ç”¨</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>59</td><td>Fine-tune LLaMAæ¨¡å‹</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>60</td><td>OpenAIçš„tokenizerè°ƒç ”</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>61</td><td>Gitlab CI/CD å…¥é—¨</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>62</td><td>LangChainä½¿ç”¨</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>63</td><td>Flaskéƒ¨ç½²</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>64</td><td>LangChainæ„å»ºé˜…è¯»åŠ©æ‰‹ï¼ˆæ–‡æ¡£é—®ç­”ï¼‰</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>65</td><td>ä½¿ç”¨LoRAè®­ç»ƒFlan-T5-XXLæ¨¡å‹</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>66</td><td>VSCodeè¿æ¥è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œå¼€å‘</td><td>/</td><td>âœ…</td><td>2023.10.17</td></tr><tr><td>67</td><td>Streamlitä½¿ç”¨</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>68</td><td>Baichuan-13B-Chatçš„ä½¿ç”¨æ¢ç´¢</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>69</td><td>HuggingFaceä¸­çš„Dataset</td><td>/</td><td>âœ…</td><td>/</td></tr><tr><td>70</td><td>HuggingFaceä¸­çš„æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°</td><td>/</td><td>âœ…</td><td>2023.9.2</td></tr><tr><td>71</td><td>ä½¿ç”¨Baichuanè¿›è¡Œäººç‰©å…³ç³»åˆ†ç±»å¾®è°ƒ</td><td>/</td><td>âœ…</td><td>2023.7.30</td></tr><tr><td>72</td><td>PyTorchå…¥é—¨ä¹‹æ¨¡å‹é‡åŒ–</td><td>/</td><td>âœ…</td><td>2023.9.2</td></tr><tr><td>73</td><td>è¯­è¨€æ¨¡å‹ä¸­çš„å¸¸è§è§£ç æ–¹æ³•</td><td>/</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>74</td><td>é…ç½®ä¸­å¿ƒApolloçš„ä½¿ç”¨</td><td>2023.8.9</td><td>âœ…</td><td>2023.9.12</td></tr><tr><td>75</td><td>Pythonä¸­çš„retryæ¨¡å—çš„ä½¿ç”¨ï¼ˆretry &amp; tenacityï¼‰</td><td>2023.8.10</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>76</td><td>æ–‡æœ¬ç”Ÿæˆä¸­çš„æ§åˆ¶ç­–ç•¥ï¼ˆstopping, logitsï¼‰</td><td>2023.8.10</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>77</td><td>Gradioä½¿ç”¨</td><td>2023.8.12</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>78</td><td>trlæ¨¡å—ä»‹ç»</td><td>2023.8.12</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>79</td><td>å‘é‡æ•°æ®åº“ï¼ˆFaiss, Milvusï¼‰çš„ä½¿ç”¨</td><td>2023.8.12</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>80</td><td>GitlabæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰</td><td>2023.8.12</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>81</td><td>äººç‰©å…³ç³»åˆ†ç±»å¯ç”¨BaiChuan-13Bæ¨¡å‹è®­ç»ƒï¼Œæ•ˆæœæ¯”7Bå¥½</td><td>2023.8.16</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>82</td><td>ä½¿ç”¨LLMè¿›è¡Œå¼€æ”¾é¢†åŸŸä¸‰å…ƒç»„æŠ½å–</td><td>2023.8.16</td><td>âœ…</td><td>2023.9.30</td></tr><tr><td>83</td><td>FlaskæœåŠ¡ç›‘æ§</td><td>2023.8.16</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>84</td><td>vLLMä½¿ç”¨</td><td>2023.8.16</td><td>ğŸ¤”</td><td>/</td></tr><tr><td>85</td><td>coverageæ¨¡å—çš„é«˜çº§ç”¨æ³•</td><td>2023.8.19</td><td>âœ…</td><td>2023.8.19</td></tr><tr><td>86</td><td>gradioçš„ç¤ºä¾‹ç”¨æ³•ï¼ˆè¡¨æ ¼ï¼Œé«˜äº®ï¼Œæ¨¡å‹è¾“å…¥ã€è¾“å‡ºï¼‰</td><td>2023.8.19</td><td>âœ…</td><td>2023.8.30</td></tr><tr><td>87</td><td>ä»£ç é£æ ¼PEP 8 å’Œ æ³¨é‡Šé£æ ¼</td><td>2023.8.30</td><td>âœ…</td><td>2023.9.15</td></tr><tr><td>88</td><td>LLAMA 2å¾®è°ƒRACEæ•°æ®é›†</td><td>2023.9.10</td><td>âœ…</td><td>2023.9.10</td></tr><tr><td>89</td><td>Pythonå¼‚æ­¥ç¼–ç asyncio</td><td>2023.9.19</td><td>âœ…</td><td>2023.9.19</td></tr><tr><td>90</td><td>LangChainæµå¼æ¥å£è°ƒç”¨ï¼ˆä½¿ç”¨å¼‚æ­¥ï¼‰</td><td>2023.9.19</td><td>âœ…</td><td>2023.9.20</td></tr><tr><td>91</td><td>Webæ¡†æ¶Sanicä»‹ç»</td><td>2023.9.19</td><td>ğŸ¤”</td><td>/</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>å†™ä½œè®¡åˆ’</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†™ä½œè®¡åˆ’</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨Hexo+Githubæ­å»ºä¸ªäººåšå®¢ç½‘ç«™</title>
    <link href="/2023/07/06/%E4%BD%BF%E7%94%A8Hexo-Github%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99/"/>
    <url>/2023/07/06/%E4%BD%BF%E7%94%A8Hexo-Github%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ›¾å‡ ä½•æ—¶ï¼Œç¬”è€…ä¹Ÿå¹»æƒ³è¿‡å†™ä¸ªé¡¹ç›®æ¥æ­å»ºå±äºè‡ªå·±çš„ä¸ªäººåšå®¢ã€‚<br>ä½†æ˜¯ï¼Œå†™ç¨‹åºä»¥åŠç»´æŠ¤çš„æˆæœ¬ï¼Œä¸ç¦è®©æˆ‘çŠ¹è±«å†ä¸‰ï¼Œæœ€åè¿˜æ˜¯é€‰æ‹©äº†CSDNç­‰åšå®¢ç½‘ç«™ã€‚å°†è¿‘å…­å¹´çš„åšå®¢ç”Ÿæ¶¯ï¼Œæˆ‘å°è¯•äº†ä¸åŒçš„åšå®¢ç½‘ç«™ï¼Œå„æœ‰å„çš„åˆ©å’Œå¼Šï¼Œä¸å˜çš„æ˜¯å¹¿å‘Šï¼Œè¿™è®©äººå¾ˆä¸çˆ½ã€‚<br>ç›´åˆ°ä»Šå¤©ï¼Œæˆ‘çœ‹åˆ°äº†åˆ«äººå†™çš„åˆ©ç”¨Hexo+Githubæ¥æ­å»ºä¸ªäººåšå®¢ç½‘ç«™ï¼Œå¦‚è·è‡³å®ã€‚æŠ˜è…¾äº†ä¸€é˜µä»¥åï¼Œè½»æ¾å®Œæˆäº†ä¸ªäººåšå®¢çš„æ­å»ºï¼Œè¿™ç§æ¸…çˆ½çš„ç•Œé¢é£æ ¼ï¼Œè®©äººè€³ç›®ä¸€æ–°ï¼ŒåŒæ—¶å®ƒåˆæ˜¯å…è´¹çš„ï¼ŒåŠŸèƒ½ç¹å¤šçš„ï¼Œä¾¿äºç»´æŠ¤çš„ã€‚<br>ä¸‹é¢ï¼Œæˆ‘å°†ä¼šä»‹ç»å¦‚ä½•æ¥ä½¿ç”¨Hexo+Githubæ­å»ºä¸ªäººåšå®¢ç½‘ç«™ã€‚</p><h3 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h3><p>ä¸ºäº†é¡ºåˆ©åœ°å®Œæˆä¸ªäººåšå®¢ç½‘ç«™çš„æ­å»ºï¼Œéœ€è¦åšä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š</p><ul><li>å®‰è£…Gitå’ŒNodeJsï¼ˆç‰ˆæœ¬ä¸º18.16.1ï¼‰ï¼›</li><li>å®‰è£…Hexoï¼ˆå‘½ä»¤ä¸º<code>npm i -g hexo</code>ï¼‰;</li><li>Githubè´¦å·</li></ul><h3 id="æ­å»ºåšå®¢">æ­å»ºåšå®¢</h3><p>ä¸‹é¢å°†åˆ†æ­¥æ¥ä»‹ç»å¦‚ä½•ä½¿ç”¨Hexoå’ŒGithubæ¥æ­å»ºä¸ªäººåšå®¢ç½‘ç«™ã€‚</p><h4 id="åˆ›å»ºGithubä»“åº“">åˆ›å»ºGithubä»“åº“</h4><p>åœ¨Githubä¸­æ–°å»ºä¸€ä¸ªåä¸ºusername.github.ioçš„ç©ºä»“åº“ï¼Œå…¶ä¸­usernameæ˜¯ä½ åœ¨GitHubä¸Šçš„ç”¨æˆ·åï¼Œ<a href="http://xn--percent-e73km8bk83a9sozkogu4bpj5atkokus.github.io">æ¯”å¦‚ç¬”è€…çš„ä»“åº“åä¸ºpercent.github.io</a>ã€‚</p><h4 id="é…ç½®SSH">é…ç½®SSH</h4><p>å¦‚æœæƒ³è¦ä½¿ç”¨è¿œç¨‹ä»ä½ çš„ç”µè„‘ä¸Šä¼ æ–‡ä»¶è‡³ä½ çš„githubä»“åº“ï¼Œé‚£ä¹ˆï¼Œä½ å°±éœ€è¦é…ç½®SSHã€‚ç‚¹å‡»ä½ ä¸ªäººGithubä¸Šçš„Settingsé€‰é¡¹ï¼Œåœ¨<code>SSH and GPG keys</code>ä¸­é…ç½®SSHçš„å…¬é’¥ï¼Œä¸€èˆ¬å…¬é’¥ä½äº<code>.ssh/id_rsa.pub</code>ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="/img/hexo1.png" alt="é…ç½®SSH"></p><h4 id="åšå®¢åˆå§‹åŒ–">åšå®¢åˆå§‹åŒ–</h4><p>æ–°å»ºä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ç¬”è€…æ–°å»ºäº†æ–‡ä»¶å¤¹<code>github_blog</code>ï¼Œä½¿ç”¨<code>hexo init</code>å‘½ä»¤åˆå§‹åŒ–åšå®¢ã€‚åˆå§‹åŒ–åçš„æ–‡ä»¶å¤¹ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs 1c">.<br>â”œâ”€â”€ _config.yml<br>â”œâ”€â”€ package.json<br>â”œâ”€â”€ scaffolds<br>â”œâ”€â”€ source<br><span class="hljs-string">|   â”œâ”€â”€ _drafts</span><br><span class="hljs-string">|   â””â”€â”€ _posts</span><br>â””â”€â”€ themes<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°æ–‡ä»¶è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>_config.yml ç½‘ç«™çš„ é…ç½® ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤é…ç½®å¤§éƒ¨åˆ†çš„å‚æ•°ã€‚</li><li>package.jsonï¼šåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚EJS, Stylus å’Œ Markdown renderer å·²é»˜è®¤å®‰è£…ï¼Œæ‚¨å¯ä»¥è‡ªç”±ç§»é™¤ã€‚</li><li>scaffoldsï¼šæ¨¡ç‰ˆæ–‡ä»¶å¤¹ã€‚å½“æ‚¨æ–°å»ºæ–‡ç« æ—¶ï¼ŒHexoä¼šæ ¹æ® scaffold æ¥å»ºç«‹æ–‡ä»¶ã€‚</li><li>sourceï¼šèµ„æºæ–‡ä»¶å¤¹æ˜¯å­˜æ”¾ç”¨æˆ·èµ„æºçš„åœ°æ–¹ã€‚</li><li>themesï¼šä¸»é¢˜æ–‡ä»¶å¤¹ã€‚Hexo ä¼šæ ¹æ®ä¸»é¢˜æ¥ç”Ÿæˆé™æ€é¡µé¢ã€‚</li></ul><h4 id="ç”Ÿæˆä¸ªäººåšå®¢ç½‘ç«™">ç”Ÿæˆä¸ªäººåšå®¢ç½‘ç«™</h4><p>é…ç½®_config.ymlæ–‡ä»¶ï¼Œé…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Deployment</span><br><span class="hljs-comment">## Docs: https://hexo.io/docs/deployment.html</span><br><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/percent4/percent4.github.io.git(ç¬¬ä¸€æ­¥åˆ›å»ºçš„Githubä»“åº“)</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span><br></code></pre></td></tr></table></figure><p>å®‰è£…æ’ä»¶<code>npm install hexo-deployer-git --save</code>åï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">hexo</span> clean<span class="hljs-comment"># æ¸…é™¤æ•°æ®</span><br>hexo d -g<span class="hljs-comment"># ç”Ÿæˆåšå®¢</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™ï¼Œä½ ä¼šçœ‹åˆ°åšå®¢æ•°æ®ä¼šæäº¤è‡³Githubçš„ä¿¡æ¯ï¼Œè€Œç¬¬ä¸€æ­¥åˆ›å»ºçš„ç©ºä»“åº“ä¹Ÿæœ‰äº†æäº¤å†…å®¹ï¼Œå½“ç„¶ï¼Œä½ çš„ä¸ªäººåšå®¢ä¹Ÿæ­å»ºæ­å»ºå®Œæ¯•ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š<a href="https://username.github.io/">https://username.github.io/</a> ï¼Œå…¶ä¸­usernameæ˜¯ä½ åœ¨GitHubä¸Šçš„ç”¨æˆ·åã€‚ç•Œé¢å¦‚ä¸‹ï¼š<br><img src="/img/hexo2.png" alt="Hexoç•Œé¢"></p><h3 id="åšå®¢ç»´æŠ¤">åšå®¢ç»´æŠ¤</h3><p>Hexoæä¾›äº†ä¸€å¥—ç»´æŠ¤åšå®¢çš„ä¼˜é›…çš„åŠæ³•ã€‚ç¬”è€…åœ¨æ­¤ä»…ä»‹ç»å¦‚ä½•æ–°å»ºä¸€ç¯‡åšå®¢ã€‚æ–°å»ºåšå®¢æ ¼å¼ä¸ºmarkdownæ ¼å¼ï¼Œæ¯”å¦‚æˆ‘æƒ³åˆ›å»ºä¸€ç¯‡åä¸º<code>åˆ©ç”¨Tornadoæ­å»ºæ–‡æ¡£é¢„è§ˆç³»ç»Ÿ</code>çš„åšå®¢ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type"></span>åˆ©ç”¨Tornadoæ­å»ºæ–‡æ¡£é¢„è§ˆç³»ç»Ÿ<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™ä¼šåœ¨ä½ å½“å‰ç›®å½•ä¸‹çš„source/_postsæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ<code>åˆ©ç”¨Tornadoæ­å»ºæ–‡æ¡£é¢„è§ˆç³»ç»Ÿ.md</code>,å…¶ä¸­å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">åˆ©ç”¨Tornadoæ­å»ºæ–‡æ¡£é¢„è§ˆç³»ç»Ÿ</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2020-06-09 18:32:29</span><br><span class="hljs-attr">tags:</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­titleä¸ºåšå®¢æ ‡é¢˜ï¼Œdateä¸ºåšå®¢æ—¶é—´ï¼Œtagsä¸ºåšå®¢æ ‡ç­¾ã€‚åœ¨<code>---</code>åé¢å¯ä»¥å†™åšå®¢æ­£æ–‡çš„å†…å®¹ã€‚<br>å†™å®Œåšå®¢åï¼Œä½¿ç”¨å‘½ä»¤</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">hexo</span> clean<span class="hljs-comment"># æ¸…é™¤æ•°æ®</span><br>hexo d -g<span class="hljs-comment"># ç”Ÿæˆåšå®¢</span><br></code></pre></td></tr></table></figure><p>å°±ä¼šæ›´æ–°ä¸ªäººåšå®¢ã€‚</p><h3 id="æ›´æ¢ä¸»é¢˜">æ›´æ¢ä¸»é¢˜</h3><p>Hexoæä¾›çš„é»˜è®¤ä¸»é¢˜ä¸ºlandscape,æˆ‘ä»¬æƒ³æ›¿æ¢ä¸»é¢˜ä¸ºFluid.<br>Hexoæ›¿æ¢ä¸»é¢˜ä¸ºFluidçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>é€šè¿‡<code>npm</code>ç›´æ¥å®‰è£…ï¼Œè¿›å…¥åšå®¢ç›®å½•æ‰§è¡Œå‘½ä»¤ï¼š<code>npm install --save hexo-theme-fluid</code></li><li>å°†node_modulesæ–‡ä»¶å¤¹ä¸‹çš„hexo-theme-fluidå¤åˆ¶åˆ°themesæ–‡ä»¶å¤¹ï¼Œå¹¶é‡åä¸ºfluid</li><li>åœ¨åšå®¢ç›®å½•ä¸‹åˆ›å»º_config.fluid.ymlï¼Œå°†ä¸»é¢˜çš„_config.ymlå†…å®¹å¤åˆ¶è¿›å»ï¼Œå¹¶å°†<code>theme: </code>åé¢çš„ä¸»é¢˜ä¿®æ”¹ä¸ºfluid</li><li>ä½¿ç”¨<code>hexo s</code>è¿›è¡Œæœ¬åœ°éƒ¨ç½²ï¼Œå¦‚æ— é—®é¢˜ï¼Œåˆ™ä½¿ç”¨å‘½ä»¤<code>hexo d -g</code>è¿›è¡Œè¿œç¨‹éƒ¨ç½²</li></ol><h3 id="æ€»ç»“">æ€»ç»“</h3><p>å½“ç„¶ï¼ŒHexoè¿˜æä¾›äº†è®¸å¤šä¸°å¯Œçš„åŠŸèƒ½ï¼Œæ¯”å¦‚themeï¼ˆä¸»é¢˜ï¼‰çš„ä¸ªæ€§åŒ–å®šåˆ¶ç­‰ï¼Œè¿™ä¼šä½¿å¾—ä½ çš„åšå®¢å†…å®¹æ›´åŠ ä¸°å¯Œï¼ŒåŠŸèƒ½æ›´åŠ å®Œå–„ã€‚</p><p>ç¬”è€…å¤§å®¶çš„ä¸ªäººåšå®¢ç½‘ç«™ä¸ºï¼š<a href="https://percent4.github.io/">https://percent4.github.io/</a> ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®ã€‚ä»¥åï¼Œç¬”è€…å°†ä¼šé€æ¸å¾€ä¸ªäººåšå®¢ç½‘ç«™å€¾æ–œï¼Œè€Œå‡å°‘ä½¿ç”¨å…¬å¼€çš„åšå®¢ç¤¾åŒºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
      <tag>ä¸ªäººåšå®¢</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨Hexoï¼Ÿ</title>
    <link href="/2023/07/06/hello-world/"/>
    <url>/2023/07/06/hello-world/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ¬¢è¿æ¥åˆ° <a href="https://hexo.io/">Hexo</a>! è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢ã€‚æŸ¥é˜… <a href="https://hexo.io/docs/">documentation</a> è·å–æ›´å¤šä¿¡æ¯ã€‚ å¦‚æœä½ åœ¨ä½¿ç”¨Hexoé‡åˆ°é—®é¢˜ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ç­”æ¡ˆ <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> ï¼Œæˆ–è€…ä½ å¯ä»¥åœ¨è¿™ä¸Šé¢æé—®ï¼š<a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</h2><h3 id="åˆ›å»ºä¸€ç¯‡æ–°çš„åšå®¢">åˆ›å»ºä¸€ç¯‡æ–°çš„åšå®¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>æ›´æ–°ä¿¡æ¯: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="è¿è¡ŒæœåŠ¡">è¿è¡ŒæœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>æ›´æ–°ä¿¡æ¯: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="äº§ç”Ÿé™æ€æ–‡ä»¶">äº§ç”Ÿé™æ€æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>æ›´æ–°ä¿¡æ¯: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="è¿œç¨‹éƒ¨ç½²">è¿œç¨‹éƒ¨ç½²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>æ›´æ–°ä¿¡æ¯: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
